/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
*/

//     (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*!
 * jQuery Form Plugin
 * version: 3.51.0-2014.06.20
 * Requires jQuery v1.5 or later
 * Copyright (c) 2014 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */

// Copyright (c) 2005  Tom Wu

// Copyright (c) 2005-2009  Tom Wu

// Copyright (c) 2011  Kevin M Burns Jr.

/*! asn1-1.0.2.js (c) 2013 Kenji Urushima | kjur.github.com/jsrsasign/license
 */

/*
 * asn1.js - ASN.1 DER encoder classes
 *
 * Copyright (c) 2013 Kenji Urushima (kenji.urushima@gmail.com)
 *
 * This software is licensed under the terms of the MIT License.
 * http://kjur.github.com/jsrsasign/license
 *
 * The above copyright and license notice shall be 
 * included in all copies or substantial portions of the Software.
 */

/**
 * @fileOverview
 * @name asn1-1.0.js
 * @author Kenji Urushima kenji.urushima@gmail.com
 * @version 1.0.2 (2013-May-30)
 * @since 2.1
 * @license <a href="http://kjur.github.io/jsrsasign/license/">MIT License</a>
 */

// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>

// copyright notice and this permission notice appear in all copies.

/*
 * jQuery MD5 Plugin 1.2.1
 * https://github.com/blueimp/jQuery-MD5
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://creativecommons.org/licenses/MIT/
 * 
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

/* Copyright (c) 2015 Hyunje Alex Jun and other contributors
 * Licensed under the MIT License
 */

/**
 * jQuery EasyUI 1.3
 * 
 * Licensed under the GPL terms
 * To use it on other terms please contact us
 *
 * Copyright(c) 2009-2012 stworthy [ stworthy@gmail.com ] 
 * 
 */

/*! Copyright Twitter Inc. and other contributors. Licensed under MIT */

/* Copyright (c) 2006 Brandon Aaron (brandon.aaron@gmail.com || http://brandonaaron.net)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 *
 * $LastChangedDate: 2007-12-20 09:02:08 -0600 (Thu, 20 Dec 2007) $
 * $Rev: 4265 $
 *
 * Version: 3.0
 * 
 * Requires: $ 1.2.2+
 */

/* Copyright (c) 2013 fengxiao
*  CreateDate: 2013-02-19 11:03
*  Version: 1.0
*  Requires: $ 1.9，jquery.mlusewheel.js 3.0，jquery.easydrag.js
*  $("#div1").eyscroll(options);
*/

/*! WebUploader 0.1.6 */

/*
          Copyright (c) 2008, Adobe Systems Incorporated
          All rights reserved.
    
          Redistribution and use in source and binary forms, with or without
          modification, are permitted provided that the following conditions are
          met:
    
          * Redistributions of source code must retain the above copyright notice,
            this list of conditions and the following disclaimer.
    
          * Redistributions in binary form must reproduce the above copyright
            notice, this list of conditions and the following disclaimer in the
            documentation and/or other materials provided with the distribution.
    
          * Neither the name of Adobe Systems Incorporated nor the names of its
            contributors may be used to endorse or promote products derived from
            this software without specific prior written permission.
    
          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
          IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
          THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
          PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
          CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
          EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
          PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
          PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
          LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
          NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
          SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
        */

/**
 * SWFUpload: http://www.swfupload.org, http://swfupload.googlecode.com
 *
 * mmSWFUpload 1.0: Flash upload dialog - http://profandesign.se/swfupload/,  http://www.vinterwebb.se/
 *
 * SWFUpload is (c) 2006-2007 Lars Huring, Olov Nilz�n and Mammon Media and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * SWFUpload 2 is (c) 2007-2008 Jake Roberts and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */

/*******************************************************************************
 * KindEditor - WYSIWYG HTML Editor for Internet
 * Copyright (C) 2006-2012 kindsoft.net
 *
 * @author Roddy <luolonghao@gmail.com>
 * @website http://www.kindsoft.net/
 * @licence http://www.kindsoft.net/license.php
 * @version 4.1.4 (2012-11-11)
 *******************************************************************************/

/*!
* jQuery Validation Plugin 1.11.1
*
* http://bassistance.de/jquery-plugins/jquery-plugin-validation/
* http://docs.jquery.com/Plugins/Validation
*
* Copyright 2013 Jörn Zaefferer
* Released under the MIT license:
*   http://www.opensource.org/licenses/mit-license.php
*/

/**
 *
 * Date picker
 * Author: Stefan Petre www.eyecon.ro
 *
 * Dual licensed under the MIT and GPL licenses
 *
 */

/* Copyright (c) 2013 fengxiao *  CreateDate: 2013-02-19 11:03 *  Version: 1.0 *  Requires: $ 1.9，jquery.mlusewheel.js 3.0，jquery.easydrag.js *  $("#div1").combobox(options); */

//! moment.js
//! version : 2.10.6
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

/**
 * @license Highcharts JS v5.0.10 (2017-03-31)
 *
 * (c) 2009-2016 Torstein Honsi
 *
 * License: www.highcharts.com/license
 */

/**
         * (c) 2010-2017 Torstein Honsi
         *
         * License: www.highcharts.com/license
         */

/**
         * (c) 2009-2017 Torstein Honsi
         *
         * License: www.highcharts.com/license
         */

/**
 * @license Highcharts JS v5.0.10 (2017-03-31)
 * Exporting module
 *
 * (c) 2010-2017 Torstein Honsi
 *
 * License: www.highcharts.com/license
 */

/**
         * Exporting module
         *
         * (c) 2010-2017 Torstein Honsi
         *
         * License: www.highcharts.com/license
         */

/*!
 * Datepicker v0.5.2
 * https://github.com/fengyuanchen/datepicker
 *
 * Copyright (c) 2014-2017 Fengyuan Chen
 * Released under the MIT license
 *
 * Date: 2017-04-08T12:04:43.796Z
 */

/**
 * @license Highmaps JS v5.0.10 (2017-03-31)
 * Highmaps as a plugin for Highcharts 4.1.x or Highstock 2.1.x (x being the patch version of this file)
 *
 * (c) 2011-2017 Torstein Honsi
 *
 * License: www.highcharts.com/license
 */

/* Copyright (c) 2013 fengxiao
*  CreateDate: 2013-02-05 11:03
*  Version: 1.0
*  Requires: $ 1.9，jquery.parser.js
*/

// copyright.applyDeal()

/**
 * jquery.Jcrop.js v0.9.10
 * jQuery Image Cropping Plugin - released under MIT License
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2012 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */

/* Copyright (c) 2008 - 2009 Joseph Huckaby <jhuckaby@goldcartridge.com> */

/* http://www.gnu.org/licenses/lgpl.html */

/*!
 * Cropper.js v1.4.0
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2018-06-01T15:18:18.692Z
 */

/*
 * jRecorder Plugin for jQuery JavaScript Library (Alpha)
 * http://www.sajithmr.me/jrecorder
 *
 * Copyright (c) 2011 - 2013 Sajithmr.ME
 * Dual licensed under the MIT and GPL licenses.
 *  - http://www.opensource.org/licenses/mit-license.php
 *  - http://www.gnu.org/copyleft/gpl.html
 *
 * Author: Sajith Amma
 * Version: 1.1
 * Date: 14 December 2011
 */

/*!
 * jQuery-ajaxTransport-XDomainRequest - v1.0.3 - 2014-06-06
 * https://github.com/MoonScript/jQuery-ajaxTransport-XDomainRequest
 * Copyright (c) 2014 Jason Moon (@JSONMOON)
 * Licensed MIT (/blob/master/LICENSE.txt)
 */

//上传的声音分类   如为试音 ：copyright  默认空

function myDebug(){window.console&&console.info(arguments)}function readCookie(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}function fileQueued(e,t){var n=new FileProgress(e,this.customSettings.progressTarget,this.filesSelected,!1);n.setStatus("等待上传"),this.numFilesSelected=t,n.toggleCancel(!0,this)}function fileQueueError(e,t,n){if(t===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){require(["plugin/dialog"],function(e){var t="您选择了太多文件。\n"+(n===0?"你已经达到了上传限制。":"你只能上传 "+n+"个文件");e.alert(t)});return}var r=new FileProgress(e,this.customSettings.progressTarget,{singleFile:!1});r.setError(),r.toggleCancel(!0,this);switch(t){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:r.setStatus("文件太大."),this.debug("Error Code: File too big, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:r.setStatus("不能上传空文件."),this.debug("Error Code: Zero byte file, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:r.setStatus("未定义的文件类型."),this.debug("Error Code: Invalid File Type, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;default:e!==null&&r.setStatus("Unhandled Error:"+n),this.debug("Error Code: "+t+", File name: "+e.name+", File size: "+e.size+", Message: "+n)}}function fileDialogComplete(e,t,n){if(e<=0)return;this.filesSelected=n;if(!this.file_queued_list)return;var r=this.file_queued_list.length,i=_.map(this.file_queued_list,function(e){var t=e.name;return t=e.name.replace(/\d+/g,function(e){var t="";for(var n=e.length;n<10;n++)t+="0";return t+e}),{name:t,file:e}});i=_.sortBy(i,function(e){return e.name}),this.file_queued_list=_.map(i,function(e){return e.file});for(var s=0;s<this.file_queued_list.length;s++)fileQueued.call(this,this.file_queued_list[s],e);this.file_queued_list=[]}function uploadStart(e){var t=new FileProgress(e,this.customSettings.progressTarget,this.filesSelected);return t.setStatus("开始上传"),t.uploadStart(),t.toggleCancel(!0,this),!0}function uploadProgress(e,t,n){var r=Math.ceil(t/n*100),i=new FileProgress(e,this.customSettings.progressTarget,this.filesSelected);i.setProgress(r);var s=Math.floor(t*10/1048576)/10+"M",o=Math.floor(n*10/1048576)/10+"M";i.setStatus("上传进度:"+s+"/"+o)}function uploadSuccess(e,t){window.console&&console.log(t);var n=new FileProgress(e,this.customSettings.progressTarget,this.filesSelected,!1);t=$.parseJSON(t);if(t.ret==50){n.setError(),n.setStatus("上传失败,请重新登录");return}if(t.ret!=0){n.setError(),n.setStatus(t.msg);return}if(!t.status){this.upload_error_handler?this.upload_error_handler(e,null,t.msg):uploadError.call(this,e,null,t.msg);return}n.setProgress(100),n.setStatus("上传完成");if(!this.settings.transcoding_url)return;n.setTranscodingStatus("等待转码");var r=this;if(!t||!t.data||!t.data[0])return;var i=t.data[0];e.uploadSuccess=!0,e.transcoding=!1,e.transcoded=!1,e.transcodingError=!1,i.uploadTrack&&(e.uuid=i.uploadTrack.id),e.uuid||(e.uuid=i.id),n.setUuid(e.uuid);var r=this,s=!1,o=this.settings.transcoding_url,u=setInterval(function(){url=o.replace("{id}",e.uuid).replace("{timestamp}",(new Date).getTime());if(s)return;var n=new FileProgress(e,r.customSettings.progressTarget,r.filesSelected,!0);n.toggleCancel(!0,r),s=!0,$.ajax({type:"GET",url:url,dataType:"json",success:function(i,o,a){s=!1;if(!e.transcodeTimer){window.console&&console.log("!transcodeTimer");return}i.duration&&(e.duration=i.duration);switch(i.state){case"success":window.console&&console.log("clearInterval handler 185"),clearInterval(u),n.setTranscodingStatus("转码完成"),n.setTranscodingProgress(100),n.setTranscodingSuccess(t),r.transcodings||(r.transcodings=0),e.transcoding=!1,e.transcoded=!0,e.transcodingError=!1,r.settings.transcoding_success(e);break;case"error":window.console&&console.log("clearInterval handler 198"),clearInterval(u),n.setTranscodingStatus("转码失败:"+i.value),n.setTranscodingError(),e.transcoding=!1,e.transcoded=!1,e.transcodingError=!0;break;case"processing":e.transcoding=!0,window.console&&console.log(" processing 208");if(parseInt(i.value)>=100){window.console&&console.log(" processing >=100 210");return}n.setTranscodingProgress(i.value),n.setTranscodingStatus("转码进度:"+i.value+"%");break;case"queueing":window.console&&console.log(" queueing 217"),e.transcoding=!0,n.setTranscodingStatus("等待转码");break;default:window.console&&console.log("default break 222")}},error:function(t,r,i){if(t.status===400||t.status===408||t.status===504||t.status===503||t.status===502||t.status===0||r==="parsererror"){transcodeError(n,function(){s=!1});return}s=!1,clearInterval(u);var o=new helper.ErrorLog(t.responseText);n.setTranscodingStatus("转码失败:"+r+"<em class='js-errorLog' style='color:blue;margin:4px;cursor: pointer;' errorLog='"+o.id+"'>点击查看错误详情</em>"),n.setTranscodingError(),e.transcoding=!1,e.transcoded=!1,e.transcodingError=!0;var a={errorMsg:r+";"+i,description:t.responseText,audioId:e.uuid};$.ajax({type:"POST",url:"/dtres/transcoding/feedback",data:a}),myDebug("error Transcoding",e)}})},1500);e.transcodeTimer=u}function transcodeError(e,t){var n=10,r=this,i=setInterval(function(){n--,e.setTranscodingStatus("查询进度失败，将在 "+n+"秒后重试"),n<=0&&(clearInterval(i),t())},1e3)}function uploadError(e,t,n){var r=new FileProgress(e,this.customSettings.progressTarget,this.filesSelected);r.setError(),r.toggleCancel(!0,this);if(this.settings.requeue_on_error&&t!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){var i=this.settings.requeue_on_error_time,s=r.getOnErrorTimer();s&&(window.console&&console.log("clearInterval handler 251"),clearInterval(s));var o=this,u=setInterval(function(){i--,r.setStatus("上传失败，将在 "+i+"秒后重试"),i<=0&&(window.console&&console.log("clearInterval handler 259"),clearInterval(r.getOnErrorTimer()))},1e3);r.setOnErrorTimer(u)}switch(t){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:r.setStatus("上传出错: "+n),this.debug("Error Code: HTTP Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:r.setStatus("上传失败."),this.debug("Error Code: Upload Failed, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:r.setStatus("Server (IO) Error"),this.debug("Error Code: IO Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:r.setStatus("Security Error"),this.debug("Error Code: Security Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:r.setStatus("Upload limit exceeded."),this.debug("Error Code: Upload Limit Exceeded, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:r.setStatus("Failed Validation.  Upload skipped."),this.debug("Error Code: File Validation Failed, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:this.getStats().files_queued===0,r.setStatus("Cancelled"),r.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:r.setStatus("Stopped");break;default:r.setStatus("Unhandled Error: "+t),this.debug("Error Code: "+t+", File name: "+e.name+", File size: "+e.size+", Message: "+n)}}function uploadComplete(e){this.getStats().files_queued===0}function queueComplete(e){}function readCookie(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),function(e,t){function P(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function B(e){var t=H[e]={};return b.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(e,n,r,i){if(b.acceptData(e)){var s,o,u=b.expando,a="string"==typeof n,f=e.nodeType,c=f?b.cache:e,h=f?e[u]:e[u]&&u;if(h&&c[h]&&(i||c[h].data)||!a||r!==t)return h||(f?e[u]=h=l.pop()||b.guid++:h=u),c[h]||(c[h]={},f||(c[h].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?c[h]=b.extend(c[h],n):c[h].data=b.extend(c[h].data,n)),s=c[h],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[b.camelCase(n)]=r),a?(o=s[n],null==o&&(o=s[b.camelCase(n)])):o=s,o}}function q(e,t,n){if(b.acceptData(e)){var r,i,s,o=e.nodeType,u=o?b.cache:e,a=o?e[b.expando]:b.expando;if(u[a]){if(t&&(s=n?u[a]:u[a].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in s?t=[t]:(t=b.camelCase(t),t=t in s?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete s[t[r]];if(!(n?U:b.isEmptyObject)(s))return}(n||(delete u[a].data,U(u[a])))&&(o?b.cleanData([e],!0):b.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null)}}}function R(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(F,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:j.test(r)?b.parseJSON(r):r}catch(s){}b.data(e,n,r)}else r=t}return r}function U(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function it(){return!0}function st(){return!1}function ct(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function ht(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(at.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Mt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function _t(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function Ht(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,s=b._data(e),o=b._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)b.event.add(t,n,u[n][r])}o.data&&(o.data=b.extend({},o.data))}}function Bt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(_t(t).text=e.text,Dt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&xt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u)for(u=[],r=e.childNodes||e;null!=(s=r[o]);o++)!n||b.nodeName(s,n)?u.push(s):b.merge(u,jt(s,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;u>o;o++)r=e[o],r.style&&(s[o]=b._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(s[o]=b._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;for(;4>s;s+=2)"margin"===n&&(o+=b.css(e,n+Zt[s],!0,i)),r?("content"===n&&(o-=b.css(e,"padding"+Zt[s],!0,i)),"margin"!==n&&(o-=b.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=b.css(e,"padding"+Zt[s],!0,i),"padding"!==n&&(o+=b.css(e,"border"+Zt[s]+"Width",!0,i)));return o}function un(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=qt(e),o=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Rt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Jt.test(i))return i;r=o&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an(e){var t=s,n=Qt[e];return n||(n=fn(e,t),"none"!==n&&n||(It=(It||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach()),Qt[e]=n),n}function fn(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)vn(e+"["+i+"]",t[i],n,r)}function _n(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(E)||[];if(b.isFunction(n))while(r=s[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Dn(e,n,r,i){function u(a){var f;return s[a]=!0,b.each(e[a]||[],function(e,a){var l=a(n,r,i);return"string"!=typeof l||o||s[l]?o?!(f=l):t:(n.dataTypes.unshift(l),u(l),!1)}),f}var s={},o=e===An;return u(n.dataTypes[0])||!s["*"]&&u("*")}function Pn(e,n){var r,i,s=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(u in l)u in r&&(n[l[u]]=r[u]);while("*"===f[0])f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(u in a)if(a[u]&&a[u].test(s)){f.unshift(u);break}if(f[0]in r)o=f[0];else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}return o?(o!==f[0]&&f.unshift(o),r[o]):t}function Bn(e,t){var n,r,i,s,o={},u=0,a=e.dataTypes.slice(),f=a[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a[1])for(i in e.converters)o[i.toLowerCase()]=e.converters[i];for(;r=a[++u];)if("*"!==r){if("*"!==f&&f!==r){if(i=o[f+" "+r]||o["* "+r],!i)for(n in o)if(s=n.split(" "),s[1]===r&&(i=o[f+" "+s[0]]||o["* "+s[0]])){i===!0?i=o[n]:o[n]!==!0&&(r=s[0],a.splice(u--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(l){return{state:"parsererror",error:i?l:"No conversion from "+f+" to "+r}}}f=r}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Gn[t]||[]).concat(Gn["*"]),i=0,s=r.length;for(;s>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,s=0,o=Qn.length,u=b.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(tr(l,f.opts.specialEasing);o>s;s++)if(r=Qn[s].call(f,e,l,f.opts))return r;return Zn(f,l),b.isFunction(f.opts.start)&&f.opts.start.call(e,f),b.fx.timer(b.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(i in e)if(r=b.camelCase(i),s=t[r],n=e[i],b.isArray(n)&&(s=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),o=b.cssHooks[r],o&&"expand"in o){n=o.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=s)}else t[r]=s}function nr(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&nn(e);n.queue||(l=b._queueHooks(e,"fx"),null==l.unqueued&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,b.queue(e,"fx").length||l.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==an(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",b.support.shrinkWrapBlocks||h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in t)if(o=t[i],$n.exec(o)){if(delete t[i],a=a||"toggle"===o,o===(m?"hide":"show"))continue;v.push(i)}if(s=v.length){u=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in u&&(m=u.hidden),a&&(u.hidden=!m),m?b(e).show():h.done(function(){b(e).hide()}),h.done(function(){var t;b._removeData(e,"fxshow");for(t in d)b.style(e,t,d[t])});for(i=0;s>i;i++)r=v[i],f=h.createTween(r,m?u[r]:0),d[r]=u[r]||b.style(e,r),r in u||(u[r]=f.start,m&&(f.end=f.start,f.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function sr(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.document,o=e.location,u=e.jQuery,a=e.$,f={},l=[],c="1.9.1",h=l.concat,p=l.push,d=l.slice,v=l.indexOf,m=f.toString,g=f.hasOwnProperty,y=c.trim,b=function(e,t){return new b.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,E=/\S+/g,S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,N=/^[\],:{}\s]*$/,C=/(?:^|:|,)(?:\s*\[)+/g,k=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,L=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,A=/^-ms-/,O=/-([\da-z])/gi,M=function(e,t){return t.toUpperCase()},_=function(e){(s.addEventListener||"load"===e.type||"complete"===s.readyState)&&(D(),b.ready())},D=function(){s.addEventListener?(s.removeEventListener("DOMContentLoaded",_,!1),e.removeEventListener("load",_,!1)):(s.detachEvent("onreadystatechange",_),e.detachEvent("onload",_))};b.fn=b.prototype={jquery:c,constructor:b,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:x.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:s,!0)),T.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(o=s.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=s,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return d.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:p,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),"object"==typeof u||b.isFunction(u)||(u={}),f===a&&(u=this,--a);f>a;a++)if(null!=(s=arguments[a]))for(i in s)e=u[i],r=s[i],u!==r&&(l&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,o=e&&b.isArray(e)?e:[]):o=e&&b.isPlainObject(e)?e:{},u[i]=b.extend(l,o,r)):r!==t&&(u[i]=r));return u},b.extend({noConflict:function(t){return e.$===b&&(e.$=a),t&&e.jQuery===b&&(e.jQuery=u),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!s.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(s,[b]),b.fn.trigger&&b(s).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?f[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||g.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||s;var r=T.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&N.test(n.replace(k,"@").replace(L,"]").replace(C,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(A,"ms-").replace(O,M)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=P(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:y&&!y.call("﻿ ")?function(e){return null==e?"":y.call(e)}:function(e){return null==e?"":(e+"").replace(S,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(P(Object(e))?b.merge(n,"string"==typeof e?[e]:e):p.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(v)return v.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if("number"==typeof r)for(;r>s;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;for(n=!!n;o>s;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=P(e),u=[];if(o)for(;s>i;i++)r=t(e[i],i,n),null!=r&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(u[u.length]=r);return h.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return"string"==typeof n&&(s=e[n],n=e,e=s),b.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(n||this,r.concat(d.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===b.type(r)){s=!0;for(a in r)b.access(e,n,a,r[a],!0,o,u)}else if(i!==t&&(s=!0,b.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(b(e),n)})),n))for(;f>a;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)));return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===s.readyState)setTimeout(b.ready);else if(s.addEventListener)s.addEventListener("DOMContentLoaded",_,!1),e.addEventListener("load",_,!1);else{s.attachEvent("onreadystatechange",_),e.attachEvent("onload",_);var r=!1;try{r=null==e.frameElement&&s.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}D(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){f["[object "+t+"]"]=t.toLowerCase()}),r=b(s);var H={};b.Callbacks=function(e){e="string"==typeof e?H[e]||B(e):b.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){for(r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;a&&s>o;o++)if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,a,r))>-1)a.splice(r,1),n&&(s>=r&&s--,o>=r&&o--)}),this},has:function(e){return e?b.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],this},disable:function(){return a=f=r=t,this},disabled:function(){return!a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!a||i&&!f||(n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,s){var o=s[0],u=b.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,s=1===i?e:b.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1)for(u=Array(r),a=Array(r),f=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i;return i||s.resolveWith(f,n),s.promise()}}),b.support=function(){var t,n,r,o,u,a,f,l,c,h,p=s.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0],!n||!r||!n.length)return{};u=s.createElement("select"),f=u.appendChild(s.createElement("option")),o=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==p.className,leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!o.value,optSelected:f.selected,enctype:!!s.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==s.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===s.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}o=s.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),a=s.createDocumentFragment(),a.appendChild(o),t.appendChecked=o.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1;return p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===p.style.backgroundClip,b(function(){var n,r,o,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=s.getElementsByTagName("body")[0];a&&(n=s.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=p.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=c&&0===o[0].offsetHeight,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===p.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width,r=p.appendChild(s.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===p.offsetWidth,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==p.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=o=r=null)}),n=u=a=f=r=o=null,t}();var j=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,F=/([A-Z])/g;b.extend({cache:{},expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!U(e)},data:function(e,t,n){return I(e,t,n)},removeData:function(e,t){return q(e,t)},_data:function(e,t,n){return I(e,t,n,!0)},_removeData:function(e,t){return q(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,s=this[0],o=0,u=null;if(e===t){if(this.length&&(u=b.data(s),1===s.nodeType&&!b._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>o;o++)i=r[o].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),R(s,i,u[i]));b._data(s,"parsedAttrs",!0)}return u}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?s?R(s,e,b.data(s,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),s=b._queueHooks(e,t),o=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),s.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=b.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(u--)r=b._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var z,W,X=/[\t\r\n]/g,V=/\r/g,$=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,K=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Q=/^(?:checked|selected)$/i,G=b.support.getSetAttribute,Y=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){s=0;while(i=t[s++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var s,o=0,u=b(this),a=t,f=e.match(E)||[];while(s=f[o++])a=r?a:!u.hasClass(s),u[a?"addClass":"removeClass"](s)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(arguments.length)return i=b.isFunction(e),this.each(function(n){var s,o=b(this);1===this.nodeType&&(s=i?e.call(this,n,o.val()):e,null==s?s="":"number"==typeof s?s+="":b.isArray(s)&&(s=b.map(s,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,s,"value")!==t||(this.value=s))});if(s)return r=b.valHooks[s.type]||b.valHooks[s.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,"string"==typeof n?n.replace(V,""):null==n?"":n)}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;for(;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var s,o,u,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return typeof e.getAttribute===i?b.prop(e,n,r):(o=1!==a||!b.isXMLDoc(e),o&&(n=n.toLowerCase(),s=b.attrHooks[n]||(K.test(n)?W:z)),r===t?s&&o&&"get"in s&&null!==(u=s.get(e,n))?u:(typeof e.getAttribute!==i&&(u=e.getAttribute(n)),null==u?t:u):null!==r?s&&o&&"set"in s&&(u=s.set(e,r,n))!==t?u:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(E);if(s&&1===e.nodeType)while(n=s[i++])r=b.propFix[n]||n,K.test(n)?!G&&Q.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(G?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!b.isXMLDoc(e),o&&(n=b.propFix[n]||n,s=b.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&null!==(i=s.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):$.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:t}}}}),W={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),s="boolean"==typeof r?Y&&G?null!=i:Q.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},Y&&G||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),G||(z=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:z.get,set:function(e,t,n){z.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;b.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=b._data(e);if(y){r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=b.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(E)||[""],f=n.length;while(f--)u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),c=b.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=b.event.special[v]||{},p=b.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&b.expr.match.needsContext.test(o),namespace:m.join(".")},l),(d=a[v])||(d=a[v]=[],d.delegateCount=0,c.setup&&c.setup.call(e,s,m,h)!==!1||(e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h))),c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),b.event.global[v]=!0;e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=b.hasData(e)&&b._data(e);if(m&&(l=m.events)){t=(t||"").match(E)||[""],f=t.length;while(f--)if(u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort(),p){c=b.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],!i&&v!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&(c.teardown&&c.teardown.call(e,d,m.handle)!==!1||b.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)b.event.remove(e,p+t[f],n,r,!0);b.isEmptyObject(l)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,o){var u,a,f,l,c,h,p,d=[i||s],v=g.call(n,"type")?n.type:n,m=g.call(n,"namespace")?n.namespace.split("."):[];if(f=h=i=i||s,3!==i.nodeType&&8!==i.nodeType&&!nt.test(v+b.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=0>v.indexOf(":")&&"on"+v,n=n[b.expando]?n:new b.Event(v,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),c=b.event.special[v]||{},o||!c.trigger||c.trigger.apply(i,r)!==!1)){if(!o&&!c.noBubble&&!b.isWindow(i)){for(l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);f;f=f.parentNode)d.push(f),h=f;h===(i.ownerDocument||s)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped())n.type=p>1?l:c.bindType||v,u=(b._data(f,"events")||{})[n.type]&&b._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&b.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault();if(n.type=v,!(o||n.isDefaultPrevented()||c._default&&c._default.apply(i.ownerDocument,r)!==!1||"click"===v&&b.nodeName(i,"a")||!b.acceptData(i)||!a||!i[v]||b.isWindow(i))){h=i[a],h&&(i[a]=null),b.event.triggered=v;try{i[v]()}catch(y){}b.event.triggered=t,h&&(i[a]=h)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,s,o,u=[],a=d.call(arguments),f=(b._data(this,"events")||{})[e.type]||[],l=b.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=b.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!=this;f=f.parentNode||this)if(1===f.nodeType&&(f.disabled!==!0||"click"!==e.type)){for(s=[],o=0;a>o;o++)i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?b(r,this).index(f)>=0:b.find(r,this,null,[f]).length),s[r]&&s.push(i);s.length&&u.push({elem:f,handlers:s})}return n.length>a&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,o=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new b.Event(o),t=r.length;while(t--)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||s),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,u=n.button,a=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||s,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),e.which||u===t||(e.which=1&u?1:2&u?3:4&u?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==s.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===s.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=s.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!b.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&s.addEventListener(e,r,!0)},teardown:function(){0===--n&&s.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(o in e)this.on(o,n,r,e[o],s);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=st;else if(!i)return this;return 1===s&&(u=i,i=function(e){return b().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,n,e[s]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=st),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){function rt(e){return J.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function st(e){return e[w]=!0,e}function ot(e){var t=c.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function ut(e,t,n,r){var i,s,o,u,a,f,h,v,m,y;if((t?t.ownerDocument||t:E)!==c&&l(t),t=t||c,n=n||[],!e||"string"!=typeof e)return n;if(1!==(u=t.nodeType)&&9!==u)return[];if(!p&&!r){if(i=K.exec(e))if(o=i[1]){if(9===u){if(s=t.getElementById(o),!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return _.apply(n,D.call(t.getElementsByTagName(e),0)),n;if((o=i[3])&&S.getByClassName&&t.getElementsByClassName)return _.apply(n,D.call(t.getElementsByClassName(o),0)),n}if(S.qsa&&!d.test(e)){if(h=!0,v=w,m=t,y=9===u&&e,1===u&&"object"!==t.nodeName.toLowerCase()){f=ht(e),(h=t.getAttribute("id"))?v=h.replace(Y,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+pt(f[a]);m=$.test(e)&&t.parentNode||t,y=f.join(",")}if(y)try{return _.apply(n,D.call(m.querySelectorAll(y),0)),n}catch(b){}finally{h||t.removeAttribute("id")}}}return Et(e.replace(R,"$1"),t,n,r)}function at(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e,t){var n,r,s,o,u,a,f,l=C[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){(!n||(r=U.exec(u)))&&(r&&(u=u.slice(r[0].length)||u),a.push(s=[])),n=!1,(r=z.exec(u))&&(n=r.shift(),s.push({value:n,type:r[0].replace(R," ")}),u=u.slice(n.length));for(o in i.filter)!(r=V[o].exec(u))||f[o]&&!(r=f[o](r))||(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ut.error(e):C(e,a).slice(0)}function pt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function dt(e,t,n){var i=t.dir,s=n&&"parentNode"===i,o=T++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=x+" "+o;if(u){while(t=t[i])if((1===t.nodeType||s)&&e(t,n,u))return!0}else while(t=t[i])if(1===t.nodeType||s)if(l=t[w]||(t[w]={}),(f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else if(f=l[i]=[c],f[1]=e(t,n,u)||r,f[1]===!0)return!0}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=null!=t;for(;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function gt(e,t,n,r,i,s){return r&&!r[w]&&(r=gt(r)),i&&!i[w]&&(i=gt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:mt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=mt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=mt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function yt(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,l=dt(function(e){return e===t},u,!0),c=dt(function(e){return P.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;s>a;a++)if(n=i.relative[e[a].type])h=[dt(vt(h),n)];else{if(n=i.filter[e[a].type].apply(null,e[a].matches),n[w]){for(r=++a;s>r;r++)if(i.relative[e[r].type])break;return gt(a>1&&vt(h),a>1&&pt(e.slice(0,a-1)).replace(R,"$1"),n,r>a&&yt(e.slice(a,r)),s>r&&yt(e=e.slice(r)),s>r&&pt(e))}h.push(n)}return vt(h)}function bt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,a,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=null!=p,S=f,T=u||o&&i.find.TAG("*",p&&a.parentNode||a),N=x+=null==S?1:Math.random()||.1;for(E&&(f=a!==c&&a,r=n);null!=(d=T[b]);b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){h.push(d);break}E&&(x=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}if(y+=b,s&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)w[b]||g[b]||(g[b]=M.call(h));g=mt(g)}_.apply(h,g),E&&!u&&g.length>0&&y+t.length>1&&ut.uniqueSort(h)}return E&&(x=N,f=S),w};return s?st(u):u}function wt(e,t,n){var r=0,i=t.length;for(;i>r;r++)ut(e,t[r],n);return n}function Et(e,t,n,r){var s,o,a,f,l,c=ht(e);if(!r&&1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&!p&&i.relative[o[1].type]){if(t=i.find.ID(a.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(o.shift().value.length)}s=V.needsContext.test(e)?0:o.length;while(s--){if(a=o[s],i.relative[f=a.type])break;if((l=i.find[f])&&(r=l(a.matches[0].replace(et,tt),$.test(o[0].type)&&t.parentNode||t))){if(o.splice(s,1),e=r.length&&pt(o),!e)return _.apply(n,D.call(r,0)),n;break}}}return u(e,c)(r,t,p,n,$.test(e)),n}function St(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w="sizzle"+ -(new Date),E=e.document,S={},x=0,T=0,N=it(),C=it(),k=it(),L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.slice,P=O.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},H="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",j=B.replace("w","w#"),F="([*^$|!~]?=)",I="\\["+H+"*("+B+")"+H+"*(?:"+F+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+H+"*\\]",q=":("+B+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),U=RegExp("^"+H+"*,"+H+"*"),z=RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),W=RegExp(q),X=RegExp("^"+j+"$"),V={ID:RegExp("^#("+B+")"),CLASS:RegExp("^\\.("+B+")"),NAME:RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:RegExp("^("+B.replace("w","w*")+")"),ATTR:RegExp("^"+I),PSEUDO:RegExp("^"+q),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:RegExp("^"+H+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)","i")},$=/[\x20\t\r\n\f]*[+~]/,J=/^[^{]+\{\s*\[native code/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{D.call(E.documentElement.childNodes,0)[0].nodeType}catch(nt){D=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}o=ut.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},l=ut.setDocument=function(e){var n=e?e.ownerDocument||e:E;return n!==c&&9===n.nodeType&&n.documentElement?(c=n,h=n.documentElement,p=o(n),S.tagNameNoComments=ot(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.attributes=ot(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),S.getByClassName=ot(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),S.getByName=ot(function(e){e.id=w+0,e.innerHTML="<a name='"+w+"'></a><div name='"+w+"'></div>",h.insertBefore(e,h.firstChild);var t=n.getElementsByName&&n.getElementsByName(w).length===2+n.getElementsByName(w+0).length;return S.getIdNotName=!n.getElementById(w),h.removeChild(e),t}),i.attrHandle=ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},S.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&!p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&!p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=S.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==L?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},i.find.NAME=S.getByName&&function(e,n){return typeof n.getElementsByName!==L?n.getElementsByName(name):t},i.find.CLASS=S.getByClassName&&function(e,n){return typeof n.getElementsByClassName===L||p?t:n.getElementsByClassName(e)},v=[],d=[":focus"],(S.qsa=rt(n.querySelectorAll))&&(ot(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&d.push("[*^$]="+H+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(S.matchesSelector=rt(m=h.matchesSelector||h.mozMatchesSelector||h.webkitMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){S.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=RegExp(d.join("|")),v=RegExp(v.join("|")),g=rt(h.contains)||h.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},y=h.compareDocumentPosition?function(e,t){var r;return e===t?(a=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||g(E,e)?-1:t===n||g(E,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],f=[t];if(e===t)return a=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:0;if(s===o)return at(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)f.unshift(r);while(u[i]===f[i])i++;return i?at(u[i],f[i]):u[i]===E?-1:f[i]===E?1:0},a=!1,[0,0].sort(y),S.detectDuplicates=a,c):c},ut.matches=function(e,t){return ut(e,null,null,t)},ut.matchesSelector=function(e,t){if((e.ownerDocument||e)!==c&&l(e),t=t.replace(Z,"='$1']"),!(!S.matchesSelector||p||v&&v.test(t)||d.test(t)))try{var n=m.call(e,t);if(n||S.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return ut(t,c,null,[e]).length>0},ut.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ut.attr=function(e,t){var n;return(e.ownerDocument||e)!==c&&l(e),p||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):p||S.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},ut.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ut.uniqueSort=function(e){var t,n=[],r=1,i=0;if(a=!S.detectDuplicates,e.sort(y),a){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},s=ut.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},i=ut.selectors={cacheLength:50,createPseudo:st,match:V,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ut.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ut.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return V.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&W.test(n)&&(t=ht(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+H+")"+e+"("+H+"|$)"))&&N(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ut.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===x&&f[1],h=f[0]===x&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[x,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===x)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[x,h]),c===t))break;return h-=i,h===r||0===h%r&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ut.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=P.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:st(function(e){var t=[],n=[],r=u(e.replace(R,"$1"));return r[w]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return ut(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:st(function(e){return X.test(e||"")||ut.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[0>n?n+t:n]}),even:ct(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=lt(n);u=ut.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){t||(t=ht(e)),n=t.length;while(n--)s=yt(t[n]),s[w]?r.push(s):i.push(s);s=k(e,bt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,i.filters=St.prototype=i.pseudos,i.setFilters=new St,l(),ut.attr=b.attr,b.find=ut,b.expr=ut.selectors,b.expr[":"]=b.expr.pseudos,b.unique=ut.uniqueSort,b.text=ut.getText,b.isXMLDoc=ut.isXML,b.contains=ut.contains}(e);var ot=/Until$/,ut=/^(?:parents|prev(?:Until|All))/,at=/^.[^:#\[\.,]*$/,ft=b.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ht(this,e,!1))},filter:function(e){return this.pushStack(ht(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?ft.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(o?o.index(n)>-1:b.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return this.pushStack(s.length>1?b.unique(s):s)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return ot.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!lt[e]?b.unique(i):i,this.length>1&&ut.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&9!==s.nodeType&&(r===t||1!==s.nodeType||!b(s).is(r)))1===s.nodeType&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(s),Ot=At.appendChild(s.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(jt(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(jt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(vt,""):t;if(!("string"!=typeof e||St.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&gt.test(e)||Lt[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(yt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(jt(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=h.apply([],e);var i,s,o,u,a,f,l=0,c=this.length,p=this,d=c-1,v=e[0],m=b.isFunction(v);if(m||!(1>=c||"string"!=typeof v||b.support.checkClone)&&Tt.test(v))return this.each(function(i){var s=p.eq(i);m&&(e[0]=v.call(this,i,n?s.html():t)),s.domManip(e,n,r)});if(c&&(f=b.buildFragment(e,this[0].ownerDocument,!1,this),i=f.firstChild,1===f.childNodes.length&&(f=i),i)){for(n=n&&b.nodeName(i,"tr"),u=b.map(jt(f,"script"),_t),o=u.length;c>l;l++)s=f,l!==d&&(s=b.clone(s,!0,!0),o&&b.merge(u,jt(s,"script"))),r.call(n&&b.nodeName(this[l],"table")?Mt(this[l],"tbody"):this[l],s,l);if(o)for(a=u[u.length-1].ownerDocument,b.map(u,Dt),l=0;o>l;l++)s=u[l],Nt.test(s.type||"")&&!b._data(s,"globalEval")&&b.contains(a,s)&&(s.src?b.ajax({url:s.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((s.text||s.textContent||s.innerHTML||"").replace(kt,"")));f=i=null}return this}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],s=b(e),o=s.length-1;for(;o>=r;r++)n=r===o?this:this.clone(!0),b(s[r])[t](n),p.apply(i,n.get());return this.pushStack(i)}}),b.extend({clone:function(e,t,n){var r,i,s,o,u,a=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=jt(s),u=jt(e),o=0;null!=(i=u[o]);++o)r[o]&&Bt(i,r[o]);if(t)if(n)for(u=u||jt(e),r=r||jt(s),o=0;null!=(i=u[o]);o++)Ht(i,r[o]);else Ht(e,s);return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;c>d;d++)if(s=e[d],s||0===s)if("object"===b.type(s))b.merge(p,s.nodeType?[s]:s);else if(Et.test(s)){u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;if(!b.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0])),!b.support.tbody){s="table"!==a||wt.test(s)?"<table>"!==l[1]||wt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)b.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}b.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}else p.push(t.createTextNode(s));u&&h.removeChild(u),b.support.appendChecked||b.grep(jt(p,"input"),Ft),d=0;while(s=p[d++])if((!r||-1===b.inArray(s,r))&&(o=b.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u),n)){i=0;while(s=u[i++])Nt.test(s.type||"")&&n.push(s)}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=b.expando,f=b.cache,c=b.support.deleteExpando,h=b.event.special;for(;null!=(n=e[u]);u++)if((t||b.acceptData(n))&&(s=n[a],o=s&&f[s])){if(o.events)for(r in o.events)h[r]?b.event.remove(n,r):b.removeEvent(n,r,o.handle);f[s]&&(delete f[s],c?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,l.push(s))}}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=RegExp("^("+w+")(.*)$","i"),Jt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Kt=RegExp("^([+-])=("+w+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,s,o={},u=0;if(b.isArray(n)){for(s=qt(e),i=n.length;i>u;u++)o[n[u]]=b.css(e,n[u],!1,s);return o}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=b.camelCase(n),f=e.style;if(n=b.cssProps[a]||(b.cssProps[a]=tn(f,a)),u=b.cssHooks[n]||b.cssHooks[a],r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];if(o=typeof r,"string"===o&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(b.css(e,n)),o="number"),!(null==r||"number"===o&&isNaN(r)||("number"!==o||b.cssNumber[a]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(f[n]="inherit"),u&&"set"in u&&(r=u.set(e,r,i))===t)))try{f[n]=r}catch(l){}}},css:function(e,n,r,i){var s,o,u,a=b.camelCase(n);return n=b.cssProps[a]||(b.cssProps[a]=tn(e.style,a)),u=b.cssHooks[n]||b.cssHooks[a],u&&"get"in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),"normal"===o&&n in Yt&&(o=Yt[n]),""===r||r?(s=parseFloat(o),r===!0||b.isNumeric(s)?s||0:o):o},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(""!==a||b.contains(e.ownerDocument,e)||(a=b.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):s.documentElement.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return null==a&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left="fontSize"===n?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),""===a?"auto":a}),b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Gt,function(){return un(e,n,i)}):un(e,n,i):t},set:function(e,t,r){var i=r&&qt(e);return sn(e,t,r?on(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(s.replace(Ut,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Rt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Rt(e,n),Jt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},s="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=s[r]||s[r-2]||s[0];return i}},Vt.test(e)||(b.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],s=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){s(this.name,this.value)});else for(r in e)vn(r,e[r],n,s);return i.join("&").replace(ln,"+")},b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,gn,yn=b.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=b.fn.load,Ln={},An={},On="*/".concat("*");try{gn=o.href}catch(Mn){gn=s.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[],b.fn.load=function(e,n,r){if("string"!=typeof e&&kn)return kn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),u.length>0&&b.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,s){return b.isFunction(r)&&(s=s||i,i=r,r=t),b.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,b.ajaxSettings),t):Pn(b.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;2!==w&&(w=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,r&&(E=Hn(c,x,r)),e>=200&&300>e||304===e?(c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(b.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(b.etag[s]=S)),204===e?(l=!0,T="nocontent"):304===e?(l=!0,T="notmodified"):(l=Bn(c,E),T=l.state,g=l.data,y=l.error,l=!y)):(y=T,(e||!T)&&(T="error",0>e&&(e=0))),x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--b.active||b.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=b.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?b(h):b.event,d=b.Deferred(),v=b.Callbacks("once memory"),m=c.statusCode||{},g={},y={},w=0,S="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===w){if(!l){l={};while(t=Sn.exec(o))l[t[1].toLowerCase()]=t[2]}t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===w?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return w||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return w||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>w)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||S;return f&&f.abort(t),N(0,t),this}};if(d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=b.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=b.param(c.data,c.traditional)),Dn(Ln,c,n,x),2===w)return x;a=c.global,a&&0===b.active++&&b.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(b.lastModified[s]&&x.setRequestHeader("If-Modified-Since",b.lastModified[s]),b.etag[s]&&x.setRequestHeader("If-None-Match",b.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers)x.setRequestHeader(i,c.headers[i]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&2!==w){S="abort";for(i in{success:1,error:1,complete:1})x[i](c[i]);if(f=Dn(An,c,n,x)){x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{w=1,f.send(g,N)}catch(T){if(!(2>w))throw T;N(-1,T)}}else N(-1,"No Transport");return x}return x.abort()},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=s.head||b("head")[0]||s.documentElement;return{send:function(t,i){n=s.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||b.expando+"_"+yn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");return a||"jsonp"===n.dataTypes[0]?(s=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||b.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&b.isFunction(o)&&o(u[0]),u=o=t}),"script"):t});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In)In[e](t,!0)};b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&zn()||Wn()}:zn,qn=b.ajaxSettings.xhr(),b.support.cors=!!qn&&"withCredentials"in qn,qn=b.support.ajax=!!qn,qn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();if(n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async),n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||4===a.readyState))if(r=t,o&&(a.onreadystatechange=b.noop,Un&&delete In[o]),i)4!==a.readyState&&a.abort();else{c={},u=a.status,f=a.getAllResponseHeaders(),"string"==typeof a.responseText&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}u||!n.isLocal||n.crossDomain?1223===u&&(u=204):u=c.text?200:404}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?4===a.readyState?setTimeout(r):(o=++Rn,Un&&(In||(In={},b(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=Jn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){if(n=+s[2],r=s[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&u){u=b.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,b.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&1!==a&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}}),b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),s=b.speed(t,n,r),o=function(){var t=er(this,b.extend({},e),s);o.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=b.timers,o=b._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Kn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=b.timers,o=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Vn||(Vn=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Vn),Vn=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(u)return n=u.documentElement,b.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),s=i.offset(),o=b.css(e,"top"),u=b.css(e,"left"),a=("absolute"===r||"fixed"===r)&&b.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),b.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+c),null!=t.left&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||s.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,s){var o=sr(e);return s===t?o?n in o?o[n]:o.document.documentElement[i]:e[i]:(o?o.scrollTo(r?b(o).scrollLeft():s,r?s:b(o).scrollTop()):e[i]=s,t)},e,i,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return b.access(this,function(n,r,i){var s;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?b.css(n,r,u):b.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})}(window),define("underscore",[],function(){return function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=O(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),_}),define("json2",[],function(){return this.JSON||(this.JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)r=rep[n],typeof r=="string"&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),JSON}),define("backbone/backbone",["json2","underscore","jquery"],function(){return function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t)))continue;(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n)m[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){try{return e?decodeURIComponent(e):null}catch(t){return e}})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),Backbone}),define("backbone/cache",["jquery","underscore","./backbone"],function(e,t,n){var r=n.Model.prototype,i=t.clone(r);t.extend(n.Model,{cache:null}),t.extend(r,{fetch:function(n){n=n||{};var r=n.success||e.noop,s=n.removed||e.noop,o=n.error||e.noop,u=this.constructor,a=u.cache;a&&t.extend(n,{success:function(e,t,n){a.cache(e),r(e,t,n)},removed:function(e,t,n){a.markRemoved(e),s(e,t,n)},error:function(e,t,n){o(e,t,n)}}),i.fetch.call(this,n)},query:function(t){var n=t.success||e.noop,r=t.removed||e.noop,i=this.constructor,s=i.cache,o=null;if(!s){this.fetch(t);return}if(s.isRemoved(this)){r(this);return}o=s.get(this),o?n(o):this.fetch(t)}});var s=n.Collection.prototype,o=t.clone(s);return t.extend(s,{fetch:function(n){n=n||{};var r=n.success||e.noop,i=this.model,s=i.cache;s&&t.extend(n,{success:function(e,t,n){s.cache(e.models),r(e,t,n)}}),o.fetch.call(this,n)},query:function(n){var r=n.success||e.noop,i=this.model,s=i.cache,o=[],u=n.ids;if(!s){this.fetch(n);return}if(u){var a=[];u=t.isArray(u)?u:[u];for(var f=0,l=u.length;f<l;f++){var c=u[f],h=i.cache.getCachedById(c);h?o.push(h):a.push(c)}if(!a.length){r(i.cache.getCachedByIds(u));return}n.preIds=n.ids,n.ids=a}n.success=function(e,t,n){e.add(o),r(e,t,n)},this.fetch(n)}}),n}),define("backbone/sync",["jquery","underscore","./backbone"],function(e,t,n){return n.ajaxSync=n.sync,n.sync=function(r,i,s,o){var u=i.toJSON(),a={};(r=="update"||r=="create")&&t.each(s.changes,function(e,t){e&&(a[t]=u[t])});if(r=="read"){var f=s.success;s.success=function(t,n,r){r=r||{},o=r.error;if(!t||t.ret||t.res===!1){t=t||{},removed=s.removed||e.noop,s.removed&&s.removed(i,t,r);return}f(t,n,r)}}return s.data=t.extend({},a,s.data),n.ajaxSync.apply(this,[r,i,s,o])},n}),define("backbone",["jquery","underscore","./backbone/backbone","./backbone/cache","./backbone/sync"],function(e,t,n){return n.emulateHTTP=!1,n.emulateJSON=!0,n}),define("plugin/jquery.easydrag",["jquery"],function(e){(function(e){function d(r){if(t&&c[n.id]!="false")return e.updatePosition(r),i[n.id]!=undefined&&i[n.id](r,n),!1}function v(i){e("body").removeClass("none-select");if(t&&c[n.id]!="false")return t=!1,r[n.id]!=undefined&&r[n.id](i,n),!1}var t=!1,n=null,r={},i={},s={},o={},u,a,f,l,c={},h=!1,p=!1;e.getMousePosition=function(e){var t=0,n=0;if(!e)var e=window.event;if(e.pageX||e.pageY)t=e.pageX,n=e.pageY;else if(e.clientX||e.clientY)t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;return{x:t,y:n}},e.updatePosition=function(t){var r=e.getMousePosition(t),i=r.x-u,s=r.y-a,o=parseFloat(e(n).css("marginLeft"))||0,c=e(n).attr("canLeftMove"),h=e(n).attr("canTopMove"),p=e(n).attr("leftMin")==undefined?-1e4:e(n).attr("leftMin")*1,d=e(n).attr("leftMax")==undefined?1e4:e(n).attr("leftMax")*1,v=e(n).attr("minMovePosition")*1||0,m=l-o+i,g=f+s,y=0;v?(y=l-o,m<l?y+=Math.ceil(i/v)*v:y+=Math.floor(i/v)*v,c!=="false"&&m>=p&&m<=d&&e(n).css("left",y)):c!=="false"&&m>=p&&m<=d&&e(n).css("left",m),h!=="false"&&e(n).css("top",g)},e.fn.unBindEvent=function(){e(document).off("mousemove",d),e(document).off("mouseup",v),p=!1},e.fn.bindEvent=function(){p||(e(document).mousemove(d),e(document).mouseup(v),p=!0)},e.fn.beforeDrag=function(e){return this.each(function(){s[this.id]=e})},e.fn.ondrag=function(e){return this.each(function(){i[this.id]=e})},e.fn.ondrop=function(e){return this.each(function(){r[this.id]=e})},e.fn.dragOff=function(){return this.each(function(){c[this.id]="off"})},e.fn.dragOn=function(){return this.each(function(){c[this.id]="on"})},e.fn.setHandler=function(t){return this.each(function(){var n=this;o[this.id]=!0,e(n).css("cursor",""),c[n.id]="handler";var r;typeof t=="string"?r=e("#"+t):t.jquery&&(r=t),r.css("cursor","move"),r.mousedown(function(t){h=!0,e(n).trigger("mousedown",t)}),r.mouseup(function(e){h=!1})})},e.fn.easydrag_release=function(e){c[e]=undefined,r[e]=undefined,i[e]=undefined,s[e]=undefined},e.fn.easydrag=function(r,i){return i!==!1&&e.fn.bindEvent(),this.each(function(){if(undefined==this.id||!this.id.length)this.id="easydrag"+(new Date).getTime();o[this.id]=r?!0:!1,c[this.id]="on",e(this).css("cursor","move"),e(this).mousedown(function(i,p){p&&(i=e.extend({},p,i));if(!r&&i.target!=this)return;e("body").addClass("none-select");var d=!1;s&&s[this.id]&&s[this.id](i,n||this)&&(d=!0);if(d)return!0;if(c[this.id]=="off"||c[this.id]=="handler"&&!h)return o[this.id];e(this).css("position","absolute"),e(this).css("z-index",parseInt((new Date).getTime()/1e3)),t=!0,n=this;var v=e.getMousePosition(i);return u=v.x,a=v.y,f=this.offsetTop,l=this.offsetLeft,e.updatePosition(i),o[this.id]})})}})(e)}),define("plugin/dialog",["jquery","plugin/jquery.easydrag"],function(e){function f(e,t){this.dialog=e,this.config=t,this.create()}function c(t){o++,i++,h.gZIndex=i,t=t||{},this.options=e.extend(!0,{id:"dialog_"+o,group:!1,width:"",fixed:!0,dialogClass:"",header:"",content:"",close:!0,hide:!1,iframe:!1,onClose:function(){},onYes:function(){},autoClose:!1,overlayer:{clickClose:!0,opacity:.4},template:{dialog_container:'<div class="popup" dialog-role="container"></div>',dialog_header:'<div class="hd" dialog-role="header"></div>',dialog_body:'<div class="bd" dialog-role="body"></div>',dialog_close:'<div class="close3Btn" dialog-role="close"></div>',dialog_iframe:"<iframe frameborder='0' marginheight='0' marginwidth='0' width='100%' scrolling='auto' style='background:#fff;border:none;'></iframe>"}},t),this.create(),this.bindEvents()}var t=e(window),n=e(document),r=e(document.body);e(document).ready(function(){t=e(window),n=e(document),r=e(document.body)});var i=1e4,s=i,o=1e3,u=function(){return!1}(),a={exist:!1,dialogs:[],getId:function(){return"dialog_overlayer"},getHtml:function(){var e="<div id='"+this.getId()+"' class='popup-overlayer'></div>";return e},create:function(t,n){this.dialogs.push(t),window.top!=window.self?n.opacity=0:"";if(this.exist){n.opacity!=undefined&&this.el.css("opacity",n.opacity);return}this.el=e(this.getHtml()),n.opacity!=undefined&&this.el.css("opacity",n.opacity),u&&this.hideSelect(),r.append(this.el),this.setEvent(),this.exist=!0},hideSelect:function(){this.hide_select=e("select:visible"),this.hide_select.hide()},showSelect:function(){this.hide_select&&this.hide_select.show()},open:function(t){this.el.css({zIndex:s}).height(e(document).height()),this.el.show(),console.log(this.el.get(0)),t&&t.opacity!=undefined&&this.el.css("opacity",t.opacity)},close:function(e){for(var t=0;t<this.dialogs.length;t++)if(this.dialogs[t].id==e.id){this.dialogs.splice(t,1);break}this.dialogs.length<=0&&(this.el.hide(),u&&this.showSelect())},setEvent:function(){var e=this;this.el.click(function(){var t=e.dialogs[e.dialogs.length-1];t&&t.overlayer&&t.overlayer.config&&t.overlayer.config.clickClose&&t.close()})}};f.prototype.create=function(){a.create(this.dialog,this.config)},f.prototype.open=function(e){a.open(e)},f.prototype.close=function(){a.close(this.dialog)};var l={groups:{},add:function(e,t){this.groups[e]&&this.groups[e].close(),this.groups[e]=t},del:function(e,t){this.groups[e]&&this.groups[e].id==t&&delete this.groups[e]}};c.prototype.setDrop=function(t,n){var r=i,s=this;t.beforeDrag(function(e){if(t.hasClass("fixed")){var n=t.offset().top;t.removeClass("fixed"),t.css("top",n)}}),t.ondrop(function(){t.css("zIndex",r);if(s.options.fixed){var n=t.offset().top,i=e(document).scrollTop();t.addClass("fixed"),t.css("top",n-i),t.css("position","")}}),t.ondrag(function(n,r){var i=t.position(),s=i.top,o=i.left,u=t.height(),a=t.width(),f=e(document).scrollTop(),l=e(window),c=l.height(),h=l.width();s<=f&&t.css("top",f),s-f>=c-u&&t.css("top",f+c-u),o<=0&&t.css("left",0),o+a>=h-3&&t.css("left",h-a-3)}),t.easydrag(),t.setHandler(n)},c.prototype.create=function(){var t=this.options,n=t.template,s=e(n.dialog_container);s.css("zIndex",i),s.attr("id",t.id);if(t.header){var o=e(n.dialog_header).html(t.header);s.append(o),t.noheadDrop||this.setDrop(s,o)}t.content&&(s.append(e(n.dialog_body)),s.find("[dialog-role=body]").html(t.content)),t.close&&s.append(n.dialog_close),t.width&&s.css({width:t.width}),t.height?s.css({height:t.height}):s.css({height:"auto"}),t.dialogClass&&s.addClass(t.dialogClass),t.overlayer&&!e.isEmptyObject(t.overlayer)&&(this.overlayer=new f(this,t.overlayer)),r.append(s),this.$el=s},c.prototype.getEl=function(){return this.$el},c.prototype.setHeader=function(e){this.$el.find("[dialog-role=header]").text(e)},c.prototype.setContent=function(e){this.$el.find("[dialog-role=body]").text(e),this.setPosition()},c.prototype.open=function(){var n=this.options,r=this;n.group&&l.add(n.group,r),r.setHeight(),r.setPosition(),r.$el.hide(),r.setAutoClose(),r.overlayer&&r.overlayer.open(this.overlayer.config);if(n.fade)r.$el.css({opacity:0}).show().animate({opacity:1},200,function(){r.$el.find(".confirmBtn").focus()});else{var i=this.$el.css("top");r.$el.css("top",e(window).height()),r.$el.show(),r.$el.animate({top:i},200,function(){r.$el.find(".confirmBtn").focus()})}t.bind("resize",r,r.windowResize),r.closed=!1,window.focus()},c.prototype.setHeight=function(){this.options.iframe&&(this.$el.find("iframe").height(this.options.height).width(this.options.width),this.$el.css("width","auto"))},c.prototype.setAutoClose=function(){if(this.options.autoClose){var e=this;this.closeTimer=setTimeout(function(){e.close()},this.options.autoClose)}},c.prototype.setWidth=function(e){this.$el.css({width:e+"px"})},c.prototype.windowResize=function(e){e.data.setPosition()},c.prototype.setPosition=function(){var r=(t.width()-this.$el.outerWidth())/2,i=(t.height()-this.$el.outerHeight())/2;r=r>20?r:20,i=i>20?i:20,window.top!=window.self&&(i=(e(window.top).height()-this.$el.outerHeight()*3)/2+e(window.top).scrollTop(),i<=0&&(i=0));var s={};this.options.fixed?(s.left=r,u||(s.top=i),this.$el.addClass("fixed")):(s={left:n.scrollLeft()+r,top:n.scrollTop()+i},this.$el.removeClass("fixed")),this.$el.stop().css(s)},c.prototype.bindEvents=function(){var e=this;this.$el.on("click","[dialog-role=close]",function(){return e.close(),!1}),this.$el.on("click","[dialog-role=yes]",function(){return e.yesFn(),!1}),this.$el.on("click","[dialog-role=cancel]",function(){return e.close(),e.cancelFn(),!1})},c.prototype.cancelFn=function(){var t=this.options;t.onCancel&&e.isFunction(t.onCancel)&&t.onCancel.call(this)},c.prototype.yesFn=function(){var t=this.options,n=this;t.onYes&&e.isFunction(t.onYes)&&t.onYes.call(this)!==!1&&n.close()},c.prototype.unbindEvents=function(){t.unbind("resize",this.windowResize),this.$el.off(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)},c.prototype.close=function(){if(this.closed)return;var t=this.options,n=this;t.onClose&&e.isFunction(t.onClose)&&t.onClose.call(this),t.group&&l.del(t.group,t.id),this.overlayer&&this.overlayer.close(),this.closed=!0;if(t.hide)if(t.fade)this.$el.animate({opacity:0},function(){n.$el.hide()});else{var r=e(window).height();this.$el.animate({top:r},200,"swing",function(){n.$el.hide()})}else this.unbindEvents(),t.fade?this.$el.animate({opacity:0},function(){n.$el.remove()}):this.$el.animate({top:e(window).height()},200,function(){n.$el.remove()})};var h={};return h.Dialog=c,h.success=function(t,n){var r=e.extend({content:t||"操作成功",dialogClass:"msg2",close:!1,autoClose:1e3,fade:!0,overlayer:{opacity:0},template:{dialog_container:'<div class="msg2" dialog-role="container"></div>',dialog_body:"<span dialog-role='body'></span>"}},n),i=new c(r);i.open()},h.warn=function(t,n){h.alert(t,n);return;var r,i},h.alert=function(t,n){n=n||{};var r='<div class="msg_title">'+(t||"")+"</div>"+' <div class="operate"><a href="javascript:;" class="confirmBtn" dialog-role="yes">'+(n.yesText||"确定")+"</a></div>",i=e.extend({content:r,close:!1,dialogClass:"msg msg_alert",overlayer:{clickClose:!1},onYes:function(){this.close(),n.callback&&n.callback()}},n),s=new c(i);s.open();var o=s.getEl();o.focus();var u=function(t){if(t.keyCode==13)return e(document).off("keypress",u),s.close(),n.callback&&n.callback(),!1};e(document).on("keypress",u)},h.confirm=function(t,n,r){n=n||e.noop,r=r||{};var i=['<a href="javascript:;" class="confirmBtn" dialog-role="yes">'+(r.yesText||"确定")+"</a>",'<a href="javascript:;" class="cancelBtn" dialog-role="cancel">'+(r.cancelText||"取消")+"</a>"],s='<div class="msg_title">'+(t||"您确定要这样做么？")+"</div>"+'<div class="operate">';r.reverse?s+=i.reverse().join("")+"</div>":s+=i.join("")+"</div>",r.checkbox&&(s+='<div class="msg_noprompt"><input type="checkbox"><label>'+r.checkbox+"</label></div>");var o=e.extend({content:s,dialogClass:"msg msg_confirm",close:!1,overlayer:{clickClose:!1},callback:e.noop,onYes:function(){var e=!1;r.checkbox&&(e=!!a.find("input[type=checkbox]")[0].checked),n(e),o.callback(e)},onCancel:function(){r.cancel&&r.cancel()}},r),u=new c(o),a=u.getEl();u.open()},h}),define("helper",["underscore","backbone","jquery","plugin/dialog"],function(e,t,n,r){function o(e,t,n){this.tasks=[],this.isActived=!1,this.processFn=e,this.callback=t||function(){},this.context=n||this}function h(e){this.id=++h.logIndex,this.text=e,h.logs[this.id]=this}function m(e){d.find(".j-userinfo-nickname").text(e.nickname),d.find(".j-userinfo-userface").attr("src",e.logoPic60||e.logoPic),d.find(".j-userinfo-homepage").attr("href","/"+e.uid+"/profile"),d.find(".j-userinfo-fans").attr("href","/"+e.uid+"/fans/"),v.hide(),d.show()}function g(){d.hide(),v.show()}function y(e,t){n.ajax({url:"/main/get_current_user",dataType:"json",async:!1,success:function(e){if(e.res){var n=e.current_user;window.current_user=n,config.CURRENT_USER=n,t(n)}}})}function b(){if(helper.isLogin()){var e=helper.getCurrentUserId(),t=!window.current_user.uid,n=window.current_user.uid!=e;t||n?y(e,function(e){m(e)}):m(window.current_user)}else g()}function E(){w&&clearTimeout(w),helper.isWindowBusy(!0),w=setTimeout(function(){helper.isWindowBusy(!1)},50)}window._id=(new Date).getTime();var i,s;jQuery.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(2345)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],n=/(2345).*?/.test(e),r=/(Trident).*(QQBrowser).*?/i.test(e),i=/(Trident).*?/i.test(e);return{Is2345:n,isQQBrowserIE:r,isTrident:i,browser:t[1]||"",version:t[2]||"0"}},jQuery.cookie=function(e,t,r){if(typeof t=="undefined"){var f=null;if(document.cookie&&document.cookie!=""){var l=document.cookie.split(";");for(var c=0;c<l.length;c++){var h=jQuery.trim(l[c]);if(h.substring(0,e.length+1)==e+"="){f=decodeURIComponent(h.substring(e.length+1));break}}}return f}r=r||{},t===null&&(t="",r=n.extend({},r),r.expires=-1);var i="";if(r.expires&&(typeof r.expires=="number"||r.expires.toUTCString)){var s;typeof r.expires=="number"?(s=new Date,s.setTime(s.getTime()+r.expires*1e3)):s=r.expires,i="; expires="+s.toUTCString()}var o=r.path?"; path="+r.path:"",u=r.domain?"; domain="+r.domain:"",a=r.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),i,o,u,a].join("")},i=jQuery.uaMatch(navigator.userAgent),s={},o.prototype={append:function(e){this.tasks.push(e),this.on()},on:function(){this.isActived||(this.isActived=!0,this.todo())},off:function(){this.isActived=!1},todo:function(){var e=this;setTimeout(function(){var t=+(new Date),n=e.tasks;do e.processFn.apply(e.context,e.tasks.shift());while(n.length>0&&+(new Date)-t<50);n.length>0?setTimeout(arguments.callee,25):(e.callback(),e.off())},25)}};var u={track:{30:"mobile_small",100:"web_meduim",180:"web_large","180n":"web_explore",60:"mobile_small",86:"mobile_small",640:"mobile_large","640n":"large_pop"},header:{16:"web_small",30:"web_small",60:"common_medium",86:"mobile_small",100:"web_large",110:"web_large",180:"web_x_large",200:"web_x_large",290:"mobile_large",640:"mobile_x_large"},album:{30:"web_small",86:"mobile_small",100:"web_meduim",140:"mobile_medium",180:"web_large",290:"mobile_large","640n":"large_pop"}};i.browser&&(s[i.browser]=!0,s.version=i.version,s.b2345=i.Is2345,s.isQQBrowserIE=i.isQQBrowserIE,s.isTrident=i.isTrident),n.browser||(n.browser=s);var a=/android/gi.test(navigator.appVersion),f=/iphone|ipad|ipod/gi.test(navigator.appVersion),l=/hp-tablet/gi.test(navigator.appVersion),c=f||l;h.logs={},h.logIndex=0,h.getLogText=function(e){return h.logs[e].text},window.current_user={logoPic60:"http://static2.dev.ximalaya.com/css/img/common/default/user60.jpg?v="};var p=n(".sub-header"),d=p.find(".info"),v=p.find(".login-wrapper");window.helper={ErrorLog:h,browser:s,isAndroid:a,isIDevice:f,isTouchPad:l,hasTouch:c,RESIZE_EV:"onorientationchange"in window?"orientationchange":"resize",START_EV:c?"touchstart":"mousedown",START_CLICK_EV:c?"touchstart":"click",MOVE_EV:c?"touchmove":"mousemove",END_EV:c?"touchend":"mouseup",CANCEL_EV:c?"touchcancel":"mouseup",loading:{start:function(e){var t=n(e);return(t.attr("loadding")&&!0)===!0?!1:(t.attr("txt",t.text()),t.html("&nbsp;"),t.attr("loadding",!0),t.spin("tiny"),!0)},end:function(e){var t=n(e);t.text(t.attr("txt")),t.removeAttr("loadding"),t.spin("stop")}},refreshCurrentUser:b,escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;")},getEvents:function(t){var n=this,r={};return e.each(t,function(e,t){t=t.replace("START_EV",n.START_EV).replace("MOVE_EV",n.MOVE_EV).replace("END_EV",n.END_EV).replace("CANCEL_EV",n.CANCEL_EV),r[t]=e}),r},scrollTop:function(){this.browser.mozilla?n("html").animate({scrollTop:0},120):n("body").animate({scrollTop:0},120)},doChangeOptions:function(e,t){var n=JSON.stringify(t);n=n.substring(1,n.length-1),e.attr("data-options",n)},getTime:function(e,t){var n=Math.floor(e/1e3),r=Math.floor(n/60),i=Math.floor(r/60),s=n-r*60;return r-=i*60,t?{min:r,sec:s,hour:i}:(i?i+":":"")+((r<10?"0"+r:r)+":"+(s<10?"0"+s:s))},doCheckVersion:function(){var e=Number(helper.browser.version);n(".upgradePrompt ").remove(),helper.browser.msie&&!isNaN(e)&&(e<8?(e!=7||s.b2345!==!0)&&r.alert("系统检测到您的浏览器版本("+e+")过低,请升级至IE7.0以上，或使用Chrome、Firefox、safari、搜狗高速模式等浏览器！",{width:"300px"}):document.documentMode&&document.documentMode<8&&r.alert("请调整IE文档模式为IE8或以上！"))},cookie:{addCookie:function(e,t,n){var r=e+"="+escape(t);if(n>0){var i=new Date,s=n*3600*1e3;i.setTime(i.getTime()+s),r+="; expires="+i.toGMTString()}document.cookie=r+";path=/"},getCookie:function(e){var t=document.cookie.split("; ");for(var n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]==e)return unescape(r[1])}},delCookie:function(e){document.cookie=e+"=;expires="+(new Date(0)).toGMTString()}},login:function(e,t,r){window._hmt&&t&&_hmt.push(["_trackEvent",t,"click"]);var i="gLoginCallback",s=560,o=760,u=n(window),a=u.height(),f=u.width(),l=(f-o)/2,c=(a-s)/2;l=l>0?l:0,c=c>0?c:0;var h="height="+s+",width="+o+",left="+l+",top="+c;window.open("/passport/auth/"+e+"/authorize?customerFunction="+i,"",h),window[i]=function(e){r?r(e):window.location.reload(),window[i]=null}},isLogin:function(){var e=config.TOKEN_LABEL;return!!n.cookie(e)},isLogout:function(){return!this.isLogin()},getCurrentUserId:function(){var e=config.TOKEN_LABEL,t=n.cookie(e);return t?t.split("&")[0]:""},getCurrentUserToken:function(){var e=config.TOKEN_LABEL,t=n.cookie(e);return t?t.split("&")[1]:""},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=n.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},gblen:function(e){return n.trim(e).replace(/[^\x00-\xff]/ig,"xx").length},cutString:function(e,t,n){var r="",i=0;for(var s=0;s<e.length;s++)e.charCodeAt(s)>127||e.charCodeAt(s)==94?i+=2:i++;if(i<=t)return e;i=0,n=n||"",t=t>this.gblen(n)?t-this.gblen(n):t;for(var s=0;s<e.length;s++){e.charCodeAt(s)>127||e.charCodeAt(s)==94?i+=2:i++;if(i>t){r+=n;break}r+=e.charAt(s)}return r},strFormat:function(e){var t=[].slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})},getDateNiceTime:function(e){if(!e)return"";var t=new Date,n=(new Date(e)).getTime(),r=t.getTime()-config.TIME_GAP-n,i=Math.floor(r/1e3),s=Math.floor(i/60),o=Math.floor(s/60),u=Math.floor(o/24),a=Math.floor(u/30),f=Math.floor(a/12);return i=i<0?0:i,s=s<0?0:s,o=o<0?0:o,u=u<0?0:u,a=a<0?0:a,f=f<0?0:f,f?f+"年前":a?a+"月前":u?u+"天前":o?o+"小时前":s?s+"分钟前":"刚刚"},getNiceTime:function(e){if(!e)return"";var t=new Date,n=typeof e=="number"?e:(new this.datetrans(e)).trans().date.getTime(),r=t.getTime()-config.TIME_GAP-n,i=Math.floor(r/1e3),s=Math.floor(i/60),o=Math.floor(s/60),u=Math.floor(o/24),a=Math.floor(u/30),f=Math.floor(a/12);return i=i<0?0:i,s=s<0?0:s,o=o<0?0:o,u=u<0?0:u,a=a<0?0:a,f=f<0?0:f,f?f+"年前":a?a+"月前":u?u+"天前":o?o+"小时前":s?s+"分钟前":"刚刚"},datetrans:function(e){this.trans=function(){var t=this.getDateInfo(e),n=this.getDateInfo((new Date).toString()),r=t.date.getTime()/1e3+(t.utc-n.utc)*3600;return{unix:r*1e3,date:new Date(r*1e3)}},this.getDateInfo=function(e){var t=new RegExp("[+|-]\\d{2}:\\d{2}","g"),n=e.match(t),r=null,i=null,s=0,o=0;return n!=null?(e=e.replace(n,""),e=e.replace(/T/g," "),e=e.replace(/-/g,"/"),r=new Date(e),i=n[0].split(":"),s=i[0]*1,o=i[1]/60):(t=new RegExp("[+|-]\\d{2}\\d{2}","g"),n=e.match(t),n!=null&&(i=n[0],s=i.substr(1,2)*1,o=i.substr(4,2)/60)),s<0&&(o*=-1),i=s+o,{date:r,utc:i}}},getFDFSPath:function(e,t,n,r){if(!e){r=r||n;switch(t){case"album":e="css/img/common/album_"+r+".jpg";break;case"header":e="css/img/common/default/user"+r+".jpg";break;case"track":e="css/img/common/track_"+r+".jpg";break;default:return""}return config.STATIC_PATH+"/"+e}var i=e.match(/^http:\/\//);if(i&&i.length)return e;n=n||"";if(u[t]&&u[t][n]){var s=e.lastIndexOf(".");e=e.substring(0,s)+"_"+u[t][n]+e.substring(s)}return config.FDFS_PATH+"/"+e},scrollTo1:function(e,t){n("html, body").animate({scrollTop:e+t},120)},scrollTo:function(e,t){var r=e.offset().top+e.scrollTop()+(t||0);n("html, body").animate({scrollTop:r},100)},sortObjectKeys:function(t){var n=e.keys(t).sort(),r={};return e.each(n,function(e){r[e]=t[e]}),r},timedProcessArray:function(e,t,r){var i=e.concat();r=r||n.noop,setTimeout(function(){var n=+(new Date);do t(i.shift());while(i.length>0&&+(new Date)-n<50);i.length>0?setTimeout(arguments.callee,25):r(e)},25)},_isWindowBusy:!1,isWindowBusy:function(e){if(e===undefined)return this._isWindowBusy;this._isWindowBusy=e},copyLink:function(){alert("复制链接")},getHrefRefs:function(){var e=location.href,t=e.indexOf("?"),n=e.substring(e.indexOf("?")+1),r={},t=0,i="";n=n.split("&");for(var s=0;s<n.length;s++)i=n[s],i=i.split("="),i[1]&&(t=i[1].indexOf("#"),t==-1?r[i[0]]=i[1]:r[i[0]]=i[1].substring(0,i[1].indexOf("#")));return r},enterToTab:function(e,t){var r=e?e:window.event,i=n(t),s=i.closest(".js-tabindex"),o=document.getElementById("form1");if(r.keyCode==13){var u=i.attr("tabindex"),a;do u++,a=s.find("[tabindex="+u+"]");while(a.size()&&a.is(":hidden"));a.size()&&a[0].focus()}},TaskManager:o},n(window).bind("scroll",E);var w=null;return n(document).on("click",".js-channelfrom",function(){var e=n(this),t=e.attr("href"),r=n.cookie("from");r&&(t=t+"&from="+r,e.attr("href",t))}),window.helper}),define("router",["jquery","backbone","helper"],function(e,t,n){function r(e){this.$container=e,this.page=null,this.path="",this.redirectIsWork=!0,this.bindEvent()}r.prototype.clear=function(){location.hash&&location.hash[1]==="!"&&(location.hash="")},r.prototype.replaceState=function(){if(!history.pushState)return;(!history.state||!history.state.url||history.state.url===this.path)&&history.replaceState({url:this.path,title:document.title},document.title,this.path)},r.prototype.pushState=function(e){if(!history.pushState)return;!history.state||!history.state.url||history.state.url===this.path?history.replaceState({url:this.path,title:document.title,subElementSelecter:e},document.title,this.path):history.pushState({url:this.path,title:document.title,subElementSelecter:e},document.title,this.path)},r.prototype.isToSub=function(t){return t&&!!e(t).size()},r.prototype.hashlink=function(e){return this.page.hashlink(e)},r.prototype.reload=function(){this.toPage(this.path)},r.prototype.toPage=function(t,n,r,i){this.clear();if(t==="/"){this.toPage("/explore");return}location.href=t;return},r.prototype._toPage=function(t,n,r){var i=this,s=this.path,o=s;if(!/\.ajax\b/.test(o)){var u=s.split("?");o=u[0].replace(/\/+$/,"")+".ajax",t?(o+="?_toSub_=true",o+="&toSub=true",o+=u[1]?"&"+u[1]:""):o+=u[1]?"?"+u[1]:""}e.ajax({url:r?o:encodeURI(o),dataType:"json",path:s,statusCode:{404:function(){i.to404()},500:function(){i.to500()}},dataFilter:function(e){return this.path!=i.path?!1:e},success:function(e){i.pageInit(e,t,n)}}),this.baiduCount(s)},r.prototype.pageInit=function(t,r,i){var s=t.html,o=t.moduleName,u=t.forceLoadModule,a=t.initData||{},f=a.nav||[],l=a.title||"",c=a.params||[],h=a.hashlink;h&&c.push(h),c.push(a),l&&(document.title=l);if(!r)s&&this.$container.html(s),o&&require([o],function(e){n.refreshCurrentUser(),e.initNav(f),e.initBg(),e.init.apply(e,c)});else{if(s){var p=e(i),d=this.page;d.initNav(f),p.html(s),d.initSub.apply(d,[a])}o&&u&&require([o],function(e){e.init.apply(e,c)})}},r.prototype.to500=function(){var e=['<div class="mainbox_wrapper">','<div class="p-error">','<div class="cont">','<div class="error-pic"></div>','<div class="error-info">','<h2 class="txt-lg1" style="line-height: 1.3;">',"喵呜~网站访问的人太多啦~<br>","先休息一会儿再来吧~","</h2>",'<p class="mgtb-10 c02">',"错误类型：500","</p>",'<a href="/" hashlink>返回首页</a>',"</div>","</div>","</div>","</div>"].join("");this.$container.html(e)},r.prototype.to404=function(){this.toPage("/404s")},r.prototype.setPage=function(e){this.page=e,this.path=location.href,this.replaceState()},r.prototype.baiduCount=function(e){window._hmt&&(n.isLogin()?_hmt.push(["_trackPageview",e+"_login"]):_hmt.push(["_trackPageview",e+"_loginout"]))},r.prototype.bindEvent=function(){var t=this;e(window).on("popstate",function(){var e=history.state.url||history.state.state.url,n=function(){var t=!1,n=["/msgcenter/letter"];n.push("/letter/\\d*");for(i=0;i<n.length;i++){var r=new RegExp(n[i]);if(r.test(e)){t=!0;break}}return t},r=history.state.subElementSelecter,s=t.isToSub(r);t.toPage(e,s,r)}),e(document).ajaxComplete(function(e,n){if(n.status==400&&t.redirectIsWork){var r=window.location.protocol+"//"+location.host+t.path;location.href=config.LOGIN_PATH+"?fromUri="+encodeURIComponent(r)}})};var s=new r(e("#mainbox"));return window.router=s,s}),define("model/cache",["jquery","underscore","backbone"],function(e,t,n){function r(e){e=t.extend({data:null,keys:[]},e),this.cached=new n.Collection(e.data),this.keys=e.keys,this.removed=[]}return r.prototype={cache:function(e){this.cached.set(e,{remove:!1})},getCached:function(){return this.cached},getCachedByIds:function(e){var t=[];for(var r=0,i=e.length;r<i;r++){var s=e[r],o=this.cached.get(s);t.push(o)}return new n.Collection(t)},getCachedById:function(e){return this.cached.get(e)},get:function(e){var t=e.id,n=this.keys;if(t)return this.getCachedById(t);for(var r=0,i=n.length;r<i;r++){var s=n[r],o=e.get(s),u;u=this.cached.find(function(e){return e.get(s)==o});if(u)return u}},markRemoved:function(e){var t=e.id,n=this.keys;t&&this.removed.push(t);for(var r=0,i=n.length;r<i;r++){var s=n[r],o=e.get(s);o&&this.removed.push(o)}},isRemoved:function(e){var n=e.id,r=this.keys,i=[];n&&i.push(n);for(var s=0,o=r.length;s<o;s++){var u=r[s],a=e.get(u);a&&i.push(a)}return!!t.intersection(this.cached.removed,i).length},clear:function(){this.cached=new n.Collection}},r}),define("model/sound",["jquery","underscore","backbone","./cache","plugin/dialog"],function(e,t,n,r,i){var s=new r,o=n.Model.extend({defaults:{id:"",url:"",duration:0,isFavorited:!1,favoritesCount:0,title:"",author:"",authorId:"",album:"",albumId:"",coverUrl:"",soundface:"",soundfaceMiddle:"",square:"",squareId:"",categoryName:"",info:"",haveMoreIntro:"",isVerified:!1,uid:"",createAt:"",playCount:0,commentCount:0,shareCount:0,timeUntilNow:"",waveform:"",uploadId:"",is_paid:!1,is_free:!0,price:0,discounted_price:0},fetch:function(r){r=r||{},error=r.error||e.noop,success=r.success||e.noop,removed=r.removed,id=""+this.id,isDelayed=id[0]=="d",this.isDelayed=isDelayed,id=id.replace("d_",""),url=(isDelayed?"/delayed_tracks/":"/tracks/")+id+".json",t.extend(r,{url:url,removed:function(e,t,n){if(!t.res&&t.msg){i.confirm(t.msg);return}removed.apply(this,arguments)}}),n.Model.prototype.fetch.call(this,r)},isDelayed:!1,parse:function(e){return{id:(this.isDelayed?"d_":"")+e.id,url:e.play_path_64||e.play_path_32||e.play_path_128||e.play_path,duration:parseInt(e.duration*1e3,10),isFavorited:e.is_favorited,favoritesCount:e.favorites_count,title:e.title,author:e.nickname,authorId:e.uid,album:e.album_title,albumId:e.album_id,coverUrl:e.cover_url,soundface:e.cover_url_142,soundfaceMiddle:e.cover_url_142,square:e.category_title,squareId:e.category_id,categoryName:e.category_name,info:e.short_intro,haveMoreIntro:e.have_more_intro,isVerified:e.is_v,uid:e.uid,createAt:e.created_at,playCount:e.play_count,commentCount:e.comments_count,shareCount:e.shares_count,timeUntilNow:e.time_until_now,waveform:e.waveform,uploadId:e.upload_id,is_paid:e.is_paid,is_free:e.is_free,price:e.price,discounted_price:e.discounted_price}},like:function(t,n){var r=this,i=this.get("favoritesCount"),s=this.get("isFavorited");t=t||e.noop,n=n||e.noop,r.save({isFavorited:!s,favoritesCount:i+(s?-1:1)},{url:s?"/favorites/destroy":"/favorites/create",type:"post",data:{track_id:this.id,no_more_alert:!0,is_sharing:!0},success:function(e,r,i){if(r.res==0){n(e,r);return}t(e,r,i)},error:function(){t(r,{msg:"服务器错误"})}})},unlike:function(e,t){this.like(e,t)},destroy:function(t,n){t=t||e.noop,n=n||e.noop,e.ajax({url:"/my_tracks/"+this.id+"/destroy",type:"post",success:function(e){e.res?t(e):n(e)},error:function(){n({msg:"服务器繁忙,请稍后再试!"})}})},setPublic:function(t,n,r){n=n||e.noop,r=r||e.noop,e.ajax({url:"/handle_track/set_public",data:{record_id:t},type:"POST",success:function(e){e.res?n(e):r(e)},error:function(e,t,n){r({msg:"服务器繁忙,请稍后再试!"})}})},recordPlayCount:function(){this.set({playCount:this.get("playCount")+1}),e.ajax({url:"/nyx/v1/track/count/web",type:"post",data:{trackId:this.id}})},recordPlayInfo:function(t,n,r,i){i!==!1&&(i=!0),e.ajax({url:"/nyx/v1/track/statistic/web",data:{breakSecond:Math.floor(parseInt(n,10)/1e3),duration:Math.floor(parseInt(t,10)/1e3),startedAt:r,endedAt:(new Date).getTime(),trackId:this.id,albumId:this.albumId},timeout:3e3,async:i,type:"post"})},getCached:function(e){var t=s.getCached(),n={};for(var r=0,i=e.length;r<i;r++){var o=e[r],u=t.get(o);u&&(n[o]=u.toJSON())}return n}},{cache:s});return o}),define("module/player/link_protecter",["jquery","underscore","backbone","helper"],function(e,t,n,r){function i(e){if(!e)return"";var e=e.toString(),t,n,r,i,s,o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];i=e.length,r=0;for(s="";r<i;){do t=o[e.charCodeAt(r++)&255];while(r<i&&-1==t);if(-1==t)break;do n=o[e.charCodeAt(r++)&255];while(r<i&&-1==n);if(-1==n)break;s+=String.fromCharCode(t<<2|(n&48)>>4);do{t=e.charCodeAt(r++)&255;if(61==t)return s;t=o[t]}while(r<i&&-1==t);if(-1==t)break;s+=String.fromCharCode((n&15)<<4|(t&60)>>2);do{n=e.charCodeAt(r++)&255;if(61==n)return s;n=o[n]}while(r<i&&-1==n);if(-1==n)break;s+=String.fromCharCode((t&3)<<6|n)}return s}function s(e){if(!e)return"";var e=e.toString(),t,n,r,i,s,o;r=e.length,n=0;for(t="";n<r;){i=e.charCodeAt(n++)&255;if(n==r){t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>2),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((i&3)<<4),t+="==";break}s=e.charCodeAt(n++);if(n==r){t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>2),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((i&3)<<4|(s&240)>>4),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((s&15)<<2),t+="=";break}o=e.charCodeAt(n++),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>2),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((i&3)<<4|(s&240)>>4),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((s&15)<<2|(o&192)>>6),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o&63)}return t}function o(e,t){for(var n=[],r=0,i,s="",o=0;256>o;o++)n[o]=o;for(o=0;256>o;o++)r=(r+n[o]+e.charCodeAt(o%e.length))%256,i=n[o],n[o]=n[r],n[r]=i;for(var u=r=o=0;u<t.length;u++)o=(o+1)%256,r=(r+n[o])%256,i=n[o],n[o]=n[r],n[r]=i,s+=String.fromCharCode(t.charCodeAt(u)^n[(n[o]+n[r])%256]);return s}function u(e,t){for(var n=[],r=0;r<e.length;r++){for(var i=0,i="a"<=e[r]&&"z">=e[r]?e[r].charCodeAt(0)-97:e[r]-0+26,s=0;36>s;s++)if(t[s]==i){i=s;break}n[r]=25<i?i-26:String.fromCharCode(i+97)}return n.join("")}function a(e){this._randomSeed=e,this.cg_hun()}function c(){}a.prototype={cg_hun:function(){this._cgStr="";var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ/\\:._-1234567890",t=e.length,n=0;for(n=0;n<t;n++){var r=this.ran(),i=r*e.length,s=parseInt(i);this._cgStr+=e.charAt(s),e=e.split(e.charAt(s)).join("")}},cg_fun:function(e){var e=e.split("*"),t="",n=0;for(n=0;n<e.length-1;n++)t+=this._cgStr.charAt(e[n]);return t},ran:function(){return this._randomSeed=(211*this._randomSeed+30031)%65536,this._randomSeed/65536},cg_decode:function(e){var t="",n=0;for(n=0;n<e.length;n++){var r=e.charAt(n),i=this._cgStr.indexOf(r);i!==-1&&(t+=""+i+"*")}return t}};var f=!1,l={linkProtecterQuery:config.LINK_PROTECTER_QUERY+"/mobile/track/pay/{soundId}"};return c.setup=function(t){f=t.isBackend||f,e.extend(l,t.hosts||{})},c.prototype.query=function(t,n,s,c){var h=this,p=l.linkProtecterQuery;e.ajax({url:p.replace("{soundId}",t.id).replace("{businessType}",t.businessType),dataType:"json",data:{device:"pc",uid:r.getCurrentUserId(),token:r.getCurrentUserToken(),isBackend:f},method:"GET",crossDomain:!0,cache:!1,success:function(e){t.linkData=e;if(e.ret){s(e);return}var r="dg3utf1k6yxdwi09",f=[19,1,4,7,30,14,28,8,24,17,6,35,34,16,9,10,13,22,32,29,31,21,18,3,2,23,25,27,11,20,5,15,12,0,33,26],c=u(r,f),h=o(c,i(e.ep)).split("-"),p=new a(e.seed),d=p.cg_fun(e.fileId),v=h[1],m=h[0],g=h[2],y=h[3],b=e.duration;d=d[0]==="/"?d:"/"+d;var w=(e.domain||l.linkProtecterCDN)+"/download/"+e.apiVersion+d+"?sign="+encodeURIComponent(v)+"&buy_key="+encodeURIComponent(m)+"&timestamp="+y+"&token="+encodeURIComponent(g)+"&duration="+b;t.src=w,t.url=w,n(t)},statusCode:{400:function(e){try{if(e&&e.responseText){var n=JSON.parse(e.responseText);t.linkData=n,s(n)}}catch(r){}},403:function(e){try{if(e&&e.responseText){var n=JSON.parse(e.responseText);t.linkData=n,s(n)}}catch(r){}},404:function(e){try{if(e&&e.responseText){var n=JSON.parse(e.responseText);t.linkData=n,s(n)}}catch(r){}},500:function(e){try{if(e&&e.responseText){var n=JSON.parse(e.responseText);t.linkData=n,s(n)}}catch(r){}}}})},c.prototype.parse=function(e,t){return e},c}),define("model/cache_part",["jquery","underscore","backbone"],function(e,t,n){function r(e,t,n){this.url=e,this.objs={},this.cached=t.cache.getCached(),this.parseModelFn=n||function(e){return e.toJSON()},this.bindEvents()}return r.prototype.bindEvents=function(){var e=this,t=this.cached;t.on("add",function(t){var n=e.parseModelFn(t);e.cacheObj(n)}),t.on("change",function(t){var n=e.parseModelFn(t);e.cacheObj(n)})},r.prototype.cacheObjs=function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n],s={id:i.id};for(var o=0,u=t.length;o<u;o++){var a=t[o];s[a]=i.hasOwnProperty(a)?i[a]:!1}this.cacheObj(s)}},r.prototype.cacheObj=function(t){var n=t.id,r=this.objs[n];r?e.extend(r,t):this.objs[n]=t},r.prototype._query=function(t,n,r){var i=this;e.ajax({url:this.url,dataType:"json",method:"post",data:{ids:t.join(","),fields:n.join(",")},success:function(e){if(e.res){var t=e.objs;i.cacheObjs(t,n),r()}}})},r.prototype.isCached=function(e,t){var n=this.objs[e];if(!n)return!1;for(var r=0,i=t.length;r<i;r++){var s=t[r];if(!n.hasOwnProperty(s))return!1}return!0},r.prototype.query=function(e,t,n,r){var i=this,s=[],o=[];r=r||function(){return!1};for(var u=0,a=e.length;u<a;u++){var f=e[u];this.isCached(f,t)?o.push(i.objs[f]):s.push(f)}var l=s.length>0;if(!l){n(o);return}if(r(s))return;this._query(s,t,function(){for(var t=0,r=s.length;t<r;t++){var u=s[t];o.push(i.objs[u])}n(i.sort(o,e))})},r.prototype.sort=function(e,t){var n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r];for(var o=0,u=e.length;o<u;o++){var a=e[o];a.id==s&&n.push(a)}}return n},r.prototype.get=function(e){return this.objs[e]},r.prototype.set=function(e){this.cacheObj(e)},r}),define("module/player/extension",["jquery","underscore","backbone","helper"],function(e,t,n,r){function s(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}var i={$last:null,last:null,$lastSoundIds:null,_isPlaying:!1,pause:function(){this.last.pause(),this._isPlaying=!1},isPlaying:function(){return this._isPlaying},isInExtension:function(e){return e.closest("[sound_id]").is("[sound_extension]")},events:{play:function(){i._isPlaying=!0;var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],s=r.$el,o=r.$btn,u=r.$progressbar,a=s.closest("[sound_ids]");r.$soundIds=a,r.$btn=o,i.$last=s,i.last=this,i.$lastSoundIds=a.size()?a:null,o.addClass("pauseBtn").removeClass("playBtn player-loading")}},stop:function(){var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],i=r.$btn;i.addClass("playBtn").removeClass("pauseBtn player-loading")}},pause:function(){var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],i=r.$btn;i.addClass("playBtn").removeClass("pauseBtn player-loading")}},resume:function(){i._isPlaying=!0;var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],s=r.$btn;s.addClass("pauseBtn").removeClass("playBtn player-loading")}},finish:function(){var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],s=r.$btn,o=r.$playbar;s.addClass("playBtn").removeClass("pauseBtn player-loading"),o.css("width","0")}var u=i.$last,a=i.$lastSoundIds;if(a){var f=a.attr("sound_ids").split(","),l=u.attr("sound_id"),c=f.indexOf(l),h=f[c+1],p=null;h?(p=a.find("[sound_id="+h+"]"),p.trigger("click")):(mainPlayer.play(),i._isPlaying=!1)}this._last_position=0},whileplaying:function(){if(this.paused)return;var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var i=e[t],s=i.$progressbar;if(!s.size())continue;var o=i.$playbar,u=i.$seekbar,a=s.width();if(o.size()){var f=this.position/(i.duration||this.duration);f=f>1?1:f,o.css("width",100*f+"%"),i.$position.text(r.getTime(this.position))}}}},bind:function(t){var n=this,i=t.attr("sound_id"),s=t.attr("sound_url"),o=t.find(".player_progressbar"),u=t.find(".playBtn,.pauseBtn"),a=t.attr("sound_duration"),f=n.$last,l=n.last;u=u.size()?u:t;var c=soundManager.getSoundById("s_extend"+i);c||(c=soundManager.createSound({id:"s_extend"+i,url:s,onplay:n.events.play,onstop:n.events.stop,onpause:n.events.pause,onresume:n.events.resume,onfinish:n.events.finish,whileloading:n.events.whileloading,whileplaying:n.events.whileplaying}),c.addeds=[],c._last_position=0,c.soundId=i),c.addeds.push({$el:t,$btn:u,$progressbar:o,duration:a,$playbtn:t.find(".playBtn,.pauseBtn"),$seekbar:o.find(".player_seekbar"),$playbar:o.find(".player_playbar"),$position:t.find(".sound_position"),$wavebox:t.find(".player_wavebox"),$nonius:t.find(".player_nonius"),$noniusTime:t.find(".player_nonius_time"),$noniusCover:t.find(".player_nonius_cover")}),f&&f.attr("sound_id")==i&&l&&l.playState&&u.addClass("pauseBtn").removeClass("playBtn player-loading"),u.on("click",function(t){var r=e(this),i=r.closest("[sound_id]"),s=i.attr("sound_id"),o=n.$last,u=n.last;t.preventDefault();if(r.is(".playBtn")){o&&o.attr("sound_id")!==s&&u&&u.playState&&(u._last_position=u.position||0,u.stop(),u.unload()),mainPlayer.pause(),c.play();return}if(r.is(".pauseBtn")){c.pause();return}return}),o.on(r.START_EV,function(e){var t=u.closest("[sound_id]"),n=e.type=="touchstart"?event.touches[0].clientX:e.clientX;if(!u.is(".pauseBtn")){u.trigger("click");return}var r=o.offset().left,i=o.width(),s=(n-r)/i,f=a*s;return c.setPosition(f),c._last_position=f,!1})}};e.fn.extensionPlayer=function(t){return this.each(function(){var t=e(this);if(t.data("is-extensionPlayer-binded"))return;t.data("is-extensionPlayer-binded",!0),i.bind(t)}),this},window.extensionPlayer=i}),define("module/player/model",["jquery","underscore","backbone","model/sound","./link_protecter","model/cache_part","helper","./extension"],function(e,t,n,r,i,s,o){function a(e){var t=e.toJSON();return t.hasOwnProperty("author")&&(t.nickname=t.author),t}function h(){return"localStorage"in window&&window.localStorage!==null}function p(e){if(e===undefined)return h()?parseInt(localStorage.mainplayer_volume||50,10):50;h()&&(localStorage.mainplayer_volume=e)}function v(){var e=c.sound();if(e&&e.id){var t=c.smSound(),n=c.isPaused();if(t&&t.playState){var r=e.id;t._last_position=t.position,t.paused||d.putInfo(r,(new Date).getTime(),"onstop"),d.postInfo(r,!0),localStorage.playing_id=""}}}var u={STOP:0,PAUSE:1,BUFFERING:2,PLAYING:3},f=new s("/main/get_current_play_list",r,a),l=n.Model.extend({unPlayables:[],loadeds:[],_needLoop:!1,_needRandom:!1,_orderSoundIds:[],linkProtect:new i,defaults:function(){return{volume:p(),soundId:"",soundIds:[],sound:{},preable:!1,nextable:!1,playable:!1,isQuerying:!1,playState:u.STOP,playModel:0}},volume:function(e){if(e===undefined)return this.get("volume");this.set("volume",e),p(e),this.smSound()&&this.smSound().setVolume(e)},soundId:function(e){if(e===undefined)return this.get("soundId");var n=this.soundIds(),r=t.indexOf(n,e);r>=0&&(this.set("soundId",e),this.set("playable",this.playable()),this.set("preable",this.preable()),this.set("nextable",this.nextable()))},soundIds:function(e){if(e===undefined)return this.get("soundIds");this._orderSoundIds=t.uniq(e);var n=this._orderSoundIds;this.getNeedRandom()&&(n=this.getRandomSoundIds(e)),this.set("soundIds",n);var r=this.soundId();r&&(index=t.indexOf(n,r),index!==-1&&(this.set("playable",this.playable()),this.set("preable",this.preable()),this.set("nextable",this.nextable())))},isDelayed:function(e){return""+e[0]=="d"},getList:function(e,t){var n=this._orderSoundIds;f.query(n,["uid","title","url","nickname"],function(e){t(e)},function(t){return e&&t.length<80})},preable:function(){var e=this.get("soundIds"),n=this.get("soundId"),r=t.indexOf(e,n);return r>0},nextable:function(){var e=this.get("soundIds"),n=this.get("soundId"),r=t.indexOf(e,n);return r<e.length-1},playable:function(){return!!this.get("soundId")},playState:function(){return this.get("playState")},getSoundBaseInfo:function(e,t,n){var i=this,s=new r({id:e});s.query({success:function(e){var n=e.toJSON();t(n)},removed:function(){i.unPlayables.push(e),i.trigger("onSoundUnexist",e),n(e)},error:function(){n(e)}})},getSoundInfo:function(e,t,n,i){var s=this,o=new r({id:e});o.query({async:!i,success:function(r){var i=r.toJSON();s.selectSoundId==r.id?(s.trigger("onSoundExist",i),i.is_paid?i.is_free?s.linkProtect.query(i,function(e){t(e)},function(t){s.trigger("onSoundNeedPay",i),n(e,i)}):(s.trigger("onSoundNeedPay",i),n(e,i)):t(i)):s.trigger("onSoundPast",i)},removed:function(){s.unPlayables.push(e),s.trigger("onSoundUnexist",e),n(e)},error:function(){n(e)}})},soundPlayable:function(n,r,i){var s=this,u=!1;r=r||e.noop,i=i||e.noop;if(t.indexOf(s.unPlayables,n)!==-1){s.trigger("onSoundUnexist",n),i(n);return}o.isIDevice&&(u=!0),this.getSoundInfo(n,r,i,u)},removeSmSound:function(e){var t=this.getSmSoundById(e);t&&t.destruct()},selectSoundId:0,select:function(t,n,r){var i=this;n=n||e.noop,this.selectSoundId=t,i.trigger("onSoundIdSelect",t),extensionPlayer.isPlaying()&&extensionPlayer.pause(),t!==this.get("soundId")&&this.pauseOtherSound(),r=r||function(e,t){},this.soundPlayable(t,function(e){i.set("soundId",t),i.set("sound",e),n(e)},function(e,t){r(e,t)})},selectPrev:function(n,r){n=n||e.noop,r=r||e.noop;if(!this.preable()){r();return}var i=this,s=this.get("soundIds"),o=this.get("soundId"),u=t.indexOf(s,o),a=s[u-1];this.select(a,function(e){n(e)},function(e){i.set("soundIds",t.without(i.soundIds(),e)),i.selectPrev(n,r)})},selectNext:function(n,r){n=n||e.noop,r=r||e.noop;if(!this.nextable()){r();return}var i=this,s=this.get("soundIds"),o=this.get("soundId"),u=t.indexOf(s,o),a=s[u+1];this.select(a,function(e){n(e)},function(e){i.set("soundIds",t.without(i.soundIds(),e)),i.selectNext(n,r)})},removeSoundId:function(e){var n=this,r=this.soundId();if(r==e){var i=this.smSound(),s=i.playState&&!i.paused;this.pauseAndUnload(),this.selectNext(function(){n.soundIds(t.without(n.soundIds(),e)),s&&n.play()},function(){n.selectPrev(function(){n.soundIds(t.without(n.soundIds(),e)),s&&n.play()},function(){n.soundIds(t.without(n.soundIds(),e)),n.set("soundId",""),n.set("sound",{})})})}},prev:function(){var e=this;this.selectPrev(function(t){e._play(t)})},next:function(){var e=this;this.selectNext(function(t){e._play(t)})},play:function(e){e=e||{};if(!soundManager.ok()){var t=this;soundManager.reboot(),soundManager.onready(function(){t._play(e)});return}this._play(e)},_play:function(e){var n=this.get("sound"),r=this.getSmSoundBySound(n);if(r.paused)r.resume();else{if(r&&r.playState)return;var i=r._last_position||e.position;t.indexOf(this.loadeds,r.soundId)===-1&&(i=0),r.play(t.extend(e,{volume:this.volume()})),i&&setTimeout(function(){r.setPosition(i)},500)}},pause:function(){if(!this.playable())return;var e=this.smSound();e&&e.playState&&e.pause()},resume:function(){if(!this.playable())return;var e=this.smSound();e&&e.playState&&e.resume()},stop:function(){if(!this.playable())return;var e=this.smSound();e&&e.playState&&(e._last_position=0,e.paused||d.putInfo(e.soundId,(new Date).getTime(),"onstop"),e.stop(),e.unload())},pauseOtherSound:function(){this.pauseAndUnload()},pauseAndUnload:function(){if(!this.playable())return;var e=this.smSound();e&&e.playState&&(e._last_position=e.position||0,e.paused||d.putInfo(e.soundId,(new Date).getTime(),"onstop"),e.stop(),e.unload())},isPaused:function(){return this.get("playState")===u.PAUSE},seek:function(e,t){t===undefined&&(t=this.smSound());if(!this.playable())return;t.setPosition(e),t._last_position=e},seekPlus:function(e){var n=this.smSound(),r;e=t.extend({dif:1e3},e);if(!n)return;r=n.position+e.dif,this.seek(r)},seekMinus:function(e){e=t.extend({dif:-1e3},e),this.seekPlus(e)},seekInPrecent:function(e,t){var n=null;t!==undefined?n=this.getSmSoundById(t):n=this.smSound();if(!n)return;var r=n._duration_net*e;this.seek(r,n)},sound:function(){return this.get("sound")},getSmSoundById:function(e){return soundManager.getSoundById("s"+e)},smSound:function(){var e=this.get("soundId");return this.getSmSoundById(e)},getDuration:function(e){var t=soundManager.getSoundById("s"+e);if(t)return t._duration_net},loopPlay:function(){this.set("playModel",1),this.setNeedLoop(!0)},orderPlay:function(){this.set("playModel",0),this.setNeedLoop(!1),this.setNeedRandom(!1),this.soundIds(this._orderSoundIds)},randomPlay:function(){this.set("playModel",2),this.setNeedLoop(!1),this.setNeedRandom(!0),this.soundIds(this._orderSoundIds)},setNeedLoop:function(e){this._needLoop=e},getNeedLoop:function(){return this._needLoop},setNeedRandom:function(e){this._needRandom=e},getNeedRandom:function(){return this._needRandom},getRandomSoundIds:function(e){var n=this.get("soundId"),r=t.shuffle(t.without(e,n)),i=t.indexOf(e,n);return n&&i>=0&&r.unshift(n),r},isTrial:function(e){return e.is_paid?e.linkData?!e.linkData.isAuthorized:!1:!1},getSmSoundBySound:function(e){var t=this,n=e.id,r=this.getSmSoundById(n);return r||(r=soundManager.createSound({id:"s"+n,url:e.url,volume:50,onplay:function(){this._onloaderror=!1,t.trigger("onSoundPlay",this.sound),this.isBuffering?t.set("playState",u.BUFFERING):t.set("playState",u.PLAYING),d.putInfo(this.soundId,(new Date).getTime(),"onplay"),this.started_at=(new Date).toString(),d.postCount(this.soundId)},onpause:function(){t.trigger("onSoundPause",this.sound),d.putInfo(this.soundId,(new Date).getTime(),"onpause"),t.set("playState",u.PAUSE)},onresume:function(){t.trigger("onSoundResume",this.sound),d.putInfo(this.soundId,(new Date).getTime(),"onresume"),t.set("playState",u.PLAYING)},onstop:function(){t.trigger("onSoundStop",this.sound),t.set("playState",u.STOP),d.postInfo(this.soundId)},onfinish:function(){t.trigger("onSoundFinish",this.sound),d.putInfo(this.soundId,(new Date).getTime(),"onfinish"),t.set("playState",u.STOP),this._last_position=0,d.postInfo(this.soundId);if(t.isTrial(this.sound)){t.trigger("onSoundNeedPay",this.sound);return}t.getNeedLoop()?t.play():t.next()},onload:function(e){if(!e){this._onloaderror=!0;var n=this.position-5e3;n=n>0?n:0,t.trigger("onLoadError",this.sound,n),this.pause(),this.destruct()}else t.loadeds.push(this.soundId)},whileloading:function(){t.trigger("onSoundWhileloading",this.sound,this)},whileplaying:function(){if(this.paused)return;t.trigger("onSoundWhileplaying",this.sound,this)},onbufferchange:function(){if(this._onloaderror)return;this.isBuffering?(d.putInfo(this.soundId,(new Date).getTime(),"onbuffering"),t.set("playState",u.BUFFERING)):(d.putInfo(this.soundId,(new Date).getTime(),"onplay"),t.set("playState",u.PLAYING))}}),r.soundId=n,r._duration_net=e.duration,r._last_position=0,r.sound=e),r}},{playState:u}),c=new l,d={infos:{},initInfo:function(e){this.infos[e]={}},putInfo:function(e,t,n){this.getInfo(e)||this.initInfo(e),this.getInfo(e)[t]=n},getInfo:function(e){return this.infos[e]},postCount:function(e){var t=new r({id:e});t.query({success:function(t){t.recordPlayCount(e)}})},postInfo:function(e,t){if(c.isDelayed(e))return;var n=this.getInfo(e),i=this.getPlayDuration(n),s=0,o=soundManager.getSoundById("s"+e),u=this.getPlayStartedAt(n);this.initInfo(e),o&&(s=o._last_position);var a=new r({id:e});if(isNaN(s)||s===null)return;a.query({success:function(e){e.recordPlayInfo(i,s,u,!t)}})},getPlayStartedAt:function(e){var n=t.keys(e).sort(function(e,t){return e-t});return n[0]},getPlayDuration:function(e){var n=0,r=t.keys(e).sort(function(e,t){return e-t});return t.each(r,function(t,i){var s=e[t];(s=="onpause"||s=="onstop"||s=="onfinish"||s=="onbuffering")&&i>0&&(n+=t-r[i-1])}),n}};return window.onpagehide!==undefined?window.onpagehide=function(){v()}:window.onbeforeunload!==undefined?window.onbeforeunload=function(){v()}:window.onunload=function(){v()},l.mainPlayer=c,window.mainPlayer=c,c.on("change:playModel",function(e,t){localStorage.last_play_model=t}),c.on("onSoundWhileplaying",function(e,t){localStorage.last_sound_id=e.id,localStorage.last_sound_position=t.position}),c.on("change:soundIds",function(){localStorage.last_sound_ids=c._orderSoundIds}),c.on("onSoundPlay",function(){localStorage.last_sound_paused=!1,localStorage.playing_id=window._id}),c.on("onSoundResume",function(){localStorage.last_sound_paused=!1,localStorage.playing_id=window._id}),c.on("onSoundPause",function(){localStorage.last_sound_paused=!0}),setInterval(function(){var e=localStorage.playing_id&&localStorage.playing_id!=window._id;e&&c.pause()},1e3),l}),define("module/player/volume_view",["jquery","underscore","backbone","./model","plugin/jquery.easydrag"],function(e,t,n,r){var i=r.mainPlayer,s=n.View.extend({_last_volume:50,_barHeight:120,_btnGap:3,_$volume:null,_$muteBtn:null,_mouseMoveLock:!0,events:{"click .ic-volume":"onClickMuteBtn","click .volume-bar":"volume",mouseenter:"slideUp",mouseleave:"slideDown","mousedown .volume-bar":"onMouseDown",mouseup:"onMouseUp",mousemove:"onMouseMove"},onMouseDown:function(){this._mouseMoveLock=!1,this._$volumeBar.addClass("hover")},onMouseUp:function(){this._mouseMoveLock=!0,this._$volumeBar.removeClass("hover")},onMouseMove:function(e){if(this._mouseMoveLock)return;this.volume(e)},slideUp:function(){this.$el.addClass("open")},slideDown:function(){this.$el.removeClass("open")},initialize:function(){var e=this.$el,t=this;this._$volumeBar=e.find(".volume-bar"),this._$volume=e.find(".cur-bar"),this._$muteBtn=e.find(".ic-volume"),this.render()},render:function(){var e=this.$el,t=this._$muteBtn,n=this._$volume,r=i.volume(),s=!r;s?(n.css("height","0"),e.addClass("is-off"),t.attr("title","取消静音")):(n.css("height",r+"%"),e.removeClass("is-off"),t.attr("title","静音"))},unmute:function(){i.volume(this._last_volume),this.render()},mute:function(){this._last_volume=i.volume(),i.volume(0),this.render()},onClickMuteBtn:function(){var e=this.$el;e.is(".is-off")?this.unmute():this.mute()},volume:function(e){var t=this._$volumeBar,n=t.offset().top,r=this._barHeight,s=e.pageY-n,o=(r-s)/r,u=i.volume();if(s<0||s>r)return!1;s<=3&&(o=1),s>=117&&(o=0),Math.abs(o*100-u)>1&&(i.volume(parseInt(o*100)),this.render())}});return s}),define("module/wave",["jquery","underscore","backbone","helper"],function(e,t,n){var r={$parents:[],render:function(t){var n=t||{},r=n.$container,i=n.isManual||!1,s;r?s=r.find(".player_wavebox"):s=e(".player_wavebox");for(var o=0,u=s.size();o<u;o++)this._draw(s.eq(o),i)},_draw:function(t,n){if(!n&&(t.closest(".player_progressbar").data("drawed")||t.closest(".player_progressbar").is(":hidden")))return;var r=t.parents("[sound_id]"),i=r.attr("sound_id"),s=t.attr("sound_wave"),o=t.attr("sound_uploadId");if(!s||!o)return;t.closest(".player_progressbar").data("drawed",!0),this.$parents.push(r),e.ajax({url:s,cache:!0,dataType:"jsonp",jsonpCallback:"$.noop"})},draw:function(e,t){i.append([e,t])},drawItem:function(e,n){var r=this;t.each(this.$parents,function(t,i){if(t&&t.find("[sound_uploadId="+e+"]").size()){var s=t.find(".player_wavebox");if(s){var o=s.width(),u=s.height();if(s.find(".player_playbar,player_seekbar,player_backgroundbar").size()){var a=s.find(".player_backgroundbar"),f=s.find(".player_seekbar"),l=s.find(".player_playbar"),c=[];a.size()&&c.push({color:"#CCCCCC",container:a}),f.size()&&c.push({color:"#BBBBBB",container:f}),l.size()&&c.push({color:"#FF6600",container:l});var h=r.drawWave({data:n,width:o,height:u,isMask:!1,waves:c})}else s.html(r.drawWave({data:n,width:o,height:u,isMask:!0,waves:[{color:"#FFFFFF",container:s}]}));r.$parents[i]=undefined,s.closest(".player_progressbar").addClass("is-drawed")}}})},drawWave:function(e){var t=document.createElement("canvas"),n;return e.data.samples[e.data.samples.length-1]=2,t.getContext?n=this.drawWaveCanvas(e):n=this.drawWaveVml(e),n},drawWaveVml:function(e){var t=2,n=e.data,r=e.width,i=e.height,s=e.color,o=e.isMask,u=e.waves;r=r||n.width,i=i||n.height,s=s||"#fff";var a=[],f=4,l=0,c=r/n.width,h=i/n.height,p=n.samples;for(var d=0,v=r,m=v/f;d<v;d++){var g="";l=Math.round(p[Math.round(d/c)]*h),l=l<=2?l+2:l;var y=Math.ceil(i-l);o?g+=" m"+d+",-1"+" l"+d+","+y:g+=" m"+d+","+y+" l"+d+","+Math.ceil(i);var b=Math.floor(d/m);a[b]||(a[b]=""),a[b]=a[b]+g}var w=[];for(var d=0;d<u.length;d++){var E="",S=u[d].color;for(var x=0;x<f;x++)a[x]+=" e",E+='<v:shape  class="vml" style="width: '+r+"px; height: "+i+'px;" coordsize="'+[r,i].join(",")+'" '+' strokecolor="'+S+'" path="'+a[x]+'"></v:shape>';w.push(E)}for(var d=0;d<u.length;d++)u[d].container.html(w[d])},drawWaveCanvas:function(e){var t=2,n=e.data,r=e.width,i=e.height,s=e.color,o=e.isMask,u=e.waves;r=r||n.width,i=i||n.height,s=s||"#fff";var a=0,f=r/n.width,l=i/n.height,c=n.samples,h=[],p=[];for(var d=0,v=u.length;d<v;d++){var m=u[d],g=document.createElement("canvas"),y=g.getContext("2d");g.width=r,g.height=i,y.fillStyle=m.color,h.push(g),p.push(y)}for(var b=0,w=r;b<w;b++){a=Math.round(c[Math.round(b/f)]*l),a=a<=2?a+2:a;var E=i-a;for(var S=0,x=h.length;S<x;S++)y=p[S],o?y.fillRect(b,0,1,E):y.fillRect(b,E,1,i)}for(var b=0;b<u.length;b++)u[b].container.html(h[b])},release:function(){var e=this;t.each(this.$parents,function(t,n){t&&t.parents("body").size()&&(e.$parents[n]=undefined)})}},i=new helper.TaskManager(r.drawItem,function(){},r);return window.wave=r,r}),function(e){typeof define=="function"&&define.amd?define("plugin/jquery.form",["jquery"],e):e(typeof jQuery!="undefined"?jQuery:window.Zepto)}(function(e){function r(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(n))}function i(t){var n=t.target,r=e(n);if(!r.is("[type=submit],[type=image]")){var i=r.closest("[type=submit]");if(i.length===0)return;n=i[0]}var s=this;s.clk=n;if(n.type=="image")if(t.offsetX!==undefined)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if(typeof e.fn.offset=="function"){var o=r.offset();s.clk_x=t.pageX-o.left,s.clk_y=t.pageY-o.top}else s.clk_x=t.pageX-n.offsetLeft,s.clk_y=t.pageY-n.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function s(){if(!e.fn.ajaxSubmit.debug)return;var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}var t={};t.fileapi=e("<input type='file'/>").get(0).files!==undefined,t.formdata=window.FormData!==undefined;var n=!!e.fn.prop;e.fn.attr2=function(){if(!n)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||typeof e=="string"?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(r){function k(t){var n=e.param(t,r.traditional).split("&"),i=n.length,s=[],o,u;for(o=0;o<i;o++)n[o]=n[o].replace(/\+/g," "),u=n[o].split("="),s.push([decodeURIComponent(u[0]),decodeURIComponent(u[1])]);return s}function L(t){var n=new FormData;for(var s=0;s<t.length;s++)n.append(t[s].name,t[s].value);if(r.extraData){var o=k(r.extraData);for(s=0;s<o.length;s++)o[s]&&n.append(o[s][0],o[s][1])}r.data=null;var u=e.extend(!0,{},e.ajaxSettings,r,{contentType:!1,processData:!1,cache:!1,type:i||"POST"});r.uploadProgress&&(u.xhr=function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(e){var t=0,n=e.loaded||e.position,i=e.total;e.lengthComputable&&(t=Math.ceil(n/i*100)),r.uploadProgress(e,n,i,t)},!1),t}),u.data=null;var a=u.beforeSend;return u.beforeSend=function(e,t){r.formData?t.data=r.formData:t.data=n,a&&a.call(this,e,t)},e.ajax(u)}function A(t){function T(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(n){s("cannot get iframe.contentWindow document: "+n)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(n){s("cannot get iframe.contentDocument: "+n),t=e.document}return t}function k(){function f(){try{var e=T(v).readyState;s("state = "+e),e&&e.toLowerCase()=="uninitialized"&&setTimeout(f,50)}catch(t){s("Server abort: ",t," (",t.name,")"),_(x),w&&clearTimeout(w),w=undefined}}var t=a.attr2("target"),n=a.attr2("action"),r="multipart/form-data",u=a.attr("enctype")||a.attr("encoding")||r;o.setAttribute("target",p),(!i||/post/i.test(i))&&o.setAttribute("method","POST"),n!=l.url&&o.setAttribute("action",l.url),!l.skipEncodingOverride&&(!i||/post/i.test(i))&&a.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),l.timeout&&(w=setTimeout(function(){b=!0,_(S)},l.timeout));var c=[];try{if(l.extraData)for(var h in l.extraData)l.extraData.hasOwnProperty(h)&&(e.isPlainObject(l.extraData[h])&&l.extraData[h].hasOwnProperty("name")&&l.extraData[h].hasOwnProperty("value")?c.push(e('<input type="hidden" name="'+l.extraData[h].name+'">').val(l.extraData[h].value).appendTo(o)[0]):c.push(e('<input type="hidden" name="'+h+'">').val(l.extraData[h]).appendTo(o)[0]));l.iframeTarget||d.appendTo("body"),v.attachEvent?v.attachEvent("onload",_):v.addEventListener("load",_,!1),setTimeout(f,15);try{o.submit()}catch(m){var g=document.createElement("form").submit;g.apply(o)}}finally{o.setAttribute("action",n),o.setAttribute("enctype",u),t?o.setAttribute("target",t):a.removeAttr("target"),e(c).remove()}}function _(t){if(m.aborted||M)return;A=T(v),A||(s("cannot access response document"),t=x);if(t===S&&m){m.abort("timeout"),E.reject(m,"timeout");return}if(t==x&&m){m.abort("server abort"),E.reject(m,"error","server abort");return}if(!A||A.location.href==l.iframeSrc)if(!b)return;v.detachEvent?v.detachEvent("onload",_):v.removeEventListener("load",_,!1);var n="success",r;try{if(b)throw"timeout";var i=l.dataType=="xml"||A.XMLDocument||e.isXMLDoc(A);s("isXml="+i);if(!i&&window.opera&&(A.body===null||!A.body.innerHTML)&&--O){s("requeing onLoad callback, DOM not available"),setTimeout(_,250);return}var o=A.body?A.body:A.documentElement;m.responseText=o?o.innerHTML:null,m.responseXML=A.XMLDocument?A.XMLDocument:A,i&&(l.dataType="xml"),m.getResponseHeader=function(e){var t={"content-type":l.dataType};return t[e.toLowerCase()]},o&&(m.status=Number(o.getAttribute("status"))||m.status,m.statusText=o.getAttribute("statusText")||m.statusText);var u=(l.dataType||"").toLowerCase(),a=/(json|script|text)/.test(u);if(a||l.textarea){var f=A.getElementsByTagName("textarea")[0];if(f)m.responseText=f.value,m.status=Number(f.getAttribute("status"))||m.status,m.statusText=f.getAttribute("statusText")||m.statusText;else if(a){var c=A.getElementsByTagName("pre")[0],p=A.getElementsByTagName("body")[0];c?m.responseText=c.textContent?c.textContent:c.innerText:p&&(m.responseText=p.textContent?p.textContent:p.innerText)}}else u=="xml"&&!m.responseXML&&m.responseText&&(m.responseXML=D(m.responseText));try{L=H(m,u,l)}catch(g){n="parsererror",m.error=r=g||n}}catch(g){s("error caught: ",g),n="error",m.error=r=g||n}m.aborted&&(s("upload aborted"),n=null),m.status&&(n=m.status>=200&&m.status<300||m.status===304?"success":"error"),n==="success"?(l.success&&l.success.call(l.context,L,"success",m),E.resolve(m.responseText,"success",m),h&&e.event.trigger("ajaxSuccess",[m,l])):n&&(r===undefined&&(r=m.statusText),l.error&&l.error.call(l.context,m,n,r),E.reject(m,"error",r),h&&e.event.trigger("ajaxError",[m,l,r])),h&&e.event.trigger("ajaxComplete",[m,l]),h&&!--e.active&&e.event.trigger("ajaxStop"),l.complete&&l.complete.call(l.context,m,n),M=!0,l.timeout&&clearTimeout(w),setTimeout(function(){l.iframeTarget?d.attr("src",l.iframeSrc):d.remove(),m.responseXML=null},100)}var o=a[0],u,f,l,h,p,d,v,m,g,y,b,w,E=e.Deferred();E.abort=function(e){m.abort(e)};if(t)for(f=0;f<c.length;f++)u=e(c[f]),n?u.prop("disabled",!1):u.removeAttr("disabled");l=e.extend(!0,{},e.ajaxSettings,r),l.context=l.context||l,p="jqFormIO"+(new Date).getTime(),l.iframeTarget?(d=e(l.iframeTarget),y=d.attr2("name"),y?p=y:d.attr2("name",p)):(d=e('<iframe name="'+p+'" src="'+l.iframeSrc+'" />'),d.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=d[0],m={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n=t==="timeout"?"timeout":"aborted";s("aborting upload... "+n),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(r){}d.attr("src",l.iframeSrc),m.error=n,l.error&&l.error.call(l.context,m,n,t),h&&e.event.trigger("ajaxError",[m,l,n]),l.complete&&l.complete.call(l.context,m,n)}},h=l.global,h&&0===e.active++&&e.event.trigger("ajaxStart"),h&&e.event.trigger("ajaxSend",[m,l]);if(l.beforeSend&&l.beforeSend.call(l.context,m,l)===!1)return l.global&&e.active--,E.reject(),E;if(m.aborted)return E.reject(),E;g=o.clk,g&&(y=g.name,y&&!g.disabled&&(l.extraData=l.extraData||{},l.extraData[y]=g.value,g.type=="image"&&(l.extraData[y+".x"]=o.clk_x,l.extraData[y+".y"]=o.clk_y)));var S=1,x=2,N=e("meta[name=csrf-token]").attr("content"),C=e("meta[name=csrf-param]").attr("content");C&&N&&(l.extraData=l.extraData||{},l.extraData[C]=N),l.forceSync?k():setTimeout(k,10);var L,A,O=50,M,D=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&t.documentElement.nodeName!="parsererror"?t:null},P=e.parseJSON||function(e){return window.eval("("+e+")")},H=function(t,n,r){var i=t.getResponseHeader("content-type")||"",s=n==="xml"||!n&&i.indexOf("xml")>=0,o=s?t.responseXML:t.responseText;return s&&o.documentElement.nodeName==="parsererror"&&e.error&&e.error("parsererror"),r&&r.dataFilter&&(o=r.dataFilter(o,n)),typeof o=="string"&&(n==="json"||!n&&i.indexOf("json")>=0?o=P(o):(n==="script"||!n&&i.indexOf("javascript")>=0)&&e.globalEval(o)),o};return E}if(!this.length)return s("ajaxSubmit: skipping submit process - no element selected"),this;var i,o,u,a=this;typeof r=="function"?r={success:r}:r===undefined&&(r={}),i=r.type||this.attr2("method"),o=r.url||this.attr2("action"),u=typeof o=="string"?e.trim(o):"",u=u||window.location.href||"",u&&(u=(u.match(/^([^#]+)/)||[])[1]),r=e.extend(!0,{url:u,success:e.ajaxSettings.success,type:i||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},r);var f={};this.trigger("form-pre-serialize",[this,r,f]);if(f.veto)return s("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(r.beforeSerialize&&r.beforeSerialize(this,r)===!1)return s("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var l=r.traditional;l===undefined&&(l=e.ajaxSettings.traditional);var c=[],h,p=this.formToArray(r.semantic,c);r.data&&(r.extraData=r.data,h=e.param(r.data,l));if(r.beforeSubmit&&r.beforeSubmit(p,this,r)===!1)return s("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[p,this,r,f]);if(f.veto)return s("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var d=e.param(p,l);h&&(d=d?d+"&"+h:h),r.type.toUpperCase()=="GET"?(r.url+=(r.url.indexOf("?")>=0?"&":"?")+d,r.data=null):r.data=d;var v=[];r.resetForm&&v.push(function(){a.resetForm()}),r.clearForm&&v.push(function(){a.clearForm(r.includeHidden)});if(!r.dataType&&r.target){var m=r.success||function(){};v.push(function(t){var n=r.replaceTarget?"replaceWith":"html";e(r.target)[n](t).each(m,arguments)})}else r.success&&v.push(r.success);r.success=function(e,t,n){var i=r.context||this;for(var s=0,o=v.length;s<o;s++)v[s].apply(i,[e,t,n||a,a])};if(r.error){var g=r.error;r.error=function(e,t,n){var i=r.context||this;g.apply(i,[e,t,n,a])}}if(r.complete){var y=r.complete;r.complete=function(e,t){var n=r.context||this;y.apply(n,[e,t,a])}}var b=e("input[type=file]:enabled",this).filter(function(){return e(this).val()!==""}),w=b.length>0,E="multipart/form-data",S=a.attr("enctype")==E||a.attr("encoding")==E,x=t.fileapi&&t.formdata;s("fileAPI :"+x);var T=(w||S)&&!x,N;r.iframe!==!1&&(r.iframe||T)?r.closeKeepAlive?e.get(r.closeKeepAlive,function(){N=A(p)}):N=A(p):(w||S)&&x?N=L(p):N=e.ajax(r),a.removeData("jqxhr").data("jqxhr",N);for(var C=0;C<c.length;C++)c[C]=null;return this.trigger("form-submit-notify",[this,r]),this},e.fn.ajaxForm=function(t){t=t||{},t.delegation=t.delegation&&e.isFunction(e.fn.on);if(!t.delegation&&this.length===0){var n={s:this.selector,c:this.context};return!e.isReady&&n.s?(s("DOM not ready, queuing ajaxForm"),e(function(){e(n.s,n.c).ajaxForm(t)}),this):(s("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return t.delegation?(e(document).off("submit.form-plugin",this.selector,r).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,t,r).on("click.form-plugin",this.selector,t,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",t,r).bind("click.form-plugin",t,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(n,r){var i=[];if(this.length===0)return i;var s=this[0],o=this.attr("id"),u=n?s.getElementsByTagName("*"):s.elements,a;u&&!/MSIE [678]/.test(navigator.userAgent)&&(u=e(u).get()),o&&(a=e(':input[form="'+o+'"]').get(),a.length&&(u=(u||[]).concat(a)));if(!u||!u.length)return i;var f,l,c,h,p,d,v;for(f=0,d=u.length;f<d;f++){p=u[f],c=p.name;if(!c||p.disabled)continue;if(n&&s.clk&&p.type=="image"){s.clk==p&&(i.push({name:c,value:e(p).val(),type:p.type}),i.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}));continue}h=e.fieldValue(p,!0);if(h&&h.constructor==Array){r&&r.push(p);for(l=0,v=h.length;l<v;l++)i.push({name:c,value:h[l]})}else if(t.fileapi&&p.type=="file"){r&&r.push(p);var m=p.files;if(m.length)for(l=0;l<m.length;l++)i.push({name:c,value:m[l],type:p.type});else i.push({name:c,value:"",type:p.type})}else h!==null&&typeof h!="undefined"&&(r&&r.push(p),i.push({name:c,value:h,type:p.type,required:p.required}))}if(!n&&s.clk){var g=e(s.clk),y=g[0];c=y.name,c&&!y.disabled&&y.type=="image"&&(i.push({name:c,value:g.val()}),i.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var r=this.name;if(!r)return;var i=e.fieldValue(this,t);if(i&&i.constructor==Array)for(var s=0,o=i.length;s<o;s++)n.push({name:r,value:i[s]});else i!==null&&typeof i!="undefined"&&n.push({name:this.name,value:i})}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;r<i;r++){var s=this[r],o=e.fieldValue(s,t);if(o===null||typeof o=="undefined"||o.constructor==Array&&!o.length)continue;o.constructor==Array?e.merge(n,o):n.push(o)}return n},e.fieldValue=function(t,n){var r=t.name,i=t.type,s=t.tagName.toLowerCase();n===undefined&&(n=!0);if(n&&(!r||t.disabled||i=="reset"||i=="button"||(i=="checkbox"||i=="radio")&&!t.checked||(i=="submit"||i=="image")&&t.form&&t.form.clk!=t||s=="select"&&t.selectedIndex==-1))return null;if(s=="select"){var o=t.selectedIndex;if(o<0)return null;var u=[],a=t.options,f=i=="select-one",l=f?o+1:a.length;for(var c=f?o:0;c<l;c++){var h=a[c];if(h.selected){var p=h.value;p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value);if(f)return p;u.push(p)}}return u}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,i=this.tagName.toLowerCase();n.test(r)||i=="textarea"?this.value="":r=="checkbox"||r=="radio"?this.checked=!1:i=="select"?this.selectedIndex=-1:r=="file"?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(r)||typeof t=="string"&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return e===undefined&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return t===undefined&&(t=!0),this.each(function(){var n=this.type;if(n=="checkbox"||n=="radio")this.checked=t;else if(this.tagName.toLowerCase()=="option"){var r=e(this).parent("select");t&&r[0]&&r[0].type=="select-one"&&r.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}),define("module/dialogs/erweima",["jquery","plugin/dialog","router","helper","plugin/jquery.easydrag","plugin/jquery.form"],function(e,t,n){var r={confirm:!1,list:[{text:"258*258px",val:258},{text:"344*344px",val:344},{text:"430*430px",val:430},{text:"860*860px",val:860},{text:"1280*1280px",val:1280}],template:['<form action="/audio_qrcode" enctype="multipart/form-data" method="post" >','   <div class="popup_dl img">','      <img class="img-code" src="" alt="" />',"   </div>",'   <div class="popup_dl">','      <div class="title fl">图案大小</div> ','      <div class="scroll fl">','          <span canTopMove="false" leftMin="0" minMovePosition="33" leftMax="134" class="scroll-block">|||</span>',"      </div>  ",'      <div class="scroll-value fr">258*258px</div>',"   </div>",'   <div class="popup_dl '+(e.browser.msie&&e.browser.version*1<=9?"hidden":"")+'">','      <div class="title fl">嵌入LOGO</div> ','      <a href="#" class="uploadPicBtn fl" name="upload">上传文件</a> ','      <input type="file" accept="image/*" class="hidden" name="logo_file" />',"   </div>",'   <input type="hidden" name="url" />','   <input type="hidden" name="size" value="258" />',"</form>",'<div class="operate"><a dialog-role="close" class="confirmBtn">保存</a>','<a class="cancelBtn" dialog-role="close">取消</a>',"</div>"],getCode:function(n,r){e.ajax({url:"/audio_qrcode",type:"POST",dataType:"JSON",data:{url:n,size:258},success:function(e){e.status=="success"?typeof r=="function"&&r(e.url):t.alert(e.error)}})},create:function(r,i){var s={dialogClass:"erweima",header:"编辑二维码",fixed:!0,width:450,height:488,content:this.template.join("")},o=new t.Dialog(s),u=this,a=null,f,l,c;u.confirm=!1,u.pop=o,u.$el=o.getEl(),a=u.$el.find(".scroll .scroll-block"),f=u.$el.find("[name='logo_file']"),c=u.$el.find("[name='upload']"),l=u.$el.find("[name='size']"),o.setPosition(),a.easydrag(!0,!0),a.ondrag(function(e,t){var n=a.position().left,r=Math.floor(n/(a.attr("minMovePosition")*1));u.$el.find(".scroll-value").text(u.list[r].text),l.val(u.list[r].val)}),f.on("change",function(e){var n=e.currentTarget.files;if(!n){c.text(e.currentTarget.value),u.$el.find("form").submit();return}if(n.length){var r=n[0],i=0;r.hasOwnProperty("size")?i=r.size:i=r.fileSize;if(i>2097152){t.alert("图片不能大于2M！");return}c.text(r.name),u.$el.find("form").submit()}}),c.on("click",function(){return f.click(),!1}),u.$el.find("[name='url']").val(i),u.$el.find("form").ajaxForm({dataType:"json",type:"post",success:function(e){e.status=="success"?(u.$el.find(".img-code").attr("src",e.url),u.confirm&&r.attr("src",e.url)):t.alert(e.error)}}),u.$el.find(".confirmBtn").on("click",function(){u.confirm=!0,u.$el.find("form").submit()}),u.$el.find("img").attr("src",r.attr("src")).on("click",function(){var t=e(this).attr("src");t&&n.toPage("/audio_qrcode?url="+t);return})}};return r}),define("module/dialogs/paysound",["jquery","plugin/dialog","module/dialogs/erweima"],function(e,t,n){var r={pop:function(e,n){var r=this._template(e.uid,n),i={template:{dialog_close:"",dialog_header:'<div class="hd3  " dialog-role="header"></div>',dialog_body:'<div class="bd1 " dialog-role="body"></div>'},dialogClass:"pop-c pop-pay",header:'<span class="btn1 fr"><span class="icon1 icon1-cha" dialog-role="close">×</span>	</span>付费内容友情提示',fixed:!1,content:r,noheadDrop:!0},s=new t.Dialog(i);this._pop=s,s.open();var o=s.getEl();this._bindEvent(o,e.id)},_bindEvent:function(e,t){var r=window.location.host,i="http://m."+(r.indexOf("www")>=0?r.substring(4):r)+"/sound/"+t;n.getCode(i,function(t){e.find(".erweima").attr("src",t)}),e.find(".js-showDownload").on("click",function(){e.find(".code-panel2").toggleClass("hidden")})},_template:function(e,t){var n=window.location.host,r=config.STATIC_PATH,i='<p class="row">	亲，这是一条付费内容，目前仅支持APP内'+(t||"下载收听")+"，请扫描下方二维码，打开APP完成付费哦~"+"</p>"+'<div class="mgtb-20">					'+'	<div class="code-panel1 inl-b"><img style="width:155px;height:155px;cursor:pointer;" class="erweima" alt="" /></div>'+'	<img src="'+r+'/css/img/common/cat6.png" alt="">'+"</div>";if(current_user.uid==e)var i='<div class="row">	<img class="fr mgl-20" src="'+r+'/css/img/common/cat6.png" alt="">'+"	亲，我们非常重视您的付费节目，为避免网络盗取，请您移步至"+'	<a class="rel js-showDownload" href="javascript:;" >'+"		喜马拉雅App"+'		<span class="abs code-panel2 hidden">'+'			<i class="icon icon-arrow1"></i>'+'			<img src="'+r+'/css/img/code_weixin.png" alt="">			'+"		</span>"+"	</a>"+"	"+(t||"查看收听")+"哦~"+"</div>";return i}};return r}),define("module/player/base",["jquery","underscore","backbone","./model","module/wave","router","module/dialogs/paysound"],function(e,t,n,r,i,s,o){var u=r.mainPlayer,a=r.playState,f=n.View.extend({_isFollower:!1,_$soundIds:null,_$playbtn:null,_soundId:"",_$progressbar:null,_$commentbar:null,_$seekbar:null,_$playbar:null,_$position:null,_$wavebox:null,_$nonius:null,_$noniusTime:null,_$commentbarBtn:null,_$noniusCover:null,events:helper.getEvents({"START_EV .play-list [hashlink]":"toPage","START_EV .playBtn:not(.disabled)":"play","START_EV .pauseBtn:not(.disabled)":"pause","click .player_progressbar":"seek"}),find:function(t){var n=this.$el;return n.find(t).filter(function(t){return!extensionPlayer.isInExtension(e(this))})},initialize:function(){var e=this.$el;this._soundId=e.attr("sound_id"),this._$soundIds=e.closest("[sound_ids]"),this._$playbtn=this.find(".playBtn,.pauseBtn"),this._$progressbar=this.find(".player_progressbar"),this._$commentbar=this.find(".player_commentbar"),this._$seekbar=this._$progressbar.find(".player_seekbar"),this._$playbar=this._$progressbar.find(".player_playbar"),this._$position=this.find(".sound_position"),this._$wavebox=this.find(".player_wavebox"),this._$nonius=this.find(".player_nonius"),this._$noniusTime=this.find(".player_nonius_time"),this._$noniusCover=this.find(".player_nonius_cover"),this._$commentbarBtn=this.find(".player_commentbarBtn"),this._$face=this.find(".sound_face"),this._$duration=this.find(".sound_duration"),this._$seekbar.size()&&t.extend(this.events,{"mousemove .player_progressbar":"onSeekbarMousemove"}),this._$nonius.size()&&t.extend(this.events,{"mouseenter .player_progressbar":"onSeekbarMouseenter","mouseleave .player_progressbar":"onSeekbarMouseleave"}),this._$progressbar.size()&&u.on("onSoundWhileplaying",this.onSoundWhileplaying,this),this._$commentbarBtn.size()&&t.extend(this.events,{"click .player_commentbarBtn":"onCommentbarBtnClick"}),u.on("change:playState",this.rendPlaybtn,this),u.on("onSoundUnexist",this.onSoundUnexist,this),u.on("onSoundIdSelect",this.onSoundIdSelect,this),u.on("onSoundNeedPay",this._onSoundNeedPay,this),u.on("onSoundPlay",this.onSoundPlay,this),u.on("onSoundPause",this.onSoundPause,this),u.on("onSoundResume",this.onSoundResume,this),u.on("onSoundStop",this.onSoundStop,this),u.on("onSoundFinish",this.onSoundFinish,this),u.on("onSoundPast",this.onSoundPast,this),u.on("onLoadError",this.onLoadError,this),u.soundId()==this._soundId&&this.rendPlaybtn()},isOnPlaying:function(){return this._$playbtn.is(".pauseBtn")},onCommentbarBtnClick:function(){this.$el.toggleClass("is-player-commentbarHidden",!this.$el.is(".is-player-commentbarHidden")),i.render({$container:this.$el,isManual:!0})},seekbarMouseenterTimeoutId:null,onSeekbarMouseenter:function(){var e=this;e.seekbarMouseenterTimeoutId&&clearTimeout(e.seekbarMouseenterTimeoutId),e.seekbarMouseenterTimeoutId=setTimeout(function(){e.isOnPlaying()&&e._$nonius.fadeIn(200)},200)},onSeekbarMouseleave:function(){clearTimeout(this.onSeekbarMousemoveTimeoutId),this.seekbarMouseenterTimeoutId&&clearTimeout(this.seekbarMouseenterTimeoutId),this.isOnPlaying()&&this._$nonius.hide()},onSoundIdSelect:function(e){if(e!=this._soundId)return;this.$el.trigger("onSoundIdSelect",[e])},onSoundPlay:function(e){if(u.soundId()!=this._soundId)return;this.$el.trigger("onSoundPlay",[e])},onSoundPause:function(e){if(u.soundId()!=this._soundId)return;this.$el.trigger("onSoundPause",[e])},onSoundResume:function(e){if(u.soundId()!=this._soundId)return;this.$el.trigger("onSoundResume",[e])},onSoundStop:function(e){if(u.soundId()!=this._soundId)return;this.$el.trigger("onSoundStop",[e])},onSoundFinish:function(e){if(u.soundId()!=this._soundId)return;this._$playbar.size()&&(this._$playbar.width(0),this._$position.text("00:00"),this._$nonius.hide()),this.$el.trigger("onSoundFinish",[e])},getSoundId:function(){return this._soundId},render:function(){},seek:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;if(!this.isOnPlaying()){this.play();return}var n=this._$progressbar,r=this._soundId,i=n.offset().left,s=n.width(),o=(t.clientX-i)/s;return u.seekInPrecent(o,r),!1},_lastLeft:0,onSeekbarMousemoveTimeoutId:-1,onSeekbarMousemove:function(e){var t=this;clearTimeout(this.onSeekbarMousemoveTimeoutId),this.onSeekbarMousemoveTimeoutId=setTimeout(function(){var n=t._$progressbar,r=e.clientX-n.offset().left,i=n.width(),s=t._soundId;if(Math.abs(r-t._lastLeft)<1)return!1;if(s===undefined)return;if(!t.isOnPlaying())return;if(r<0||r>i)return;var o=38;t._$nonius.is(".is-long")&&(o=48),r<o/2-4?t._$noniusTime.css("left",-r-4):r>i-(o/2-4)?t._$noniusTime.css("left",i-r+4-o):t._$noniusTime.css("left",-o/2),t._$nonius.css("left",r),t._$noniusCover.css({width:r+"px",left:-r+"px"}),u.getSoundBaseInfo(s,function(e){var n=e.duration,s=r/i*n,o=36e5;n>o&&t._$nonius.toggleClass("is-long",s>=o),t._$noniusTime.text(helper.getTime(s))})},0)},onSoundUnexist:function(e){if(e!=this._soundId)return!1;var t=this.$el;return this._$playbtn.addClass("disabled playBtn").removeClass("pauseBtn player-loading").attr("title","无法播放").css({cursor:"default"}),this._$commentbar.addClass("disabled"),t.find(".middlePlayer").addClass("disabled").attr("title","无法播放"),t.find(".sound_bottom").html(""),!0},_onSoundNeedPay:function(e){if(e.id!=this._soundId)return!1;var t=this.$el;return this._$playbtn.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","无法播放").css({cursor:"default"}),!0},onSoundWhileplaying:function(e,t){if(!this.isWorking())return!1;if(helper.isWindowBusy())return!1;var n=this._$progressbar;if(!n.size())return!1;var r=this._$playbar,i=this._$seekbar,s=n.width();if(r.size()){var o=t.position/t._duration_net;o=o>1?1:o,r.css("width",100*o+"%"),this._$position.text(helper.getTime(t.position))}if(i.size()){var o=t.bytesLoaded/t.bytesTotal;o=o>1?1:o,i.css("width",100*o+"%")}return!0},isWorking:function(){var e=u.soundId();if(e==this._soundId)return!0},rendPlaybtn:function(){if(!this.isWorking())return!1;var e=this._$playbtn,t=u.playState();return a.STOP==t||a.PAUSE==t?(e.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","播放"),this._$progressbar.attr("title","点击播放")):a.PLAYING==t?e.addClass("pauseBtn").removeClass("playBtn player-loading").attr("title","暂停"):a.BUFFERING==t&&e.addClass("player-loading").removeClass("playBtn pauseBtn").attr("title","加载中"),!0},onSoundPast:function(e){if(e.id!=this._soundId)return!1;var t=this._$playbtn;return t.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","播放"),this._$progressbar.attr("title","点击播放"),!0},onLoadError:function(e,t){if(e.id!=this._soundId)return!1;var n=this.$el;return n.attr("last_position",t),!0},toPage:function(t){var n=e(t.target),r=n.attr("href");if(!/^http\:/.test(r)){var i=n.attr("hashlink"),o=s.isToSub(i),r=o?s.hashlink(i):r;return s.toPage(r,o,i),!1}},play:function(t){var n=this,r=this.$el,i=r.attr("sound_id"),s=[];if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;r.is("[sound_restart=true]")||(this._$playbtn.addClass("player-loading").removeClass("playBtn pauseBtn").attr("title","加载中"),this._$progressbar.attr("title","")),e(".j-player-soundIdsWorking").removeClass("j-player-soundIdsWorking");if(this._$soundIds.size()){var a=this._$soundIds.addClass("j-player-soundIdsWorking").attr("sound_ids");s=a?a.split(","):[]}else s=[i];if(r.is("[last_position]")){var f=r.attr("last_position");r.removeAttr("last_position")}u.select(i,function(e){u.soundIds(s);var t=n.getPlayOptions();f&&(t.position=f),u.play(t)},function(e,t){!t.url&&t.is_paid&&o.pop(t)})},getPlayOptions:function(){var e={};return this.$el.is("[sound_restart=true]")&&(u.stop({position:0}),e.position=0),e},pause:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;this._$playbtn.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","播放"),u.pause()},release:function(){this.$el.off(),this.undelegateEvents(),u.off(null,null,this)}});return e("body").keydown(function(e){var t=e.target.tagName;if(t=="INPUT"||t=="TEXTAREA")return;if(e.keyCode===32)return u.isPaused()?u.play():u.pause(),!1;if(e.keyCode===39)return u.seekPlus(),!1;if(e.keyCode===37)return u.seekMinus(),!1;if(e.keyCode===40)return u.next(),!1;if(e.keyCode===38)return u.prev(),!1}),f}),define("module/player/extend/info",["jquery","underscore","backbone","helper","../model","../base"],function(e,t,n,r,i,s){var o=i.mainPlayer,u=t.template(['<div class="line"></div>','<div class="infobox-content">','<%if(soundfaceMiddle.indexOf("/css/")==-1){%>','<img style="cursor: pointer;" popsrc="<%=coverUrl%>" alt="简介" src="<%= soundfaceMiddle?(soundfaceMiddle):(config.STATIC_ROOT+\'/css/img/common/track_180.jpg\')%>">',"<%}else{%>","<img src=\"<%= soundfaceMiddle?(soundfaceMiddle):(config.STATIC_ROOT+'/css/img/common/track_180.jpg')%>\">","<%}%>","<%if(info){%>",'<p><%=info%><%if(haveMoreIntro){%>...  (<a class="c2" hashlink href="/<%= uid + "/sound/" + id+"/"%>">更多</a>)<%}%></p>',"<%}%>","</div>"].join("")),a=s.prototype,f=t.clone(a);return t.extend(a,{_$playCount:null,_$info:null,events:t.extend({"click .info":"showInfo"},f.events),initialize:function(){var e=this.$el;f.initialize.apply(this,arguments),this._$info=this.find(".info"),this._$playCount=this.find(".sound_playcount"),this._$playCount.size()&&o.on("change:sound",this.onChangeSound,this)},onChangeSound:function(e){if(this._soundId!=e.soundId())return;var t=parseInt(this._$playCount.eq(0).text(),10)+1,n=this._$playCount.eq(0).text().replace(/\d*/,t);this._$playCount.text(n).attr("title",t+"次播放")},showInfo:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;var n=this.$el,r=this._soundId;n.is(".open")?n.removeClass("open"):o.getSoundBaseInfo(r,function(e){var t=n.find(".infobox");n.addClass("open"),t.html(u(e))})}}),s}),define("module/player/extend/like",["jquery","underscore","backbone","helper","model/sound","../model","../base","plugin/dialog","module/dialogs/paysound"],function(e,t,n,r,i,s,o,u,a){var f=o.prototype,l=t.clone(f);return t.extend(f,{_$likebtn:null,_$likeCount:null,locked:!1,events:t.extend({"click .likeBtn:not(.is-sound-liked)":"_like","click .likeBtn.is-sound-liked":"_unlike"},l.events),initialize:function(){var e=this.$el;l.initialize.apply(this,arguments),this._$likebtn=this.find(".likeBtn"),this._$likeCount=this._$likebtn.find(".count")},like:function(t){if(!r.isLogin())return;if(!this._soundId)return;if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;var n=this,s=this._soundId,o=0,f=new i({id:s,isFavorited:!1});f.query({success:function(t){var r=t.toJSON();r.url?n.locked||(n.locked=!0,f.like(function(){f.set("id",s),f.query({success:function(t){t.set("isFavorited",!0);var n=e("[sound_id='"+s+"'] .likeBtn .count:eq(0)").text()*1;++n,t.set("favoritesCount",o),e("[sound_id='"+s+"'] .likeBtn .count").text(n)}}),n.renderLikeBtn(e("[sound_id='"+s+"']"),!0),n.doShowCartoon(!0)},function(e,t){u.alert(t.msg),n.locked=!1})):a.pop(f)}})},unlike:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;var n=this,r=this._soundId,s=0,o=new i({id:r,isFavorited:!0});n.locked||o.like(function(){o.set("id",r),o.query({success:function(t){t.set("isFavorited",!1);var n=e("[sound_id='"+r+"'] .likeBtn .count:eq(0)").text()*1;--n,t.set("favoritesCount",s),e("[sound_id='"+r+"'] .likeBtn .count").text(n)}}),n.renderLikeBtn(e("[sound_id='"+r+"']"),!1),n.doShowCartoon(!1)},function(e,t){u.alert(t.msg),n.locked=!1})},_like:function(e){current_user.uid&&this.getSoundInfo("like",e)},_unlike:function(e){current_user.uid&&this.getSoundInfo("unlike",e)},renderLikeBtn:function(e,t){var n=e.find(".imgLikeBtn,.likeBtn");n.size()&&(t?n.is(".imgLikeBtn")?n.addClass("liked").attr("取消赞"):n.is(".likeBtn")&&n.addClass("is-sound-liked").attr("取消赞"):n.is(".imgLikeBtn")?n.removeClass("liked").attr("赞"):n.is(".likeBtn")&&n.removeClass("is-sound-liked").attr("赞"))},doShowCartoon:function(e){var t=this;e?(this._$likebtn.addClass("is-like-animate-liked"),setTimeout(function(){t.locked=!1},500)):(this._$likebtn.removeClass("is-like-animate-liked"),t.locked=!1)}}),o}),define("model/user",["jquery","underscore","backbone","./cache"],function(e,t,n,r){var i=n.Model.extend({defaults:{id:"",nickname:"",logoPic:"",email:"",account:null,mobile:null,isVerified:!1,isCompleted:!0,isVEmail:!1,isVMobile:!1,isRobot:!1,province:"",city:"",town:null,country:"",personalSignature:"",ptitle:null,isGuideCompleted:!0,taskCompleteProfile:!0,taskFollow:!0,taskDownloadApp:!0,taskEmail:!1,vCompany:null,vTags:null,vCategoryId:null,deviceToken:null,isLoginBan:!1,isDeleted:!1,registerCategory:"",personDescribe:null,guidePlayPanel:!0,guideVoicePanel:!0,guideSharePanel:!0,createdTime:"",loginBanStart:null,loginBanEnd:null,isNotFollowing:!1,beFollowed:!1,tracksCount:0,followingsCount:0,followersCount:0,avatarUrl60:"",verifyType:0,anchorGrade:null,ids:[]},fetch:function(e){e=e||{};var r=this.id||"n"+this.get("nickname");t.extend(e,{url:"/"+r+"/card"}),n.Model.prototype.fetch.call(this,e)},parse:function(e){return{id:e.uid,nickname:e.nickname,logoPic:e.logoPic,email:e.email,account:e.account,mobile:e.mobile,isVerified:e.isVerified,isCompleted:e.isCompleted,isVEmail:e.isVEmail,isVMobile:e.isVMobile,isRobot:e.isRobot,province:e.province,city:e.city,town:e.town,country:e.country,personalSignature:e.personalSignature,ptitle:e.ptitle,isGuideCompleted:e.isGuideCompleted,taskCompleteProfile:e.taskCompleteProfile,taskFollow:e.taskFollow,taskDownloadApp:e.taskDownloadApp,taskEmail:e.taskEmail,vCompany:e.vCompany,vTags:e.vTags,vCategoryId:e.vCategoryId,deviceToken:e.deviceToken,isLoginBan:e.isLoginBan,isDeleted:e.isDeleted,registerCategory:e.registerCategory,personDescribe:e.personDescribe,guidePlayPanel:e.guidePlayPanel,guideVoicePanel:e.guideVoicePanel,guideSharePanel:e.guideSharePanel,createdTime:e.createdTime,loginBanStart:e.loginBanStart,loginBanEnd:e.loginBanEnd,isNotFollowing:e.is_not_following,beFollowed:e.be_followed,tracksCount:e.tracks_count,followingsCount:e.followings_count,followersCount:e.followers_count,avatarUrl60:e.avatar_url_60,verifyType:e.verifyType,anchorGrade:e.anchorGrade}},doFollow:function(t,n){var r=this,i="",s=r.get("id");t=t||e.noop,n=n||e.noop,i=r.get("isNotFollowing")?"create":"destroy",r.save(r.toJSON(),{url:"/followings/"+i,type:"post",dataType:"json",parse:!1,data:{following_uid:s},success:function(e,r,i){e.set("id",s),r.res!==!1?t(e,r,i):n(e,r,i)},error:function(e,t,r){n(e,null,r)}})},doMutiFollow:function(t,n,r){var i=this;t=t||e.noop,r=r||e.noop,n=r||e.noop,i.save({},{url:"/followings/group_create",type:"post",dataType:"json",data:{list:i.get("ids").join(",")},success:function(e,s,o){if(s["message"]=="create"){var u=i.cache.getCachedByIds(i.get("ids"));u&&u.models.length&&u.each(function(){var e=this;e.set("isNotFollowing",!e.get("isNotFollowing"))}),t(e,s,o)}else s["message"]=="login"?n(e,s,o):r(e,s,o)}})},doRemoveFans:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/followers/destroy",type:"post",dataType:"json",data:{uid:r.get("id")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},doChangeDes:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/passport/modifySignature",type:"post",dataType:"json",data:{personalSignature:r.get("personalSignature")},success:function(e,r,i){r.success===!0?t(e,r,i):n(e,r,i)}})},doChangeArea:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/passport/profile/location/save",type:"post",dataType:"json",data:{province:r.get("province"),city:r.get("city")},success:function(e,r,i){r.success===!0?t(e,r,i):n(e,r,i)}})}},{cache:new r({keys:["nickname"]})});return i}),define("plugin/jquery.placeholder",["jquery"],function(e){return e.fn.placeholder=function(t){var n={focusClass:"input_1",label:"span",text:""};return t=e.extend(n,t),this.each(function(){var n=e(this),r=n.find("input, textarea"),i=n.find(t.label);if(n.attr("is-placeholder"))return!0;n.attr("is-placeholder",!0),t.text&&i.text(t.text),n.click(function(){r.focus()});var s=function(){r.val()?i.hide():i.show()};r.bind({blur:function(){s(),n.removeClass(t.focusClass)},focus:function(){i.hide(),n.addClass(t.focusClass)}}),setTimeout(function(){s()},150);var o=function(){i.hide(),n.addClass(t.focusClass)};r.bind("keypress keydown keyup mousedown",o)}),this},e}),define("plugin/placeholder",["jquery","plugin/jquery.placeholder"],function(e){return function(t){window.console&&console.log("plugin/placeholder--->plugin/jquery.placeholder"),e(t).placeholder()}}),define("module/dialogs/city_data",[],function(){var e=[{name:"北京",has_child:!0,id:"108288",habitable:!0,children:[{population:0,id:"128519",name:"东城区",habitable:!1},{population:0,id:"128520",name:"西城区",habitable:!1},{population:0,id:"128521",name:"崇文区",habitable:!1},{population:0,id:"128522",name:"宣武区",habitable:!1},{population:0,id:"128523",name:"朝阳区",habitable:!1},{population:0,id:"128524",name:"丰台区",habitable:!1},{population:0,id:"128525",name:"石景山区",habitable:!1},{population:0,id:"128526",name:"海淀区",habitable:!1},{population:0,id:"128527",name:"门头沟区",habitable:!1},{population:0,id:"128528",name:"房山区",habitable:!1},{population:0,id:"128529",name:"通州区",habitable:!1},{population:0,id:"128530",name:"顺义区",habitable:!1},{population:0,id:"128531",name:"昌平区",habitable:!1},{population:0,id:"128532",name:"大兴区",habitable:!1},{population:0,id:"128533",name:"怀柔区",habitable:!1},{population:0,id:"128534",name:"平谷区",habitable:!1},{population:0,id:"128535",name:"密云县",habitable:!1},{population:0,id:"128536",name:"延庆县",habitable:!1}],population:1604009},{name:"上海",has_child:!0,id:"108296",habitable:!0,children:[{population:0,id:"129242",name:"黄浦区",habitable:!1},{population:0,id:"129243",name:"卢湾区",habitable:!1},{population:0,id:"129244",name:"徐汇区",habitable:!1},{population:0,id:"129245",name:"长宁区",habitable:!1},{population:0,id:"129246",name:"静安区",habitable:!1},{population:0,id:"129247",name:"普陀区",habitable:!1},{population:0,id:"129248",name:"闸北区",habitable:!1},{population:0,id:"129249",name:"虹口区",habitable:!1},{population:0,id:"129250",name:"杨浦区",habitable:!1},{population:0,id:"129251",name:"闵行区",habitable:!1},{population:0,id:"129252",name:"宝山区",habitable:!1},{population:0,id:"129253",name:"嘉定区",habitable:!1},{population:0,id:"129254",name:"浦东新区",habitable:!1},{population:0,id:"129255",name:"金山区",habitable:!1},{population:0,id:"129256",name:"松江区",habitable:!1},{population:0,id:"129257",name:"青浦区",habitable:!1},{population:0,id:"129258",name:"南汇区",habitable:!1},{population:0,id:"129259",name:"奉贤区",habitable:!1},{population:0,id:"129260",name:"崇明县",habitable:!1}],population:963775},{name:"深圳",has_child:!0,id:"118282",habitable:!0,children:[{population:0,id:"130288",name:"罗湖区",habitable:!1},{population:0,id:"130289",name:"福田区",habitable:!1},{population:0,id:"130290",name:"南山区",habitable:!1},{population:0,id:"130291",name:"宝安区",habitable:!1},{population:0,id:"130292",name:"龙岗区",habitable:!1},{population:0,id:"130293",name:"盐田区",habitable:!1}],population:438850},{name:"重庆",has_child:!0,id:"108309",habitable:!0,children:[{population:0,id:"130519",name:"万州区",habitable:!1},{population:0,id:"130520",name:"涪陵区",habitable:!1},{population:0,id:"130521",name:"渝中区",habitable:!1},{population:0,id:"130522",name:"大渡口区",habitable:!1},{population:0,id:"130523",name:"江北区",habitable:!1},{population:0,id:"130524",name:"沙坪坝区",habitable:!1},{population:0,id:"130525",name:"九龙坡区",habitable:!1},{population:0,id:"130526",name:"南岸区",habitable:!1},{population:0,id:"130527",name:"北碚区",habitable:!1},{population:0,id:"130528",name:"万盛区",habitable:!1},{population:0,id:"130529",name:"双桥区",habitable:!1},{population:0,id:"130530",name:"渝北区",habitable:!1},{population:0,id:"130531",name:"巴南区",habitable:!1},{population:0,id:"130532",name:"黔江区",habitable:!1},{population:0,id:"130533",name:"长寿区",habitable:!1},{population:0,id:"130534",name:"江津区",habitable:!1},{population:0,id:"130535",name:"合川区",habitable:!1},{population:0,id:"130536",name:"永川区",habitable:!1},{population:0,id:"130537",name:"南川区",habitable:!1},{population:0,id:"130538",name:"綦江县",habitable:!1},{population:0,id:"130539",name:"潼南县",habitable:!1},{population:0,id:"130540",name:"铜梁县",habitable:!1},{population:0,id:"130541",name:"大足县",habitable:!1},{population:0,id:"130542",name:"荣昌县",habitable:!1},{population:0,id:"130543",name:"璧山县",habitable:!1},{population:0,id:"130544",name:"梁平县",habitable:!1},{population:0,id:"130545",name:"城口县",habitable:!1},{population:0,id:"130546",name:"丰都县",habitable:!1},{population:0,id:"130547",name:"垫江县",habitable:!1},{population:0,id:"130548",name:"武隆县",habitable:!1},{population:0,id:"130549",name:"忠县",habitable:!1},{population:0,id:"130550",name:"开县",habitable:!1},{population:0,id:"130551",name:"云阳县",habitable:!1},{population:0,id:"130552",name:"奉节县",habitable:!1},{population:0,id:"130553",name:"巫山县",habitable:!1},{population:0,id:"130554",name:"巫溪县",habitable:!1},{population:0,id:"130555",name:"石柱",habitable:!1},{population:0,id:"130556",name:"秀山",habitable:!1},{population:0,id:"130557",name:"酉阳",habitable:!1},{population:0,id:"130558",name:"彭水",habitable:!1}],population:258584},{name:"天津",has_child:!0,id:"108289",habitable:!0,children:[{population:0,id:"128537",name:"和平区",habitable:!1},{population:0,id:"128538",name:"河东区",habitable:!1},{population:0,id:"128539",name:"河西区",habitable:!1},{population:0,id:"128540",name:"南开区",habitable:!1},{population:0,id:"128541",name:"河北区",habitable:!1},{population:0,id:"128542",name:"红桥区",habitable:!1},{population:0,id:"128543",name:"塘沽区",habitable:!1},{population:0,id:"128544",name:"汉沽区",habitable:!1},{population:0,id:"128545",name:"大港区",habitable:!1},{population:0,id:"128546",name:"东丽区",habitable:!1},{population:0,id:"128547",name:"西青区",habitable:!1},{population:0,id:"128548",name:"津南区",habitable:!1},{population:0,id:"128549",name:"北辰区",habitable:!1},{population:0,id:"128550",name:"武清区",habitable:!1},{population:0,id:"128551",name:"宝坻区",habitable:!1},{population:0,id:"128552",name:"宁河县",habitable:!1},{population:0,id:"128553",name:"静海县",habitable:!1},{population:0,id:"128554",name:"蓟县",habitable:!1},{population:0,id:"131436",name:"滨海新区",habitable:!1},{population:0,id:"131437",name:"保税区",habitable:!1}],population:250332}],t=[{name:"广东",has_child:!0,id:"108306",habitable:!1,children:[{population:696157,id:"118281",name:"广州",habitable:!0},{population:433868,id:"118282",name:"深圳",habitable:!0},{population:88957,id:"118297",name:"东莞",habitable:!0},{population:69691,id:"118286",name:"佛山",habitable:!0},{population:53720,id:"118284",name:"汕头",habitable:!0},{population:45549,id:"118283",name:"珠海",habitable:!0},{population:36161,id:"118291",name:"惠州",habitable:!0},{population:34733,id:"118298",name:"中山",habitable:!0},{population:33828,id:"118287",name:"江门",habitable:!0},{population:26297,id:"118300",name:"揭阳",habitable:!0},{population:25164,id:"118288",name:"湛江",habitable:!0},{population:20621,id:"118289",name:"茂名",habitable:!0},{population:20093,id:"118299",name:"潮州",habitable:!0},{population:18854,id:"118292",name:"梅州",habitable:!0},{population:17016,id:"118290",name:"肇庆",habitable:!0},{population:14455,id:"118285",name:"韶关",habitable:!0},{population:13321,id:"118296",name:"清远",habitable:!0},{population:12496,id:"118293",name:"汕尾",habitable:!0},{population:12285,id:"118294",name:"河源",habitable:!0},{population:10120,id:"118295",name:"阳江",habitable:!0},{population:8467,id:"118301",name:"云浮",habitable:!0},{population:1675,id:"128493",name:"开平",habitable:!0}],population:1657472},{name:"北京",has_child:!0,id:"108288",habitable:!0,children:[{population:0,id:"128519",name:"东城区",habitable:!1},{population:0,id:"128520",name:"西城区",habitable:!1},{population:0,id:"128521",name:"崇文区",habitable:!1},{population:0,id:"128522",name:"宣武区",habitable:!1},{population:0,id:"128523",name:"朝阳区",habitable:!1},{population:0,id:"128524",name:"丰台区",habitable:!1},{population:0,id:"128525",name:"石景山区",habitable:!1},{population:0,id:"128526",name:"海淀区",habitable:!1},{population:0,id:"128527",name:"门头沟区",habitable:!1},{population:0,id:"128528",name:"房山区",habitable:!1},{population:0,id:"128529",name:"通州区",habitable:!1},{population:0,id:"128530",name:"顺义区",habitable:!1},{population:0,id:"128531",name:"昌平区",habitable:!1},{population:0,id:"128532",name:"大兴区",habitable:!1},{population:0,id:"128533",name:"怀柔区",habitable:!1},{population:0,id:"128534",name:"平谷区",habitable:!1},{population:0,id:"128535",name:"密云县",habitable:!1},{population:0,id:"128536",name:"延庆县",habitable:!1}],population:1546204},{name:"上海",has_child:!0,id:"108296",habitable:!0,children:[{population:0,id:"129242",name:"黄浦区",habitable:!1},{population:0,id:"129243",name:"卢湾区",habitable:!1},{population:0,id:"129244",name:"徐汇区",habitable:!1},{population:0,id:"129245",name:"长宁区",habitable:!1},{population:0,id:"129246",name:"静安区",habitable:!1},{population:0,id:"129247",name:"普陀区",habitable:!1},{population:0,id:"129248",name:"闸北区",habitable:!1},{population:0,id:"129249",name:"虹口区",habitable:!1},{population:0,id:"129250",name:"杨浦区",habitable:!1},{population:0,id:"129251",name:"闵行区",habitable:!1},{population:0,id:"129252",name:"宝山区",habitable:!1},{population:0,id:"129253",name:"嘉定区",habitable:!1},{population:0,id:"129254",name:"浦东新区",habitable:!1},{population:0,id:"129255",name:"金山区",habitable:!1},{population:0,id:"129256",name:"松江区",habitable:!1},{population:0,id:"129257",name:"青浦区",habitable:!1},{population:0,id:"129258",name:"南汇区",habitable:!1},{population:0,id:"129259",name:"奉贤区",habitable:!1},{population:0,id:"129260",name:"崇明县",habitable:!1}],population:929103},{name:"江苏",has_child:!0,id:"108297",habitable:!1,children:[{population:334289,id:"118159",name:"南京",habitable:!0},{population:169621,id:"118163",name:"苏州",habitable:!0},{population:97963,id:"118160",name:"无锡",habitable:!0},{population:59563,id:"118162",name:"常州",habitable:!0},{population:58255,id:"118161",name:"徐州",habitable:!0},{population:41965,id:"118164",name:"南通",habitable:!0},{population:35019,id:"118168",name:"扬州",habitable:!0},{population:26666,id:"118167",name:"盐城",habitable:!0},{population:24828,id:"118165",name:"连云港",habitable:!0},{population:22721,id:"118169",name:"镇江",habitable:!0},{population:22178,id:"118170",name:"泰州",habitable:!0},{population:19969,id:"118166",name:"淮安",habitable:!0},{population:14187,id:"118171",name:"宿迁",habitable:!0},{population:5351,id:"131411",name:"昆山",habitable:!0},{population:3394,id:"131413",name:"常熟",habitable:!0},{population:1451,id:"131414",name:"吴江",habitable:!0},{population:1156,id:"128505",name:"海安",habitable:!0},{population:1155,id:"131482",name:"张家港",habitable:!0}],population:917372},{name:"浙江",has_child:!0,id:"108298",habitable:!1,children:[{population:376145,id:"118172",name:"杭州",habitable:!0},{population:169679,id:"118174",name:"温州",habitable:!0},{population:114676,id:"118173",name:"宁波",habitable:!0},{population:60033,id:"118181",name:"台州",habitable:!0},{population:57370,id:"118178",name:"金华",habitable:!0},{population:44550,id:"118175",name:"嘉兴",habitable:!0},{population:42982,id:"118177",name:"绍兴",habitable:!0},{population:21757,id:"118176",name:"湖州",habitable:!0},{population:16342,id:"118182",name:"丽水",habitable:!0},{population:13001,id:"118179",name:"衢州",habitable:!0},{population:12474,id:"118180",name:"舟山",habitable:!0}],population:909356},{name:"湖北",has_child:!0,id:"108304",habitable:!1,children:[{population:471150,id:"118254",name:"武汉",habitable:!0},{population:25390,id:"118259",name:"宜昌",habitable:!0},{population:21305,id:"118258",name:"荆州",habitable:!0},{population:20511,id:"118256",name:"襄樊",habitable:!0},{population:14865,id:"118257",name:"十堰",habitable:!0},{population:14439,id:"118263",name:"黄冈",habitable:!0},{population:12940,id:"118255",name:"黄石",habitable:!0},{population:12923,id:"118262",name:"孝感",habitable:!0},{population:10007,id:"118260",name:"荆门",habitable:!0},{population:8847,id:"118264",name:"咸宁",habitable:!0},{population:8401,id:"118266",name:"恩施",habitable:!0},{population:5747,id:"118265",name:"随州",habitable:!0},{population:5503,id:"118261",name:"鄂州",habitable:!0},{population:5305,id:"128465",name:"仙桃",habitable:!0},{population:3806,id:"128464",name:"天门",habitable:!0},{population:3540,id:"128466",name:"潜江",habitable:!0},{population:1100,id:"130143",name:"神农架林区",habitable:!0}],population:633074},{name:"四川",has_child:!0,id:"108310",habitable:!1,children:[{population:417894,id:"118318",name:"成都",habitable:!0},{population:25776,id:"118323",name:"绵阳",habitable:!0},{population:18713,id:"118328",name:"南充",habitable:!0},{population:14934,id:"118322",name:"德阳",habitable:!0},{population:13978,id:"118331",name:"达州",habitable:!0},{population:13505,id:"118327",name:"乐山",habitable:!0},{population:13251,id:"118329",name:"宜宾",habitable:!0},{population:11047,id:"118326",name:"内江",habitable:!0},{population:10895,id:"118319",name:"自贡",habitable:!0},{population:10615,id:"118321",name:"泸州",habitable:!0},{population:9588,id:"118325",name:"遂宁",habitable:!0},{population:8639,id:"118330",name:"广安",habitable:!0},{population:7635,id:"118332",name:"眉山",habitable:!0},{population:7325,id:"118324",name:"广元",habitable:!0},{population:6973,id:"118320",name:"攀枝花",habitable:!0},{population:6806,id:"118335",name:"资阳",habitable:!0},{population:5726,id:"118334",name:"巴中",habitable:!0},{population:5650,id:"118338",name:"凉山",habitable:!0},{population:5594,id:"118333",name:"雅安",habitable:!0},{population:2463,id:"118336",name:"阿坝",habitable:!0},{population:1706,id:"118337",name:"甘孜",habitable:!0}],population:633048},{name:"山东",has_child:!0,id:"108302",habitable:!1,children:[{population:144708,id:"118221",name:"青岛",habitable:!0},{population:140182,id:"118220",name:"济南",habitable:!0},{population:54419,id:"118226",name:"烟台",habitable:!0},{population:39890,id:"118225",name:"潍坊",habitable:!0},{population:35098,id:"118232",name:"临沂",habitable:!0},{population:33734,id:"118222",name:"淄博",habitable:!0},{population:31868,id:"118228",name:"济宁",habitable:!0},{population:23475,id:"118227",name:"威海",habitable:!0},{population:20393,id:"118229",name:"泰安",habitable:!0},{population:15799,id:"118234",name:"聊城",habitable:!0},{population:15559,id:"118223",name:"枣庄",habitable:!0},{population:15312,id:"118224",name:"东营",habitable:!0},{population:15065,id:"118236",name:"菏泽",habitable:!0},{population:13904,id:"118230",name:"日照",habitable:!0},{population:12469,id:"118233",name:"德州",habitable:!0},{population:10509,id:"118235",name:"滨州",habitable:!0},{population:5243,id:"118231",name:"莱芜",habitable:!0}],population:629980},{name:"福建",has_child:!0,id:"108300",habitable:!1,children:[{population:195593,id:"118200",name:"福州",habitable:!0},{population:136826,id:"118201",name:"厦门",habitable:!0},{population:92803,id:"118204",name:"泉州",habitable:!0},{population:23231,id:"118205",name:"漳州",habitable:!0},{population:22003,id:"118202",name:"莆田",habitable:!0},{population:19161,id:"118208",name:"宁德",habitable:!0},{population:17854,id:"118203",name:"三明",habitable:!0},{population:16999,id:"118207",name:"龙岩",habitable:!0},{population:15106,id:"118206",name:"南平",habitable:!0}],population:529836},{name:"河南",has_child:!0,id:"108303",habitable:!1,children:[{population:259891,id:"118237",name:"郑州",habitable:!0},{population:44848,id:"118239",name:"洛阳",habitable:!0},{population:23372,id:"118243",name:"新乡",habitable:!0},{population:21367,id:"118249",name:"南阳",habitable:!0},{population:18312,id:"118244",name:"安阳",habitable:!0},{population:18307,id:"118251",name:"信阳",habitable:!0},{population:18046,id:"118240",name:"平顶山",habitable:!0},{population:17147,id:"118241",name:"焦作",habitable:!0},{population:15013,id:"118238",name:"开封",habitable:!0},{population:14957,id:"118250",name:"商丘",habitable:!0},{population:14720,id:"118252",name:"周口",habitable:!0},{population:14684,id:"118246",name:"许昌",habitable:!0},{population:11223,id:"118253",name:"驻马店",habitable:!0},{population:10958,id:"118245",name:"濮阳",habitable:!0},{population:9126,id:"118247",name:"漯河",habitable:!0},{population:9077,id:"118248",name:"三门峡",habitable:!0},{population:5248,id:"118242",name:"鹤壁",habitable:!0},{population:4028,id:"128517",name:"济源",habitable:!0}],population:520329},{name:"辽宁",has_child:!0,id:"108293",habitable:!1,children:[{population:167632,id:"118123",name:"沈阳",habitable:!0},{population:138130,id:"118124",name:"大连",habitable:!0},{population:25924,id:"118125",name:"鞍山",habitable:!0},{population:20497,id:"118135",name:"朝阳",habitable:!0},{population:18321,id:"118129",name:"锦州",habitable:!0},{population:15186,id:"118130",name:"营口",habitable:!0},{population:14679,id:"118126",name:"抚顺",habitable:!0},{population:12480,id:"118128",name:"丹东",habitable:!0},{population:12042,id:"118133",name:"盘锦",habitable:!0},{population:11883,id:"118136",name:"葫芦岛",habitable:!0},{population:10742,id:"118132",name:"辽阳",habitable:!0},{population:10640,id:"118134",name:"铁岭",habitable:!0},{population:9982,id:"118127",name:"本溪",habitable:!0},{population:9181,id:"118131",name:"阜新",habitable:!0}],population:469786},{name:"陕西",has_child:!0,id:"108314",habitable:!1,children:[{population:334496,id:"118371",name:"西安",habitable:!0},{population:15788,id:"118373",name:"宝鸡",habitable:!0},{population:15727,id:"118374",name:"咸阳",habitable:!0},{population:14109,id:"118375",name:"渭南",habitable:!0},{population:13120,id:"118378",name:"榆林",habitable:!0},{population:11230,id:"118377",name:"汉中",habitable:!0},{population:9975,id:"118376",name:"延安",habitable:!0},{population:7584,id:"118379",name:"安康",habitable:!0},{population:5029,id:"118380",name:"商洛",habitable:!0},{population:4072,id:"118372",name:"铜川",habitable:!0},{population:1184,id:"131409",name:"杨凌",habitable:!0}],population:423191},{name:"湖南",has_child:!0,id:"108305",habitable:!1,children:[{population:262472,id:"118267",name:"长沙",habitable:!0},{population:20858,id:"118270",name:"衡阳",habitable:!0},{population:19339,id:"118268",name:"株洲",habitable:!0},{population:16714,id:"118269",name:"湘潭",habitable:!0},{population:16051,id:"118273",name:"常德",habitable:!0},{population:15268,id:"118272",name:"岳阳",habitable:!0},{population:13295,id:"118276",name:"郴州",habitable:!0},{population:12883,id:"118271",name:"邵阳",habitable:!0},{population:11449,id:"118278",name:"怀化",habitable:!0},{population:8470,id:"118275",name:"益阳",habitable:!0},{population:8361,id:"118279",name:"娄底",habitable:!0},{population:8060,id:"118277",name:"永州",habitable:!0},{population:5314,id:"118280",name:"湘西",habitable:!0},{population:5151,id:"118274",name:"张家界",habitable:!0}],population:415324},{name:"河北",has_child:!0,id:"108290",habitable:!1,children:[{population:106069,id:"118088",name:"石家庄",habitable:!0},{population:47965,id:"118093",name:"保定",habitable:!0},{population:41838,id:"118089",name:"唐山",habitable:!0},{population:30017,id:"118091",name:"邯郸",habitable:!0},{population:27845,id:"118090",name:"秦皇岛",habitable:!0},{population:23342,id:"118096",name:"沧州",habitable:!0},{population:22230,id:"118092",name:"邢台",habitable:!0},{population:18816,id:"118097",name:"廊坊",habitable:!0},{population:14683,id:"118094",name:"张家口",habitable:!0},{population:12375,id:"118098",name:"衡水",habitable:!0},{population:11269,id:"118095",name:"承德",habitable:!0}],population:348695},{name:"安徽",has_child:!0,id:"108299",habitable:!1,children:[{population:112192,id:"118183",name:"合肥",habitable:!0},{population:25658,id:"118184",name:"芜湖",habitable:!0},{population:18850,id:"118190",name:"安庆",habitable:!0},{population:17852,id:"118193",name:"阜阳",habitable:!0},{population:14429,id:"118185",name:"蚌埠",habitable:!0},{population:13247,id:"118186",name:"淮南",habitable:!0},{population:12763,id:"118187",name:"马鞍山",habitable:!0},{population:10573,id:"118196",name:"六安",habitable:!0},{population:10462,id:"118192",name:"滁州",habitable:!0},{population:9922,id:"118194",name:"宿州",habitable:!0},{population:9522,id:"118188",name:"淮北",habitable:!0},{population:9457,id:"118195",name:"巢湖",habitable:!0},{population:8324,id:"118199",name:"宣城",habitable:!0},{population:8049,id:"118191",name:"黄山",habitable:!0},{population:7734,id:"118197",name:"亳州",habitable:!0},{population:6347,id:"118189",name:"铜陵",habitable:!0},{population:4855,id:"118198",name:"池州",habitable:!0}],population:297027},{name:"黑龙江",has_child:!0,id:"108295",habitable:!1,children:[{population:160231,id:"118146",name:"哈尔滨",habitable:!0},{population:23262,id:"118151",name:"大庆",habitable:!0},{population:19326,id:"118147",name:"齐齐哈尔",habitable:!0},{population:17487,id:"118153",name:"牡丹江",habitable:!0},{population:13388,id:"118154",name:"佳木斯",habitable:!0},{population:9352,id:"118148",name:"鸡西",habitable:!0},{population:8823,id:"118157",name:"绥化",habitable:!0},{population:7516,id:"118150",name:"双鸭山",habitable:!0},{population:6327,id:"118156",name:"黑河",habitable:!0},{population:5797,id:"118149",name:"鹤岗",habitable:!0},{population:5665,id:"118152",name:"伊春",habitable:!0},{population:5106,id:"118155",name:"七台河",habitable:!0},{population:3125,id:"118158",name:"大兴安岭",habitable:!0}],population:279680},{name:"重庆",has_child:!0,id:"108309",habitable:!0,children:[{population:0,id:"130519",name:"万州区",habitable:!1},{population:0,id:"130520",name:"涪陵区",habitable:!1},{population:0,id:"130521",name:"渝中区",habitable:!1},{population:0,id:"130522",name:"大渡口区",habitable:!1},{population:0,id:"130523",name:"江北区",habitable:!1},{population:0,id:"130524",name:"沙坪坝区",habitable:!1},{population:0,id:"130525",name:"九龙坡区",habitable:!1},{population:0,id:"130526",name:"南岸区",habitable:!1},{population:0,id:"130527",name:"北碚区",habitable:!1},{population:0,id:"130528",name:"万盛区",habitable:!1},{population:0,id:"130529",name:"双桥区",habitable:!1},{population:0,id:"130530",name:"渝北区",habitable:!1},{population:0,id:"130531",name:"巴南区",habitable:!1},{population:0,id:"130532",name:"黔江区",habitable:!1},{population:0,id:"130533",name:"长寿区",habitable:!1},{population:0,id:"130534",name:"江津区",habitable:!1},{population:0,id:"130535",name:"合川区",habitable:!1},{population:0,id:"130536",name:"永川区",habitable:!1},{population:0,id:"130537",name:"南川区",habitable:!1},{population:0,id:"130538",name:"綦江县",habitable:!1},{population:0,id:"130539",name:"潼南县",habitable:!1},{population:0,id:"130540",name:"铜梁县",habitable:!1},{population:0,id:"130541",name:"大足县",habitable:!1},{population:0,id:"130542",name:"荣昌县",habitable:!1},{population:0,id:"130543",name:"璧山县",habitable:!1},{population:0,id:"130544",name:"梁平县",habitable:!1},{population:0,id:"130545",name:"城口县",habitable:!1},{population:0,id:"130546",name:"丰都县",habitable:!1},{population:0,id:"130547",name:"垫江县",habitable:!1},{population:0,id:"130548",name:"武隆县",habitable:!1},{population:0,id:"130549",name:"忠县",habitable:!1},{population:0,id:"130550",name:"开县",habitable:!1},{population:0,id:"130551",name:"云阳县",habitable:!1},{population:0,id:"130552",name:"奉节县",habitable:!1},{population:0,id:"130553",name:"巫山县",habitable:!1},{population:0,id:"130554",name:"巫溪县",habitable:!1},{population:0,id:"130555",name:"石柱",habitable:!1},{population:0,id:"130556",name:"秀山",habitable:!1},{population:0,id:"130557",name:"酉阳",habitable:!1},{population:0,id:"130558",name:"彭水",habitable:!1}],population:248174},{name:"天津",has_child:!0,id:"108289",habitable:!0,children:[{population:0,id:"128537",name:"和平区",habitable:!1},{population:0,id:"128538",name:"河东区",habitable:!1},{population:0,id:"128539",name:"河西区",habitable:!1},{population:0,id:"128540",name:"南开区",habitable:!1},{population:0,id:"128541",name:"河北区",habitable:!1},{population:0,id:"128542",name:"红桥区",habitable:!1},{population:0,id:"128543",name:"塘沽区",habitable:!1},{population:0,id:"128544",name:"汉沽区",habitable:!1},{population:0,id:"128545",name:"大港区",habitable:!1},{population:0,id:"128546",name:"东丽区",habitable:!1},{population:0,id:"128547",name:"西青区",habitable:!1},{population:0,id:"128548",name:"津南区",habitable:!1},{population:0,id:"128549",name:"北辰区",habitable:!1},{population:0,id:"128550",name:"武清区",habitable:!1},{population:0,id:"128551",name:"宝坻区",habitable:!1},{population:0,id:"128552",name:"宁河县",habitable:!1},{population:0,id:"128553",name:"静海县",habitable:!1},{population:0,id:"128554",name:"蓟县",habitable:!1},{population:0,id:"131436",name:"开发区",habitable:!1}],population:240945},{name:"广西",has_child:!0,id:"108307",habitable:!1,children:[{population:88659,id:"118302",name:"南宁",habitable:!0},{population:35205,id:"118304",name:"桂林",habitable:!0},{population:29018,id:"118303",name:"柳州",habitable:!0},{population:15621,id:"118310",name:"玉林",habitable:!0},{population:9537,id:"118305",name:"梧州",habitable:!0},{population:9041,id:"118306",name:"北海",habitable:!0},{population:8799,id:"118309",name:"贵港",habitable:!0},{population:6901,id:"118311",name:"百色",habitable:!0},{population:6826,id:"118308",name:"钦州",habitable:!0},{population:6779,id:"118313",name:"河池",habitable:!0},{population:5366,id:"118312",name:"贺州",habitable:!0},{population:4059,id:"118307",name:"防城港",habitable:!0},{population:3583,id:"118314",name:"来宾",habitable:!0},{population:2969,id:"118315",name:"崇左",habitable:!0}],population:227884},{name:"山西",has_child:!0,id:"108291",habitable:!1,children:[{population:80513,id:"118099",name:"太原",habitable:!0},{population:22751,id:"118107",name:"运城",habitable:!0},{population:19937,id:"118100",name:"大同",habitable:!0},{population:18990,id:"118109",name:"临汾",habitable:!0},{population:15441,id:"118110",name:"吕梁",habitable:!0},{population:14951,id:"118106",name:"晋中",habitable:!0},{population:13392,id:"118103",name:"长治",habitable:!0},{population:11786,id:"118104",name:"晋城",habitable:!0},{population:11532,id:"118108",name:"忻州",habitable:!0},{population:9064,id:"118102",name:"阳泉",habitable:!0},{population:5424,id:"118105",name:"朔州",habitable:!0},{population:731,id:"118101",name:"大宁",habitable:!0}],population:219421},{name:"吉林",has_child:!0,id:"108294",habitable:!1,children:[{population:125269,id:"118137",name:"长春",habitable:!0},{population:29113,id:"129059",name:"吉林",habitable:!0},{population:10970,id:"118145",name:"延边",habitable:!0},{population:10425,id:"118139",name:"四平",habitable:!0},{population:9040,id:"118141",name:"通化",habitable:!0},{population:8194,id:"118143",name:"松原",habitable:!0},{population:7116,id:"118142",name:"白山",habitable:!0},{population:6248,id:"118144",name:"白城",habitable:!0},{population:4692,id:"118140",name:"辽源",habitable:!0}],population:208785},{name:"江西",has_child:!0,id:"108301",habitable:!1,children:[{population:98919,id:"118209",name:"南昌",habitable:!0},{population:24686,id:"118215",name:"赣州",habitable:!0},{population:19466,id:"118212",name:"九江",habitable:!0},{population:13744,id:"118219",name:"上饶",habitable:!0},{population:11824,id:"118217",name:"宜春",habitable:!0},{population:9747,id:"118216",name:"吉安",habitable:!0},{population:9020,id:"118210",name:"景德镇",habitable:!0},{population:8631,id:"118218",name:"抚州",habitable:!0},{population:7281,id:"118211",name:"萍乡",habitable:!0},{population:5610,id:"118213",name:"新余",habitable:!0},{population:4810,id:"118214",name:"鹰潭",habitable:!0}],population:208691},{name:"云南",has_child:!0,id:"108312",habitable:!1,children:[{population:103101,id:"118348",name:"昆明",habitable:!0},{population:10587,id:"118360",name:"大理",habitable:!0},{population:9891,id:"118349",name:"曲靖",habitable:!0},{population:7530,id:"118350",name:"玉溪",habitable:!0},{population:7159,id:"118353",name:"丽江",habitable:!0},{population:7132,id:"118357",name:"红河",habitable:!0},{population:5312,id:"118352",name:"昭通",habitable:!0},{population:4383,id:"118358",name:"西双版纳",habitable:!0},{population:4057,id:"118356",name:"文山",habitable:!0},{population:3819,id:"118359",name:"楚雄",habitable:!0},{population:3567,id:"118361",name:"德宏",habitable:!0},{population:3511,id:"118351",name:"保山",habitable:!0},{population:2947,id:"118355",name:"临沧",habitable:!0},{population:2222,id:"130880",name:"普洱",habitable:!0},{population:1433,id:"118354",name:"思茅",habitable:!0},{population:1211,id:"118363",name:"迪庆",habitable:!0},{population:1047,id:"118362",name:"怒江",habitable:!0},{population:870,id:"130945",name:"德宏景颇族",habitable:!0}],population:176023},{name:"内蒙古",has_child:!0,id:"108292",habitable:!1,children:[{population:33094,id:"118111",name:"呼和浩特",habitable:!0},{population:19667,id:"118112",name:"包头",habitable:!0},{population:13455,id:"118117",name:"呼伦贝尔",habitable:!0},{population:11705,id:"118114",name:"赤峰",habitable:!0},{population:8441,id:"118116",name:"鄂尔多斯",habitable:!0},{population:8260,id:"118115",name:"通辽",habitable:!0},{population:5270,id:"118118",name:"巴彦淖尔",habitable:!0},{population:4013,id:"118113",name:"乌海",habitable:!0},{population:3633,id:"118119",name:"乌兰察布",habitable:!0},{population:3249,id:"118120",name:"锡林郭勒",habitable:!0},{population:2831,id:"118122",name:"兴安",habitable:!0},{population:1943,id:"128932",name:"锡林郭勒盟",habitable:!0},{population:1542,id:"118121",name:"阿拉善",habitable:!0},{population:1522,id:"128925",name:"兴安盟",habitable:!0},{population:1083,id:"128945",name:"阿拉善盟",habitable:!0}],population:117114},{name:"贵州",has_child:!0,id:"108311",habitable:!1,children:[{population:51710,id:"118339",name:"贵阳",habitable:!0},{population:14783,id:"118341",name:"遵义",habitable:!0},{population:6392,id:"118340",name:"六盘水",habitable:!0},{population:6374,id:"118346",name:"黔东南",habitable:!0},{population:5845,id:"118344",name:"毕节",habitable:!0},{population:5367,id:"118342",name:"安顺",habitable:!0},{population:5137,id:"118347",name:"黔南",habitable:!0},{population:4837,id:"118343",name:"铜仁",habitable:!0},{population:4246,id:"118345",name:"黔西南",habitable:!0}],population:102674},{name:"甘肃",has_child:!0,id:"108315",habitable:!1,children:[{population:48162,id:"118381",name:"兰州",habitable:!0},{population:7619,id:"118384",name:"天水",habitable:!0},{population:4989,id:"118390",name:"庆阳",habitable:!0},{population:4684,id:"118389",name:"酒泉",habitable:!0},{population:4250,id:"118383",name:"白银",habitable:!0},{population:3999,id:"118388",name:"平凉",habitable:!0},{population:3233,id:"118386",name:"武威",habitable:!0},{population:2950,id:"118387",name:"张掖",habitable:!0},{population:2856,id:"118392",name:"陇南",habitable:!0},{population:2852,id:"118385",name:"嘉峪关",habitable:!0},{population:2416,id:"118382",name:"金昌",habitable:!0},{population:2373,id:"118391",name:"定西",habitable:!0},{population:1790,id:"118393",name:"临夏",habitable:!0},{population:1367,id:"118394",name:"甘南",habitable:!0}],population:93197},{name:"新疆",has_child:!0,id:"108318",habitable:!1,children:[{population:44012,id:"118408",name:"乌鲁木齐",habitable:!0},{population:3780,id:"118409",name:"克拉玛依",habitable:!0},{population:3628,id:"128496",name:"石河子",habitable:!0},{population:3609,id:"118419",name:"伊犁",habitable:!0},{population:3329,id:"118417",name:"昌吉",habitable:!0},{population:2540,id:"118413",name:"阿克苏",habitable:!0},{population:2184,id:"131317",name:"巴音郭楞州",habitable:!0},{population:2153,id:"118416",name:"巴音郭楞",habitable:!0},{population:2113,id:"118414",name:"喀什",habitable:!0},{population:1913,id:"118411",name:"哈密",habitable:!0},{population:1645,id:"118421",name:"阿勒泰",habitable:!0},{population:1291,id:"118420",name:"塔城",habitable:!0},{population:1058,id:"118410",name:"吐鲁番",habitable:!0},{population:1e3,id:"131313",name:"博尔塔拉州",habitable:!0},{population:955,id:"118418",name:"博尔塔拉",habitable:!0},{population:901,id:"118412",name:"和田",habitable:!0},{population:714,id:"131385",name:"阿拉尔",habitable:!0},{population:681,id:"131336",name:"克孜勒苏柯尔克孜",habitable:!0},{population:552,id:"118415",name:"克孜勒苏",habitable:!0},{population:540,id:"131386",name:"图木舒克",habitable:!0}],population:75689},{name:"海南",has_child:!0,id:"108308",habitable:!1,children:[{population:37468,id:"118316",name:"海口",habitable:!0},{population:12773,id:"118317",name:"三亚",habitable:!0},{population:3125,id:"131407",name:"琼海",habitable:!0},{population:2772,id:"131433",name:"儋州",habitable:!0},{population:379,id:"131497",name:"文昌",habitable:!0},{population:282,id:"131492",name:"保亭",habitable:!0}],population:55300},{name:"宁夏",has_child:!0,id:"108317",habitable:!1,children:[{population:25267,id:"118403",name:"银川",habitable:!0},{population:4556,id:"118404",name:"石嘴山",habitable:!0},{population:3940,id:"118405",name:"吴忠",habitable:!0},{population:3320,id:"118406",name:"固原",habitable:!0},{population:3131,id:"118407",name:"中卫",habitable:!0}],population:39275},{name:"青海",has_child:!0,id:"108316",habitable:!1,children:[{population:17769,id:"118395",name:"西宁",habitable:!0},{population:2464,id:"118402",name:"海西",habitable:!0},{population:2268,id:"118396",name:"海东",habitable:!0},{population:1670,id:"118399",name:"海南",habitable:!0},{population:1576,id:"118397",name:"海北",habitable:!0},{population:1481,id:"118401",name:"玉树",habitable:!0},{population:1455,id:"118400",name:"果洛",habitable:!0},{population:1303,id:"118398",name:"黄南",habitable:!0}],population:29190},{name:"西藏",has_child:!0,id:"108313",habitable:!1,children:[{population:8254,id:"118364",name:"拉萨",habitable:!0},{population:2570,id:"118368",name:"日喀则",habitable:!0},{population:2146,id:"118370",name:"林芝",habitable:!0},{population:1994,id:"118369",name:"阿里",habitable:!0},{population:1971,id:"118365",name:"那曲",habitable:!0},{population:1957,id:"118367",name:"山南",habitable:!0},{population:1954,id:"118366",name:"昌都",habitable:!0}],population:19949},{name:"香港",has_child:!0,habitable:!1,children:[{id:3365,name:"沙田区"},{id:3366,name:"东区"},{id:3367,name:"观塘区"},{id:3368,name:"黄大仙区"},{id:3369,name:"九龙城区"},{id:3370,name:"屯门区"},{id:3371,name:"葵青区"},{id:3372,name:"元朗区"},{id:3373,name:"深水埗区"},{id:3374,name:"西贡区"},{id:3375,name:"大埔区"},{id:3376,name:"湾仔区"},{id:3377,name:"油尖旺区"},{id:3378,name:"北区",lat:22.391577,lon:114},{id:3379,name:"南区"},{id:3380,name:"荃湾区"},{id:3381,name:"中西区"},{id:3382,name:"离岛区"}],population:19949},{name:"澳门",has_child:!0,habitable:!1,children:[{name:"花地玛堂区"},{name:"圣安多尼堂区"},{name:"大堂区"},{name:"望德堂区"},{name:"风顺堂区"}],population:19949},{name:"台湾",has_child:!0,habitable:!1,children:[{id:3384,name:"台北"},{id:3385,name:"高雄"},{id:3386,name:"基隆"},{id:3387,name:"台中"},{id:3388,name:"台南"},{id:3389,name:"新竹"},{id:3390,name:"嘉义"},{id:3391,name:"宜兰县"},{id:3392,name:"桃园县"},{id:3393,name:"苗栗县"},{id:3394,name:"彰化县"},{id:3395,name:"南投县"},{id:3396,name:"云林县"},{id:3397,name:"屏东县"},{id:3398,name:"台东县"},{id:3399,name:"花莲县"},{id:3400,name:"澎湖县"}],population:19949},{name:"海外",has_child:!0,children:[{name:"不限"},{name:"美国"},{name:"英国"},{name:"法国"},{name:"俄罗斯"},{name:"加拿大"},{name:"巴西"},{name:"澳大利亚"},{name:"印尼"},{name:"泰国"},{name:"马来西亚"},{name:"新加坡"},{name:"菲律宾"},{name:"越南"},{name:"印度"},{name:"日本"},{name:"新西兰"},{name:"韩国"},{name:"德国"},{name:"意大利"},{name:"爱尔兰"},{name:"荷兰"},{name:"瑞士"},{name:"乌克兰"},{name:"南非"},{name:"芬兰"},{name:"瑞典"},{name:"奥地利"},{name:"西班牙"},{name:"比利时"},{name:"挪威"},{name:"丹麦"},{name:"波兰"},{name:"阿根廷"},{name:"白俄罗斯"},{name:"哥伦比亚"},{name:"古巴"},{name:"埃及"},{name:"希腊"},{name:"匈牙利"},{name:"伊朗"},{name:"蒙古"},{name:"墨西哥"},{name:"葡萄牙"},{name:"沙特阿拉伯"},{name:"土耳其"},{name:"其他"}]}];return{directly:e,china:t}}),define("module/dialogs/city",["jquery","plugin/dialog","./city_data"],function(e,t,n){var r=n.china,i={open:function(t,n){this.callback=t||e.noop,this.popDialog?this.popDialog.open():this.createPop(n)},createPop:function(n){var i="<div>"+this.getItemsHtml(r)+'</div><div class="town content-expand"></div>',s=e.extend({id:"dialog_city",hide:!0,dialogClass:"location",header:"选择您的所在地",content:i},n),o=new t.Dialog(s);o.open(),this.popDialog=o,this.bindEvents()},getItemsHtml:function(e,t){var n="";for(var r=0,i=e.length;r<i;r++){var s=e[r];n+='<a  href="javascript:;" has_child="'+(s.has_child?"yes":"no")+'"  province="'+(t||"")+'">'+s.name+"</a>"}return n},bindEvents:function(){var t=this.popDialog.getEl(),n=t.find(".bd"),i=n.find(".town"),s=this;n.on("click","a",function(){var t=e(this),n=t.text();t.parent().children(".on").removeClass("on"),t.addClass("on");if(t.attr("has_child")=="no"){var o=t.attr("province")||"";s.callback(o,n),s.popDialog.close()}else{var u=r[t.index()].children;u&&i.empty().html(s.getItemsHtml(u,n))}}),n.find("a").eq(0).trigger("click")}};return i}),define("plugin/jsencrypt",[],function(){var e={};(function(e){function i(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new i(null)}function o(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function u(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function a(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function d(e){return l.charAt(e)}function m(e,t){var n=c[e.charCodeAt(t)];return n==null?-1:n}function g(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function y(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function b(e){var t=s();return t.fromInt(e),t}function w(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,s=!1,o=0;while(--r>=0){var u=n==8?e[r]&255:m(e,r);if(u<0){e.charAt(r)=="-"&&(s=!0);continue}s=!1,o==0?this[this.t++]=u:o+n>this.DB?(this[this.t-1]|=(u&(1<<this.DB-o)-1)<<o,this[this.t++]=u>>this.DB-o):this[this.t-1]|=u<<o,o+=n,o>=this.DB&&(o-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&i.ZERO.subTo(this,this)}function E(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function S(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=d(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=d(r))}return i?s:"0"}function x(){var e=s();return i.ZERO.subTo(this,e),e}function T(){return this.s<0?this.negate():this}function N(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return this.s<0?-t:t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function C(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function k(){return this.t<=0?0:this.DB*(this.t-1)+C(this[this.t-1]^this.s&this.DM)}function L(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function A(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function O(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function M(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function _(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function D(e,t){var n=this.abs(),r=e.abs(),s=n.t;t.t=s+r.t;while(--s>=0)t[s]=0;for(s=0;s<r.t;++s)t[s+n.t]=n.am(0,r[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&i.ZERO.subTo(t,t)}function P(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function H(e,t,n){var r=e.abs();if(r.t<=0)return;var o=this.abs();if(o.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=s());var u=s(),a=this.s,f=e.s,l=this.DB-C(r[r.t-1]);l>0?(r.lShiftTo(l,u),o.lShiftTo(l,n)):(r.copyTo(u),o.copyTo(n));var c=u.t,h=u[c-1];if(h==0)return;var p=h*(1<<this.F1)+(c>1?u[c-2]>>this.F2:0),d=this.FV/p,v=(1<<this.F1)/p,m=1<<this.F2,g=n.t,y=g-c,b=t==null?s():t;u.dlShiftTo(y,b),n.compareTo(b)>=0&&(n[n.t++]=1,n.subTo(b,n)),i.ONE.dlShiftTo(c,b),b.subTo(u,u);while(u.t<c)u[u.t++]=0;while(--y>=0){var w=n[--g]==h?this.DM:Math.floor(n[g]*d+(n[g-1]+m)*v);if((n[g]+=u.am(0,w,n,y,0,c))<w){u.dlShiftTo(y,b),n.subTo(b,n);while(n[g]<--w)n.subTo(b,n)}}t!=null&&(n.drShiftTo(c,t),a!=f&&i.ZERO.subTo(t,t)),n.t=c,n.clamp(),l>0&&n.rShiftTo(l,n),a<0&&i.ZERO.subTo(n,n)}function B(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(i.ZERO)>0&&e.subTo(t,t),t}function j(e){this.m=e}function F(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function I(e){return e}function q(e){e.divRemTo(this.m,null,e)}function R(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function U(e,t){e.squareTo(t),this.reduce(t)}function z(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function W(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function X(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(i.ZERO)>0&&this.m.subTo(t,t),t}function V(e){var t=s();return e.copyTo(t),this.reduce(t),t}function $(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function J(e,t){e.squareTo(t),this.reduce(t)}function K(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function Q(){return(this.t>0?this[0]&1:this.s)==0}function G(e,t){if(e>4294967295||e<1)return i.ONE;var n=s(),r=s(),o=t.convert(this),u=C(e)-1;o.copyTo(n);while(--u>=0){t.sqrTo(n,r);if((e&1<<u)>0)t.mulTo(r,o,n);else{var a=n;n=r,r=a}}return t.revert(n)}function Y(e,t){var n;return e<256||t.isEven()?n=new j(t):n=new W(t),this.exp(e,n)}function Z(){var e=s();return this.copyTo(e),e}function et(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function tt(){return this.t==0?this.s:this[0]<<24>>24}function nt(){return this.t==0?this.s:this[0]<<16>>16}function rt(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function it(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function st(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=b(n),i=s(),o=s(),u="";this.divRemTo(r,i,o);while(i.signum()>0)u=(n+o.intValue()).toString(e).substr(1)+u,i.divRemTo(r,i,o);return o.intValue().toString(e)+u}function ot(e,t){this.fromInt(0),t==null&&(t=10);var n=this.chunkSize(t),r=Math.pow(t,n),s=!1,o=0,u=0;for(var a=0;a<e.length;++a){var f=m(e,a);if(f<0){e.charAt(a)=="-"&&this.signum()==0&&(s=!0);continue}u=t*u+f,++o>=n&&(this.dMultiply(r),this.dAddOffset(u,0),o=0,u=0)}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(u,0)),s&&i.ZERO.subTo(this,this)}function ut(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(i.ONE.shiftLeft(e-1),vt,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(i.ONE.shiftLeft(e-1),this)}else{var r=new Array,s=e&7;r.length=(e>>3)+1,t.nextBytes(r),s>0?r[0]&=(1<<s)-1:r[0]=0,this.fromString(r,256)}}function at(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);while(e>=0){n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i;if(i>0||r!=this.s)t[i++]=r}}return t}function ft(e){return this.compareTo(e)==0}function lt(e){return this.compareTo(e)<0?this:e}function ct(e){return this.compareTo(e)>0?this:e}function ht(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function pt(e,t){return e&t}function dt(e){var t=s();return this.bitwiseTo(e,pt,t),t}function vt(e,t){return e|t}function mt(e){var t=s();return this.bitwiseTo(e,vt,t),t}function gt(e,t){return e^t}function yt(e){var t=s();return this.bitwiseTo(e,gt,t),t}function bt(e,t){return e&~t}function wt(e){var t=s();return this.bitwiseTo(e,bt,t),t}function Et(){var e=s();for(var t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function St(e){var t=s();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function xt(e){var t=s();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function Tt(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function Nt(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+Tt(this[e]);return this.s<0?this.t*this.DB:-1}function Ct(e){var t=0;while(e!=0)e&=e-1,++t;return t}function kt(){var e=0,t=this.s&this.DM;for(var n=0;n<this.t;++n)e+=Ct(this[n]^t);return e}function Lt(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function At(e,t){var n=i.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function Ot(e){return this.changeBit(e,vt)}function Mt(e){return this.changeBit(e,bt)}function _t(e){return this.changeBit(e,gt)}function Dt(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function Pt(e){var t=s();return this.addTo(e,t),t}function Ht(e){var t=s();return this.subTo(e,t),t}function Bt(e){var t=s();return this.multiplyTo(e,t),t}function jt(){var e=s();return this.squareTo(e),e}function Ft(e){var t=s();return this.divRemTo(e,t,null),t}function It(e){var t=s();return this.divRemTo(e,null,t),t}function qt(e){var t=s(),n=s();return this.divRemTo(e,t,n),new Array(t,n)}function Rt(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function Ut(e,t){if(e==0)return;while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function zt(){}function Wt(e){return e}function Xt(e,t,n){e.multiplyTo(t,n)}function Vt(e,t){e.squareTo(t)}function $t(e){return this.exp(e,new zt)}function Jt(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function Kt(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Qt(e){this.r2=s(),this.q3=s(),i.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function Gt(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t}function Yt(e){return e}function Zt(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function en(e,t){e.squareTo(t),this.reduce(t)}function tn(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function nn(e,t){var n=e.bitLength(),r,i=b(1),o;if(n<=0)return i;n<18?r=1:n<48?r=3:n<144?r=4:n<768?r=5:r=6,n<8?o=new j(t):t.isEven()?o=new Qt(t):o=new W(t);var u=new Array,a=3,f=r-1,l=(1<<r)-1;u[1]=o.convert(this);if(r>1){var c=s();o.sqrTo(u[1],c);while(a<=l)u[a]=s(),o.mulTo(c,u[a-2],u[a]),a+=2}var h=e.t-1,p,d=!0,v=s(),m;n=C(e[h])-1;while(h>=0){n>=f?p=e[h]>>n-f&l:(p=(e[h]&(1<<n+1)-1)<<f-n,h>0&&(p|=e[h-1]>>this.DB+n-f)),a=r;while((p&1)==0)p>>=1,--a;(n-=a)<0&&(n+=this.DB,--h);if(d)u[p].copyTo(i),d=!1;else{while(a>1)o.sqrTo(i,v),o.sqrTo(v,i),a-=2;a>0?o.sqrTo(i,v):(m=i,i=v,v=m),o.mulTo(v,u[p],i)}while(h>=0&&(e[h]&1<<n)==0)o.sqrTo(i,v),m=i,i=v,v=m,--n<0&&(n=this.DB-1,--h)}return o.revert(i)}function rn(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function sn(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function on(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return i.ZERO;var n=e.clone(),r=this.clone(),s=b(1),o=b(0),u=b(0),a=b(1);while(n.signum()!=0){while(n.isEven()){n.rShiftTo(1,n);if(t){if(!s.isEven()||!o.isEven())s.addTo(this,s),o.subTo(e,o);s.rShiftTo(1,s)}else o.isEven()||o.subTo(e,o);o.rShiftTo(1,o)}while(r.isEven()){r.rShiftTo(1,r);if(t){if(!u.isEven()||!a.isEven())u.addTo(this,u),a.subTo(e,a);u.rShiftTo(1,u)}else a.isEven()||a.subTo(e,a);a.rShiftTo(1,a)}n.compareTo(r)>=0?(n.subTo(r,n),t&&s.subTo(u,s),o.subTo(a,o)):(r.subTo(n,r),t&&u.subTo(s,u),a.subTo(o,a))}return r.compareTo(i.ONE)!=0?i.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a}function fn(e){var t,n=this.abs();if(n.t==1&&n[0]<=un[un.length-1]){for(t=0;t<un.length;++t)if(n[0]==un[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<un.length){var r=un[t],i=t+1;while(i<un.length&&r<an)r*=un[i++];r=n.modInt(r);while(t<i)if(r%un[t++]==0)return!1}return n.millerRabin(e)}function ln(e){var t=this.subtract(i.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);e=e+1>>1,e>un.length&&(e=un.length);var o=s();for(var u=0;u<e;++u){o.fromInt(un[Math.floor(Math.random()*un.length)]);var a=o.modPow(r,this);if(a.compareTo(i.ONE)!=0&&a.compareTo(t)!=0){var f=1;while(f++<n&&a.compareTo(t)!=0){a=a.modPowInt(2,this);if(a.compareTo(i.ONE)==0)return!1}if(a.compareTo(t)!=0)return!1}}return!0}function cn(){this.i=0,this.j=0,this.S=new Array}function hn(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;n=0;for(t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function pn(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}function dn(){return new cn}function Sn(){if(mn==null){mn=dn();while(yn<vn){var e=Math.floor(65536*Math.random());gn[yn++]=e&255}mn.init(gn);for(yn=0;yn<gn.length;++yn)gn[yn]=0;yn=0}return mn.next()}function xn(e){var t;for(t=0;t<e.length;++t)e[t]=Sn()}function Tn(){}function Nn(e,t){return new i(e,t)}function Cn(e,t){var n="",r=0;while(r+t<e.length)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function kn(e){return e<16?"0"+e.toString(16):e.toString(16)}function Ln(e,t){if(t<e.length+11)return console.error("Message too long for RSA"),null;var n=new Array,r=e.length-1;while(r>=0&&t>0){var s=e.charCodeAt(r--);s<128?n[--t]=s:s>127&&s<2048?(n[--t]=s&63|128,n[--t]=s>>6|192):(n[--t]=s&63|128,n[--t]=s>>6&63|128,n[--t]=s>>12|224)}n[--t]=0;var o=new Tn,u=new Array;while(t>2){u[0]=0;while(u[0]==0)o.nextBytes(u);n[--t]=u[0]}return n[--t]=2,n[--t]=0,new i(n)}function An(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function On(e,t){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=Nn(e,16),this.e=parseInt(t,16)):console.error("Invalid RSA public key")}function Mn(e){return e.modPowInt(this.e,this.n)}function _n(e){var t=Ln(e,this.n.bitLength()+7>>3);if(t==null)return null;var n=this.doPublic(t);if(n==null)return null;var r=n.toString(16);return(r.length&1)==0?r:"0"+r}function Dn(e,t){var n=e.toByteArray(),r=0;while(r<n.length&&n[r]==0)++r;if(n.length-r!=t-1||n[r]!=2)return null;++r;while(n[r]!=0)if(++r>=n.length)return null;var i="";while(++r<n.length){var s=n[r]&255;s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((s&31)<<6|n[r+1]&63),++r):(i+=String.fromCharCode((s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63),r+=2)}return i}function Pn(e,t,n){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=Nn(e,16),this.e=parseInt(t,16),this.d=Nn(n,16)):console.error("Invalid RSA private key")}function Hn(e,t,n,r,i,s,o,u){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=Nn(e,16),this.e=parseInt(t,16),this.d=Nn(n,16),this.p=Nn(r,16),this.q=Nn(i,16),this.dmp1=Nn(s,16),this.dmq1=Nn(o,16),this.coeff=Nn(u,16)):console.error("Invalid RSA private key")}function Bn(e,t){var n=new Tn,r=e>>1;this.e=parseInt(t,16);var s=new i(t,16);for(;;){for(;;){this.p=new i(e-r,1,n);if(this.p.subtract(i.ONE).gcd(s).compareTo(i.ONE)==0&&this.p.isProbablePrime(10))break}for(;;){this.q=new i(r,1,n);if(this.q.subtract(i.ONE).gcd(s).compareTo(i.ONE)==0&&this.q.isProbablePrime(10))break}if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var u=this.p.subtract(i.ONE),a=this.q.subtract(i.ONE),f=u.multiply(a);if(f.gcd(s).compareTo(i.ONE)==0){this.n=this.p.multiply(this.q),this.d=s.modInverse(f),this.dmp1=this.d.mod(u),this.dmq1=this.d.mod(a),this.coeff=this.q.modInverse(this.p);break}}}function jn(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);while(t.compareTo(n)<0)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function Fn(e){var t=Nn(e,16),n=this.doPrivate(t);return n==null?null:Dn(n,this.n.bitLength()+7>>3)}function Rn(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=In.charAt(n>>6)+In.charAt(n&63);t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=In.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=In.charAt(n>>2)+In.charAt((n&3)<<4));while((r.length&3)>0)r+=qn;return r}function Un(e){var t="",n,r=0,i;for(n=0;n<e.length;++n){if(e.charAt(n)==qn)break;v=In.indexOf(e.charAt(n));if(v<0)continue;r==0?(t+=d(v>>2),i=v&3,r=1):r==1?(t+=d(i<<2|v>>4),i=v&15,r=2):r==2?(t+=d(i),t+=d(v>>2),i=v&3,r=3):(t+=d(i<<2|v>>4),t+=d(v&15),r=0)}return r==1&&(t+=d(i<<2)),t}function zn(e){var t=Un(e),n,r=new Array;for(n=0;2*n<t.length;++n)r[n]=parseInt(t.substring(2*n,2*n+2),16);return r}var t,n=0xdeadbeefcafe,r=(n&16777215)==15715070;r&&navigator.appName=="Microsoft Internet Explorer"?(i.prototype.am=u,t=30):r&&navigator.appName!="Netscape"?(i.prototype.am=o,t=26):(i.prototype.am=a,t=28),i.prototype.DB=t,i.prototype.DM=(1<<t)-1,i.prototype.DV=1<<t;var f=52;i.prototype.FV=Math.pow(2,f),i.prototype.F1=f-t,i.prototype.F2=2*t-f;var l="0123456789abcdefghijklmnopqrstuvwxyz",c=new Array,h,p;h="0".charCodeAt(0);for(p=0;p<=9;++p)c[h++]=p;h="a".charCodeAt(0);for(p=10;p<36;++p)c[h++]=p;h="A".charCodeAt(0);for(p=10;p<36;++p)c[h++]=p;j.prototype.convert=F,j.prototype.revert=I,j.prototype.reduce=q,j.prototype.mulTo=R,j.prototype.sqrTo=U,W.prototype.convert=X,W.prototype.revert=V,W.prototype.reduce=$,W.prototype.mulTo=K,W.prototype.sqrTo=J,i.prototype.copyTo=g,i.prototype.fromInt=y,i.prototype.fromString=w,i.prototype.clamp=E,i.prototype.dlShiftTo=L,i.prototype.drShiftTo=A,i.prototype.lShiftTo=O,i.prototype.rShiftTo=M,i.prototype.subTo=_,i.prototype.multiplyTo=D,i.prototype.squareTo=P,i.prototype.divRemTo=H,i.prototype.invDigit=z,i.prototype.isEven=Q,i.prototype.exp=G,i.prototype.toString=S,i.prototype.negate=x,i.prototype.abs=T,i.prototype.compareTo=N,i.prototype.bitLength=k,i.prototype.mod=B,i.prototype.modPowInt=Y,i.ZERO=b(0),i.ONE=b(1),zt.prototype.convert=Wt,zt.prototype.revert=Wt,zt.prototype.mulTo=Xt,zt.prototype.sqrTo=Vt,Qt.prototype.convert=Gt,Qt.prototype.revert=Yt,Qt.prototype.reduce=Zt,Qt.prototype.mulTo=tn,Qt.prototype.sqrTo=en;var un=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],an=(1<<26)/un[un.length-1];i.prototype.chunkSize=rt,i.prototype.toRadix=st,i.prototype.fromRadix=ot,i.prototype.fromNumber=ut,i.prototype.bitwiseTo=ht,i.prototype.changeBit=At,i.prototype.addTo=Dt,i.prototype.dMultiply=Rt,i.prototype.dAddOffset=Ut,i.prototype.multiplyLowerTo=Jt,i.prototype.multiplyUpperTo=Kt,i.prototype.modInt=sn,i.prototype.millerRabin=ln,i.prototype.clone=Z,i.prototype.intValue=et,i.prototype.byteValue=tt,i.prototype.shortValue=nt,i.prototype.signum=it,i.prototype.toByteArray=at,i.prototype.equals=ft,i.prototype.min=lt,i.prototype.max=ct,i.prototype.and=dt,i.prototype.or=mt,i.prototype.xor=yt,i.prototype.andNot=wt,i.prototype.not=Et,i.prototype.shiftLeft=St,i.prototype.shiftRight=xt,i.prototype.getLowestSetBit=Nt,i.prototype.bitCount=kt,i.prototype.testBit=Lt,i.prototype.setBit=Ot,i.prototype.clearBit=Mt,i.prototype.flipBit=_t,i.prototype.add=Pt,i.prototype.subtract=Ht,i.prototype.multiply=Bt,i.prototype.divide=Ft,i.prototype.remainder=It,i.prototype.divideAndRemainder=qt,i.prototype.modPow=nn,i.prototype.modInverse=on,i.prototype.pow=$t,i.prototype.gcd=rn,i.prototype.isProbablePrime=fn,i.prototype.square=jt,cn.prototype.init=hn,cn.prototype.next=pn;var vn=256,mn,gn,yn;if(gn==null){gn=new Array,yn=0;var bn;if(window.crypto&&window.crypto.getRandomValues){var wn=new Uint32Array(256);window.crypto.getRandomValues(wn);for(bn=0;bn<wn.length;++bn)gn[yn++]=wn[bn]&255}var En=function(e){this.count=this.count||0;if(this.count>=256||yn>=vn){window.removeEventListener?window.removeEventListener("mousemove",En):window.detachEvent&&window.detachEvent("onmousemove",En);return}this.count+=1;var t=e.x+e.y;gn[yn++]=t&255};window.addEventListener?window.addEventListener("mousemove",En):window.attachEvent&&window.attachEvent("onmousemove",En)}Tn.prototype.nextBytes=xn,An.prototype.doPublic=Mn,An.prototype.setPublic=On,An.prototype.encrypt=_n,An.prototype.doPrivate=jn,An.prototype.setPrivate=Pn,An.prototype.setPrivateEx=Hn,An.prototype.generate=Bn,An.prototype.decrypt=Fn,function(){var e=function(e,t,n){var r=new Tn,o=e>>1;this.e=parseInt(t,16);var u=new i(t,16),a=this,f=function(){var t=function(){if(a.p.compareTo(a.q)<=0){var e=a.p;a.p=a.q,a.q=e}var t=a.p.subtract(i.ONE),r=a.q.subtract(i.ONE),s=t.multiply(r);s.gcd(u).compareTo(i.ONE)==0?(a.n=a.p.multiply(a.q),a.d=u.modInverse(s),a.dmp1=a.d.mod(t),a.dmq1=a.d.mod(r),a.coeff=a.q.modInverse(a.p),setTimeout(function(){n()},0)):setTimeout(f,0)},l=function(){a.q=s(),a.q.fromNumberAsync(o,1,r,function(){a.q.subtract(i.ONE).gcda(u,function(e){e.compareTo(i.ONE)==0&&a.q.isProbablePrime(10)?setTimeout(t,0):setTimeout(l,0)})})},c=function(){a.p=s(),a.p.fromNumberAsync(e-o,1,r,function(){a.p.subtract(i.ONE).gcda(u,function(e){e.compareTo(i.ONE)==0&&a.p.isProbablePrime(10)?setTimeout(l,0):setTimeout(c,0)})})};setTimeout(c,0)};setTimeout(f,0)};An.prototype.generateAsync=e;var t=function(e,t){var n=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(n.compareTo(r)<0){var i=n;n=r,r=i}var s=n.getLowestSetBit(),o=r.getLowestSetBit();if(o<0){t(n);return}s<o&&(o=s),o>0&&(n.rShiftTo(o,n),r.rShiftTo(o,r));var u=function(){(s=n.getLowestSetBit())>0&&n.rShiftTo(s,n),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),n.compareTo(r)>=0?(n.subTo(r,n),n.rShiftTo(1,n)):(r.subTo(n,r),r.rShiftTo(1,r)),n.signum()>0?setTimeout(u,0):(o>0&&r.lShiftTo(o,r),setTimeout(function(){t(r)},0))};setTimeout(u,10)};i.prototype.gcda=t;var n=function(e,t,n,r){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(i.ONE.shiftLeft(e-1),vt,this),this.isEven()&&this.dAddOffset(1,0);var s=this,o=function(){s.dAddOffset(2,0),s.bitLength()>e&&s.subTo(i.ONE.shiftLeft(e-1),s),s.isProbablePrime(t)?setTimeout(function(){r()},0):setTimeout(o,0)};setTimeout(o,0)}else{var u=new Array,a=e&7;u.length=(e>>3)+1,t.nextBytes(u),a>0?u[0]&=(1<<a)-1:u[0]=0,this.fromString(u,256)}};i.prototype.fromNumberAsync=n}();var In="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qn="=",Wn=Wn||{};Wn.env=Wn.env||{};var Xn=Wn,Vn=Object.prototype,$n="[object Function]",Jn=["toString","valueOf"];Wn.env.parseUA=function(e){var t=function(e){var t=0;return parseFloat(e.replace(/\./g,function(){return t++==1?"":"."}))},n=navigator,r={ie:0,opera:0,gecko:0,webkit:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:n&&n.cajaVersion,secure:!1,os:null},i=e||navigator&&navigator.userAgent,s=window&&window.location,o=s&&s.href,u;return r.secure=o&&o.toLowerCase().indexOf("https")===0,i&&(/windows|win32/i.test(i)?r.os="windows":/macintosh/i.test(i)?r.os="macintosh":/rhino/i.test(i)&&(r.os="rhino"),/KHTML/.test(i)&&(r.webkit=1),u=i.match(/AppleWebKit\/([^\s]*)/),u&&u[1]&&(r.webkit=t(u[1]),/ Mobile\//.test(i)?(r.mobile="Apple",u=i.match(/OS ([^\s]*)/),u&&u[1]&&(u=t(u[1].replace("_","."))),r.ios=u,r.ipad=r.ipod=r.iphone=0,u=i.match(/iPad|iPod|iPhone/),u&&u[0]&&(r[u[0].toLowerCase()]=r.ios)):(u=i.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/),u&&(r.mobile=u[0]),/webOS/.test(i)&&(r.mobile="WebOS",u=i.match(/webOS\/([^\s]*);/),u&&u[1]&&(r.webos=t(u[1]))),/ Android/.test(i)&&(r.mobile="Android",u=i.match(/Android ([^\s]*);/),u&&u[1]&&(r.android=t(u[1])))),u=i.match(/Chrome\/([^\s]*)/),u&&u[1]?r.chrome=t(u[1]):(u=i.match(/AdobeAIR\/([^\s]*)/),u&&(r.air=u[0]))),r.webkit||(u=i.match(/Opera[\s\/]([^\s]*)/),u&&u[1]?(r.opera=t(u[1]),u=i.match(/Version\/([^\s]*)/),u&&u[1]&&(r.opera=t(u[1])),u=i.match(/Opera Mini[^;]*/),u&&(r.mobile=u[0])):(u=i.match(/MSIE\s([^;]*)/),u&&u[1]?r.ie=t(u[1]):(u=i.match(/Gecko\/([^\s]*)/),u&&(r.gecko=1,u=i.match(/rv:([^\s\)]*)/),u&&u[1]&&(r.gecko=t(u[1]))))))),r},Wn.env.ua=Wn.env.parseUA(),Wn.isFunction=function(e){return typeof e=="function"||Vn.toString.apply(e)===$n},Wn._IEEnumFix=Wn.env.ua.ie?function(e,t){var n,r,i;for(n=0;n<Jn.length;n+=1)r=Jn[n],i=t[r],Xn.isFunction(i)&&i!=Vn[r]&&(e[r]=i)}:function(){},Wn.extend=function(e,t,n){if(!t||!e)throw new Error("extend failed, please check that all dependencies are included.");var r=function(){},i;r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Vn.constructor&&(t.prototype.constructor=t);if(n){for(i in n)Xn.hasOwnProperty(n,i)&&(e.prototype[i]=n[i]);Xn._IEEnumFix(e.prototype,n)}};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if(t.substr(0,1)!="-")t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var n=t.substr(1),r=n.length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);var s="";for(var o=0;o<r;o++)s+="f";var u=new i(s,16),a=u.xor(e).add(i.ONE);t=a.toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){var n=CryptoJS.enc.Hex.parse(e),r=CryptoJS.enc.Base64.stringify(n),i=r.replace(/(.{64})/g,"$1\r\n");return i=i.replace(/\r\n$/,""),"-----BEGIN "+t+"-----\r\n"+i+"\r\n-----END "+t+"-----\r\n"}},KJUR.asn1.ASN1Object=function(){var e=!0,t=null,n="00",r="00",i="";this.getLengthHexFromValue=function(){if(typeof this.hV=="undefined"||this.hV==null)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+i.length+",v="+this.hV;var e=this.hV.length/2,t=e.toString(16);t.length%2==1&&(t="0"+t);if(e<128)return t;var n=t.length/2;if(n>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);var r=128+n;return r.toString(16)+t},this.getEncodedHex=function(){if(this.hTLV==null||this.isModified)this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1;return this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},KJUR.asn1.DERAbstractString=function(e){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);var t=null,n=null;this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},typeof e!="undefined"&&(typeof e["str"]!="undefined"?this.setString(e.str):typeof e["hex"]!="undefined"&&this.setStringHex(e.hex))},Wn.extend(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractTime=function(e){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);var t=null,n=null;this.localDateToUTC=function(e){utc=e.getTime()+e.getTimezoneOffset()*6e4;var t=new Date(utc);return t},this.formatDate=function(e,t){var n=this.zeroPadding,r=this.localDateToUTC(e),i=String(r.getFullYear());t=="utc"&&(i=i.substr(2,2));var s=n(String(r.getMonth()+1),2),o=n(String(r.getDate()),2),u=n(String(r.getHours()),2),a=n(String(r.getMinutes()),2),f=n(String(r.getSeconds()),2);return i+s+o+u+a+f+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:(new Array(t-e.length+1)).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setByDateValue=function(e,t,n,r,i,s){var o=new Date(Date.UTC(e,t-1,n,r,i,s,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},Wn.extend(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractStructured=function(e){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);var t=null;this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,typeof e!="undefined"&&typeof e["array"]!="undefined"&&(this.asn1Array=e.array)},Wn.extend(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object),KJUR.asn1.DERBoolean=function(){KJUR.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},Wn.extend(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object),KJUR.asn1.DERInteger=function(e){KJUR.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new i(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},typeof e!="undefined"&&(typeof e["bigint"]!="undefined"?this.setByBigInteger(e.bigint):typeof e["int"]!="undefined"?this.setByInteger(e["int"]):typeof e["hex"]!="undefined"&&this.setValueHex(e.hex))},Wn.extend(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object),KJUR.asn1.DERBitString=function(e){KJUR.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var n="0"+e;this.hTLV=null,this.isModified=!0,this.hV=n+t},this.setByBinaryString=function(e){e=e.replace(/0+$/,"");var t=8-e.length%8;t==8&&(t=0);for(var n=0;n<=t;n++)e+="0";var r="";for(var n=0;n<e.length-1;n+=8){var i=e.substr(n,8),s=parseInt(i,2).toString(16);s.length==1&&(s="0"+s),r+=s}this.hTLV=null,this.isModified=!0,this.hV="0"+t+r},this.setByBooleanArray=function(e){var t="";for(var n=0;n<e.length;n++)e[n]==1?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=!1;return t},this.getFreshValueHex=function(){return this.hV},typeof e!="undefined"&&(typeof e["hex"]!="undefined"?this.setHexValueIncludingUnusedBits(e.hex):typeof e["bin"]!="undefined"?this.setByBinaryString(e.bin):typeof e["array"]!="undefined"&&this.setByBooleanArray(e.array))},Wn.extend(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object),KJUR.asn1.DEROctetString=function(e){KJUR.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},Wn.extend(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Wn.extend(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object),KJUR.asn1.DERObjectIdentifier=function(e){var t=function(e){var t=e.toString(16);return t.length==1&&(t="0"+t),t},n=function(e){var n="",r=new i(e,10),s=r.toString(2),o=7-s.length%7;o==7&&(o=0);var u="";for(var a=0;a<o;a++)u+="0";s=u+s;for(var a=0;a<s.length-1;a+=7){var f=s.substr(a,7);a!=s.length-7&&(f="1"+f),n+=t(parseInt(f,2))}return n};KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var r="",i=e.split("."),s=parseInt(i[0])*40+parseInt(i[1]);r+=t(s),i.splice(0,2);for(var o=0;o<i.length;o++)r+=n(i[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(e){if(typeof KJUR.asn1.x509.OID.name2oidList[e]=="undefined")throw"DERObjectIdentifier oidName undefined: "+e;var t=KJUR.asn1.x509.OID.name2oidList[e];this.setValueOidString(t)},this.getFreshValueHex=function(){return this.hV},typeof e!="undefined"&&(typeof e["oid"]!="undefined"?this.setValueOidString(e.oid):typeof e["hex"]!="undefined"?this.setValueHex(e.hex):typeof e["name"]!="undefined"&&this.setValueName(e.name))},Wn.extend(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.DERUTF8String=function(e){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},Wn.extend(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNumericString=function(e){KJUR.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},Wn.extend(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERPrintableString=function(e){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},Wn.extend(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERTeletexString=function(e){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},Wn.extend(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERIA5String=function(e){KJUR.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},Wn.extend(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERUTCTime=function(e){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},typeof e!="undefined"&&(typeof e["str"]!="undefined"?this.setString(e.str):typeof e["hex"]!="undefined"?this.setStringHex(e.hex):typeof e["date"]!="undefined"&&this.setByDate(e.date))},Wn.extend(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERGeneralizedTime=function(e){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen"),this.hV=stohex(this.s)},typeof e!="undefined"&&(typeof e["str"]!="undefined"?this.setString(e.str):typeof e["hex"]!="undefined"?this.setStringHex(e.hex):typeof e["date"]!="undefined"&&this.setByDate(e.date))},Wn.extend(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERSequence=function(e){KJUR.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){var e="";for(var t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e+=n.getEncodedHex()}return this.hV=e,this.hV}},Wn.extend(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERSet=function(e){KJUR.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.getFreshValueHex=function(){var e=new Array;for(var t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e.push(n.getEncodedHex())}return e.sort(),this.hV=e.join(""),this.hV}},Wn.extend(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERTaggedObject=function(e){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(e,t,n){this.hT=t,this.isExplicit=e,this.asn1Object=n,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=n.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,t),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},typeof e!="undefined"&&(typeof e["tag"]!="undefined"&&(this.hT=e.tag),typeof e["explicit"]!="undefined"&&(this.isExplicit=e.explicit),typeof e["obj"]!="undefined"&&(this.asn1Object=e.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},Wn.extend(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object),function(e){var t={},n;t.decode=function(t){var r;if(n===e){var i="0123456789ABCDEF",s=" \f\n\r	 \u2028\u2029";n=[];for(r=0;r<16;++r)n[i.charAt(r)]=r;i=i.toLowerCase();for(r=10;r<16;++r)n[i.charAt(r)]=r;for(r=0;r<s.length;++r)n[s.charAt(r)]=-1}var o=[],u=0,a=0;for(r=0;r<t.length;++r){var f=t.charAt(r);if(f=="=")break;f=n[f];if(f==-1)continue;if(f===e)throw"Illegal character at offset "+r;u|=f,++a>=2?(o[o.length]=u,u=0,a=0):u<<=4}if(a)throw"Hex encoding incomplete: 4 bits missing";return o},window.Hex=t}(),function(e){var t={},n;t.decode=function(t){var r;if(n===e){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="= \f\n\r	 \u2028\u2029";n=[];for(r=0;r<64;++r)n[i.charAt(r)]=r;for(r=0;r<s.length;++r)n[s.charAt(r)]=-1}var o=[],u=0,a=0;for(r=0;r<t.length;++r){var f=t.charAt(r);if(f=="=")break;f=n[f];if(f==-1)continue;if(f===e)throw"Illegal character at offset "+r;u|=f,++a>=4?(o[o.length]=u>>16,o[o.length]=u>>8&255,o[o.length]=u&255,u=0,a=0):u<<=6}switch(a){case 1:throw"Base64 encoding incomplete: at least 2 bits missing";case 2:o[o.length]=u>>10;break;case 3:o[o.length]=u>>16,o[o.length]=u>>8&255}return o},t.re=/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,t.unarmor=function(e){var n=t.re.exec(e);if(n)if(n[1])e=n[1];else{if(!n[2])throw"RegExp out of sync";e=n[2]}return t.decode(e)},window.Base64=t}(),function(e){function i(e,t){e instanceof i?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=t)}function s(e,t,n,r,i){this.stream=e,this.header=t,this.length=n,this.tag=r,this.sub=i}var t=100,n="…",r={tag:function(e,t){var n=document.createElement(e);return n.className=t,n},text:function(e){return document.createTextNode(e)}};i.prototype.get=function(t){t===e&&(t=this.pos++);if(t>=this.enc.length)throw"Requesting byte offset "+t+" on a stream of length "+this.enc.length;return this.enc[t]},i.prototype.hexDigits="0123456789ABCDEF",i.prototype.hexByte=function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(e&15)},i.prototype.hexDump=function(e,t,n){var r="";for(var i=e;i<t;++i){r+=this.hexByte(this.get(i));if(n!==!0)switch(i&15){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}}return r},i.prototype.parseStringISO=function(e,t){var n="";for(var r=e;r<t;++r)n+=String.fromCharCode(this.get(r));return n},i.prototype.parseStringUTF=function(e,t){var n="";for(var r=e;r<t;){var i=this.get(r++);i<128?n+=String.fromCharCode(i):i>191&&i<224?n+=String.fromCharCode((i&31)<<6|this.get(r++)&63):n+=String.fromCharCode((i&15)<<12|(this.get(r++)&63)<<6|this.get(r++)&63)}return n},i.prototype.parseStringBMP=function(e,t){var n="";for(var r=e;r<t;r+=2){var i=this.get(r),s=this.get(r+1);n+=String.fromCharCode((i<<8)+s)}return n},i.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,i.prototype.parseTime=function(e,t){var n=this.parseStringISO(e,t),r=this.reTime.exec(n);return r?(n=r[1]+"-"+r[2]+"-"+r[3]+" "+r[4],r[5]&&(n+=":"+r[5],r[6]&&(n+=":"+r[6],r[7]&&(n+="."+r[7]))),r[8]&&(n+=" UTC",r[8]!="Z"&&(n+=r[8],r[9]&&(n+=":"+r[9]))),n):"Unrecognized time: "+n},i.prototype.parseInteger=function(e,t){var n=t-e;if(n>4){n<<=3;var r=this.get(e);if(r===0)n-=8;else while(r<128)r<<=1,--n;return"("+n+" bit)"}var i=0;for(var s=e;s<t;++s)i=i<<8|this.get(s);return i},i.prototype.parseBitString=function(e,t){var n=this.get(e),r=(t-e-1<<3)-n,i="("+r+" bit)";if(r<=20){var s=n;i+=" ";for(var o=t-1;o>e;--o){var u=this.get(o);for(var a=s;a<8;++a)i+=u>>a&1?"1":"0";s=0}}return i},i.prototype.parseOctetString=function(e,r){var i=r-e,s="("+i+" byte) ";i>t&&(r=e+t);for(var o=e;o<r;++o)s+=this.hexByte(this.get(o));return i>t&&(s+=n),s},i.prototype.parseOID=function(e,t){var n="",r=0,i=0;for(var s=e;s<t;++s){var o=this.get(s);r=r<<7|o&127,i+=7;if(!(o&128)){if(n===""){var u=r<80?r<40?0:1:2;n=u+"."+(r-u*40)}else n+="."+(i>=31?"bigint":r);r=i=0}}return n},s.prototype.typeName=function(){if(this.tag===e)return"unknown";var t=this.tag>>6,n=this.tag>>5&1,r=this.tag&31;switch(t){case 0:switch(r){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+r.toString(16)};case 1:return"Application_"+r.toString(16);case 2:return"["+r+"]";case 3:return"Private_"+r.toString(16)}},s.prototype.reSeemsASCII=/^[ -~]+$/,s.prototype.content=function(){if(this.tag===e)return null;var r=this.tag>>6,i=this.tag&31,s=this.posContent(),o=Math.abs(this.length);if(r!==0){if(this.sub!==null)return"("+this.sub.length+" elem)";var u=this.stream.parseStringISO(s,s+Math.min(o,t));return this.reSeemsASCII.test(u)?u.substring(0,2*t)+(u.length>2*t?n:""):this.stream.parseOctetString(s,s+o)}switch(i){case 1:return this.stream.get(s)===0?"false":"true";case 2:return this.stream.parseInteger(s,s+o);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(s,s+o);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(s,s+o);case 6:return this.stream.parseOID(s,s+o);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(s,s+o);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(s,s+o);case 30:return this.stream.parseStringBMP(s,s+o);case 23:case 24:return this.stream.parseTime(s,s+o)}return null},s.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(this.sub===null?"null":this.sub.length)+"]"},s.prototype.print=function(t){t===e&&(t=""),document.writeln(t+this);if(this.sub!==null){t+="  ";for(var n=0,r=this.sub.length;n<r;++n)this.sub[n].print(t)}},s.prototype.toPrettyString=function(t){t===e&&(t="");var n=t+this.typeName()+" @"+this.stream.pos;this.length>=0&&(n+="+"),n+=this.length,this.tag&32?n+=" (constructed)":(this.tag==3||this.tag==4)&&this.sub!==null&&(n+=" (encapsulates)"),n+="\n";if(this.sub!==null){t+="  ";for(var r=0,i=this.sub.length;r<i;++r)n+=this.sub[r].toPrettyString(t)}return n},s.prototype.toDOM=function(){var e=r.tag("div","node");e.asn1=this;var t=r.tag("div","head"),n=this.typeName().replace(/_/g," ");t.innerHTML=n;var i=this.content();if(i!==null){i=String(i).replace(/</g,"&lt;");var s=r.tag("span","preview");s.appendChild(r.text(i)),t.appendChild(s)}e.appendChild(t),this.node=e,this.head=t;var o=r.tag("div","value");n="Offset: "+this.stream.pos+"<br/>",n+="Length: "+this.header+"+",this.length>=0?n+=this.length:n+=-this.length+" (undefined)",this.tag&32?n+="<br/>(constructed)":(this.tag==3||this.tag==4)&&this.sub!==null&&(n+="<br/>(encapsulates)");if(i!==null){n+="<br/>Value:<br/><b>"+i+"</b>";if(typeof oids=="object"&&this.tag==6){var u=oids[i];u&&(u.d&&(n+="<br/>"+u.d),u.c&&(n+="<br/>"+u.c),u.w&&(n+="<br/>(warning!)"))}}o.innerHTML=n,e.appendChild(o);var a=r.tag("div","sub");if(this.sub!==null)for(var f=0,l=this.sub.length;f<l;++f)a.appendChild(this.sub[f].toDOM());return e.appendChild(a),t.onclick=function(){e.className=e.className=="node collapsed"?"node":"node collapsed"},e},s.prototype.posStart=function(){return this.stream.pos},s.prototype.posContent=function(){return this.stream.pos+this.header},s.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},s.prototype.fakeHover=function(e){this.node.className+=" hover",e&&(this.head.className+=" hover")},s.prototype.fakeOut=function(e){var t=/ ?hover/;this.node.className=this.node.className.replace(t,""),e&&(this.head.className=this.head.className.replace(t,""))},s.prototype.toHexDOM_sub=function(e,t,n,i,s){if(i>=s)return;var o=r.tag("span",t);o.appendChild(r.text(n.hexDump(i,s))),e.appendChild(o)},s.prototype.toHexDOM=function(t){var n=r.tag("span","hex");t===e&&(t=n),this.head.hexNode=n,this.head.onmouseover=function(){this.hexNode.className="hexCurrent"},this.head.onmouseout=function(){this.hexNode.className="hex"},n.asn1=this,n.onmouseover=function(){var e=!t.selected;e&&(t.selected=this.asn1,this.className="hexCurrent"),this.asn1.fakeHover(e)},n.onmouseout=function(){var e=t.selected==this.asn1;this.asn1.fakeOut(e),e&&(t.selected=null,this.className="hex")},this.toHexDOM_sub(n,"tag",this.stream,this.posStart(),this.posStart()+1),this.toHexDOM_sub(n,this.length>=0?"dlen":"ulen",this.stream,this.posStart()+1,this.posContent());if(this.sub===null)n.appendChild(r.text(this.stream.hexDump(this.posContent(),this.posEnd())));else if(this.sub.length>0){var i=this.sub[0],s=this.sub[this.sub.length-1];this.toHexDOM_sub(n,"intro",this.stream,this.posContent(),i.posStart());for(var o=0,u=this.sub.length;o<u;++o)n.appendChild(this.sub[o].toHexDOM(t));this.toHexDOM_sub(n,"outro",this.stream,s.posEnd(),this.posEnd())}return n},s.prototype.toHexString=function(e){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},s.decodeLength=function(e){var t=e.get(),n=t&127;if(n==t)return n;if(n>3)throw"Length over 24 bits not supported at position "+(e.pos-1);if(n===0)return-1;t=0;for(var r=0;r<n;++r)t=t<<8|e.get();return t},s.hasContent=function(e,t,n){if(e&32)return!0;if(e<3||e>4)return!1;var r=new i(n);e==3&&r.get();var o=r.get();if(o>>6&1)return!1;try{var u=s.decodeLength(r);return r.pos-n.pos+u==t}catch(a){return!1}},s.decode=function(e){e instanceof i||(e=new i(e,0));var t=new i(e),n=e.get(),r=s.decodeLength(e),o=e.pos-t.pos,u=null;if(s.hasContent(n,r,e)){var a=e.pos;n==3&&e.get(),u=[];if(r>=0){var f=a+r;while(e.pos<f)u[u.length]=s.decode(e);if(e.pos!=f)throw"Content size is not correct for container starting at offset "+a}else try{for(;;){var l=s.decode(e);if(l.tag===0)break;u[u.length]=l}r=a-e.pos}catch(c){throw"Exception while decoding undefined length content: "+c}}else e.pos+=r;return new s(t,o,r,n,u)},s.test=function(){var e=[{value:[39],expected:39},{value:[129,201],expected:201},{value:[131,254,220,186],expected:16702650}];for(var t=0,n=e.length;t<n;++t){var r=0,o=new i(e[t].value,0),u=s.decodeLength(o);u!=e[t].expected&&document.write("In test["+t+"] expected "+e[t].expected+" got "+u+"\n")}},window.ASN1=s}(),ASN1.prototype.getHexStringValue=function(){var e=this.toHexString(),t=this.header*2,n=this.length*2;return e.substr(t,n)},An.prototype.parseKey=function(e){try{var t=0,n=0,r=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/,i=r.test(e)?Hex.decode(e):Base64.unarmor(e),s=ASN1.decode(i);s.sub.length===3&&(s=s.sub[2].sub[0]);if(s.sub.length===9){t=s.sub[1].getHexStringValue(),this.n=Nn(t,16),n=s.sub[2].getHexStringValue(),this.e=parseInt(n,16);var o=s.sub[3].getHexStringValue();this.d=Nn(o,16);var u=s.sub[4].getHexStringValue();this.p=Nn(u,16);var a=s.sub[5].getHexStringValue();this.q=Nn(a,16);var f=s.sub[6].getHexStringValue();this.dmp1=Nn(f,16);var l=s.sub[7].getHexStringValue();this.dmq1=Nn(l,16);var c=s.sub[8].getHexStringValue();this.coeff=Nn(c,16)}else{if(s.sub.length!==2)return!1;var h=s.sub[1],p=h.sub[0];t=p.sub[0].getHexStringValue(),this.n=Nn(t,16),n=p.sub[1].getHexStringValue(),this.e=parseInt(n,16)}return!0}catch(d){return!1}},An.prototype.getPrivateBaseKey=function(){var e={array:[new KJUR.asn1.DERInteger({"int":0}),new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({"int":this.e}),new KJUR.asn1.DERInteger({bigint:this.d}),new KJUR.asn1.DERInteger({bigint:this.p}),new KJUR.asn1.DERInteger({bigint:this.q}),new KJUR.asn1.DERInteger({bigint:this.dmp1}),new KJUR.asn1.DERInteger({bigint:this.dmq1}),new KJUR.asn1.DERInteger({bigint:this.coeff})]},t=new KJUR.asn1.DERSequence(e);return t.getEncodedHex()},An.prototype.getPrivateBaseKeyB64=function(){return Rn(this.getPrivateBaseKey())},An.prototype.getPublicBaseKey=function(){var e={array:[new KJUR.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new KJUR.asn1.DERNull]},t=new KJUR.asn1.DERSequence(e);e={array:[new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({"int":this.e})]};var n=new KJUR.asn1.DERSequence(e);e={hex:"00"+n.getEncodedHex()};var r=new KJUR.asn1.DERBitString(e);e={array:[t,r]};var i=new KJUR.asn1.DERSequence(e);return i.getEncodedHex()},An.prototype.getPublicBaseKeyB64=function(){return Rn(this.getPublicBaseKey())},An.prototype.wordwrap=function(e,t){t=t||64;if(!e)return e;var n="(.{1,"+t+"})( +|$\n?)|(.{1,"+t+"})";return e.match(RegExp(n,"g")).join("\n")},An.prototype.getPrivateKey=function(){var e="-----BEGIN RSA PRIVATE KEY-----\n";return e+=this.wordwrap(this.getPrivateBaseKeyB64())+"\n",e+="-----END RSA PRIVATE KEY-----",e},An.prototype.getPublicKey=function(){var e="-----BEGIN PUBLIC KEY-----\n";return e+=this.wordwrap(this.getPublicBaseKeyB64())+"\n",e+="-----END PUBLIC KEY-----",e},An.prototype.hasPublicKeyProperty=function(e){return e=e||{},e.hasOwnProperty("n")&&e.hasOwnProperty("e")},An.prototype.hasPrivateKeyProperty=function(e){return e=e||{},e.hasOwnProperty("n")&&e.hasOwnProperty("e")&&e.hasOwnProperty("d")&&e.hasOwnProperty("p")&&e.hasOwnProperty("q")&&e.hasOwnProperty("dmp1")&&e.hasOwnProperty("dmq1")&&e.hasOwnProperty("coeff")},An.prototype.parsePropertiesFrom=function(e){this.n=e.n,this.e=e.e,e.hasOwnProperty("d")&&(this.d=e.d,this.p=e.p,this.q=e.q,this.dmp1=e.dmp1,this.dmq1=e.dmq1,this.coeff=e.coeff)};var Kn=function(e){An.call(this),e&&(typeof e=="string"?this.parseKey(e):(this.hasPrivateKeyProperty(e)||this.hasPublicKeyProperty(e))&&this.parsePropertiesFrom(e))};Kn.prototype=new An,Kn.prototype.constructor=Kn;var Qn=function(e){e=e||{},this.default_key_size=parseInt(e.default_key_size)||1024,this.default_public_exponent=e.default_public_exponent||"010001",this.log=e.log||!1,this.key=null};Qn.prototype.setKey=function(e){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new Kn(e)},Qn.prototype.setPrivateKey=function(e){this.setKey(e)},Qn.prototype.setPublicKey=function(e){this.setKey(e)},Qn.prototype.decrypt=function(e){try{return this.getKey().decrypt(Un(e))}catch(t){return!1}},Qn.prototype.encrypt=function(e){try{return Rn(this.getKey().encrypt(e))}catch(t){return!1}},Qn.prototype.getKey=function(e){if(!this.key){this.key=new Kn;if(e&&{}.toString.call(e)==="[object Function]"){this.key.generateAsync(this.default_key_size,this.default_public_exponent,e);return}this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},Qn.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},Qn.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},Qn.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},Qn.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},e.JSEncrypt=Qn})(e);var t=e.JSEncrypt;return t}),define("plugin/validator",[],function(){var e={intege:/^-?[1-9]\d*$/,intege1:/^[1-9]\d*$/,intege2:/^-[1-9]\d*$/,num:/^([+-]?)\d*\.?\d+$/,num1:/^[1-9]\d*|0$/,num2:/^-[1-9]\d*|0$/,decmal:/^([+-]?)\d*\.\d+$/,decmal1:/^[1-9]\d*.\d*|0.\d*[1-9]\d*$/,decmal2:/^-([1-9]\d*.\d*|0.\d*[1-9]\d*)$/,decmal3:/^-?([1-9]\d*.\d*|0.\d*[1-9]\d*|0?.0+|0)$/,decmal4:/^[1-9]\d*.\d*|0.\d*[1-9]\d*|0?.0+|0$/,decmal5:/^(-([1-9]\d*.\d*|0.\d*[1-9]\d*))|0?.0+|0$/,email:/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,color:/^[a-fA-F0-9]{6}$/,url:/^http[s]?:\/\/([\w-]+\.)+[\w-]+([\w\-.\/\?\%\&\=\#]*)?$/,chinese:/^[\u4E00-\u9FA5\uF900-\uFA2D]+$/,include_chinese:/[\u4E00-\u9FA5\uF900-\uFA2D]/g,ascii:/^[\x00-\xFF]+$/,zipcode:/^\d{6}$/,mobile:/^1(([3578][0-9])|(4[57]))[0-9]{8}$/,ip4:/^(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)$/,notempty:/^\S+$/,picture:/(.*)\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$/,rar:/(.*)\.(rar|zip|7zip|tgz)$/,date:/^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$/,qq:/^[1-9]*[1-9][0-9]*$/,tel:/^(([0\+]\d{2,3}-)?(0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/,username:/^\w+$/,letter:/^[A-Za-z]+$/,letter_u:/^[A-Z]+$/,letter_l:/^[a-z]+$/,idcard:/^[1-9]([0-9]{13}|[0-9]{16})([0-9]|X)$/,illchar:/[\~\`\!\@\#\$\%\^\&\*\(\)\-\=\+\\\|\'\"\;\:\.\>\,\<\/\?\~\·\！\@\#\￥\%\…\…\&\*\（\）\—\—\-\+\=\|\\\}\]\{\[\"\'\:\;\?\/\>\.\<\,]/,validator:function(e,t){var n=!1;return this[t]&&this[t].test(e)&&(n=!0),n},validatorLength:function(e,t,n){var r=!1,i=e.length;n=n||t;if(t>n){var s=t;t=n,n=s}return i>=t&&i<=n&&(r=!0),r},init:function(e){var t=this;$(e).find(".validator").each(function(){var e=this;$(e).data("valid",t.getvalidator($(e))),$(e).bind("blur",function(){t.doVaild.call(t,e,$(e).val(),$(e).data("valid"))})})},getvalidator:function(e){var t=$(e).attr("validator")||"",n=$(e).attr("msg")||"",r=$(e).attr("require_msg")||"",i=$(e).attr("require")||!1,s=t.replace(/\[(.*?)\]/g,"")||undefined,o=/\[(.*?)\]/.exec(t)||undefined;return o&&(o=o[1].split(",")),{type:s,length:o,require:i,msg:n,require_msg:r}},doVaild:function(e,t,n){var r=!0,i=0,s="";$("span.validator_"+$(e).attr("id")).text("").removeClass("sp_error").addClass("sp_right"),n.require&&t==""&&(r=!1,s=n.require_msg,$("span.validator_"+$(e).attr("id")).text(n.require_msg).addClass("sp_error").removeClass("sp_right")),n.type&&r&&(r=this.validator(t,n.type),r==0&&(s=n.msg,$("span.validator_"+$(e).attr("id")).text(n.msg).addClass("sp_error").removeClass("sp_right")));if(r&&n.length){i=t.length;if(i<n.length[0]||i>n.length[1])$("span.validator_"+$(e).attr("id")).text(n.msg).addClass("sp_error").removeClass("sp_right"),s=n.msg,r=!1}return{res:r,msg:s}},doVaildR:function(e){var t=this,n=!1;return $(e).find(".validator").each(function(){var e=this;n=t.doVaild.call(t,e,$.trim($(e).val()),$(e).data("valid"));if(!n.res)return!1}),n}};return e}),define("plugin/jquery.md5",["jquery"],function(e){(function(e){function t(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function n(e,t){return e<<t|e>>>32-t}function r(e,r,i,s,o,u){return t(n(t(t(r,e),t(s,u)),o),i)}function i(e,t,n,i,s,o,u){return r(t&n|~t&i,e,t,s,o,u)}function s(e,t,n,i,s,o,u){return r(t&i|n&~i,e,t,s,o,u)}function o(e,t,n,i,s,o,u){return r(t^n^i,e,t,s,o,u)}function u(e,t,n,i,s,o,u){return r(n^(t|~i),e,t,s,o,u)}function a(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var r,a,f,l,c,h=1732584193,p=-271733879,d=-1732584194,v=271733878;for(r=0;r<e.length;r+=16)a=h,f=p,l=d,c=v,h=i(h,p,d,v,e[r],7,-680876936),v=i(v,h,p,d,e[r+1],12,-389564586),d=i(d,v,h,p,e[r+2],17,606105819),p=i(p,d,v,h,e[r+3],22,-1044525330),h=i(h,p,d,v,e[r+4],7,-176418897),v=i(v,h,p,d,e[r+5],12,1200080426),d=i(d,v,h,p,e[r+6],17,-1473231341),p=i(p,d,v,h,e[r+7],22,-45705983),h=i(h,p,d,v,e[r+8],7,1770035416),v=i(v,h,p,d,e[r+9],12,-1958414417),d=i(d,v,h,p,e[r+10],17,-42063),p=i(p,d,v,h,e[r+11],22,-1990404162),h=i(h,p,d,v,e[r+12],7,1804603682),v=i(v,h,p,d,e[r+13],12,-40341101),d=i(d,v,h,p,e[r+14],17,-1502002290),p=i(p,d,v,h,e[r+15],22,1236535329),h=s(h,p,d,v,e[r+1],5,-165796510),v=s(v,h,p,d,e[r+6],9,-1069501632),d=s(d,v,h,p,e[r+11],14,643717713),p=s(p,d,v,h,e[r],20,-373897302),h=s(h,p,d,v,e[r+5],5,-701558691),v=s(v,h,p,d,e[r+10],9,38016083),d=s(d,v,h,p,e[r+15],14,-660478335),p=s(p,d,v,h,e[r+4],20,-405537848),h=s(h,p,d,v,e[r+9],5,568446438),v=s(v,h,p,d,e[r+14],9,-1019803690),d=s(d,v,h,p,e[r+3],14,-187363961),p=s(p,d,v,h,e[r+8],20,1163531501),h=s(h,p,d,v,e[r+13],5,-1444681467),v=s(v,h,p,d,e[r+2],9,-51403784),d=s(d,v,h,p,e[r+7],14,1735328473),p=s(p,d,v,h,e[r+12],20,-1926607734),h=o(h,p,d,v,e[r+5],4,-378558),v=o(v,h,p,d,e[r+8],11,-2022574463),d=o(d,v,h,p,e[r+11],16,1839030562),p=o(p,d,v,h,e[r+14],23,-35309556),h=o(h,p,d,v,e[r+1],4,-1530992060),v=o(v,h,p,d,e[r+4],11,1272893353),d=o(d,v,h,p,e[r+7],16,-155497632),p=o(p,d,v,h,e[r+10],23,-1094730640),h=o(h,p,d,v,e[r+13],4,681279174),v=o(v,h,p,d,e[r],11,-358537222),d=o(d,v,h,p,e[r+3],16,-722521979),p=o(p,d,v,h,e[r+6],23,76029189),h=o(h,p,d,v,e[r+9],4,-640364487),v=o(v,h,p,d,e[r+12],11,-421815835),d=o(d,v,h,p,e[r+15],16,530742520),p=o(p,d,v,h,e[r+2],23,-995338651),h=u(h,p,d,v,e[r],6,-198630844),v=u(v,h,p,d,e[r+7],10,1126891415),d=u(d,v,h,p,e[r+14],15,-1416354905),p=u(p,d,v,h,e[r+5],21,-57434055),h=u(h,p,d,v,e[r+12],6,1700485571),v=u(v,h,p,d,e[r+3],10,-1894986606),d=u(d,v,h,p,e[r+10],15,-1051523),p=u(p,d,v,h,e[r+1],21,-2054922799),h=u(h,p,d,v,e[r+8],6,1873313359),v=u(v,h,p,d,e[r+15],10,-30611744),d=u(d,v,h,p,e[r+6],15,-1560198380),p=u(p,d,v,h,e[r+13],21,1309151649),h=u(h,p,d,v,e[r+4],6,-145523070),v=u(v,h,p,d,e[r+11],10,-1120210379),d=u(d,v,h,p,e[r+2],15,718787259),p=u(p,d,v,h,e[r+9],21,-343485551),h=t(h,a),p=t(p,f),d=t(d,l),v=t(v,c);return[h,p,d,v]}function f(e){var t,n="";for(t=0;t<e.length*32;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];n[(e.length>>2)-1]=undefined;for(t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<e.length*8;t+=8)n[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32;return n}function c(e){return f(a(l(e),e.length*8))}function h(e,t){var n,r=l(e),i=[],s=[],o;i[15]=s[15]=undefined,r.length>16&&(r=a(r,e.length*8));for(n=0;n<16;n+=1)i[n]=r[n]^909522486,s[n]=r[n]^1549556828;return o=a(i.concat(l(t)),512+t.length*8),f(a(s.concat(o),640))}function p(e){var t="0123456789abcdef",n="",r,i;for(i=0;i<e.length;i+=1)r=e.charCodeAt(i),n+=t.charAt(r>>>4&15)+t.charAt(r&15);return n}function d(e){return unescape(encodeURIComponent(e))}function v(e){return c(d(e))}function m(e){return p(v(e))}function g(e,t){return h(d(e),d(t))}function y(e,t){return p(g(e,t))}e.md5=function(e,t,n){return t?n?g(t,e):y(t,e):n?v(e):m(e)}})(typeof jQuery=="function"?jQuery:this)}),define("model/account",["jquery","underscore","backbone","plugin/jsencrypt","plugin/validator","plugin/jquery.md5"],function(e,t,n,r,i){var s=n.Model.extend({regMobileCode:function(e,t,n){var r="/passport/mobile/getVerifyCode";this.set("postData",{phone_num:e,msgType:4}),this.ajax(r,t,n)},regUserCheck:function(){var e="/passport/guider/profile/checkEmail";this.set("postData",{email:val}),this.ajax(e,success,error)},regNickNameCheck:function(e,t,n){var r="/passport/guider/profile/checkNickname";this.set("postData",{nickname:e}),this.ajax(r,t,n)},loginUserCheck:function(e,t,n){var r="/passport/login/checkAccount";this.set("postData",{email:e}),this.ajax(r,t,n)},getLoginToken:function(t,n){var r=this;e.ajax({url:"/passport/token/login",type:"get",dataType:"json",success:function(e){e.ret==0?t(e.token):n&&n("系统出错了！")},error:function(){n&&n("系统出错了！")}})},requestLogin:function(e,t,n){var r="/passport/v3/security/popupLogin",i=this.params;i.password=this.encryption(i.password,e),this.set("postData",i),this.ajax(r,t,n)},encryption:function(t,n){var i=e.md5(t)+(n||""),s="MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCVhaR3Or7suUlwHUl2Ly36uVmboZ3+HhovogDjLgRE9CbaUokS2eqGaVFfbxAUxFThNDuXq/fBD+SdUgppmcZrIw4HMMP4AtE2qJJQH/KxPWmbXH7Lv+9CisNtPYOlvWJ/GHRqf9x3TBKjjeJ2CjuVxlPBDX63+Ecil2JR9klVawIDAQAB",o=new r;o.setPublicKey(s),o.getPublicKey();var u=o.encrypt(i);return u},login:function(e,t,n,r,i){this.params={account:e,password:t,rememberMe:n},this.getLoginToken(r,i)},popupLogin:function(e,t,n){var r=this;this.params=e,this.getLoginToken(function(e){r.requestLogin(e,t,n)},n)},getCheckCode:function(e,t,n){var r=this;this.params=e,this.getLoginToken(function(e){r.smsSend(e,t,n)})},smsSend:function(e,t,n){var r="/passport/v1/sms/send",i=this.params;i.nonce=e,this.set("postData",i),this.ajax(r,t,n)},toBindPhone:function(e,t,n){var r=this;this.params=e,this.getLoginToken(function(e){r.verifySms(e,t,n)})},verifySms:function(e,t,n){var r="/passport/v1/sms/verifyBind",i=this.params;i.nonce=e,this.set("postData",i),this.ajax(r,t,n)},changePassword:function(e,t,n,r){var i="/passport/rsa/modifyPwd"},ajax:function(t,n,r,i){n=n||e.noop,r=r||e.noop;var s=this.get("postData");e.ajax({url:t,type:i?"get":"post",dataType:"json",data:s,success:function(e){e.ret===2001&&t==="/passport/security/popupLogin"&&(window.location="/passport/rescue_account"),e.result=="success"||e.success?n(e):r(e)},error:function(e){r(e)}})}});return s}),define("model/coutrycode",["jquery","underscore","backbone"],function(e,t,n,r){var i=n.Model.extend({defaults:{index:"",name:"",engName:"",firstWord:"",shouzimu:"",code:"",selected:!1}});return i}),define("model/coutry",[],function(){var e=[{name:"中国",code:"+86",engName:"China",index:"0",firstWord:"C",shouzimu:"ZG"},{name:"阿鲁巴",code:"+297",engName:"Aruba",index:"1",firstWord:"A",shouzimu:"ALB"},{name:"阿富汗",code:"+93",engName:"Afghanistan",index:"2",firstWord:"A",shouzimu:"AFH"},{name:"安哥拉",code:"+244",engName:"Angola",index:"3",firstWord:"A",shouzimu:"AGL"},{name:"安圭拉",code:"+1264",engName:"Anguilla",index:"4",firstWord:"A",shouzimu:"AGL"},{name:"阿尔巴尼亚",code:"+355",engName:"Albania",index:"5",firstWord:"A",shouzimu:"AEBNY"},{name:"奥兰群岛",code:"+358",engName:"Aland",index:"6",firstWord:"A",shouzimu:"ALQD"},{name:"安道尔",code:"+376",engName:"Andorra",index:"7",firstWord:"A",shouzimu:"ADE"},{name:"阿联酋",code:"+971",engName:"United Arab Emirates",index:"8",firstWord:"A",shouzimu:"ALQ"},{name:"阿根廷",code:"+54",engName:"Argentina",index:"9",firstWord:"A",shouzimu:"AGT"},{name:"亚美尼亚",code:"+374",engName:"Armenia",index:"10",firstWord:"Y",shouzimu:"YMNY"},{name:"美属萨摩亚",code:"+1684",engName:"American Samoa",index:"11",firstWord:"M",shouzimu:"MSSMY"},{name:"南极洲",code:"+672",engName:"Antarctica",index:"12",firstWord:"N",shouzimu:"NJZ"},{name:"安提瓜和巴布达",code:"+1268",engName:"Antigua and Barb.",index:"15",firstWord:"A",shouzimu:"ATGHBBD"},{name:"澳大利亚",code:"+61",engName:"Australia",index:"16",firstWord:"A",shouzimu:"ADLY"},{name:"奥地利",code:"+43",engName:"Austria",index:"17",firstWord:"A",shouzimu:"ADL"},{name:"阿塞拜疆",code:"+994",engName:"Azerbaijan",index:"18",firstWord:"A",shouzimu:"ASBJ"},{name:"布隆迪",code:"+257",engName:"Burundi",index:"19",firstWord:"B",shouzimu:"BLD"},{name:"比利时",code:"+32",engName:"Belgium",index:"20",firstWord:"B",shouzimu:"BLS"},{name:"贝宁",code:"+229",engName:"Benin",index:"21",firstWord:"B",shouzimu:"BN"},{name:"布基纳法索",code:"+226",engName:"Burkina Faso",index:"22",firstWord:"B",shouzimu:"BJNFS"},{name:"孟加拉",code:"+880",engName:"Bangladesh",index:"23",firstWord:"M",shouzimu:"MJL"},{name:"保加利亚",code:"+359",engName:"Bulgaria",index:"24",firstWord:"B",shouzimu:"BJLY"},{name:"巴林",code:"+973",engName:"Bahrain",index:"25",firstWord:"B",shouzimu:"BL"},{name:"巴哈马",code:"+1242",engName:"Bahamas",index:"26",firstWord:"B",shouzimu:"BHM"},{name:"波斯尼亚和黑塞哥维那",code:"+387",engName:"Bosnia and Herz.",index:"27",firstWord:"B",shouzimu:"BSNYHHSGWN"},{name:"圣巴泰勒米岛",code:"+290",engName:"St-Barthélemy",index:"29",firstWord:"S",shouzimu:"SBTLMD"},{name:"白俄罗斯",code:"+375",engName:"Belarus",index:"30",firstWord:"B",shouzimu:"BELS"},{name:"伯利兹",code:"+501",engName:"Belize",index:"31",firstWord:"B",shouzimu:"BLZ"},{name:"百慕大",code:"+1441",engName:"Bermuda",index:"32",firstWord:"B",shouzimu:"BMD"},{name:"玻利维亚",code:"+591",engName:"Bolivia",index:"33",firstWord:"B",shouzimu:"BLWY"},{name:"巴西",code:"+55",engName:"Brazil",index:"34",firstWord:"B",shouzimu:"BX"},{name:"巴巴多斯",code:"+1246",engName:"Barbados",index:"35",firstWord:"B",shouzimu:"BBDS"},{name:"文莱",code:"+673",engName:"Brunei",index:"36",firstWord:"W",shouzimu:"WL"},{name:"不丹",code:"+975",engName:"Bhutan",index:"37",firstWord:"B",shouzimu:"BD"},{name:"博茨瓦纳",code:"+267",engName:"Botswana",index:"38",firstWord:"B",shouzimu:"BCWN"},{name:"中非",code:"+236",engName:"Central African Rep.",index:"39",firstWord:"Z",shouzimu:"ZF"},{name:"加拿大",code:"+1",engName:"Canada",index:"40",firstWord:"J",shouzimu:"JND"},{name:"瑞士",code:"+41",engName:"Switzerland",index:"41",firstWord:"R",shouzimu:"RS"},{name:"智利",code:"+56",engName:"Chile",index:"42",firstWord:"Z",shouzimu:"ZL"},{name:"中国",code:"+86",engName:"China",index:"43",firstWord:"Z",shouzimu:"ZGDL",hot:!0},{name:"科特迪瓦",code:"+225",engName:"Côte d'Ivoire",index:"44",firstWord:"K",shouzimu:"KTDW"},{name:"喀麦隆",code:"+237",engName:"Cameroon",index:"46",firstWord:"K",shouzimu:"KML"},{name:"刚果(金)",code:"+243",engName:"Dem. Rep. Congo",index:"48",firstWord:"G",shouzimu:"GG(J)"},{name:"刚果(布)",code:"+242",engName:"Congo",index:"49",firstWord:"G",shouzimu:"GG(B)"},{name:"库克群岛",code:"+682",engName:"Cook Is.",index:"50",firstWord:"K",shouzimu:"KKQD"},{name:"哥伦比亚",code:"+57",engName:"Colombia",index:"51",firstWord:"G",shouzimu:"GLBY"},{name:"科摩罗",code:"+269",engName:"Comoros",index:"52",firstWord:"K",shouzimu:"KML"},{name:"佛得角",code:"+238",engName:"Cape Verde",index:"53",firstWord:"F",shouzimu:"FDJ"},{name:"哥斯达黎加",code:"+506",engName:"Costa Rica",index:"54",firstWord:"G",shouzimu:"GSDLJ"},{name:"古巴",code:"+53",engName:"Cuba",index:"56",firstWord:"G",shouzimu:"GB"},{name:"库拉索",code:"+5999",engName:"Curaçao",index:"57",firstWord:"K",shouzimu:"KLS"},{name:"开曼群岛",code:"+1345",engName:"Cayman Is.",index:"58",firstWord:"K",shouzimu:"KMQD"},{name:"塞浦路斯",code:"+357",engName:"Cyprus",index:"60",firstWord:"S",shouzimu:"SPLS"},{name:"捷克",code:"+420",engName:"Czech Rep.",index:"61",firstWord:"J",shouzimu:"JK"},{name:"德国",code:"+49",engName:"Germany",index:"62",firstWord:"D",shouzimu:"DG"},{name:"吉布提",code:"+253",engName:"Djibouti",index:"63",firstWord:"J",shouzimu:"JBT"},{name:"多米尼克",code:"+1767",engName:"Dominica",index:"64",firstWord:"D",shouzimu:"DMNK"},{name:"丹麦",code:"+45",engName:"Denmark",index:"65",firstWord:"D",shouzimu:"DM"},{name:"多米尼加",code:"+1809",engName:"Dominican Rep.",index:"66",firstWord:"D",shouzimu:"DMNJ"},{name:"阿尔及利亚",code:"+213",engName:"Algeria",index:"67",firstWord:"A",shouzimu:"AEJLY"},{name:"厄瓜多尔",code:"+593",engName:"Ecuador",index:"68",firstWord:"E",shouzimu:"EGDE"},{name:"埃及",code:"+20",engName:"Egypt",index:"69",firstWord:"A",shouzimu:"AJ"},{name:"厄立特里亚",code:"+291",engName:"Eritrea",index:"70",firstWord:"E",shouzimu:"ELTLY"},{name:"西班牙",code:"+34",engName:"Spain",index:"72",firstWord:"X",shouzimu:"XBY"},{name:"爱沙尼亚",code:"+372",engName:"Estonia",index:"73",firstWord:"A",shouzimu:"ASNY"},{name:"埃塞俄比亚",code:"+251",engName:"Ethiopia",index:"74",firstWord:"A",shouzimu:"ASEBY"},{name:"芬兰",code:"+358",engName:"Finland",index:"75",firstWord:"F",shouzimu:"FL"},{name:"斐济",code:"+679",engName:"Fiji",index:"76",firstWord:"F",shouzimu:"FJ"},{name:"福克兰群岛",code:"+500",engName:"Falkland Is.",index:"77",firstWord:"F",shouzimu:"FKLQD"},{name:"法国",code:"+33",engName:"France",index:"78",firstWord:"F",shouzimu:"FG"},{name:"法罗群岛",code:"+298",engName:"Faeroe Is.",index:"79",firstWord:"F",shouzimu:"FLQD"},{name:"密克罗尼西亚联邦",code:"+691",engName:"Micronesia",index:"80",firstWord:"M",shouzimu:"MKLNXYLB"},{name:"加蓬",code:"+241",engName:"Gabon",index:"81",firstWord:"J",shouzimu:"JP"},{name:"英国",code:"+44",engName:"United Kingdom",index:"82",firstWord:"Y",shouzimu:"YG"},{name:"格鲁吉亚",code:"+995",engName:"Georgia",index:"83",firstWord:"G",shouzimu:"GLJY"},{name:"加纳",code:"+233",engName:"Ghana",index:"85",firstWord:"J",shouzimu:"JN"},{name:"直布罗陀",code:"+350",engName:"Gibraltar",index:"86",firstWord:"Z",shouzimu:"ZBLT"},{name:"几内亚",code:"+224",engName:"Guinea",index:"87",firstWord:"J",shouzimu:"JNY"},{name:"冈比亚",code:"+220",engName:"Gambia",index:"88",firstWord:"G",shouzimu:"GBY"},{name:"几内亚比绍",code:"+245",engName:"Guinea-Bissau",index:"89",firstWord:"J",shouzimu:"JNYBS"},{name:"赤道几内亚",code:"+240",engName:"Eq. Guinea",index:"90",firstWord:"C",shouzimu:"CDJNY"},{name:"希腊",code:"+30",engName:"Greece",index:"91",firstWord:"X",shouzimu:"XL"},{name:"格林纳达",code:"+1473",engName:"Grenada",index:"92",firstWord:"G",shouzimu:"GLND"},{name:"格陵兰",code:"+299",engName:"Greenland",index:"93",firstWord:"G",shouzimu:"GLL"},{name:"危地马拉",code:"+502",engName:"Guatemala",index:"94",firstWord:"W",shouzimu:"WDML"},{name:"关岛",code:"+1671",engName:"Guam",index:"95",firstWord:"G",shouzimu:"GD"},{name:"圭亚那",code:"+592",engName:"Guyana",index:"96",firstWord:"G",shouzimu:"GYN"},{name:"洪都拉斯",code:"+504",engName:"Honduras",index:"99",firstWord:"H",shouzimu:"HDLS"},{name:"克罗地亚",code:"+385",engName:"Croatia",index:"100",firstWord:"K",shouzimu:"KLDY"},{name:"海地",code:"+509",engName:"Haiti",index:"101",firstWord:"H",shouzimu:"HD"},{name:"匈牙利",code:"+36",engName:"Hungary",index:"102",firstWord:"X",shouzimu:"XYL"},{name:"印度尼西亚",code:"+62",engName:"Indonesia",index:"103",firstWord:"Y",shouzimu:"YDNXY"},{name:"印度",code:"+91",engName:"India",index:"105",firstWord:"Y",shouzimu:"YD"},{name:"英属印度洋领地",code:"+246",engName:"Br. Indian Ocean Ter.",index:"107",firstWord:"Y",shouzimu:"YSYDYLD"},{name:"爱尔兰",code:"+353",engName:"Ireland",index:"108",firstWord:"A",shouzimu:"AEL"},{name:"伊朗",code:"+98",engName:"Iran",index:"109",firstWord:"Y",shouzimu:"YL"},{name:"伊拉克",code:"+964",engName:"Iraq",index:"110",firstWord:"Y",shouzimu:"YLK"},{name:"冰岛",code:"+354",engName:"Iceland",index:"111",firstWord:"B",shouzimu:"BD"},{name:"以色列",code:"+972",engName:"Israel",index:"112",firstWord:"Y",shouzimu:"YSL"},{name:"意大利",code:"+39",engName:"Italy",index:"113",firstWord:"Y",shouzimu:"YDL"},{name:"牙买加",code:"+1876",engName:"Jamaica",index:"114",firstWord:"Y",shouzimu:"YMJ"},{name:"约旦",code:"+962",engName:"Jordan",index:"116",firstWord:"Y",shouzimu:"YD"},{name:"日本",code:"+81",engName:"Japan",index:"117",firstWord:"R",shouzimu:"RB"},{name:"哈萨克斯坦",code:"+327",engName:"Kazakhstan",index:"120",firstWord:"H",shouzimu:"HSKST"},{name:"肯尼亚",code:"+254",engName:"Kenya",index:"121",firstWord:"K",shouzimu:"KNY"},{name:"吉尔吉斯斯坦",code:"+331",engName:"Kyrgyzstan",index:"122",firstWord:"J",shouzimu:"JEJSST"},{name:"柬埔寨",code:"+855",engName:"Cambodia",index:"123",firstWord:"J",shouzimu:"JPZ"},{name:"基里巴斯",code:"+686",engName:"Kiribati",index:"124",firstWord:"J",shouzimu:"JLBS"},{name:"圣基茨和尼维斯",code:"+1869",engName:"St. Kitts and Nevis",index:"125",firstWord:"S",shouzimu:"SJCHNWS"},{name:"韩国",code:"+82",engName:"Korea",index:"126",firstWord:"H",shouzimu:"HG"},{name:"科索沃",code:"+384",engName:"Kosovo",index:"127",firstWord:"K",shouzimu:"KSW"},{name:"科威特",code:"+965",engName:"Kuwait",index:"128",firstWord:"K",shouzimu:"KWT"},{name:"老挝",code:"+856",engName:"Lao PDR",index:"129",firstWord:"L",shouzimu:"LW"},{name:"黎巴嫩",code:"+961",engName:"Lebanon",index:"130",firstWord:"L",shouzimu:"LBN"},{name:"利比里亚",code:"+231",engName:"Liberia",index:"131",firstWord:"L",shouzimu:"LBLY"},{name:"利比亚",code:"+218",engName:"Libya",index:"132",firstWord:"L",shouzimu:"LBY"},{name:"圣卢西亚",code:"+1758",engName:"Saint Lucia",index:"133",firstWord:"S",shouzimu:"SLXY"},{name:"列支敦士登",code:"+423",engName:"Liechtenstein",index:"134",firstWord:"L",shouzimu:"LZDSD"},{name:"斯里兰卡",code:"+94",engName:"Sri Lanka",index:"135",firstWord:"S",shouzimu:"SLLK"},{name:"莱索托",code:"+266",engName:"Lesotho",index:"136",firstWord:"L",shouzimu:"LST"},{name:"立陶宛",code:"+370",engName:"Lithuania",index:"137",firstWord:"L",shouzimu:"LTW"},{name:"卢森堡",code:"+352",engName:"Luxembourg",index:"138",firstWord:"L",shouzimu:"LSB"},{name:"拉脱维亚",code:"+371",engName:"Latvia",index:"139",firstWord:"L",shouzimu:"LTWY"},{name:"法属圣马丁",code:"+1599",engName:"St-Martin",index:"141",firstWord:"F",shouzimu:"FSSMD"},{name:"摩洛哥",code:"+212",engName:"Morocco",index:"142",firstWord:"M",shouzimu:"MLG"},{name:"摩纳哥",code:"+377",engName:"Monaco",index:"143",firstWord:"M",shouzimu:"MNG"},{name:"摩尔多瓦",code:"+373",engName:"Moldova",index:"144",firstWord:"M",shouzimu:"MEDW"},{name:"马达加斯加",code:"+261",engName:"Madagascar",index:"145",firstWord:"M",shouzimu:"MDJSJ"},{name:"马尔代夫",code:"+960",engName:"Maldives",index:"146",firstWord:"M",shouzimu:"MEDF"},{name:"墨西哥",code:"+52",engName:"Mexico",index:"147",firstWord:"M",shouzimu:"MXG"},{name:"马绍尔群岛",code:"+692",engName:"Marshall Is.",index:"148",firstWord:"M",shouzimu:"MSEQD"},{name:"马其顿",code:"+389",engName:"Macedonia",index:"149",firstWord:"M",shouzimu:"MQD"},{name:"马里",code:"+223",engName:"Mali",index:"150",firstWord:"M",shouzimu:"ML"},{name:"马耳他",code:"+356",engName:"Malta",index:"151",firstWord:"M",shouzimu:"MET"},{name:"缅甸",code:"+95",engName:"Myanmar",index:"152",firstWord:"M",shouzimu:"MD"},{name:"黑山",code:"+382",engName:"Montenegro",index:"153",firstWord:"H",shouzimu:"HS"},{name:"蒙古",code:"+976",engName:"Mongolia",index:"154",firstWord:"M",shouzimu:"MG"},{name:"北马里亚纳群岛",code:"+1670",engName:"N. Mariana Is.",index:"155",firstWord:"B",shouzimu:"BMLYNQD"},{name:"莫桑比克",code:"+258",engName:"Mozambique",index:"156",firstWord:"M",shouzimu:"MSBK"},{name:"毛里塔尼亚",code:"+222",engName:"Mauritania",index:"157",firstWord:"M",shouzimu:"MLTNY"},{name:"蒙塞拉特岛",code:"+1664",engName:"Montserrat",index:"158",firstWord:"M",shouzimu:"MSLTD"},{name:"毛里求斯",code:"+230",engName:"Mauritius",index:"159",firstWord:"M",shouzimu:"MLQS"},{name:"马拉维",code:"+265",engName:"Malawi",index:"160",firstWord:"M",shouzimu:"MLW"},{name:"马来西亚",code:"+60",engName:"Malaysia",index:"161",firstWord:"M",shouzimu:"MLXY"},{name:"纳米比亚",code:"+264",engName:"Namibia",index:"162",firstWord:"N",shouzimu:"NMBY"},{name:"新喀里多尼亚",code:"+687",engName:"New Caledonia",index:"163",firstWord:"X",shouzimu:"XKLDNY"},{name:"尼日尔",code:"+227",engName:"Niger",index:"164",firstWord:"N",shouzimu:"NRE"},{name:"诺福克岛",code:"+672",engName:"Norfolk Island",index:"165",firstWord:"N",shouzimu:"NFKD"},{name:"尼日利亚",code:"+234",engName:"Nigeria",index:"166",firstWord:"N",shouzimu:"NRLY"},{name:"尼加拉瓜",code:"+505",engName:"Nicaragua",index:"167",firstWord:"N",shouzimu:"NJLG"},{name:"纽埃岛",code:"+683",engName:"Niue",index:"168",firstWord:"N",shouzimu:"NAD"},{name:"荷兰",code:"+31",engName:"Netherlands",index:"169",firstWord:"H",shouzimu:"HL"},{name:"挪威",code:"+47",engName:"Norway",index:"170",firstWord:"N",shouzimu:"NW"},{name:"尼泊尔",code:"+977",engName:"Nepal",index:"171",firstWord:"N",shouzimu:"NBE"},{name:"瑙鲁",code:"+674",engName:"Nauru",index:"172",firstWord:"N",shouzimu:"NL"},{name:"新西兰",code:"+64",engName:"New Zealand",index:"173",firstWord:"X",shouzimu:"XXL"},{name:"阿曼",code:"+968",engName:"Oman",index:"174",firstWord:"A",shouzimu:"AM"},{name:"巴基斯坦",code:"+92",engName:"Pakistan",index:"175",firstWord:"B",shouzimu:"BJST"},{name:"巴拿马",code:"+507",engName:"Panama",index:"176",firstWord:"B",shouzimu:"BNM"},{name:"秘鲁",code:"+51",engName:"Peru",index:"178",firstWord:"B",shouzimu:"BL"},{name:"菲律宾",code:"+63",engName:"Philippines",index:"180",firstWord:"F",shouzimu:"FLB"},{name:"帕劳",code:"+680",engName:"Palau",index:"181",firstWord:"P",shouzimu:"PL"},{name:"巴布亚新几内亚",code:"+675",engName:"Papua New Guinea",index:"182",firstWord:"B",shouzimu:"BBYXJNY"},{name:"波兰",code:"+48",engName:"Poland",index:"183",firstWord:"B",shouzimu:"BL"},{name:"波多黎各",code:"+1787",engName:"Puerto Rico",index:"184",firstWord:"B",shouzimu:"BDLG"},{name:"朝鲜",code:"+850",engName:"Dem. Rep. Korea",index:"185",firstWord:"C",shouzimu:"CX"},{name:"葡萄牙",code:"+351",engName:"Portugal",index:"186",firstWord:"P",shouzimu:"PTY"},{name:"巴拉圭",code:"+595",engName:"Paraguay",index:"187",firstWord:"B",shouzimu:"BLG"},{name:"巴勒斯坦",code:"+970",engName:"Palestine",index:"188",firstWord:"B",shouzimu:"BLST"},{name:"法属波利尼西亚",code:"+689",engName:"Fr. Polynesia",index:"189",firstWord:"F",shouzimu:"FSBLNXY"},{name:"卡塔尔",code:"+974",engName:"Qatar",index:"190",firstWord:"K",shouzimu:"KTE"},{name:"罗马尼亚",code:"+40",engName:"Romania",index:"191",firstWord:"L",shouzimu:"LMNY"},{name:"俄罗斯",code:"+7",engName:"Russia",index:"192",firstWord:"E",shouzimu:"ELS"},{name:"卢旺达",code:"+250",engName:"Rwanda",index:"193",firstWord:"L",shouzimu:"LWD"},{name:"沙特阿拉伯",code:"+966",engName:"Saudi Arabia",index:"195",firstWord:"S",shouzimu:"STALB"},{name:"苏丹",code:"+249",engName:"Sudan",index:"197",firstWord:"S",shouzimu:"SD"},{name:"南苏丹",code:"+211",engName:"S. Sudan",index:"198",firstWord:"N",shouzimu:"NSD"},{name:"塞内加尔",code:"+221",engName:"Senegal",index:"199",firstWord:"S",shouzimu:"SNJE"},{name:"新加坡",code:"+65",engName:"Singapore",index:"201",firstWord:"X",shouzimu:"XJP"},{name:"所罗门群岛",code:"+677",engName:"Solomon Is.",index:"204",firstWord:"S",shouzimu:"SLMQD"},{name:"塞拉利昂",code:"+232",engName:"Sierra Leone",index:"205",firstWord:"S",shouzimu:"SLLA"},{name:"萨尔瓦多",code:"+503",engName:"El Salvador",index:"206",firstWord:"S",shouzimu:"SEWD"},{name:"圣马力诺",code:"+378",engName:"San Marino",index:"207",firstWord:"S",shouzimu:"SMLN"},{name:"索马里",code:"+252",engName:"Somalia",index:"209",firstWord:"S",shouzimu:"SML"},{name:"圣皮埃尔和密克隆群岛",code:"+508",engName:"St. Pierre and Miquelon",index:"210",firstWord:"S",shouzimu:"SPAEHMKLQD"},{name:"塞尔维亚",code:"+381",engName:"Serbia",index:"211",firstWord:"S",shouzimu:"SEWY"},{name:"圣多美和普林西比",code:"+239",engName:"São Tomé and Principe",index:"212",firstWord:"S",shouzimu:"SDMHPLXB"},{name:"苏里南",code:"+597",engName:"Suriname",index:"213",firstWord:"S",shouzimu:"SLN"},{name:"斯洛伐克",code:"+421",engName:"Slovakia",index:"214",firstWord:"S",shouzimu:"SLFK"},{name:"斯洛文尼亚",code:"+386",engName:"Slovenia",index:"215",firstWord:"S",shouzimu:"SLWNY"},{name:"瑞典",code:"+46",engName:"Sweden",index:"216",firstWord:"R",shouzimu:"RD"},{name:"斯威士兰",code:"+268",engName:"Swaziland",index:"217",firstWord:"S",shouzimu:"SWSL"},{name:"荷属圣马丁",code:"+1721",engName:"Sint Maarten",index:"218",firstWord:"H",shouzimu:"HSSMD"},{name:"塞舌尔",code:"+248",engName:"Seychelles",index:"219",firstWord:"S",shouzimu:"SSE"},{name:"叙利亚",code:"+963",engName:"Syria",index:"220",firstWord:"X",shouzimu:"XLY"},{name:"特克斯和凯科斯群岛",code:"+1649",engName:"Turks and Caicos Is.",index:"221",firstWord:"T",shouzimu:"TKSHKKSQD"},{name:"乍得",code:"+235",engName:"Chad",index:"222",firstWord:"Z",shouzimu:"ZD"},{name:"多哥",code:"+228",engName:"Togo",index:"223",firstWord:"D",shouzimu:"DG"},{name:"泰国",code:"+66",engName:"Thailand",index:"224",firstWord:"T",shouzimu:"TG"},{name:"塔吉克斯坦",code:"+992",engName:"Tajikistan",index:"225",firstWord:"T",shouzimu:"TJKST"},{name:"土库曼斯坦",code:"+993",engName:"Turkmenistan",index:"226",firstWord:"T",shouzimu:"TKMST"},{name:"东帝汶",code:"+670",engName:"Timor-Leste",index:"227",firstWord:"D",shouzimu:"DDW"},{name:"汤加",code:"+676",engName:"Tonga",index:"228",firstWord:"T",shouzimu:"TJ"},{name:"特立尼达和多巴哥",code:"+1868",engName:"Trinidad and Tobago",index:"229",firstWord:"T",shouzimu:"TLNDHDBG"},{name:"突尼斯",code:"+216",engName:"Tunisia",index:"230",firstWord:"T",shouzimu:"TNS"},{name:"土耳其",code:"+90",engName:"Turkey",index:"231",firstWord:"T",shouzimu:"TEQ"},{name:"图瓦卢",code:"+688",engName:"Tuvalu",index:"232",firstWord:"T",shouzimu:"TWL"},{name:"坦桑尼亚",code:"+255",engName:"Tanzania",index:"234",firstWord:"T",shouzimu:"TSNY"},{name:"乌干达",code:"+256",engName:"Uganda",index:"235",firstWord:"W",shouzimu:"WGD"},{name:"乌克兰",code:"+380",engName:"Ukraine",index:"236",firstWord:"W",shouzimu:"WKL"},{name:"乌拉圭",code:"+598",engName:"Uruguay",index:"238",firstWord:"W",shouzimu:"WLG"},{name:"美国",code:"+1",engName:"United States",index:"239",firstWord:"M",shouzimu:"MG"},{name:"乌兹别克斯坦",code:"+233",engName:"Uzbekistan",index:"241",firstWord:"W",shouzimu:"WZBKST"},{name:"梵蒂冈",code:"+39",engName:"Vatican",index:"242",firstWord:"F",shouzimu:"FDG"},{name:"圣文森特和格林纳丁斯",code:"+1784",engName:"St. Vin. and Gren.",index:"243",firstWord:"S",shouzimu:"SWSTHGLNDS"},{name:"委内瑞拉",code:"+58",engName:"Venezuela",index:"244",firstWord:"W",shouzimu:"WNRL"},{name:"英属维尔京群岛",code:"+1284",engName:"British Virgin Is.",index:"245",firstWord:"Y",shouzimu:"YSWEJQD"},{name:"美属维尔京群岛",code:"+1340",engName:"U.S. Virgin Is.",index:"246",firstWord:"M",shouzimu:"MSWEJQD"},{name:"越南",code:"+84",engName:"Vietnam",index:"247",firstWord:"Y",shouzimu:"YN"},{name:"瓦努阿图",code:"+678",engName:"Vanuatu",index:"248",firstWord:"W",shouzimu:"WNAT"},{name:"瓦利斯和富图纳群岛",code:"+681",engName:"Wallis and Futuna Is.",index:"249",firstWord:"W",shouzimu:"WLSHFTNQD"},{name:"萨摩亚",code:"+685",engName:"Samoa",index:"251",firstWord:"S",shouzimu:"SMY"},{name:"也门",code:"+967",engName:"Yemen",index:"252",firstWord:"Y",shouzimu:"YM"},{name:"南非",code:"+27",engName:"South Africa",index:"253",firstWord:"N",shouzimu:"NF"},{name:"赞比亚",code:"+260",engName:"Zambia",index:"254",firstWord:"Z",shouzimu:"ZBY"},{name:"津巴布韦",code:"+263",engName:"Zimbabwe",index:"255",firstWord:"J",shouzimu:"JBBW"},{name:"亚什摩及卡地尔群岛",code:"+61",engName:"Ashmore and Cartier Is.",index:"13",firstWord:"Y",shouzimu:"YSMJKDEQD"},{name:"法属南部领土",code:"+262",engName:"Fr. S. Antarctic Lands",index:"14",firstWord:"F",shouzimu:"FSNBLT"},{name:"克利珀顿岛",code:"+262",engName:"Clipperton I.",index:"45",firstWord:"K",shouzimu:"KLPDD"},{name:"塞浦路斯联合国缓冲区",code:"+357",engName:"Cyprus U.N. Buffer Zone",index:"47",firstWord:"S",shouzimu:"SPLSLHGHCQ"},{name:"珊瑚海群岛",code:"+43",engName:"Coral Sea Is.",index:"55",firstWord:"S",shouzimu:"SHHQD"},{name:"德凯利亚",code:"+44",engName:"Dhekelia",index:"71",firstWord:"D",shouzimu:"DKLY"},{name:"中国香港",code:"+852",engName:"Hong Kong",index:"97",firstWord:"Z",shouzimu:"ZGXG",hot:!0},{name:"赫德岛和麦克唐纳岛",code:"+672",engName:"Heard I. and McDonald Is.",index:"98",firstWord:"H",shouzimu:"HDDHMKTND"},{name:"印度洋领地",code:"+246",engName:"Indian Ocean Ter.",index:"106",firstWord:"Y",shouzimu:"YDYLD"},{name:"拜科努尔",code:"+77",engName:"Baikonur",index:"118",firstWord:"B",shouzimu:"BKNE"},{name:"中国澳门",code:"+853",engName:"Macao",index:"140",firstWord:"Z",shouzimu:"ZGAM",hot:!0},{name:"皮特克恩岛",code:"+1",engName:"Pitcairn Is.",index:"177",firstWord:"P",shouzimu:"PTKED"},{name:"南沙群岛",code:"+86",engName:"pratly Is.",index:"179",firstWord:"N",shouzimu:"NSQD"},{name:"西撒哈拉",code:"+212",engName:"W. Sahara",index:"194",firstWord:"X",shouzimu:"XSHL"},{name:"南乔治亚岛和南桑德韦奇岛",code:"+1",engName:"S. Geo. and S. Sandw. Is.",index:"202",firstWord:"N",shouzimu:"NQZYDHNSDWQD"},{name:"圣赫勒拿",code:"+1",engName:"Saint Helena",index:"203",firstWord:"S",shouzimu:"SHLN"},{name:"索马里兰",code:"+252",engName:"Somaliland",index:"208",firstWord:"S",shouzimu:"SMLL"},{name:"中国台湾",code:"+886",engName:"Taiwan",index:"233",firstWord:"Z",shouzimu:"ZGTW",hot:!0},{name:"美国本土外小岛屿",code:"+1",engName:"U.S. Minor Outlying Is.",index:"237",firstWord:"M",shouzimu:"MGBTWXDY"},{name:"关塔那摩湾",code:"+1",engName:"USNB Guantanamo Bay",index:"240",firstWord:"G",shouzimu:"GTNMW"},{name:"阿克罗蒂里",code:"+357",engName:"Akrotiri",index:"250",firstWord:"A",shouzimu:"AKLDL"}];return e}),define("collection/coutrycodes",["jquery","underscore","backbone","model/coutrycode","model/coutry"],function(e,t,n,r,i){var s=n.Collection.extend({model:r,initialize:function(){this.add(i),console.log(this.model)}});return s}),function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function s(e){e.fn.perfectScrollbar=function(t){return this.each(function(){if(typeof t=="object"||typeof t=="undefined"){var n=t;i.get(this)||r.initialize(this,n)}else{var s=t;s==="update"?r.update(this):s==="destroy"&&r.destroy(this)}return e(this)})}}if(!document.createEvent)return;var r=e("../main"),i=e("../plugin/instances"),o=window.jQuery?window.jQuery:window.$;typeof o!="undefined"&&s(o),t.exports=s},{"../main":7,"../plugin/instances":18}],2:[function(e,t,n){function r(e,t){var n=e.className.split(" ");n.indexOf(t)<0&&n.push(t),e.className=n.join(" ")}function i(e,t){var n=e.className.split(" "),r=n.indexOf(t);r>=0&&n.splice(r,1),e.className=n.join(" ")}n.add=function(e,t){e.classList?e.classList.add(t):r(e,t)},n.remove=function(e,t){e.classList?e.classList.remove(t):i(e,t)},n.list=function(e){return e.classList?Array.prototype.slice.apply(e.classList):e.className.split(" ")}},{}],3:[function(e,t,n){function i(e,t){return window.getComputedStyle(e)[t]}function s(e,t,n){return typeof n=="number"&&(n=n.toString()+"px"),e.style[t]=n,e}function o(e,t){for(var n in t){var r=t[n];typeof r=="number"&&(r=r.toString()+"px"),e.style[n]=r}return e}var r={};r.e=function(e,t){var n=document.createElement(e);return n.className=t,n},r.appendTo=function(e,t){return t.appendChild(e),e},r.css=function(e,t,n){return typeof t=="object"?o(e,t):typeof n=="undefined"?i(e,t):s(e,t,n)},r.matches=function(e,t){if(typeof e.matches!="undefined")return e.matches(t);if(typeof e.matchesSelector!="undefined")return e.matchesSelector(t);if(typeof e.webkitMatchesSelector!="undefined")return e.webkitMatchesSelector(t);if(typeof e.mozMatchesSelector!="undefined")return e.mozMatchesSelector(t);if(typeof e.msMatchesSelector!="undefined")return e.msMatchesSelector(t)},r.remove=function(e){typeof e.remove!="undefined"?e.remove():e.parentNode&&e.parentNode.removeChild(e)},r.queryChildren=function(e,t){return Array.prototype.filter.call(e.childNodes,function(e){return r.matches(e,t)})},t.exports=r},{}],4:[function(e,t,n){var r=function(e){this.element=e,this.events={}};r.prototype.bind=function(e,t){typeof this.events[e]=="undefined"&&(this.events[e]=[]),this.events[e].push(t),this.element.addEventListener(e,t,!1)},r.prototype.unbind=function(e,t){var n=typeof t!="undefined";this.events[e]=this.events[e].filter(function(r){return n&&r!==t?!0:(this.element.removeEventListener(e,r,!1),!1)},this)},r.prototype.unbindAll=function(){for(var e in this.events)this.unbind(e)};var i=function(){this.eventElements=[]};i.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return typeof t=="undefined"&&(t=new r(e),this.eventElements.push(t)),t},i.prototype.bind=function(e,t,n){this.eventElement(e).bind(t,n)},i.prototype.unbind=function(e,t,n){this.eventElement(e).unbind(t,n)},i.prototype.unbindAll=function(){for(var e=0;e<this.eventElements.length;e++)this.eventElements[e].unbindAll()},i.prototype.once=function(e,t,n){var r=this.eventElement(e),i=function(e){r.unbind(t,i),n(e)};r.bind(t,i)},t.exports=i},{}],5:[function(e,t,n){t.exports=function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}()},{}],6:[function(e,t,n){var r=e("./class"),i=e("./dom");n.toInt=function(e){return parseInt(e,10)||0},n.clone=function(e){if(e===null)return null;if(typeof e=="object"){var t={};for(var n in e)t[n]=this.clone(e[n]);return t}return e},n.extend=function(e,t){var n=this.clone(e);for(var r in t)n[r]=this.clone(t[r]);return n},n.isEditable=function(e){return i.matches(e,"input,[contenteditable]")||i.matches(e,"select,[contenteditable]")||i.matches(e,"textarea,[contenteditable]")||i.matches(e,"button,[contenteditable]")},n.removePsClasses=function(e){var t=r.list(e);for(var n=0;n<t.length;n++){var i=t[n];i.indexOf("ps-")===0&&r.remove(e,i)}},n.outerWidth=function(e){return this.toInt(i.css(e,"width"))+this.toInt(i.css(e,"paddingLeft"))+this.toInt(i.css(e,"paddingRight"))+this.toInt(i.css(e,"borderLeftWidth"))+this.toInt(i.css(e,"borderRightWidth"))},n.startScrolling=function(e,t){r.add(e,"ps-in-scrolling"),typeof t!="undefined"?r.add(e,"ps-"+t):(r.add(e,"ps-x"),r.add(e,"ps-y"))},n.stopScrolling=function(e,t){r.remove(e,"ps-in-scrolling"),typeof t!="undefined"?r.remove(e,"ps-"+t):(r.remove(e,"ps-x"),r.remove(e,"ps-y"))},n.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:window.navigator.msMaxTouchPoints!==null}},{"./class":2,"./dom":3}],7:[function(e,t,n){var r=e("./plugin/destroy"),i=e("./plugin/initialize"),s=e("./plugin/update");t.exports={initialize:i,update:s,destroy:r}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(e,t,n){t.exports={maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,stopPropagationOnClick:!0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,useKeyboard:!0,useSelectionScroll:!1,wheelPropagation:!1,wheelSpeed:1}},{}],9:[function(e,t,n){var r=e("../lib/dom"),i=e("../lib/helper"),s=e("./instances");t.exports=function(e){var t=s.get(e);if(!t)return;t.event.unbindAll(),r.remove(t.scrollbarX),r.remove(t.scrollbarY),r.remove(t.scrollbarXRail),r.remove(t.scrollbarYRail),i.removePsClasses(e),s.remove(e)}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(e,t,n){function u(e,t){function n(e){return e.getBoundingClientRect()}var i=window.Event.prototype.stopPropagation.bind;t.settings.stopPropagationOnClick&&t.event.bind(t.scrollbarY,"click",i),t.event.bind(t.scrollbarYRail,"click",function(i){var u=r.toInt(t.scrollbarYHeight/2),a=t.railYRatio*(i.pageY-window.pageYOffset-n(t.scrollbarYRail).top-u),f=t.railYRatio*(t.railYHeight-t.scrollbarYHeight),l=a/f;l<0?l=0:l>1&&(l=1),o(e,"top",(t.contentHeight-t.containerHeight)*l),s(e),i.stopPropagation()}),t.settings.stopPropagationOnClick&&t.event.bind(t.scrollbarX,"click",i),t.event.bind(t.scrollbarXRail,"click",function(i){var u=r.toInt(t.scrollbarXWidth/2),a=t.railXRatio*(i.pageX-window.pageXOffset-n(t.scrollbarXRail).left-u),f=t.railXRatio*(t.railXWidth-t.scrollbarXWidth),l=a/f;l<0?l=0:l>1&&(l=1),o(e,"left",(t.contentWidth-t.containerWidth)*l-t.negativeScrollAdjustment),s(e),i.stopPropagation()})}var r=e("../../lib/helper"),i=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=i.get(e);u(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(e,t,n){function a(e,t){function a(r){var s=n+r*t.railXRatio,o=Math.max(0,t.scrollbarXRail.getBoundingClientRect().left)+t.railXRatio*(t.railXWidth-t.scrollbarXWidth);s<0?t.scrollbarXLeft=0:s>o?t.scrollbarXLeft=o:t.scrollbarXLeft=s;var a=i.toInt(t.scrollbarXLeft*(t.contentWidth-t.containerWidth)/(t.containerWidth-t.railXRatio*t.scrollbarXWidth))-t.negativeScrollAdjustment;u(e,"left",a)}var n=null,s=null,f=function(t){a(t.pageX-s),o(e),t.stopPropagation(),t.preventDefault()},l=function(){i.stopScrolling(e,"x"),t.event.unbind(t.ownerDocument,"mousemove",f)};t.event.bind(t.scrollbarX,"mousedown",function(o){s=o.pageX,n=i.toInt(r.css(t.scrollbarX,"left"))*t.railXRatio,i.startScrolling(e,"x"),t.event.bind(t.ownerDocument,"mousemove",f),t.event.once(t.ownerDocument,"mouseup",l),o.stopPropagation(),o.preventDefault()})}function f(e,t){function a(r){var s=n+r*t.railYRatio,o=Math.max(0,t.scrollbarYRail.getBoundingClientRect().top)+t.railYRatio*(t.railYHeight-t.scrollbarYHeight);s<0?t.scrollbarYTop=0:s>o?t.scrollbarYTop=o:t.scrollbarYTop=s;var a=i.toInt(t.scrollbarYTop*(t.contentHeight-t.containerHeight)/(t.containerHeight-t.railYRatio*t.scrollbarYHeight));u(e,"top",a)}var n=null,s=null,f=function(t){a(t.pageY-s),o(e),t.stopPropagation(),t.preventDefault()},l=function(){i.stopScrolling(e,"y"),t.event.unbind(t.ownerDocument,"mousemove",f)};t.event.bind(t.scrollbarY,"mousedown",function(o){s=o.pageY,n=i.toInt(r.css(t.scrollbarY,"top"))*t.railYRatio,i.startScrolling(e,"y"),t.event.bind(t.ownerDocument,"mousemove",f),t.event.once(t.ownerDocument,"mouseup",l),o.stopPropagation(),o.preventDefault()})}var r=e("../../lib/dom"),i=e("../../lib/helper"),s=e("../instances"),o=e("../update-geometry"),u=e("../update-scroll");t.exports=function(e){var t=s.get(e);a(e,t),f(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(e,t,n){function u(e,t){function u(n,r){var i=e.scrollTop;if(n===0){if(!t.scrollbarYActive)return!1;if(i===0&&r>0||i>=t.contentHeight-t.containerHeight&&r<0)return!t.settings.wheelPropagation}var s=e.scrollLeft;if(r===0){if(!t.scrollbarXActive)return!1;if(s===0&&n<0||s>=t.contentWidth-t.containerWidth&&n>0)return!t.settings.wheelPropagation}return!0}var n=!1;t.event.bind(e,"mouseenter",function(){n=!0}),t.event.bind(e,"mouseleave",function(){n=!1});var i=!1;t.event.bind(t.ownerDocument,"keydown",function(a){if(a.isDefaultPrevented&&a.isDefaultPrevented())return;if(!n)return;var f=document.activeElement?document.activeElement:t.ownerDocument.activeElement;if(f){while(f.shadowRoot)f=f.shadowRoot.activeElement;if(r.isEditable(f))return}var l=0,c=0;switch(a.which){case 37:l=-30;break;case 38:c=30;break;case 39:l=30;break;case 40:c=-30;break;case 33:c=90;break;case 32:a.shiftKey?c=90:c=-90;break;case 34:c=-90;break;case 35:a.ctrlKey?c=-t.contentHeight:c=-t.containerHeight;break;case 36:a.ctrlKey?c=e.scrollTop:c=t.containerHeight;break;default:return}o(e,"top",e.scrollTop-c),o(e,"left",e.scrollLeft+l),s(e),i=u(l,c),i&&a.preventDefault()})}var r=e("../../lib/helper"),i=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=i.get(e);u(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(e,t,n){function o(e,t){function r(n,r){var i=e.scrollTop;if(n===0){if(!t.scrollbarYActive)return!1;if(i===0&&r>0||i>=t.contentHeight-t.containerHeight&&r<0)return!t.settings.wheelPropagation}var s=e.scrollLeft;if(r===0){if(!t.scrollbarXActive)return!1;if(s===0&&n<0||s>=t.contentWidth-t.containerWidth&&n>0)return!t.settings.wheelPropagation}return!0}function o(e){var t=e.deltaX,n=-1*e.deltaY;if(typeof t=="undefined"||typeof n=="undefined")t=-1*e.wheelDeltaX/6,n=e.wheelDeltaY/6;return e.deltaMode&&e.deltaMode===1&&(t*=10,n*=10),t!==t&&n!==n&&(t=0,n=e.wheelDelta),[t,n]}function u(t,n){var r=e.querySelector("textarea:hover");if(r){var i=r.scrollHeight-r.clientHeight;if(i>0&&!(r.scrollTop===0&&n>0||r.scrollTop===i&&n<0))return!0;var s=r.scrollLeft-r.clientWidth;if(s>0&&!(r.scrollLeft===0&&t<0)&&!(r.scrollLeft===s&&t>0))return!0}return!1}function a(a){var f=o(a),l=f[0],c=f[1];if(u(l,c))return;n=!1,t.settings.useBothWheelAxes?t.scrollbarYActive&&!t.scrollbarXActive?(c?s(e,"top",e.scrollTop-c*t.settings.wheelSpeed):s(e,"top",e.scrollTop+l*t.settings.wheelSpeed),n=!0):t.scrollbarXActive&&!t.scrollbarYActive&&(l?s(e,"left",e.scrollLeft+l*t.settings.wheelSpeed):s(e,"left",e.scrollLeft-c*t.settings.wheelSpeed),n=!0):(s(e,"top",e.scrollTop-c*t.settings.wheelSpeed),s(e,"left",e.scrollLeft+l*t.settings.wheelSpeed)),i(e),n=n||r(l,c),n&&(a.stopPropagation(),a.preventDefault())}var n=!1;typeof window.onwheel!="undefined"?t.event.bind(e,"wheel",a):typeof window.onmousewheel!="undefined"&&t.event.bind(e,"mousewheel",a)}var r=e("../instances"),i=e("../update-geometry"),s=e("../update-scroll");t.exports=function(e){var t=r.get(e);o(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(e,t,n){function s(e,t){t.event.bind(e,"scroll",function(){i(e)})}var r=e("../instances"),i=e("../update-geometry");t.exports=function(e){var t=r.get(e);s(e,t)}},{"../instances":18,"../update-geometry":19}],15:[function(e,t,n){function u(e,t){function n(){var e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return e.toString().length===0?null:e.getRangeAt(0).commonAncestorContainer}function f(){u||(u=setInterval(function(){if(!i.get(e)){clearInterval(u);return}o(e,"top",e.scrollTop+a.top),o(e,"left",e.scrollLeft+a.left),s(e)},50))}function l(){u&&(clearInterval(u),u=null),r.stopScrolling(e)}var u=null,a={top:0,left:0},c=!1;t.event.bind(t.ownerDocument,"selectionchange",function(){e.contains(n())?c=!0:(c=!1,l())}),t.event.bind(window,"mouseup",function(){c&&(c=!1,l())}),t.event.bind(window,"mousemove",function(t){if(c){var n={x:t.pageX,y:t.pageY},i={left:e.offsetLeft,right:e.offsetLeft+e.offsetWidth,top:e.offsetTop,bottom:e.offsetTop+e.offsetHeight};n.x<i.left+3?(a.left=-5,r.startScrolling(e,"x")):n.x>i.right-3?(a.left=5,r.startScrolling(e,"x")):a.left=0,n.y<i.top+3?(i.top+3-n.y<5?a.top=-5:a.top=-20,r.startScrolling(e,"y")):n.y>i.bottom-3?(n.y-i.bottom+3<5?a.top=5:a.top=20,r.startScrolling(e,"y")):a.top=0,a.top===0&&a.left===0?l():f()}})}var r=e("../../lib/helper"),i=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=i.get(e);u(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(e,t,n){function o(e,t,n,o){function u(n,r){var i=e.scrollTop,s=e.scrollLeft,o=Math.abs(n),u=Math.abs(r);if(u>o){if(r<0&&i===t.contentHeight-t.containerHeight||r>0&&i===0)return!t.settings.swipePropagation}else if(o>u)if(n<0&&s===t.contentWidth-t.containerWidth||n>0&&s===0)return!t.settings.swipePropagation;return!0}function a(t,n){s(e,"top",e.scrollTop-n),s(e,"left",e.scrollLeft-t),i(e)}function v(){p=!0}function m(){p=!1}function g(e){return e.targetTouches?e.targetTouches[0]:e}function y(e){return e.targetTouches&&e.targetTouches.length===1?!0:e.pointerType&&e.pointerType!=="mouse"&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE?!0:!1}function b(e){if(y(e)){d=!0;var t=g(e);f.pageX=t.pageX,f.pageY=t.pageY,l=(new Date).getTime(),h!==null&&clearInterval(h),e.stopPropagation()}}function w(e){if(!p&&d&&y(e)){var t=g(e),n={pageX:t.pageX,pageY:t.pageY},r=n.pageX-f.pageX,i=n.pageY-f.pageY;a(r,i),f=n;var s=(new Date).getTime(),o=s-l;o>0&&(c.x=r/o,c.y=i/o,l=s),u(r,i)&&(e.stopPropagation(),e.preventDefault())}}function E(){!p&&d&&(d=!1,clearInterval(h),h=setInterval(function(){if(!r.get(e)){clearInterval(h);return}if(Math.abs(c.x)<.01&&Math.abs(c.y)<.01){clearInterval(h);return}a(c.x*30,c.y*30),c.x*=.8,c.y*=.8},10))}var f={},l=0,c={},h=null,p=!1,d=!1;n&&(t.event.bind(window,"touchstart",v),t.event.bind(window,"touchend",m),t.event.bind(e,"touchstart",b),t.event.bind(e,"touchmove",w),t.event.bind(e,"touchend",E)),o&&(window.PointerEvent?(t.event.bind(window,"pointerdown",v),t.event.bind(window,"pointerup",m),t.event.bind(e,"pointerdown",b),t.event.bind(e,"pointermove",w),t.event.bind(e,"pointerup",E)):window.MSPointerEvent&&(t.event.bind(window,"MSPointerDown",v),t.event.bind(window,"MSPointerUp",m),t.event.bind(e,"MSPointerDown",b),t.event.bind(e,"MSPointerMove",w),t.event.bind(e,"MSPointerUp",E)))}var r=e("../instances"),i=e("../update-geometry"),s=e("../update-scroll");t.exports=function(e,t,n){var i=r.get(e);o(e,i,t,n)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(e,t,n){var r=e("../lib/class"),i=e("../lib/helper"),s=e("./instances"),o=e("./update-geometry"),u=e("./handler/click-rail"),a=e("./handler/drag-scrollbar"),f=e("./handler/keyboard"),l=e("./handler/mouse-wheel"),c=e("./handler/native-scroll"),h=e("./handler/selection"),p=e("./handler/touch");t.exports=function(e,t){t=typeof t=="object"?t:{},r.add(e,"ps-container");var n=s.add(e);n.settings=i.extend(n.settings,t),u(e),a(e),l(e),c(e),n.settings.useSelectionScroll&&h(e),(i.env.supportsTouch||i.env.supportsIePointer)&&p(e,i.env.supportsTouch,i.env.supportsIePointer),n.settings.useKeyboard&&f(e),o(e)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(e,t,n){function f(e){var t=this;t.settings=u.clone(i),t.containerWidth=null,t.containerHeight=null,t.contentWidth=null,t.contentHeight=null,t.isRtl=r.css(e,"direction")==="rtl",t.isNegativeScroll=function(){var t=e.scrollLeft,n=null;return e.scrollLeft=-1,n=e.scrollLeft<0,e.scrollLeft=t,n}(),t.negativeScrollAdjustment=t.isNegativeScroll?e.scrollWidth-e.clientWidth:0,t.event=new s,t.ownerDocument=e.ownerDocument||document,t.scrollbarXRail=r.appendTo(r.e("div","ps-scrollbar-x-rail"),e),t.scrollbarX=r.appendTo(r.e("div","ps-scrollbar-x"),t.scrollbarXRail),t.scrollbarX.setAttribute("tabindex",0),t.scrollbarXActive=null,t.scrollbarXWidth=null,t.scrollbarXLeft=null,t.scrollbarXBottom=u.toInt(r.css(t.scrollbarXRail,"bottom")),t.isScrollbarXUsingBottom=t.scrollbarXBottom===t.scrollbarXBottom,t.scrollbarXTop=t.isScrollbarXUsingBottom?null:u.toInt(r.css(t.scrollbarXRail,"top")),t.railBorderXWidth=u.toInt(r.css(t.scrollbarXRail,"borderLeftWidth"))+u.toInt(r.css(t.scrollbarXRail,"borderRightWidth")),r.css(t.scrollbarXRail,"display","block"),t.railXMarginWidth=u.toInt(r.css(t.scrollbarXRail,"marginLeft"))+u.toInt(r.css(t.scrollbarXRail,"marginRight")),r.css(t.scrollbarXRail,"display",""),t.railXWidth=null,t.railXRatio=null,t.scrollbarYRail=r.appendTo(r.e("div","ps-scrollbar-y-rail"),e),t.scrollbarY=r.appendTo(r.e("div","ps-scrollbar-y"),t.scrollbarYRail),t.scrollbarY.setAttribute("tabindex",0),t.scrollbarYActive=null,t.scrollbarYHeight=null,t.scrollbarYTop=null,t.scrollbarYRight=u.toInt(r.css(t.scrollbarYRail,"right")),t.isScrollbarYUsingRight=t.scrollbarYRight===t.scrollbarYRight,t.scrollbarYLeft=t.isScrollbarYUsingRight?null:u.toInt(r.css(t.scrollbarYRail,"left")),t.scrollbarYOuterWidth=t.isRtl?u.outerWidth(t.scrollbarY):null,t.railBorderYWidth=u.toInt(r.css(t.scrollbarYRail,"borderTopWidth"))+u.toInt(r.css(t.scrollbarYRail,"borderBottomWidth")),r.css(t.scrollbarYRail,"display","block"),t.railYMarginHeight=u.toInt(r.css(t.scrollbarYRail,"marginTop"))+u.toInt(r.css(t.scrollbarYRail,"marginBottom")),r.css(t.scrollbarYRail,"display",""),t.railYHeight=null,t.railYRatio=null}function l(e){return typeof e.dataset=="undefined"?e.getAttribute("data-ps-id"):e.dataset.psId}function c(e,t){typeof e.dataset=="undefined"?e.setAttribute("data-ps-id",t):e.dataset.psId=t}function h(e){typeof e.dataset=="undefined"?e.removeAttribute("data-ps-id"):delete e.dataset.psId}var r=e("../lib/dom"),i=e("./default-setting"),s=e("../lib/event-manager"),o=e("../lib/guid"),u=e("../lib/helper"),a={};n.add=function(e){var t=o();return c(e,t),a[t]=new f(e),a[t]},n.remove=function(e){delete a[l(e)],h(e)},n.get=function(e){return a[l(e)]}},{"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(e,t,n){function a(e,t){return e.settings.minScrollbarLength&&(t=Math.max(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=Math.min(t,e.settings.maxScrollbarLength)),t}function f(e,t){var n={width:t.railXWidth};t.isRtl?n.left=t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth-t.contentWidth:n.left=e.scrollLeft,t.isScrollbarXUsingBottom?n.bottom=t.scrollbarXBottom-e.scrollTop:n.top=t.scrollbarXTop+e.scrollTop,i.css(t.scrollbarXRail,n);var r={top:e.scrollTop,height:t.railYHeight};t.isScrollbarYUsingRight?t.isRtl?r.right=t.contentWidth-(t.negativeScrollAdjustment+e.scrollLeft)-t.scrollbarYRight-t.scrollbarYOuterWidth:r.right=t.scrollbarYRight-e.scrollLeft:t.isRtl?r.left=t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth*2-t.contentWidth-t.scrollbarYLeft-t.scrollbarYOuterWidth:r.left=t.scrollbarYLeft+e.scrollLeft,i.css(t.scrollbarYRail,r),i.css(t.scrollbarX,{left:t.scrollbarXLeft,width:t.scrollbarXWidth-t.railBorderXWidth}),i.css(t.scrollbarY,{top:t.scrollbarYTop,height:t.scrollbarYHeight-t.railBorderYWidth})}var r=e("../lib/class"),i=e("../lib/dom"),s=e("../lib/helper"),o=e("./instances"),u=e("./update-scroll");t.exports=function(e){var t=o.get(e);t.containerWidth=e.clientWidth,t.containerHeight=e.clientHeight,t.contentWidth=e.scrollWidth,t.contentHeight=e.scrollHeight;var n;e.contains(t.scrollbarXRail)||(n=i.queryChildren(e,".ps-scrollbar-x-rail"),n.length>0&&n.forEach(function(e){i.remove(e)}),i.appendTo(t.scrollbarXRail,e)),e.contains(t.scrollbarYRail)||(n=i.queryChildren(e,".ps-scrollbar-y-rail"),n.length>0&&n.forEach(function(e){i.remove(e)}),i.appendTo(t.scrollbarYRail,e)),!t.settings.suppressScrollX&&t.containerWidth+t.settings.scrollXMarginOffset<t.contentWidth?(t.scrollbarXActive=!0,t.railXWidth=t.containerWidth-t.railXMarginWidth,t.railXRatio=t.containerWidth/t.railXWidth,t.scrollbarXWidth=a(t,s.toInt(t.railXWidth*t.containerWidth/t.contentWidth)),t.scrollbarXLeft=s.toInt((t.negativeScrollAdjustment+e.scrollLeft)*(t.railXWidth-t.scrollbarXWidth)/(t.contentWidth-t.containerWidth))):t.scrollbarXActive=!1,!t.settings.suppressScrollY&&t.containerHeight+t.settings.scrollYMarginOffset<t.contentHeight?(t.scrollbarYActive=!0,t.railYHeight=t.containerHeight-t.railYMarginHeight,t.railYRatio=t.containerHeight/t.railYHeight,t.scrollbarYHeight=a(t,s.toInt(t.railYHeight*t.containerHeight/t.contentHeight)),t.scrollbarYTop=s.toInt(e.scrollTop*(t.railYHeight-t.scrollbarYHeight)/(t.contentHeight-t.containerHeight))):t.scrollbarYActive=!1,t.scrollbarXLeft>=t.railXWidth-t.scrollbarXWidth&&(t.scrollbarXLeft=t.railXWidth-t.scrollbarXWidth),t.scrollbarYTop>=t.railYHeight-t.scrollbarYHeight&&(t.scrollbarYTop=t.railYHeight-t.scrollbarYHeight),f(e,t),t.scrollbarXActive?r.add(e,"ps-active-x"):(r.remove(e,"ps-active-x"),t.scrollbarXWidth=0,t.scrollbarXLeft=0,u(e,"left",0)),t.scrollbarYActive?r.add(e,"ps-active-y"):(r.remove(e,"ps-active-y"),t.scrollbarYHeight=0,t.scrollbarYTop=0,u(e,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(e,t,n){var r=e("./instances"),i=document.createEvent("Event"),s=document.createEvent("Event"),o=document.createEvent("Event"),u=document.createEvent("Event"),a=document.createEvent("Event"),f=document.createEvent("Event"),l=document.createEvent("Event"),c=document.createEvent("Event"),h=document.createEvent("Event"),p=document.createEvent("Event"),d,v;i.initEvent("ps-scroll-up",!0,!0),s.initEvent("ps-scroll-down",!0,!0),o.initEvent("ps-scroll-left",!0,!0),u.initEvent("ps-scroll-right",!0,!0),a.initEvent("ps-scroll-y",!0,!0),f.initEvent("ps-scroll-x",!0,!0),l.initEvent("ps-x-reach-start",!0,!0),c.initEvent("ps-x-reach-end",!0,!0),h.initEvent("ps-y-reach-start",!0,!0),p.initEvent("ps-y-reach-end",!0,!0),t.exports=function(e,t,n){if(typeof e=="undefined")throw"You must provide an element to the update-scroll function";if(typeof t=="undefined")throw"You must provide an axis to the update-scroll function";if(typeof n=="undefined")throw"You must provide a value to the update-scroll function";if(t==="top"&&n<=0){e.scrollTop=0,e.dispatchEvent(h);return}if(t==="left"&&n<=0){e.scrollLeft=0,e.dispatchEvent(l);return}var m=r.get(e);if(t==="top"&&n>=m.contentHeight-m.containerHeight){e.scrollTop=m.contentHeight-m.containerHeight,e.dispatchEvent(p);return}if(t==="left"&&n>=m.contentWidth-m.containerWidth){e.scrollLeft=m.contentWidth-m.containerWidth,e.dispatchEvent(c);return}d||(d=e.scrollTop),v||(v=e.scrollLeft),t==="top"&&n<d&&e.dispatchEvent(i),t==="top"&&n>d&&e.dispatchEvent(s),t==="left"&&n<v&&e.dispatchEvent(o),t==="left"&&n>v&&e.dispatchEvent(u),t==="top"&&(e.scrollTop=d=n,e.dispatchEvent(a)),t==="left"&&(e.scrollLeft=v=n,e.dispatchEvent(f))}},{"./instances":18}],21:[function(e,t,n){var r=e("../lib/dom"),i=e("../lib/helper"),s=e("./instances"),o=e("./update-geometry"),u=e("./update-scroll");t.exports=function(e){var t=s.get(e);if(!t)return;t.negativeScrollAdjustment=t.isNegativeScroll?e.scrollWidth-e.clientWidth:0,r.css(t.scrollbarXRail,"display","block"),r.css(t.scrollbarYRail,"display","block"),t.railXMarginWidth=i.toInt(r.css(t.scrollbarXRail,"marginLeft"))+i.toInt(r.css(t.scrollbarXRail,"marginRight")),t.railYMarginHeight=i.toInt(r.css(t.scrollbarYRail,"marginTop"))+i.toInt(r.css(t.scrollbarYRail,"marginBottom")),r.css(t.scrollbarXRail,"display","none"),r.css(t.scrollbarYRail,"display","none"),o(e),u(e,"top",e.scrollTop),u(e,"left",e.scrollLeft),r.css(t.scrollbarXRail,"display",""),r.css(t.scrollbarYRail,"display","")}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]),define("plugin/perfect-scrollbar/perfect-scrollbar.jquery",function(){}),define("plugin/jquery.selecter",["jquery"],function(){function n(e){var t=e.find(".selecter-text"),n=e.find(".selecter-arrow"),r=$.trim(t.text()),i=e.width(),s=t.width(),o=n.outerWidth(!0),u=0;while(i&&i<s+o){u++;if(u>=40)break;r=r.substring(0,r.length-1),t.text(r),s=t.width()}u>0&&t.text(r.substring(0,r.length-3)+"...")}function r(t){t=t||{};var n=$.extend({},e,t),r=$(this),o=n.isCreate;for(var u=0,a=r.length;u<a;u++){var f=r.eq(u);f.attr("inited")||(f.attr("inited",!0),o?i(f,n):s(f,n),f.attr("data-default-value",f.selecter("val")))}return r}function i(e,t){if(!t.options)return;var n=' <div class="selecter-options "><ul>',r='<div class="selecter-selected" data-value="{value}"><span class="selecter-text">{name}</span><em class="selecter-arrow">◆</em></div>',i=t.options,s=t.filed,u={value:"",name:t.defaultLabel||""};for(var a=0,f=i.length;a<f;a++){var l=i[a],c=l[s.name],h=l[s.value],p=s.selected,d="";p==h&&(d=" selected",u={value:h,name:c}),n+='<li data-value="'+h+'" class="selecter-item '+d+'">'+c+"</li>"}n+="</ul></div>",r=r.replace("{value}",u.value).replace("{name}",u.name),e.append(r+n),e.addClass("selecter"),e.addClass(t.customClass),o(e,t)}function s(e,t){e.addClass(t.customClass),o(e,t)}function o(e,t){var r={$select:e,$selectSelected:e.find(".selecter-selected"),$selectOptions:e.find(".selecter-options")},i=r.$selectSelected.attr("data-value");i&&r.$selectOptions.find('[data-value="'+i+'"]').addClass("selected");var s=0,o=this,u=function(){s&&clearTimeout(s),$(".selecter").removeClass("open"),r.$select.addClass("open");var e=r.$selectOptions.offset().top,n=r.$selectOptions.height(),i=$(document).scrollTop(),u=$(window).height();e+n>i+u&&e-i>=n&&r.$select.addClass("selecter-up"),t.onDrop.call(o)},a=function(){t.delay?s=setTimeout(function(){r.$select.removeClass("open"),r.$select.removeClass("selecter-up")},t.delay):r.$select.removeClass("open"),t.onClose.call(o)};e.removeClass("selecter-hover"),r.$select.on(t.openEvent,function(e){e.stopPropagation();if(r.$select.hasClass("disabled"))return;u()});var f={mouseleave:1,mouseout:1};f[t.closeEvent]?r.$select.on(t.closeEvent,a):$(document).on(t.closeEvent,a),r.$select.on("click",".selecter-item",function(e){var i=$(this);if(!!i.is("[hashlink]"))return r.$select.trigger("change",[i]),!1;e.stopPropagation();var s=i.attr("data-value");if(s===undefined)return;r.$select.removeClass("open");if(t.onChange.call(i,s)===!1)return;if(i.hasClass("selected"))return;t.muti||i.parent().find(".selected").removeClass("selected"),i.addClass("selected"),r.$selectSelected.attr({"data-value":s}),r.$selectSelected.find(".selecter-text").text(i.text()),r.$select.find("input").eq(0).val(s),n(r.$selectSelected),r.$select.trigger("change")}),r.$select.on("mouseenter",".selecter-item",function(e){}),n(r.$selectSelected)}function u(e,t,n){}var e={customClass:"",defaultLabel:!1,openEvent:"click",closeEvent:"click",delay:"0",muti:!1,onDrop:function(){},onClose:function(){},onChange:function(){},isCreate:!1,options:[{name:"用户",value:"user"},{name:"声音",value:"voice"},{name:"专辑",value:"album"}],filed:{name:"name",value:"value",selected:"voice"}},t={val:function(e){var t=$(this),n=t.find(".selecter-selected"),r=t.find("input").eq(0);if(typeof e=="object")return n.attr("data-value",e.value).text(e.name),r.val(e.value),t;if(typeof e=="string"||typeof e=="number"){var i=t.find(".selecter-item[data-value="+e+"]"),s=i.text();return t.find(".selecter-item.selected").removeClass("selected"),i.addClass("selected"),n.attr("data-value",e),n.find(".selecter-text").text(s),r.val(e),t}return $.trim(n.attr("data-value"))},reset:function(){var e=$(this),t=e.attr("data-default-value");e.selecter("val",t)},text:function(){var e=$(this),t=e.find(".selecter-selected");return $.trim(t.find(".selecter-text").text())},create:function(e){e.isCreate=!0,r.call(this,e)},del:function(e){var t=$(this),n=t.find(".selecter-item[data-value="+e+"]");n.remove()},add:function(e,t){var n=$(this),r=n.find(".selecter-item").eq(0),i=r.clone().removeClass("selected"),s;if(s=r.size())i.attr("data-value",e.value).html(e.name),t==undefined||s<=t?r.parent().append(i):t>0?i.insertBefore(r.parent().find("li:eq("+(t-1)+")")):t==-1&&i.insertBefore(r.parent().find("li:eq("+(s-2)+")"))},edit:function(e){var t=$(this),n=t.find(".selecter-item[data-value="+e.value+"]");n.text(e.name)}};$.fn.selecter=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):typeof e=="object"||!e?r.apply(this,arguments):this}}),define("module/select/coutryselect",["jquery","underscore","backbone","collection/coutrycodes","plugin/perfect-scrollbar/perfect-scrollbar.jquery","plugin/jquery.selecter"],function(e,t,n,r){return n.View.extend({el:".j-coutryarea",selected:{code:"+86",name:"中国"},events:{"click .regInput":"toggleSelect","click li":"selectCoutry"},template:t.template('<div class="regSelBox regInput inl-b wid-120">  <span class="wid-30 elli inl-b j-selected-name">中国</span>  <span class="regSelBtn " data-code=""><span class="j-selected-code">+86</span><i class="iconfont icon-ic_down"></i></span>  <div class="regListBox">      <div class="ps-container ps-active-y regSelList" id="js-preview" data-ps-id="74d3839d-79a5-0505-ae77-918688b9825c">          <ul class="">           <% _.each(list,function(li){ %>           <li data-code="<%=li.get("code")%>" data-name="<%=li.get("name")%>" data-cid="<%=li.cid%>"><span class="fr regSelNum"><%=li.get("code")%></span><span class=""><%=li.get("name")%></span></li>           <% }) %>          </ul>          <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 3px;">              <div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px;"></div>          </div>          <div class="ps-scrollbar-y-rail" style="top: 0px; height: 0px; right: 3px;">              <div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 0px;"></div>          </div>      </div>  </div></div>'),initialize:function(n){var i=this;n=n||{},this.collection=new r,this.el=n.el||this.el,n.type==="old"&&(this.template=t.template(['<div class="selecter selecter-s5 selecter-m1 wid-110 " data-default-value="+86">','    <div class="selecter-selected" data-value="+86">','        <span class="selecter-text j-selected-code" >+86</span>','        <span class="sel-arrDu">','            <span href="" class="icon-ic_down iconfont"></span>',"        </span>","    </div>",'    <div class="selecter-options regSelList">',"        <ul>","            <% _.each(list,function(li){ %>",'            <li class="selecter-item" data-code="<%=li.get("code")%>" data-value="<%=li.get("code")%>"><%=li.get("code")%></li>',"            <% }) %>","        </ul>","    </div>","</div>"].join(""))),this.render(),e(".regSelList").perfectScrollbar(),n.type==="old"&&this.$el.find(".selecter").selecter({onChange:function(e){i.trigger("change",{code:e})}}),this.type=n.type,this.$el.parents("body").on("click",function(t){e(t.target).closest(i.el).length||i.$el.find(".regInput").removeClass("open")})},toggleSelect:function(){this.$el.find(".regInput").toggleClass("open")},selectCoutry:function(t){if(e(t.currentTarget).attr("selected")==="true")return;var n=e(t.currentTarget).attr("data-code"),r=e(t.currentTarget).attr("data-name"),i=e(t.currentTarget).attr("data-cid"),s=this.$el.find(".j-selected-name"),o=this.$el.find(".j-selected-code");s.length&&s.text(r),o.length&&o.text(n).parent().attr("data-code",n),this.selected=this.collection.get(i).toJSON(),this.$el.find("li").removeAttr("selected"),e(t.currentTarget).attr("selected","true"),this.trigger("change",this.selected)},getSelected:function(){return this.type==="old"?{code:this.$el.find(".selecter").selecter("val")}:this.selected},isCN:function(){var e=this.getSelected().code;return e&&e==="+86"},render:function(){return this.$el.html(this.template({list:this.collection.models})),this}})}),define("module/login/verify",["jquery","plugin/validator"],function(e,t){var n="/passport/login/checkAccount",r=null,i=function(e,n){if(n==="mobile")return!0;var r=!1;return t[n]&&t[n].test(e)&&(r=!0),r},s={userError:"账号格式不正确!",noUser:"该账号尚未注册!",pwdError:"该账号密码不正确!",userEmpty:"请输入账号!",pwdEmpty:"请输入密码!",pwdTooShort:"密码不能短于6位",pwdTooLong:"密码不能长于16位",sysError:"系统繁忙！",checkCodeEmpty:"请输入验证码"},o={accountSuccess:!1,passwordSuccess:!1,validator:i,account:function(e,t,n){var r=this;this.checkAccountTimer&&clearTimeout(this.checkAccountTimer),this.checkAccountTimer=setTimeout(function(){r.accountFn(e,t,n)},20)},accountFn:function(t,r,o){this.accountSuccess=!1;var u=e.trim(t.val());if(!u){this.error(t,s.userEmpty);return}!i(u,"email")&&r&&r!=="+86"&&(u=r.replace(/\+/,"")+"-"+u);var a=this;e.ajax({url:n,type:"post",dataType:"json",data:{email:u},success:function(e){if(e.success)a.accountSuccess=!0,a.success(t),o&&o();else{var n="";e.msg&&(n=e.msg),a.error(t,n)}},error:function(){a.error(t,s.sysError)}})},password:function(t,n){var r=e.trim(t.val());if(!r){this.error(t,s.pwdEmpty);return}var i=r.length;if(i<6){this.error(t,s.pwdTooShort);return}if(i>16){this.error(t,s.pwdTooLong);return}this.passwordSuccess=!0,this.success(t),n&&n()},checkcode:function(e,t){if(!t)return!0;var n=e.val();return n?(this.success(e),!0):(this.error(e,s.checkCodeEmpty),!1)},getTipsEl:function(t){var n;return t===void 0?n=e(".error"):t.length&&t[0].tagName.toLowerCase()!=="input"?n=t:n=t.parent().find(".j-error")||e(".error"),n},getPhoneByCode:function(e,t){return t?(e&&e!=="+86"&&(t=e.replace(/\+/,"")+"-"+t),t):t},error:function(e,t){r=this.getTipsEl(e),r.html(t).show()},success:function(e){r=this.getTipsEl(e),r.html("&nbsp;").hide()}};return{gMsg:s,verify:o}}),define("module/qrcodeLogin",["jquery","underscore"],function(e,t){function i(e,t){for(var n in t)e[n]=t[n];return e}function s(){r.$expireDom.addClass("hidden"),r.$imgDom.addClass("hidden"),r.$successDom.addClass("hidden")}function o(){var e=this;this.destroy(),r.$refreshBtn.off().on("click",function(){e.refresh()}),s(),r.$expireDom.removeClass("hidden")}function u(){s(),r.$successDom.removeClass("hidden"),setTimeout(function(){window.location.reload()},800)}function a(t){var n={imgDom:"",expireDom:"",refreshBtn:"",tipsDom:"",successDom:"",size:"L",autoUpdate:!0};this.options=i(n,t),this.interval=null,r.$imgDom=typeof this.options.imgDom=="string"?e(this.options.imgDom):this.options.imgDom,r.$expireDom=typeof this.options.expireDom=="string"?e(this.options.expireDom):this.options.expireDom,r.$refreshBtn=typeof this.options.refreshBtn=="string"?e(this.options.refreshBtn):this.options.refreshBtn,r.$successDom=typeof this.options.successDom=="string"?e(this.options.successDom):this.options.successDom}var n=null,r={};return a.prototype={constuctor:a,init:function(){s(),r.$imgDom.removeClass("hidden"),this.destroy(),this.options.autoUpdate&&this._on("statusChange",function(e){console.log(e);switch(e){case 2:o.call(this);break;case 3:u.call(this);break;default:}}),this._getQrImg(this.options.size)},_getQrImg:function(t){var n=this;e.ajax({url:"/passport/qrcode/gen?level="+t,type:"get",dataType:"json",success:function(e){console.log("qrcodeLogin",e),r.$imgDom.attr("src",e.img),console.log(r.$imgDom.prop("src")),e.qrId&&(n.interval=setInterval(function(){n._getQrStatus(e.qrId)},1500))}})},_getQrStatus:function(t){var r=this;e.ajax({url:"/passport/qrcode/check/"+t,type:"get",dataType:"json",success:function(e){e.status!==n&&(console.log(n),n=e.status,r._emit("statusChange",e.status))}})},destroy:function(){this.interval&&window.clearInterval(this.interval),this._off("statusChange")},refresh:function(){this.destroy(),this.init()},onStatusChange:function(e){this._on("statusChange",e)},_updateByStatus:function(e){switch(e){case 1:break;case 2:this.options.autoUpdate&&o.call(this);break;case 3:this.options.autoUpdate&&u.call(this)}},_on:function(e,t){return this._handlers=this._handlers||{},this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(t),this},_emit:function(){var e=Array.prototype.slice.call(arguments,0),t=e.shift();if(!t||typeof this._handlers!="object")return!1;var n,r;r=this._handlers[t];if(!r)return!1;if(typeof r=="funciton")return r.apply(this,e),this._handlers[t]=undefined,this;for(var n=0;n<r.length;n++)r[n].apply(this,e);return this},_off:function(e){this._handlers=this._handlers||{};if(!this._handlers[e])return;this._handlers[e]=[]}},a}),define("plugin/Tween",[],function(){var e={Linear:function(e,t,n,r){return n*e/r+t},Quad:{easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},Cubic:{easeIn:function(e,t,n,r){return n*(e/=r)*e*e+t},easeOut:function(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}},Quart:{easeIn:function(e,t,n,r){return n*(e/=r)*e*e*e+t},easeOut:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}},Quint:{easeIn:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},easeOut:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}},Sine:{easeIn:function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},easeOut:function(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t},easeInOut:function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t}},Expo:{easeIn:function(e,t,n,r){return e==0?t:n*Math.pow(2,10*(e/r-1))+t},easeOut:function(e,t,n,r){return e==r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t},easeInOut:function(e,t,n,r){return e==0?t:e==r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t}},Circ:{easeIn:function(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t},easeOut:function(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},Elastic:{easeIn:function(e,t,n,r,i,s){var o;return e==0?t:(e/=r)==1?t+n:(typeof s=="undefined"&&(s=r*.3),!i||i<Math.abs(n)?(o=s/4,i=n):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},easeOut:function(e,t,n,r,i,s){var o;return e==0?t:(e/=r)==1?t+n:(typeof s=="undefined"&&(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},easeInOut:function(e,t,n,r,i,s){var o;return e==0?t:(e/=r/2)==2?t+n:(typeof s=="undefined"&&(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t)}},Back:{easeIn:function(e,t,n,r,i){return typeof i=="undefined"&&(i=1.70158),n*(e/=r)*e*((i+1)*e-i)+t},easeOut:function(e,t,n,r,i){return typeof i=="undefined"&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},easeInOut:function(e,t,n,r,i){return typeof i=="undefined"&&(i=1.70158),(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t}},Bounce:{easeIn:function(t,n,r,i){return r-e.Bounce.easeOut(i-t,0,r,i)+n},easeOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOut:function(t,n,r,i){return t<i/2?e.Bounce.easeIn(t*2,0,r,i)*.5+n:e.Bounce.easeOut(t*2-i,0,r,i)*.5+r*.5+n}}};Math.tween=e}),define("plugin/animation",["plugin/Tween"],function(){var e=function(e,t,n,r,i){var s=function(e){return typeof e=="undefined"},o=function(e){return typeof e=="function"},u=function(e){return typeof e=="number"},a=function(e){return typeof e=="string"},f=function(e){if(u(e))return e;if(a(e)){if(/\d+m?s$/.test(e))return/ms/.test(e)?1*e.replace("ms",""):1e3*e.replace("s","");if(/^\d+$/.test(e))return+e}return-1};if(!u(e)||!u(t))return window.console&&console.error("from 和 to 两个参数必须且为数值类型"),0;var l=Math.tween||window.Tween;l||window.console&&console.error("缓动函数 缺失");var c={duration:300,easing:"Linear",callback:function(){}},h=function(e){o(e)?c.callback=e:f(e)!=-1?c.duration=f(e):a(e)&&(c.easing=e)};h(n),h(r),h(i),window.requestAnimationFrame||(console.log("lldldl"),requestAnimationFrame=function(e){setTimeout(e,17)});var p=0,d=Math.ceil(c.duration/17);c.easing=c.easing.slice(0,1).toUpperCase()+c.easing.slice(1);var v=c.easing.split("."),m;v.length===1?m=l[v[0]]:v.length===2&&(m=l[v[0]]&&l[v[0]][v[1]]);if(o(m)===!1){console.error("没有找到名为"+c.easing+"的动画算法");return}var g=function(){var n=m(p,e,t-e,d);p++,p<=d?(c.callback(n),requestAnimationFrame(g)):c.callback(t,!0)};g()};return e}),function(e,t){var n={$on:function(e,t){return this._callbacks?"":this._callbacks={},this._callbacks[e]?"":this._callbacks[e]=[],this._callbacks[e].push(t),this},$off:function(e){if(e){if(typeof e!="string")throw new Error("event type error");this._callbacks[e]=[]}else this._callbacks={}},$once:function(e,t){this._callbacks=this._callbacks||{},this._callbacks[e]=t},$emit:function(e){var t=Array.prototype.slice.call(arguments,0),e=t.shift(),n,r,i=this;if(!(n=this._callbacks))return this;if(!(r=this._callbacks[e]))return this;if(typeof r=="function"){r.apply(i,t),this._callbacks[e]=undefined;return}for(var s=0;s<r.length;s++)r[s].apply(i,t);return this}};typeof e.define=="function"&&define("plugin/EventEmiter",[],function(){return n})}(window,document),define("plugin/pops",["plugin/animation","plugin/EventEmiter"],function(e,t){function r(e){if(e===undefined||e===null)throw new TypeError("cannot covert undefined or null to object");var t=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==undefined&&r!==null)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}function s(e){return e.document.documentElement.scrollTop||e.document.body.scrollTop}function u(e){this.options={masker:!1,closeBtn:document.createElement("span")},r(this.options,e),this.default=this.options.container?!1:!0,this.container=this.options.container||document.createElement("div"),this.dialog=this.options.dialog||document.createElement("div"),this.options.masker&&(this.modal=this.options.modal||document.createElement("div")),this.visible=!1,this.$on("showed",function(){this.visible=!0}),this.$on("closed",function(){this.visible=!1}),this.$on("close",function(){this.close()}),this.create()}function a(e,t,r){var i=document.getElementById("jtoast")||document.createElement("div");i.setAttribute("id","jtoast"),t=t||800,i.innerHTML=e,o.setStyle(i,{padding:"10px 20px","font-size":"14px",color:"#fff","min-width":"160px","text-align":"center","border-radius":"6px",background:"rgba(0, 0, 0, 0.6)",position:"fixed","z-index":++n,left:"50%",top:"50%",transform:"translate(-50%, -50%)"}),document.body.appendChild(i),o.fadeIn(i,0,500,600,function(){setTimeout(function(){o.fadeOut(i,0,500,600,r)},t)})}var n=4e3,i=function(e){var t,n;e.innerHeight&&e.scrollMaxY?(t=e.innerWidth+e.scrollMaxX,n=e.innerHeight+e.scrollMaxY):e.document.body.scrollHeight>e.document.body.offsetHeight?(t=e.document.body.scrollWidth,n=e.document.body.scrollHeight):e.document.body&&(t=e.document.body.offsetWidth,n=e.document.body.offsetHeight);var r,i;e.innerHeight?(r=e.innerWidth,i=e.innerHeight):e.document.documentElement&&e.document.documentElement.clientHeight||e.document.documentElement.clientWidth?(r=e.document.documentElement.clientWidth,i=e.document.documentElement.clientHeight):e.document.body&&(r=e.document.body.clientWidth,i=e.document.body.clientHeight);var s=t<r?r:t,o=n<i?i:n;return{PageW:s,PageH:o,WinW:r,WinH:i}},o={addClass:function(e,t){var n=e.getAttribute("class"),r=n?n.split(" "):[];r.push(t),e.setAttribute("class",r.join(" "))},removeClass:function(e,t){var n=e.getAttribute("class");if(!n)return;var r=n.split(" "),i=r.indexOf(t);if(i<0)return;r.splice(i,1),e.setAttribute("class",r.join(" "))},fadeOutDown:function(t,n,r,i){e(n,r,500,"quad.easeInOut",function(e,s){s&&i&&i(e),t.style.transform="translate3d(0, "+e+"px, 0)",t.style.opacity=(e-r)/(n-r)})},fadeInUp:function(t,n,r,i){e(n,r,500,"quad.easeInOut",function(e,s){s&&i&&i(e),t.style.transform="translate3d(0, "+e+"px, 0)",t.style.opacity=(e-n)/(r-n)})},fadeOut:function(t,n,r,i,s){i=i||500,e(n,r,i,"quad.easeInOut",function(e,i){i&&(t.style.display="none",s&&s(i)),t.style.opacity=(r-e)/(r-n)})},fadeIn:function(t,n,r,i,s){i=i||500,t.style.display="block",e(n,r,i,"quad.easeInOut",function(e,i){i&&s&&s(i),t.style.opacity=(e-n)/(r-n)})},getStyle:function(e,t){var n=null,r;return window.getComputedStyle?(n=window.getComputedStyle(e,null),r=n.getPropertyValue(t)):(n=e.currentStyle,r=n[t]),r},setStyle:function(e,t){var n="";for(var r in t)t.hasOwnProperty(r)&&(n=n+r+": "+t[r]+";");e.setAttribute("style",n)}};return o=r(o,t),u.prototype={constructor:u,create:function(){var e=this.options;this.container.appendChild(this.dialog),this.modal&&this.container.appendChild(this.modal),this.addClass(this.container,e.containerClass),this.modal&&this.addClass(this.modal,e.maskClass),this.addClass(this.dialog,e.dialogClass),this.default&&(this.setStyle(this.container,{"z-index":n++,position:"fixed",left:0,right:0,top:0,bottom:0,display:"none"}),this.setStyle(this.dialog,{"z-index":n++,position:"absolute",left:0,right:0,top:"50%",margin:"auto",display:"none"}),window.top!=window.self&&(this.dialog.style.boxShadow="0px 2px 5px 0px #666",this.container.style.background="none"),this.modal&&this.setStyle(this.modal,{width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.3)"}),e.parent?e.parent.appendChild(this.container):document.body.appendChild(this.container)),e.template&&(this.dialog.innerHTML=e.template);var t=this;setTimeout(function(){var n=typeof e.closeBtn!="string"?e.closeBtn:t.dialog.getElementsByClassName(e.closeBtn)[0];n&&n.addEventListener("click",function(){t.$emit("close")})},100)},updateDom:function(e){this.dialog.innerHTML=e},open:function(e){if(!this.default){this.removeClass(this.container,"hidden"),this.removeClass(this.dialog,"hidden"),this.$emit("showed");return}var t=this;this.options.lockScroll&&(document.body.style.overflow="hidden"),this.container.style.display="block",this.dialog.style.display="block",this.setPosition();var n=0;this.fadeInUp(this.dialog,500,-1*n,function(){t.$emit("showed"),e&&e()})},close:function(e){if(!this.default){this.addClass(this.container,"hidden"),this.addClass(this.dialog,"hidden"),this.$emit("closed");return}var t=this;this.options.lockScroll&&(document.body.style.overflow="auto");var n=0;this.fadeOutDown(this.dialog,-1*n,500,function(){t.container.style.display="none",t.$emit("closed"),e&&e()})},getEl:function(){return this.dialog},visible:function(){return this.visible},setPosition:function(){var e=i(window);console.log(e);var t=(e.WinW-this.dialog.offsetWidth)/2,n=(e.WinH-this.dialog.offsetHeight)/2;t=t>20?t:20,n=n>20?n:20,window.top!=window.self&&(e=i(window.top),n=(e.WinH-this.dialog.offsetHeight)/2+s(window.top)),this.setStyle(this.dialog,{left:t+"px",top:n+"px",display:"block"})}},r(u.prototype,o),{Modal:u,Toast:a}}),define("module/dialogs/_BindPhone",["jquery","underscore","plugin/pops","model/account","plugin/validator","model/coutry"],function(e,t,n,r,i,s){function c(){this.code="+86",this.countNum=180}var o=t.template('<div class="identy-pop bind-phone"><p class="c09 txt-mid2 mgt-30">根据《中华人民共和国网络安全法》要求，自6月1日起使用信息发布、即时通讯等互联网服务需进行身份信息验证。为保障您的使用体验，建议您尽快完成手机号绑定验证，感谢您的支持和理解。</p><div class="tit-panel1"> <span class="tit">请绑定手机号</span> </div><div class="cont"><div class="selecter selecter-s5 selecter-m1 wid-110"><div class="selecter-selected"><span class="selecter-text">+86</span><span class="sel-arrDu"><span href="" class="icon-ic_down iconfont"></span></span></div><div class="selecter-options"><ul><%for(var i = 0; i < codeList.length; i++){%><li class="selecter-item"><%=codeList[i].code%></li><%}%></ul></div></div><input type="text" class="txt-phone fr phone-input" placeholder="请输入手机号码"><p class="txt-errors mgl-120 phone-tip"></p></div><div class="cont"><input type="text" class="txt-phone sms-input" placeholder="请填写短信验证码"><p class="txt-errors sms-tip"></p><a href="javascript:;" class="btn btn-primary txt-code fr get-code">获取验证码</a></div><a href="javascript:;" class="btn btn-primary block btn-sure">确定</a></div>'),u=t.template('<div class="identy-pop bind-phone"><span class="inl-b err-cat"></span><p class="err-txt"><span class="iconfont icon-ic_test2 err-tip"></span><span class="inl-b tc">该手机已绑定过多账号，<br>请更换其他手机号</span></p><a href="javascript:;" class="btn btn-primary txt-code mgb-15 btn-rebind">重新绑定</a></div>'),a=t.template('<div class="identy-pop bind-phone"><span class="inl-b suc-cat"></span><p class="suc-txt"><span class="iconfont icon-hook suc-tip"></span>绑定成功</p><a href="javascript:;" class="btn btn-primary txt-code mgb-15 btn-confirm">知道啦</a></div>'),f={phoneError:"手机号格式不正确!",phoneEmpty:"请输入手机号!",sysError:"系统繁忙！",checkCodeEmpty:"请输入验证码",checkCodeError:"请输入正确的验证码"},l={account:!1,smsCode:!1};return c.prototype={constructor:c,start:function(e){this.destroy();var t=new n.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden",template:o({codeList:s})}),r=this.sucModal=new n.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden",template:a()}),i=this.failModal=new n.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden",template:u()});this.toBindModal=t,this.checkKey=e,this.initForm(t.getEl()),this.initSucTip(r.getEl()),this.initFailTip(i.getEl()),t.open()},initSucTip:function(t){var n=this,r=e(t),i=r.find(".btn-confirm");i.on("click",function(){n.sucModal.close(function(){history.go(0)})})},initFailTip:function(t){var n=this,r=e(t),i=r.find(".btn-rebind");i.on("click",function(){n.destroy(),n.failModal.close(function(){n.toBindModal.open()})})},initForm:function(t){var n=this,i=e(t),s=this.$getCode=i.find(".get-code"),o=this.$phoneInput=i.find(".phone-input"),u=this.$smsInput=i.find(".sms-input"),a=this.$codeSelect=i.find(".selecter-s5");this.$phoneTip=i.find(".phone-tip"),this.$smsTip=i.find(".sms-tip");var f=i.find(".btn-sure");e(document).on("click",function(){a.removeClass("open")}),a.on("click",function(t){var n=e(this);return n.hasClass("open")?n.removeClass("open"):n.addClass("open"),t.stopPropagation(),!1}),a.on("click",".selecter-item",function(t){var r=e(this);n.code=r.text(),a.find(".selecter-selected .selecter-text").text(n.code),n.checkAccount(o.val())}),o.on({focus:function(){n.$phoneTip.text("")},blur:function(){var t=e(this);n.checkAccount(t.val())}}),u.on({focus:function(){n.$smsTip.text("")},blur:function(){var t=e(this);n.checkSmsCode(t.val())}}),s.on("click",function(){if(!l.account)return!1;var t=e(this),i=e.trim(o.val()),s=n.code==="+86"?i:n.code.replace("+","")+"-"+i,u=new r;u.getCheckCode({sendType:1,msgType:3,phone_num:s},function(e){e.ret===0&&e.success?n.countDown(t):e.ret<0&&n.error(n.$phoneTip,e.msg)},function(e){n.error(n.$phoneTip,e.msg)})}),f.on("click",function(){if(l.account&&l.smsCode){var t=e.trim(o.val()),i=e.trim(u.val()),s=n.code==="+86"?t:n.code.replace("+","")+"-"+t,a=new r;a.toBindPhone({checkKey:n.checkKey,smsCode:i,phone_num:s},function(e){e.success?n.toBindModal.close(function(){n.sucModal.open()}):e.ret===-1&&n.error(n.$smsTip,e.msg)},function(e){n.error(n.$smsTip,e.msg)})}else n.$phoneInput.trigger("blur"),n.$smsInput.trigger("blur")})},countDown:function(e){e.addClass("disabled");var t=this;this.Timer&&clearInterval(this.Timer);var n=this.countNum;this.Timer=setInterval(function(){if(n===0)return clearInterval(t.Timer),e.removeClass("disabled"),e.text("获取验证码"),!1;e.text(n+"s"),n--},1e3)},checkAccount:function(t){return t=e.trim(t),l.account=!1,t?this.code==="+86"&&!i.validator(t,"mobile")?(this.error(this.$phoneTip,f.phoneError),!1):(l.account=!0,!0):(this.error(this.$phoneTip,f.phoneEmpty),!1)},checkSmsCode:function(t){return t=e.trim(t),l.smsCode=!1,t?(l.smsCode=!0,!0):(this.error(this.$smsTip,f.checkCodeEmpty),!1)},error:function(e,t){e.text(t)},destroy:function(){this.Timer&&clearInterval(this.Timer),this.$getCode&&this.$getCode.removeClass("disabled").text("获取验证码"),this.$phoneInput&&this.$phoneInput.val(""),this.$smsInput&&this.$smsInput.val(""),this.$phoneTip&&this.$phoneTip.text(""),this.$smsTip&&this.$smsTip.text("")}},new c}),define("plugin/jquery.input",["jquery"],function(e){function t(e){if(e.data("beautified"))return;e.data("beautified",!0),e.is(":radio")&&n(e),e.is(":checkbox")&&r(e)}function n(t){var n=t.closest("label"),r=n.closest("form"),i=r.find('input:radio[name="'+t.attr("name")+'"]'),s=e(i);t.on("change",function(){s.closest(".xm-radio").removeClass("xm-is-checked"),n.addClass("xm-is-checked")}),t.is(":checked")&&t.trigger("change")}function r(e){var t=e.closest("label");e.on("change",function(){t.toggleClass("xm-is-checked")}),e.is(":checked")?t.addClass("xm-is-checked"):t.removeClass("xm-is-checked")}e.fn.beautify=function(){return this.each(function(){var n=e(this);t(n)}),this}}),define("module/dialogs/login_box",["jquery","helper","plugin/dialog","plugin/placeholder","module/dialogs/city","model/user","router","model/account","module/select/coutryselect","module/login/verify","module/qrcodeLogin","module/dialogs/_BindPhone","plugin/jquery.input"],function(e,t,n,r,i,s,o,u,a,f,l,c){function x(e,t,n){e.status==401&&o.toPage(error_url)}var h=config.PASSPORT_DOMAIN||"/passport",p=h+"/guider/profile/checkEmail",d=h+"/guider/profile/checkNickname",v=h+"/login/checkAccount",m=h+"/register",g=h+"/popupLogin",y=f.verify,b={email:/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,url:/^http[s]?:\/\/([\w\-]+\.)+[\w\-]+([\w\-.\/\?\%\&\=\#]*)?$/,chinese:/^[\u4E00-\u9FA5\uF900-\uFA2D]+$/,include_chinese:/[\u4E00-\u9FA5\uF900-\uFA2D]/g,mobile:/^1[0-9]{10}$/,qq:/^[1-9]*[1-9][0-9]*$/,username:/^\w+$/,illchar:/[\~\`\!\@\#\$\%\^\&\*\(\)\-\=\+\\\|\'\"\;\:\.\>\,\<\/\?\~\·\！\@\#\￥\%\…\…\&\*\（\）\—\—\-\+\=\|\\\}\]\{\[\"\'\:\;\?\/\>\.\<\,]/},w=function(e,t){var n=!1;return b[t]&&b[t].test(e)&&(n=!0),n},E="",S={open:function(e,t){this.callback=e||function(){o.toPage(location.href)},this.closeFn=t,this.openInit()},setFollowsId:function(e){t.cookie.addCookie("j_follow_id",e)},getFollowsId:function(){var e=t.cookie.getCookie("j_follow_id");return t.cookie.delCookie("j_follow_id"),e},setLikeSoundId:function(e){t.cookie.addCookie("j_like_sound_id",e)},getLikeSoundId:function(){var e=t.cookie.getCookie("j_like_sound_id");return t.cookie.delCookie("j_like_sound_id"),e},getLocation:function(){var t=this;e.ajax({url:"/passport/location",type:"get",data:{},dataType:"json",success:function(e){e.success?t.setLocation(e.location):t.setLocation("")}})},setLocation:function(e){this.el.find("#city_info").html(e),this.el.find("#register_province").val(e)},openBox:function(e){this.openInit()},openInit:function(){var t=this,r='<div class="mgtb-10">    <p class="tc wrapper">                          <img src="'+config.STATIC_PATH+'/css/img/header/logo1.png">'+"    </p>"+'    <div class="tit-panel1 mgtb-20">'+'        <span class="tit">使用第三方账号登录</span>'+"    </div>"+'    <p class="third-login tc">'+'        <a class="inl-b" title="微信登录">'+'          <i class="icon3 icon3-weixin  login-btn" data-baidu="weixin1"></i>'+"        </a>"+'        <a class="inl-b" title="QQ登录">'+'          <i class="icon3 icon3-qq  login-btn" data-baidu="QQ1"></i>'+"        </a>"+'        <a class="inl-b" title="微博登录">'+'          <i class="icon3 icon3-sina  login-btn" data-baidu="weibo1"></i>'+"        </a>"+"    </p>"+'    <div class="tit-panel1 mgtb-20">'+'        <span class="tit">使用喜马拉雅账号登录</span>'+"    </div>"+'    <div class="login-tab">'+'    <a class="login-li link3 on">账号登录</a>'+'    <a class="login-li link3">扫码登录</a>'+"    </div>"+'    <form class="tb-1 login_from">'+'        <div class="ph_input" is-placeholder="true">'+'            <div class="j-coutryarea-lgbox  fl mgtb-10 mgr-5 wid-110"></div>'+'            <input class="mgtb-10  wid-170" type="text" placeholder="邮箱或手机号" id="login_userAccount" name="userAccount">'+'            <input type="password" placeholder="密码" id="login_userPwd" name="userPwd">'+'            <div style="margin-top: 10px;" class="j-checkcode-container"></div>'+'            <p class="bottom">'+'                <a class="fr" href="/passport/user_info/show" target="_blank">找回密码</a>'+'                <label class="xm-checkbox">'+'                    <input type="checkbox" checked="checked" class="userRemember" id="login_userRemember" name="userRemember">下次自动登录'+"                </label>"+"            </p>"+'               <p class="infoErr mgb-10 j-error" id="infoErr"></p>'+'            <a class="btn btn-primary btn-lg block" id="login_btn">登 录</a>'+"            <p>"+'                <span class="fr c02">'+'                  没有账号？<a class="c05" href="/passport/register" target="_blank">注册</a>'+"                </span>"+"             </p>"+"        </div>"+"    </form>"+'    <form class="scan-code hidden">'+'       <div class="code-bord">'+'           <img alt="" class="code-pic">'+'           <div class="overdue-code hidden">'+'               <p class="txt">二维码已失效</p>'+'               <a href="" class="btn btn-primary btn-update">点击刷新</a>'+"           </div>"+'           <div class="scan-success hidden">'+'               <div class="scan-suc"></div>'+'               <p class="scan-txt">扫描成功</p>'+"           </div>"+"       </div>"+'       <p class="c06">请打开喜马拉雅FM App，扫描二维码</p>'+'       <p class="c06 mgt-10">免输入，快速，更安全</p>'+"   </form>";"</div>";var i={dialogClass:"pop-c pop-login",content:r,template:{dialog_container:'<div class="loginPop" dialog-role="container"></div>',dialog_body:'<div class="mgtb-10" dialog-role="body"></div>',dialog_close:'<span class="btn1 btn-close"><span class="icon1 icon1-cha" dialog-role="close">×</span></span>'},onClose:function(){t.qrcodeLogin&&t.qrcodeLogin.destroy(),t.closeFn&&t.closeFn(),e(document).trigger("login_box_close")}},s=new n.Dialog(i);this.popup=s,s.open();var o=s.getEl(),t=this;this.el=o,this.coutryview=new a({type:"old",el:".loginPop  .j-coutryarea-lgbox"}),this.getLocation(),this.thirdParty(o),this.login(),e(o).find("#login_userRemember").beautify();var u=e(o),f=u.find(".login-tab"),c=u.find("form.tb-1"),h=u.find("form.scan-code"),p=this.qrcodeLogin=new l({imgDom:h.find(".code-pic"),refreshBtn:h.find(".overdue-code .btn-update"),successDom:h.find(".scan-success"),expireDom:h.find(".overdue-code")});f.off().on("click",".login-li",function(){var t=e(this),n=t.text();if(t.hasClass("on"))return!1;p.destroy(),t.siblings().removeClass("on"),t.addClass("on"),n==="扫码登录"?(h.removeClass("hidden"),c.addClass("hidden"),p.init()):(h.addClass("hidden"),c.removeClass("hidden"))}),setTimeout(function(){var n=e("#login_userAccount").val();e.trim(n)!=""&&y.account(e("#login_userAccount"),t.coutryview.getSelected().code,function(){e("#infoErr").text("").show()})},1e3)},thirdParty:function(n){var r=this;n.find(".third-login").on("click",".login-btn",function(){var n=e(this),i={weixin1:12,QQ1:2,weibo1:1,renren1:3},s=e(this).attr("data-baidu");r.baidu(n);var o=i[s];t.login(o,"",function(t){console.log(t),t.gotoBindMPhone?(e(document).on("login_box_close",function(){c.start(t.checkKey)}),r.popup.close()):r.login_callback(t)})})},reflushCheckCode:function(t){var n=this;if(!t)return n.checkUUID=null,n.el.find(".j-checkcode-container").empty(),!1;var r='<input type="text" style="width: 184px!important;" placeholder="请输入右边图片内容" class="verifycode" id="picverify"><img id="img_validcode_1" src="'+t+'" style="width:97px;height:30px;margin-left:3px;cursor:pointer; ">';n.el.find(".j-checkcode-container img").length?(n.el.find(".j-checkcode-container img").attr("src",t),n.el.find(".j-checkcode-container input").val("")):n.el.find(".j-checkcode-container").html(r),n.el.find("#img_validcode_1").off().on("click",function(){var t=e(this).attr("src");/v=(\d*)/.test(t)?t.replace(/v=(\d*)/,"v="+Date.now()):t+="&v="+Date.now(),e(this).attr("src",t)}),n.el.find(".j-checkcode-container").removeClass("hidden")},login_callback:function(e){var t=this,n=t.getFollowsId();config.CURRENT_USER||(config.CURRENT_USER={}),config.CURRENT_USER.uid||(config.CURRENT_USER.uid=n),n?s.follow(n,!0,function(){t.callback(e)}):t.callback(e),this.close()},verifySuccess:function(){e("#infoErr").text("").show()},baidu:function(e){var t=e.attr("data-baidu");window.console&&console.log(t),window._hmt&&_hmt.push(["_trackEvent",t,"click"])},login:function(){var t=this;r(".login_from .ph_input");var n=this.el.find("#login_userAccount"),i=this.el.find("#login_userPwd"),s=this.el.find("#login_userRemember"),o=this.el.find("#login_btn");this.coutryview.on("change",function(r){e.trim(n.val())!==""&&y.account(n,r.code,t.verifySuccess)});var a=function(){if(e(this).attr("cancel_blur"))return;y.account(e(this),t.coutryview.getSelected().code,t.verifySuccess)};n.blur(a),n.keyup(a);var f=function(){y.accountSuccess&&y.password(e(this),t.verifySuccess)};i.blur(f),i.keyup(f),e(".login_from input[type=password]").bind({keydown:function(t){t.keyCode==13&&(e(this).triggerHandler("blur"),o.click())}}),o.click(function(){y.accountSuccess?y.passwordSuccess||y.password(i,t.verifySuccess):y.account(n,t.coutryview.getSelected().code,t.verifySuccess);var r=t.el.find("#picverify");if(y.accountSuccess&&y.passwordSuccess&&y.checkcode(r,t.checkUUID)){var o=new u,a=e.trim(n.val()),f=t.coutryview.getSelected().code;a=y.getPhoneByCode(f,a);var l={account:a,password:e.trim(i.val()),rememberMe:s[0].checked?!0:!1};t.checkUUID&&(l.checkUUID=t.checkUUID,l.checkCode=r.val()),o.popupLogin(l,function(n){n.success&&!n.gotoBindMPhone?(t.login_callback(n),y.success(),t.checkUUID=null):n.gotoBindMPhone?(e(document).on("login_box_close",function(){c.start(n.checkKey)}),t.popup.close()):(t.reflushCheckCode(),y.error(e("#infoErr"),n.errorMsg))},function(n){n.ret==211||n.ret==212?(t.reflushCheckCode(n.checkCodeUrl),t.checkUUID=n.checkUUID,n.errorMsg=n.msg||n.errorMsg):t.reflushCheckCode(),y.error(e("#infoErr"),n.errorMsg||"帐号或密码错误")})}})},close:function(){this.popup&&this.popup.close()},getEl:function(){return this.popup?this.popup.getEl():""}};return S}),define("model/sound_images",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({cache:{},getData:function(t,n,r){n=n||e.noop,r=r||e.noop;var i="/sounds/"+t+"/pictures",s=this,o=this.cache[t];t.indexOf("d_")==0&&(i=""),e.ajax({url:i,type:"get",cache:!1,dataType:"json",success:function(e){s.cache[t]=e,n(e)},error:function(e){r(e)}})}});return r}),define("module/dialogs/imageslider",["jquery","plugin/dialog","model/sound_images"],function(e,t,n){var r=new n,i={open:function(e){if(!e)return;var t=this;this.openDialog(),r.getData(e,function(e){t.renderImage(e)})},openDialog:function(){var e='<div class="num"><span class="cur_order">1</span>/<span class="all_num"></span></div><div class="gCon"><img src=""><span class="imgLoad"></span><a title="上一张" class="prev disabled" href="javascript:;"><span></span></a><a title="下一张" class="next disabled" href="javascript:;"><span></span></a></div><ul class="gCon2"></ul>',n={id:"imageSlider",content:e,fixed:!1,template:{dialog_container:'<div class="gPopupMulti"  dialog-role="container"></div>',dialog_close:'<div class="close6Btn" dialog-role="close"></div>'}},r=new t.Dialog(n);r.open(),this.pop=r,this.$el=r.getEl(),this.bindEvents()},bindEvents:function(){var t=this,n=this.$el.find(".gCon2"),r=this.$el.find(".cur_order"),i=this.$el.find(".prev"),s=this.$el.find(".next");n.on("click","li",function(){var o=e(this),u=o.attr("image-large");if(o.hasClass("on"))return;t.renderLargeImage(u),n.find(".on").removeClass("on"),o.addClass("on"),r.html(o.index()+1),o.prev().size()==0?i.addClass("disabled"):i.removeClass("disabled"),o.next().size()==0?s.addClass("disabled"):s.removeClass("disabled")}),i.on("click",function(){var t=e(this);if(t.hasClass("disabled"))return!1;var r=n.find(".on");return r.prev().trigger("click"),!1}),s.on("click",function(){var t=e(this);if(t.hasClass("disabled"))return!1;var r=n.find(".on");return r.next().trigger("click"),!1})},renderLargeImage:function(e){var t=this,n=this.$el.find(".gCon"),r=n.find("img");this.largeImage=e,n.addClass("is-loading"),n.css("opacity",.5);var i=new Image;i.onload=function(){if(t.largeImage!=this.src){i=null;return}n.removeClass("is-loading"),r.attr("src",e),n.animate({opacity:1}),t.pop.setPosition(),i=null},i.onerror=function(){n.removeClass("is-loading"),i=null},i.src=e},renderImage:function(n){if(n.ret==0){this.pop.close(),n.msg&&t.alert(n.msg);return}var r="",i=n.pictures,s=i.length;this.$el.find(".all_num").html(s);if(s==1){this.renderLargeImage(i[0].large);return}for(var o=0;o<s;o++){var u=i[o];r+='<li class="is-loading" image-large="'+u.large+'"><a>'+'<img src="'+u.small+'"><span class="imgLoad"></span></a></li>'}var a=this.$el.find(".gCon2");a.append(r),a.find("img").on("load",function(){var t=e(this),n=t.closest("li");n.removeClass("is-loading")}),a.find("li").eq(0).click()}};return i}),define("module/xchat/letter",["jquery"],function(e,t){var n,r=function(){var e=["140.206.200.242","140.206.200.243","114.80.138.114","114.80.138.115"],t=parseInt(Math.random()*10/2),i=e[t==4?3:t];return n===i?r():i};n=r();var i=/test\.ximalaya\.com/.test(window.location.href)?"ws://192.168.21.45:10052":"ws://"+n+":2002",s,o=11;navigator.userAgent.replace(/MSIE([^;]*);/,function(e,t){o=parseInt(t)}),window.wsdebug=!0;var u=s,a=!1,f,l=function(){var t=e.cookie(config.TOKEN_LABEL);if(t&&!u.isLogin()){var n=t.split("&")[0],r=t.split("&")[1];u.login(parseInt(n),r),f&&clearInterval(f)}var i=setInterval(function(){u.getUnreadMsgCount(function(t){if(t instanceof Array)return;t>99&&(t="99+");var n=e(".loginPanel_MsgPop .message-item")[0].text;if(e.trim(n)!=e.trim(t+"私信")){var r=t?'<span class="txt-msg">'+t+"</span>私信":"私信";e(".loginPanel_MsgPop .message-item").html(r).addClass("xchatmsg-count")}})},5e3)};if(u){var f=setInterval(function(){var t=e.cookie(config.TOKEN_LABEL);if(a&&t&&!u.isLogin()){clearInterval(f);var n=t.split("&")[0],r=t.split("&")[1];u.login(parseInt(n),r)}},2e3);u.remove("connection"),u.on("connection",function(){a=!0,l()})}return s}),define("module/xchat/letterTemplate",[],function(){var e='<div class="msg_header">    <span class="title">消息中心</span>    <ul class="nav_list">        <li class="nav_item"><a href="/msgcenter/notice" hashlink="">系统通知</a></li>        <li class="nav_item"><a href="/msgcenter/referme" hashlink="">@我的</a></li>        <li class="nav_item"><a href="/center/comment" hashlink="">评论</a></li>        <li class="nav_item on"><a href="javascript:;">私信</a></li>        <li class="nav_item"><a href="/center/like" hashlink="">赞</a></li>    </ul></div>',t='<div class="mainbox_right">    <div class="msg_helper">        <div class="msg_header_title">私信小帮助</div>        <div class="question">不想让陌生人发信骚扰？</div>        <div class="answer">            去            <a href="/personal_settings/privacy" target="_blank">隐私设置</a>            进行隐私权限设置        </div>    </div></div>',n='<div id="msgLetter" data-xchat="true" class="mainbox_wrapper"> <div class="mainbox_left">        <div class="msg_container">'+e+'            <div class="msg_body">'+'                <div class="msg_body_top">'+'                    <div class="left">'+'                        <span class="title">私信</span>'+'                        <span class="count"></span>'+"                    </div>"+'                    <div class="right"></div>'+"                </div>"+'                <div class="msg_list_wrap">'+'                    <div class="letter_list_header">'+'                        <div class="left hadContacts">${hadContacts}</div>'+'                        <span class="sendLetterBtn right">'+'                            <span class="icon">发私信</span>'+"                        </span>"+'                        <div class="searchPanel2 right">'+'                            <input class="search_input" type="text" value="${search_input}" data-url="/msgcenter/letter/" name="" autocomplete="off" placeholder="搜索联系人或内容">'+'                            <span class="search_btn"></span>'+"                        </div>"+"                    </div>"+'                    <ul class="msg_notice_list">${msgList}</ul>'+'                    <div class="pagingBar mgTB20">${pagingBar}'+"                    </div>"+"                </div>"+"            </div>"+"        </div>"+"    </div>"+t+"</div>",r='<li class="msg_notice_item">    <div class="content_wrap">        <div class="picture">          <a href="/zhubo/${user_id}/" hashlink="">            <img width="60px" height="60px" card="${user_id}" alt="${user_name}" src="${cover}" data-options="defaultImg:person_60">          </a>        </div>        <div class="detail">            <div class="detail_top letter_def">                <span>                    <a class="from" href="/zhubo/${user_id}/" hashlink="">${user_name}:</a>                </span>                <span>${maxContent}</span>            </div>            <div class="detail_content"></div>            <div class="detail_bottom">                <span class="left">${maxDate}</span>                <span class="letter_counter">                    <a href="/letter/${user_id}" hashlink="">查看聊天记录${unread_num}</a>                </span>                <span class="right">                    <a href="javascript:;" data-options="&quot;nickname&quot;:&quot;${unicodeName}&quot;">回复</a>                </span>            </div>        </div>    </div>    <a class="close hidden" title="删除" data-options="id:" style="display:none;" href="javascript:;"></a></li>',i='<div id="msgLetterDetail" class="mainbox_wrapper" data-xchat="true">  <div class="mainbox_left">       <div class="msg_container">'+e+'           <div class="msg_body">'+'               <div class="msg_body_top">'+'                   <div class="left">'+'                       <span class="title">私信</span>'+'                       <span class="count"></span>'+"                   </div>"+"               </div>"+'               <div class="msg_list_wrap">'+'                   <div class="letter_list_header">'+'                       <div class="left"><a href="/msgcenter/letter" hashlink="">返回所有私信</a>&gt;共<span id="message_count">${message_count}</span>条私信</div>'+"                   </div>"+'                   <div class="letter_send">'+'                       <div class="content_wrap_left">'+'                           <div class="picture">'+'                               <img src="${currUserCover}">'+"                           </div>"+'                           <div class="detail">'+'                               <div class="detail_letter">'+'                                   <div class="others_letter">'+'                                       <div class="letter_content">'+'                                           <textarea class="letter_input"></textarea>'+'                                           <span class="arrow_left"></span>'+"                                       </div>"+"                                   </div>"+'                                   <div class="detail_bottom">'+'                                       <div class="left"><span class="message_icon">发私信给${user_name}</span></div>'+'                                       <div class="right">'+'                                           <span class="charCount count-tip">还剩<em>300</em>字</span>'+'                                           <a class="faceBtn" href="javascript:;"></a>'+'                                           <a class="submitBtn" href="javascript:;" data-options="&quot;nickname&quot;:&quot;${unicodeName}&quot;"><span>发送</span></a>'+"                                       </div>"+"                                   </div>"+"                               </div>"+"                           </div>"+"                       </div>"+"                   </div>"+'                   <div class="letter_del_all hidden"> '+'                       <div class="btn_wrap">'+'                           <span class="btn_del">批量删除</span>'+"                       </div>"+'                       <div class="btn_wrap cancel">'+"                           取消"+"                       </div>"+'                       <div class="btn_wrap confirm">'+'                           <span class="btn_del">确认删除</span>'+"                       </div>"+"                   </div>"+'                   <ul class="letter_detail_list">${letterItem}</ul>'+"               </div>"+"           </div>"+"       </div>"+"   </div>"+t+"</div>",s='<li class="letter_detail_item">    <div class="${contentWarpClass} ">        <div class="picture">            <img alt="${user_name}" src="${cover}" data-options="defaultImg:person_60">        </div>        <div class="detail">            <div class="detail_letter">                <div class="others_letter">                    <div class="letter_content">                        <input type="checkbox" value="${msgId}">                        <div>                            ${msgContent}                        </div>                        <div class="pubdate">${msgTime}</div>                        <span class="${arrowClass}"></span>                    </div>                </div>            </div>        </div>    </div></li>',o={};return o["/msgcenter/letter"]={all:n,item:r},o["/letter/\\d*"]={all:i,item:s},o}),define("module/xchat/parseface",[],function(){var e={"呵呵":"/css/img/face/d_hehe.gif","嘻嘻":"/css/img/face/d_xixi.gif","哈哈":"/css/img/face/d_haha.gif","太开心":"/css/img/face/d_taikaixin.gif","亲亲":"/css/img/face/d_qinqin.gif","酷":"/css/img/face/d_ku.gif","拜拜":"/css/img/face/d_baibai.gif","可爱":"/css/img/face/d_keai.gif","馋嘴":"/css/img/face/d_chanzui.gif","花心":"/css/img/face/d_huaxin.gif","爱你":"/css/img/face/d_aini.gif","汗":"/css/img/face/d_han.gif","鄙视":"/css/img/face/d_bishi.gif","怒":"/css/img/face/d_nu.gif","失望":"/css/img/face/d_shiwang.gif","害羞":"/css/img/face/d_haixiu.gif","可怜":"/css/img/face/d_kelian.gif","悲伤":"/css/img/face/d_beishang.gif","泪":"/css/img/face/d_lei.gif","闭嘴":"/css/img/face/d_bizui.gif","委屈":"/css/img/face/d_weiqu.gif","挖鼻屎":"/css/img/face/d_wabishi.gif","思考":"/css/img/face/d_sikao.gif","疑问":"/css/img/face/d_yiwen.gif","嘘":"/css/img/face/d_xu.gif","晕":"/css/img/face/d_yun.gif","书呆子":"/css/img/face/d_shudaizi.gif","阴险":"/css/img/face/d_yinxian.gif","做鬼脸":"/css/img/face/d_zuoguilian.gif","黑线":"/css/img/face/d_heixian.gif","吃惊":"/css/img/face/d_chijing.gif","衰":"/css/img/face/d_shuai.gif","怒骂":"/css/img/face/d_numa.gif","愤怒":"/css/img/face/d_fennu.gif","左哼哼":"/css/img/face/d_zuohengheng.gif","右哼哼":"/css/img/face/d_youhengheng.gif","哼":"/css/img/face/d_heng.gif","懒得理你":"/css/img/face/d_landelini.gif","打哈气":"/css/img/face/d_dahaqi.gif","钱":"/css/img/face/d_qian.gif","偷笑":"/css/img/face/d_touxiao.gif","鼓掌":"/css/img/face/d_guzhang.gif","生病":"/css/img/face/d_shengbing.gif","感冒":"/css/img/face/d_ganmao.gif","困":"/css/img/face/d_kun.gif","睡觉":"/css/img/face/d_shuijiao.gif","抓狂":"/css/img/face/d_zhuakuang.gif","吐":"/css/img/face/d_tu.gif","顶":"/css/img/face/d_ding.gif","男孩儿":"/css/img/face/d_nanhaier.gif","女孩儿":"/css/img/face/d_nvhaier.gif","兔子":"/css/img/face/d_tuzi.gif","熊猫":"/css/img/face/d_xiongmao.gif","猪头":"/css/img/face/d_zhutou.gif","奥特曼":"/css/img/face/d_aoteman.gif","互粉":"/css/img/face/f_hufen.gif","神马":"/css/img/face/f_shenma.gif","萌":"/css/img/face/f_meng.gif","囧":"/css/img/face/f_jiong.gif","给力":"/css/img/face/f_geili.gif","心":"/css/img/face/l_xin.gif","爱心传递":"/css/img/face/l_aixinchuandi.gif","伤心":"/css/img/face/l_shangxin.gif","帅":"/css/img/face/f_shuai.gif","威武":"/css/img/face/f_v5.gif","喜":"/css/img/face/f_xi.gif","发红包":"/css/img/face/o_fahongbao.gif","握手":"/css/img/face/h_woshou.gif","耶":"/css/img/face/h_ye.gif","赞":"/css/img/face/h_zan.gif",ok:"/css/img/face/h_ok.gif",good:"/css/img/face/h_good.gif","弱":"/css/img/face/h_ruo.gif","最差":"/css/img/face/h_zuicha.gif","来":"/css/img/face/h_lai.gif","不要":"/css/img/face/h_buyao.gif","拳头":"/css/img/face/h_quantou.gif",haha:"/css/img/face/h_haha.gif","太阳":"/css/img/face/w_taiyang.gif","月亮":"/css/img/face/w_yueliang.gif","蛋糕":"/css/img/face/o_dangao.gif","咖啡":"/css/img/face/o_kafei.gif","干杯":"/css/img/face/o_ganbei.gif","冰棍":"/css/img/face/o_bingun.gif","西瓜":"/css/img/face/o_xigua.gif","礼物":"/css/img/face/o_liwu.gif","蜡烛":"/css/img/face/o_lazhu.gif","鲜花":"/css/img/face/w_xianhua.gif","落叶":"/css/img/face/w_luoye.gif","绿丝带":"/css/img/face/o_lvsidai.gif","红丝带":"/css/img/face/o_hongsidai.gif","围观":"/css/img/face/o_weiguan.gif","雪人":"/css/img/face/w_xueren.gif","钟":"/css/img/face/o_zhong.gif","微风":"/css/img/face/w_weifeng.gif","下雨":"/css/img/face/w_xiayu.gif","雪":"/css/img/face/w_xue.gif","沙尘暴":"/css/img/face/w_shachenbao.gif","浮云":"/css/img/face/w_fuyun.gif","足球":"/css/img/face/o_zuqiu.gif","手套":"/css/img/face/o_shoutao.gif","围脖":"/css/img/face/o_weibo.gif","温暖帽子":"/css/img/face/o_wennuanmaozi.gif","自行车":"/css/img/face/o_zixingche.gif","汽车":"/css/img/face/o_qiche.gif","飞机":"/css/img/face/o_feiji.gif","手机":"/css/img/face/o_shouji.gif","音乐":"/css/img/face/o_yinyue.gif","话筒":"/css/img/face/o_huatong.gif","照相机":"/css/img/face/o_zhaoxiangji.gif","电影":"/css/img/face/o_dianying.gif","风扇":"/css/img/face/o_fengshan.gif","实习":"/css/img/face/o_shixi.gif"},t=function(t){var n=config.STATIC_PATH;return t.replace(/\[([A-z\u4E00-\u9FA5\uF900-\uFA2D^\[\]]+?)\]/g,function(t,r){var i=e[r];return i?'<img class="face" src="'+n+i+'" alt="'+r+'"/>':t})};return t}),define("module/xchat/common",["jquery","module/xchat/letter","./letterTemplate","../../router","helper","./parseface"],function(e,t,n,r,s,o){var u=["/msgcenter/letter"];u.push("/letter/\\d*");var a,f={};f.commonPart=function(e,t){var n=e.html;t.length>0?l.getUserInfo(t,e):r.pageInit(e)},f.converName=function(e,t,n,r,i){return e?(n=n.replace(/\$\{user_name\}/g,e),n=n.replace(/\$\{cover\}/g,t),n=n.replace(/\$\{unicodeName\}/g,l.decToHex(e))):(n=n.replace(/\$\{user_name\}/g,"${user_name_"+r+"}"),n=n.replace(/\$\{cover\}/g,"${cover_"+r+"}"),n=n.replace(/\$\{unicodeName\}/g,"${unicodeName_"+r+"}"),i.push(r)),{temp:n,noNameIds:i}},f["/msgcenter/letter"]=function(e,r){if(!t)return;var i,u="",a=[],c=[],h=0;e.replace(/^([^\?]*)\?(.*)/,function(t,n,i){return i&&(r=i),e=n.replace(/\/$/,""),""}),r=r||"";var p=r.split("&");for(var d=0;d<p.length;d++)p[d].indexOf("q=")!==-1&&(u=p[d].replace(/q=/,"")),p[d].indexOf("page=")!==-1&&(i=parseInt(p[d].replace(/page=/,"")));i=i||1,t.getListMaxMsg(u,i,10,function(t){function h(r){var c={html:function(){var c="",h="";for(var p=0;p<r.length;p++){var d=r[p],v=d.send_name,m=d.send_cover,g="",y=d.unread_num?"("+d.unread_num+"条未读)":"";g+=n[e].item.replace(/\$\{user_id\}/g,d.send_id),g=g.replace(/\$\{unread_num\}/g,y),g=g.replace(/\$\{maxContent\}/g,d.maxContent),g=g.replace(/\$\{maxDate\}/g,s.getDateNiceTime(d.timeStamp));var b=f.converName(v,m,g,d.send_id,a);g=b.temp,a=b.noNameIds,c+=o(g)}var w="";c&&(w=l.pagingBar("/msgcenter/letter",i,t.totalPageNum,u)),h+=n[e].all.replace(/\$\{msgList\}/g,c),h=h.replace(/\$\{pagingBar\}/g,w||"");var E="已有"+(r.length&&t.totalSize||0)+"个联系人";return h=h.replace(/\$\{hadContacts\}/g,E||""),h=h.replace(/\$\{search_input\}/g,u||""),h}(),initData:{params:[],title:"喜马拉雅-听我想听"},moduleName:"page/message/letter"};return f.commonPart(c,a),c}var r=t.data||[],c=0;c>0||r.length===0?h([]):c===0&&r.length>0&&h(r)})},f["/letter/\\d*"]=function(e){if(!t)return;var r=current_user.uid||t.curr_user.userId,i,u="",a="",c=[];e.replace(/letter\/(\d*)/,function(e,t){i=t}),t.getUserInfoById(parseInt(i),function(e){var h=e.user_name;t.getAllTouserMsg(parseInt(i),function(e){var i={html:function(){var i,p=!0;for(var d=0;d<e.length;d++){var v="",m,g,y,b,w=e[d];y=w.send_name,b=w.send_cover,w.send_id===r?(m="content_wrap_left",g="arrow_left"):(m="content_wrap_right",g="arrow_right"),p&&w.send_id!==r&&w.status!==1&&(p=!1,i={sendId:w.send_id,msgId:w.msg_id}),v+=n["/letter/\\d*"].item,v=v.replace(/\$\{contentWarpClass\}/g,m),v=v.replace(/\$\{arrowClass\}/g,g),v=v.replace(/\$\{msgId\}/g,w.msg_id),v=v.replace(/\$\{msgContent\}/g,w.msg_content),v=v.replace(/\$\{msgTime\}/g,s.getDateNiceTime(w.createtime));var E=f.converName(y,b,v,w.send_id,c);v=o(E.temp),c=E.noNameIds,u+=v}i&&t.singMsgReadACK(i),a=n["/letter/\\d*"].all;var S=a.replace(/\$\{letterItem\}/g,u);return S=S.replace(/\$\{currUserCover\}/g,current_user.logoPic60),S=S.replace(/\$\{user_name\}/g,h),S=S.replace(/\$\{message_count\}/g,e.length),S=S.replace(/\$\{unicodeName\}/g,l.decToHex(h)),S}(),initData:{params:[],title:"喜马拉雅-听我想听"},moduleName:"page/message/letterdetail"};f.commonPart(i,c)})})};var l={isSpecial:function(e,t){var n,r=!1,i=typeof e=="string"?e:e.attr("href");return this.isActived()?(r=this.loadPage(i,"",t),r):r},loadPage:function(e,t,n){var r=!1;e=e.replace(/\/$/,"");for(i=0;i<u.length;i++){var s=new RegExp(u[i]);if(s.test(e)){!n&&f[u[i]](e,t),r=!0;break}}return r},pagingBar:function(e,t,n,r){if(n<=1)return"";r=r?"q="+r+"&":"";var i='<div class="pagingBar_wrapper" url="/msgcenter/letter" theme="hashlink">',s=t-1?1:t-1,o=t+1>n?n:t+1,u='<a href="'+e+"?"+r+"page="+s+'" data-page="'+s+'" class="pagingBar_page" hashlink="" rel="prev">上一页</a>',a='<a href="'+e+"?"+r+"page="+o+'" data-page="'+o+'" class="pagingBar_page" hashlink="" rel="next">下一页</a>',f="<span>......</span>",l='<a href="javascript:;" class="pagingBar_page on">'+t+"</a>",c='<a href="'+e+'?page=${num}" data-page="${num}" class="pagingBar_page" hashlink="">${num}</a>',h="";t>1&&(h+=u);var p="";for(var d=1;d<=n;d++)d===t?p+=l:n>t*2&&n-3===d&&n>10?p+=f:n>t*2&&3===d&&n>10?p+=f:p+=c.replace(/\$\{num\}/g,d);return h+=p,p?(t!==n&&(h+=a),h=i+h+"</div>",h):""},decToHex:function(e){if(!e)return"";var t=[];for(var n=0;n<e.length;n++)t[n]=("00"+e.charCodeAt(n).toString(16)).slice(-4);return"\\u"+t.join("\\u")},sendLetter:function(n,r,i){var s=n.get("nickname"),o=n.get("content");e.ajax({url:"/get_uid_by_nickname",type:"POST",data:{nickname:n.get("nickname")},success:function(e){if(e&&e.uid)r&&t.once("sendMsgHandler",function(e){if(e.msg==="success")r.apply(this,arguments),r=null;else{var t="网络错误,发送失败!";if(e.code==402||e.code==403||e.code==404)t="对方进行了隐私设置，不能给TA发私信。";i({},{msg:t}),i=null}}),t.sendMsg({userId:e.uid,content:o});else{var n="记录不存在：找不到"+s;i({},{msg:n}),i=null}},error:function(){i&&i({},{msg:"网络错误,发送失败!"})}})},isActived:function(){return t&&t.actived?!0:!1},getUserInfoByLocal:function(e,n){return t.getUserInfoById(e,n)},getUserInfo:function(n,i,s){var o=i.html;e.ajax({url:"/get_im_users",data:{uids:n.join(",")},type:"POST",dataType:"json",success:function(e){for(var n in e){var s=e[n].nickname,u=e[n].logoPic60;t.saveUserInfo({userId:n,userName:s,cover:u});var a=new RegExp("\\$\\{user_name_"+n+"\\}","g"),f=new RegExp("\\$\\{cover_"+n+"\\}","g"),c=new RegExp("\\$\\{unicodeName_"+n+"\\}","g");o=o.replace(a,s),o=o.replace(f,u),o=o.replace(c,l.decToHex(s))}i.html=o,r.pageInit(i)},error:function(){}})}};l.xchatLetter=t;var c=function(){var e=location.pathname,t=location.search.replace(/^\?/,"");l.loadPage(e,t)};return t&&t.on("loginSuccess",function(){c&&c()}),l}),define("model/message",["jquery","underscore","backbone","json2"],function(e,t,n,r){var i=n.Model.extend({defaults:{category:"",newMessage:0,newNotice:0,newComment:0,newQuan:0,newFollower:0,newLikes:0},getNewMessage:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/notices",type:"post",dataType:"json",success:function(e,r,i){r.res&&r.res!=0&&r.res!="0"?t(e,r,i):n(e,r,i)}})},parse:function(e){e.res||(e.res={});var t=this.attributes;return{newMessage:e.res.new_message===void 0?t.newMessage:e.res.new_message,newNotice:e.res.new_notice===void 0?t.newNotice:e.res.new_notice,newComment:e.res.new_comment===void 0?t.newComment:e.res.new_comment,newQuan:e.res.new_quan===void 0?t.newQuan:e.res.new_quan,newFollower:e.res.new_follower===void 0?t.newFollower:e.res.new_follower,newLikes:e.res.new_like===void 0?t.newLikes:e.res.new_like}},clearNewMessage:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/notices/clear",type:"post",dataType:"json",data:{category:r.get("category")},success:function(e,r,i){r.res!=0?t(e,r,i):n(e,r,i)}})}});return i}),define("module/header/message",["jquery","json2","model/message","plugin/dialog","router","helper"],function(e,t,n,r,i){var s=e("div.login-msg"),o=e(".loginPanel_MsgPop ul"),u={newComment:'<span class="txt-msg">{0}</span>评论',newQuan:'<span class="txt-msg">{0}</span>@我的',newFollower:'<span class="txt-msg">{0}</span>粉丝',newNotice:'<span class="txt-msg">{0}</span>系统通知',newMessage:'<span class="txt-msg">{0}</span>私信',newLikes:'<span class="txt-msg">{0}</span>赞'},a={newComment:".comment-item",newQuan:".quan-item",newFollower:".follower-item",newNotice:".notice-item",newMessage:".message-item",newLikes:".likes-item"},f={"comment-item":"new_comment","quan-item":"new_quan","follower-item":"new_follower","notice-item":"new_notice","message-item":"new_message","likes-item":"new_likes"},l={isRequist:!1,seqID:0,locked:!1,messageModel:null,start:function(){this.messageModel=new n,this.messageModel.on("change:newMessage",this.onChangeCount,this),this.messageModel.on("change:newComment",this.onChangeCount,this),this.messageModel.on("change:newQuan",this.onChangeCount,this),this.messageModel.on("change:newFollower",this.onChangeCount,this),this.messageModel.on("change:newLikes",this.onChangeCount,this),this.messageModel.on("change:newNotice",this.onChangeCount,this),clearInterval(this.seqID),l.seqMessage(),this.seqID=setInterval(function(){l.seqMessage()},config.WARNING_SEQ*1e3),o.find("a[class*='msg-item']").on("click",l.closeCate),o.find('a[class*="msg-item"]').each(function(){for(var t in f)e(this).hasClass(t)&&e(this).attr("category",f[t])})},onChangeCount:function(e){},seqMessage:function(){if(!helper.isLogin())return;if(!l.isRequist){var r=e.cookie("msgwarn");if(r){l.messageModel=new n(t.parse(r)),l.doResetmsg(l.messageModel),l.flushNew();return}}l.isRequist=!0,l.messageModel.getNewMessage(function(n,r){l.isRequist=!0,r=n.toJSON(),e.cookie("msgwarn",t.stringify(r),{expires:config.WARNING_SEQ*1+3,path:"/",domain:document.domain}),l.doResetmsg(n),l.flushNew()})},closeAllCate:function(){return l.messageModel.set("category",undefined),l.messageModel.set({newMessage:0,newNotice:0,newComment:0,newQuan:0,newFollower:0,newLikes:0}),l.isRequist||e.cookie("msgwarn",t.stringify(l.messageModel.toJSON()),{expires:config.WARNING_SEQ*1+3,path:"/",domain:document.domain}),l.messageModel.clearNewMessage(function(e){o.parent().hide()}),!1},closeCate:function(){var n=this;if(e(this).hasClass("message-item")&&e(this).hasClass("xchatmsg-count"))return;e(this).find(".txt-msg").remove(),l.messageModel.set("category",e(n).attr("category")),l.messageModel.clearNewMessage(function(){var r=e(n).attr("category");if(!r)return;var i=r.replace(/(_[a-z])/,function(e,t){return t.substring(1).toUpperCase()}),s=e('[m-name="menu"]'),o=e('[m-name="sub-menu"]'),u=e('[category="'+r+'"]');u.removeClass("red-dot"),l.messageModel.set(i,0),e.cookie("msgwarn",t.stringify(l.messageModel.toJSON()),{expires:config.WARNING_SEQ*1+3,path:"/",domain:document.domain}),l.flushNew()})},doResetmsg:function(e){if(!e)return;for(var t in e.attributes)if(t in u&&("newMessage"!=t||!o.find(a[t]).hasClass("xchatmsg-count")))if(e.attributes[t]>0){var n=e.attributes[t]>99?99:e.attributes[t];isEuealZero=!1,o.find(a[t]).html(helper.strFormat(u[t],n,config.CURRENT_USER.uid))}else o.find(a[t]).find(".txt-msg").remove()},flushNew:function(){var t=0;o.find("a[class*='msg-item']").each(function(){e(this).find(".txt-msg").length>0&&t++}),t>0?e(".msg-info .new-msg").removeClass("hidden"):e(".msg-info .new-msg").addClass("hidden")},toOne:function(){var t=this,n,r=o.find("a[class*='msg-item']");for(var s=0;s<r.length;s++){var u=r[s];if(e(u).find(".txt-msg").length>0){n=s;break}}var a;n?a=o.find("a[class*='msg-item']:eq("+n+")"):a=o.find("a[class*='msg-item']:eq(0)"),l.closeCate.call(a),i.toPage(a.attr("href"))}};return l}),define("module/header/header",["jquery","plugin/dialog","module/header/message","helper","model/account","../../router","module/select/coutryselect","module/dialogs/login_box","module/qrcodeLogin","plugin/jquery.input"],function(e,t,n,r,i,s,o,u,a){function k(t){if(!t)return v=null,w.find(".j-checkcode-container").empty(),!1;var n='<input type="text" style="width: 80px!important;" placeholder="请输入右边图片内容" class="verifycode j-picverify" ><img id="img_validcode_1" src="'+t+'" style="width: 80px;height:30px;margin-left:3px;cursor:pointer;">'+'<p class="tips"></p>';w.find(".j-checkcode-container img").length?(w.find(".j-checkcode-container img").attr("src",t),w.find(".j-checkcode-container input").val("")):w.find(".j-checkcode-container").html(n),w.find("#img_validcode_1").off().on("click",function(){var t=e(this).attr("src");/v=(\d*)/.test(t)?t.replace(/v=(\d*)/,"v="+Date.now()):t+="&v="+Date.now(),e(this).attr("src",t)}),w.find(".j-checkcode-container").removeClass("hidden")}var f=e(".menu"),l=f.find(".menu_explore"),c=e(".msg-info"),h=e(".loginPanel_MenuPop"),p=0,d=10,v,m=new o({type:"old",el:".login-wrapper .j-coutryarea-lgbox"});m.$el.find(".selecter-m1").removeClass("wid-110").addClass("wid-70"),m.$el.closest("form").addClass("selZone").addClass("rel");var g=e(".sub-header"),y=g.find(".loginPanel_accountPop"),b=g.find(".login-wrapper"),w=b.find(".box"),E=w.find(".password"),S=w.find(".third-login"),x=e(document);e('<div class="j-checkcode-container"></div>').insertBefore(g.find(".tb-1 .submit-btn")),e("#agreeDeal").beautify(),l.find("span").off().on("click",function(){return l.hasClass("is-open")?l.removeClass("is-open"):l.addClass("is-open"),e(".discoverMenu").stop().slideToggle("normal"),!1}),h.on({mouseover:function(){clearTimeout(p)},mouseleave:function(){c.trigger("mouseleave")}}),n.start(),g.find(".userfaceBtn").on({mouseenter:function(){d&&y.css("opacity","hide").height(0).animate({height:100,opacity:"toggle"},100),clearTimeout(d),e(".loginPanel_MsgPop").hide(),d=0},mouseleave:function(){clearTimeout(d),d=setTimeout(function(){y.stop().slideUp(100),n.locked=!1,n.doResetmsg(n.messageModel)},200)}}),y.on({mouseover:function(){clearTimeout(d),d=0},mouseleave:function(){g.find(".userfaceBtn").trigger("mouseleave")}}),e(".j-msg").on("click",function(e){return n.toOne(),!1});var T=function(t){var n=e(t.target);if(n.closest(".box").size()>0||n.closest(".box").size()>0)return;b.removeClass("open"),x.off("mousedown",T)};b.on("click",function(){u.open(function(e){u.close(),s.toPage(decodeURIComponent(window.location.href))})});var N=function(e,t){var n=e.parent("div");n.addClass("is-error").find(".tips").text(t)},C=function(e){var t=e.parent("div");t.removeClass("is-error").find(".tips").text("")};w.find(".username").on("blur",function(){var t=e.trim(e(this).val());t?C(e(this)):N(e(this),"帐号不能为空")}),E.on("blur",function(){var t=e.trim(e(this).val());t?C(e(this)):N(e(this),"密码不能为空")});var L=new i;w.on("click",".submit-btn",function(){var t=w.find(".username"),n=w.find(".rememberMe"),r=e.trim(t.val()),i=e.trim(E.val()),o=!!n[0].checked,u=w.find(".j-picverify");C(u,""),w.find(".username").blur(),E.blur();if(w.find(".is-error").length>0)return;var a=m.getSelected().code;/^1[0-9]{10}$/.test(r)&&a&&a!=="+86"&&(r=m.getSelected().code.replace(/\+/,"")+"-"+r),w.attr("lock","1");var f={account:r,password:i,rememberMe:o};v&&(f.checkUUID=v,f.checkCode=u.val()),L.popupLogin(f,function(e){s.toPage(decodeURIComponent(window.location.href)),v=null,setTimeout(function(){w.removeAttr("lock")},200)},function(e){var n="",r=E;e.ret==211||e.ret==212?(k(e.checkCodeUrl),v=e.checkUUID,e.errorMsg=e.msg||e.errorMsg||"",r=w.find(".j-picverify")):(N(t,""),n="帐号或密码错误",k()),N(r,e.errorMsg||n),setTimeout(function(){w.removeAttr("lock")},200)})}),E.on("keydown",function(e){e.keyCode==13&&!w.attr("lock")&&w.find(".submit-btn").trigger("click")}),S.on("click","a",function(){var t=e(this).find("i"),n=0;t.hasClass("icon3-sina")&&(n=1),t.hasClass("icon3-qq")&&(n=2),t.hasClass("icon3-weixin")&&(n=12);if(n==0)return;return r.login(n,""),!1})}),define("model/tag",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{tagName:0},delFollowingTag:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_tags/"+encodeURIComponent(r.get("tagName"))+"/destroy",type:"post",dataType:"json",success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},switchFollowedTag:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/tag/"+encodeURIComponent(r.get("tagName"))+"/switch_follow",type:"post",dataType:"json",success:function(e,r,i){r.response==="create"||r.response==="destroy"?t(e,r,i):n(e,r,i)}})},create:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_tags/create",data:{tname:this.get("tagName")},type:"post",dataType:"json",success:function(e,r,i){r.res===!1?n(r.msg,e,r,i):t(e,r,i)}})}});return r}),define("module/right/right",["jquery","underscore","backbone","model/tag","plugin/dialog"],function(e,t,n,r,i){function o(e,t){var n=[];while(e--)n[e]=e;var r=[];while(t--){var i=parseInt(Math.random()*n.length);r.push(n[i]),n.splice(i,1)}return r}e("body").on("click",".recommendTagsBar .tab_item",function(){var t=e(this),n=t.parent(),r=t.closest(".recommendTagsBar");r.find(".tab_content,.tab_item").removeClass("on");var i=n.find(".tab_item").index(t);t.addClass("on"),r.find(".tab_content").eq(i).addClass("on")}),e("body").on("click",".addTagBtn",function(){var t=e(this),n=t.closest(".addTagOperate"),r=n.find("input");t.hide(),n.find("div").fadeIn(200),r.focus()}),e("body").on("click",".addTagOperate",function(e){return!1}),e("body").on("click",function(t){var n=e(".addTagOperate");if(n.size()){var r=n.find("input");n.find("div").fadeOut(200,function(){r.val(""),n.find(".addTagBtn").show()})}}),e("body").on("keydown",".addTagOperate input",function(t){if(t.keyCode===13){var n=e(this),r=n.closest(".addTagOperate"),i=r.find(".editConfirm"),s=r.find("input");s.blur(),i.click()}}),e("body").on("click",".addTagOperate .editConfirm",function(){var t=e(this),n=t.closest(".addTagOperate"),s=n.closest(".tagsBox"),o=n.find("input"),u=o.val(),a='<a class="tagBtn" href="/#/tag/'+u+'/"><span>'+u+'</span><div class="del"></div></a>';if(u){var f=new r({tagName:u});if(t.data("is_querying"))return;t.data("is_querying",!0),f.create(function(){n.find("div").fadeOut(200,function(){n.find(".addTagBtn").show(),o.val("")}),e(a).appendTo(s).hide().fadeIn(200),t.data("is_querying",!1)},function(e){i.alert(e),t.data("is_querying",!1)})}}),e("body").on("click",".tagBtn .del",function(){var t=e(this),n=t.closest(".tagBtn"),i=n.find("span").text(),s=new r({tagName:i});return s.switchFollowedTag(),n.fadeOut(200),!1}),e("body").on("click",".homeNavMoreBar a.off",function(){var t=e(this);e("li.message,li.comment,li.at").slideToggle(200,"linear"),t.toggleClass("on"),t.hasClass("on")?t.text("收起"):t.text("展开")});var s=e(document);s.on("click",".personPanelBar3 .selectBtn",function(){var t=e(this),n=t.closest(".personPanelBar3");n.toggleClass("is-open"),n.hasClass("is-open")?t.addClass("on"):t.removeClass("on")}),s.on("click",".personPanelBar3 .closeBtn",function(){var t=e(this),n=t.closest(".listItem");n.slideUp(function(){n.remove()})}),s.on("click",".recommendedBar .more",function(){var t=e(this).closest(".recommendedBar"),n=t.find(".personPanelBar3List"),r=n.children();r.hide();var i=r.length;if(i<=6){r.show();return}var s=o(i,6);for(var u=0;u<s.length;u++)r.eq(s[u]).show()})}),define("module/dialogs/copyright",["jquery","plugin/dialog"],function(e,t){return t.applyDeal=function(){e.get("/passport/register_rule",function(e){var n='<div class="for">'+e+"</div>",r={dialogClass:"dialog-applydeal",caption:"喜马拉雅网络服务使用协议",fixed:!1,content:n,width:680},i=new t.Dialog(r);i.open()})},t.copyright=function(){e.get("/copyright/popup",function(e){var n=e,r={dialogClass:"dialog-copyright pop-original",caption:"版权声明",content:n,template:{dialog_body:'<div class="original-wrapper"><div class="pop-original-body width-530"  dialog-role="body"></div> </div>',dialog_close:'<div class="close3Btn rt-20" dialog-role="close"></div>'}},i=new t.Dialog(r);i.open()})},t}),define("module/dialogs/zawan",["jquery","plugin/dialog"],function(e,t){var n={open:function(e){this.createPop()},createPop:function(){var e=config.STATIC_ROOT+"/y/welcome.htm?file="+config.STATIC_ROOT+"/ximalaya.mp4?v=201509291837",n="<style>#welcome_iframe{height:420px!important;}</style><iframe id='welcome_iframe' frameborder='0' src='"+e+"'"+" marginheight='0' marginwidth='0' width='100%' scrolling='auto' style='background:#fff;border:none;'></iframe>",r={content:n,iframe:!0,width:720,height:444},i=new t.Dialog(r);i.open()}};return n}),define("module/common/checklogin",["jquery","module/dialogs/login_box"],function(e,t){function r(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)===" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!==-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}var n="/passport/check_me";return function(i,s){i=i||e.noop,s=s||e.noop;var o=function(){t.open(function(e){t.close()}),s()},u=r(config.TOKEN_LABEL);if(!u){o();return}e.ajax({type:"get",url:n,data:{token:decodeURIComponent(u),rememberMe:"y"},dataType:"json",success:function(e){e&&e.ret===50?o():i()},error:function(){o()}})}}),define("module/foot_child_illegal",["jquery","plugin/dialog","module/common/checklogin"],function(e,t,n){var r={open:function(){var e=this;n(function(){e.createPop()})},createPop:function(t){var n=e(".maskers"),r=e(".identy-pop"),i=this;this.$identyPop=r;var s='<i class="icon9 icon-closed fr j-close"></i><h3>举报</h3><p class="report-info c02">  如果您发现网站存在儿童色情信息，欢迎向管理员举报：</p><div class="report-cont">  <span class="txt-top mgr-10">举报内容</span>  <textarea class="report-area j-child-illegal-input"></textarea></div><div class="button">  <a class="inl-b mgr-20 j-submit" >提交</a></div>';n.show(),r.show(),r.html(s),r.off().on("click",".j-close",function(){r.hide(),n.hide()}).on("click",".j-submit",function(){var t=r.find(".j-child-illegal-input").val();if(e.trim(t)==="")return!1;i.sendMessage(t),r.find(".j-child-illegal-input").text(""),r.hide(),n.hide()})},sendMessage:function(n){e.ajax({url:" /illegal_info/report",type:"POST",data:{content:n},success:function(e){t.success("举报成功!")},error:function(e){t.warn()}})}};return r}),define("module/foot",["jquery","module/dialogs/copyright","helper","module/dialogs/zawan","module/foot_child_illegal"],function(e,t,n,r,i){e("#copy_right").off("click").click(function(){t.copyright()}),e(".copy_right").off("click").click(function(){t.copyright()}),e(".j_friendly_link").click(function(){e(".footer_friendly_link").toggle(),e(".footer-other .bomb-layer").not(".footer_friendly_link").hide()}),e(".j_hot_sound").click(function(){e(".footer_hot_sound").toggle(),e(".footer-other .bomb-layer").not(".footer_hot_sound").hide()}),e(".j_personal_radio").click(function(){e(".footer_personal_radio").toggle(),e(".footer-other .bomb-layer").not(".footer_personal_radio").hide()}),e(".register-tip-video").on("click",function(){r.open()}),e(".footer-link").on("click",function(){e(this).toggleClass("open")}),e(".j-report-illegal").on("click",function(){i.open()}),e(".footer-contact").on("click",".txt-more",function(){e(".footer-contact .footer-other").toggleClass("open")}),e(".weixin").on("click",function(){var e={dialogClass:"dialog-copyright",caption:"微信公众号",content:'<div class="weixin_download1"></div>',close:!1,width:"auto"},n=new t.Dialog(e);return n.open(),!1}),e(".js-qq").on("click",function(){var e={dialogClass:"dialog-copyright",caption:"QQ公众号",content:'<div class="code_qq"></div>',close:!1,width:"auto"},n=new t.Dialog(e);return n.open(),!1});var s={init:function(){var t=e(".register-tip");if(t.length===0)return;this.addEvent(),this.initDigit()},addEvent:function(){var t=e(".register-tip");t.find(".register-tip-btn2").click(function(){t.animate({height:15},120)}),t.on("mouseenter",function(n){if(e(n.target).hasClass("register-tip-btn2"))return;t.animate({height:80},120)}),e(".register-tip-panel").on("click","a",function(t){var r=e(this),i=r.index()+1,s=r.attr("data-baidu");n.login(i,s)})},getData:function(){var t=this;e.ajax({url:"/global_counts_json",type:"post",dataType:"json",success:function(e){t.user_digit=e.users+"",t.voice_digit=e.tracks+"",t.createDigit()},error:function(){}})},initDigit:function(){this.getData();var e=this},createDigit:function(){var t=this,n=e("#user_digit"),r=e("#voice_digit");if(!n.size()||!r)return;if(!t.user_digit)return;t.addDigit(n,t.user_digit),setTimeout(function(){if(!t.voice_digit)return;t.addDigit(r,t.voice_digit)},200)},addDigit:function(t,n){n+="";var r=t.attr("data-digit")||"0",i=0;t.attr("data-digit",n);if(n==r)return;var s=n.length,o=r.length;if(s>o)for(i=0;i<s-o;i++){var u=t.children().first().clone();u.find(".digit").text(""),u.appendTo(t)}var a=n.split(""),f=r.split("");for(i=s-1;i>=0;i--)if(a[i]!=f[i]){var l=t.children().eq(i).find(".digit");l.text(a[i]),function(t,n){setTimeout(function(){t.animate({fontSize:40,marginLeft:-8},100,function(){e(this).animate({fontSize:16,marginLeft:0},100)})},100*(s-n))}(l,i)}}};e(document).ready(function(){s.init()});var o={unloginBottomTip:s};return o}),define("module/common/backtotop",["jquery","underscore","backbone","plugin/dialog"],function(e,t,n,r){var i=['<a class="backToTop" href="javascript:void(0);"><div class="weixin_download"></div><span class="left_array"></span>关注微信</a>','<a class="backToTop" href="javascript:void(0);"><div class="app_download"></div><span class="left_array"></span>下载APP</a>','<a class="backToTop " href="javascript:void(0);"><div class="feedback-img"></div><span class="left_array"></span>意见反馈</a>','<a class="backToTop top hidden1" href="javascript:void(0);"><u></u></a>'].join(""),s=n.View.extend({template:t.template(i),className:"rightFixed",events:{"click .top":"toTop"},initialize:function(){if(window.top!=window.self)return!1;var t=this;t.render(),t.cusService(),e(window).on("scroll",[t],t.backToTop)},toTop:function(){helper.scrollTo1(0,0),this.$el.find(".top").addClass("hidden1"),this.model.set("isShow",!1)},backToTop:function(t){var n=t.data[0],r=0;clearTimeout(n.model.get("backtotoptimeout")),r=setTimeout(function(){var t=e(document).scrollTop();t>0?n.model.get("isShow")||(n.$el.find(".top").removeClass("hidden1"),n.model.set("isShow",!0)):n.model.get("isShow")&&(n.$el.find(".top").addClass("hidden1"),n.model.set("isShow",!1))},500),n.model.set("backtotoptimeout",r)},cusService:function(){window.KF5SupportBoxAPI.ready(function(){window.KF5SupportBoxAPI.removeButton(),e(document).on("click",".j-CustomUniqueTag",function(){window.KF5SupportBoxAPI.open(function(){})})})},render:function(){this.$el.append(this.template()).show(),e(document.body).append(this.$el)}});return new s({model:new n.Model({backtotoptimeout:50,isShow:!1})})}),define("module/my/search_input",["jquery","underscore","backbone","router","module/xchat/common"],function(e,t,n,r,i){var s=i.xchatLetter,o=n.View.extend({init:function(){this.$el=e(document),this.bindEvents()},bindEvents:function(){var t=this;this.$el.on("click",".searchPanel2 .search_btn",function(){t.searchResult(e(this).parent().find(".search_input"))}),this.$el.on("keyup",".searchPanel2 .search_input",function(n){n.keyCode==13&&t.searchResult(e(this))})},searchResult:function(t){var n=e.trim(t.val()),o="q:"+decodeURIComponent(n),u=t.attr("data-options");u&&(o+=","+u);var a=t.attr("data-url");a.indexOf("?")&&(a=a.replace(/\?.*/,"")),o=o.replace(/\:/g,"=").replace(/\,/g,"&"),s&&s.actived?(i.loadPage(a,o),r.path=a+"?"+o,r.pushState("")):r.toPage(a+"?"+o)},release:function(){this.$el.off("click",".search_btn"),this.$el.off("keyup",".search_input")}}),u=new o;return u.init(),u}),define("module/common",["plugin/dialog","model/user","module/dialogs/login_box","helper","../router","module/dialogs/imageslider","module/xchat/common","./header/header","./right/right","module/foot","module/common/backtotop","module/my/search_input"],function(e,t,n,r,i,s,o){function g(){u.size()&&y(),w()}function y(){var e=m.scrollTop(),t=p+(f.is(":hidden")?0:v);l.toggleClass("is-fixed",e>u.offset().top+t),c.toggleClass("is-fixed",e>u.offset().top+t)}function b(e){return e.parents(".mainbox_right").size()&&$(".mainbox_right").height()>$(".mainbox_left").height()?!1:!0}function w(){var e=m.scrollTop(),t=$(".fixedBox"),n=d;if(m.height()+document.documentElement.clientHeight<m.scrollTop())return;if(m.height()<document.documentElement.clientHeight+m.scrollTop())return;$.each(t,function(t,r){var i=$(r);if(!b(i)){i.removeClass("is-fixed");return}if(i.is(".is-fixed")){var s=i.data("scrollTop");if(s>e){i.removeClass("is-fixed");return}}else{var o=i.offset().top;if(!(e+d+10>o))return;i.addClass("is-fixed"),i.data("scrollTop",e)}var u=a.offset().top,f=i.height(),l=f+n-document.documentElement.clientHeight;l>0&&(n-=l),l=f+n+e-u,l>0&&(n-=l),i.css({top:n})})}function E(s){n.open(function(){e.success("登录成功!"),t.cache.clear(),r.refreshCurrentUser(),s&&s!="javascript:;"?i.toPage(s):i.reload()})}function S(e){var t=/^http(s)?\:\/\/([\w-]+\.)+[\w-]+\/?/i,n=t.exec(e);return n?(n=n[0],n.replace(/\/$/,"")):""}$(window).bind("scroll",g);var u=$(".header").eq(0),a=$(".footer").eq(0),f=$(".discoverMenu").eq(0),l=$(".floatHeader").eq(0),c=$(".downloadApp2").eq(0),h=a.height(),p=u.height(),d=l.height(),v=110,m=$(document).eq(0);i.redirectIsWork=!1,$(document).ajaxComplete(function(e,t,r){t.status==400&&n.open()}),function(){var e="close_download";m.on("click",".downloadApp .closeBtn",function(){$(".downloadApp").hide(),localStorage[e]=!0}),localStorage[e]?$(".downloadApp").hide():$(".downloadApp").show()}(),m.on("click","[sound_popsrc]",function(){var e=$(this).attr("sound_popsrc");return s.open(e),!1}),$(window).on("popstate",function(){var e=history.state.url;if(o.isSpecial(e))return i.path=e,i.pushState(""),!1}),m.on("click","a",function(e){var t=$(this),n=t.attr("href");if(t.is("[mustlogin]")&&!r.isLogin())return E(n),!1;if(t.is("[hashlink]")){if(o.isSpecial(t))return i.path=n,i.pushState(""),!1;if(!history.pushState)return;if($(e.target).is("[hashlink-disable]")){e.preventDefault();return}if(!n)return;var s=S(n),u=t.attr("hashlink"),a=t.is("[unencode]"),f=i.isToSub(u);n=n.replace(s,""),n=n||"/",n=f&&i.hashlink(u)?i.hashlink(u):n,i.toPage(n,f,u,a),e.preventDefault();return}if(t.is('[onclick="return false;"]')||n=="javascript:;")return}),m.on("click","a",function(){var t=$(this),n=t.attr("notice");if(n)return e.alert(n),!1});var x={userModel:new t(config.CURRENT_USER,{parse:!0}),refreshFixedBox:w,refreshFloatHeader:y,mustLogin:E};return x}),define("model/comment_chunkinfo",["jquery","underscore","backbone","./cache"],function(e,t,n,r){var i=null;return i=n.Model.extend({defaults:{id:"",chunks:[],duration:0},fetch:function(e){e=e||{},t.extend(e,{url:"/track_blocks/avatars",type:"get"}),e.data={track_ids:this.id},n.Model.prototype.fetch.call(this,e)},parse:function(e,t){for(id in e){var n=e[id];return{id:id,chunks:n[0],duration:n[1]}}}},{cache:new r}),window.t=i,i}),define("model/comment",["jquery","underscore","backbone","./cache","module/dialogs/paysound","model/sound"],function(e,t,n,r,i,s){var o=n.Model.extend({defaults:{id:"",avatarPath:"",content:"",coverPath:"",createdAt:"",nickname:"",parentId:"",second:"",trackId:"",trackUid:"",uid:"",updatedAt:"",uploadSource:"",userSource:""},check:function(t,n){var t=this.toJSON();if(!t.content)return"评论不能为空。";var r=/[\u0391-\uFFE5]/g,i=e.trim(t.content).replace(r,"aa"),s=Math.ceil(i.length/2);if(s>300)return"评论不能超过300个字。"},fetch:function(e){e=e||{},t.extend(e,{url:"/tracks/"+this.id+".json"}),n.Model.prototype.fetch.call(this,e)},parse:function(e){return{id:e.id,avatarPath:e.avatar_url,content:e.content,coverPath:e.cover_path,createdAt:e.created_at,niceTime:helper.getNiceTime(e.created_at),nickname:e.nickname,parentId:e.parent_id,second:e.second,trackId:e.track_id,trackUid:e.track_uid,uid:e.uid,updatedAt:e.updated_at,uploadSource:e.upload_source,userSource:e.user_source,message_id:e.message_id,type:e.type}},create:function(t,n){t=t||e.noop,n=n||e.noop,this.save({},{url:"/comments/create",data:{track_id:this.get("trackId"),parent_id:this.get("parentId"),content:this.get("content"),sharing_to:this.get("sharing_to"),no_more_alert:this.get("no_more_alert"),second:this.get("second")},type:"post",success:function(e,r,o){if(r.res===!1){r.mark==="PaidRefuse"&&i.pop(s),n(e,r);return}t(e,r)},error:function(e,t,r){n(e,null,r)}})},del:function(t,n){t=t||e.noop,n=n||e.noop,this.destroy({url:"/tracks/"+this.get("trackId")+"/comments/"+this.id+"/destroy",type:"post",success:function(e,r,i){if(r.res===!1){n(e,r);return}t(e,r)},error:function(e,t,r){n(e,t,r)}})},delMycenter:function(t,n){t=t||e.noop,n=n||e.noop;var r=this;this.destroy({url:"/msgcenter/destroy_comment",type:"post",data:{track_id:r.get("track_id"),comment_id:r.get("comment_id"),message_id:r.get("message_id"),type:r.get("type")},success:function(e,r,i){if(r.res===!1){n(e,r);return}t(e,r)},error:function(e,t,r){n(e,t,r)}})}},{cache:new r});return o}),define("collection/comment",["jquery","underscore","backbone","model/comment"],function(e,t,n,r){var i=n.Collection.extend({model:r,fetch:function(e){e=e||{};var r=e.data||{};if(r.soundId===undefined||r.chunkIndex===undefined)return;t.extend(e,{url:"/tracks/"+r.soundId+"/"+r.chunkIndex}),r.soundId=undefined,r.chunkIndex=undefined,n.Collection.prototype.fetch.call(this,e)},parse:function(e){return e.comments}});return i}),define("model/comment_chunk",["jquery","underscore","backbone","./cache","collection/comment","model/comment"],function(e,t,n,r,i,s){var o="",u=n.Model.extend({defaults:{id:"",comments:new i,count:0,soundId:"",index:0},fetch:function(e){if(o==this.id)return;o=this.id,t.extend(e,{url:"/tracks/"+this.get("soundId")+"/"+this.get("index")}),n.Model.prototype.fetch.call(this,e)},parse:function(e,n){var r=new i;return t.each(e.comments,function(e,t){var n=new s(e,{parse:!0});r.add(n)}),{comments:r}}},{cache:new r});return u}),define("plugin/face.lib",[],function(){var e="";window.config&&window.config.STATIC_ROOT&&(e=window.config.STATIC_ROOT);var t={"呵呵":e+"/css/img/face/d_hehe.gif","嘻嘻":e+"/css/img/face/d_xixi.gif","哈哈":e+"/css/img/face/d_haha.gif","太开心":e+"/css/img/face/d_taikaixin.gif","亲亲":e+"/css/img/face/d_qinqin.gif","酷":e+"/css/img/face/d_ku.gif","拜拜":e+"/css/img/face/d_baibai.gif","可爱":e+"/css/img/face/d_keai.gif","馋嘴":e+"/css/img/face/d_chanzui.gif","花心":e+"/css/img/face/d_huaxin.gif","爱你":e+"/css/img/face/d_aini.gif","汗":e+"/css/img/face/d_han.gif","鄙视":e+"/css/img/face/d_bishi.gif","怒":e+"/css/img/face/d_nu.gif","失望":e+"/css/img/face/d_shiwang.gif","害羞":e+"/css/img/face/d_haixiu.gif","可怜":e+"/css/img/face/d_kelian.gif","悲伤":e+"/css/img/face/d_beishang.gif","泪":e+"/css/img/face/d_lei.gif","闭嘴":e+"/css/img/face/d_bizui.gif","委屈":e+"/css/img/face/d_weiqu.gif","挖鼻屎":e+"/css/img/face/d_wabishi.gif","思考":e+"/css/img/face/d_sikao.gif","疑问":e+"/css/img/face/d_yiwen.gif","嘘":e+"/css/img/face/d_xu.gif","晕":e+"/css/img/face/d_yun.gif","书呆子":e+"/css/img/face/d_shudaizi.gif","阴险":e+"/css/img/face/d_yinxian.gif","做鬼脸":e+"/css/img/face/d_zuoguilian.gif","黑线":e+"/css/img/face/d_heixian.gif","吃惊":e+"/css/img/face/d_chijing.gif","衰":e+"/css/img/face/d_shuai.gif","怒骂":e+"/css/img/face/d_numa.gif","愤怒":e+"/css/img/face/d_fennu.gif","左哼哼":e+"/css/img/face/d_zuohengheng.gif","右哼哼":e+"/css/img/face/d_youhengheng.gif","哼":e+"/css/img/face/d_heng.gif","懒得理你":e+"/css/img/face/d_landelini.gif","打哈气":e+"/css/img/face/d_dahaqi.gif","钱":e+"/css/img/face/d_qian.gif","偷笑":e+"/css/img/face/d_touxiao.gif","鼓掌":e+"/css/img/face/d_guzhang.gif","生病":e+"/css/img/face/d_shengbing.gif","感冒":e+"/css/img/face/d_ganmao.gif","困":e+"/css/img/face/d_kun.gif","睡觉":e+"/css/img/face/d_shuijiao.gif","抓狂":e+"/css/img/face/d_zhuakuang.gif","吐":e+"/css/img/face/d_tu.gif","顶":e+"/css/img/face/d_ding.gif","男孩儿":e+"/css/img/face/d_nanhaier.gif","女孩儿":e+"/css/img/face/d_nvhaier.gif","兔子":e+"/css/img/face/d_tuzi.gif","熊猫":e+"/css/img/face/d_xiongmao.gif","猪头":e+"/css/img/face/d_zhutou.gif","奥特曼":e+"/css/img/face/d_aoteman.gif","互粉":e+"/css/img/face/f_hufen.gif","神马":e+"/css/img/face/f_shenma.gif","萌":e+"/css/img/face/f_meng.gif","囧":e+"/css/img/face/f_jiong.gif","给力":e+"/css/img/face/f_geili.gif","心":e+"/css/img/face/l_xin.gif","爱心传递":e+"/css/img/face/l_aixinchuandi.gif","伤心":e+"/css/img/face/l_shangxin.gif","帅":e+"/css/img/face/f_shuai.gif","威武":e+"/css/img/face/f_v5.gif","喜":e+"/css/img/face/f_xi.gif","发红包":e+"/css/img/face/o_fahongbao.gif","握手":e+"/css/img/face/h_woshou.gif","耶":e+"/css/img/face/h_ye.gif","赞":e+"/css/img/face/h_zan.gif",ok:e+"/css/img/face/h_ok.gif",good:e+"/css/img/face/h_good.gif","弱":e+"/css/img/face/h_ruo.gif","最差":e+"/css/img/face/h_zuicha.gif","不要":e+"/css/img/face/h_buyao.gif","拳头":e+"/css/img/face/h_quantou.gif",haha:e+"/css/img/face/h_haha.gif","太阳":e+"/css/img/face/w_taiyang.gif","月亮":e+"/css/img/face/w_yueliang.gif","蛋糕":e+"/css/img/face/o_dangao.gif","咖啡":e+"/css/img/face/o_kafei.gif","干杯":e+"/css/img/face/o_ganbei.gif","西瓜":e+"/css/img/face/o_xigua.gif","礼物":e+"/css/img/face/o_liwu.gif","蜡烛":e+"/css/img/face/o_lazhu.gif","鲜花":e+"/css/img/face/w_xianhua.gif","落叶":e+"/css/img/face/w_luoye.gif","绿丝带":e+"/css/img/face/o_lvsidai.gif","红丝带":e+"/css/img/face/o_hongsidai.gif","围观":e+"/css/img/face/o_weiguan.gif","雪人":e+"/css/img/face/w_xueren.gif","钟":e+"/css/img/face/o_zhong.gif","微风":e+"/css/img/face/w_weifeng.gif","下雨":e+"/css/img/face/w_xiayu.gif","雪":e+"/css/img/face/w_xue.gif","沙尘暴":e+"/css/img/face/w_shachenbao.gif","浮云":e+"/css/img/face/w_fuyun.gif","足球":e+"/css/img/face/o_zuqiu.gif","手套":e+"/css/img/face/o_shoutao.gif","围脖":e+"/css/img/face/o_weibo.gif","温暖帽子":e+"/css/img/face/o_wennuanmaozi.gif","自行车":e+"/css/img/face/o_zixingche.gif","汽车":e+"/css/img/face/o_qiche.gif","飞机":e+"/css/img/face/o_feiji.gif","手机":e+"/css/img/face/o_shouji.gif","音乐":e+"/css/img/face/o_yinyue.gif","话筒":e+"/css/img/face/o_huatong.gif","照相机":e+"/css/img/face/o_zhaoxiangji.gif","电影":e+"/css/img/face/o_dianying.gif","风扇":e+"/css/img/face/o_fengshan.gif","实习":e+"/css/img/face/o_shixi.gif"};return t}),define("plugin/face",["jquery","./face.lib"],function(e,t){function i(t){t.stopPropagation();var n=e(this),i=n.offset().left,s=n.offset().top;r.setPosition(i,s+n.height()),r.setTextarea(t.data.textarea),r.setWidth(t.data.width),r.show()}jQuery.fn.extend({getCurPos:function(){var t=e(this).get(0);if(t.selectionStart)return t.selectionStart;if(document.selection){var n=document.selection.createRange();if(n==null)return t.value.length;var r=t.createTextRange(),i=r.duplicate();return r.moveToBookmark(n.getBookmark()),i.setEndPoint("EndToStart",r),i.text.length}return t.value.length},setCurPos:function(t){var n=e(this).get(0);if(n.setSelectionRange)n.setSelectionRange(t,t);else if(n.createTextRange){var r=n.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}}});var n=function(){this.el=e("<div class='window-face'><div class='face-header'><a href='javascript:;'></a></div></div>"),e(document.body).append(this.el),this.onEmotionClick(),this.created=!1};n.prototype.createEl=function(){},n.prototype.create=function(){var e="<div class='face-container'>",n=0,r=60;for(var i in t){var s=parseInt(n/r)+1;n%r==0&&(s>1?e+='<div style="display:none;">':e+='<div class="current-page">'),n++,e+="<a title='"+i+"' href='javascript:void(0);'><img src='"+t[i]+"' title='"+i+"'/></a>",n%r==0&&(e+="</div>")}n%r!=0&&(e+="</div>"),e+="</div>",e+='<div class="face-pageBar"><a class="face-prev disabled"></a><a class="face-next disabled"></a></div>';var o=this.el;o.append(e);var u=o.find(".face-prev"),a=o.find(".face-next"),f=o.find(".face-container"),l=f.children();l.size()>1?a.removeClass("disabled"):a.addClass("disabled"),u.on("click",function(){if(u.hasClass("disabled"))return;var e=f.find(".current-page"),t=e.prev();if(t.size()==0){u.addClass("disabled");return}e.removeClass("current-page").hide(),t.addClass("current-page").show(),t.prev().size()==0&&u.addClass("disabled"),a.removeClass("disabled")}),a.on("click",function(){if(a.hasClass("disabled"))return;var e=f.find(".current-page"),t=e.next();if(t.size()==0){a.addClass("disabled");return}e.removeClass("current-page").hide(),t.addClass("current-page").show(),t.next().size()==0&&a.addClass("disabled"),u.removeClass("disabled")}),this.created=!0},n.prototype.onEmotionClick=function(){var t=this;this.el.on("click",function(n){n.stopPropagation();var r=e(n.target),i=r.attr("title");if(!i)return;i="["+i+"]",t.textarea.triggerHandler("focus");var s=t.textarea.getCurPos(),o=t.textarea.val(),u;s==0?(u=o+i,s=u.length-1):u=o.substring(0,s)+i+o.substring(s),t.textarea.val(u),t.textarea.setCurPos(s+i.length),t.textarea.change(),t.hide()}),this.el.find(".face-header").mouseover(function(){e(this).addClass("hover")}).mouseout(function(){e(this).removeClass("hover")}).click(function(){t.hide()})},n.prototype.setPosition=function(e,t){this.el.css({left:e,top:t,zIndex:1e5})},n.prototype.setWidth=function(e){this.el.width(e)},n.prototype.setTextarea=function(e){this.textarea=e},n.prototype.show=function(){this.created||this.create(),e(document).bind("click",this,this.hide),this.el.show()},n.prototype.hide=function(t){var n=this;t&&t.data&&(n=t.data),n.el.hide(),e(document).unbind("click",n.hide)};var r=null,s={};return s.init=function(t,s,o){o=o||{},r||(r=new n(t));var u=o.method||"click";e(t).unbind(u,i).bind(u,{textarea:e(s),width:o.width||""},i)},s.getHtml=function(e){var n=/(\[([^\]\[]*?)\])/g,r=e.replace(n,function(){var e=arguments;return t[e[2]]?'<img class="face-image" title="'+e[2]+'" src="'+t[e[2]]+'"/>':e[1]});return r},s}),define("model/thirdpart",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({_cacheData:{bindStatus:{},syncStatus:{}},name2type:function(e){var t={tSina:1,qzone:2,tQQ:2,renren:3,weixin:12};return t[e]},addBind:function(t,n){n=n||e.noop;var r=this,i="gAddBindCallback",s=this.name2type(t);window.open("/passport/auth/"+s+"/authorize?bind=true&customerFunction="+i,"","height=560, width=760, left=400"),window[i]=function(e){n(e),window[i]=null;if(r._cacheData.bindStatus.data){var s=r._cacheData.bindStatus.data;for(var o=0,u=s.length;o<u;o++)if(s[o]==t)return;s.push(t)}else r._cacheData.bindStatus={data:[t],msg:"",success:!0}}},unBind:function(t,n,r){n=n||e.noop,r=r||e.noop;var i=this.name2type(t),s="/passport/auth/"+i+"/unbind";e.ajax({url:s,type:"get",cache:!1,dataType:"json",success:function(e){e.success?n(e):r(e)},error:function(){r({success:!1,msg:"网络异常"})}})},bindStatusAfter:function(e,t){var n=this.bindStatusList||[];for(var r=0;r<n.length;r++){var i=n[r];e?i.success(t):i.error(t)}},bindStatus:function(t,n){t=t||e.noop,n=n||e.noop;var r=this;if(this._cacheData&&this._cacheData.bindStatus&&!e.isEmptyObject(this._cacheData.bindStatus)){t(this._cacheData.bindStatus);return}this.bindStatusList||(this.bindStatusList=[]),this.bindStatusList.push({success:t,error:n});if(this._doAjax)return;this._doAjax=!0,e.ajax({url:"/passport/auth/bindStatus",type:"get",cache:!1,dataType:"json",success:function(e){e.success?(r._cacheData.bindStatus=e,r.bindStatusAfter(!0,e)):r.bindStatusAfter(!1,e),r.doAjax=!1},error:function(){r.bindStatusAfter(!1,{success:!1}),r.doAjax=!1}})},syncStatus:function(t,n,r){n=n||e.noop,r=r||e.noop;var i=this.getSyncStatus();if(i&&i[t]){n(i[t]);return}var s=this;e.ajax({url:"/passport/new_sync/get",data:{type:t},cache:!1,dataType:"json",success:function(e){e.success?(i[t]=e,n(e)):(i[t]={},r(e))},error:function(){r({success:!1})}})},setSync:function(t,n,r,i){i=i||e.noop;var s=this.name2type(t),o="/passport/sync/"+s+"/set",u=this.getSyncStatus(r);e.ajax({url:o,type:"get",dataType:"json",cache:!1,data:{isChecked:n,type:r,thirdpartyName:t},success:function(e){e&&e.success&&i(e)}});var a=u.data;for(var f=0,l=a.length;f<l;f++)if(a[f].name==t){a[f].isChecked=n,r||(a[f].isChecked=!0);return}},getSyncStatus:function(e){return e?this._cacheData.syncStatus[e]:this._cacheData.syncStatus}});return r}),define("module/dialogs/sync",["jquery","plugin/dialog"],function(e,t){var n={open:function(t){this.options=e.extend({noCheckBox:!1,syncFn:e.noop,unSyncFn:e.noop,text:"温馨提示：您的评论将会被自动同步到微博、腾讯?"},t),this.createPop()},createPop:function(){var e=this.options,n=!1,r='<div class="msg_title">'+e.text+"</div>"+'<div class="operate"><a href="javascript:;" class="confirmBtn" dialog-role="yes">同步</a>'+'<a href="javascript:;" class="cancelBtn" dialog-role="cancel">不同步</a></div>'+'<div class="msg_noprompt"><input type="checkbox"><label>下次不再提示</label></div>',i={dialogClass:"msg msg_sync",close:!1,content:r,onYes:function(){e.syncFn(n)},onCancel:function(){e.unSyncFn(n)}},s=new t.Dialog(i);s.open();var o=s.getEl();o.find("input[type=checkbox]").on("click",function(){n=!!this.checked}),e.noCheckBox&&o.find(".msg_noprompt").hide()}};return n}),define("module/share",["jquery","backbone","helper","model/thirdpart","plugin/dialog","module/dialogs/sync"],function(e,t,n,r,i,s){var o=new r,u=t.View.extend({model:o,initialize:function(t){this.options=e.extend({$el:"",bindedClass:"",checkedClass:"on",checkedSuccess:e.noop},t);var r=t.$el,i=this;this.$el=r,this.type=this.$el.find("[data-name][data-type]").attr("data-type"),n.isLogin()&&this.getBind(function(){i.getChecked()}),this.bindEvents()},getBind:function(t){t=t||e.noop;var n=this;this.model.bindStatus(function(e){n.getBindCallback(e),t(e)},function(e){t(e)})},getBindCallback:function(e){var t=e.data;for(var n=0;n<t.length;n++){var r=t[n],i=this.$el.find("[data-name="+r+"]");i.attr("data-bind",1),i.addClass(this.options.bindedClass),r=="qzone"&&(i=this.$el.find("[data-name=tQQ]"),i.attr("data-bind",1),i.addClass(this.options.bindedClass))}},getChecked:function(t){t=t||e.noop;var n=this;this.model.syncStatus(this.type,function(e){n.getCheckedCallback(e),t(e)},function(e){t(e)})},getCheckedCallback:function(e){var t=e.data,n=this.type,r=this.options.checkedClass;for(var i=0;i<t.length;i++){var s=t[i].name,o=t[i].isChecked,u=this.$el.find("[data-name="+s+"][data-type="+n+"]");if(u.attr("data-bind")!=1)continue;o?u.attr("data-share",1).addClass(r):u.attr("data-share",0).removeClass(r)}this.options.checkedSuccess()},setChecked:function(e,t,n,r){var i=this;this.model.setSync(e,t,n,function(){r(),i.options.checkedSuccess()})},addBind:function(t){if(!t)return;var n=!1;t=="tQQ"&&(t="qzone",n=!0);var r=this;this.model.addBind(t,function(){e("[data-name="+t+"]").attr({"data-bind":1},{"data-share":1}).addClass(r.options.checkedClass),n&&e("[data-name=tQQ]").attr({"data-bind":1},{"data-share":1}).addClass(r.options.checkedClass)})},unBind:function(e){var t=this,n={tSina:"新浪微博",qzone:"QQ",renren:"人人网"};i.confirm("是否要解除绑定,解绑后不能再用该"+n[e]+"帐号登录？",{callback:function(){t.model.unBind(e,function(e){callback(e)},function(e){i.alert(e.msg)})}})},bindEvents:function(){var t=this;this.$el.on("click","[data-name][data-type]",function(){var r=e(this),i=r.attr("data-name"),s=r.attr("data-type");if(!n.isLogin()){var o=t.model.name2type(i);n.login(o,!0);return}return r.attr("data-bind")!=1?t.addBind(i):r.attr("data-share")!=1?t.setChecked(i,!0,s,function(){e("[data-name="+i+"][data-type="+s+"]").attr("data-share",1).addClass(t.options.checkedClass)}):t.setChecked(i,!1,s,function(){e("[data-name="+i+"][data-type="+s+"]").attr("data-share",0).removeClass(t.options.checkedClass)}),!1})},getShareData:function(t){var n=this,r=[],i=!1;t=t||e.noop;var o=this.$el.find("[data-share=1]"),u=o.eq(0);if(u.size()==0){t({sharing_to:[]});return}var a=u.attr("data-type"),f=u.attr("data-name"),l=n.model.getSyncStatus(a);o.each(function(){var t=e(this),n=t.attr("data-name");r.push(n)});var c={tSina:"新浪微博",qzone:"腾讯微博",renren:"人人网"},h="温馨提示:您的评论将会被自动同步到微博、腾讯或人人网?",p=!1,d=!1;(a=="comment"||a=="relay")&&l.isCommentAlert&&(a=="relay"&&(h="温馨提示:您的转采将会被自动同步到微博、腾讯或人人网?"),p=!0),a=="favorite"&&l.isFavoriteAlert&&(d=!0,p=!0,h="赞了就分享一下吧，点击同步，这条消息会被同步到"+c[f]+"，您可以在个人设置中设置同步开关哟。"),p?s.open({noCheckBox:d,syncFn:function(e){if(a=="comment"||a=="relay")l.isCommentAlert=!e,t({no_more_alert:e,sharing_to:r});a=="favorite"&&(l.isFavoriteAlert=!1,t({no_more_alert:!0,sharing_to:r}))},unSyncFn:function(r){if(a=="comment"||a=="relay")l.isCommentAlert=!r,t({no_more_alert:r,sharing_to:[]});a=="favorite"&&(l.isFavoriteAlert=!1,t({no_more_alert:!0,sharing_to:[]}));if(l.data)for(var i=0;i<l.data.length;i++)l.data[i].name==f&&(l.data[i].isChecked=!1);e("[data-name][data-type="+a+"]").attr("data-share",0).removeClass(n.options.checkedClass)},text:h}):t({sharing_to:r,no_more_alert:!0})},release:function(){var e=this.$el;e.off(),e.empty()}});return u}),define("model/feed_group",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({idAttribute:"id",defaults:{id:0,title:"",title1:"",uid:0,createdAt:"",isAutoDownload:!1,isPublic:!1,orderNum:0,updatedAt:"",followingGroupIds:[],isAutoPush:!1},parse:function(e){return e},createGroup:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_groups/create",type:"post",dataType:"json",data:{title:r.get("title")},success:function(e,r,i){r.id?(e.set("id",r.id),t(e,r,i)):n(e,r,i)}})},deleteGroup:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_groups/"+r.get("id")+"/destroy",type:"post",dataType:"json",success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},editGroup:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_groups/"+r.get("id")+"/update",type:"post",dataType:"json",data:{title:r.get("title")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},followGroups:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/followings/set_groups",type:"post",dataType:"json",data:{following_uid:r.get("uid"),following_group_ids:r.get("followingGroupIds"),is_auto_push:r.get("isAutoPush")},success:function(e,r,i){r.res?t(e,r,i):n(e,r,i)}})}});return r}),define("collection/feed_group",["jquery","underscore","backbone","model/feed_group"],function(e,t,n,r){var i=n.Collection.extend({model:r,fetch:function(e){e=e||{},t.extend(e,{url:"/following_groups"}),n.Collection.prototype.fetch.call(this,e)},parse:function(e){return t.map(e,function(e){var t={id:e.id,title:e.title,uid:e.uid,createdAt:e.created_at,isAutoDownload:e.is_auto_download,isPublic:e.is_public,orderNum:e.order_num,updatedAt:e.updated_at};return t})}});return i}),define("module/feed_group/group",["jquery","underscore","backbone","model/feed_group","collection/feed_group"],function(e,t,n,r,i){var s=n.View.extend({groups:null,initialize:function(){},getGroups:function(){var e=this;this.model.get("isLoad")?this.loadGroups():this.model.get("isLoadings")||(this.groups=new i,this.groups.on("reset",this.loadGroups,this),this.groups.fetch({success:function(){e.loadGroups()}}),this.model.set("isLoadings",!0))},onLoad:function(e,t,n){this.model.get("onLoadEvent")[e]={func:t,pointer:n}},onRemoveLoad:function(e){this.model.get("onLoadEvent")[e]=null,delete this.model.get("onLoadEvent")[e]},doAdd:function(e){var t=this;t.groups.add(e),t.callAdd(e,"add")},doRemove:function(e){this.groups.remove(e),this.callAdd(e,"remove")},doEdit:function(e){var t=this.groups._byId[e.get("id")];t&&this.callAdd(t,"edit")},callAdd:function(e,t){var n=this;for(var r in n.model.get("onAddEvent")){var i=n.model.get("onAddEvent")[r];i.func.call(i.pointer,e,t)}},callLoad:function(){var e=this;for(var t in e.model.get("onLoadEvent")){var n=e.model.get("onLoadEvent")[t];n.func.call(n.pointer,e.groups)}},onAdd:function(e,t,n){this.model.get("onAddEvent")[e]={func:t,pointer:n}},onRemoveAdd:function(e){this.model.get("onAddEvent")[e]=null,delete this.model.get("onAddEvent")[e]},loadGroups:function(){this.model.set("isLoad",!0),this.callLoad()}});return new s({model:new n.Model({isLoad:!1,isLoadings:!1,onAddEvent:{},onLoadEvent:{},onLoad:function(){}})})}),define("module/feed_group/groupview1",["jquery","underscore","backbone","model/feed_group","module/feed_group/group"],function(e,t,n,r,i){var s=['<label><input type="checkbox" <% if(checked){ %> checked <%}%> value="<%=id%>" class="checkbox">&nbsp;<%=title%></label>',"<% if(id==-1){%> ",'<div class="listenhelp">','	<a class="grouphelp"></a>','	<div class="grouphelp_txt">',"		把最想听的加入必听组，可以在手机客户端实时收到更新通知哦！",'		<span class="arrow_grouphelp"><i></i></span>',"	</div>","</div>","<%}%>",""].join(""),o=n.View.extend({template:t.template(s),tagName:"span",render:function(){var e=this;return e.$el.html(e.template(e.model.toJSON())),this.undelegateEvents(),this.delegateEvents(this.events),e.$el}});return o}),define("module/feed_group/followmanager",["jquery","underscore","backbone","module/feed_group/groupview1","module/feed_group/group","model/feed_group","plugin/dialog"],function(e,t,n,r,i,s,o){var u=['	<div class="grouping_title">','		<div class="fl">为<span></span>设置分组</div>','		<div class="fr"><a>为什么要设置分组</a>','           <div class="grouphelp_txt">',"				将关注的账号加入分组，可以帮助你更有效率地浏览关注的声音流和新鲜事。",'				<span class="arrow_group"><i></i></span>',"			</div>","       </div>","	</div>",'	<ul class="grouping_list">',"		<li>","		</li>","		<li><span>",'				<div class="groupcreate">','					<a href="javascript:;" class="group_add">+创建新分组</a>','					<div class="edit"><input type="text" maxlength="8"  /><a class="editConfirm">确认</a><a class="cancel">取消</a></div>',"				</div>","			</span></li>","	</ul>",'	<div class="grouping_btm">','		<div class="addgroupdtl">','			<div class="addgroupdtl_r">','				<a href="javascript:;" class="saveBtn" dialog-role="yes">保存</a>','				<a href="javascript:;" class="removeBtn" dialog-role="close">取消</a>',"			</div>","		</div>","	</div>"].join(""),a=n.View.extend({template:t.template(u),events:{"click .group_add":"doAddGroup","click .cancel":"doAddGroup","click .editConfirm":"doSaveGroup"},groups:[],doAddGroup:function(t){var n=e(t.currentTarget);n.closest(".groupcreate").toggleClass("is-group-create")},doSaveGroup:function(e){var t=this.$(".groupcreate input"),n=t.val(),r=this,u;n&&(u=new s({title:n}),u.createGroup(function(n,s){i.doAdd(n),r.doAddGroup(e),t.val("")},function(e,t){o.alert(t.msg)}))},initialize:function(){this.render()},render:function(){var e=this;e.$el.html(e.template()),i.onLoad("followmanager",function(t){t.unshift({id:-1,title:"必听组"}),e.$el.find("ul.grouping_list li:eq(0)").empty(),t.each(e.doAddGroupView,e),t.remove(-1)},e),i.onAdd("followmanager",function(t,n){n=="add"&&e.doAddGroupView.call(e,t)},e)},doAddGroupView:function(t){t.set("checked",e.inArray(t.get("id")+"",this.groups)!=-1),this.$el.find("ul.grouping_list li:eq(0)").append((new r({model:t})).render())},show:function(t){var n=this,r=e.extend({id:"dialog_aftattention",dialogClass:"aftattention",header:"关注成功",content:n.$el,onYes:function(){var r,i=this.getEl(),u=!1,a=i.find("input[type='checkbox']:checked"),f=a.map(function(){var t=e(this).val();return u||(u=t==-1),t}).get();return r=new s({uid:t.uid,followingGroupIds:f,isAutoPush:u}),r.followGroups(function(){n.$(".removeBtn").click();var t=e(".setGroups");if(t.size()){var r=e.extend({},e.parser.parseOptions(t[0],[{uid:"number",sids:"string",nickname:"string"}]));r.sids=f.join(","),helper.doChangeOptions(t,r)}setTimeout(function(){o.success("分组成功",{})},300)},function(e,t){o.alert(t.error)}),!1}},{}),u=new o.Dialog(r);u.open(),n.$(".grouping_title .fl span").text(t.nickname),t&&t.sids?n.groups=t.sids.split(","):n.groups.length=0,i.getGroups(),n.undelegateEvents(),n.delegateEvents(n.events)}});return new a({model:new n.Model})}),define("module/user",["jquery","underscore","backbone","helper","json2","model/user","model/cache_part"],function(e,t,n,r,i,s,o){function u(){var e="/main/get_relation_with_users";this.users={},this.cachePart=new o(e,s,this.parseModelFn)}return u.prototype.parseModelFn=function(e){var t=e.toJSON(),n={id:t.id};return t.hasOwnProperty("isNotFollowing")&&(n.is_follow=!t.isNotFollowing),t.hasOwnProperty("beFollowed")&&(n.be_followed=t.beFollowed),n},u.prototype.render=function(n){if(!r.isLogin())return;var i=this,s=n||{},o=s.$container,u=s.fields||["is_follow","be_followed"],a,f=s.ids||[];this.clear(f),o?a=o.find("[user_id]"):a=e("[user_id]");for(var l=0,c=a.size();l<c;l++){var h=a.eq(l);if(!h.data("is_user_already_render")){var p=h.attr("user_id");f.push(p)}}f=t.uniq(f),this.cachePart.query(f,u,function(e){i._render(e)})},u.prototype.clear=function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=e("[user_id="+i+"]");s.data("is_user_already_render",!1)}},u.prototype._render=function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=e("[user_id="+i.id+"]");this._renderUsers(s)}},u.prototype._renderUsers=function(e){var t=this;e.each(function(n){var r=e.eq(n);r.data("is_user_already_render")||(r.data("is_user_already_render",!0),t._renderUser(r))})},u.prototype._renderUser=function(e){this.renderFollow(e),this.renderBlacklist(e)},u.prototype.renderBlacklist=function(t){var n=t.find(".blacklistBtn");if(n.size()){var i=t.attr("user_id"),s=this.cachePart.get(i),o=e.extend({},e.parser.parseOptions(n,[{uid:"number",nickname:"string",isBlack:"boolean"}]));o.isBlack=s.is_black,o.uid=s.id,s.is_black?n.text("解除黑名单"):n.text("加入黑名单"),r.doChangeOptions(n,o)}},u.prototype.renderFollow=function(t){var n=t.find(".followBtn[data-options],.addBtn[data-options],.addBtn2[data-options],.addBtn3[data-options]");if(n.size()){var i=t.attr("user_id"),s=this.cachePart.get(i),o=e.extend({},e.parser.parseOptions(n,[{uid:"number",is_follow:"boolean",be_followed:"boolean"}]));o.is_follow=s.is_follow,o.be_followed=s.be_followed,o.uid=s.id,s.is_follow?(n.addClass("already"),s.be_followed?(n.addClass("both"),n.children("span.default").html("相互关注")):(n.removeClass("both"),n.children("span.default").html("已关注"))):n.removeClass("already"),r.doChangeOptions(n,o)}},u.prototype.cacheUser=function(e){this.cachePart.set(e)},new u}),define("plugin/jquery.parser",["jquery"],function(e){(function(e){e.parser={auto:!0,onComplete:function(e){},plugins:["timeline","eyscroll","combobox"],parse:function(t){var n=[];for(var r=0;r<e.parser.plugins.length;r++){var i=e.parser.plugins[r],s=e(".easyui-"+i,t);s.length&&(s[i]?s[i]():n.push({name:i,jq:s}))}if(n.length&&window.easyloader){var o=[];for(var r=0;r<n.length;r++)o.push(n[r].name);easyloader.load(o,function(){for(var r=0;r<n.length;r++){var i=n[r].name,s=n[r].jq;s[i]()}e.parser.onComplete.call(e.parser,t)})}else e.parser.onComplete.call(e.parser,t)},parseOptions:function(t,n){var r=e(t),i={},s=e.trim(r.attr("data-options"));if(s){var o=s.substring(0,1),u=s.substring(s.length-1,s.length);o!="{"&&(s="{"+s),u!="}"&&(s+="}"),i=(new Function("return "+s))()}if(n){var a={};for(var f=0;f<n.length;f++){var l=n[f];if(typeof l=="string")l=="width"||l=="height"||l=="left"||l=="top"?a[l]=parseInt(t.style[l])||undefined:a[l]=r.attr(l);else for(var c in l){var h=l[c];h=="boolean"?a[c]=r.attr(c)?r.attr(c)=="true":undefined:h=="number"&&(a[c]=r.attr(c)=="0"?0:parseFloat(r.attr(c))||undefined)}}e.extend(i,a)}return i}},e(function(){!window.easyloader&&e.parser.auto&&e.parser.parse()}),e.fn._outerWidth=function(t){return this.each(function(){!e.boxModel&&e.browser.msie?e(this).width(t):e(this).width(t-(e(this).outerWidth()-e(this).width()))})},e.fn._outerHeight=function(t){return this.each(function(){!e.boxModel&&e.browser.msie?e(this).height(t):e(this).height(t-(e(this).outerHeight()-e(this).height()))})}})(e)}),define("module/common/ifollow",["jquery","underscore","backbone","json2","model/user","module/feed_group/followmanager","plugin/dialog","module/user","router","plugin/jquery.parser"],function(e,t,n,r,i,s,o,u,a){var f={follow:"关注",follow_loading:"关注中",already_follow:"已关注",already_follow_loading:"取消中",follow_eachother:"相互关注"},l=n.View.extend({init:function(){this.release(),e(".followBtn[data-options]").on("click",[this],this.doFollow),e(".addBtn[data-options],.addBtn2[data-options], .addBtn3[data-options]").on("click",[this],this.doFollow),e(".personal_operate[data-options]").on("click",[this],this.doRemoveFans),e(".j-follow").on("click",[this],this.doFollow2)},doBindOne:function(t){t.append('<span class="hover" style="display:none;">取消关注</span>'),t.on({mouseover:function(){var t=e(this).find("span.default"),n=e(this).find("span.hover"),i=r.parse(e(this).attr("data-options"));i.is_follow&&(t.hide(),n.show())},mouseleave:function(){var t=e(this).find("span.default"),n=e(this).find("span.hover");t.show(),n.hide()}}),t.on("click",[this],this.doFollow)},toBind:function(e){e.on("click",[this],this.doFollow2)},doRemoveFans:function(t){var n=e(this),r=e.extend({},e.parser.parseOptions(this,[{uid:"number"}])),i=t.data[0];i.model&&r.uid&&r.lock!==!0&&(r.lock=!0,helper.doChangeOptions(n,r),i.model.set("id",r.uid),i.model.doRemoveFans(function(e,t,i){n.closest(".item").fadeOut(),r.lock=undefined,helper.doChangeOptions(n,r)},function(e,t,i){r.lock=undefined,helper.doChangeOptions(n,r)}))},doFollow:function(t){console.log(t);if(!helper.isLogin())return;var n=e(this),r=n.find("i"),i=e.extend({},e.parser.parseOptions(this,[{uid:"number",is_follow:"boolean",be_followed:"boolean",remove:"string",show:"string",remove_state:"boolean",is_from_cache:"boolean"}])),s=t.data[0];if(s.model&&i.uid&&i.lock!==!0){var a=n.find("span.default");i.lock=!0,helper.doChangeOptions(n,i),i.is_follow=!i.is_follow,s.model.set("id",i.uid),s.model.set("isNotFollowing",i.is_follow),i.is_follow?(n.addClass("loading").attr("otext",a.text()),a.text(f.follow_loading)):(n.addClass("canceling").attr("otext",a.text()),a.text(f.already_follow_loading),n.removeClass("both")),s.model.doFollow(function(t,l,c){i.lock=undefined,l.res.be_followed&&(i.be_followed=l.res.be_followed),helper.doChangeOptions(n,i),i.is_from_cache===!0&&s.model.query({success:function(e){e.set("isNotFollowing",!i.is_follow),e.set("beFollowed",i.be_followed)}}),u.cacheUser({id:t.get("id"),is_follow:i.is_follow,be_followed:i.be_followed});var h=e(".follows_count"),p=0;h.size()&&(p=e(h[0]).text()*1,i.is_follow?p++:p--,h.text(p)),i.is_follow?(e(".setGroups").show(),o.success("关注成功",{}),setTimeout(function(){n.trigger("blur")},60)):e(".setGroups").hide();if(i.remove&&i.remove_state===i.is_follow){var d=n.closest(i.remove);i.show&&d.siblings(i.show).fadeIn(),d.fadeOut(100,function(){d.remove()});return}i.is_follow?i.be_followed?(n.removeClass("loading").addClass("already").addClass("both").addClass("btn-gray"),r.addClass("icon-ic_mutual").removeClass("icon-ic_attention"),a.text(f.follow_eachother)):(n.removeClass("loading").addClass("already").addClass("btn-gray"),r.addClass("icon-ic_already").removeClass("icon-ic_attention"),a.text(f.already_follow)):(n.removeClass("canceling").removeClass("already").removeClass("btn-gray"),r.removeClass("icon-ic_already").addClass("icon-ic_attention"),i.be_followed&&n.removeClass("both"),a.text(f.follow)),e(".personPanelBar3List li[recommend_uid="+i.uid+"]").fadeOut()},function(e,t,r){i.lock=undefined,helper.doChangeOptions(n,i),n.removeClass("loading").removeClass("canceling"),a.text(n.attr("otext")),i.be_followed&&i.is_follow&&n.addClass("both"),t&&o.alert(t.msg)})}return!1},doFollow2:function(t){var n=e(this),r=e.extend({},e.parser.parseOptions(this,[{uid:"number",is_follow:"boolean",be_followed:"boolean",remove:"string",show:"string",remove_state:"boolean",is_from_cache:"boolean"}])),i=t.data[0];return i.model&&r.uid&&r.lock!==!0&&(r.lock=!0,helper.doChangeOptions(n,r),r.is_follow=!r.is_follow,i.model.set("id",r.uid),i.model.set("isNotFollowing",r.is_follow),n.addClass("is-loading"),i.model.doFollow(function(e,t,s){r.lock=undefined,n.removeClass("is-loading").addClass("already"),t.res.be_followed&&(r.be_followed=t.res.be_followed),helper.doChangeOptions(n,r),r.is_from_cache===!0&&i.model.query({success:function(e){e.set("isNotFollowing",!r.is_follow),e.set("beFollowed",r.be_followed)}}),u.cacheUser({id:e.get("id"),is_follow:r.is_follow,be_followed:r.be_followed});var a=n.closest(".info").find(".j-fans"),f=0;a.size()&&(f=a.text()*1,r.is_follow?f++:f--,a.html('<i class="icon5 icon5-fans"></i>'+f)),r.is_follow?(o.success("关注成功",{}),setTimeout(function(){n.trigger("blur")},60)):n.removeClass("already"),helper.doChangeOptions(n,r)},function(e,t,i){r.lock=undefined,r.is_follow=!r.is_follow,helper.doChangeOptions(n,r),n.removeClass("is-loading"),t&&o.alert(t.msg)})),!1},release:function(){e(".followBtn[data-options]").off("click"),e(".addBtn[data-options],.addBtn2[data-options]").off("click"),e(".personal_operate[data-options]").off("click")}});return new l({model:new i})}),define("model/letter",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{id:0,nickname:"",content:"",ids:[],pass:0},add:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/create_letter",type:"post",dataType:"json",data:{to_nickname:r.get("nickname"),content:r.get("content")},success:function(e,r,i){r.res!==!1?t(e,r,i):n(e,r,i)},error:function(e,t,r){n(e,null,r)}})},del:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/destroy_letter",type:"post",dataType:"json",data:{id:r.get("id")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},delAll:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/destroy_letter_with_uid",type:"post",dataType:"json",data:{uid:r.get("id")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},delArray:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/batch_destroy_letter",type:"post",dataType:"json",validate:!1,data:{ids:r.get("ids")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},validate:function(e,t){if(!e.nickname)return"收件人不能为空";if(!e.content)return"发送消息不能为空";if(e.pass)return"消息字数超出"}});return r}),define("model/search",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{scope:"",keywords:undefined,title:undefined},searchUrl:"/s/search/suggest",setSearchUrl:function(e){this.searchUrl=e},doSearch:function(t,n){t=t||e.noop,n=n||e.noop;var r=this.searchUrl,i=this.toJSON();e.ajax({url:r,type:"get",cache:!1,data:i,dataType:"json",success:function(e){t(e)},error:function(e){n(e)}})},doSearchUsers:function(t,n){t=t||e.noop,n=n||e.noop,e.ajax({url:"/quan_suggest?q="+this.get("keywords"),type:"get",success:function(e){t(e)},error:function(e){n(e)}})},doSearchAll:function(t,n){t=t||e.noop,n=n||e.noop;var r=this.searchUrl,i=this,s=this.toJSON();e.ajax({url:"/s/search/suggest",type:"get",cache:!1,data:{keywords:i.get("keywords"),scope:i.get("scope")},dataType:"json",success:function(e){t(e)},error:function(e){n(e)}})}});return r}),define("module/common/userview",["jquery","underscore","backbone"],function(e,t,n){var r=['<a class="attextbox_data" href="javascript:void(0);">',"	<span><%=title%></span>","</a>"].join(""),i=n.View.extend({template:t.template(r),tagName:"dl",className:"clearfix_after attextbox_data1",events:{click:"doClick"},doClick:function(){this.model.get("input")&&this.model.get("input").val(this.model.get("title"))},initialize:function(){this.model.on("change:checked",function(){this.render()},this),this.model.on("change:click",function(){this.$el.click()},this)},render:function(e){var t=this;return t.$el.attr("idx",e).html(t.template(t.model.toJSON())),this.model.get("checked")?t.$el.addClass("dropListselect"):t.$el.removeClass("dropListselect"),t.$el}});return i}),define("module/common/iletterbox",["jquery","underscore","backbone","json2","model/search","module/common/userview"],function(e,t,n,r,i,s){var o=['	<div class="selectItem">','   <div class="container"></div>    ',"	</div>"].join(""),u=n.View.extend({isChange:!0,index:0,className:"dropList",list:new n.Collection,template:t.template(o),initialize:function(){this.model.on("change:keywords",this.ChangeKeyword,this),this.render()},ChangeKeyword:function(){this.isChange=!0},doChangeIndex:function(e,t){var n=this,r=n.data.length;if(r)switch(e){case 13:t.val(n.list.models[n.index].get("title")),t.trigger("blur");break;case 40:n.list.models[n.index].set("checked",!1),n.index>=n.data.length-1?n.index=0:n.index++,n.list.models[n.index].set("checked",!0);break;case 38:n.list.models[n.index].set("checked",!1),n.index==0?n.index=n.data.length-1:n.index--,n.list.models[n.index].set("checked",!0)}return!1},bind:function(e){var t=this,n=e.val();t.isChange=!1,t.model.set("keywords",n),t.isChange?t.model.doSearchUsers(function(n){n&&n!=" "?n=n.split(","):n=[],t.data=n,t.doDealData(e)},function(e){}):t.data&&t.doDealData(e)},doDealData:function(e){if(!this.data)return;var t=this.data.length;this.list.reset();if(t){this.$(".container").empty();for(var n=0;n<t;n++){var r=new i({title:this.data[n],checked:n==0,input:e}),o=new s({model:r});this.list.add(r),this.$(".selectItem .container").append(o.render())}this.index=0}else this.$(".selectItem .container").html("没有匹配的用户");e.after(this.$el.show())},render:function(){this.$el.html(this.template())},release:function(){e.attextbox("destroy",!0)}});return new u({model:new i})}),define("plugin/count_char",["jquery"],function(e){function i(i,o,u,a){a=e.extend({},n,a),a.maxLength=u?u:a.maxLength;var f=e(o),l=e(i);s(l,f,a),l.bind("keydown keyup focus change input blur",function(e){r&&clearTimeout(r),r=setTimeout(function(){t(e.type),s(l,f,a)},100)}).bind("paste cut",function(){window.clipboardData&&setTimeout(function(){l.change()},0)})}function s(t,n,r){var i=0;if(t.attr("placeholder")!=t.val()||!t.hasClass("placeholder")){var s=/[\u0391-\uFFE5]/g,o=t.val().replace(s,"aa");o=e.trim(o),i=Math.ceil(o.length/2)}var u="";i<=r.maxLength?(u=r.text.replace(/\{count\}/,function(){return Math.abs(r.maxLength-i)}),n.addClass(r.textCss).removeClass(r.passTextCss),t.removeAttr("pass"),t.trigger("count_ok")):(u=r.passText.replace(/\{count\}/,function(){return Math.abs(i-r.maxLength)}),n.addClass(r.passTextCss),t.attr("pass",Math.abs(i-r.maxLength)),t.trigger("count_pass")),n.html(u)}var t=function(e){return},n={maxLength:140,text:"您还可以输入<span>{count}</span>字",passText:"已超出<span>{count}</span>字",textCss:"count-tip",passTextCss:"pass-count-tip"},r=0;return i}),define("plugin/twemoji/twemoji",[],function(){var e=function(){function o(e){return document.createTextNode(e)}function u(e){return e.replace(r,p)}function a(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function f(e,t){var n=e.childNodes,r=n.length,s,o;while(r--)s=n[r],o=s.nodeType,o===3?t.push(s):o===1&&!i.test(s.nodeName)&&f(s,t);return t}function l(e,t){return w(t==="️"?e.slice(0,-1):e.length===3&&e.charAt(1)==="️"?e.charAt(0)+e.charAt(2):e)}function c(t,r){var i=f(t,[]),s=i.length,u,a,c,h,p,d,v,m,g,y,b,w,E,S;while(s--){c=!1,h=document.createDocumentFragment(),p=i[s],d=p.nodeValue,m=0;while(v=n.exec(d)){g=v.index,g!==m&&h.appendChild(o(d.slice(m,g))),b=v[0],w=v[1],E=v[2],m=g+b.length;if(E!=="︎"){S=r.callback(l(w,E),r,E);if(S){y=new Image,y.onerror=e.onerror,y.setAttribute("draggable","false"),u=r.attributes(w,E);for(a in u)u.hasOwnProperty(a)&&a.indexOf("on")!==0&&!y.hasAttribute(a)&&y.setAttribute(a,u[a]);y.className=r.className,y.alt=b,y.src=S,c=!0,h.appendChild(y)}}y||h.appendChild(o(b)),y=null}c&&(m<d.length&&h.appendChild(o(d.slice(m))),p.parentNode.replaceChild(h,p))}return t}function h(e,t){return y(e,function(e,n,r){var i=e,s,o,a;if(r!=="︎"){a=t.callback(l(n,r),t,r);if(a){i="<img ".concat('class="',t.className,'" ','draggable="false" ','alt="',e,'"',' src="',a,'"'),s=t.attributes(n,r);for(o in s)s.hasOwnProperty(o)&&o.indexOf("on")!==0&&i.indexOf(" "+o+"=")===-1&&(i=i.concat(" ",o,'="',u(s[o]),'"'));i=i.concat(">")}}return i})}function p(e){return t[e]}function d(){return null}function v(e){return typeof e=="number"?e+"x"+e:e}function m(e){var t=typeof e=="string"?parseInt(e,16):e;return t<65536?s(t):(t-=65536,s(55296+(t>>10),56320+(t&1023)))}function g(t,n){if(!n||typeof n=="function")n={callback:n};return(typeof t=="string"?h:c)(t,{callback:n.callback||a,attributes:typeof n.attributes=="function"?n.attributes:d,base:typeof n.base=="string"?n.base:e.base,ext:n.ext||e.ext,size:n.folder||v(n.size||e.size),className:n.className||e.className})}function y(e,t){return String(e).replace(n,t)}function b(e){n.lastIndex=0;var t=n.test(e);return n.lastIndex=0,t}function w(e,t){var n=[],r=0,i=0,s=0;while(s<e.length)r=e.charCodeAt(s++),i?(n.push((65536+(i-55296<<10)+(r-56320)).toString(16)),i=0):55296<=r&&r<=56319?i=r:n.push(r.toString(16));return n.join(t||"-")}var e={base:config.STATIC_PATH+"/js/plugin/twemoji/",ext:".png",size:"36x36",className:"emoji",convert:{fromCodePoint:m,toCodePoint:w},onerror:function(){this.parentNode&&this.parentNode.replaceChild(o(this.alt),this)},parse:g,replace:y,test:b},t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},n=/((?:\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddf0\ud83c\uddf7|\ud83c\uddef\ud83c\uddf5|\ud83c\uddee\ud83c\uddf9|\ud83c\uddec\ud83c\udde7|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\udde9\ud83c\uddea|\u0039\ufe0f?\u20e3|\u0038\ufe0f?\u20e3|\u0037\ufe0f?\u20e3|\u0036\ufe0f?\u20e3|\u0035\ufe0f?\u20e3|\u0034\ufe0f?\u20e3|\u0033\ufe0f?\u20e3|\u0032\ufe0f?\u20e3|\u0031\ufe0f?\u20e3|\u0030\ufe0f?\u20e3|\u0023\ufe0f?\u20e3|\ud83d\udeb3|\ud83d\udeb1|\ud83d\udeb0|\ud83d\udeaf|\ud83d\udeae|\ud83d\udea6|\ud83d\udea3|\ud83d\udea1|\ud83d\udea0|\ud83d\ude9f|\ud83d\ude9e|\ud83d\ude9d|\ud83d\ude9c|\ud83d\ude9b|\ud83d\ude98|\ud83d\ude96|\ud83d\ude94|\ud83d\ude90|\ud83d\ude8e|\ud83d\ude8d|\ud83d\ude8b|\ud83d\ude8a|\ud83d\ude88|\ud83d\ude86|\ud83d\ude82|\ud83d\ude81|\ud83d\ude36|\ud83d\ude34|\ud83d\ude2f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude27|\ud83d\ude26|\ud83d\ude1f|\ud83d\ude1b|\ud83d\ude19|\ud83d\ude17|\ud83d\ude15|\ud83d\ude11|\ud83d\ude10|\ud83d\ude0e|\ud83d\ude08|\ud83d\ude07|\ud83d\ude00|\ud83d\udd67|\ud83d\udd66|\ud83d\udd65|\ud83d\udd64|\ud83d\udd63|\ud83d\udd62|\ud83d\udd61|\ud83d\udd60|\ud83d\udd5f|\ud83d\udd5e|\ud83d\udd5d|\ud83d\udd5c|\ud83d\udd2d|\ud83d\udd2c|\ud83d\udd15|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd06|\ud83d\udd05|\ud83d\udd04|\ud83d\udd02|\ud83d\udd01|\ud83d\udd00|\ud83d\udcf5|\ud83d\udcef|\ud83d\udced|\ud83d\udcec|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcad|\ud83d\udc6d|\ud83d\udc6c|\ud83d\udc65|\ud83d\udc2a|\ud83d\udc16|\ud83d\udc15|\ud83d\udc13|\ud83d\udc10|\ud83d\udc0f|\ud83d\udc0b|\ud83d\udc0a|\ud83d\udc09|\ud83d\udc08|\ud83d\udc07|\ud83d\udc06|\ud83d\udc05|\ud83d\udc04|\ud83d\udc03|\ud83d\udc02|\ud83d\udc01|\ud83d\udc00|\ud83c\udfe4|\ud83c\udfc9|\ud83c\udfc7|\ud83c\udf7c|\ud83c\udf50|\ud83c\udf4b|\ud83c\udf33|\ud83c\udf32|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1c|\ud83c\udf1a|\ud83c\udf18|\ud83c\udccf|\ud83c\udd70|\ud83c\udd71|\ud83c\udd7e|\ud83c\udd8e|\ud83c\udd91|\ud83c\udd92|\ud83c\udd93|\ud83c\udd94|\ud83c\udd95|\ud83c\udd96|\ud83c\udd97|\ud83c\udd98|\ud83c\udd99|\ud83c\udd9a|\ud83d\udc77|\ud83d\udec5|\ud83d\udec4|\ud83d\udec3|\ud83d\udec2|\ud83d\udec1|\ud83d\udebf|\ud83d\udeb8|\ud83d\udeb7|\ud83d\udeb5|\ud83c\ude01|\ud83c\ude02|\ud83c\ude32|\ud83c\ude33|\ud83c\ude34|\ud83c\ude35|\ud83c\ude36|\ud83c\ude37|\ud83c\ude38|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude50|\ud83c\ude51|\ud83c\udf00|\ud83c\udf01|\ud83c\udf02|\ud83c\udf03|\ud83c\udf04|\ud83c\udf05|\ud83c\udf06|\ud83c\udf07|\ud83c\udf08|\ud83c\udf09|\ud83c\udf0a|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf0f|\ud83c\udf11|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf19|\ud83c\udf1b|\ud83c\udf1f|\ud83c\udf20|\ud83c\udf30|\ud83c\udf31|\ud83c\udf34|\ud83c\udf35|\ud83c\udf37|\ud83c\udf38|\ud83c\udf39|\ud83c\udf3a|\ud83c\udf3b|\ud83c\udf3c|\ud83c\udf3d|\ud83c\udf3e|\ud83c\udf3f|\ud83c\udf40|\ud83c\udf41|\ud83c\udf42|\ud83c\udf43|\ud83c\udf44|\ud83c\udf45|\ud83c\udf46|\ud83c\udf47|\ud83c\udf48|\ud83c\udf49|\ud83c\udf4a|\ud83c\udf4c|\ud83c\udf4d|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf51|\ud83c\udf52|\ud83c\udf53|\ud83c\udf54|\ud83c\udf55|\ud83c\udf56|\ud83c\udf57|\ud83c\udf58|\ud83c\udf59|\ud83c\udf5a|\ud83c\udf5b|\ud83c\udf5c|\ud83c\udf5d|\ud83c\udf5e|\ud83c\udf5f|\ud83c\udf60|\ud83c\udf61|\ud83c\udf62|\ud83c\udf63|\ud83c\udf64|\ud83c\udf65|\ud83c\udf66|\ud83c\udf67|\ud83c\udf68|\ud83c\udf69|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6e|\ud83c\udf6f|\ud83c\udf70|\ud83c\udf71|\ud83c\udf72|\ud83c\udf73|\ud83c\udf74|\ud83c\udf75|\ud83c\udf76|\ud83c\udf77|\ud83c\udf78|\ud83c\udf79|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf80|\ud83c\udf81|\ud83c\udf82|\ud83c\udf83|\ud83c\udf84|\ud83c\udf85|\ud83c\udf86|\ud83c\udf87|\ud83c\udf88|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf8b|\ud83c\udf8c|\ud83c\udf8d|\ud83c\udf8e|\ud83c\udf8f|\ud83c\udf90|\ud83c\udf91|\ud83c\udf92|\ud83c\udf93|\ud83c\udfa0|\ud83c\udfa1|\ud83c\udfa2|\ud83c\udfa3|\ud83c\udfa4|\ud83c\udfa5|\ud83c\udfa6|\ud83c\udfa7|\ud83c\udfa8|\ud83c\udfa9|\ud83c\udfaa|\ud83c\udfab|\ud83c\udfac|\ud83c\udfad|\ud83c\udfae|\ud83c\udfaf|\ud83c\udfb0|\ud83c\udfb1|\ud83c\udfb2|\ud83c\udfb3|\ud83c\udfb4|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb7|\ud83c\udfb8|\ud83c\udfb9|\ud83c\udfba|\ud83c\udfbb|\ud83c\udfbc|\ud83c\udfbd|\ud83c\udfbe|\ud83c\udfbf|\ud83c\udfc0|\ud83c\udfc1|\ud83c\udfc2|\ud83c\udfc3|\ud83c\udfc4|\ud83c\udfc6|\ud83c\udfc8|\ud83c\udfca|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfe7|\ud83c\udfe8|\ud83c\udfe9|\ud83c\udfea|\ud83c\udfeb|\ud83c\udfec|\ud83c\udfed|\ud83c\udfee|\ud83c\udfef|\ud83c\udff0|\ud83d\udc0c|\ud83d\udc0d|\ud83d\udc0e|\ud83d\udc11|\ud83d\udc12|\ud83d\udc14|\ud83d\udc17|\ud83d\udc18|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc1b|\ud83d\udc1c|\ud83d\udc1d|\ud83d\udc1e|\ud83d\udc1f|\ud83d\udc20|\ud83d\udc21|\ud83d\udc22|\ud83d\udc23|\ud83d\udc24|\ud83d\udc25|\ud83d\udc26|\ud83d\udc27|\ud83d\udc28|\ud83d\udc29|\ud83d\udc2b|\ud83d\udc2c|\ud83d\udc2d|\ud83d\udc2e|\ud83d\udc2f|\ud83d\udc30|\ud83d\udc31|\ud83d\udc32|\ud83d\udc33|\ud83d\udc34|\ud83d\udc35|\ud83d\udc36|\ud83d\udc37|\ud83d\udc38|\ud83d\udc39|\ud83d\udc3a|\ud83d\udc3b|\ud83d\udc3c|\ud83d\udc3d|\ud83d\udc3e|\ud83d\udc40|\ud83d\udc42|\ud83d\udc43|\ud83d\udc44|\ud83d\udc45|\ud83d\udc46|\ud83d\udc47|\ud83d\udc48|\ud83d\udc49|\ud83d\udc4a|\ud83d\udc4b|\ud83d\udc4c|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4f|\ud83d\udc50|\ud83d\udc51|\ud83d\udc52|\ud83d\udc53|\ud83d\udc54|\ud83d\udc55|\ud83d\udc56|\ud83d\udc57|\ud83d\udc58|\ud83d\udc59|\ud83d\udc5a|\ud83d\udc5b|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5e|\ud83d\udc5f|\ud83d\udc60|\ud83d\udc61|\ud83d\udc62|\ud83d\udc63|\ud83d\udc64|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc6a|\ud83d\udc6b|\ud83d\udc6e|\ud83d\udc6f|\ud83d\udc70|\ud83d\udc71|\ud83d\udc72|\ud83d\udc73|\ud83d\udc74|\ud83d\udc75|\ud83d\udc76|\ud83d\udeb4|\ud83d\udc78|\ud83d\udc79|\ud83d\udc7a|\ud83d\udc7b|\ud83d\udc7c|\ud83d\udc7d|\ud83d\udc7e|\ud83d\udc7f|\ud83d\udc80|\ud83d\udc81|\ud83d\udc82|\ud83d\udc83|\ud83d\udc84|\ud83d\udc85|\ud83d\udc86|\ud83d\udc87|\ud83d\udc88|\ud83d\udc89|\ud83d\udc8a|\ud83d\udc8b|\ud83d\udc8c|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc8f|\ud83d\udc90|\ud83d\udc91|\ud83d\udc92|\ud83d\udc93|\ud83d\udc94|\ud83d\udc95|\ud83d\udc96|\ud83d\udc97|\ud83d\udc98|\ud83d\udc99|\ud83d\udc9a|\ud83d\udc9b|\ud83d\udc9c|\ud83d\udc9d|\ud83d\udc9e|\ud83d\udc9f|\ud83d\udca0|\ud83d\udca1|\ud83d\udca2|\ud83d\udca3|\ud83d\udca4|\ud83d\udca5|\ud83d\udca6|\ud83d\udca7|\ud83d\udca8|\ud83d\udca9|\ud83d\udcaa|\ud83d\udcab|\ud83d\udcac|\ud83d\udcae|\ud83d\udcaf|\ud83d\udcb0|\ud83d\udcb1|\ud83d\udcb2|\ud83d\udcb3|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb8|\ud83d\udcb9|\ud83d\udcba|\ud83d\udcbb|\ud83d\udcbc|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcc1|\ud83d\udcc2|\ud83d\udcc3|\ud83d\udcc4|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcca|\ud83d\udccb|\ud83d\udccc|\ud83d\udccd|\ud83d\udcce|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd1|\ud83d\udcd2|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd5|\ud83d\udcd6|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcda|\ud83d\udcdb|\ud83d\udcdc|\ud83d\udcdd|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udce2|\ud83d\udce3|\ud83d\udce4|\ud83d\udce5|\ud83d\udce6|\ud83d\udce7|\ud83d\udce8|\ud83d\udce9|\ud83d\udcea|\ud83d\udceb|\ud83d\udcee|\ud83d\udcf0|\ud83d\udcf1|\ud83d\udcf2|\ud83d\udcf3|\ud83d\udcf4|\ud83d\udcf6|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udcfc|\ud83d\udd03|\ud83d\udd0a|\ud83d\udd0b|\ud83d\udd0c|\ud83d\udd0d|\ud83d\udd0e|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd12|\ud83d\udd13|\ud83d\udd14|\ud83d\udd16|\ud83d\udd17|\ud83d\udd18|\ud83d\udd19|\ud83d\udd1a|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd1d|\ud83d\udd1e|\ud83d\udd1f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd22|\ud83d\udd23|\ud83d\udd24|\ud83d\udd25|\ud83d\udd26|\ud83d\udd27|\ud83d\udd28|\ud83d\udd29|\ud83d\udd2a|\ud83d\udd2b|\ud83d\udd2e|\ud83d\udd2f|\ud83d\udd30|\ud83d\udd31|\ud83d\udd32|\ud83d\udd33|\ud83d\udd34|\ud83d\udd35|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39|\ud83d\udd3a|\ud83d\udd3b|\ud83d\udd3c|\ud83d\udd3d|\ud83d\udd50|\ud83d\udd51|\ud83d\udd52|\ud83d\udd53|\ud83d\udd54|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd5b|\ud83d\uddfb|\ud83d\uddfc|\ud83d\uddfd|\ud83d\uddfe|\ud83d\uddff|\ud83d\ude01|\ud83d\ude02|\ud83d\ude03|\ud83d\ude04|\ud83d\ude05|\ud83d\ude06|\ud83d\ude09|\ud83d\ude0a|\ud83d\ude0b|\ud83d\ude0c|\ud83d\ude0d|\ud83d\ude0f|\ud83d\ude12|\ud83d\ude13|\ud83d\ude14|\ud83d\ude16|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1e|\ud83d\ude20|\ud83d\ude21|\ud83d\ude22|\ud83d\ude23|\ud83d\ude24|\ud83d\ude25|\ud83d\ude28|\ud83d\ude29|\ud83d\ude2a|\ud83d\ude2b|\ud83d\ude2d|\ud83d\ude30|\ud83d\ude31|\ud83d\ude32|\ud83d\ude33|\ud83d\ude35|\ud83d\ude37|\ud83d\ude38|\ud83d\ude39|\ud83d\ude3a|\ud83d\ude3b|\ud83d\ude3c|\ud83d\ude3d|\ud83d\ude3e|\ud83d\ude3f|\ud83d\ude40|\ud83d\ude45|\ud83d\ude46|\ud83d\ude47|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\ude4b|\ud83d\ude4c|\ud83d\ude4d|\ud83d\ude4e|\ud83d\ude4f|\ud83d\ude80|\ud83d\ude83|\ud83d\ude84|\ud83d\ude85|\ud83d\ude87|\ud83d\ude89|\ud83d\ude8c|\ud83d\ude8f|\ud83d\ude91|\ud83d\ude92|\ud83d\ude93|\ud83d\ude95|\ud83d\ude97|\ud83d\ude99|\ud83d\ude9a|\ud83d\udea2|\ud83d\udea4|\ud83d\udea5|\ud83d\udea7|\ud83d\udea8|\ud83d\udea9|\ud83d\udeaa|\ud83d\udeab|\ud83d\udeac|\ud83d\udead|\ud83d\udeb2|\ud83d\udeb6|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebb|\ud83d\udebc|\ud83d\udebd|\ud83d\udebe|\ud83d\udec0|\ud83c\udde6|\ud83c\udde7|\ud83c\udde8|\ud83c\udde9|\ud83c\uddea|\ud83c\uddeb|\ud83c\uddec|\ud83c\udded|\ud83c\uddee|\ud83c\uddef|\ud83c\uddf0|\ud83c\uddf1|\ud83c\uddf2|\ud83c\uddf3|\ud83c\uddf4|\ud83c\uddf5|\ud83c\uddf6|\ud83c\uddf7|\ud83c\uddf8|\ud83c\uddf9|\ud83c\uddfa|\ud83c\uddfb|\ud83c\uddfc|\ud83c\uddfd|\ud83c\uddfe|\ud83c\uddff|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf10|\ud83c\udf12|\ud83c\udf16|\ud83c\udf17|\ue50a|\u3030|\u27b0|\u2797|\u2796|\u2795|\u2755|\u2754|\u2753|\u274e|\u274c|\u2728|\u270b|\u270a|\u2705|\u26ce|\u23f3|\u23f0|\u23ec|\u23eb|\u23ea|\u23e9|\u2122|\u27bf|\u00a9|\u00ae)|(?:(?:\ud83c\udc04|\ud83c\udd7f|\ud83c\ude1a|\ud83c\ude2f|\u3299|\u303d|\u2b55|\u2b50|\u2b1c|\u2b1b|\u2b07|\u2b06|\u2b05|\u2935|\u2934|\u27a1|\u2764|\u2757|\u2747|\u2744|\u2734|\u2733|\u2716|\u2714|\u2712|\u270f|\u270c|\u2709|\u2708|\u2702|\u26fd|\u26fa|\u26f5|\u26f3|\u26f2|\u26ea|\u26d4|\u26c5|\u26c4|\u26be|\u26bd|\u26ab|\u26aa|\u26a1|\u26a0|\u2693|\u267f|\u267b|\u3297|\u2666|\u2665|\u2663|\u2660|\u2653|\u2652|\u2651|\u2650|\u264f|\u264e|\u264d|\u264c|\u264b|\u264a|\u2649|\u2648|\u263a|\u261d|\u2615|\u2614|\u2611|\u260e|\u2601|\u2600|\u25fe|\u25fd|\u25fc|\u25fb|\u25c0|\u25b6|\u25ab|\u25aa|\u24c2|\u231b|\u231a|\u21aa|\u21a9|\u2199|\u2198|\u2197|\u2196|\u2195|\u2194|\u2139|\u2049|\u203c|\u2668)([\uFE0E\uFE0F]?)))/g,r=/[&<>'"]/g,i=/IFRAME|NOFRAMES|NOSCRIPT|SCRIPT|SELECT|STYLE|TEXTAREA|[a-z]/,s=String.fromCharCode;return e}();return e}),define("module/common/iletter",["jquery","underscore","backbone","model/letter","plugin/dialog","module/common/iletterbox","plugin/count_char","plugin/face","plugin/twemoji/twemoji","module/xchat/common","plugin/jquery.parser"],function(e,t,n,r,i,s,o,u,a,f){var l=['   <dl class="popup_dl">',"		<dt>发给</dt>",'		<dd><input type="text" value="<%=nickname%>" /></dd>',"	</dl>",'	<dl class="popup_dl">',"		<dt>内容</dt>","		<dd><textarea><%=content%></textarea></dd>","	</dl>",'	<div class="popup_btm">','		<div class="fr">','			<span class="charCount">还剩<em>300</em>字</span>','			<a class="faceBtn" href="javascript:;"></a>','			<a class="hidden" dialog-role="close" href="javascript:;"></a>','			<a class="submitBtn" href="javascript:;"><span>发送</span></a>',"		</div>","    </div>"].join(""),c=n.View.extend({template:t.template(l),initialize:function(){this.model.on("invalid",function(e,t){i.alert(t)}),this.render()},events:{"keyup input[type='text']":"doKeyPress","click input[type='text']":"doKeyPress","blur input[type='text']":"doBlur","click .submitBtn":"doSubmitLetter"},doBlur:function(){setTimeout(function(){s.$el.hide()},200)},doSubmitLetter:function(){var e=this,t=e.$(".popup_dl input").val(),n=e.$(".popup_dl textarea").val(),r=e.$(".popup_dl textarea").attr("pass"),s=e.$(".submitBtn");r||(r=0),e.model.set({nickname:t,content:n,pass:r});if(e.model.isValid()){e.undelegateEvents();var o=function(){e.$("[dialog-role='close']").click(),i.success("发送成功"),e.delegateEvents(e.events)},u=function(t,n){n&&i.alert(n.msg),s.html("<span>发送</span>"),e.delegateEvents(e.events)};s.html("<span>发送中...</span>"),f.isActived()?f.sendLetter(e.model,function(){o(arguments),f.loadPage(location.pathname,location.search.replace(/^\?/,""))},u):e.model.add(o,u)}},doKeyPress:function(t){var n=e(t.currentTarget);switch(t.keyCode){case 13:case 38:case 40:s.doChangeIndex(t.keyCode,n);break;default:s.bind(n)}return!1},init:function(){this.release(),e(".sendLetterBtn").on("click",[this],this.doSendLetter)},bind:function(e){if(e.data("js-bind-iletter"))return;e.data("js-bind-iletter",!0),e.on("click",[this],this.doSendLetter)},bindDel:function(e){e.on("click",[this],this.doDelLetter)},doSendLetter:function(t){if(!helper.isLogin())return;var n=t.data[0],r=e.extend({},e.parser.parseOptions(this,[{nickname:"string"}]));return n.model.set({nickname:"",content:"",pass:0},{silent:!0}),r.nickname&&n.model.set("nickname",r.nickname),n.render(),n.doShowDialog(),!1},doDelLetter:function(t){var n=e(this),r=t.data[0],s=e.extend({},e.parser.parseOptions(this,[{id:"number"}]));s.id&&s.lock!==!0&&(s.lock=!0,helper.doChangeOptions(n,s),r.model.set({id:s.id,nickname:"000",content:"000"},{silent:!0}),r.model.delAll(function(){s.lock=undefined,helper.doChangeOptions(n,s),n.closest(".msg_notice_item").slideUp()},function(e,t){s.lock=undefined,helper.doChangeOptions(n,s),i.alert(t.msg)}))},doShowDialog:function(){var t=this,n=e.extend({id:"dialog_letter",dialogClass:"letter",header:"发私信",content:t.$el,overlayer:{clickClose:!1},onYes:function(){return!0}},{}),r=new i.Dialog(n);r.open()},render:function(){this.$el.empty().html(a.parse(this.template(this.model.toJSON()))),o(this.$(".popup_dl textarea"),this.$(".charCount"),300,{text:"还剩<em>{count}</em>字",passText:"超出<em>{count}</em>字"}),u.init(this.$(".faceBtn"),this.$(".popup_dl textarea")),this.undelegateEvents(),this.delegateEvents(this.events)},release:function(){e(".sendLetterBtn").off("click"),this.$el.empty()}});return new c({model:new r})}),define("module/card",["jquery","underscore","backbone","model/user","module/common/ifollow","module/common/iletter"],function(e,t,n,r,i,s){var o={$pop:e('<div class="userCard" style="display:none;"></div>').appendTo("body"),init:function(){this.$pop.on({mouseenter:function(){var t=e(this);t.data("hideTimeoutId")&&clearTimeout(t.data("hideTimeoutId"))},mouseleave:function(){var t=e(this),n=setTimeout(function(){t.hide().html("")},100);t.data("hideTimeoutId",n)}})},render:function(t){var n=t||{},r=n.$container,i;r?i=r.find("[card]"):i=e("[card]");for(var s=0,o=i.length;s<o;s++){var u=i.eq(s);!u.data("cardEventBinded")&&u.attr("card")&&this.eventBind(u)}},eventBind:function(t){var n=this;t.data("cardEventBinded",!0),t.on({mouseenter:function(){n.onMouseenter(e(this))},mouseleave:function(){n.onMouseleave(e(this))},click:function(){e(this).mouseleave()}})},onMouseenter:function(n){if(helper.isWindowBusy())return;var o=this.$pop;o.data("hideTimeoutId")&&clearTimeout(o.data("hideTimeoutId"));var u=n.attr("card"),a=n.attr("card_type")||"",f=u.charAt(0)=="n",l=setTimeout(function(){var l=new r;f?l.set("nickname",u.substring(1)):l.set("id",u),l.query({success:function(r){var u="",f=r.toJSON();if(n.parents("body").size()===0)return;t.isEmpty(f)?(o.addClass("nobody"),u=t.template(['<div class="userCard">','<p class="desc">该昵称目前不存在哟╮(╯▽╰)╭</p>',"</div>",'<div class="arrow"><i></i></div>'].join(""))):(o.removeClass("nobody"),f.card_type=a,u=t.template(['<div class="userCard_info">','<div class="left">','<a class="userface" href="/zhubo/<%=id%>/" hashlink>',"<%if(avatarUrl60){%>",'<img alt="" src="<%=avatarUrl60%>">',"<%}%>","</a>","</div>",'<div class="right <%=(province||city)?"":"area-unexist"%>">','<a class="title" href="/zhubo/<%=id%>/" hashlink>',"<%=nickname%>","<%if (anchorGrade != -1){%>","<%if (verifyType==2){%>",'<i class="grade inl-b grade<%=anchorGrade%> on-blue" title="喜马拉雅认证播主">&nbsp;</i>',"<%}else{%>",'<i class="grade inl-b grade<%=anchorGrade%> on" title="喜马拉雅认证播主">&nbsp;</i>',"<%}%>","<%}%>","</a>",'<p class="area"><%=province%> <%=(province&&city)?"•":""%> <%=city%></p>','<div class="count">','<a class="count_sound" href="/<%=id%>/sound/" hashlink title="声音"><%= tracksCount%></a>','<a class="count_attention" href="/<%=id%>/follow/" hashlink title="关注"><%=followingsCount%></a>','<a class="count_fans" href="/<%=id%>/fans/" hashlink title="粉丝"><%=followersCount%></a>',"</div>","</div>","</div>",'<p class="userCard_intro">','<%=_.escape(isVerified?(ptitle||personalSignature||"这家伙很懒，什么都没留下"):(personalSignature||"这家伙很懒，什么都没留下"))%>',"</p>","<%if (!(config && config.CURRENT_USER && config.CURRENT_USER.uid == id)){%>",'<div class="userCard_operate">',"<% if(isNotFollowing){%>",'<a class="addBtn2 small j-follow" mustlogin data-options="uid:<%=id%>,is_follow:false,nickname:\'<%=nickname%>\',is_from_cache:true"><span class="default">关注</span><span class="hover">取消</span></a>',"<%}else{%>",'<a class="addBtn2 small already <%=beFollowed?"both":""%> j-follow" data-options="uid:<%=id%>,is_follow:true,nickname:\'<%=nickname%>\',is_from_cache:true" href="javascript:;"><span class="default"><%=beFollowed?"相互关注":"已关注"%></span><span class="hover">取消</span></a>',"<%}%>",'<a class="j-letter" mustlogin data-options="nickname:\'<%=nickname%>\'">发私信</a>',"</div>","<%}%>",'<span class="arrow_popup"><i></i></span>'].join("")));var l=30,c=10,h=10,p=10,d=n.width(),v=n.height(),m=n.offset().left,g=n.offset().top,y=0,b=0;o.html(u(f)).css({top:-1e3}).show(),i.doBindOne(o.find(".j-follow")),s.bind(o.find(".j-letter"));var w="",E=o.width(),S=o.height()+22;m+E<document.body.clientWidth?(w+="l",b=m+d/2-l):(w+="r",b=m+d/2-E+c),g>S+h+e(document).scrollTop()?(w+="b",y=g-S-h):(w+="t",y=g+v+p),o.removeClass("lb").removeClass("lt").removeClass("rb").removeClass("rt").addClass(w).css({left:b+"px",top:y+"px"}).hide().fadeIn(100)}})},200);n.data("popTimeoutId",l)},onMouseleave:function(e){var t=this.$pop,n=e.data("popTimeoutId");if(n){clearTimeout(n);var r=setTimeout(function(){t.hide().html("")},100);t.data("hideTimeoutId",r)}},hidePop:function(){this.$pop.hide()},release:function(){this.hidePop()}};return e(window).bind("scroll",function(){o.hidePop()}),o.init(),o}),define("plugin/jquery.default_image",["jquery"],function(e){e.fn.defaultImage=function(){return this.find("img").off("error").on("error",function(){var t=e(this),n=t.parent();n.addClass("is-error"),t.remove()}),this}}),define("module/default_image",["jquery","underscore","backbone","plugin/jquery.default_image"],function(e,t,n){var r={init:function(){this.render()},render:function(t){var n=t||{},r=n.$container,i;r?i=r.find(".userface,.albumface,.soundface"):i=e(".userface,.albumface,.soundface"),i.defaultImage()},release:function(){}};return r}),define("plugin/jquery.attextbox",["jquery","plugin/jquery.parser"],function(e){(function(e){function u(e,t){return e.attr?e.style[t]:e.currentStyle?e.currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?(t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),document.defaultView.getComputedStyle(e,null).getPropertyValue(t)):null}function a(e){var t=e.createTextRange();t.collapse(!0),t.moveStart("character",this.textinfo.index),t.select(),e.scrollTop=1e7,e.scrollLeft=1e7}function f(t){if(t.selectionStart)return{index:t.selectionStart};if(document.selection){var n=document.selection.createRange();if(n==null)return t.value.length;var r=t.createTextRange(),i=r.duplicate(),s=0;return r.moveToBookmark(n.getBookmark()),i.setEndPoint("EndToStart",r),s=i.text.replace(/\r/g,"").length,s==0&&(s=e(t).val()),{index:i.text.replace(/\r/g,"").length,text:i.text}}return{index:t.value.length,text:t.value}}function l(e){var t=e.attextbox("options");t.offset=e.offset(),r.css({left:t.offset.left,top:t.offset.top+50,width:e.outerWidth(),height:e.outerHeight()+20})}function c(e){var t=e.attextbox("options"),n=t.position,r=e.val().substr(0,n),s=r.lastIndexOf("@"),u=r.substr(n-1,1);r=r.substring(s+1,n),s>=0&&u!=" "&&!r.match(":|：")&&!/[\s|\n|\r]/g.test(r)?(l(e),h(e,s,r)):(o=!1,i.hide())}function h(t,n,s){var o=t.attextbox("options"),u=t.val().substr(0,n),a=e("<span>&nbsp;</span>"),f=null,l=0,c=0,h={leftfrom:0,leftto:0,topfrom:0,topto:0,width:0,height:0};f=t.offset(),h.width=t.outerWidth(!0),h.height=t.outerHeight(!0),h.leftfrom=f.left,h.leftto=f.left+h.width,h.topfrom=f.top,h.topto=f.top+h.height,o.lastIndex=n,a.attr("class",t.attr("class")),u=u.replace(/\n/g,"</br>"),u=u.replace(/\s/g,"&nbsp;"),r.html(u),r.append(a),f=a.offset(),r.scrollLeft(r[0].scrollWidth-r.outerWidth(!1)),r.scrollTop(r[0].scrollHeight-r.outerHeight(!0)),l=Math.abs(r.scrollLeft()-t.scrollLeft()),c=Math.abs(r.scrollTop()-t.scrollTop()),l=h.width-h.leftto+f.left+h.leftfrom-l,c=h.height+o.lineheight-h.topto+f.top+h.topfrom-c-25,i.css({left:l>h.leftto?h.leftto:l,top:c>h.topto?h.topto:c}),p(t,s)}function p(e,t){var n=e.attextbox("options");t=t||"",n.selected=-1,n.onCallData.call(e,i,t,function(e){o=!0,n.selected=0,n.count=e})}function d(t){var n=e(t);e.fn.attextboxinit(),n.on("focus",v),n.on("keydown",m),n.on("keyup click",g),n.on("blur",y)}function v(t){var n=e(t.currentTarget),s=n.attextbox("options");i.hide(),r.attr("class",n.attr("class")),r.css({"white-space":s.nowrap,font:s.font,"font-family":u(n[0],"font-family"),"font-size":u(n[0],"font-size")}),l(n),i.off("click").on("click",".attextbox_data1",[n],b)}function m(e){if(o)switch(e.keyCode){case 13:case 38:case 40:return!1}}function g(t){var n=e(t.currentTarget),r=n.attextbox("options");clearTimeout(s);if(t.keyCode)switch(t.keyCode){case 13:case 38:case 40:return r.onKeyClick.call(n,t.keyCode)}r.textinfo=f(n[0]),r.offset=n.offset(),r.position=r.textinfo.index,c(n),r.lastIndex=r.position}function y(e){clearTimeout(s),s=setTimeout(function(){i.hide(),o=!1},300)}function b(t){var n=e(t.currentTarget).find("span"),r=e(t.data[0]),i=r.attextbox("options"),s=r.val(),o=s.substr(0,i.position),u=s.substr(i.position),a=o.lastIndexOf("@"),f=u.substr(0,1);return f!=" "&&(u=" "+u),o=o.substring(0,a+1),s=o+n.text()+u,r.val(s),i.lastIndex=i.textinfo.index+n.text().length+2,r.focus(),!1}function w(t,n){var r=e(t);return r.off("focus",v),r.off("keydown",m),r.off("keyup click",g),r.off("blur",y),n===!0&&e.fn.attextboxdestroy(),r}var t="<div id=\"attextbox_positionpanel\" style='visibility:hidden;width:185px;overflow:auto;white-space:nowrap;position:absolute;z-index:99999;background:#e5e5e5;'></div>",n="<div id=\"attextbox_panel\" style='position:absolute;z-index:99999;'></div>",r=null,i=null,s=0,o=!1;e.fn.attextboxinit=function(){var s=e("#attextbox_panel"),o=e("#attextbox_positionpanel");s.size()?i=s:(i=e(n),e(document.body).append(i)),o.size()?r=o:(r=e(t),e(document.body).append(r))},e.fn.attextboxdestroy=function(){var t=e("#attextbox_panel"),n=e("#attextbox_positionpanel");t.size()&&(t.off("click"),t.remove()),n.size()&&n.remove()},e.fn.attextboxlocked=function(){return o},e.fn.attextbox=function(t,n){return typeof t=="string"?e.fn.attextbox.methods[t](this,n):(t=t||{},this.each(function(){var n=e.data(this,"attextbox");n?e.extend(n.options,t):(n=e.data(this,"attextbox",{options:e.extend({},e.fn.attextbox.defaults,e.fn.attextbox.parseOptions(this),t)}),d(this))}))},e.fn.attextbox.methods={options:function(t,n){return n=n||"options",e.data(t[0],"attextbox")[n]},destroy:function(e,t){w(e,t)}},e.fn.attextbox.parseOptions=function(t){return e.extend({},e.parser.parseOptions(t,[{showBar:"boolean",fixed:"boolean"}]))},e.fn.attextbox.defaults=e.extend({},{nowrap:"nowrap",font:"inherit",onCallData:function(e,t,n){},onKeyClick:function(e){},lastIndex:0,lineheight:0,position:0,offset:{},count:0,selected:-1})})(e)}),define("module/common/iattextbox",["jquery","underscore","backbone","json2","model/search","module/common/userview","plugin/jquery.attextbox"],function(e,t,n,r,i,s){var o=['	<div class="selectItem">','		<p class="tit">选择需要@的人或直接输入</p>','   <div class="container"></div>    ',"	</div>"].join(""),u=n.View.extend({isChange:!0,className:"dropList",template:t.template(o),list:null,index:0,initialize:function(){this.list=new n.Collection,this.model.on("change:keywords",this.ChangeKeyword,this),this.render()},ChangeKeyword:function(){this.isChange=!0},bind:function(t,n){var r=this;t.attextbox(e.extend(n,{onKeyClick:function(e){var t=r.data.length;if(t)switch(e){case 13:r.list.models[r.index].set("click",!0);break;case 40:r.list.models[r.index].set("checked",!1),r.index>=r.data.length-1?r.index=0:r.index++,r.list.models[r.index].set("checked",!0);break;case 38:r.list.models[r.index].set("checked",!1),r.index==0?r.index=r.data.length-1:r.index--,r.list.models[r.index].set("checked",!0)}return!1},onCallData:function(e,t,n){r.isChange=!1,r.model.set("keywords",t),t?r.$(".tit").text("选择昵称或轻敲空格完成输入"):r.$(".tit").text("选择需要@的人或直接输入"),r.isChange?r.model.doSearchUsers(function(t){t=t.split(","),r.data=t,r.doDealData(e),n(r.data.length)},function(e){}):r.data&&(r.doDealData(e),n(r.data.length))}}))},doDealData:function(e){if(!this.data)return;var t=this.data.length;if(t){this.$(".container").empty(),this.list.reset();for(var n=0;n<t;n++){var r=new i({title:this.data[n],checked:n==0,click:!1}),o=new s({model:r});this.list.add(r),this.$(".selectItem .container").append(o.render())}this.index=0,e.empty().append(this.$el).show()}},render:function(){this.$el.html(this.template())},release:function(){e.attextbox("destroy",!0)}});return new u({model:new i})}),define("plugin/jquery.mousewheel",["jquery"],function(e){var t={};try{(function(){var e=0,n=navigator.userAgent.toLowerCase(),r=function(e){return e.test(n)},i=document,s=i.compatMode=="CSS1Compat",o=r(/opera/),u=r(/\bchrome\b/),a=r(/webkit/),f=!u&&r(/safari/),l=f&&r(/applewebkit\/4/),c=f&&r(/version\/3/),h=f&&r(/version\/4/),p=!o&&r(/msie/),d=p&&r(/msie 7/),v=p&&r(/msie 8/),m=p&&!d&&!v,g=!a&&r(/gecko/),y=g&&r(/rv:1\.8/),b=g&&r(/rv:1\.9/),w=p&&!s,E=r(/windows|win32/),S=r(/macintosh|mac os x/),x=r(/adobeair/),T=r(/linux/),N=r(/ipad/),C=/^https/i.test(window.location.protocol);t={isOpera:o,isIE:p,isIE6:m,isFirefox:g,isSafari:f,isChrome:u,isIpad:N}})()}catch(n){}(function(e){e.event.special.mousewheel={setup:function(){var n=e.event.special.mousewheel.handler;t.isFirefox&&e(this).bind("mousemove.mousewheel",function(t){e.data(this,"mwcursorposdata",{pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY})}),this.addEventListener?this.addEventListener(t.isFirefox?"DOMMouseScroll":"mousewheel",n,!1):this.onmousewheel=n},teardown:function(){var n=e.event.special.mousewheel.handler;e(this).unbind("mousemove.mousewheel"),this.removeEventListener?this.removeEventListener(t.isFirefox?"DOMMouseScroll":"mousewheel",n,!1):this.onmousewheel=function(){},e.removeData(this,"mwcursorposdata")},handler:function(n){var r=Array.prototype.slice.call(arguments,1),i=e.extend({},n||window.event);n=e.event.fix(n||window.event),e.extend(n,e.data(this,"mwcursorposdata")||{});var s=0,o=!0;i.wheelDelta&&(s=i.wheelDelta/120),i.detail&&(s=-i.detail/3),t.isOpera&&(s=-n.wheelDelta),n.data=n.data||{},n.type="mousewheel",r.unshift(s),r.unshift(i);var u=(jQuery._data(this,"events")||{})[n.type]||[],a=e.event.handlers.apply(this,[n,u]),f,l,c,h,p,d,v,m,g,y;for(f=0;f<a.length&&!n.isPropagationStopped();f++){d=a[f],n.currentTarget=d.elem;for(l=0;l<d.handlers.length&&!n.isImmediatePropagationStopped();l++){m=d.handlers[l];if(!n.namespace&&!m.namespace||n.namespace_re&&n.namespace_re.test(m.namespace))n.data=m.data,n.handleObj=m,h=((jQuery.event.special[m.origType]||{}).handle||m.handler).apply(d.elem,r),n.preventDefault(),n.stopPropagation()}}}},e.fn.extend({mousewheel:function(e){return e?this.on("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.off("mousewheel",e)}})})(e)}),define("plugin/jquery.eyscroll",["jquery","plugin/jquery.easydrag","plugin/jquery.mousewheel","plugin/jquery.parser"],function(e){(function(e){function t(t,n){var r=e(t),i=r.position(),s=t.scrollHeight,o=r.outerWidth(),u=r.outerHeight();return n.showBar=s>u,u=u-2*n.borderWidthL-0*n.borderWidth,n.panelHeight=u,n.barHeight=u-(s-u),n.barHeight=n.barHeight<n.minBlockHeight?n.minBlockHeight:n.barHeight,n.pix=(s-n.panelHeight)/(s-u),n.pix1=(s-u)/(u-n.barHeight),n.pix1<1&&(n.pix1=1),{height:u,width:o,offset:i}}function n(e,t,n,r,i,s){t.addClass(i.barClass).attr("data-type","eyscroll-bar").css({width:i.barWidth,height:e.height,position:"absolute",display:i.showBar?"":"none",top:e.offset.top+1*i.borderWidth+i.borderWidthL,left:e.offset.left+e.width-i.barWidth-i.borderWidthL}),i.showBar||n.scrollTop(0),r.attr("data-type","eyscroll-barblock").css({width:i.barWidth,height:i.barHeight,position:"absolute",left:0}),s===!0&&r.css("top",0),r.find(".barblock-center").css({height:i.barHeight-7}),i.autoVisible&&i.showBar&&(u(n[0],!1),n.off("mouseenter").on("mouseenter",function(){i.showBar&&(i.mouseEnter=!0,n.eyscroll("setVisible",!0))}).off("mouseleave").on("mouseleave",function(){i.mouseEnter=!1,i.canHide&&n.eyscroll("setVisible",!1)}))}function r(r){var i=e(r),o=i.eyscroll("options"),u=e("<div></div>"),a=e("<div canLeftMove='false'><em class='barblock barblock-top'/><em class='barblock barblock-center'/><em class='barblock barblock-bottom'/></div>"),f=t(r,o);i.addClass(o.eyscrollCls),u.append(a),i.append(u),n(f,u,i,a,o,!0),i.scrollTop(0),a.easydrag(!0,o.autoBindEvent),a.beforeDrag(function(e,t){o.autoBindEvent||a.bindEvent()}),a.ondrag(function(e,t){s(e,t,i,o)}),a.ondrop(function(e,t){o.canHide=!0,o.autoBindEvent||a.unBindEvent(),!o.mouseEnter&&o.autoVisible&&i.eyscroll("setVisible",!1)}),i.mousewheel(function(t,n){var r=e(this).scrollTop();if(n>0){if(r==0)return}else if(r/o.pix1>=e(this).outerHeight())return;e(this).eyscroll("setHeight",{delta:n,scrollTop:r})})}function i(r,i){var o=r.target,u=e(o),a=u.eyscroll("options");if(a){var f={},l,c;l=u.find("[data-type='eyscroll-bar']"),c=u.find("[data-type='eyscroll-barblock']"),f=t(o,a),n(f,l,u,c,a),i===!0&&c.css("top",0),s(null,c,u,a),a.canHide=!0}else u.eyscroll()}function s(t,n,r,i){var s=e(n),o=s.position(),u=o.top;i.canHide=!1,u<0?u=0:u+(i.barHeight>0?i.barHeight:i.minBlockHeight)>i.panelHeight&&(u=i.panelHeight-(i.barHeight>0?i.barHeight:i.minBlockHeight)),s.css("top",u),u>0&&(u+=i.step/i.pix),r.scrollTop(u*i.pix1)}function o(t,n){var r=e(t),i=r.eyscroll("options"),s=n.scrollTop/i.pix1-n.delta*i.step,o=0;s+=i.step/i.pix*-1*n.delta,o=s*i.pix1,Math.abs(n.scrollTop-o)>i.barHeight*.75&&(s=n.scrollTop/i.pix1-n.delta*i.barHeight/i.pix1),r.scrollTop(s*i.pix1),s<0&&(r.scrollTop(0),s=0),s+(i.barHeight>0?i.barHeight:i.minBlockHeight)>=i.panelHeight&&(r.scrollTop(i.panelHeight*i.pix1),s=i.panelHeight-(i.barHeight>0?i.barHeight:i.minBlockHeight)),r.find("[data-type='eyscroll-barblock']").css({top:s})}function u(t,n){var r=e(t);!n||r.find("[data-type='eyscroll-bar']").fadeIn()}function a(t){var n=e(t),r=n.find("[data-type='eyscroll-bar']");n.off("resize"),n.unmousewheel(null),n.off("mouseenter").off("mouseleave"),r.empty().remove(),e.data(t,"eyscroll",null),e.fn.easydrag_release(r.attr("id"))}e.fn.eyscroll=function(t,n){if(typeof t=="string"){var i=e.fn.eyscroll.methods[t];return i&&e.isFunction(i)?i(this,n):this}return t=t||{},this.each(function(){var n=e.data(this,"eyscroll");return n?e.extend(n.options,t):(n=e.data(this,"eyscroll",{options:e.extend({},e.fn.eyscroll.defaults,e.fn.eyscroll.parseOptions(this),t)}),r(this)),this})},e.fn.eyscroll.methods={options:function(t,n){if(t.size()){n=n||"options";var r=e.data(t[0],"eyscroll");return r?r[n]:null}},setHeight:function(e,t){if(e.size())return o(e[0],t)},setVisible:function(e,t){if(e.size())return u(e[0],t)},destroy:function(e){if(e.size())return a(e[0])},reset:function(e,t){if(e.size())return i({target:e[0]},t)}},e.fn.eyscroll.parseOptions=function(t){return e.extend({},e.parser.parseOptions(t,[{autoResize:"boolean",autoBindEvent:"boolean",autoVisible:"boolean",showBar:"boolean",minBlockHeight:"number",borderWidth:"number",barWidth:"number",step:"number"}]))},e.fn.eyscroll.defaults=e.extend({},{canHide:!0,pix:1,pix1:1,autoResize:!1,autoBindEvent:!1,minBlockHeight:20,eyscrollCls:"eyscroll",borderWidthL:1,borderWidth:1,barWidth:9,barClass:"eyscroll-bar",step:2,autoVisible:!0,showBar:!0})})(e)}),define("module/comment2d/view",["jquery","underscore","backbone","module/common","model/comment_chunkinfo","model/comment_chunk","model/comment","collection/comment","plugin/face","module/share","module/card","module/default_image","plugin/dialog","module/common/iattextbox","module/dialogs/login_box","plugin/jquery.eyscroll"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=r.userModel.get("logoPic"),m=n.View.extend({tagName:"li",template:t.template(['<div class="commentInPop">','<div class="left">',"<%if(avatarPath){%>",'<a card="<%=uid%>" class="userface" href="/zhubo/<%=uid%>/" hashlink><img src="<%=avatarPath%>" alt=""></a>',"<%}else{%>",'<a card="<%=uid%>" class="userface is-error" href="/zhubo/<%=uid%>/" hashlink></a>',"<%}%>","</div>",'<div class="right">','<div class="commentInPop_content">','<a card="<%=uid%>"  href="/zhubo/<%=uid%>/" hashlink><%=nickname%>:</a><%=content%>',"</div>",'<div class="cl">','<span class="commentInPop_createtime"><%= niceTime %></span>','<a class="comment_replyBtn" href="javascript:;">回复</a>',"<%if(config.CURRENT_USER.uid == uid){%>",'<a comment_id="<%=id%>" class="comment_deleteBtn" href="javascript:;">删除</a>',"<%}%>","</div>","</div>","</div>"].join("")),events:{"click .comment_deleteBtn":"onDeleteBtnClick","click .comment_replyBtn":"onReplyBtnClick"},onDeleteBtnClick:function(e){return this.$el.remove(),y.resetScroll(),this.model.del(),y.commentChunkModel.set("count",y.commentChunkModel.get("count")-1),!1},onReplyBtnClick:function(){var e=this.model,t=e.get("trackId"),n=e.get("second"),r=e.get("id"),i=e.get("nickname");return y.$sumbitBtn.attr("track_id",t).attr("second",n).attr("parent_id",r).attr("nickname",i),y.$text.focus(),y.$text.val("回复@"+i+":"),!1},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),g=e(['<div class="commentPopBox">','<div class="commentPopBox_wrapper">','<div class="commentPop">','<div class="bud"></div>','<div class="commentPop_titleBar">','<div class="commentPop_title"><span class="commentPopBox_count"></span>条评论在<span class="commentPopBox_position">00:00</span></div>','<a class="commentPop_closeBtn close2Btn"></a>',"</div>",'<div class="commentPop_content">','<ul class="commentInPopList">',"</ul>","</div>",'<div class="commentPop_bottom">','<div class="commentPop_bottom_top">','<div class="commentBox_inputBox">','<div class="effect_borderHover"></div>','<div class="effect_borderDefault"></div>','<input class="commentPop_text" value="" type="text" placeholder="写点什么吧...">','<textarea rows="" cols=""></textarea>',"</div>","</div>",'<div class="commentPop_bottom_bottom" style="display:none;">','<div class="cl">','<div class="fr">','<a href="javascript:;" class="faceBtn"></a>','<a href="javascript:;" class="submit2Btn"><span>评论</span></a>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"].join("")),y={$el:g,$tempContainer:e("body"),$position:g.find(".commentPopBox_position"),$closeBtn:g.find(".commentPop_closeBtn"),$content:g.find(".commentPop_content"),$count:g.find(".commentPopBox_count"),$commentList:g.find(".commentInPopList"),$text:g.find(".commentPop_text"),$bottom:g.find(".commentPop_bottom_bottom"),$myface:e('<div class="chunk_userface myface">'+(v?'<div class="userface"><img src="'+v+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>"),$onEditFace:e('<div class="chunk_userface onEditFace">'+(v?'<div class="userface"><img src="'+v+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>"),$sumbitBtn:g.find(".submit2Btn"),isOnManual:!1,isOnEdit:!1,position:0,soundId:"",autoHideTime:5e3,autoHideTimeoutId:-1,chunkIndex:-1,commentChunkModel:new s,shareView:null,autoHide:function(e,t){var n=this;t=t||function(){},this.autoHideTimeoutId=setTimeout(function(){if(n.isOnEdit||n.isOnManual)return;n.afterClose(),t()},e||this.autoHideTime)},clearHide:function(){clearTimeout(this.autoHideTimeoutId)},resetScroll:function(){this.$content.eyscroll("reset",!0)},init:function(){var t=this;this.$content.eyscroll({borderWidth:7}),this.initFace(),e(document).on("click",function(){t.$text.blur(),t.close()}),p.bind(this.$text)},close:function(){this.isOnEdit=!1,this.isOnManual=!1,this.$el.hide(),this.$text.blur(),this.$text.val(""),this.$onEditFace.hide(),this.$bottom.hide(),this.afterClose()},afterClose:function(){var e=this.$el.closest(".chunk_userface");this.$tempContainer.append(this.$el),this.$commentList.children().size()||e.remove()},rendComment:function(e,n){var r=this,i=e?e.get("comments").models:new u;r.$commentList.html(""),r.$count.text(e.get("count")),t.each(i,function(e,t){var n=new m({model:e});n.render(),r.$commentList.append(n.$el)}),r.resetScroll(),r.$count.text(i.length),l.render(),c.render()},isReplying:!1,reply:function(){var e=this,t=this.position,n=this.$sumbitBtn.attr("parent_id"),r=this.$text.val();if(this.isReplying)return;this.isReplying=!0;var i={trackId:e.soundId,content:r,parentId:n,second:t},s=new o(i),u=s.check();if(u){h.alert(u),e.isReplying=!1;return}s.create(function(t){e.isReplying=!1,e.commentChunkModel.get("comments").unshift(t),e.commentChunkModel.set("count",e.commentChunkModel.get("count")+1);var n=new m({model:t});n.render(),e.$commentList.prepend(n.$el),e.$text.val(""),e.resetScroll(),l.render(),e.$sumbitBtn.attr("parent_id","")},function(t,n){e.isReplying=!1,n.msg&&h.alert(n.msg)})},initFace:function(){var e=this.$el.find(".faceBtn");if(!e.size())return;a.init(e,this.$text)},release:function(){this.close()}};y.init();var b=n.View.extend({_$sound:null,_chunkInfoModel:null,_chunkWidths:[],_isOnEdit:!1,_isOnManual:!1,_width:0,_faceNum:1,events:{"click .chunk_userface":"onChunkUserfaceClick",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave","mouseenter .chunk":"onChunkMouseEnter",click:"onClick","mouseenter .commentPopBox":"onPopBoxMouseenter","mouseleave .commentPopBox":"onPopBoxMouseleave","focus .commentPop_text":"onFocusCommentPopText","blur .commentPop_text":"onBlurCommentPopText","click .commentPop_closeBtn":"closePop","click .submit2Btn":"reply","keydown .commentPop_text":"onKeydownCommentPopText"},onChunkUserfaceClick:function(t){var n=e(t.target).closest(".chunk_userface");n.append(y.$el)},onMouseEnter:function(e){if(this._isOnEffect)return!1;this.$el.append(y.$myface.hide())},onMouseLeave:function(e){clearTimeout(this._lastOnManualTimeoutId),y.$myface.remove()},onMouseMoveTimeoutId:-1,onMouseMove:function(e){if(y._isOnEffect)return!1;var t=this,n=this._chunkInfoModel;if(!n||!n.get("duration"))return;clearTimeout(this.onMouseMoveTimeoutId),this.onMouseMoveTimeoutId=setTimeout(function(){var n=t.$el,r=e.clientX-n.offset().left,i=e.pageY-n.offset().top;if(Math.abs(r-t._lastLeft)<1)return!1;t._lastLeft=r;if(!(i>0)){y.$myface.hide();return}y._myfaceFadeIn||(y._myfaceFadeIn=!0,y.$myface.fadeIn(function(){y._myfaceFadeIn=!1})),r<=8?y.$myface.css({left:"0px"}):r>=n.width()-8?y.$myface.css({left:n.width()-16+"px"}):y.$myface.css({left:r-8+"px"}),t.showPopOnManual(r)},0)},onPopBoxMouseenter:function(){return y.isOnManual=!0,y.clearHide(),y.$myface.hide(),!1},onPopBoxMouseleave:function(){var e=this;return y.isOnManual=!1,y.autoHide(200,function(){e._lastOnManualIndex=-1,e._isOnManual=!1}),!1},onFocusCommentPopText:function(){if(!helper.isLogin()){d.open(function(){helper.refreshCurrentUser()});return}y.isOnEdit=!0,y.clearHide(),y.$bottom.show(),y.$text.parent().addClass("focus")},onBlurCommentPopText:function(){y.$text.parent().removeClass("focus")},onKeydownCommentPopText:function(e){if(e.keyCode==13&&!y.$text.attextboxlocked())return y.reply(),!1},closePop:function(){y.close()},reply:function(){y.reply()},_isOnManual:!1,_lastOnManualIndex:-1,_lastOnManualTimeoutId:-1,showPopOnManual:function(e){if(y.isOnEdit)return!1;var t=this,n=t._getPosition(e),r=t._chunkInfoModel,i=r.get("duration"),s=r.get("chunks"),o=s.length,u=parseInt(n*o/i);t._lastOnManualIndex!=u&&(t._lastOnManualIndex=u,clearTimeout(t._lastOnManualTimeoutId),s[u]&&s[u].length?t._lastOnManualTimeoutId=setTimeout(function(){t._isOnManual=!0,t.showPop(u,n,i),t.queryAtPosition(n,function(e,n){if(t._isOnManual&&u!=t._lastOnManualIndex)return;y.rendComment(e,n)})},200):t._isOnManual=!1)},_lastOnManualIndex:-1,_lastOnManualTimeoutId:-1,_lastOnAutoIndex:-1,showPopAuto:function(e){if(y.isOnManual||y.isOnEdit||this._isOnManual)return!1;var t=this,n=this._chunkInfoModel;if(!n||!n.get("duration"))return;var r=n.get("duration"),i=n.get("chunks"),s=i.length,o=parseInt(e*s/r);t._lastOnAutoIndex!=o&&(t._lastOnAutoIndex=o,i[o]&&i[o].length&&(t.showPop(o,e,r),t.queryAtPosition(e,function(e,t){y.rendComment(e,t)})))},onClick:function(t){if(this._isOnEffect)return!1;var n=this.getSoundId();if(!helper.isLogin())return d.open(function(){helper.refreshCurrentUser()}),!1;this._isOnManual=!1;var r=this,i=this.$el,s=t.pageY-i.offset().top;if(e(t.target).closest(".commentPop_content").size())return;if(e(t.target).closest(".comment_config").size())return;if(s<0)return!1;y.isOnEdit=!0;var o=this._chunkInfoModel;if(!o||!o.get("duration"))return!1;var u=t.clientX-i.offset().left,a=this._getIndex(u),f=i.find(".chunk").eq(a),l=this._getPosition(u),c=o.get("duration"),h=null;return f.find(y.$onEditFace).size()?h=y.$onEditFace:(h=y.$onEditFace,f.find(".chunkWrapper").prepend(y.$onEditFace)),y.$onEditFace.show(),r.showPop(a,l,c),setTimeout(function(){y.$text.focus()},0),r.effect(h),this.queryAtIndex(a,function(e,t){y.rendComment(e,t)}),!1},_isOnEffect:!1,effect:function(t){var n=this,r=this.$el;this._isOnEffect=!0,helper.browser.msie&&parseInt(helper.browser.version)<=8?n._isOnEffect=!1:y.$myface.clone().appendTo(r).animate({opacity:0,left:t.offset().left-r.offset().left},{duration:200,complete:function(){e(this).remove(),n._isOnEffect=!1}}),y.$myface.hide()},showPop:function(e,t,n){var r=this,i=this._$sound.attr("sound_id"),s=this.$el.find(".chunk").eq(e);(y.soundId!=i||y.chunkIndex!=e)&&y.$commentList.html(""),y.clearHide(),y.position=t,y.soundId=i,y.chunkIndex=e,y.$position.text(helper.getTime(t*1e3)),s.prepend(y.$el),y.$el.toggleClass("is-budAtRight",t/n>.5),y._isOnFadeIn||(y._isOnFadeIn=!0,y.$el.hide().fadeIn(200,function(){y._isOnFadeIn=!1})),y.autoHide(5e3,function(){r._lastOnManualIndex=-1,r._isOnManual=!1})},queryAtPosition:function(e,t){var n=this._chunkInfoModel,r=n.get("duration"),i=n.get("chunks"),s=i.length,o=parseInt(e*s/r),u=this.$el.find(".chunk").eq(o),a=u.find(y.$el);if(a.size()&&!a.is(":hidden"))return;this.queryAtIndex(o,t)},queryAtIndex:function(e,t){var n=this,r=new s({id:this._$sound.attr("sound_id")+"_"+e,soundId:this._$sound.attr("sound_id"),index:e});r.query({success:function(e,r){y.commentChunkModel&&y.commentChunkModel.off(null,null,n),y.commentChunkModel=e,y.commentChunkModel.on("change",n.onPopBoxCommentChunkModelChange,n),t(e,r)}})},initialize:function(){var e=this.$el;this._$sound=e.closest("[sound_id]"),this._width=e.width()},render:function(){var e=this,t=this.getSoundId(),n=this._chunkInfoModel;if(!n||t!=n.id)n=new i({id:t}),this._chunkInfoModel=n;n.query({success:function(t){e._chunkInfoModel=t,e._render()}})},_render:function(){var e=this,n=this.$el,r="",i=parseInt(this._width),s=this._chunkInfoModel;if(!n.data("chunkNumBinded")){n.data("chunkNumBinded",!0);var o=i>=500?18:16,u=s.get("chunks"),a=u.length,f=i/a,l=parseInt((f+1)/o,10),h=parseInt(i/a,10),p=f==h?h:h+1,d=p*a-i,v=a-d;this._chunkWidths=[],this._faceNum=l,t.each(u,function(t,n){var i=n<v?p:h,s='style="width:'+i+'px;"';e._chunkWidths.push(i);var o="";for(var u=0,a=t.length;u<a&&u<l;u++)o+='<div class="chunk_userface">'+(t[u]?'<div class="userface"><img src="'+t[u]+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>";r+='<div class="chunk" chunkindex="'+n+'" hidefocus="true" '+s+'><div class="chunkWrapper">'+o+"</div></div>"}),n.html(r),this.bindEvents(),c.render({$container:n})}},onPopBoxCommentChunkModelChange:function(){var n=y.commentChunkModel.get("comments").models,r=this._chunkInfoModel.get("chunks"),i=y.chunkIndex,s=this._faceNum,o="",u=this.$el.find(".chunk").eq(i),a=t.map(n,function(e){return e.get("avatarPath")});r[i]=a;for(var f=0,l=a.length;f<l&&f<s;f++)o+='<div class="chunk_userface">'+(a[f]?'<div class="userface"><img src="'+a[f]+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>";u.find(".chunk_userface:not(.onEditFace)").remove(),y.$onEditFace.hide().appendTo(e("body")),u.find(".chunkWrapper").html(o),y.$count.text(n.length),this.updateCount()},updateCount:function(){var e=y.commentChunkModel,t=this._$sound.find(".commentBtn");if(!t.size())return;var n=t.find(".count");if(!n.size())return;var r=parseInt(n.text(),10);e.previous("count")>e.get("count")?r--:e.previous("count")<e.get("count")&&r++,n.text(r)},_getChunkUserfaceIndex:function(e){return parseInt(e/16)-1},_getPosition:function(e){var t=this._chunkInfoModel,n=this.$el.width(),r=t.get("duration");return e/n*r},_getIndex:function(e){var t=0;for(var n=0,r=this._chunkWidths.length;n<r;n++){t+=this._chunkWidths[n];if(t>e)return n}},setChunkInfoModel:function(e){this._chunkInfoModel=e},bindEvents:function(){},getSoundId:function(){return this._$sound.attr("sound_id")},release:function(){y.commentChunkModel.off(null,null,this),y.release(),this.undelegateEvents()}});return b}),define("module/player/extend/comment2d",["jquery","underscore","backbone","helper","model/sound","../model","../base","module/comment2d/view"],function(e,t,n,r,i,s,o,u){var a=o.prototype,f=t.clone(a);return t.extend(a,{_$commentbar:null,_comment2dView:null,initialize:function(){var e=this.$el;f.initialize.apply(this,arguments),this._$commentbar=this.find(".player_commentbar"),this.createComment2dView()},getComment2dView:function(){return this._comment2dView},hasComment2d:function(){return!!this._comment2dView},createComment2dView:function(){this._$commentbar.size()&&(this._$commentbar.eq(0).is(":hidden")||(this._comment2dView=new u({el:this._$commentbar[0]})))},getComment2dView:function(){return this._comment2dView||this.createComment2dView(),this._comment2dView},onSoundWhileplaying:function(e,t){return f.onSoundWhileplaying.apply(this,arguments)?(this.hasComment2d()&&(this._comment2dView.$el.is(":hidden")||this._comment2dView.showPopAuto(t.position/1e3)),!0):!1}}),o}),define("collection/comment_chunkinfo",["jquery","underscore","backbone","model/comment_chunkinfo"],function(e,t,n,r){var i=n.Collection.extend({model:r,fetch:function(e){e=e||{},e.data=e.data||{},e.data.track_ids=e.ids.join(","),t.extend(e,{url:"/track_blocks/avatars",type:"get"}),n.Collection.prototype.fetch.call(this,e)},parse:function(e,n){return t.map(e,function(e,t){var n={},r=e[0],i=e[1],s=e[2],o=[];for(var u=0;u<r;u++)o.push(i[u]||[]);var a=[o,s];return n[t]=a,n})}});return i}),define("module/comment2d/comment2d",["jquery","underscore","backbone","collection/comment_chunkinfo"],function(e,t,n,r){var i={render:function(e){var n=[],i;for(var s=0,o=e.length;s<o;s++){i=e[s];var u=i.getSoundId();t.indexOf(n,u)==-1&&n.push(u)}var a=new r;a.query({ids:n,success:function(t){for(var n=0,r=e.length;n<r;n++){var i=e[n],s=i.getSoundId();i.setChunkInfoModel(t.get(s)),i.render()}}})}};return i}),define("module/player/extend/expand",["jquery","underscore","backbone","helper","../model","../base","module/wave","module/comment2d/comment2d"],function(e,t,n,r,i,s,o,u){var a=i.mainPlayer,f=i.playState,l=s.prototype,c=t.clone(l);return t.extend(l,{_$expandBox:null,_$unexpandBox:null,initialize:function(){var e=this.$el;this._$expandBox=this.find(".sound_expandBox"),this._$unexpandBox=this.find(".sound_unexpandBox"),c.initialize.apply(this,arguments)},events:t.extend({"click .smallPlayer":"smallPlayerClick"},c.events),smallPlayerClick:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;e(t.target).parents(".pin").size()||this._$expandBox.find(".playBtn").size()&&this.play()},onSoundUnexist:function(){if(!c.onSoundUnexist.apply(this,arguments))return!1;var e=this._$unexpandBox.find(".smallPlayer");return this._$unexpandBox.size()&&!e.find(".smallPlayer_errmsg").size()&&(e.addClass("disabled"),e.append('<div class="disabled smallPlayer_errmsg">该声音不存在</div>'),this._$unexpandBox.find(".smallPlayer").removeClass("player-loading")),!0},onSoundPast:function(){return c.onSoundPast.apply(this,arguments)?(this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").removeClass("player-loading"),!0):!1},rendPlaybtn:function(){if(!c.rendPlaybtn.apply(this,arguments))return!1;var e=a.playState();f.PLAYING==e&&this.expand(),this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").toggleClass("player-loading",f.BUFFERING==e)},play:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;return this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").addClass("player-loading"),c.play.apply(this,arguments)},pause:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;return this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").removeClass("player-loading"),c.pause.apply(this,arguments)},expand:function(){var e=this;if(this.$el.is(".disabled"))return;if(this._$expandBox&&!this._$expandBox.size())return;this._$expandBox.is(":hidden")&&(this._$expandBox.show(),this._$unexpandBox.hide(),this._$expandBox.find(".middlePlayer").css("opacity",.1).animate({opacity:1},400),o.render({$container:e.$el}),this.createComment2dView(),this.hasComment2d()&&u.render([this.getComment2dView()]),this.$el.trigger("onExpand"))}}),s}),define("model/forward",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({check:function(t,n){var t=this.toJSON(),r=/[\u0391-\uFFE5]/g,i=e.trim(t.content).replace(r,"aa"),s=Math.ceil(i.length/2);if(s>30)return"转采不能超过30个字。"},create:function(t,n){t=t||e.noop,n=n||e.noop,this.save({},{url:"/handle_track/relay",data:{no_more_alert:this.get("no_more_alert"),id:this.get("trackId"),content:this.get("content"),sharing_to:this.get("sharing_to"),album_id:this.get("album_id"),album_title:this.get("album_title")},type:"post",success:function(e,r,i){if(r.res===!1){n(e,r);return}t(e,r)},error:function(e,t,r){n(e,t,r)}})}});return r}),define("module/common/forward_to",["jquery","plugin/dialog","plugin/jquery.selecter"],function(e,t){function n(n){var r=this;e.ajax({type:"POST",url:"/handle_track/album_list",data:{status:1},dataType:"json",success:function(e){e=e.response,n(e)},error:function(){t.alert("服务器繁忙,请稍后再试!")}})}function r(n,r){var i="",s,o,u,a,f,l=!0;if(r&&r.length>0)for(var c=0;c<r.length;c++){var h=r[c];i+='<li class="selecter-item"  title = "'+h.title+'" data-value="'+h.id+'" data-is-public="'+h.is_public+'">'+'<span class="selecter-text t-ovf-h">'+h.title+"</span>"+(h.is_public?"":'<i class="privacyIcon" title="私密专辑"></i>')+"</li>"}var p=['<label class="c05">转采到</label> ','<div class="selecter selecter-s7">','<input type="hidden" name="album_id" value="">','<div data-value="" class="selecter-selected">','<span class="selecter-text t-ovf-h"></span>','<em class="selecter-arrow" style=" font-size:14px;">◆</em>',"</div>",'<div class="selecter-options">',"<ul>",i,"</ul>",'<div class="create-ablum" style="display:none">','<input type="text" name="album_title" value="" placeholder="请输入专辑名称">','<div class="operate">','<a class="btn btn-sm2 forward_to_okBtn">确认</a>','<a class="btn btn-sm2 forward_to_cancelBtn">取消</a>',"</div>","</div>","</div>","</div>"].join("");n.html(p),s=n.find(".selecter"),s.selecter(),o=n.find("ul"),u=n.find(".create-ablum"),a=n.find("[name=album_id]"),f=n.find(".selecter-selected"),$album_title=n.find("[name=album_title]"),n.find(".forward_to_createBtn").off().on("click",function(){return o.hide(),u.show(),!1}),n.find(".forward_to_cancelBtn").off().on("click",function(){return o.show(),u.hide(),$album_title.val(""),f.find(".selecter-text").text(""),!1}),n.find(".forward_to_okBtn").off().on("click",function(){var n=e.trim($album_title.val());if(!n){t.alert("专辑标题不能为空");return}if(helper.gblen(n)>40){t.alert("标题太长，必须小于20个汉字或者40个字母");return}return f.find(".selecter-text").text(n),s.removeClass("open"),!1}),$album_title.bind("change",function(){return!1}),s.bind("change",function(){var n=e(this),r=n.find(".selecter-selected i"),i=s.selecter("val"),o=s.find("[data-value="+i+"]").is("[data-is-public=true]");l?o?$album_title.val(""):(t.alert("转采的声音只能添加至公开专辑"),n.selecter("reset")):o?(t.alert("加入此专辑以后，声音将会被公开",{yesText:"知道了"}),r.hide()):r.show()})}function i(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id==t)return r.is_public}}function s(e){n(function(t){r(e,t)})}return{init:s}}),define("module/comment_box",["jquery","underscore","backbone","model/comment","model/forward","plugin/count_char","plugin/face","module/share","plugin/dialog","module/dialogs/login_box","router","module/common/iattextbox","module/common/forward_to","module/dialogs/paysound","model/sound"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=n.View.extend({initialize:function(t){this.trackId=t.trackId,this.parentId=t.parentId||"",this.second=t.second||"",this.success=t.success||e.noop,this.error=t.error||e.noop,this.isForward=t.isForward,this.isForward?(this.forwardModel=new i,h.init(t.$el.find(".sound-goto"))):this.commentModel=new r,this.beforeComment=t.beforeComment||e.noop;var n=t.$el;this.$el=n,this.$input=t.$input||n.find(".commentBox_inputBox input[type=text]"),this.$submitBtn=t.$submitBtn||n.find(".submitBtn"),this.$charCount=t.$charCount||this.$el.find(".charCount"),this.$closeBtn=n.find(".closeBtn"),this.initCount(),this.initFace(),this.initShare(),this.bindEvents()},bindEvents:function(){var t=this.$submitBtn,n=this;t.on("click",function(){var t=e(this).attr("data-status");if(t==2)return a.success("下架声音无法评论哦",{autoClose:3e3,template:{dialog_container:'<div class="msg2" dialog-role="container"></div>',dialog_body:"<span dialog-role='body' style='line-height:105px;display:inline-block;padding-left:0px;background-image:none;'></span>"}}),!1;if(!helper.isLogin())return f.open(function(){l.reload()}),!1;n.isPaidSound()}),this.$closeBtn.on("click",function(){n.$el.stop().slideToggle()}),this.$input.on({count_ok:function(){n.$el.removeClass("is-error")},count_pass:function(){n.$el.addClass("is-error")}}),c.bind(this.$input)},isPaidSound:function(){var e=this.$submitBtn,t=this,n=new d({id:this.trackId});n.query({async:!0,success:function(r){var i=r.toJSON();n.uid=i.uid,e.addClass("is-loading"),t.createComment(function(){e.removeClass("is-loading")}),e.removeClass("is-loading");return},removed:function(){},error:function(){}});return},initCount:function(){var e=this.$charCount;if(!e.size())return;var t=140;this.isForward&&(t=30),s(this.$input,e,t,{text:"还剩<em>{count}</em>字",passText:"超出<em>{count}</em>字"})},initFace:function(){var e=this.$el.find(".faceBtn");if(!e.size())return;o.init(e,this.$input)},initShare:function(){var e=new u({$el:this.$el});this.shareView=e},createForward:function(t){t=t||e.noop;var n=this,r=e.trim(n.$input.val());n.$albumTitle=n.$el.find("[name='album_title']"),n.$albumId=n.$el.find("[name='album_id']");var i={content:r,trackId:n.trackId,album_title:n.$albumTitle.val()||undefined,album_id:n.$albumId.val()||undefined},s=this.beforeComment(i);this.shareView.getShareData(function(r){i=e.extend(i,s,r),n.forwardModel.set(i);var o=n.forwardModel.check();if(o){a.alert(o),n._isAjax=!1,t();return}n.forwardModel.create(function(e,r){n.commentSuccess(e,r),a.success("转采成功"),n._isAjax=!1,t()},function(e,r,i){n.commentError(e,r,i),n._isAjax=!1,t()})})},createComment:function(t){t=t||e.noop;if(this._isAjax)return;this._isAjax=!0;if(this.isForward){this.createForward(t);return}var n=this,r=e.trim(this.$input.val());if(!r){a.alert("评论不能为空"),this._isAjax=!1,t();return}var i={content:r,trackId:n.trackId,parentId:n.parentId,second:n.second};if(isNaN(i.second)||i.second===""){var s=mainPlayer.getSmSoundById(i.trackId);s&&(i.second=s.position/1e3)}var o=this.beforeComment(i);this.shareView.getShareData(function(r){i=e.extend(i,o,r),n.commentModel.set(i);var s=n.commentModel.check();if(s){a.alert(s),n._isAjax=!1,t();return}n.commentModel.create(function(e,r){n.commentSuccess(e,r);var s="评论成功";i.parentId&&(s="回复成功"),a.success(s),t()},function(e,r,i){n.commentError(e,r,i),t()})},function(){n._isAjax=!1,t()})},commentSuccess:function(e,t){this._isAjax=!1,this.$input.val(""),this.$input.blur(),this.success(t)},commentError:function(e,t,n){this._isAjax=!1,this.error(t);if(t.status==400)return;t.mark!=="PaidRefuse"&&a.alert(t.msg||"服务器繁忙,请稍后再试!")},release:function(){var e=this.$el;e.off(),e.empty()}});return v}),define("module/dialogs/forward",["jquery","plugin/dialog","module/comment_box"],function(e,t,n){var r={open:function(t,n,r){this.callback=r||e.noop,this.track_id=t,this.isComment=n,this.createPop()},createPop:function(){var e=this,r={text:"转采",count:30,type:"relay"};this.isComment&&(r={text:"评论",count:140,type:"comment"});var i='<textarea placeholder="写点'+r.text+'理由吧"></textarea>'+'<div class="popup_btm">'+'<div class="fl">'+'<div class="sound-goto"></div></div>'+'<div class="fr"><span class="charCount">还剩<em>'+r.count+"</em>字</span>"+'<a href="javascript:;" class="faceBtn"></a>'+'<a href="javascript:;" class="submitBtn"><span>'+r.text+"</span></a>"+"</div></div>",s={dialogClass:"forward",header:r.text,content:i,overlayer:{clickClose:!1}},o=new t.Dialog(s);o.open(),this.pop=o,this.$el=o.getEl();var u=this.$el.find("textarea");new n({$el:this.$el,trackId:e.track_id,$input:u,isForward:!e.isComment,success:function(t){e.pop.close(),e.callback(t)},error:function(){}})}};return r}),define("module/player/extend/comment",["jquery","underscore","backbone","helper","model/sound","../model","../base","module/comment_box","module/card","module/default_image","module/dialogs/forward","module/dialogs/paysound","model/comment","plugin/dialog"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=o.prototype,v=t.clone(d);return t.extend(d,{_$likebtn:null,_$likeCount:null,events:t.extend({"click .commentBtn":"_showComment","click .forwardBtn":"_showForward","click .replyBtn":"showReply"},v.events),initialize:function(){var e=this.$el;v.initialize.apply(this,arguments),this.track_id=e.attr("sound_id"),this._$commentbtn=this.find(".commentBtn"),this._$commentCount=this._$commentbtn.find(".count"),this._$commentBoxEntry=this.find(".comment_box_entry"),this._$forwardbtn=this.find(".forwardBtn"),this._$forwardCount=this._$forwardbtn.find(".count"),this._$forwardBoxEntry=this.find(".relay_box_entry"),this._$replybtn=this.find(".replyBtn"),this._$replyBoxEntry=this.find(".reply_box_entry")},getTemplate:function(){if(this._commentBoxStr)return;var e=document.getElementById("tpl_comment_box"),n,r={};e&&(n=t.template(e.innerHTML),r={comment:{title:"评论声音",btnText:"评论",shareType:"comment",logoPic60:current_user.logoPic60},forward:{title:"转采声音",btnText:"转采",shareType:"relay",logoPic60:current_user.logoPic60},reply:{title:"回复",btnText:"评论",shareType:"comment",logoPic60:current_user.logoPic60}},this._commentBoxStr=n(r.comment),this._forwardBoxStr=n(r.forward),this._replyBoxStr=n(r.reply))},getTrackId:function(){return this.$el.attr("sound_id")},showCommonBox:function(t,n,r,i,s){var o=e(t.target),a=o.attr("data-options"),f=a?e.parseJSON(a):{};s=s||e.noop;var l=n=="forward",c=n=="reply",h=n=="comment",d=this.getTrackId(),v,m=this;if(r.attr("data-comment-init")){v=r.find(".commentBox"),v.stop().slideToggle(function(){m.$el.trigger("onExpand"),v.css("height","auto")});return}r.attr("data-comment-init",!0),r.html(i),v=r.find(".commentBox");var g=v.find(".commentBox_inputBox"),y=g.find("input"),b=g.find("textarea");y.on("focus",function(){return g.addClass("is-onEdit focus"),b.focus(),!1}),b.on({blur:function(){g.removeClass("focus"),e.trim(b.val())||g.removeClass("is-onEdit")},focus:function(){g.addClass("is-onEdit focus"),v.height("auto"),!b.val()&&f.c_nickname&&b.val("回复@"+f.c_nickname+":")}}),v.on("click",".comment_delete",function(){var t=e(this),n=e.parseJSON(t.attr("data-options")),r=t.closest(".listItem");m.delComment(n,function(e,t){r.slideUp()},function(e,t){t.msg&&p.alert(t.msg)})}),new u({$el:v,trackId:d,parentId:f.c_id||"",second:f.c_second,$input:b,isForward:l,success:function(e){var t=r;c&&(t=m._$commentBoxEntry),m.getCommentList(d,t,l,function(){g.removeClass("is-onEdit")}),s(e)}});if(c){v.stop().slideToggle(function(){m.$el.trigger("onExpand"),v.css("height","auto")});return}this.getCommentList(d,r,l,function(){v.stop().slideToggle(function(){m.$el.trigger("onExpand"),v.css("height","auto")})})},showComment:function(t){if(!r.isLogin())return;this.getTemplate();var n=this.getTrackId();if(this._$commentBoxEntry.size()==0){l.open(n,!0,function(t){var r=e("[sound_id="+n+"] .commentBtn .count"),i=t.track_comments_count||r.text()*1+1;r.text(i)});return}var i=this._$forwardBoxEntry.find(".commentBox");i.stop().hide();var s=this._$commentCount;this.showCommonBox(t,"comment",this._$commentBoxEntry,this._commentBoxStr,function(e){s.text(e.track_comments_count||s.text()*1+1)})},delComment:function(e,t,n){var r=new h({id:e.comment_id}),i=this;r.set({trackId:i.$el.attr("sound_id")}),r.del(t,n)},getCommentList:function(t,n,r,i){i=i||e.noop;var s=n.find(".commentBox_commentList"),o=r?"/sounds/relay_list_template":"/sounds/comment_list_template";if(s.size()==0){i();return}e.get(o,{id:t},function(e){s.empty().html(e),a.render({$container:s}),f.render({$container:s}),i()})},_showComment:function(e){current_user.uid&&this.getSoundInfo("showComment",e)},_showForward:function(e){current_user.uid&&this.getSoundInfo("showForward",e)},getSoundInfo:function(e,t){var n=this,r=new i({id:n.getTrackId()});r.query({async:!0,success:function(i){var s=i.toJSON();r.uid=s.uid,n[e](t);return},removed:function(){},error:function(){}})},showForward:function(t){if(!r.isLogin())return;this.getTemplate();var n=this.getTrackId();if(this._$forwardBoxEntry.size()==0){l.open(n,!1,function(t){var r=e("[sound_id="+n+"] .forwardBtn .count"),i=t.track_shares_count||r.text()*1+1;r.text(i)});return}var i=this._$commentBoxEntry.find(".commentBox");i.stop().hide();var s=this._$forwardCount;this.showCommonBox(t,"forward",this._$forwardBoxEntry,this._forwardBoxStr,function(e){s.text(e.track_shares_count||s.text()*1+1)})},showReply:function(t){if(!r.isLogin())return;this.getTemplate();var n=e(t.target),i=n.closest(".comment"),s;i.size()>0||(i=n.closest("li"));if(i.size()==0)return;s=i.find(".right").find(".reply_box_entry"),this.showCommonBox(t,"reply",s,this._replyBoxStr)}}),o}),define("module/dialogs/download",["jquery","plugin/dialog"],function(e,t){var n={open:function(e){this.options=e,this.createPop()},createPop:function(e){var n='<div class="code"><a target="_blank" href="/download"><img src="'+config.STATIC_ROOT+"/css/img/code.png?"+config.ASSETS_VERSION+'"/>下载手机版'+"</a>"+'<div class="logo"></div>'+'</div><div class="info"></div>',r={dialogClass:"download",header:"下载",content:n},i=new t.Dialog(r);i.open()}};return n}),define("module/player/extend/download",["jquery","../base","module/dialogs/download"],function(e,t,n){var r=t.prototype,i=_.clone(r);return _.extend(r,{events:_.extend({"click .downloadToMobile ":"downloadToMobile"},i.events),downloadToMobile:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;n.open()}}),t}),define("module/album-end",["jquery","underscore","plugin/pops"],function(e,t,n){var r=t.template('<i class="icon9 icon-closed fr"></i><h3>申请完结</h3><ul class="sure-txt"><li>完结后，专辑将不能增节目哦；</li><li>完结后，如有听众投诉实际未完结，核实后将撤销完结并作相应警告处罚。</li></ul><p class="mgt-20 txt-mid2">确定提交申请吗？</p><div class="button wid-90"><a class=" pre inl-b btn-cancel">取消</a><a class="inl-b mgr-20 btn-com">提交申请</a></div>'),i=t.template('<i class="icon9 icon-closed fr"></i><span class="inl-b warm-cat"></span><h3>已完结</h3><div class="txt-mid2">终于更新完成啦~<br> 很棒棒，给你32个赞！</div><p class="hr-line"></p><div class="flow-bg"><img src="../../../css/img/test_code.png" alt="" class="inl-b alb-code"><span class="inl-b txt-mid2 ta-l"><p class="c02 mgb-5">扫一扫二维码</p><p>分享给朋友们听</p></span></div>'),s=t.template('<i class="icon9 icon-closed fr"></i><h3>温馨提示</h3><ul class="sure-txt"><li>专辑已经完结，无法增节目，</li><li>如需更改，需撤销完结状态</li></ul><p class="mgt-20 txt-mid2">是否撤销完结？</p><div class="button wid-90"><a class=" pre inl-b btn-cancel">暂不撤销</a><a class="inl-b mgr-20 btn-com">撤销完结</a></div>'),o=t.template('<i class="icon9 icon-closed fr"></i><h3>撤销完结</h3><div class="sure-txt">每张专辑仅有3次申请完结的机会哦</div><p class="mgt-20 txt-mid2">确定撤销完结状态吗？</p><div class="button"><a class=" pre inl-b btn-cancel">取消</a><a class="inl-b mgr-20 btn-com">确定</a></div>'),u={init:function(t){var r=this,i=t.data("status"),s=t.data("first-visit");this.status=i,this.$btn=t,e("#mainbox .identy-pop").addClass("hidden"),t.css({"pointer-events":"auto",cursor:"pointer"}),t.off().on({mouseenter:function(){var t=e(this),n=t.data("status");n==="finished"&&t.text("撤销完结")},mouseleave:function(){var t=e(this),n=t.data("status");n==="finished"&&t.text("已完结")}});if(s){this.finished();var o=t.data("url").match(/\d+/)[0];e.ajax({type:"POST",url:"/update_finished_album/"+o+"/alert",success:function(e){console.log(e)}})}t.on("click",function(){var e=t.data("status"),i=t.data("apply");if(!i&&e!=="finished")return n.Toast("亲，你申请完结次数已超过3次，请联系客服申请"),!1;e==="finished"&&(e="cancelApply"),r[e]("CANCEL_BTN")})},setOperBtn:function(e){this.$btn=e},freeNotApply:function(){n.Toast("亲，完整度达到100%才能申请完结",1e3)},notApply:function(){var e=this;n.Toast("亲，达到预计更新集数后才能申请完结",1e3)},canApply:function(){function f(e){s.applyModal.close(function(){e.res?(s.$btn.text("完结审核中").addClass("disabled"),s.$btn.data("status","auditing"),s.auditing()):n.Toast(e.msg)})}var t=e("#mainbox .maskers"),i=this.$btn.data("url"),s=this;this.applyModal?this.applyModal.open():(this.applyModal=new n.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden",closeBtn:"icon-closed",template:r()}),this.applyModal.open());var o=e(this.applyModal.getEl()),u=o.find(".btn-cancel"),a=o.find(".btn-com");u.off().on("click",function(){s.applyModal.close()}),a.off().on("click",function(){s.doApply(i,f)})},auditing:function(){n.Toast("已申请完结，审核中")},finished:function(){var t=e("#mainbox .maskers"),r=this.$btn.data("album-url"),s=this;this.finishedPop||(this.finishedPop=new n.Modal({containerClass:"maskers hidden",dialogClass:"identy-pop mid hidden",closeBtn:"icon-closed",template:i()}));var o=e(this.finishedPop.getEl()),u=o.find(".alb-code");e.ajax({type:"POST",url:"/audio_qrcode",data:{url:r,size:30},success:function(e){e.status==="success"&&u.attr("url",e.url)}}),this.finishedPop.open()},Toast:function(t,n){$toast=e(".anchor-toast"),$toast.text(t),$toast.fadeIn(600,function(){n&&setTimeout(function(){$toast.fadeOut(600)},800)})},doApply:function(t,n,r){e.ajax({type:"POST",url:t,success:function(e){n(e)},error:function(e){r(e)}})},cancelApply:function(t){function l(e,t){if(e)return;r.cancelPop.close(function(){n.Toast("完结已撤销，每张专辑最多3次完结机会，请慎重使用哦",1500,function(){window.history.go(0)})})}var r=this,i=this.$btn.data("url").replace(/confirm/,"cancel");this.cancelPop=t==="CANCEL_BTN"?null:"",this.cancelPop||(this.cancelPop=new n.Modal({containerClass:"maskers hidden",dialogClass:"identy-pop mid hidden",closeBtn:"icon-closed",template:t==="CANCEL_BTN"?o():s()}));var u=e(this.cancelPop.getEl()),a=u.find(".btn-cancel"),f=u.find(".btn-com");a.off().on("click",function(){r.cancelPop.close()}),this.cancelPop.open(),f.off().on("click",function(){r.doCancelApply(i,l)})},doCancelApply:function(t,n){e.ajax({type:"POST",url:t,success:function(e){e.res&&n(null,e)}})}};return u}),define("module/player/extend/destroy",["jquery","underscore","backbone","helper","../model","../base","plugin/dialog","model/sound","module/album-end"],function(e,t,n,r,i,s,o,u,a){var f=s.prototype,l=t.clone(f);return t.extend(f,{events:t.extend({"click .destroyBtn":"destroy"},l.events),destroy:function(t){if(e(".j-finished-album").data("status")==="finished"){a.setOperBtn(e(".j-finished-album")),a.cancelApply();return}if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;var n=this,r=e(t.target),i=r.attr("destroy_id"),s=r.attr("data-upload-type")||"audio",f=s==="video"?"是否同时删除视频和音频文件？":"是否要删除这个声音？";if(!i)return;o.confirm(f,function(){var e=new u({id:i});e.destroy(function(e){n.$el.slideUp(function(){n.$el.remove()})},function(e){if(e.error_symbol==="soundable_platform"){var t="哎呀，本条属于有声化平台的版权声音，无法直接删除呢~<br>如果觉得这条声音不完美，可以前往有声化平台替换掉它哟~";o.confirm(t,function(){window.open(e.edit_url)},{yesText:"去替换",width:"400px"})}else o.alert(e.msg)})},{yesText:"删除"})}}),s}),define("module/player/view",["jquery","underscore","backbone","./base","./extend/info","./extend/like","./extend/comment2d","./extend/expand","./extend/comment","./extend/download","./extend/destroy"],function(e,t,n,r){return r}),define("module/player/follower_view",["jquery","underscore","backbone","./model","./view","module/wave","module/comment2d/comment2d","model/sound"],function(e,t,n,r,i,s,o,u){var a=r.mainPlayer,f=i.extend({initialize:function(){var e=this.$el,n=e.closest("[sound_ids]"),r=a.soundId(),s=[],o=!1,f=this;if(n.size()){var l=n.attr("sound_ids");s=l?l.split(","):[],t.indexOf(s,r)>=0&&(e.attr("sound_id",r),o=!0)}i.prototype.initialize.apply(this,arguments),a.on("change:sound",function(e,t){this.render(e,t)},this),a.on("change:soundIds",function(e,t){this._$soundIds.is(".j-player-soundIdsWorking")&&this._$soundIds.attr("sound_ids",t)},this);if(o){if(!r)return;var c=new u({id:r});c.query({success:function(e){var t=e.toJSON();f.render(e,t,!0)}})}},needRender:function(){var e=a.soundId(),n=[];n=this._$soundIds.attr("sound_ids").split(",");if(t.indexOf(n,e)!==-1)return!0},render:function(e,n,r){if(!r&&!this.needRender())return!1;var u=n.uploadId,a=config.FDFS_PATH+"/"+n.waveform,f=this.$el;if(n.id!=this._soundId||r)this._soundId=n.id,this.$el.attr("sound_id",n.id),this._$commentbar&&this._$commentbar.is(":visible")&&(this.getComment2dView().$el.data("chunkNumBinded",!1),o.render([this.getComment2dView()])),f.is(".j-sound_detail")?(n.durationStr=helper.getTime(n.duration),t.each(n,function(e,t){var r=f.find(".j-sound_"+t);r.text(e);if(t=="title"){r.attr("title",e);var i=r.attr("href").replace(/\d+$/,n.id);r.attr("href",i)}if(t=="playCount"){var s=parseInt(e)+1;r.attr("title",s+"次播放"),r.text(s)}})):this._$duration.size()&&this._$duration.text(helper.getTime(n.duration)),this._$likebtn.size()&&this._$likebtn.toggleClass("is-sound-liked",!!n.isFavorited),this._$face.size()&&this._$face.attr("src",n.soundface||n.coverUrl);else{var l=parseInt(n.playCount)+1,c=f.find(".j-sound_playCount");c.attr("title",l+"次播放"),c.text(l)}if(this._$wavebox&&this._$wavebox.is(":visible")&&u!=this._$wavebox.attr("sound_uploadid")||r)this._$wavebox.closest(".player_progressbar").data("drawed",!1),this._$wavebox.attr("sound_uploadid",u).attr("sound_wave",a),s.render({$container:this.$el});i.prototype.render.apply(this,arguments)},onSoundUnexist:function(){}});return f}),define("module/dialogs/edit_player",["jquery","plugin/dialog"],function(e,t){var n={open:function(t,n,r,i){this.callback=i||e.noop,this.createPop(t,n,r)},createPop:function(n,r,i){var s=config.STATIC_PATH+"/css/img/",o=["playerS2.png","playerS1.png","playerS3.png","playerS4.png","playerS5.png","playerS6.png"];n!="album"&&(o=["playerSound2.png","playerSound1.png","playerSound3.png","playerSound4.png","playerSound5.png","playerSound6.png"]);var u='<div class="popup_dl"><strong>配色</strong><div class="playerColorBar"><a class="playerColor c2 on" style="background-color:#e92e17"></a><a class="playerColor c1"></a><a class="playerColor c3"></a><a class="playerColor c4"></a><a class="playerColor c5"></a><a class="playerColor c6"></a></div></div><div class="popup_dl"><input type="checkbox" id="autoPlay">自动播放<div class="listenhelp"><a class="grouphelp"></a><div class="grouphelp_txt">勾选后，则播放加载完成后自动开始播放<span class="arrow_grouphelp"><i></i></span></div></div><img src="'+s+o[0]+"?v="+config.ASSETS_VERSION+'" class="playerPic">'+"</div>"+'<div class="operate">'+'<a class="confirmBtn">保存</a>'+'<a class="cancelBtn" dialog-role="close">取消</a>'+"</div>",a={dialogClass:"editPlayer",header:"编辑播放器样式",content:u},f=new t.Dialog(a),l=this;this.pop=f;var c=f.getEl(),h=c.find(".playerPic"),p=c.find(".playerColorBar");c.find(".playerPic").on("load",function(){f.setPosition()}),p.on("click",".playerColor",function(){var t=e(this),n=t.index();h.attr("src",s+o[n]+"?v="+config.ASSETS_VERSION),t.parent().find(".on").removeClass("on"),t.addClass("on")}),p.find(".playerColor").eq(r).click();var d=e("#autoPlay");i&&d.attr("checked","checked"),c.on("click",".confirmBtn",function(){var e=p.find(".on").index(),t=!!d[0].checked;l.savePlayer(e,t,function(){f.close()})}),f.open()},savePlayer:function(e,t,n){this.callback(e,t),n()}};return n}),function(e){e.fn.qrcode=function(t){function i(e){this.mode=n,this.data=e}function s(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function o(e,t){if(void 0==e.length)throw Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function u(e,t){this.totalCount=e,this.dataCount=t}function a(){this.buffer=[],this.length=0}var n;i.prototype={getLength:function(){return this.data.length},write:function(e){for(var t=0;t<this.data.length;t++)e.put(this.data.charCodeAt(t),8)}},s.prototype={addData:function(e){this.dataList.push(new i(e)),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var e=1,e=1;40>e;e++){for(var t=u.getRSBlocks(e,this.errorCorrectLevel),n=new a,r=0,i=0;i<t.length;i++)r+=t[i].dataCount;for(i=0;i<this.dataList.length;i++)t=this.dataList[i],n.put(t.mode,4),n.put(t.getLength(),f.getLengthInBits(t.mode,e)),t.write(n);if(n.getLengthInBits()<=8*r)break}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[n][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),7<=this.typeNumber&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=s.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++)if(!(-1>=e+n||this.moduleCount<=e+n))for(var r=-1;7>=r;r++)-1>=t+r||this.moduleCount<=t+r||(this.modules[e+n][t+r]=0<=n&&6>=n&&(0==r||6==r)||0<=r&&6>=r&&(0==n||6==n)||2<=n&&4>=n&&2<=r&&4>=r?!0:!1)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var r=f.getLostPoint(this);if(0==n||e>r)e=r,t=n}return t},createMovieClip:function(e,t,n){e=e.createEmptyMovieClip(t,n),this.make();for(t=0;t<this.modules.length;t++)for(var n=1*t,r=0;r<this.modules[t].length;r++){var i=1*r;this.modules[t][r]&&(e.beginFill(0,100),e.moveTo(i,n),e.lineTo(i+1,n),e.lineTo(i+1,n+1),e.lineTo(i,n+1),e.endFill())}return e},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=0==e%2)},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(null==this.modules[r][i])for(var s=-2;2>=s;s++)for(var o=-2;2>=o;o++)this.modules[r+s][i+o]=-2==s||2==s||-2==o||2==o||0==s&&0==o?!0:!1}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;18>n;n++)r=!e&&1==(t>>n&1),this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r},setupTypeInfo:function(e,t){for(var n=f.getBCHTypeInfo(this.errorCorrectLevel<<3|t),r=0;15>r;r++){var i=!e&&1==(n>>r&1);6>r?this.modules[r][8]=i:8>r?this.modules[r+1][8]=i:this.modules[this.moduleCount-15+r][8]=i}for(r=0;15>r;r++)i=!e&&1==(n>>r&1),8>r?this.modules[8][this.moduleCount-r-1]=i:9>r?this.modules[8][15-r-1+1]=i:this.modules[8][15-r-1]=i;this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,i=7,s=0,o=this.moduleCount-1;0<o;o-=2)for(6==o&&o--;;){for(var u=0;2>u;u++)if(null==this.modules[r][o-u]){var a=!1;s<e.length&&(a=1==(e[s]>>>i&1)),f.getMask(t,r,o-u)&&(a=!a),this.modules[r][o-u]=a,i--,-1==i&&(s++,i=7)}r+=n;if(0>r||this.moduleCount<=r){r-=n,n=-n;break}}}},s.PAD0=236,s.PAD1=17,s.createData=function(e,t,n){for(var t=u.getRSBlocks(e,t),r=new a,i=0;i<n.length;i++){var o=n[i];r.put(o.mode,4),r.put(o.getLength(),f.getLengthInBits(o.mode,e)),o.write(r)}for(i=e=0;i<t.length;i++)e+=t[i].dataCount;if(r.getLengthInBits()>8*e)throw Error("code length overflow. ("+r.getLengthInBits()+">"+8*e+")");for(r.getLengthInBits()+4<=8*e&&r.put(0,4);0!=r.getLengthInBits()%8;)r.putBit(!1);for(;!(r.getLengthInBits()>=8*e);){r.put(s.PAD0,8);if(r.getLengthInBits()>=8*e)break;r.put(s.PAD1,8)}return s.createBytes(r,t)},s.createBytes=function(e,t){for(var n=0,r=0,i=0,s=Array(t.length),u=Array(t.length),a=0;a<t.length;a++){var l=t[a].dataCount,c=t[a].totalCount-l,r=Math.max(r,l),i=Math.max(i,c);s[a]=Array(l);for(var h=0;h<s[a].length;h++)s[a][h]=255&e.buffer[h+n];n+=l,h=f.getErrorCorrectPolynomial(c),l=(new o(s[a],h.getLength()-1)).mod(h),u[a]=Array(h.getLength()-1);for(h=0;h<u[a].length;h++)c=h+l.getLength()-u[a].length,u[a][h]=0<=c?l.get(c):0}for(h=a=0;h<t.length;h++)a+=t[h].totalCount;n=Array(a);for(h=l=0;h<r;h++)for(a=0;a<t.length;a++)h<s[a].length&&(n[l++]=s[a][h]);for(h=0;h<i;h++)for(a=0;a<t.length;a++)h<u[a].length&&(n[l++]=u[a][h]);return n},n=4;for(var f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;0<=f.getBCHDigit(t)-f.getBCHDigit(f.G15);)t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15);return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;0<=f.getBCHDigit(t)-f.getBCHDigit(f.G18);)t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case 0:return 0==(t+n)%2;case 1:return 0==t%2;case 2:return 0==n%3;case 3:return 0==(t+n)%3;case 4:return 0==(Math.floor(t/2)+Math.floor(n/3))%2;case 5:return 0==t*n%2+t*n%3;case 6:return 0==(t*n%2+t*n%3)%2;case 7:return 0==(t*n%3+(t+n)%2)%2;default:throw Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new o([1],0),n=0;n<e;n++)t=t.multiply(new o([1,l.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&10>t)switch(e){case 1:return 10;case 2:return 9;case n:return 8;case 8:return 8;default:throw Error("mode:"+e)}else if(27>t)switch(e){case 1:return 12;case 2:return 11;case n:return 16;case 8:return 10;default:throw Error("mode:"+e)}else{if(!(41>t))throw Error("type:"+t);switch(e){case 1:return 14;case 2:return 13;case n:return 16;case 8:return 12;default:throw Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;r<t;r++)for(var i=0;i<t;i++){for(var s=0,o=e.isDark(r,i),u=-1;1>=u;u++)if(!(0>r+u||t<=r+u))for(var a=-1;1>=a;a++)0>i+a||t<=i+a||0==u&&0==a||o==e.isDark(r+u,i+a)&&s++;5<s&&(n+=3+s-5)}for(r=0;r<t-1;r++)for(i=0;i<t-1;i++)if(s=0,e.isDark(r,i)&&s++,e.isDark(r+1,i)&&s++,e.isDark(r,i+1)&&s++,e.isDark(r+1,i+1)&&s++,0==s||4==s)n+=3;for(r=0;r<t;r++)for(i=0;i<t-6;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(i=0;i<t;i++)for(r=0;r<t-6;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);for(i=s=0;i<t;i++)for(r=0;r<t;r++)e.isDark(r,i)&&s++;return e=Math.abs(100*s/t/t-50)/5,n+10*e}},l={glog:function(e){if(1>e)throw Error("glog("+e+")");return l.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;256<=e;)e-=255;return l.EXP_TABLE[e]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},c=0;8>c;c++)l.EXP_TABLE[c]=1<<c;for(c=8;256>c;c++)l.EXP_TABLE[c]=l.EXP_TABLE[c-4]^l.EXP_TABLE[c-5]^l.EXP_TABLE[c-6]^l.EXP_TABLE[c-8];for(c=0;255>c;c++)l.LOG_TABLE[l.EXP_TABLE[c]]=c;return o.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<e.getLength();r++)t[n+r]^=l.gexp(l.glog(this.get(n))+l.glog(e.get(r)));return new o(t,0)},mod:function(e){if(0>this.getLength()-e.getLength())return this;for(var t=l.glog(this.get(0))-l.glog(e.get(0)),n=Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<e.getLength();r++)n[r]^=l.gexp(l.glog(e.get(r))+t);return(new o(n,0)).mod(e)}},u.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],u.getRSBlocks=function(e,t){var n=u.getRsBlockTable(e,t);if(void 0==n)throw Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var r=n.length/3,i=[],s=0;s<r;s++)for(var o=n[3*s+0],a=n[3*s+1],f=n[3*s+2],l=0;l<o;l++)i.push(new u(a,f));return i},u.getRsBlockTable=function(e,t){switch(t){case 1:return u.RS_BLOCK_TABLE[4*(e-1)+0];case 0:return u.RS_BLOCK_TABLE[4*(e-1)+1];case 3:return u.RS_BLOCK_TABLE[4*(e-1)+2];case 2:return u.RS_BLOCK_TABLE[4*(e-1)+3]}},a.prototype={get:function(e){return 1==(this.buffer[Math.floor(e/8)]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},"string"==typeof t&&(t={text:t}),t=e.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,correctLevel:2,background:"#ffffff",foreground:"#000000"},t),this.each(function(){var n;if("canvas"==t.render){n=new s(t.typeNumber,t.correctLevel),n.addData(t.text),n.make();var i=document.createElement("canvas");i.width=t.width,i.height=t.height;for(var o=i.getContext("2d"),u=t.width/n.getModuleCount(),a=t.height/n.getModuleCount(),f=0;f<n.getModuleCount();f++)for(var l=0;l<n.getModuleCount();l++){o.fillStyle=n.isDark(f,l)?t.foreground:t.background;var c=Math.ceil((l+1)*u)-Math.floor(l*u),p=Math.ceil((f+1)*u)-Math.floor(f*u);o.fillRect(Math.round(l*u),Math.round(f*a),c,p)}}else{n=new s(t.typeNumber,t.correctLevel),n.addData(t.text),n.make(),i=e("<table></table>").css("width",t.width+"px").css("height",t.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",t.background),o=t.width/n.getModuleCount(),u=t.height/n.getModuleCount();for(a=0;a<n.getModuleCount();a++){f=e("<tr></tr>").css("height",u+"px").appendTo(i);for(l=0;l<n.getModuleCount();l++)e("<td></td>").css("width",o+"px").css("background-color",n.isDark(a,l)?t.foreground:t.background).appendTo(f)}}n=i,jQuery(n).appendTo(this)})}}($),define("plugin/jquery-qrcode",function(){});var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){var t=this.className.split(/\s+/),n=-1;for(var r=0;r<t.length;r++)t[r]==e&&(n=r,r=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,n){var r=this.clients[e];r&&r.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};while(e&&e!=t)n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent;return n},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(e,t,n){this.domElement=ZeroClipboard.$(e);var r=99;this.domElement.style.zIndex&&(r=parseInt(this.domElement.style.zIndex,10)+1),typeof t=="string"?t=ZeroClipboard.$(t):typeof t=="undefined"&&(t=document.getElementsByTagName("body")[0]);var i=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div");var s=this.div.style;s.position="absolute",s.left=""+i.left+"px",s.top=""+i.top+"px",s.width=""+i.width+"px",s.height=""+i.height+"px",s.zIndex=r;if(typeof n=="object")for(var o in n)s[o]=n[o];t.appendChild(this.div),this.div.innerHTML=this.getHTML(i.width,i.height)},getHTML:function(e,t){var n="",r="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var i=location.href.match(/^https/i)?"https://":"http://";n+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+i+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+r+'"/><param name="wmode" value="transparent"/></object>'}else n+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+r+'" wmode="transparent" />';return n},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){e&&(this.domElement=ZeroClipboard.$(e),this.domElement||this.hide());if(this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),n=this.div.style;n.left=""+t.left+"px",n.top=""+t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");switch(e){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var n=this;setTimeout(function(){n.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var n=this;setTimeout(function(){n.receiveEvent("load",null)},100),this.ready=!0;return}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var r=0,i=this.handlers[e].length;r<i;r++){var s=this.handlers[e][r];typeof s=="function"?s(this,t):typeof s=="object"&&s.length==2?s[0][s[1]](this,t):typeof s=="string"&&window[s](this,t)}}},define("plugin/zero_clipboard",function(){}),define("module/dialogs/share2friend",["jquery","plugin/dialog","module/dialogs/edit_player","module/dialogs/erweima","plugin/jquery-qrcode","plugin/zero_clipboard"],function(e,t,n,r){ZeroClipboard.setMoviePath(config.STATIC_PATH+"/cdnswf/zero_clipboard.swf");var i={open:function(t,n,r,i){this.callback=i||e.noop,this.autoPlay=!1,this.styleIdx=0,this.createPop(t,n,r)},createPop:function(e,t,n){var r=this.createPop1(e,t,n);r.open()},createPop2:function(n){var i='<div class="popup_dl"><strong>把声音嵌入到移动应用、微信公众号</strong></div><div class="popup_dl">   <span class="title">微电台地址</span><input type="text" value="" class="j-weidiantai-url"><a class="copylinkBtn fr">复制链接</a></div><div class="popup_dl"><strong>音频二维码</strong> <span class="color999">扫一扫即可在手机上播该声音</span><span class="fr"><a href="javascript:;" class="editBtn editErweima" title="编辑二维码">编辑二维码样式</a></span></div><img style="width:155px;height:155px;cursor:pointer;" class="erweima" alt="" />',s={dialogClass:"sharetoFriend",header:"获取主播链接",width:450,content:i},o=window.location.host,u=config.PLAYER_PATH||"http://"+o+"/js/player"+"_"+o.split(".")[0]+".swf",a=u+(u.indexOf("?")>0?"&":"?")+"id="+0,f='<object type="application/x-shockwave-flash" id="ximalaya_player" data="'+a+'" width="255" height="34"></object>',l=new t.Dialog(s);this.pop=l;var c=l.getEl();return this.setUrl(c,"user",n,0,0,!1),c.find(".copylinkBtn").each(function(){var t=e(this);t.parent().css("position","relative");var n=new ZeroClipboard.Client,r=!1;n.addEventListener("load",function(){r=!0}),n.addEventListener("mouseDown",function(){if(!r)return;var e=t.parent().find("input"),i=e.val();if(!i||t.hasClass("already"))return;n.setText(i)}),n.addEventListener("complete",function(){var e=t.parent().find("input[type='text']");e.select(),t.text("复制成功"),t.addClass("already"),setTimeout(function(){t.text("复制地址"),t.removeClass("already"),l.close()},1e3)}),n.glue(t[0],t.parent()[0],{fontSize:"0",lineHeight:t.height()})}),c.find(".erweima").on("click",function(){var t=e(this).attr("src");t&&(location.href="/audio_qrcode?url="+t);return}),r.getCode(c.find(".j-weidiantai-url").val(),function(e){c.find(".erweima").attr("src",e)}),l},createPop1:function(r,i,s,o){var u='<div class="popup_dl"></div><div class="popup_dl"><strong>把声音贴到blog、BBS或嵌入网页：<a target="_blank" href="http://blog.ximalaya.com/zhuan-zai/">怎么贴?</a></strong><span class="fr"><a href="javascript:;" class="editBtn editStyle" title="编辑播放器样式">编辑播放器样式</a></span></div><div class="popup_dl"><span class="title">flash地址</span><input type="text" class="j-flash-url"><a class="copylinkBtn fr">复制地址</a></div><div class="popup_dl"><span class="title">html地址</span><input type="text"  class="j-html-url"><a class="copylinkBtn fr">复制地址</a></div><div class="popup_dl"><span class="title">通用代码</span><input type="text" class="j-common-code"><a class="copylinkBtn fr">复制链接</a></div><div class="popup_dl"><strong>把声音嵌入到移动应用、微信公众号</strong></div><div class="popup_dl">   <span class="title">微电台地址</span><input type="text" class="j-weidiantai-url"><a class="copylinkBtn fr">复制链接</a></div><div class="popup_dl"><strong>音频二维码</strong> <span class="color999">扫一扫即可在手机上播放声音</span><span class="fr"><a href="javascript:;" class="editBtn editErweima" title="编辑二维码">编辑二维码样式</a></span></div><img style="width:155px;height:155px;cursor:pointer;" class="erweima" alt="" />',a={dialogClass:"sharetoFriend",header:r=="album"?"获取专辑链接":"获取声音链接",width:450,content:u},f=new t.Dialog(a),l=this;this.pop=f;var c=f.getEl();return this.setUrl(c,r,s,i),o=o||"",c.find(".j-text-url").val(o),c.on("click",".editStyle",function(){n.open(r,l.styleIdx,l.autoPlay,function(e,t){l.setUrl(c,r,s,i,e,t)})}),c.find(".erweima").on("click",function(){var t=e(this).attr("src");t&&(location.href="/audio_qrcode?url="+t);return}),c.find(".copylinkBtn").each(function(){var t=e(this);t.parent().css("position","relative");var n=new ZeroClipboard.Client,r=!1;n.addEventListener("load",function(){r=!0}),n.addEventListener("mouseDown",function(){if(!r)return;var e=t.parent().find("input"),i=e.val();if(!i||t.hasClass("already"))return;n.setText(i)}),n.addEventListener("complete",function(){var e=t.parent().find("input[type='text']");e.select(),t.text("复制成功"),t.addClass("already"),setTimeout(function(){t.text("复制地址"),t.removeClass("already")},1e3)}),n.glue(t[0],t.parent()[0],{fontSize:"0",lineHeight:t.height()})}),f},setUrl:function(e,t,n,i,s,o){s=s||0,this.autoPlay=!!o,this.styleIdx=s;var u=window.location.host,a="http://"+u+"/"+n+"/"+t+"/"+i,f="http://m."+(u.indexOf("www")>=0?u.substring(4):u)+"/zhubo/"+n,l="http://m."+(u.indexOf("www")>=0?u.substring(4):u)+"/"+n+"/"+t+"/"+i,c="id="+i,h=260,p=36;o&&(c+="&auto=true"),t=="album"&&(p=230);var d=["red","orange","yellow","green","blue","purple"],v=d[s],m="http://"+u+"/swf/"+t+"/"+v+".swf";/test/.test(u)&&(m="http://"+u+"/swf/test/"+t+"/"+v+".swf");var g=m+(m.indexOf("?")>0?"&":"?")+c,y='<object type="application/x-shockwave-flash" id="ximalaya_player" data="'+g+'" width="'+h+'" height="'+p+'"></object>',b='<iframe height="'+p+'" width="'+h+'" src="'+g+'" frameborder=0 allowfullscreen></iframe>';e.find(".j-track-url").val(a),e.find(".j-flash-url").val(g),e.find(".j-html-url").val(y),e.find(".j-common-code").val(b),e.find(".j-weidiantai-url").val(t=="user"?f:l),e.on("click",".editErweima",function(){r.create(e.find(".erweima"),t=="user"?f:l)}),r.getCode(t=="user"?f:l,function(t){e.find(".erweima").attr("src",t)})}};return i}),define("module/player/mainfollower_view",["jquery","underscore","backbone","./model","./follower_view","helper","router","module/dialogs/share2friend","module/dialogs/download","plugin/perfect-scrollbar/perfect-scrollbar.jquery"],function(e,t,n,r,i,s,o,u,a){function c(){var e=localStorage.last_play_model;e==0&&f.orderPlay(),e==1&&f.loopPlay(),e==2&&f.randomPlay(),h(e)}function h(t){var n=e(".player_modeBtn");t==1&&n.addClass("loopplayBtn").removeClass("orderplayBtn").removeClass("randomplayBtn").attr("title","单曲循环"),t==0&&n.addClass("orderplayBtn").removeClass("loopplayBtn").removeClass("randomplayBtn").attr("title","顺序播放"),t==2&&n.addClass("randomplayBtn").removeClass("orderplayBtn").removeClass("loopplayBtn").attr("title","随机播放")}function p(){var t=localStorage.last_sound_id,n=localStorage.last_sound_position,r=localStorage.last_sound_ids;if(!t)return;r=r||t,n=n||0,f.soundIds(r.split(",")),f.select(t,function(){f.loadeds.push(t),e("[sound_id="+t+"]").show().attr("last_position",n)})}function d(){c(),p()}var f=r.mainPlayer,l=i.extend({events:t.extend({"click .prevBtn:not(.disabled)":"prev","click .nextBtn:not(.disabled)":"next","click .orderplayBtn":"clickOrderPlayBtn","click .randomplayBtn":"clickRandomPlayBtn","click .loopplayBtn":"clickLoopPlayBtn","click .glp-mini .btn-more":"spread","click .glp-block .btn-more":"unSpread","click .btn-list":"toggleList","click .btn-close":"closeList","click .btn-share":"toggleShareBanner",scroll:"onScroll","click .ic-dload":"download"},i.prototype.events),initialize:function(){var t=this,n=this.$el;i.prototype.initialize.apply(this,arguments),this.$playModelbtn=this.$el.find(".player_modeBtn"),this.$glpMini=n.find(".glp-mini"),this.$glpBlock=n.find(".glp-block"),this.$btnOpen=n.find(".glp-mini .btn-more"),this.$btnClose=n.find(".glp-block .btn-more"),this.$playList=n.find(".play-list"),this.$sharePanel=n.find(".share-panel2"),this.$volumePanel=n.find(".volume-panel"),this.$btnVolume=n.find(".volume-panel .btn2"),this.$btnShare=n.find(".btn-share"),this.$btnList=n.find(".btn-list"),this.$bdsharebuttonbox=n.find(".bdsharebuttonbox"),this.$shareLink=n.find(".js-sharelink"),this.$soundList=this.$playList.find("ul"),this.$soundListCont=this.$el.find(".list-cont"),f.on("change:sound",function(e,n){t.renderBtns(),t.$el.show(),t.changeBaiduShareData(n),t.changeShareLink(n),t.renderSoundList(n)},this),f.on("change:soundIds",function(e,n){t.renderBtns(),t.$soundList.attr("sound_ids",n),t.$btnList.is(".open")?t.getList(!1):t.getList(!0)},this),this.$shareLink.on("click",function(){var t=e(this),n=t.attr("track_id"),r=t.attr("track_uid");u.open("sound",n,r)}),f.on("change:playModel",function(e,n){t.renderPlayModelBtn()}),document.createEvent&&this.$soundListCont.perfectScrollbar()},renderPlayModelBtn:function(){var e=f.get("playModel");h(e)},renderSoundList:function(){var e=f.sound(),t=e.id,n=this.$soundList,r=n.find("[sound_id="+t+"]"),i=n.find(".cur");i.removeClass("cur"),r.addClass("cur")},download:function(){a.open()},changeShareLink:function(e){this.$shareLink.attr("track_id",e.id),this.$shareLink.attr("track_uid",e.uid)},changeBaiduShareData:function(e){this.$bdsharebuttonbox.find('[data-cmd="weixin"]').attr("data-url",config.WAP_ROOT+"/"+e.uid+"/sound/"+e.id),this.$bdsharebuttonbox.find('[data-cmd="tsina"]').attr("data-url","http://"+window.location.host+"/thirdparty/linkcard/track_"+e.id);var t={bdDes:"喜马拉雅好声音",text:"我觉得《"+e.title+"》听起来挺不错的，你觉得呢？（分享自 @喜马拉雅FM ）",title:e.title,pic:e.cover_url||e.soundfaceMiddle||e.soundface,url:"http://"+window.location.host+"/"+e.uid+"/sound/"+e.id};this.$bdsharebuttonbox.data("baidu_share",t)},onScroll:function(){return!1},toggleShareBanner:function(){var e=this.$el;if(!e.is("[sound_id]"))return;this.$btnShare.toggleClass("open"),this.$volumePanel.removeClass("open"),this.$btnList.removeClass("open"),this.$playList.addClass("hidden")},closeList:function(){this.$btnList.removeClass("open"),this.$playList.addClass("hidden")},toggleList:function(){this.$playList.toggleClass("hidden"),this.$volumePanel.removeClass("open"),this.$btnShare.removeClass("open"),this.$btnList.is(".open")?this.$btnList.removeClass("open"):(this.$btnList.addClass("open"),this.getList(!1))},getList:function(e){var t=this;f.getList(e,function(e){t.renderList(e),t.player.render(t.$playList),t.renderSoundList();if(document.createEvent){var n=t.$soundList.find(".cur");if(!n.size())return;var r=n.offset().top-t.$soundList.offset().top;t.$soundListCont[0].scrollTop=r-100,t.$soundListCont.perfectScrollbar("update")}})},renderList:function(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=e[n];i.title&&i.uid&&(t+=['<li class="item playBtn" sound_id="'+i.id+'">','<div class="fl">','<i class="ic ic-player1"></i>',"</div>",'<div class="author elli fr">','<a href="/zhubo/'+i.uid+'" hashlink>',i.nickname,"</a>","</div>",'<p class="tit-elli">','<a href="/sound/'+i.id+'" hashlink>',i.title,"</a>","</p>","</li>"].join(""))}this.$soundList.html(t)},spread:function(){this.$glpMini.css({transition:"all .3s ease 0s",left:"-90px"}),this.$glpBlock.css({transition:"all .5s ease .3s",left:"0"})},unSpread:function(){this.$btnShare.removeClass("open"),this.$volumePanel.removeClass("open"),this.$btnList.removeClass("open"),this.$playList.addClass("hidden"),this.$glpBlock.css({transition:"all .5s ease 0s",left:"-800px"}),this.$glpMini.css({transition:"all .3s ease .5s",left:"0"})},prev:function(){f.prev()},next:function(){f.next()},play:function(e){var t=this.$el,n={};if(!t.is("[sound_id]"))return;if(t.is("[last_position]")){var r=t.attr("last_position");t.removeAttr("last_position"),n.position=r||0}this._$playbtn.addClass("player-loading").removeClass("playBtn pauseBtn").attr("title","加载中"),extensionPlayer.isPlaying()&&extensionPlayer.pause(),f.play(n)},needRender:function(){return!0},clickOrderPlayBtn:function(){this.loopPlay()},clickRandomPlayBtn:function(){this.orderPlay()},clickLoopPlayBtn:function(){this.randomPlay()},orderPlay:function(){f.orderPlay()},randomPlay:function(){f.randomPlay()},loopPlay:function(){f.loopPlay()},render:function(t,n){i.prototype.render.apply(this,arguments);var r=this.$el;if(n&&n.id){var s=e("<span>").html(n.title).text();r.find(".title").html(s).attr("href","/"+n.uid+"/sound/"+n.id+"/").attr("title",s).attr("hashlink"),r.is(":hidden")&&(r.fadeIn(200),r.trigger("onfirstshow"))}},renderBtns:function(){var e=this.$el,t=e.find(".prevBtn"),n=e.find(".nextBtn"),r=this._$playbtn;f.preable()?t.removeClass("is-btn-disabled").attr("title","上一首"):t.addClass("is-btn-disabled").attr("title",""),f.nextable()?n.removeClass("is-btn-disabled").attr("title","下一首"):n.addClass("is-btn-disabled").attr("title",""),f.playable()?r.removeClass("is-btn-disabled").attr("title","播放"):r.addClass("is-btn-disabled").attr("title","")},release:function(){this.unSpread()}});return soundManager.onready(function(){d()}),l}),define("module/player/min_view",["jquery","underscore","backbone","./model","./view"],function(e,t,n,r,i){var s=i.extend({events:{click:"onClick"},initialize:function(){i.prototype.initialize.apply(this,arguments),this._$playbtn=this.$el},onSoundUnexist:function(e){i.prototype.onSoundUnexist.apply(this,arguments);if(e!=this._soundId)return!1;var t=this.$el;t.find(".warning").html("该声音不存在").addClass("removed").removeAttr("href")},onClick:function(){var e=this.$el;if(e.is(".disabled"))return!1;e.is(".playBtn")&&this.play()},play:function(t){var n=this,r=this.$el,i=r.attr("sound_id");if(t&&extensionPlayer.isInExtension(e(t.currentTarget)))return;if(r.is("[last_position]")){var s=r.attr("last_position");r.removeAttr("last_position")}mainPlayer.select(i,function(e){var t=n.getPlayOptions();s&&(t.position=s),mainPlayer.play(t)})},pause:function(){},rendPlaybtn:function(){return this.isWorking()?!0:!1}});return s}),define("module/player/player",["jquery","underscore","backbone","./volume_view","./view","./follower_view","./mainfollower_view","./min_view","module/wave","module/comment2d/comment2d","./model"],function(e,t,n,r,i,s,o,u,a,f,l){var c=l.mainPlayer,h=null,p=e(".volume-panel");p.size()&&new r({el:p[0]});var d={volume:h,views:[],mainPlayer:null,render:function(t){var n=t||{},r=n.$container,i=n.waveRenderDelay||!1,s;r?(s=r.find("[sound_id]"),r.is("[sound_id]")&&(s=r)):s=e("[sound_id]"),s=s.add(".globalplayer");for(var o=0,u=s.size();o<u;o++)this.bindView(s.eq(o));this.renderComment2dViews(),i||a.render(t)},init:function(){var e=this;soundManager.onready(function(){e.render()})},bindView:function(e){var t=e[0],n=null;if(this.isBinded(e))return;e.data("viewIsBinded",!0);if(e.is("[sound_extension]")){e.extensionPlayer();return}e.is(".globalplayer")?(this.mainPlayer=new o({el:t}),this.mainPlayer.player=this):e.is(".follower")?n=new s({el:t}):e.is(".playBtn")?n=new u({el:t}):n=new i({el:t}),n&&this.views.push(n)},renderComment2dViews:function(){var e=[],t=this.views,n;for(var r=0,i=t.length;r<i;r++)n=t[r],n.hasComment2d()&&e.push(n.getComment2dView());f.render(e)},soundIds:function(e){c.soundIds(e)},appendSoundIds:function(e){var t=c.soundIds();for(var n=0,r=e.length;n<r;n++)t.push(e[n])},isBinded:function(e){return e.data("viewIsBinded")},removeSound:function(e){c.removeSoundId(e)},release:function(e){try{var n=[],r=e||{},i=r.$container;if(i!==undefined)for(var s=0,o=this.views.length;s<o;s++){var u=this.views[s],a=u.$el;i.find(a).size()&&n.push(u)}else n=this.views;for(s=0,o=n.length;s<o;s++)u=n[s],u.release();i!==undefined?this.views=t.difference(this.views,n):this.views=[],this.mainPlayer.release()}catch(f){window.console&&console.log(f)}}};return d}),define("module/common/nav",["jquery","backbone","helper"],function(e,t,n){function r(e){this.$el=e,this.bindEvents()}r.prototype.active=function(e,t){var n=this.$el;this.clear(),n.find("[nav-item="+e+"]").addClass("active"),n.find("[nav-sub="+t+"]").addClass("active")},r.prototype.clear=function(){var e=this.$el;e.find(".active").removeClass("active")},r.prototype.bindEvents=function(){var t=this;this.$el.on("click",".item-tit",function(){var n=e(this),r=n.closest("[nav-item]");r.find("a[hashlink]").length&&(t.clear(),r.addClass("active"),r.find("[nav-sub]").eq(0).addClass("active"))}),this.$el.on("click",".sub-tit",function(){var t=e(this),n=t.closest("[nav-item]");n.find(".active").removeClass("active"),e(this).addClass("active")})};var i=new r(e(".mainnav"));return i}),define("module/common/iverify",["jquery","underscore","backbone","model/letter","plugin/dialog","module/common/iletterbox","plugin/count_char","plugin/face","plugin/dialog","router","module/common","plugin/jquery.parser"],function(e,t,n,r,i,s,o,u,i,a,f){var l=n.View.extend({initialize:function(){this.model.on("invalid",function(e,t){i.alert(t)}),this.render()},init:function(){this.release(),e("i.VIcon").on("click",[this],this.gotoVerigy),e("span.BVIcon").on("click",[this],this.gotoVerigy)},gotoVerigy:function(e){return helper.isLogin()?a.toPage("/verify"):f.mustLogin("/verify"),e.preventDefault(),!1},render:function(){},release:function(){e("i.VIcon").off("click"),e("span.BVIcon").off("click")}});return new l({model:new n.Model})}),define("module/bottom/downloadbar",["jquery"],function(e){var t=function(){};return t.prototype={getTemplate:function(){var e='<div class="extension-bar-wrap" id="bottom-download-bar">	<div class="extension-bar">		<div class="extension-bar-sub">			<div class="wave-bar">				<img class="mountain1" src="'+config.STATIC_PATH+'/css/img/promotion_img_mountain1.png" alt="">'+'				<img class="mountain2" src="'+config.STATIC_PATH+'/css/img/promotion_img_mountain2.png" alt="">'+"			</div>"+'			<div class="logo-cat">'+'				<img class="xicat" src="'+config.STATIC_PATH+'/css/img/promotion_img_xicat.png" alt="">'+'				<img class="slogan" src="'+config.STATIC_PATH+'/css/img/promotion_img_slogan.png" alt="">'+"			</div>"+'			<div class="code-upload">'+'				<div class="">'+'					<img class="QRcode" src="'+config.STATIC_PATH+'/css/img/promotion_img_QRcode.png" alt="">'+'					<div class="ios-andriod-uplaod">'+'						<a class="btn btn-andriod-upload" target="_blank" href="http://www.ximalaya.com/down?tag=web&amp;client=android">安卓版下载</a>'+'						<a class="btn btn-ios-upload" target="_blank" href="http://www.ximalaya.com/down?tag=web&amp;client=ios">ios版下载</a>'+"					</div>"+"				</div>"+"				"+'				<div class="btn-closed">'+"					<a>"+'						<img src="'+config.STATIC_PATH+'/css/img/promotion_ic_x_n.png">'+"					</a>"+"				</div>"+"			</div>"+"		</div>"+"	</div>"+"</div>";return e},init:function(){var t=this.getTemplate(),n=this,r=!1,i=setTimeout(function(){n.init()},1e4);current_user&&current_user.uid&&(r=!0),sessionStorage["downloadbar-close"]=="true"&&(r=!0),localStorage["downloadbar-down"]=="true"&&(r=!0);if(r)return e("#bottom-download-bar").addClass("hidden"),!1;if(e("#bottom-download-bar").length)e("#bottom-download-bar").removeClass("hidden");else{var s=e(t).appendTo(e("body"));this.bindEvent(s)}},bindEvent:function(e){e.find(".btn-closed").on("click",function(){e.addClass("hidden"),sessionStorage["downloadbar-close"]="true"}),e.find(".ios-andriod-uplaod a").on("click",function(){e.addClass("hidden"),localStorage["downloadbar-down"]="true"})}},new t}),define("plugin/common",["jquery","underscore","backbone","plugin/dialog"],function(e,t,n,r){e("body").on("click","[popsrc]",function(){var t=e(this).attr("popsrc");if(!t)return;var n=new r.Dialog({fixed:!1,overlayer:{clickClose:!0,opacity:.5},template:{dialog_container:'<div class="gPopupMulti" dialog-role="container" style="padding:0;"></div>',dialog_body:'<div class="mask"></div><div class="con" dialog-role="body" style="border:none;background-color:#fff;"></div>',dialog_close:'<div class="close6Btn" dialog-role="close"></div>'},content:'<div id="imgPlaceholder" class="imgLoading" style="margin: 80px 0;"></div>',width:300});n.open();var i=new Image;return i.src=t,i.style.display="",function(){if(i.complete){if(i.width>640){var t=640/i.width;i.height=i.height*t,i.width=640}e("#imgPlaceholder").replaceWith(e(i)),n.setWidth(i.width),n.setPosition()}else setTimeout(arguments.callee,50)}(),!1})}),define("plugin/jquery.search",["jquery"],function(e){(function(e){e.fn.searchBox=function(t){var n={keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},localStorage:{get:function(e,t){var n=localStorage.getItem(e);return n=n===undefined?null:n,n!==null?t?decodeURIComponent(n):n:n},getJson:function(e,t){var n=this.get(e,t);if(n)try{return JSON.parse(n)}catch(r){console&&console.log(r)}return n},set:function(e,t,n){try{this.remove(e);var r=n?encodeURIComponent(t):t;localStorage.setItem(e,r)}catch(i){console&&console.log(i)}},setJson:function(e,t,n){var r="";try{r=JSON.stringify(t)}catch(i){console&&console.log(i)}try{this.remove(e);var s=n&&!1?encodeURIComponent(r):r;localStorage.setItem(e,s)}catch(i){console&&console.log(i)}},remove:function(e){localStorage.removeItem(e)},clear:function(){localStorage.clear()}},cookie:{get:function(t,n){var r=e.cookie(t);return r=r===undefined?null:r,r!==null?n?decodeURIComponent(r):r:r},getJson:function(e,t){var n=this.get(e,t);if(n)try{return JSON.parse(n)}catch(r){console&&console.log(r)}return n},set:function(t,n,r){var i=r?encodeURIComponent(n):n;e.cookie(t,i,{expires:1728e3,domain:".ximalaya.com",path:"/"})},setJson:function(t,n,r){var i="";try{i=JSON.stringify(n)}catch(s){console&&console.log(s)}i=r?encodeURIComponent(i):i,e.cookie(t,i,{expires:1728e3,domain:"ximalaya.com",path:"/"})},remove:function(t){e.cookie(t,"",{expires:-1,path:"/"})},clear:function(){}}},r={supportStorage:"cookie",check:function(){try{window.localStorage&&window.localStorage.setItem("isSurportLocalStorage","supported localStorage"),this.supportStorage="localStorage",window.localStorage.removeItem("isSurportLocalStorage")}catch(e){this.supportStorage="cookie"}return this.store=n[this.supportStorage],this},get:function(e,t){return t=!1,this.store.get(e,t)},getJson:function(e,t){return t=!1,this.store.getJson(e,t)},set:function(e,t,n){return n=!1,this.store.set(e,t,n),this},setJson:function(e,t,n){return n=!1,this.store.setJson(e,t,n),this},remove:function(e){return this.store.remove(e),this}};r.check();var i=function(t){function n(n,r){var i=e(n.el).val();if(i.length>=t.captureLength&&i.toUpperCase()!=n.text||r&&i.length>=t.captureLength){var s=e(n.el);i!==""&&s.attr("data-suggest")!=="off"&&(n.text=i.toUpperCase(),s.attr("data-origin",i),n.cb.call(n.el,i))}}function r(r){var i=r.type.toUpperCase();if(e.inArray(i,t.inputTypes)>=0){var s=r.timer={timer:null,text:e(r).val().toUpperCase(),cb:t.cb,el:r,wait:t.wait};t.highlight&&e(r).focus(function(){this.select()});var o=function(e){var t=s.wait,r=!1,i=this.type.toUpperCase(),o=function(){n(s,r)};clearTimeout(s.timer),s.timer=setTimeout(o,t)};e(r).on("keyup paste focus cut input",o)}}t.inputTypes=["TEXT","TEXTAREA","PASSWORD","TEL","SEARCH","URL","EMAIL","DATETIME","DATE","MONTH","WEEK","TIME","DATETIME-LOCAL","NUMBER","RANGE"],r(this)};return this.each(function(){function d(t){return e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length}function v(e,t,n){var r="",i=0;for(var s=0;s<e.length;s++)e.charCodeAt(s)>127||e.charCodeAt(s)==94?i+=2:i++;if(i<=t)return e;i=0,n=n||"",t=t>d(n)?t-d(n):t;for(var s=0;s<e.length;s++){e.charCodeAt(s)>127||e.charCodeAt(s)==94?i+=2:i++;if(i>t){r+=n;break}r+=e.charAt(s)}return r}function m(t,n,r){if(/:\/\//.test(t)&&window.XDomainRequest)l&&l.abort(),l=new XDomainRequest,l&&(l.onload=function(){var t=e.parseJSON(l.responseText);n.kw===""?r&&r(t,"complete"):r&&r(t,"success")},l.open("get",t+"?"+p.paramMap.keywords+"="+n.kw),l.send());else{if(p.paramMap.keywords){var i=p.paramMap.keywords;i!=="kw"&&(n[i]=n.kw,delete n.kw)}l&&l.abort(),l=e.ajax({url:t,type:"get",data:n,dataType:"json",beforeSend:function(){r&&r(null,"beforeSend")},success:function(e){r&&r(e,"success")},complete:function(e){if(e.readyState===4)try{r&&r(JSON.parse(e.responseText),"complete")}catch(t){r&&r([],"complete")}}})}}function g(e,t){t==="beforeSend"&&a&&a.addClass("loading");if(t==="success"){var n=o.attr("data-scope")||"all",r=p.translateData(e),i=p.render(r,p.templateStr,n,{template:y,cutStr:v});w(i)}t==="complete"&&a&&a.removeClass("loading")}function y(e,t,n){var r="",i="",t=t||[],s=t.length;t=t.reverse();while(s){s--;var o=t[s],i=e;typeof o=="string"&&(o={text:o,title:o});for(var u in o)if(o.hasOwnProperty(u)){u==="text"&&(o.origin=o.text,o.text=v(o.text,n||p.itemCharLength),i=i.replace("{{origin}}",o.origin)),o.title||(o.title=o.text||o.keyword,i=i.replace("{{title}}",o.title)),o.title=o.title.replace(/<\/?.+?>/g,"");var a=new RegExp("{{"+u+"}}","g");i=i.replace(a,o[u])}s===t.length-1?s===0?i=i.replace(/\{\{cls\}\}/,"first last"):i=i.replace(/\{\{cls\}\}/,"first"):s===0&&(i=i.replace(/\{\{cls\}\}/,"last")),r+=i}return r.replace(/\{\{[_a-zA-z]*\}\}/g,"")}function b(){if(!p.showHistory)return;var e=E(p.cacheName),t="";if(r.get("xmHotwordsFS")&&r.get("xmHotwordsFS").indexOf("data")!==-1){var n=r.getJson("xmHotwordsFS"),i=n.data;t=p.render({history:e,hotwords:i},p.templateStr,"init",{template:y,cutStr:v}),w(t),(new Date).getTime()-n.timestamp>p.hotwordUpdataHz&&r.remove("xmHotwordsFS")}else m(p.hotwordsUrl,{size:p.hotwordSize},function(n,i){i==="complete"&&(r.setJson("xmHotwordsFS",{data:n.list,timestamp:(new Date).getTime()}),t=p.render({history:e,hotwords:n.list},p.templateStr,"init",{template:y,cutStr:v}),w(t))})}function w(e){e!==""?(u.find("ul").html(e),u.addClass("loaded")):u.removeClass("loaded")}function E(e){return r.getJson(e,!0)||[]}function S(e){e||r.remove(p.cacheName);var t=E(p.cacheName),n=t.indexOf(e);if(n===-1)return;t.splice(n,1),r.setJson(p.cacheName,t.concat([]),!0)}function x(e){if(e===""||/<[^>]+>/.test(e))return;var t=E(p.cacheName);e=v(e,p.itemCharLength);var n=9999;for(var i=0,s=t.length;i<s;i++)if(t[i]===e)var n=i;n!=9999&&t.splice(n,1),t.push(e),t.length>p.historySize&&(t=t.slice(0-p.historySize)),r.setJson(p.cacheName,t,!0)}function T(e){var t=e||100;clearTimeout(h),h=setTimeout(function(){u&&u.removeClass("loaded")},t)}function N(t){var r=n.keyCode,i=t.keyCode;if(!u.hasClass("loaded"))return!1;var s=u.find("li"),a=s.length,f=u.find("li.active");temValue=o.val(),sIndex=e(s).index(f);var l=function(t){o.attr("data-suggest","off"),c&&clearTimeout(c),c=setTimeout(function(){o.attr("data-suggest","on")},1e3),t===-1?(s.removeClass("active cur"),o.val(o.attr("data-origin"))):(e(s[t]).addClass("active cur").siblings("li").removeClass("active cur"),o.val(e(s[t]).find("[data-kw]").attr("data-kw")))};switch(i){case r.PAGE_UP:case r.UP:sIndex--,sIndex<-1&&(sIndex=a-1),l(sIndex),t.preventDefault();break;case r.PAGE_DOWN:case r.DOWN:sIndex++,sIndex===a&&(sIndex=-1),l(sIndex),t.preventDefault();break;case r.ENTER:var h=u.find("li.cur"),d=e.trim(o.val());d!==""&&x(d),h.length>0?p.selectCallBack&&p.selectCallBack(h):p.callback&&p.callback(d),T(1),o.attr("data-suggest","off"),c&&clearTimeout(c),c=setTimeout(function(){o.attr("data-suggest","on"),T(1)},800);break;case r.ESCAPE:u.removeClass("loaded")}}var s=e(this),o=s.find("input"),u=null,a=s.find(".xui-header-search-button"),f=null,l=null,c=null,h=null,p=e.extend({cls:"",wait:500,highlight:!0,captureLength:0,callback:e.noop,init:e.noop,selectCallBack:e.noop,cacheName:"searchHistory",change:e.noop,historySize:3,hotwordSize:5,itemCharLength:20,searchResultContariner:null,showHistory:!0,clearBtn:!1,hotwordUpdataHz:108e5,historyAction:"del",paramMap:{keywords:"kw",scope:"album"},templateStr:{album2:'<li data-id="{{id}}" class="suggest-item {{cls}}" data-scope="album2"><div class="pic"><img src="{{imgPath}}" onerror="this.parentNode.removeChild(this)" alt=""></div><span class="fr">{{category}}</span><p data-kw="{{keyword}}">{{highlightKeyword}}</p></li>',other:'<li data-id="{{id}}" data-scope="search" class="suggest-item  {{cls}}"><span data-kw="{{keyword}}" title="{{title}}">{{highlightKeyword}}</span></li>',user:'<li data-id="{{id}}" data-scope="user" data-follow="{{is_follow}}" class="suggest-item  {{cls}}"><span title="{{title}}">{{text}}</span></li>',voice:'<li data-id="{{id}}" data-scope="voice"  class="suggest-item  {{cls}}"><span title="{{title}}">{{text}}</span></li>',album:'<li data-id="{{id}}" data-scope="album" class="suggest-item  {{cls}}"><span title="{{title}}">{{text}}</span></li>',history:'<li  data-scope="history"  class="suggest-item init-group history  {{cls}}"><span data-text="{{origin}}" title="{{title}}" data-kw="{{text}}">{{text}}</span><i class="cmd" data-cmd="del">删除</i></li>',hotwords:'<li data-id="{{id}}" data-scope="hotwords" class="suggest-item init-group hotwords {{cls}}"><span title="{{title}}" data-kw="{{text}}">{{text}}</span></li>'},render:function(e,t,n,r){if(n==="init")return r.template(t.history,e.history.reverse())+r.template(t.hotwords,e.hotwords);if(n==="all"){var i=r.template(t.album2,e.albumResultList)+r.template(t.other,e.queryResultList);return i}return r.template(t[n],e)},translateData:function(e){return e},url:"/search/suggest",hotwordsUrl:"/search/hotword"},t);p.cb=function(t,n){var r=e.trim(t);if(r===""){u.removeClass("loaded");return}m(p.url,{kw:encodeURIComponent(r),scope:n||o.attr("data-scope")},g)},p.cls!==""&&s.addClass(p.cls);if(!p.searchResultContariner)s.append('<div class="suggest-panel"><ul></ul></div>'),u=s.find(".suggest-panel");else{var C=typeof p.searchResultContariner=="string"?e(p.searchResultContariner):p.searchResultContariner;C.length>0&&(C.append('<div class="suggest-panel m-result"><ul></ul></div>'),u=C.find(".suggest-panel"))}u.on("mouseover","li",function(){e(this).addClass("active").siblings("li").removeClass("active")}),u.on("click","li.suggest-item",function(t){var n=e(this);n.is(".init-group")?x(n.find("span").html()):x(o.val().trim()),p.selectCallBack(n),T(1)}),p.historyAction&&u.on("click",'i[data-cmd="'+p.historyAction+'"]',function(){var t=e(this),n=t.closest("li");return S(t.prev("span").attr("data-text")),o.blur().focus(),!1}),p.clearBtn&&(o.after('<a class="search-clear">&times</a>'),f=o.next(".search-clear").on("click",function(){o.val(""),e(this).hide()})),s.bind("doSearch",function(t,n,r){p.cb(n||e.trim(o.val()),r||o.attr("data-scope"))}),s.bind("deleteHistory",function(e,t){S(t)}),s.bind("setHistory",function(e,t){x(t)}),o.on("keydown keyup paste cut input focus",function(t){var n=e.trim(o.val());clearTimeout(h),t.type==="focus"&&s.addClass("s-focus"),n!==""?(t.type==="keydown"&&N(t),t.type==="focus"&&e.trim(u.find("ul").html())!==""&&u.addClass("loaded"),f&&f.show()):(f&&f.hide(),t.type==="keydown"&&N(t),(t.type==="focus"||t.type==="keyup")&&b()),p.change(n)}),o.on("blur",function(){T(300),s.removeClass("s-focus")}),e(document).on("click",function(e){T(1)}),s.on("click",function(e){return!1}),i.call(s.find("input").get(0),p),o.val()!==""&&(o[0].timer.text=""),a&&a.on("click",function(t){var n=e.trim(o.val());return n!==""&&(x(n),p.callback&&p.callback(n)),!1}),p.init()})}})(e)}),define("module/header_search",["jquery","router","plugin/jquery.search"],function(e,t){function n(e){$(".js-upload-icon").on("mouseenter",function(){$(".xui-popover").removeClass("xui-popover-hidden")}),$(".js-upload-icon").on("mouseleave",function(e){setTimeout(function(){$(e.relatedTarget).parents(".popover-wrapper").length==0&&$(".xui-popover").addClass("xui-popover-hidden")},300)}),$(".popover-wrapper").on("mouseleave",function(){$(".xui-popover").addClass("xui-popover-hidden")})}function r(e){n()}function i(e,t){window._hmt&&_hmt.push(["_trackEvent","home_search","click"]),e||(e={scope:"voice",id:"",title:""});if(e.id){var n="";switch(e.scope){case"album2":n="/album/"+e.id;break;default:n="/search/"+encodeURIComponent(e.title)+"/sc/p1"}window.location.href=n}else{var r="/search/"+encodeURIComponent(t||e.title)+"/sc/p1";window.location.href=r}}return r(),$(".xui-header-search").length>0&&$(".xui-header-search").searchBox({url:config.SEARCH_SUGGEST_PATH||"http://search.test.ximalaya.com/suggest",hotwordsUrl:"/search/hot_search_key",callback:function(e){if(!e)return;i(null,e)},selectCallBack:function(e){var t={scope:e.attr("data-scope"),id:e.attr("data-id"),title:e.children("span").attr("title")};i(t)}}),$(".header-search").searchBox({url:config.SEARCH_SUGGEST_PATH||"http://search.test.ximalaya.com/suggest",hotwordsUrl:"/search/hot_search_key",callback:function(e){if(!e)return;i(null,e)},selectCallBack:function(e){var t={scope:e.attr("data-scope"),id:e.attr("data-id"),title:e.children("span").attr("title")};i(t)}}),function(){}}),define("page/page_base",["jquery","underscore","backbone","router","module/player/player","module/common/nav","module/card","module/default_image","module/common/iverify","module/xchat/common","module/bottom/downloadbar","module/common","plugin/common","module/header_search","module/foot"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.View.extend({el:"#mainbox",init:function(){r.setPage(this),i.init(),o.render(),u.render(),a.init(),helper.doCheckVersion();if(window._bd_share_main){if(window._bd_share_config&&window._bd_share_config.common){var t=window._bd_share_config.common.onBeforeClick;window._bd_share_config.common.onBeforeClick=function(e){t.apply(this,arguments)}}_bd_share_main.init()}this.initSub.apply(this,arguments);var n=e('<div id="browserTips"><!--[if lt IE 9]><div  class="date-range">   <div class="main-wrapper">     亲，为了您更好的使用体验，2017年5月8日起，喜马拉雅FM将只支持IE9及IE9以上浏览器的访问，建议使用喜马拉雅App或尽快     <a class="link5" href="https://support.microsoft.com/zh-cn/help/17621/internet-explorer-downloads">升级IE浏览器</a> 哦~   </div><script> window.location= "/upgrade_browser"; </script> </div><![endif]--></div>');e("#browserTips").length||n.insertAfter(".sub-header"),e(".header").off().on("click",".btn-upload,.btn-subupload",function(){xmLog&&xmLog("pv.create",{item:"公共上传入口",itemId:""}),xmLog&&xmLog("pv.send","pageview",{serviceId:"pageview",item:e(this).attr("xmlog-item"),srcModule:e(this).attr("xmlog-mod"),srcPage:e(this).attr("xmlog-spg")||"","function":e(this).attr("xmlog-fun")})})},initSub:function(){},hashlink:function(){return""},releaseSub:function(t){var n=e(t);i.release(),o.release(),u.release(),n&&(n.unbind(),n.undelegate(),n.empty()),a.release(),e("#bdshare_pop").hide(),this.releaseBdshare(),n.html('<div class="pageLoading"></div>')},release:function(t){i.release(),o.release(),u.release(),this.unbindEvents(),this.$el&&this.$el.empty(),a.release(),e("#bdshare_pop").hide(),this.releaseBdshare(),helper.scrollTop(),this.$el.html('<div class="pageLoading"></div>')},releaseBdshare:function(){e(".bdshare_dialog_box").hide(),e(".bdshare_dialog_bg").hide(),e(".bdshare_popup_box").hide(),e(".bdshare_popup_bg").hide(),e("#bdshare_weixin_qrcode_dialog").hide(),e("#bdshare_weixin_qrcode_dialog_bg").hide()},initNav:function(e){e.length?s.active.apply(s,e):s.clear.apply(s,[])},initBg:function(){this.$el.parent().attr("class","bodyBgColor")},render:function(){},renderOnIsLogin:function(){},afterRender:function(){i.init(),o.render(),u.render()},bindEvents:function(){},unbindEvents:function(){this.$el.unbind(),this.$el.undelegate()},callParent:function(e,t){if(!e)return!1;var n=this.constructor.__super__;return e in n?n[e].apply(this,t||[]):!1}});return c}),define("module/header_search2",["jquery","underscore","model/search","module/player/player","helper","module/common/ifollow","router","plugin/jquery.selecter"],function(e,t,n,r,i,s,o){function c(t){var n=this;this.options=e.extend({url:"/s/search/suggest",type:"get",pramName:"keywords",isHistory:!0,resultKeyCode:[],$el:e(".g-player-search"),callback:function(){n.callback.apply(n,arguments)},$listResult:""},t),f.setSearchUrl(this.options.url);var r=this.options.$el;this.$el=r,this.$searchType=r.find(".selecter"),this.$searchPanel=r,this.$searchInput=r.find("input[type!=hidden]").attr("autocomplete","off"),this.$searchBtn=r.find(".searchBtn"),this.$listResult=this.options.$listResult||r.find(".results_wrap"),this.isBlur=!0,this.init()}var u={voice:"t2",user:"t4",album:"t3"},a={enter:13,left:37,up:38,right:39,down:40,space:32},f=new n,l={voice:t.template('<li data-scope="<%= scope %>" sound_id="<%= id %>"><div class="searchPanel_sound"><a class="title" hashlink href="<%= url %>" data-kw="<%= id %>" title="<%= title %>"><%= text %></a><div class="operateBtn"><a class="playBtn" href="javascript:;"><span class="sub-play">play</span><span class="sub-pause">pause</span></a></div></div></li>'),user:t.template('<li data-scope="<%= scope %>" user_id="<%= id %>" is_follow="<%= is_follow %>"><div class="searchPanel_sound"><a class="title" hashlink href="<%= url %>" data-kw="<%= id %>" title="<%= title %>"><%= text %></a><a class="operateBtn" data-options=\'{"uid":<%= id %>,"is_follow":<%= is_follow%>,"be_followed":false,"nickname":"<%= title%>"}\'><span class="default"><% if(is_follow) {%>已<% } %>关注</span></a></div></li>'),album:t.template('<li data-scope="<%= scope %>" album_id="<%= id %>"><div class="searchPanel_sound"><a class="title" hashlink href="<%= url %>" data-kw="<%= id %>" title="<%= title %>"><%= text %></a></div></li>'),all:t.template('<li  ><div class="searchPanel_sound"><a class="title"  href="javascript:;" data-kw="<%= id %>" title="<%= title %>"><%= text %></a></div></li>'),history:t.template('<li class="history-link" text="<%=title%>" href="<%=href%>"><a data-kw="<%= title %>" hashlink href="<%=href%>"><%=title%></a><a title="<%=title%>" class="searchHistoryDelBtn">删除</a></li>')};c.prototype={cookieName:"search_history",maxHistory:5,init:function(){this.addInputEvent(),this.addBtnEvent(),this.addEvents(),this.hideList()},addEvents:function(){var t=this;this.$searchType.selecter(),this.setScope(this.$searchType.selecter("val")),this.$searchType.on("change",function(){t.setScope(t.$searchType.selecter("val"))}),this.$searchPanel.on({mouseenter:function(){e(this).addClass("focus")},mouseleave:function(){if(!t.isBlur)return;e(this).removeClass("focus"),t.$searchType.removeClass("is-type-hover")}}),this.$listResult.on({mouseenter:function(n){var r=e(this);t.$listResult.find("li[data-select]").removeAttr("data-select"),r.attr("data-select",!0),t.$listResult.find(".on").removeClass("on"),r.addClass("on")},mouseleave:function(){e(this).removeAttr("data-select").removeClass("on")},click:function(){t.chooseResult()}},".results li"),this.$listResult.on({click:function(){return!1},mousedown:function(){return!1}},".results li .operateBtn")},initPlayer:function(){r.render({$container:this.$listResult})},releasePlayer:function(){r.release({$container:this.$listResult})},unbindEvents:function(){this.$listResult.off()},showList:function(){if(this.isBlur||this.$listResult.children().length==0)return;this.$listResult.removeClass("hidden"),this.show=!0},hideList:function(){this.$listResult.addClass("hidden"),this.show=!1},getPostData:function(){return{scope:this.getScope()}},getScope:function(){return this.searchScope},getFDFSPath:function(e){return e.indexOf("http://")<0&&window.config&&(e=(config.FDFS_PATH||"")+"/"+e),e},createAllHtml:function(e){var t="<ul class='resultsAll'>"+this.createAllItemHtml(e.sound,"voice")+this.createAllItemHtml(e.user,"user")+this.createAllItemHtml(e.album,"album")+"</ul>";return t},createAllItemHtml:function(e,t){var n={voice:"声音",user:"用户",album:"专辑"};if(!e.list||e.list&&e.list.length<=0)return"";var r='<li><div class="resultsAll_tit">'+n[t]+"</div>";return r+=this.createResultHtml(e,t),r+="</li>",r},createResultHtml:function(t,n){if(!t||e.isEmptyObject(t))return"";var r="";if(this.options.createResultHtml){r=this.options.createResultHtml.call(this,t,n);if(r)return r}n="all";var i=l[n],s={voice:"results",album:"results",user:"results",all:"results"},o=e('<div><ul class=" '+s[n]+'"></ul></div>');if(!i)return"";for(var u=0;u<t.list.length;u++){var a=t.list[u];a.scope=n,a.url=this.getUrl(a.id,n),r+=i(a)}return o.find("ul").append(r),o.html()},getUrl:function(e,t){var n={voice:"/sound/"+e,album:"/album/"+e,user:"/"+e},r=n[t]||"";return r},shortWords:function(e,t){var n=e.length,r=e.replace(/[\u0391-\uFFE5]/g,".."),i=r.length;if(i>t){var s=Math.floor(t*n/i);return e.substring(0,s)+"..."}return e},addBtnEvent:function(){if(this.$searchBtn.length>0){var e=this;this.$searchBtn.on("click",function(){if(!e.$searchInput.val()){e.$searchInput.focus();return}e.chooseResult(!0)})}},beginLoading:function(){this.$searchPanel.addClass("is-searchPanel-search")},endLoading:function(){this.$searchPanel.removeClass("is-searchPanel-search")},chearHistory:function(){e.cookie(this.cookieName,"",{domain:".ximalaya.com",path:"/"})},getHistory:function(){var t=e.cookie(this.cookieName);if(!t)return;var n=t.split("||"),r=[];for(var i=0,s=n.length;i<s;i++){var o=n[i];if(e.trim(o)){var u={title:decodeURIComponent(o),icon:""};r.push(u)}}return this.show=!0,r},setHistory:function(t,n){if(!e.trim(t)||!this.options.isHistory)return;var r=e.cookie(this.cookieName)||"",i=e.trim(t),s=r.split("||");s=e.grep(s,function(e){return e!=i}),r=s.join("||"),r&&(r="||"+r),n&&(r=i+r),r=r.replace(/\|{4}/g,"||");var o=r.split("||");o.length>this.maxHistory&&(o.length=this.maxHistory,r=o.join("||")),e.cookie(this.cookieName,r,{domain:".ximalaya.com",path:"/"})},getHistoryList:function(e){var t=e.list,n="<ul class='searchHistory'>";if(!t||!t.length)return"";for(var r=0,i=t.length;r<i;r++){var s=t[r],o=s.title,u={title:o,href:"/search/"+o+"/",href1:"/s?q="+o+"&qf="};n+=l.history(u)}return n+='<li class="searchHistoryClear"><a>清空历史记录</a></li>',n+="</ul>",n},doShowHistory:function(t){var n=this;if(!this.options.isHistory)return;if(t&&!n.$searchInput.val()){var r=n.getHistory();if(!r)return;var s={list:r},a=n.getHistoryList(s);if(!a)return;var f=e(a);f.on("click",".searchHistoryDelBtn",function(){return n.setHistory(e(this).attr("title"),!1),setTimeout(function(){n.$searchInput.focus()},100),!1}),f.find(".searchHistoryClear").on("click",function(){return n.chearHistory(),!1}),f.on("click",".history-link",function(){var t=e(this),r=t.attr("href"),s=t.attr("text");return s&&n.setHistory(s,!0),r&&u[n.searchScope]&&(r+=u[n.searchScope]),i.isLogin()?o.toPage(location.origin+"/"+r):o.toPage(r),!1}),n.$searchInput.parent().append(f)}else setTimeout(function(){e("ul.searchHistory").remove()},200)},addInputEvent:function(){var t=this,n=t.$searchInput,r=function(e,r){n.val(r),e===-1&&n.val(n.attr("data-origin")),n.attr("data-suggest","off"),t.sTimer&&clearTimeout(t.sTimer),t.sTimer=setTimeout(function(){n.attr("data-suggest","on")},1e3)};this.$searchInput.on({blur:function(){setTimeout(function(){t.hideList()},150),t.doShowHistory(!1),t.isBlur=!0,t.$searchPanel.removeClass("focus"),t.$searchPanel.removeClass("is-searchPanel-focus")},focus:function(){t.isBlur=!1,t.$searchPanel.addClass("focus"),t.$searchPanel.addClass("is-searchPanel-focus"),t.doShowHistory(!0)},keypress:function(e){t.doShowHistory(!1),t.holdSearch(!0);if(e.keyCode==a.enter)return t.chooseResult(),t.hideList(),!1},keydown:function(n){var i=n.keyCode;t.doShowHistory();for(var s=0;s<t.options.resultKeyCode.length;s++)if(i==t.options.resultKeyCode[s])return t.chooseResult(),t.hideList(),!1;if(!t.show)return;t.holdSearch(!0);var o=t.$listResult.find(".results li"),u=o.length,f=t.$listResult.find("[data-select]"),l=e(o).index(f);switch(i){case a.left:break;case a.right:break;case a.up:l--,l<-1&&(l=u-1),o.mouseleave(),l>=0&&o.eq(l).mouseenter();var c=o.eq(l)?o.eq(l).find("[data-kw]").text():"";return r(l,c,o),!1;case a.down:l++,l===u&&(l=-1),o.mouseleave(),l>=0&&o.eq(l).mouseenter();var c=o.eq(l)?o.eq(l).find("[data-kw]").text():"";return r(l,c,o),!1;case a.enter:return t.chooseResult(),t.hideList(),!1;default:}}}),this.$searchInput.on("input keyup keydown paste cut focus mousedown",function(e){setTimeout(function(){t.onChange(e)},0)}),this.$searchInput.val()},onChange:function(e){var t=e.keyCode;if(t)for(var n in a)if(t==a[n])return!0;this.holdSearch()},holdSearch:function(e){var t=this;t.holdTimer&&clearTimeout(t.holdTimer);if(e)return;t.holdTimer=setTimeout(function(){t.doSearch(t.$searchInput.val())},200)},doSearch:function(t){t=this.cutStr(e.trim(t));var n=this.getPostData(),r=n.scope;if(this.lastKeywords==t&&t!=""&&this.lastScope==r){this.showList();return}this.lastKeywords=t,this.lastScope=r,this.$searchInput.attr("keywords",t);if(!t){this.hideList();return}var i=this,s={};s[this.options.pramName]=t,s=e.extend(s,n),this.beginLoading(),f.set(s),this.$searchInput.attr("data-origin",this.$searchInput.val().trim()),f.doSearch(function(e){if(i.lastKeywords!=t)return;i.$listResult.children().remove(),i.hideList(),i.searchResult(e,t,r),i.endLoading()},function(){i.endLoading()})},setScope:function(e){this.searchScope=e},searchResult:function(e,t,n){this.searchKeywords=t,n=n||this.searchScope||"";var r="";r+=this.createResultHtml(e,n);if(!r){this.hideList();return}this.releasePlayer(),this.$listResult.children().remove(),this.$listResult.html(r),this.showList(),this.initPlayer(),s.doBindOne(this.$listResult.find(".operateBtn[data-options]"))},chooseResult:function(t){var n=this.$listResult.find("[data-select]");n.removeAttr("data-select");if(!this.show||t||n.length==0){var r=this.getScope(),i=this.cutStr(n.text()||this.$searchInput.val().trim());this.options.callback({scope:r},i,null),this.setHistory(i,!0);return}i=n.text()||this.$searchInput.val().trim(),this.searchKeywords=i;var r=e(".searchTab .tab_item.on").attr("data-scope"),s={scope:r};this.setHistory(i,!0),this.$searchInput.val(i),this.options.callback(s,this.searchKeywords)},release:function(){this.unbindEvents()},cutStr:function(e){var t=/[\u4e00-\u9fa5]/g,n=e.replace(t,"aa");return n.length>70&&(e=e.substring(0,30)),e},callback:function(e,t){window._hmt&&_hmt.push(["_trackEvent","home_search","click"]),e||(e={scope:"voice",id:"",title:""});if(e.id||e.title){var n={voice:"/sound/",album:"/album/",tag:"/tag/",user:"/"},r="";switch(e.scope){case"tag":r=n[e.scope]+e.title;break;case"user":r="/"+e.id;break;case"voice":case"album":e.uid?r="/"+e.uid+n[e.scope]+e.id:r=n[e.scope]+e.id;break;default:r="/search/"+t+"/"+(u[e.scope]||"")}o.toPage(r)}else o.toPage("/search/"+t+"/"+(u[e.scope]||""))}};var h=function(e){var t=new c(e);return t};return h({$el:e(".floatHeader_wrapper .searchPanel")}),h}),define("plugin/jquery_ujs",["jquery"],function(e){(function(e,t){var n;e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not(button[type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},fire:function(t,n,r){var i=e.Event(n);return t.trigger(i,r),i.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},handleRemote:function(r){var i,s,o,u=r.data("cross-domain")||null,a=r.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,f;if(n.fire(r,"ajax:before")){if(r.is("form")){i=r.attr("method"),s=r.attr("action"),o=r.serializeArray();var l=r.data("ujs:submit-button");l&&(o.push(l),r.data("ujs:submit-button",null))}else r.is(n.inputChangeSelector)?(i=r.data("method"),s=r.data("url"),o=r.serialize(),r.data("params")&&(o=o+"&"+r.data("params"))):(i=r.data("method"),s=r.attr("href"),o=r.data("params")||null);return f={type:i||"GET",data:o,dataType:a,crossDomain:u,beforeSend:function(e,i){return i.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(r,"ajax:beforeSend",[e,i])},success:function(e,t,n){r.trigger("ajax:success",[e,t,n])},complete:function(e,t){r.trigger("ajax:complete",[e,t])},error:function(e,t,n){r.trigger("ajax:error",[e,t,n])}},s&&(f.url=s),n.ajax(f)}return!1},handleMethod:function(n){var r=n.attr("href"),i=n.data("method"),s=n.attr("target"),o=e("meta[name=csrf-token]").attr("content"),u=e("meta[name=csrf-param]").attr("content"),a=e('<form method="post" action="'+r+'"></form>'),f='<input name="_method" value="'+i+'" type="hidden" />';u!==t&&o!==t&&(f+='<input name="'+u+'" value="'+o+'" type="hidden" />'),s&&a.attr("target",s),a.hide().append(f).appendTo("body"),a.submit()},disableFormElements:function(t){t.find(n.disableSelector).each(function(){var t=e(this),n=t.is("button")?"html":"val";t.data("ujs:enable-with",t[n]()),t[n](t.data("disable-with")),t.prop("disabled",!0)})},enableFormElements:function(t){t.find(n.enableSelector).each(function(){var t=e(this),n=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[n](t.data("ujs:enable-with")),t.prop("disabled",!1)})},allowAction:function(e){var t=e.data("confirm"),r=!1,i;return t?(n.fire(e,"confirm")&&(r=n.confirm(t),i=n.fire(e,"confirm:complete",[r])),r&&i):!0},blankInputs:function(t,n,r){var i=e(),s,o=n||"input,textarea";return t.find(o).each(function(){s=e(this);if(r?s.val():!s.val())i=i.add(s)}),i.length?i:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(n,r){var i=n.data("events"),s=!0;return i!==t&&i.submit!==t&&e.each(i.submit,function(e,t){if(typeof t.handler=="function")return s=t.handler(r)}),s},disableElement:function(e){e.data("ujs:enable-with",e.html()),e.html(e.data("disable-with")),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.data("ujs:enable-with",!1)),e.unbind("click.railsDisable")}},e.ajaxPrefilter(function(e,t,r){e.crossDomain||n.CSRFProtection(r)}),e(document).delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),e(document).delegate(n.linkClickSelector,"click.rails",function(r){var i=e(this),s=i.data("method"),o=i.data("params");if(!n.allowAction(i))return n.stopEverything(r);i.is(n.linkDisableSelector)&&n.disableElement(i);if(i.data("remote")!==t)return(r.metaKey||r.ctrlKey)&&(!s||s==="GET")&&!o?!0:(n.handleRemote(i)===!1&&n.enableElement(i),!1);if(i.data("method"))return n.handleMethod(i),!1}),e(document).delegate(n.inputChangeSelector,"change.rails",function(t){var r=e(this);return n.allowAction(r)?(n.handleRemote(r),!1):n.stopEverything(t)}),e(document).delegate(n.formSubmitSelector,"submit.rails",function(r){var i=e(this),s=i.data("remote")!==t,o=n.blankInputs(i,n.requiredInputSelector),u=n.nonBlankInputs(i,n.fileInputSelector);if(!n.allowAction(i))return n.stopEverything(r);if(o&&i.attr("novalidate")==t&&n.fire(i,"ajax:aborted:required",[o]))return n.stopEverything(r);if(s)return u?n.fire(i,"ajax:aborted:file",[u]):!e.support.submitBubbles&&e().jquery<"1.7"&&n.callFormSubmitBindings(i,r)===!1?n.stopEverything(r):(n.handleRemote(i),!1);setTimeout(function(){n.disableFormElements(i)},13)}),e(document).delegate(n.formInputClickSelector,"click.rails",function(t){var r=e(this);if(!n.allowAction(r))return n.stopEverything(t);var i=r.attr("name"),s=i?{name:i,value:r.val()}:null;r.closest("form").data("ujs:submit-button",s)}),e(document).delegate(n.formSubmitSelector,"ajax:beforeSend.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),e(document).delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))})})(e)}),define("page/search",["jquery","module/header_search2","helper","page/page_base","module/common/ifollow","router","module/common/iletter","module/player/player","plugin/jquery_ujs","plugin/jquery.selecter"],function(e,t,n,r,i,s,o,u){function f(t,n,r){var i=e.trim(e("#gSearch-input").val());n=n||"";var o=/[\u4e00-\u9fa5]/g,u=i.replace(o,"aa");u.length>70&&(i=i.substring(0,30),e("#gSearch-input").val(i)),t||(t="voice");var a={voice:"t2",user:"t4",album:"t3"},f=l(t);r==null&&(r="");var c={qf:a[t]?a[t]:"",sort:n,fq:f,page:r},h=[];for(var p in c)h.push(c[p]);s.toPage("/search/"+i+"/"+h.join(""))}function l(t){var n="";if(t=="voice"){var r=e("#sub_voice_category_id").attr("data-value"),i=e("#sub_voice_user_source").selecter("val");n=(r||"")+(i||"")}if(t=="album"){var r=e("#sub_album_category_id").attr("data-value"),i=e("#sub_album_user_source").selecter("val");n=(r||"")+(i||"")}if(t=="user"){var s=e("#sub_user_gender").selecter("val");n=s}return n}var a=r.extend({init:function(){this.callParent("init"),this.$searchUserPage=e("#searchUserPage"),this.initSearch(),this.bindEvents(),i.init(),o.bind(e(".sendLetterBtn")),o.bind(e(".radioLetterIcon").parent())},initSearch:function(){var n=t({$el:e(".searchContent .searchBar ")});n.setScope(e(".searchTab .tab_item.on").attr("data-scope")),e(".searchField button").on("click",function(){n.chooseResult(!0)})},bindEvents:function(){var t=this.$searchUserPage,r=this;t.find(".selecter").selecter(),console.log(t.find(".selecter")),t.on("click",".searchTab [data-scope]",function(){var t=e(this).attr("data-scope");f(t)}),t.find(".follow_list").on({mouseenter:function(){var t=e(this),n=t.parent();n.find(".on").removeClass("on"),t.addClass("on")}},"li"),t.on("click",".gSearch-sub-voice",function(){f("voice",e(this).attr("name"))}),t.on("click",".gSearch-sub-album",function(){f("album",e(this).attr("name"))}),t.on("click",".gSearch-sub-tag",function(){f("tag",e(this).attr("name"))}),t.on("click",".gSearch-sub-user",function(){f("user",e(this).attr("name"))}),e("#sub_voice_user_source").on("change",function(){var t=e(".gSearch-sub-voice.on");f("voice",t.attr("name"))}),e("#sub_voice_category_id").on("click","a",function(){var t=e(this);if(t.hasClass("more"))return;e("#sub_voice_category_id").attr("data-value",t.attr("data-value"));var n=e(".gSearch-sub-voice.on");f("voice",n.attr("name"))}),e("#sub_album_category_id").on("click","a",function(){var t=e(this);if(t.hasClass("more"))return;e("#sub_album_category_id").attr("data-value",t.attr("data-value"));var n=e(".gSearch-sub-album.on");f("album",n.attr("name"))}),e("#sub_voice_category_id, #sub_album_category_id").on("click",".more",function(){var t=e(this);t.parent().find(".more-category").removeClass("hidden"),t.hide()}),e("#sub_album_user_source").on("change",function(){var t=e(".gSearch-sub-album.on");f("album",t.attr("name"))}),e("#sub_user_gender,#sub_user_isVerified").on("change",function(){var t=e(".gSearch-sub-user.on");f("user",t.attr("name"))}),t.on("click",".miniPlayBtn3",function(){var t=e(this),i=t.closest(".soundReport"),s=i.find(".expandbox_player_entry");if(t.attr("data-inited")){s.size()>0&&(i.addClass("is-soundReport-expand"),s.slideDown(),s.find(".playBtn").trigger(n.START_EV));return}t.attr("data-inited",!0);var o=t.attr("track_id");r.initPlayer(i,o,t)}),t.on("click",".miniPauseBtn3",function(){var t=e(this),r=t.closest(".soundReport");r.find(".pauseBtn").trigger(n.START_EV)});var i=".rankUserList";e(".js-top-switch").on("click",function(){var t=e(i+":not(.hidden)").next(i);t=t.length?t:e(i+":first"),e(i).addClass("hidden"),t.removeClass("hidden")})},initPlayer:function(t,r,i){var s=t.find(".expandbox_player_entry");e.get("/sounds/"+r+"/expend_box",function(e){s.hide().html(e),t.addClass("is-soundReport-expand"),s.slideDown(function(){u.render({$container:t}),t.find(".playBtn").trigger(n.START_EV)}),t.on({onSoundPlay:function(){i.removeClass().addClass("miniPauseBtn3")},onSoundPause:function(){window.console&&console.log("pause"),i.removeClass().addClass("miniPlayBtn3")},onSoundFinish:function(){window.console&&console.log("finish"),i.removeClass().addClass("miniPlayBtn3")},onSoundStop:function(){window.console&&console.log("stop"),i.removeClass().addClass("miniPlayBtn3"),s.slideUp(function(){t.removeClass("is-soundReport-expand")})},onSoundResume:function(){window.console&&console.log("resume"),i.removeClass().addClass("miniPauseBtn3")}}),_bd_share_main.init()})},unbindEvents:function(){this.$searchUserPage.off(),this.$searchUserPage.empty(),e(".js-top-swtich").off()},release:function(){this.callParent("release"),this.unbindEvents()}}),c=new a;return c}),define("module/my/welcome",["jquery","underscore","backbone","helper","../../router"],function(e,t,n,r,i){var s=n.View.extend({init:function(){var t=this,n=e(".welcome_bg"),s=n.find(".welcome_bd");$mainbox=e("#mainbox");var o=e(document.body),u=e(".floatHeader"),a=e(".discoverMenu"),f=e("#bgimg"),l=e(".loginPanelWelBox"),c=e(".discoverMenuMask"),f=e("#welcome_bgimg"),h=e("#bgimg");r.scrollTop(),$mainbox.hide(),e(".menu_index").empty(),u.css({position:"absolute",bottom:0}).show(),u.appendTo(n),c.hide(),e(".menu_explore").addClass("on is-open"),e(".discover").on("click",function(r){return n.stop().animate({height:242},200,function(){n.css({"z-index":"-1",position:"absolute"}),$mainbox.show(),e(".header_wrapper .menu").fadeIn("normal"),a.hide().slideDown(300,"swing",function(){u.removeAttr("style").hide(),u.insertAfter(a).show(),s.hide(),$mainbox.show(),n.height(0),l.hide(),o.toggleClass("welcome"),i.toPage("/go2explore"),c.show(),e(".footer").show()}),t.model.set("canHide",!0)}),s.stop().animate({top:100},200),e.cookie("welcome",!0),!1}),e(".logo").on("click",function(){if(t.model.get("canHide")){c.hide();var r=a.position(),i=u.height()-4;a.is(":hidden")?i+=6:i+=a.height(),$mainbox.empty().hide(),e(".footer").hide(),u.css({position:"absolute",bottom:0}).show(),n.height(r.top+i),u.appendTo(n),o.toggleClass("welcome"),a.slideUp(200,"swing",function(){e(".header_wrapper .menu").fadeOut(),setTimeout(function(){s.show(),l.show(),n.stop().animate({height:"100%"},200,function(){n.css({"z-index":10})}),s.stop().animate({top:"9%"},0)},200)}),t.model.set("canHide",!1),e.cookie("welcome",null)}return!1}),f.on("load",function(){h.attr("src",f.attr("originsrc")),n.removeClass("hidden"),e(".welcomeLoading").fadeOut(300,"swing",function(){e(this).remove()})}).on("error",function(){location.href=location.href}).attr("src",f.attr("originsrc"))},release:function(){e(".logo").off("click"),e(".discover").off("click"),e(".discoverMenuMask").hide()}});return new s({model:new n.Model({canHide:!1})})}),define("page/welcome",["jquery","backbone","module/my/welcome","module/foot","module/common"],function(e,t,n){var r=t.View.extend({init:function(){n.init(),helper.doCheckVersion()},release:function(){n.release()}});return new r}),define("page/download",["jquery","page/page_base","helper"],function(e,t,n){var r=t.extend({init:function(){i.init()},release:function(){this.callParent("release")}}),i={init:function(){xmLog&&xmLog("pv.create",{currPage:"download"}),xmLog&&xmLog("pv.send","event",{currPage:"download",currPageId:null,currPageUrl:"/download/",durationTime:"0s",prevItem:null,prevItemId:null,prevModule:null,prevPage:null,prevPageId:null,prevPageUrl:null,serviceId:"pageView"}),e(".down-ways-device a").click(function(){var t=e(this).attr("xmlog-item"),n=e(this).attr("xmlog-mod");xmLog&&xmLog("pv.send","event",{currPage:"download",currPageId:null,currPageUrl:"/download/",item:t,itemId:null,module:n,serviceId:"click"})});var t=this,r=e(".download_pop");e(".download_code").click(function(){return r.show(),!1}),e("body").click(function(){r.hide()}),this.imageRoll(),e("#btnContainer").on({click:function(){var n=e(this);t.imageRoll(n.index(),!0)}},".download_selectBtn");var i=e(window),s,o=e(".download_con .download_line");n.browser.msie?o.addClass("tra_ie"):(i.bind("scroll",function(){s&&clearTimeout(s),s=setTimeout(function(){var t=e(document).scrollTop();o.each(function(){var n=e(this),r=n.offset().top;if(n.hasClass("tra"))return;t+i.height()>=r&&n.addClass("tra")})},50)}),i.trigger("scroll"))},imageRoll:function(t,n){t=t||0,this.rollTimer&&clearTimeout(this.rollTimer);var r=e(".download_img_rolling").find("img"),i=e("#btnContainer").children(),s=r.length,o=t+1,u=this;r.each(function(){e(this).css("zIndex",2)}),u.doRoll(o,o-1,n),this.rollTimer=setInterval(function(){o>=s&&(o=0);var e=o-1;e<0&&(e=s-1),u.doRoll(e,o),o++},3e3)},doRoll:function(t,n,r){var i=e(".download_img_rolling").find("img"),s=e("#btnContainer").children(),o=1e3;i.eq(t).fadeOut(o*2,function(){e(this).css({zIndex:2}).hide()}),r?i.eq(n).css({zIndex:3}).show():i.eq(n).css({zIndex:3}).hide().fadeIn(o,function(){}),s.removeClass("on"),s.eq(n).addClass("on")}};return new r}),define("page/404",["jquery","page/page_base"],function(e,t){var n=t.extend({}),r=new n;return r}),define("model/setting",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({message:function(e,t){var n="/personal_settings/update_message";this.ajax(n,e,t)},feed:function(e,t){var n="/personal_settings/update_feed";this.ajax(n,e,t)},addBackList:function(e,t,n){var r="/home/add_to_blacklist";this.set("postData",{uid:e}),this.ajax(r,t,n)},removeBackList:function(e,t,n){var r="/home/remove_from_blacklist";this.set("postData",{uid:e}),this.ajax(r,t,n)},personal:function(e,t){var n="/passport/modifyProfile";this.ajax(n,e,t)},privacy:function(e,t){var n="/personal_settings/update_privacy";this.ajax(n,e,t)},reSendActive:function(e,t,n){var r="/passport/reSend/VerifyEmail";this.set("postData",{type:e}),this.ajax(r,t,n)},mobileVerifyCode:function(e,n,r,i){var s={phone_num:e,serial:2,msgType:3},o="/passport/mobile/getVerifyCode";i.msgType===100&&(delete s.serial,o="/passport/password/reset/mobile/send/ajaxnew"),i=i||{},this.set("postData",t.extend(s,i)),this.ajax(o,n,r)},mobileVerifyCode2:function(e,t,n,r){var i="/passport/mobile/oldPhone/getVerifyCode";r=r||{},r.phone_num=e,r.isFirst||(r.msgType=6,i="/passport/mobile/getVerifyCode"),this.set("postData",r),this.ajax(i,t,n)},getLoginToken:function(t,n){var r=this;e.ajax({url:"/passport/token/login",type:"get",dataType:"json",success:function(e){e.ret==0?t(e.token):n&&n("系统出错了！")},error:function(){n&&n("系统出错了！")}})},mobileVerifyCode3:function(e,t,n,r){var i="/passport/v1/sms/send",s=this;r=r||{},r.phone_num=e,r.msgType=4,this.getLoginToken(function(e){r.nonce=e,s.set("postData",r),s.ajax(i,t,n)})},bindPhone:function(e,t,n,r){var i="/passport/mobile/verifyCode";this.set("postData",{phone_num:e,content:t,serial:2}),this.ajax(i,n,r)},bindEmail:function(e,t,n){var r="/passport/send/bindEmail";this.set("postData",{email:e}),this.ajax(r,t,n)},checkOldEmail:function(e,t,n){var r="/passport/checkOldEmail";this.set("postData",{email:e}),this.ajax(r,t,n,"get")},checkOldPhone:function(e,t,n){var r="/passport/checkOldMobile";this.set("postData",{mobile:e}),this.ajax(r,t,n,"get")},rebindEmail:function(e,t,n,r,i){var s="/passport/send/resetEmail";this.set("postData",{newEmail:n,oldEmail:e||"",oldMobile:t||""}),this.ajax(s,r,i)},rebindPhone:function(e,t,n,r){var i="/passport/mobile/v2/bindNewPhone";this.set("postData",{newPhoneNum:e,content:t,msgType:6}),this.ajax(i,n,r)},verfifyOldPhone:function(e,t,n){var r="/passport/mobile/verfifyOldPhone";this.set("postData",{content:e}),this.ajax(r,t,n)},checkNickname:function(e,t,n){var r="/passport/profile/checkNickname";this.set("postData",{nickname:e}),this.ajax(r,t,n)},background:function(e,t,n){var r="/passport/background/save";this.set("postData",e),this.ajax(r,t,n)},emailFrequency:function(e,t){var n="/passport/check/emailFrequency";this.ajax(n,e,t,"get")},mobileFrequency:function(e,t){var n="/passport/check/mobileFrequency";this.ajax(n,e,t,"get")},emailBindRetry:function(e,t){var n="/passport/check/emailBindRetry";this.ajax(n,e,t,"get")},ajax:function(t,n,r,i){n=n||e.noop,r=r||e.noop;var s=this.get("postData");e.ajax({url:t,type:i||"post",dataType:"json",data:s,success:function(e){e.result=="success"||e.success?n(e):r(e)},error:function(e){r(e)}})}});return r}),function(e,t){function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function i(e){i.ZIndex=n,e=e||{},this.options={fixed:!0,width:"",dialogClass:"",elClass:"refPop",modalClass:"masker",showClose:!0,modal:!0,size:"middle",template:"",dialogClass:"",sizeClass:"lgWid",closeOnClickModal:!0,lockScroll:!1,beforeClose:function(){},onClose:function(){},onShow:function(){}},this.$el=t.createElement("div"),this.modalEl=t.createElement("div"),this.dialog=t.createElement("div"),r(this.options,e),this.distY=0,this.addClass(this.$el,this.options.elClass),this.addClass(this.$el,"reform"),this.addClass(this.$el,"hidden"),this.addClass(this.modalEl,this.options.modalClass),this.addClass(this.dialog,this.options.dialogClass),this.addClass(this.dialog,this.options.sizeClass),this.create(),this.addListener("close",function(){this.close()})}var n=9999;i.prototype={constructor:i,create:function(){var e=this.options,n=this;this.$el.style.position="fixed",this.$el.style.top=0,this.$el.style.left=0,this.$el.style.bottom=0,this.$el.style.right=0,this.$el.style.zIndex=i.ZIndex++,e.closeOnClickModal&&this.modalEl.addEventListener("click",function(){n.emit("close")}),e.modal&&(this.$el.appendChild(this.modalEl),this.modalEl.style.width="100%",this.modalEl.style.height="100%",this.modalEl.style.zIndex=i.ZIndex++),this.dialog.style.zIndex=i.ZIndex++,this.dialog.style.position="absolute",this.dialog.style.top="50%",e.top&&(this.dialog.style.top=e.top),this.dialog.style.left=0,this.dialog.style.right=0,this.dialog.style.margin="auto",e.default?(this.dialog.style.position="fixed",this.dialog.style.top=e.top,this.dialog.style.left=0,this.dialog.style.right=0,this.dialog.style.width=e.width,this.dialog.style.background=e.background):typeof e.template=="string"?this.dialog.innerHTML=e.template:e.template instanceof HTMLElement&&this.dialog.appendChild(e.template),this.$el.appendChild(this.dialog),t.body.appendChild(this.$el),this.closeBtn?"":this.closeBtn=this.dialog.getElementsByClassName("popClX")[0];var n=this;this.closeBtn&&(this.closeBtn.onclick=function(){return n.emit("close"),!1})},open:function(){this.options.lockScroll&&(t.body.style.overflow="hidden");var e=this;e.removeClass(e.$el,"hidden"),this.distY=-1*e.dialog.offsetHeight/2;if(!i.animation){e.options.onShow.apply(e,arguments);return}e.fadeInUp(e.dialog,500,e.distY,function(){e.options.onShow.apply(e,arguments),e.emit("showed")})},close:function(e){var n=this;n.options.lockScroll&&(t.body.style.overflow="auto");if(!i.animation){n.addClass(n.$el,"hidden"),n.options.onClose.apply(n,arguments),n.emit("closed");return}this.fadeOut(this.dialog,this.distY,500,function(){n.addClass(n.$el,"hidden"),n.options.onClose.apply(n,arguments)})},fadeOut:function(e,t,n,r){i.animation(t,n,500,"quad.easeInOut",function(i,s){s&&r&&r(i),e.style.transform="translate3d(0, "+i+"px, 0)",e.style.opacity=(i-n)/(t-n)})},fadeInUp:function(e,t,n,r){i.animation(t,n,500,"quad.easeInOut",function(i,s){s&&r&&r(i),e.style.transform="translate3d(0, "+i+"px, 0)",e.style.opacity=(i-t)/(n-t)})},addClass:function(e,t){var n=e.getAttribute("class"),r=n?n.split(" "):[];r.push(t),e.setAttribute("class",r.join(" "))},removeClass:function(e,t){var n=e.getAttribute("class");if(!n)return;var r=n.split(" "),i=r.indexOf(t);if(i<0)return;r.splice(i,1),e.setAttribute("class",r.join(" "))}},i.prototype.addListener=function(e,t){return this._callbacks?"":this._callbacks={},this._callbacks[e]?"":this._callbacks[e]=[],this._callbacks[e].push(t),this},i.prototype.emit=function(){var e=Array.prototype.slice.call(arguments,0),t=e.shift(),n,r,i;if(!(n=this._callbacks))return this;if(!(i=this._callbacks[t]))return this;for(r=0;r<i.length;r++)i[r].apply(this,e)},i.prototype.off=function(e){if(!e){for(var t in this._callbacks)this._callbacks[t]=[];return}this._callbacks[e]&&(this._callbacks[e]=[])},i.prototype.addAnimation=function(e){i.animation=e},i.prototype.getStyle=function(e,t){var n=null,r;return window.getComputedStyle?(n=window.getComputedStyle(e,null),r=n.getPropertyValue(t)):(n=e.currentStyle,r=n[t]),r},i.prototype.getEl=function(){return this.dialog},i.prototype.registerCloseBtn=function(e){var t=this;e.onclick=function(){return t.emit("close"),!1}},typeof e.define=="function"&&define("plugin/modal",["plugin/animation"],function(e){return i.animation=e,i})}(window,document),define("module/common/iverify_code",["jquery","plugin/dialog","../../model/setting","plugin/validator","plugin/animation","plugin/modal"],function(e,t,n,r,i,s){var o=new n,u={open:function(t,n,r,i,s){this.callback=t||e.noop,this.opts={num:n,url:r},this.msgType=s,this.$verifycodeBtn=i,this.createPop()},createPop:function(){var t='<a href="" class="popClX fr"><i class="iconfont icon-ic_x"></i></a><h4 class="popTit"> 请输入验证码</h4><div class="tellWrap"><input type="text" class="codeNum"><div class=" inl-b"><img id="img_validcode_1" class="codePic" alt="点击更换验证码" src="'+this.opts.url+'">'+"</div>"+'<p class="errTxt mgt-10">验证码有误，请重新输入</p>'+"</div>"+'<div class="tc">'+'<a href="" class="btn-com btn-lg btn-red mgr-20 btn-confirm">确认</a>'+'<a href="" class="btn-com btn-lg btn-default btn-cancel">取消</a>'+"</div>",n={dialogClass:"popBox smWid tc",template:t,modal:!1,sizeClass:"smWid"},r=new s(n);r.addAnimation(i),r.open(),this.pop=r,this.$el=e(r.getEl()),this.$verifyCode=this.$el.find(".codeNum"),this.$confirmBtn=this.$el.find(".btn-confirm"),this.$error=this.$el.find(".errTxt"),this.$error.hide(),this.$verifyImg=this.$el.find("#img_validcode_1"),r.registerCloseBtn(this.$el.find(".btn-cancel").get(0)),this.bindEvents()},bindEvents:function(){var t=this,n=this.$el;this.$confirmBtn.on("click",function(){return t.$confirmBtn.hasClass("already")?!1:(t.sendCode(),!1)}),this.$verifyCode.on("focus",function(){}),this.$verifyImg.on("click",function(){var t=e(this).attr("data-src")||e(this).attr("src");e(this).attr("data-src",t).attr("src",t+"&v="+(new Date).getTime())})},phoneError:function(e){this.$error.html(e||"请输入正确的手机号码").show()},codeError:function(e){this.$error.html(e||"验证码不能为空").show()},bindPhone:function(){},checkPhone:function(t){return t=e.trim(t),!0},sendCode:function(){var t=this,n=t.opts.num,r=t.$verifycodeBtn;if(!this.checkPhone(n))return;if(!e.trim(this.$verifyCode.val())){this.codeError();return}this.$error.hide();if(r.hasClass("already"))return;var i=0,s=function(e){r.addClass("already"),clearInterval(i),i=setInterval(function(){e--;if(e<=0){r.html("免费获取验证码"),r.removeClass("already"),clearInterval(i);return}r.html("已发送("+e+")")},1e3),t.holdTimer=i},u=180,a=t.opts.url.replace(/.*codeId=/,"")||e.trim(e("[name='checkUUID']").val());o.mobileVerifyCode3(n,function(e){s(u),t.pop.close()},function(e){t.$verifyImg.click();if(!e.time){t.phoneError(e.msg||"服务器繁忙,请稍后再试!");return}t.phoneError(e.msg);var n=u-parseInt(e.time/1e3);n>0&&s(n)},{msgType:t.msgType,checkCode:e.trim(t.$verifyCode.val()),checkUUID:e.trim(a),sendType:1})}};return u}),define("module/dialogs/bindmobile",["jquery","plugin/dialog","../../model/setting","module/common/iverify_code","module/login/verify","module/select/coutryselect"],function(e,t,n,r,i,s){var o=new n,u=i.verify,a={open:function(t,n,r){this.callback=n||e.noop,this.isRebind=t||!1,this.options=r||{},this.createPop()},createPop:function(){var n=function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)}),r=this.uuid=n(),i=this.img_vaildsrl="/check/getcode?codeId="+r,o=this.getTemplate(i),u={dialogClass:"bindmobile js-tabindex",header:this.isRebind?"修改手机":"绑定手机",content:o,overlayer:{clickClose:!1},id:"bindmobile_dialog"};this.options&&typeof this.options=="object"&&(u=e.extend(u,this.options));var a=new t.Dialog(u);a.open(),this.pop=a,this.$el=a.getEl(),this.$first_container=this.$el.find(".js-bindMobile-first"),this.$next_container=this.$el.find(".js-bindMobile-next"),this.setName(this.$first_container),this.oldphone_right=!1,this.coutryview=new s({type:"old",el:".j-new-mobile-conutry"}),this.coutryview.$el.find(".selecter-m1").removeClass("wid-110").addClass("wid-80"),!this.isRebind,this.bindEvents()},setName:function(e){this.$verifycodeBtn=e.find(".verifycodeBtn"),this.$mobile=e.find(".mobile"),this.$verify=e.find(".verify"),this.$mobileNum=e.find(".mobilenum"),this.$verifyCode=e.find(".verifycode"),this.$confirmBtn=e.find(".confirmBtn"),this.$oldphoneBox=e.find(".js-oldphone"),this.$picverify=e.find("#picverify"),this.$phoneverify=e.find("#phoneverify"),this.$img_validcode=e.find("#img_validcode_1"),this.$next_btn=e.find(".js-next"),this.$oldphone=this.$oldphoneBox.find("input"),this.$oldphone_error=this.$oldphoneBox.find(".error"),this.$errorinfo=e.find(".errorinfo"),this.$kefu=e.find(".js-lianxikefu"),this.$errorinfo=e.find(".errorinfo")},getTemplate:function(e){var t=this.options.oldMobile||"",n=this,r=function(){var e="请输入你的手机号码",r="",i="",s='<div class="j-new-mobile-conutry" style="display: inline-block;"></div>';return t,n.isRebind&&(e="请输入你的原手机号码"),s+'<input type="text" style="'+i+'" class="mobilenum '+r+'"  tabindex="2" placeholder="'+e+'"  onkeydown="helper.enterToTab(event,this);">'}(),i='<div class="js-bindMobile-first"><dl class="mobile " ><dt  style="text-indent: 1em;width:60px;!important;text-align:right;">'+(this.isRebind?"原":"")+"手机号</dt>"+"<dd>"+r+'<div class="error" style="margin-left: 25px;">请输入正确的手机号码</div>'+"</dd>"+"</dl>"+'<dl class="verify" style="margin-bottom:20px;">'+'<dt  style="text-indent: 1em;134px!important;text-align:right;">图片验证</dt><dd><input type="text" style="width:135px!important;" placeholder="请输入右边图片内容" class="verifycode" id="picverify" /> '+'<img id="img_validcode_1" alt="点击更换验证码" title="点击更换验证码" src="'+e+'" style="width:97px;height:30px;margin-left:3px;cursor:pointer; ">'+'<div class="error j-error" style="position:relative;top:2px;">验证码错误</div></dd></dl>'+'<dl class="verify " style="margin-bottom:20px;">'+'<dt  style="text-indent: 1em;134px!important;text-align:right;">短信验证</dt><dd><input type="text" style="width:135px!important;" placeholder="请输入6位数字验证码" class="verifycode" id="phoneverify"/> <a class="verifycodeBtn mgl-10">获取验证码</a>'+'<div class="js-lianxikefu" style="display: inline-block;color: #999;position: relative;top: 2px;margin-bottom:4px;">收不到验证码？<a href="javascript:void 0;" style="color: #ff4611;">联系客服</a></div>'+'<div class="error j-error">短信验证码错误</div></dd></dl>'+'<dl class="errorinfo " style="margin-bottom:20px;color: #CC0000;margin-left: 71px;">'+"</dl>"+'<div class="operate"><button class=" '+(this.isRebind?"js-next btn btn-lg1 btn-primary":"confirmBtn")+' " tabindex="3">'+(this.isRebind?"下一步":"立即绑定")+"</button></div></div>"+'<div class="js-bindMobile-next hidden">'+'<dl class="mobile " >'+'<dt  style="text-indent: 1em;width:60px;!important;text-align:right;">新手机号</dt>'+'<dd><div class="j-new-mobile-conutry" style="display: inline-block;"></div><input type="text" class="mobilenum"  tabindex="2" placeholder="请输入你的新手机号码"  onkeydown="helper.enterToTab(event,this);">'+'<div class="error j-error" style="margin-left: 25px;">请输入正确的手机号码</div>'+"</dd>"+"</dl>"+'<dl class="verify" style="margin-bottom:20px;">'+'<dt  style="text-indent: 1em;134px!important;text-align:right;">图片验证</dt><dd><input type="text" style="width:135px!important;" placeholder="请输入右边图片内容" class="verifycode"  id="picverify" /> '+'<img id="img_validcode_1" alt="点击更换验证码" title="点击更换验证码" src="'+e+'" style="width:97px;height:30px;margin-left:3px;cursor:pointer; ">'+'<div class="error j-error" style="position:relative;top:2px;">验证码错误</div></dd></dl>'+'<dl class="verify " style="margin-bottom:20px;">'+'<dt  style="text-indent: 1em;134px!important;text-align:right;">短信验证</dt><dd><input type="text" style="width:135px!important;" placeholder="请输入6位数字验证码" class="verifycode" id="phoneverify"/> <a is-new="true" class="verifycodeBtn mgl-10">获取验证码</a>'+'<div class="js-lianxikefu"  style="display: inline-block;color: #999;position: relative;top: 2px;margin-bottom:4px;">收不到验证码？<a href="javascript:void 0;" style="color: #ff4611;">联系客服</a></div>'+'<div class="error j-error">短信验证码错误</div></dd></dl>'+'<dl class="errorinfo " style="margin-bottom:20px;color: #CC0000;margin-left: 71px;">'+"</dl>"+'<div class="operate"><button class="confirmBtn " tabindex="3">立即修改</button></div>'+"</div>";return i},releaseEvents:function(){this.$verifycodeBtn.off(),this.$img_validcode.off(),this.$mobileNum.off(),this.$picverify.off(),this.$phoneverify.off(),this.$confirmBtn.off(),this.$oldphone.off(),this.$next_btn.off(),this.$kefu.off()},bindEvents:function(){var t=this,n=this.$el;this.$verifycodeBtn.on("click",function(){if(t.$verifycodeBtn.hasClass("already"))return;t.sendCode(e(this))}),this.$img_validcode.on("click",function(){var t=e(this).attr("src")+"&v="+(new Date).getTime();e(this).attr("src",t)}),this.$mobileNum.on("focus",function(){t.$mobile.removeClass("is-error")}),this.$picverify.on("focus",function(){e(this).attr("data-ok",""),e(this).parents(".verify").removeClass("is-error")}),this.$phoneverify.on("focus",function(){e(this).parents(".verify").removeClass("is-error")}),this.$confirmBtn.on("click",function(){t.isRebind?t.rebindPhone():t.bindPhone()}),this.$oldphone.on("blur",function(){var e=t.$oldphone.val();if(!e){t.oldPhoneError("请输入已绑定的手机号");return}if(!t.checkPhone(e)){t.oldPhoneError();return}o.checkOldPhone(e,function(e){t.oldphone_right=!0,t.oldPhoneError(!1)},function(e){t.oldPhoneError(e.msg)})}),this.$next_btn.on("click",function(){var n=!0;e.trim(t.$picverify.val())||(t.codeError("请输入图片验证码",t.$picverify),n=!1),e.trim(t.$phoneverify.val())||(t.codeError("请输入短信验证码",t.$phoneverify),n=!1);if(!n)return;var r=t.$phoneverify.val();o.verfifyOldPhone(r,function(e){t.releaseEvents(),t.$first_container.remove(),t.$next_container.removeClass("hidden"),t.setName(t.$next_container),t.bindEvents(),t.$img_validcode.click(),t.coutryview=new s({type:"old",el:".j-new-mobile-conutry"}),t.coutryview.$el.find(".selecter-m1").removeClass("wid-110").addClass("wid-80")},function(e){t.errorInfo(e.msg)})}),this.$kefu.on("click",function(){e(".j-CustomUniqueTag")[0].click()})},phoneError:function(e){this.$mobile.addClass("is-error"),this.$mobile.find(".error").html(e||"请输入正确的手机号码")},codeError:function(e,t){var n=t&&t.parents(".verify")||this.$verify;e&&n.addClass("is-error"),n.find(".error").html(e)},errorInfo:function(e){this.$errorinfo.html(e)},rebindPhone:function(){var t=!0,n=this.$next_container.find(".mobilenum"),r=this.$next_container.find("#picverify"),i=this.$next_container.find("#phoneverify"),s=this,a=e.trim(n.val()),f=e.trim(i.val());s.codeError("",i);var l;if(a&&s.coutryview){var c=s.coutryview.getSelected();l=c.code}s.coutryview.isCN()&&!this.checkPhone(a)&&(this.phoneError(),t=!1),e.trim(this.$picverify.val())||(s.codeError("请输入图片验证码",r),t=!1),e.trim(i.val())||(s.codeError("请输入短信验证码",i),t=!1);if(!t)return;a=u.getPhoneByCode(l,a),o.rebindPhone(a,f,function(e){e.phone=a,e.areaCode=l,s.pop.close(),s.callback(e),clearInterval(s.holdTimer),window.history.go(0)},function(e){e.success||(s.codeError("",r),s.codeError("",i),s.errorInfo(e.msg))})},bindPhone:function(){var t=!0,n=this,r=e.trim(this.$mobileNum.val()),i=e.trim(this.$phoneverify.val());n.errorInfo("");var s;if(r&&n.coutryview){var a=n.coutryview.getSelected();s=a.code}n.coutryview.isCN()&&!this.checkPhone(r)&&(this.phoneError(),t=!1),e.trim(this.$picverify.val())||(n.codeError("请输入图片验证码",this.$picverify),t=!1),e.trim(this.$phoneverify.val())||(n.codeError("请输入短信验证码",this.$phoneverify),t=!1);if(!t)return;r=u.getPhoneByCode(s,r),o.bindPhone(r,i,function(e){n.pop.close(),n.callback(e),clearInterval(n.holdTimer),window.history.go(0)},function(e){e.success||(n.codeError("",n.$picverify),n.codeError("",n.$phoneverify),n.errorInfo(e.msg))})},checkPhone:function(t){return t=e.trim(t),u.validator(t,"mobile")},oldPhoneError:function(e){e===!1?(this.$oldphoneBox.removeClass("is-error"),this.$oldphone_error.hide()):(this.$oldphoneBox.addClass("is-error"),this.$oldphone_error.html(e||"请输入正确的手机号码").show())},sendCode:function(t){var n=!0,r=t.parents(".js-bindMobile-first").length?!0:!1,i=this,s=t.parents(".js-bindMobile-first").length?t.parents(".js-bindMobile-first"):t.parents(".js-bindMobile-next");$mobileNum=s.find(".mobilenum"),$picverify=s.find("#picverify"),$phoneverify=s.find("#phoneverify"),num=e.trim($mobileNum.val());var u="mobileVerifyCode",a;if(num&&i.coutryview){var f=i.coutryview.getSelected();a=f.code}i.isRebind?(u="mobileVerifyCode2",a&&a==="+86"&&!this.checkPhone(num)&&(this.phoneError("请输入正确的手机号码"),n=!1)):a&&a==="+86"&&!i.checkPhone(num)&&(this.phoneError("请输入正确的手机号码"),n=!1),e.trim($picverify.val())||(i.codeError("请输入图片验证码",$picverify),n=!1),t.hasClass("already")&&(n=!1);if(!n)return;i.errorInfo("");var l=0,c=function(e){t.addClass("already").html("已发送("+e+")"),clearInterval(l),l=setInterval(function(){e--;if(e<=0){t.html("获取验证码"),t.removeClass("already"),$picverify.attr("data-ok","ok"),clearInterval(l);return}t.html("已发送("+e+")")},1e3),i.holdTimer=l};t.data("is-new")&&(num=null),num&&a&&a!=="+86"&&(num=a.replace(/\+/,"")+"-"+num);var h=180;o[u](num,function(e){c(h)},function(e){i.$img_validcode.click();if(!e.time){i.codeError("",$picverify),i.codeError("",$phoneverify),i.errorInfo(e.msg||"服务器繁忙,请稍后再试!");return}i.codeError("",$picverify),i.codeError("",$phoneverify),i.errorInfo(e.msg);var t=h-parseInt(e.time/1e3);t>0&&c(t)},{msgType:i.msgType,checkCode:e.trim($picverify.val()),checkUUID:i.uuid,isFirst:r})}};return a}),function(e,t){var n={},r=function(e,t){var n,r,i;if(typeof e=="string")return o(e);n=[];for(r=e.length,i=0;i<r;i++)n.push(o(e[i]));return t.apply(null,n)},i=function(e,t,n){arguments.length===2&&(n=t,t=null),r(t||[],function(){s(e,n,arguments)})},s=function(e,t,i){var s={exports:t},o;typeof t=="function"&&(i.length||(i=[r,s.exports,s]),o=t.apply(null,i),o!==undefined&&(s.exports=o)),n[e]=s.exports},o=function(t){var r=n[t]||e[t];if(!r)throw new Error("`"+t+"` is undefined");return r},u=function(e){var t,r,i,s,o,u;u=function(e){return e&&e.charAt(0).toUpperCase()+e.substr(1)};for(t in n){r=e;if(!n.hasOwnProperty(t))continue;i=t.split("/"),o=u(i.pop());while(s=u(i.shift()))r[s]=r[s]||{},r=r[s];r[o]=n[t]}return e},a=function(n){return e.__dollar=n,u(t(e,i,r))},f;typeof module=="object"&&typeof module.exports=="object"?module.exports=a():typeof define=="function"&&define.amd?define("plugin/uploader/webuploader.xm",["jquery"],a):(f=e.WebUploader,e.WebUploader=a(),e.WebUploader.noConflict=function(){e.WebUploader=f})}(window,function(e,t,n){return t("dollar-third",[],function(){var t=e.require,n=e.__dollar||e.jQuery||e.Zepto||t("jquery")||t("zepto");if(!n)throw new Error("jQuery or Zepto not found!");return n}),t("dollar",["dollar-third"],function(e){return e}),t("promise-third",["dollar"],function(e){return{Deferred:e.Deferred,when:e.when,isPromise:function(e){return e&&typeof e.then=="function"}}}),t("promise",["promise-third"],function(e){return e}),t("base",["dollar","promise"],function(t,n){function s(e){return function(){return i.apply(e,arguments)}}function o(e,t){return function(){return e.apply(t,arguments)}}function u(e){var t;return Object.create?Object.create(e):(t=function(){},t.prototype=e,new t)}var r=function(){},i=Function.call;return{version:"0.1.6",$:t,Deferred:n.Deferred,isPromise:n.isPromise,when:n.when,browser:function(e){var t={},n=e.match(/WebKit\/([\d.]+)/),r=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),i=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i),s=e.match(/Firefox\/([\d.]+)/),o=e.match(/Safari\/([\d.]+)/),u=e.match(/OPR\/([\d.]+)/);return n&&(t.webkit=parseFloat(n[1])),r&&(t.chrome=parseFloat(r[1])),i&&(t.ie=parseFloat(i[1])),s&&(t.firefox=parseFloat(s[1])),o&&(t.safari=parseFloat(o[1])),u&&(t.opera=parseFloat(u[1])),t}(navigator.userAgent),os:function(e){var t={},n=e.match(/(?:Android);?[\s\/]+([\d.]+)?/),r=e.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return n&&(t.android=parseFloat(n[1])),r&&(t.ios=parseFloat(r[1].replace(/_/g,"."))),t}(navigator.userAgent),inherits:function(e,n,r){var i;return typeof n=="function"?(i=n,n=null):n&&n.hasOwnProperty("constructor")?i=n.constructor:i=function(){return e.apply(this,arguments)},t.extend(!0,i,e,r||{}),i.__super__=e.prototype,i.prototype=u(e.prototype),n&&t.extend(!0,i.prototype,n),i},noop:r,bindFn:o,log:function(){return e.console?o(console.log,console):r}(),nextTick:function(){return function(e){setTimeout(e,1)}}(),slice:s([].slice),guid:function(){var e=0;return function(t){var n=(+(new Date)).toString(32),r=0;for(;r<5;r++)n+=Math.floor(Math.random()*65535).toString(32);return(t||"wu_")+n+(e++).toString(32)}}(),formatSize:function(e,t,n){var r;n=n||["B","K","M","G","TB"];while((r=n.shift())&&e>1024)e/=1024;return(r==="B"?e:e.toFixed(t||2))+r}}}),t("mediator",["base"],function(e){function s(e,n,r,i){return t.grep(e,function(e){return e&&(!n||e.e===n)&&(!r||e.cb===r||e.cb._cb===r)&&(!i||e.ctx===i)})}function o(e,n,i){t.each((e||"").split(r),function(e,t){i(t,n)})}function u(e,t){var n=!1,r=-1,i=e.length,s;while(++r<i){s=e[r];if(s.cb.apply(s.ctx2,t)===!1){n=!0;break}}return!n}var t=e.$,n=[].slice,r=/\s+/,i;return i={on:function(e,t,n){var r=this,i;return t?(i=this._events||(this._events=[]),o(e,t,function(e,t){var s={e:e};s.cb=t,s.ctx=n,s.ctx2=n||r,s.id=i.length,i.push(s)}),this):this},once:function(e,t,n){var r=this;return t?(o(e,t,function(e,t){var i=function(){return r.off(e,i),t.apply(n||r,arguments)};i._cb=t,r.on(e,i,n)}),r):r},off:function(e,n,r){var i=this._events;return i?!e&&!n&&!r?(this._events=[],this):(o(e,n,function(e,n){t.each(s(i,e,n,r),function(){delete i[this.id]})}),this):this},trigger:function(e){var t,r,i;return!this._events||!e?this:(t=n.call(arguments,1),r=s(this._events,e),i=s(this._events,"all"),u(r,t)&&u(i,arguments))}},t.extend({installTo:function(e){return t.extend(e,i)}},i)}),t("uploader",["base","mediator"],function(e,t){function r(e){this.options=n.extend(!0,{},r.options,e),this._init(this.options)}var n=e.$;return r.options={},t.installTo(r.prototype),n.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(e,t){r.prototype[e]=function(){return this.request(t,arguments)}}),n.extend(r.prototype,{state:"pending",_init:function(e){var t=this;t.request("init",e,function(){t.state="ready",t.trigger("ready")})},option:function(e,t){var r=this.options;if(!(arguments.length>1))return e?r[e]:r;n.isPlainObject(t)&&n.isPlainObject(r[e])?n.extend(r[e],t):r[e]=t},getStats:function(){var e=this.request("get-stats");return e?{successNum:e.numOfSuccess,progressNum:e.numOfProgress,cancelNum:e.numOfCancel,invalidNum:e.numOfInvalid,uploadFailNum:e.numOfUploadFailed,queueNum:e.numOfQueue,interruptNum:e.numofInterrupt}:{}},trigger:function(e){var r=[].slice.call(arguments,1),i=this.options,s="on"+e.substring(0,1).toUpperCase()+e.substring(1);return t.trigger.apply(this,arguments)===!1||n.isFunction(i[s])&&i[s].apply(this,r)===!1||n.isFunction(this[s])&&this[s].apply(this,r)===!1||t.trigger.apply(t,[this,e].concat(r))===!1?!1:!0},destroy:function(){this.request("destroy",arguments),this.off()},request:e.noop}),e.create=r.create=function(e){return new r(e)},e.Uploader=r,r}),t("runtime/runtime",["base","mediator"],function(e,t){function s(t){this.options=n.extend({container:document.body},t),this.uid=e.guid("rt_")}var n=e.$,r={},i=function(e){for(var t in e)if(e.hasOwnProperty(t))return t;return null};return n.extend(s.prototype,{getContainer:function(){var e=this.options,t,r;return this._container?this._container:(t=n(e.container||document.body),r=n(document.createElement("div")),r.attr("id","rt_"+this.uid),r.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),t.append(r),t.addClass("webuploader-container"),this._container=r,this._parent=t,r)},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.remove(),this._parent&&this._parent.removeClass("webuploader-container"),this.off()}}),s.orders="html5,flash",s.addRuntime=function(e,t){r[e]=t},s.hasRuntime=function(e){return e?!!r[e]:!!i(r)},s.create=function(e,t){var o,u;t=t||s.orders,n.each(t.split(/\s*,\s*/g),function(){if(r[this])return o=this,!1}),o=o||i(r);if(!o)throw new Error("Runtime Error");return u=new r[o](e),u},t.installTo(s.prototype),s}),t("runtime/client",["base","mediator","runtime/runtime"],function(e,t,n){function i(t,i){var s=e.Deferred(),o;this.uid=e.guid("client_"),this.runtimeReady=function(e){return s.done(e)},this.connectRuntime=function(t,u){if(o)throw new Error("already connected!");return s.done(u),typeof t=="string"&&r.get(t)&&(o=r.get(t)),o=o||r.get(null,i),o?(e.$.extend(o.options,t),o.__promise.then(s.resolve),o.__client++):(o=n.create(t,t.runtimeOrder),o.__promise=s.promise(),o.once("ready",s.resolve),o.init(),r.add(o),o.__client=1),i&&(o.__standalone=i),o},this.getRuntime=function(){return o},this.disconnectRuntime=function(){if(!o)return;o.__client--,o.__client<=0&&(r.remove(o),delete o.__promise,o.destroy()),o=null},this.exec=function(){if(!o)return;var n=e.slice(arguments);return t&&n.unshift(t),o.exec.apply(this,n)},this.getRuid=function(){return o&&o.uid},this.destroy=function(e){return function(){e&&e.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var r;return r=function(){var e={};return{add:function(t){e[t.uid]=t},get:function(t,n){var r;if(t)return e[t];for(r in e){if(n&&e[r].__standalone)continue;return e[r]}return null},remove:function(t){delete e[t.uid]}}}(),t.installTo(i.prototype),i}),t("lib/dnd",["base","mediator","runtime/client"],function(e,t,n){function i(e){e=this.options=r.extend({},i.options,e),e.container=r(e.container);if(!e.container.length)return;n.call(this,"DragAndDrop")}var r=e.$;return i.options={accept:null,disableGlobalDnd:!1},e.inherits(n,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(i.prototype),i}),t("widgets/widget",["base","uploader"],function(e,t){function u(e){if(!e)return!1;var t=e.length,r=n.type(e);return e.nodeType===1&&t?!0:r==="array"||r!=="function"&&r!=="string"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function a(e){this.owner=e,this.options=e.options}var n=e.$,r=t.prototype._init,i=t.prototype.destroy,s={},o=[];return n.extend(a.prototype,{init:e.noop,invoke:function(e,t){var r=this.responseMap;return!!r&&e in r&&r[e]in this&&!!n.isFunction(this[r[e]])?this[r[e]].apply(this,t):s},request:function(){return this.owner.request.apply(this.owner,arguments)}}),n.extend(t.prototype,{_init:function(){var e=this,t=e._widgets=[],i=e.options.disableWidgets||"";return n.each(o,function(n,r){(!i||!~i.indexOf(r._name))&&t.push(new r(e))}),r.apply(e,arguments)},request:function(t,n,r){var i=0,o=this._widgets,a=o&&o.length,f=[],l=[],c,h,p,d;n=u(n)?n:[n];for(;i<a;i++)c=o[i],h=c.invoke(t,n),h!==s&&(e.isPromise(h)?l.push(h):f.push(h));return r||l.length?(p=e.when.apply(e,l),d=p.pipe?"pipe":"then",p[d](function(){var t=e.Deferred(),n=arguments;return n.length===1&&(n=n[0]),setTimeout(function(){t.resolve(n)},1),t.promise()})[r?d:"done"](r||e.noop)):f[0]},destroy:function(){i.apply(this,arguments),this._widgets=null}}),t.register=a.register=function(t,r){var i={init:"init",destroy:"destroy",name:"anonymous"},s;return arguments.length===1?(r=t,n.each(r,function(e){if(e[0]==="_"||e==="name"){e==="name"&&(i.name=r.name);return}i[e.replace(/[A-Z]/g,"-$&").toLowerCase()]=e})):i=n.extend(i,t),r.responseMap=i,s=e.inherits(a,r),s._name=i.name,o.push(s),s},t.unRegister=a.unRegister=function(e){if(!e||e==="anonymous")return;for(var t=o.length;t--;)o[t]._name===e&&o.splice(t,1)},a}),t("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,t,n){var r=e.$;return t.options.dnd="",t.register({name:"dnd",init:function(t){if(!t.dnd||this.request("predict-runtime-type")!=="html5")return;var i=this,s=e.Deferred(),o=r.extend({},{disableGlobalDnd:t.disableGlobalDnd,container:t.dnd,accept:t.accept}),u;return this.dnd=u=new n(o),u.once("ready",s.resolve),u.on("drop",function(e){i.request("add-file",[e])}),u.on("accept",function(e){return i.owner.trigger("dndAccept",e)}),u.init(),s.promise()},destroy:function(){this.dnd&&this.dnd.destroy()}})}),t("lib/filepaste",["base","mediator","runtime/client"],function(e,t,n){function i(e){e=this.options=r.extend({},e),e.container=r(e.container||document.body),n.call(this,"FilePaste")}var r=e.$;return e.inherits(n,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(i.prototype),i}),t("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,t,n){var r=e.$;return t.register({name:"paste",init:function(t){if(!t.paste||this.request("predict-runtime-type")!=="html5")return;var i=this,s=e.Deferred(),o=r.extend({},{container:t.paste,accept:t.accept}),u;return this.paste=u=new n(o),u.once("ready",s.resolve),u.on("paste",function(e){i.owner.request("add-file",[e])}),u.init(),s.promise()},destroy:function(){this.paste&&this.paste.destroy()}})}),t("lib/blob",["base","runtime/client"],function(e,t){function n(e,n){var r=this;r.source=n,r.ruid=e,this.size=n.size||0,!n.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+(this.ext==="jpg"?"jpeg":this.ext):this.type=n.type||"application/octet-stream",t.call(r,"Blob"),this.uid=n.uid||this.uid,e&&r.connectRuntime(e)}return e.inherits(t,{constructor:n,slice:function(e,t){return this.exec("slice",e,t)},getSource:function(){return this.source}}),n}),t("lib/file",["base","lib/blob"],function(e,t){function i(e,i){var s;this.name=i.name||"untitled"+n++,s=r.exec(i.name)?RegExp.$1.toLowerCase():"",!s&&i.type&&(s=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(i.type)?RegExp.$1.toLowerCase():"",this.name+="."+s),this.ext=s,this.lastModifiedDate=i.lastModifiedDate||(new Date).toLocaleString(),t.apply(this,arguments)}var n=1,r=/\.([^.]+)$/;return e.inherits(t,i)}),t("lib/filepicker",["base","runtime/client","lib/file"],function(t,n,r){function s(e){e=this.options=i.extend({},s.options,e),e.container=i(e.id);if(!e.container.length)throw new Error("按钮指定错误");e.innerHTML=e.innerHTML||e.label||e.container.html()||"",e.button=i(e.button||document.createElement("div")),e.button.html(e.innerHTML),e.container.html(e.button),n.call(this,"FilePicker",!0)}var i=t.$;return s.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file",style:"webuploader-pick"},t.inherits(n,{constructor:s,init:function(){var n=this,s=n.options,o=s.button,u=s.style;u&&o.addClass("webuploader-pick"),n.on("all",function(e){var t;switch(e){case"mouseenter":u&&o.addClass("webuploader-pick-hover");break;case"mouseleave":u&&o.removeClass("webuploader-pick-hover");break;case"change":t=n.exec("getFiles"),n.trigger("select",i.map(t,function(e){return e=new r(n.getRuid(),e),e._refer=s.container,e}),s.container)}}),n.connectRuntime(s,function(){n.refresh(),n.exec("init",s),n.trigger("ready")}),this._resizeHandler=t.bindFn(this.refresh,this),i(e).on("resize",this._resizeHandler)},refresh:function(){var e=this.getRuntime().getContainer(),t=this.options.button,n=t.outerWidth?t.outerWidth():t.width(),r=t.outerHeight?t.outerHeight():t.height(),i=t.offset();n&&r&&e.css({bottom:"auto",right:"auto",width:n+"px",height:r+"px"}).offset(i)},enable:function(){var e=this.options.button;e.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var e=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),e.addClass("webuploader-pick-disable")},destroy:function(){var t=this.options.button;i(e).off("resize",this._resizeHandler),t.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),s}),t("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,t,n){var r=e.$;return r.extend(t.options,{pick:null,accept:null}),t.register({name:"picker",init:function(e){return this.pickers=[],e.pick&&this.addBtn(e.pick)},refresh:function(){r.each(this.pickers,function(){this.refresh()})},addBtn:function(t){var i=this,s=i.options,o=s.accept,u=[];if(!t)return;return r.isPlainObject(t)||(t={id:t}),r(t.id).each(function(){var a,f,l;l=e.Deferred(),a=r.extend({},t,{accept:r.isPlainObject(o)?[o]:o,swf:s.swf,runtimeOrder:s.runtimeOrder,id:this}),f=new n(a),f.once("ready",l.resolve),f.on("select",function(e){i.owner.request("add-file",[e])}),f.on("dialogopen",function(){i.owner.trigger("dialogOpen",f.button)}),f.init(),i.pickers.push(f),u.push(l.promise())}),e.when.apply(e,u)},disable:function(){r.each(this.pickers,function(){this.disable()})},enable:function(){r.each(this.pickers,function(){this.enable()})},destroy:function(){r.each(this.pickers,function(){this.destroy()}),this.pickers=null}})}),t("lib/image",["base","runtime/client","lib/blob"],function(e,t,n){function i(e){this.options=r.extend({},i.options,e),t.call(this,"Image"),this.on("load",function(){this._info=this.exec("info"),this._meta=this.exec("meta")})}var r=e.$;return i.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1},e.inherits(t,{constructor:i,info:function(e){return e?(this._info=e,this):this._info},meta:function(e){return e?(this._meta=e,this):this._meta},loadFromBlob:function(e){var t=this,n=e.getRuid();this.connectRuntime(n,function(){t.exec("init",t.options),t.exec("loadFromBlob",e)})},resize:function(){var t=e.slice(arguments);return this.exec.apply(this,["resize"].concat(t))},crop:function(){var t=e.slice(arguments);return this.exec.apply(this,["crop"].concat(t))},getAsDataUrl:function(e){return this.exec("getAsDataUrl",e)},getAsBlob:function(e){var t=this.exec("getAsBlob",e);return new n(this.getRuid(),t)}}),i}),t("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,t,n){var r=e.$,i;return i=function(e){var t=0,n=[],r=function(){var r;while(n.length&&t<e)r=n.shift(),t+=r[0],r[1]()};return function(e,i,s){n.push([i,s]),e.once("destroy",function(){t-=i,setTimeout(r,1)}),setTimeout(r,1)}}(5242880),r.extend(t.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),t.register({name:"image",makeThumb:function(e,t,s,o){var u,a;e=this.request("get-file",e);if(!e.type.match(/^image/)){t(!0);return}u=r.extend({},this.options.thumb),r.isPlainObject(s)&&(u=r.extend(u,s),s=null),s=s||u.width,o=o||u.height,a=new n(u),a.once("load",function(){e._info=e._info||a.info(),e._meta=e._meta||a.meta(),s<=1&&s>0&&(s=e._info.width*s),o<=1&&o>0&&(o=e._info.height*o),a.resize(s,o)}),a.once("complete",function(){t(!1,a.getAsDataUrl(u.type)),a.destroy()}),a.once("error",function(e){t(e||!0),a.destroy()}),i(a,e.source.size,function(){e._info&&a.info(e._info),e._meta&&a.meta(e._meta),a.loadFromBlob(e.source)})},beforeSendFile:function(t){var i=this.options.compress||this.options.resize,s=i&&i.compressSize||0,o=i&&i.noCompressIfLarger||!1,u,a;t=this.request("get-file",t);if(!i||!~"image/jpeg,image/jpg".indexOf(t.type)||t.size<s||t._compressed)return;return i=r.extend({},i),a=e.Deferred(),u=new n(i),a.always(function(){u.destroy(),u=null}),u.once("error",a.reject),u.once("load",function(){var e=i.width,n=i.height;t._info=t._info||u.info(),t._meta=t._meta||u.meta(),e<=1&&e>0&&(e=t._info.width*e),n<=1&&n>0&&(n=t._info.height*n),u.resize(e,n)}),u.once("complete",function(){var e,n;try{e=u.getAsBlob(i.type),n=t.size;if(!o||e.size<n)t.source=e,t.size=e.size,t.trigger("resize",e.size,n);t._compressed=!0,a.resolve()}catch(r){a.resolve()}}),t._info&&u.info(t._info),t._meta&&u.meta(t._meta),u.loadFromBlob(t.source),a.promise()}})}),t("file",["base","mediator"],function(e,t){function u(){return r+i++}function a(e){this.name=e.name||"Untitled",this.size=e.size||0,this.type=e.type||"application/octet-stream",this.lastModifiedDate=e.lastModifiedDate||new Date*1,this.id=u(),this.ext=s.exec(this.name)?RegExp.$1:"",this.statusText="",o[this.id]=a.Status.INITED,this.source=e,this.loaded=0,this.on("error",function(e){this.setStatus(a.Status.ERROR,e)})}var n=e.$,r="WU_FILE_",i=0,s=/\.([^.]+)$/,o={};return n.extend(a.prototype,{setStatus:function(e,t){var n=o[this.id];typeof t!="undefined"&&(this.statusText=t),e!==n&&(o[this.id]=e,this.trigger("statuschange",e,n))},getStatus:function(){return o[this.id]},getSource:function(){return this.source},destroy:function(){this.off(),delete o[this.id]}}),t.installTo(a.prototype),a.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},a}),t("queue",["base","mediator","file"],function(e,t,n){function s(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0},this._queue=[],this._map={}}var r=e.$,i=n.Status;return r.extend(s.prototype,{append:function(e){return this._queue.push(e),this._fileAdded(e),this},prepend:function(e){return this._queue.unshift(e),this._fileAdded(e),this},getFile:function(e){return typeof e!="string"?e:this._map[e]},fetch:function(e){var t=this._queue.length,n,r;e=e||i.QUEUED;for(n=0;n<t;n++){r=this._queue[n];if(e===r.getStatus())return r}return null},sort:function(e){typeof e=="function"&&this._queue.sort(e)},getFiles:function(){var e=[].slice.call(arguments,0),t=[],n=0,i=this._queue.length,s;for(;n<i;n++){s=this._queue[n];if(e.length&&!~r.inArray(s.getStatus(),e))continue;t.push(s)}return t},removeFile:function(e){var t=this,n=this._map[e.id];n&&(delete this._map[e.id],this._delFile(e),e.destroy(),this.stats.numofDeleted++)},_delFile:function(e){for(var t=this._queue.length-1;t>=0;t--)if(this._queue[t]==e){this._queue.splice(t,1);break}},_fileAdded:function(e){var t=this,n=this._map[e.id];n||(this._map[e.id]=e,e.on("statuschange",function(e,n){t._onFileStatusChange(e,n)}))},_onFileStatusChange:function(e,t){var n=this.stats;switch(t){case i.PROGRESS:n.numOfProgress--;break;case i.QUEUED:n.numOfQueue--;break;case i.ERROR:n.numOfUploadFailed--;break;case i.INVALID:n.numOfInvalid--;break;case i.INTERRUPT:n.numofInterrupt--}switch(e){case i.QUEUED:n.numOfQueue++;break;case i.PROGRESS:n.numOfProgress++;break;case i.ERROR:n.numOfUploadFailed++;break;case i.COMPLETE:n.numOfSuccess++;break;case i.CANCELLED:n.numOfCancel++;break;case i.INVALID:n.numOfInvalid++;break;case i.INTERRUPT:n.numofInterrupt++}}}),t.installTo(s.prototype),s}),t("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,t,n,r,i,s){var o=e.$,u=/\.\w+$/,a=r.Status;return t.register({name:"queue",init:function(t){var r=this,i,u,a,f,l,c,h;o.isPlainObject(t.accept)&&(t.accept=[t.accept]);if(t.accept){l=[];for(a=0,u=t.accept.length;a<u;a++)f=t.accept[a].extensions,f&&l.push(f);l.length&&(c="\\."+l.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),r.accept=new RegExp(c,"i")}r.queue=new n,r.stats=r.queue.stats;if(this.request("predict-runtime-type")!=="html5")return;return i=e.Deferred(),this.placeholder=h=new s("Placeholder"),h.connectRuntime({runtimeOrder:"html5"},function(){r._ruid=h.getRuid(),i.resolve()}),i.promise()},_wrapFile:function(e){if(!(e instanceof r)){if(!(e instanceof i)){if(!this._ruid)throw new Error("Can't add external files.");e=new i(this._ruid,e)}e=new r(e)}return e},acceptFile:function(e){var t=!e||!e.size||this.accept&&u.exec(e.name)&&!this.accept.test(e.name);return!t},_addFile:function(e){var t=this;e=t._wrapFile(e);if(!t.owner.trigger("beforeFileQueued",e))return;if(!t.acceptFile(e)){t.owner.trigger("error","Q_TYPE_DENIED",e);return}return t.queue.append(e),t.owner.trigger("fileQueued",e),e},getFile:function(e){return this.queue.getFile(e)},addFile:function(e){var t=this;e.length||(e=[e]);var n=t.owner.trigger("checkLimit",e);if(!n)return!1;t.owner.trigger("fileDialogComplete",e),e=o.map(e,function(e){return t._addFile(e)}),e.length&&(t.owner.trigger("filesQueued",e),t.options.auto&&setTimeout(function(){t.request("start-upload")},20))},getStats:function(){return this.stats},removeFile:function(e,t){var n=this;e=e.id?e:n.queue.getFile(e),this.request("cancel-file",e),t&&this.queue.removeFile(e)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(e,t){var n=this,r,i,s;if(e){e=e.id?e:n.queue.getFile(e),e.setStatus(a.QUEUED),t||n.request("start-upload");return}r=n.queue.getFiles(a.ERROR),i=0,s=r.length;for(;i<s;i++)e=r[i],e.setStatus(a.QUEUED);n.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset"),this.queue=new n,this.stats=this.queue.stats},destroy:function(){this.reset(),this.placeholder&&this.placeholder.destroy()}})}),t("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,t){return e.support=function(){return t.hasRuntime.apply(t,arguments)},e.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error")},predictRuntimeType:function(){var e=this.options.runtimeOrder||t.orders,n=this.type,r,i;if(!n){e=e.split(/\s*,\s*/g);for(r=0,i=e.length;r<i;r++)if(t.hasRuntime(e[r])){this.type=n=e[r];break}}return n}})}),t("lib/transport",["base","runtime/client","mediator"],function(e,t,n){function i(e){var n=this;e=n.options=r.extend(!0,{},i.options,e||{}),t.call(this,"Transport"),this._blob=null,this._formData=e.formData||{},this._headers=e.headers||{},this.on("progress",this._timeout),this.on("load error",function(){n.trigger("progress",1),clearTimeout(n._timer)})}var r=e.$;return i.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},r.extend(i.prototype,{appendBlob:function(e,t,n){var r=this,i=r.options;r.getRuid()&&r.disconnectRuntime(),r.connectRuntime(t.ruid,function(){r.exec("init")}),r._blob=t,i.fileVal=e||i.fileVal,i.filename=n||i.filename},append:function(e,t){typeof e=="object"?r.extend(this._formData,e):this._formData[e]=t},setRequestHeader:function(e,t){typeof e=="object"?r.extend(this._headers,e):this._headers[e]=t},send:function(e){this.exec("send",e),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var e=this,t=e.options.timeout;if(!t)return;clearTimeout(e._timer),e._timer=setTimeout(function(){e.abort(),e.trigger("error","timeout")},t)}}),n.installTo(i.prototype),i}),t("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,t,n,r){function u(e,t){var n=[],r=e.source,i=r.size,s=t?Math.ceil(i/t):1,o=0,u=0,a,f;f={file:e,has:function(){return!!n.length},shift:function(){return n.shift()},unshift:function(e){n.unshift(e)}};while(u<s)a=Math.min(t,i-o),n.push({file:e,start:o,end:t?o+a:i,total:i,chunks:s,chunk:u++,cuted:f}),o+=a;return e.blocks=n.concat(),e.remaning=n.length,f}var i=e.$,s=e.isPromise,o=n.Status;i.extend(t.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}}),t.register({name:"upload",init:function(){var t=this.owner,n=this;this.runing=!1,this.progress=!1,t.on("startUpload",function(){n.progress=!0}).on("uploadFinished",function(){n.progress=!1}),this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this.__tick=e.bindFn(this._tick,this),t.on("uploadComplete",function(e){e.blocks&&i.each(e.blocks,function(e,t){t.transport&&(t.transport.abort(),t.transport.destroy()),delete t.transport}),delete e.blocks,delete e.remaning})},reset:function(){this.request("stop-upload",!0),this.runing=!1,this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this._trigged=!1,this._promise=null},startUpload:function(t){var n=this;i.each(n.request("get-files",o.INVALID),function(){n.request("remove-file",this)}),t?(t=t.id?t:n.request("get-file",t),t.getStatus()===o.INTERRUPT?(t.setStatus(o.QUEUED),i.each(n.pool,function(e,n){if(n.file!==t)return;n.transport&&n.transport.send(),t.setStatus(o.PROGRESS)})):t.getStatus()!==o.PROGRESS&&t.setStatus(o.QUEUED)):i.each(n.request("get-files",[o.INITED]),function(){this.setStatus(o.QUEUED)});if(n.runing)return n.owner.trigger("startUpload",t),e.nextTick(n.__tick);n.runing=!0;var r=[];t||i.each(n.pool,function(e,t){var i=t.file;i.getStatus()===o.INTERRUPT&&(n._trigged=!1,r.push(i),t.transport&&t.transport.send())}),i.each(r,function(){this.setStatus(o.PROGRESS)}),t||i.each(n.request("get-files",o.INTERRUPT),function(){this.setStatus(o.PROGRESS)}),n._trigged=!1,e.nextTick(n.__tick),n.owner.trigger("startUpload")},stopUpload:function(t,n){var r=this;t===!0&&(n=t,t=null);if(r.runing===!1)return;if(t){t=t.id?t:r.request("get-file",t);if(t.getStatus()!==o.PROGRESS&&t.getStatus()!==o.QUEUED)return;return t.setStatus(o.INTERRUPT),i.each(r.pool,function(e,i){i.file===t&&(i.transport&&i.transport.abort(),n&&(r._putback(i),r._popBlock(i)))}),r.owner.trigger("stopUpload",t),e.nextTick(r.__tick)}r.runing=!1,this._promise&&this._promise.file&&this._promise.file.setStatus(o.INTERRUPT),n&&i.each(r.pool,function(e,t){t.transport&&t.transport.abort(),t.file.setStatus(o.INTERRUPT)}),r.owner.trigger("stopUpload")},cancelFile:function(e){e=e.id?e:this.request("get-file",e),e.blocks&&i.each(e.blocks,function(e,t){var n=t.transport;n&&(n.abort(),n.destroy(),delete t.transport)}),e.setStatus(o.CANCELLED),this.owner.trigger("fileDequeued",e)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(e,t){e=e.id?e:this.request("get-file",e),e.setStatus(t||o.COMPLETE),e.skipped=!0,e.blocks&&i.each(e.blocks,function(e,t){var n=t.transport;n&&(n.abort(),n.destroy(),delete t.transport)}),this.owner.trigger("uploadSkip",e)},_tick:function(){var t=this,n=t.options,r,i;if(t._promise)return t._promise.always(t.__tick);t.pool.length<n.threads&&(i=t._nextBlock())?(t._trigged=!1,r=function(n){t._promise=null,n&&n.file&&t._startSend(n),e.nextTick(t.__tick)},t._promise=s(i)?i.always(r):r(i)):!t.remaning&&!t._getStats().numOfQueue&&!t._getStats().numofInterrupt&&(t.runing=!1,t._trigged||e.nextTick(function(){t.owner.trigger("uploadFinished")}),t._trigged=!0)},_putback:function(e){var t;e.cuted.unshift(e),t=this.stack.indexOf(e.cuted),~t||this.stack.unshift(e.cuted)},_getStack:function(){var e=0,t;while(t=this.stack[e++]){if(t.has()&&t.file.getStatus()===o.PROGRESS)return t;(!t.has()||t.file.getStatus()!==o.PROGRESS&&t.file.getStatus()!==o.INTERRUPT)&&this.stack.splice(--e,1)}return null},_nextBlock:function(){var e=this,t=e.options,n,r,i,o;if(n=this._getStack())return t.prepareNextFile&&!e.pending.length&&e._prepareNextFile(),n.shift();if(e.runing)return!e.pending.length&&e._getStats().numOfQueue&&e._prepareNextFile(),r=e.pending.shift(),i=function(r){return r?(n=u(r,t.chunked?t.chunkSize:0),e.stack.push(n),n.shift()):null},s(r)?(o=r.file,r=r[r.pipe?"pipe":"then"](i),r.file=o,r):i(r)},_prepareNextFile:function(){var e=this,t=e.request("fetch-file"),n=e.pending,r;t&&(r=e.request("before-send-file",t,function(){return t.getStatus()===o.PROGRESS||t.getStatus()===o.INTERRUPT?t:e._finishFile(t)}),e.owner.trigger("uploadStart",t),t.setStatus(o.PROGRESS),r.file=t,r.done(function(){var e=i.inArray(r,n);~e&&n.splice(e,1,t)}),r.fail(function(n){t.setStatus(o.ERROR,n),e.owner.trigger("uploadError",t,n),e.owner.trigger("uploadComplete",t)}),n.push(r))},_popBlock:function(e){var t=i.inArray(e,this.pool);this.pool.splice(t,1),e.file.remaning--,this.remaning--},_startSend:function(t){var n=this,r=t.file,i;if(r.getStatus()!==o.PROGRESS){r.getStatus()===o.INTERRUPT&&n._putback(t);return}n.pool.push(t),n.remaning++,t.blob=t.chunks===1?r.source:r.source.slice(t.start,t.end),i=n.request("before-send",t,function(){r.getStatus()===o.PROGRESS?n._doSend(t):(n._popBlock(t),e.nextTick(n.__tick))}),i.fail(function(){r.remaning===1?n._finishFile(r).always(function(){t.percentage=1,n._popBlock(t),n.owner.trigger("uploadComplete",r),e.nextTick(n.__tick)}):(t.percentage=1,n.updateFileProgress(r),n._popBlock(t),e.nextTick(n.__tick))})},_doSend:function(t){var n=this,s=n.owner,u=n.options,a=t.file,f=new r(u),l=i.extend({},u.formData),c=i.extend({},u.headers),h,p;t.transport=f,f.on("destroy",function(){delete t.transport,n._popBlock(t),e.nextTick(n.__tick)}),f.on("progress",function(e){t.percentage=e,n.updateFileProgress(a)}),h=function(e){var n;return p=f.getResponseAsJson()||{},p._raw=f.getResponse(),n=function(t){e=t},s.trigger("uploadAccept",t,p,n)||(e=e||"server"),e},f.on("error",function(e,n){t.retried=t.retried||0,s.trigger("chunkLogger","error",t,-5,p),t.chunks>1&&~"http,abort".indexOf(e)&&t.retried<u.chunkRetry?(t.retried++,setTimeout(function(){f.send()},3e3)):(!n&&e==="server"&&(e=h(e)),a.setStatus(o.ERROR,e),s.trigger("uploadError",a,e),s.trigger("uploadComplete",a))}),f.on("load",function(){var e;if(e=h()){f.trigger("error",e,!0);return}s.trigger("chunkLogger","success",t),a.remaning===1?n._finishFile(a,p):f.destroy()}),l=i.extend(l,{id:a.id,name:a.name,type:a.type,lastModifiedDate:a.lastModifiedDate,size:a.size}),t.chunks>1&&i.extend(l,{chunks:t.chunks,chunk:t.chunk}),s.trigger("uploadBeforeSend",t,l,c),f.options.server=this.options.server,f.appendBlob(u.fileVal,t.blob,a.name),f.append(l),f.setRequestHeader(c),f.send(),t.startTime=new Date},_finishFile:function(e,t,n){var r=this.owner;return r.request("after-send-file",arguments,function(i){i=i?"ret"in i?i:t:t,e.setStatus(o.COMPLETE),r.trigger("uploadSuccess",e,i||t,n)}).fail(function(t){e.getStatus()===o.PROGRESS&&e.setStatus(o.ERROR,t),r.trigger("uploadError",e,t)}).always(function(){r.trigger("uploadComplete",e)})},updateFileProgress:function(e){var t=0,n=0;if(!e.blocks)return;i.each(e.blocks,function(e,t){n+=(t.percentage||0)*(t.end-t.start)}),e.uploaded=n,t=n/e.size,this.owner.trigger("uploadProgress",e,t||0)}})}),t("widgets/validator",["base","uploader","file","widgets/widget"],function(e,t,n){var r=e.$,i={},s;return s={addValidator:function(e,t){i[e]=t},removeValidator:function(e){delete i[e]}},t.register({name:"validator",init:function(){var t=this;e.nextTick(function(){r.each(i,function(){this.call(t.owner)})})}}),s.addValidator("fileNumLimit",function(){var e=this,t=e.options,n=0,r=parseInt(t.fileNumLimit,10),i=!0;if(!r)return;e.on("flushFileNumLimit",function(e){r=e,t.fileNumLimit=e}),e.on("checkLimit",function(e){var t=e.length;return t+n>r&&i&&(i=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",n,e),setTimeout(function(){i=!0},1)),t+n>r?!1:!0}),e.on("fileQueued",function(){n++}),e.on("fileDequeued",function(){n--}),e.on("reset",function(){n=0})}),s.addValidator("fileSizeLimit",function(){var e=this,t=e.options,n=0,r=parseInt(t.fileSizeLimit,10),i=!0;if(!r)return;e.on("beforeFileQueued",function(e){var t=n+e.size>r;return t&&i&&(i=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",r,e),setTimeout(function(){i=!0},1)),t?!1:!0}),e.on("fileQueued",function(e){n+=e.size}),e.on("fileDequeued",function(e){n-=e.size}),e.on("reset",function(){n=0})}),s.addValidator("fileSingleSizeLimit",function(){var e=this,t=e.options,r=t.fileSingleSizeLimit;if(!r)return;e.on("beforeFileQueued",function(e){if(e.size>r)return e.setStatus(n.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",r,e),!1})}),s.addValidator("duplicate",function(){function r(e){var t=0,n=0,r=e.length,i;for(;n<r;n++)i=e.charCodeAt(n),t=i+(t<<6)+(t<<16)-t;return t}var e=this,t=e.options,n={};if(t.duplicate)return;e.on("beforeFileQueued",function(e){var t=e.__hash||(e.__hash=r(e.name+e.size+e.lastModifiedDate));if(n[t])return this.trigger("error","F_DUPLICATE",e),!1}),e.on("fileQueued",function(e){var t=e.__hash;t&&(n[t]=!0)}),e.on("fileDequeued",function(e){var t=e.__hash;t&&delete n[t]}),e.on("reset",function(){n={}})}),s}),t("lib/md5",["runtime/client","mediator"],function(e,t){function n(){e.call(this,"Md5")}return t.installTo(n.prototype),n.prototype.loadFromBlob=function(e){var t=this;t.getRuid()&&t.disconnectRuntime(),t.connectRuntime(e.ruid,function(){t.exec("init"),t.exec("loadFromBlob",e)})},n.prototype.getResult=function(){return this.exec("getResult")},n}),t("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(e,t,n,r){return t.register({name:"md5",md5File:function(t,i,s){var o=new n,u=e.Deferred(),a=t instanceof r?t:this.request("get-file",t).source;return o.on("progress load",function(e){e=e||{},u.notify(e.total?e.loaded/e.total:1)}),o.on("complete",function(){u.resolve(o.getResult())}),o.on("error",function(e){u.reject(e)}),arguments.length>1&&(i=i||0,s=s||0,i<0&&(i=a.size+i),s<0&&(s=a.size+s),s=Math.min(s,a.size),a=a.slice(i,s)),o.loadFromBlob(a),u.promise()}})}),t("runtime/compbase",[],function(){function e(e,t){this.owner=e,this.options=e.options,this.getRuntime=function(){return t},this.getRuid=function(){return t.uid},this.trigger=function(){return e.trigger.apply(e,arguments)}}return e}),t("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(t,n,r){function o(){var e={},r=this,o=this.destroy;n.apply(r,arguments),r.type=i,r.exec=function(n,i){var o=this,u=o.uid,a=t.slice(arguments,2),f;if(s[n]){f=e[u]=e[u]||new s[n](o,r);if(f[i])return f[i].apply(f,a)}},r.destroy=function(){return o&&o.apply(this,arguments)}}var i="html5",s={};return t.inherits(n,{constructor:o,init:function(){var e=this;setTimeout(function(){e.trigger("ready")},1)}}),o.register=function(e,n){var i=s[e]=t.inherits(r,n);return i},e.Blob&&e.FileReader&&e.DataView&&n.addRuntime(i,o),o}),t("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,n){var r=this.owner.source,i=r.slice||r.webkitSlice||r.mozSlice;return r=i.call(r,e,n),new t(this.getRuid(),r)}})}),t("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,t,n){var r=e.$,i="webuploader-dnd-";return t.register("DragAndDrop",{init:function(){var t=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this),this.dragOverHandler=e.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this),this.dropHandler=e.bindFn(this._dropHandler,this),this.dndOver=!1,t.on("dragenter",this.dragEnterHandler),t.on("dragover",this.dragOverHandler),t.on("dragleave",this.dragLeaveHandler),t.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(r(document).on("dragover",this.dragOverHandler),r(document).on("drop",this.dropHandler))},_dragEnterHandler:function(e){var t=this,n=t._denied||!1,r;return e=e.originalEvent||e,t.dndOver||(t.dndOver=!0,r=e.dataTransfer.items,r&&r.length&&(t._denied=n=!t.trigger("accept",r)),t.elem.addClass(i+"over"),t.elem[n?"addClass":"removeClass"](i+"denied")),e.dataTransfer.dropEffect=n?"none":"copy",!1},_dragOverHandler:function(e){var t=this.elem.parent().get(0);return t&&!r.contains(t,e.currentTarget)?!1:(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,e),!1)},_dragLeaveHandler:function(){var e=this,t;return t=function(){e.dndOver=!1,e.elem.removeClass(i+"over "+i+"denied")},clearTimeout(e._leaveTimer),e._leaveTimer=setTimeout(t,100),!1},_dropHandler:function(e){var t=this,s=t.getRuid(),o=t.elem.parent().get(0),u,a;if(o&&!r.contains(o,e.currentTarget))return!1;e=e.originalEvent||e,u=e.dataTransfer;try{a=u.getData("text/html")}catch(f){}t.dndOver=!1,t.elem.removeClass(i+"over");if(!u||a)return;return t._getTansferFiles(u,function(e){t.trigger("drop",r.map(e,function(e){return new n(s,e)}))}),!1},_getTansferFiles:function(t,n){var r=[],i=[],s,o,u,a,f,l,c;s=t.items,o=t.files,c=!!s&&!!s[0].webkitGetAsEntry;for(f=0,l=o.length;f<l;f++)u=o[f],a=s&&s[f],c&&a.webkitGetAsEntry().isDirectory?i.push(this._traverseDirectoryTree(a.webkitGetAsEntry(),r)):r.push(u);e.when.apply(e,i).done(function(){if(!r.length)return;n(r)})},_traverseDirectoryTree:function(t,n){var r=e.Deferred(),i=this;return t.isFile?t.file(function(e){n.push(e),r.resolve()}):t.isDirectory&&t.createReader().readEntries(function(t){var s=t.length,o=[],u=[],a;for(a=0;a<s;a++)o.push(i._traverseDirectoryTree(t[a],u));e.when.apply(e,o).then(function(){n.push.apply(n,u),r.resolve()},r.reject)}),r.promise()},destroy:function(){var e=this.elem;if(!e)return;e.off("dragenter",this.dragEnterHandler),e.off("dragover",this.dragOverHandler),e.off("dragleave",this.dragLeaveHandler),e.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(r(document).off("dragover",this.dragOverHandler),r(document).off("drop",this.dropHandler))}})}),t("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,t,n){return t.register("FilePaste",{init:function(){var t=this.options,n=this.elem=t.container,r=".*",i,s,o,u;if(t.accept){i=[];for(s=0,o=t.accept.length;s<o;s++)u=t.accept[s].mimeTypes,u&&i.push(u);i.length&&(r=i.join(","),r=r.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=r=new RegExp(r,"i"),this.hander=e.bindFn(this._pasteHander,this),n.on("paste",this.hander)},_pasteHander:function(e){var t=[],r=this.getRuid(),i,s,o,u,a;e=e.originalEvent||e,i=e.clipboardData.items;for(u=0,a=i.length;u<a;u++){s=i[u];if(s.kind!=="file"||!(o=s.getAsFile()))continue;t.push(new n(r,o))}t.length&&(e.preventDefault(),e.stopPropagation(),this.trigger("paste",t))},destroy:function(){this.elem.off("paste",this.hander)}})}),t("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,t){var n=e.$;return t.register("FilePicker",{init:function(){var e=this.getRuntime().getContainer(),t=this,r=t.owner,i=t.options,s=this.label=n(document.createElement("label")),o=this.input=n(document.createElement("input")),u,a,f,l;o.attr("type","file"),o.attr("capture","camera"),o.attr("name",i.name),o.addClass("webuploader-element-invisible"),s.on("click",function(e){o.trigger("click"),e.stopPropagation(),r.trigger("dialogopen")}),s.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),i.multiple&&o.attr("multiple","multiple");if(i.accept&&i.accept.length>0){u=[];for(a=0,f=i.accept.length;a<f;a++)u.push(i.accept[a].mimeTypes);o.attr("accept",u.join(","))}e.append(o),e.append(s),l=function(e){r.trigger(e.type)},o.on("change",function(e){var i=arguments.callee,s;t.files=e.target.files,s=this.cloneNode(!0),s.value=null,this.parentNode.replaceChild(s,this),o.off(),o=n(s).on("change",i).on("mouseenter mouseleave",l),r.trigger("change")}),s.on("mouseenter mouseleave",l)},getFiles:function(){return this.files},destroy:function(){this.input.off(),this.label.off()}})}),t("runtime/html5/util",["base"],function(t){var n=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL,r=t.noop,i=r;return n&&(r=function(){return n.createObjectURL.apply(n,arguments)},i=function(){return n.revokeObjectURL.apply(n,arguments)}),{createObjectURL:r,revokeObjectURL:i,dataURL2Blob:function(e){var t,n,r,i,s,o;o=e.split(","),~o[0].indexOf("base64")?t=atob(o[1]):t=decodeURIComponent(o[1]),r=new ArrayBuffer(t.length),n=new Uint8Array(r);for(i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return s=o[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(r,s)},dataURL2ArrayBuffer:function(e){var t,n,r,i;i=e.split(","),~i[0].indexOf("base64")?t=atob(i[1]):t=decodeURIComponent(i[1]),n=new Uint8Array(t.length);for(r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n.buffer},arrayBufferToBlob:function(t,n){var r=e.BlobBuilder||e.WebKitBlobBuilder,i;return r?(i=new r,i.append(t),i.getBlob(n)):new Blob([t],n?{type:n}:{})},canvasToDataUrl:function(e,t,n){return e.toDataURL(t,n/100)},parseMeta:function(e,t){t(!1,{})},updateImageHead:function(e){return e}}}),t("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var t;return t={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(e,t){var n=this,r=new FileReader;r.onload=function(){t(!1,n._parse(this.result)),r=r.onload=r.onerror=null},r.onerror=function(e){t(e.message),r=r.onload=r.onerror=null},e=e.slice(0,n.maxMetaDataSize),r.readAsArrayBuffer(e.getSource())},_parse:function(e,n){if(e.byteLength<6)return;var r=new DataView(e),i=2,s=r.byteLength-4,o=i,u={},a,f,l,c;if(r.getUint16(0)===65496){while(i<s){a=r.getUint16(i);if(!(a>=65504&&a<=65519||a===65534))break;f=r.getUint16(i+2)+2;if(i+f>r.byteLength)break;l=t.parsers[a];if(!n&&l)for(c=0;c<l.length;c+=1)l[c].call(t,r,i,f,u);i+=f,o=i}o>6&&(e.slice?u.imageHead=e.slice(2,o):u.imageHead=(new Uint8Array(e)).subarray(2,o))}return u},updateImageHead:function(e,t){var n=this._parse(e,!0),r,i,s;return s=2,n.imageHead&&(s=2+n.imageHead.byteLength),e.slice?i=e.slice(s):i=(new Uint8Array(e)).subarray(s),r=new Uint8Array(t.byteLength+2+i.byteLength),r[0]=255,r[1]=216,r.set(new Uint8Array(t),2),r.set(new Uint8Array(i),t.byteLength+2),r.buffer}},e.parseMeta=function(){return t.parse.apply(t,arguments)},e.updateImageHead=function(){return t.updateImageHead.apply(t,arguments)},t}),t("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(e,t){var n={};return n.ExifMap=function(){return this},n.ExifMap.prototype.map={Orientation:274},n.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},n.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,n){return e.getUint16(t,n)},size:2},4:{getValue:function(e,t,n){return e.getUint32(t,n)},size:4},5:{getValue:function(e,t,n){return e.getUint32(t,n)/e.getUint32(t+4,n)},size:8},9:{getValue:function(e,t,n){return e.getInt32(t,n)},size:4},10:{getValue:function(e,t,n){return e.getInt32(t,n)/e.getInt32(t+4,n)},size:8}},n.exifTagTypes[7]=n.exifTagTypes[1],n.getExifValue=function(t,r,i,s,o,u){var a=n.exifTagTypes[s],f,l,c,h,p,d;if(!a){e.log("Invalid Exif data: Invalid tag type.");return}f=a.size*o,l=f>4?r+t.getUint32(i+8,u):i+8;if(l+f>t.byteLength){e.log("Invalid Exif data: Invalid data offset.");return}if(o===1)return a.getValue(t,l,u);c=[];for(h=0;h<o;h+=1)c[h]=a.getValue(t,l+h*a.size,u);if(a.ascii){p="";for(h=0;h<c.length;h+=1){d=c[h];if(d==="\0")break;p+=d}return p}return c},n.parseExifTag=function(e,t,r,i,s){var o=e.getUint16(r,i);s.exif[o]=n.getExifValue(e,t,r,e.getUint16(r+2,i),e.getUint32(r+4,i),i)},n.parseExifTags=function(t,n,r,i,s){var o,u,a;if(r+6>t.byteLength){e.log("Invalid Exif data: Invalid directory offset.");return}o=t.getUint16(r,i),u=r+2+12*o;if(u+4>t.byteLength){e.log("Invalid Exif data: Invalid directory size.");return}for(a=0;a<o;a+=1)this.parseExifTag(t,n,r+2+12*a,i,s);return t.getUint32(u,i)},n.parseExifData=function(t,r,i,s){var o=r+10,u,a;if(t.getUint32(r+4)!==1165519206)return;if(o+8>t.byteLength){e.log("Invalid Exif data: Invalid segment size.");return}if(t.getUint16(r+8)!==0){e.log("Invalid Exif data: Missing byte alignment offset.");return}switch(t.getUint16(o)){case 18761:u=!0;break;case 19789:u=!1;break;default:e.log("Invalid Exif data: Invalid byte alignment marker.");return}if(t.getUint16(o+2,u)!==42){e.log("Invalid Exif data: Missing TIFF marker.");return}a=t.getUint32(o+4,u),s.exif=new n.ExifMap,a=n.parseExifTags(t,o,o+a,u,s)},t.parsers[65505].push(n.parseExifData),n}),t("runtime/html5/jpegencoder",[],function(e,t,n){function r(e){function P(e){var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var n=0;n<64;n++){var a=r((t[n]*e+50)/100);a<1?a=1:a>255&&(a=255),i[N[n]]=a}var f=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var l=0;l<64;l++){var c=r((f[l]*e+50)/100);c<1?c=1:c>255&&(c=255),s[N[l]]=c}var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0;for(var d=0;d<8;d++)for(var v=0;v<8;v++)o[p]=1/(i[N[p]]*h[d]*h[v]*8),u[p]=1/(s[N[p]]*h[d]*h[v]*8),p++}function H(e,t){var n=0,r=0,i=new Array;for(var s=1;s<=16;s++){for(var o=1;o<=e[s];o++)i[t[r]]=[],i[t[r]][0]=n,i[t[r]][1]=s,r++,n++;n*=2}return i}function B(){a=H(C,k),f=H(O,M),l=H(L,A),c=H(_,D)}function j(){var e=1,t=2;for(var n=1;n<=15;n++){for(var r=e;r<t;r++)p[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=r;for(var i=-(t-1);i<=-e;i++)p[32767+i]=n,h[32767+i]=[],h[32767+i][1]=n,h[32767+i][0]=t-1+i;e<<=1,t<<=1}}function F(){for(var e=0;e<256;e++)x[e]=19595*e,x[e+256>>0]=38470*e,x[e+512>>0]=7471*e+32768,x[e+768>>0]=-11059*e,x[e+1024>>0]=-21709*e,x[e+1280>>0]=32768*e+8421375,x[e+1536>>0]=-27439*e,x[e+1792>>0]=-5329*e}function I(e){var t=e[0],n=e[1]-1;while(n>=0)t&1<<n&&(g|=1<<y),n--,y--,y<0&&(g==255?(q(255),q(0)):q(g),y=7,g=0)}function q(e){m.push(S[e])}function R(e){q(e>>8&255),q(e&255)}function U(e,t){var n,r,i,s,o,u,a,f,l=0,c,h=8,p=64;for(c=0;c<h;++c){n=e[l],r=e[l+1],i=e[l+2],s=e[l+3],o=e[l+4],u=e[l+5],a=e[l+6],f=e[l+7];var v=n+f,m=n-f,g=r+a,y=r-a,b=i+u,w=i-u,E=s+o,S=s-o,x=v+E,T=v-E,N=g+b,C=g-b;e[l]=x+N,e[l+4]=x-N;var k=(C+T)*.707106781;e[l+2]=T+k,e[l+6]=T-k,x=S+w,N=w+y,C=y+m;var L=(x-C)*.382683433,A=.5411961*x+L,O=1.306562965*C+L,M=N*.707106781,_=m+M,D=m-M;e[l+5]=D+A,e[l+3]=D-A,e[l+1]=_+O,e[l+7]=_-O,l+=8}l=0;for(c=0;c<h;++c){n=e[l],r=e[l+8],i=e[l+16],s=e[l+24],o=e[l+32],u=e[l+40],a=e[l+48],f=e[l+56];var P=n+f,H=n-f,B=r+a,j=r-a,F=i+u,I=i-u,q=s+o,R=s-o,U=P+q,z=P-q,W=B+F,X=B-F;e[l]=U+W,e[l+32]=U-W;var V=(X+z)*.707106781;e[l+16]=z+V,e[l+48]=z-V,U=R+I,W=I+j,X=j+H;var $=(U-X)*.382683433,J=.5411961*U+$,K=1.306562965*X+$,Q=W*.707106781,G=H+Q,Y=H-Q;e[l+40]=Y+J,e[l+24]=Y-J,e[l+8]=G+K,e[l+56]=G-K,l++}var Z;for(c=0;c<p;++c)Z=e[c]*t[c],d[c]=Z>0?Z+.5|0:Z-.5|0;return d}function z(){R(65504),R(16),q(74),q(70),q(73),q(70),q(0),q(1),q(1),q(0),R(1),R(1),q(0),q(0)}function W(e,t){R(65472),R(17),q(8),R(t),R(e),q(3),q(1),q(17),q(0),q(2),q(17),q(1),q(3),q(17),q(1)}function X(){R(65499),R(132),q(0);for(var e=0;e<64;e++)q(i[e]);q(1);for(var t=0;t<64;t++)q(s[t])}function V(){R(65476),R(418),q(0);for(var e=0;e<16;e++)q(C[e+1]);for(var t=0;t<=11;t++)q(k[t]);q(16);for(var n=0;n<16;n++)q(L[n+1]);for(var r=0;r<=161;r++)q(A[r]);q(1);for(var i=0;i<16;i++)q(O[i+1]);for(var s=0;s<=11;s++)q(M[s]);q(17);for(var o=0;o<16;o++)q(_[o+1]);for(var u=0;u<=161;u++)q(D[u])}function $(){R(65498),R(12),q(3),q(1),q(0),q(2),q(17),q(3),q(17),q(0),q(63),q(0)}function J(e,t,n,r,i){var s=i[0],o=i[240],u,a=16,f=63,l=64,c=U(e,t);for(var d=0;d<l;++d)v[N[d]]=c[d];var m=v[0]-n;n=v[0],m==0?I(r[0]):(u=32767+m,I(r[p[u]]),I(h[u]));var g=63;for(;g>0&&v[g]==0;g--);if(g==0)return I(s),n;var y=1,b;while(y<=g){var w=y;for(;v[y]==0&&y<=g;++y);var E=y-w;if(E>=a){b=E>>4;for(var S=1;S<=b;++S)I(o);E&=15}u=32767+v[y],I(i[(E<<4)+p[u]]),I(h[u]),y++}return g!=f&&I(s),n}function K(){var e=String.fromCharCode;for(var t=0;t<256;t++)S[t]=e(t)}function Q(e){e<=0&&(e=1),e>100&&(e=100);if(T==e)return;var t=0;e<50?t=Math.floor(5e3/e):t=Math.floor(200-e*2),P(t),T=e}function G(){e||(e=50),K(),B(),j(),F(),Q(e)}var t=this,n=Math.round,r=Math.floor,i=new Array(64),s=new Array(64),o=new Array(64),u=new Array(64),a,f,l,c,h=new Array(65535),p=new Array(65535),d=new Array(64),v=new Array(64),m=[],g=0,y=7,b=new Array(64),w=new Array(64),E=new Array(64),S=new Array(256),x=new Array(2048),T,N=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],L=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],O=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],_=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],D=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,t){t&&Q(t),m=new Array,g=0,y=7,R(65496),z(),X(),W(e.width,e.height),V(),$();var n=0,r=0,i=0;g=0,y=7,this.encode.displayName="_encode_";var s=e.data,h=e.width,p=e.height,d=h*4,v=h*3,S,T=0,N,C,k,L,A,O,M,_;while(T<p){S=0;while(S<d){L=d*T+S,A=L,O=-1,M=0;for(_=0;_<64;_++)M=_>>3,O=(_&7)*4,A=L+M*d+O,T+M>=p&&(A-=d*(T+1+M-p)),S+O>=d&&(A-=S+O-d+4),N=s[A++],C=s[A++],k=s[A++],b[_]=(x[N]+x[C+256>>0]+x[k+512>>0]>>16)-128,w[_]=(x[N+768>>0]+x[C+1024>>0]+x[k+1280>>0]>>16)-128,E[_]=(x[N+1280>>0]+x[C+1536>>0]+x[k+1792>>0]>>16)-128;n=J(b,o,n,a,l),r=J(w,u,r,f,c),i=J(E,u,i,f,c),S+=32}T+=8}if(y>=0){var D=[];D[1]=y+1,D[0]=(1<<y+1)-1,I(D)}R(65497);var P="data:image/jpeg;base64,"+btoa(m.join(""));return m=[],P},G()}return r.encode=function(e,t){var n=new r(t);return n.encode(e)},r}),t("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(e,t,n){var r=e.canvasToDataUrl,i;e.canvasToDataUrl=function(e,s,o){var u,a,f,l,c;return n.os.android?(s==="image/jpeg"&&typeof i=="undefined"&&(l=r.apply(null,arguments),c=l.split(","),~c[0].indexOf("base64")?l=atob(c[1]):l=decodeURIComponent(c[1]),l=l.substring(0,2),i=l.charCodeAt(0)===255&&l.charCodeAt(1)===216),s==="image/jpeg"&&!i?(a=e.width,f=e.height,u=e.getContext("2d"),t.encode(u.getImageData(0,0,a,f),o)):r.apply(null,arguments)):r.apply(null,arguments)}}),t("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(e,t,n){var r="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return t.register("Image",{modified:!1,init:function(){var e=this,t=new Image;t.onload=function(){e._info={type:e.type,width:this.width,height:this.height},!e._metas&&"image/jpeg"===e.type?n.parseMeta(e._blob,function(t,n){e._metas=n,e.owner.trigger("load")}):e.owner.trigger("load")},t.onerror=function(){e.owner.trigger("error")},e._img=t},loadFromBlob:function(e){var t=this,r=t._img;t._blob=e,t.type=e.type,r.src=n.createObjectURL(e.getSource()),t.owner.once("load",function(){n.revokeObjectURL(r.src)})},resize:function(e,t){var n=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,n,e,t),this._blob=null,this.modified=!0,this.owner.trigger("complete","resize")},crop:function(e,t,n,r,i){var s=this._canvas||(this._canvas=document.createElement("canvas")),o=this.options,u=this._img,a=u.naturalWidth,f=u.naturalHeight,l=this.getOrientation();i=i||1,s.width=n,s.height=r,o.preserveHeaders||this._rotate2Orientaion(s,l),this._renderImageToCanvas(s,u,-e,-t,a*i,f*i),this._blob=null,this.modified=!0,this.owner.trigger("complete","crop")},getAsBlob:function(e){var t=this._blob,r=this.options,i;e=e||this.type;if(this.modified||this.type!==e){i=this._canvas;if(e==="image/jpeg"){t=n.canvasToDataUrl(i,e,r.quality);if(r.preserveHeaders&&this._metas&&this._metas.imageHead)return t=n.dataURL2ArrayBuffer(t),t=n.updateImageHead(t,this._metas.imageHead),t=n.arrayBufferToBlob(t,e),t}else t=n.canvasToDataUrl(i,e);t=n.dataURL2Blob(t)}return t},getAsDataUrl:function(e){var t=this.options;return e=e||this.type,e==="image/jpeg"?n.canvasToDataUrl(this._canvas,e,t.quality):this._canvas.toDataURL(e)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(e){return e?(this._info=e,this):this._info},meta:function(e){return e?(this._metas=e,this):this._metas},destroy:function(){var e=this._canvas;this._img.onload=null,e&&(e.getContext("2d").clearRect(0,0,e.width,e.height),e.width=e.height=0,this._canvas=null),this._img.src=r,this._img=this._blob=null},_resize:function(e,t,n,r){var i=this.options,s=e.width,o=e.height,u=this.getOrientation(),a,f,l,c,h;~[5,6,7,8].indexOf(u)&&(n^=r,r^=n,n^=r),a=Math[i.crop?"max":"min"](n/s,r/o),i.allowMagnify||(a=Math.min(1,a)),f=s*a,l=o*a,i.crop?(t.width=n,t.height=r):(t.width=f,t.height=l),c=(t.width-f)/2,h=(t.height-l)/2,i.preserveHeaders||this._rotate2Orientaion(t,u),this._renderImageToCanvas(t,e,c,h,f,l)},_rotate2Orientaion:function(e,t){var n=e.width,r=e.height,i=e.getContext("2d");switch(t){case 5:case 6:case 7:case 8:e.width=r,e.height=n}switch(t){case 2:i.translate(n,0),i.scale(-1,1);break;case 3:i.translate(n,r),i.rotate(Math.PI);break;case 4:i.translate(0,r),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-r);break;case 7:i.rotate(.5*Math.PI),i.translate(n,-r),i.scale(-1,1);break;case 8:i.rotate(-0.5*Math.PI),i.translate(-n,0)}},_renderImageToCanvas:function(){function t(e,t,n){var r=document.createElement("canvas"),i=r.getContext("2d"),s=0,o=n,u=n,a,f,l;r.width=1,r.height=n,i.drawImage(e,0,0),a=i.getImageData(0,0,1,n).data;while(u>s)f=a[(u-1)*4+3],f===0?o=u:s=u,u=o+s>>1;return l=u/n,l===0?1:l}function n(e){var t=e.naturalWidth,n=e.naturalHeight,r,i;return t*n>1048576?(r=document.createElement("canvas"),r.width=r.height=1,i=r.getContext("2d"),i.drawImage(e,-t+1,0),i.getImageData(0,0,1,1).data[3]===0):!1}return e.os.ios?e.os.ios>=7?function(e,n,r,i,s,o){var u=n.naturalWidth,a=n.naturalHeight,f=t(n,u,a);return e.getContext("2d").drawImage(n,0,0,u*f,a*f,r,i,s,o)}:function(e,r,i,s,o,u){var a=r.naturalWidth,f=r.naturalHeight,l=e.getContext("2d"),c=n(r),h=this.type==="image/jpeg",p=1024,d=0,v=0,m,g,y,b,w,E,S;c&&(a/=2,f/=2),l.save(),m=document.createElement("canvas"),m.width=m.height=p,g=m.getContext("2d"),y=h?t(r,a,f):1,b=Math.ceil(p*o/a),w=Math.ceil(p*u/f/y);while(d<f){E=0,S=0;while(E<a)g.clearRect(0,0,p,p),g.drawImage(r,-E,-d),l.drawImage(m,0,0,p,p,i+S,s+v,b,w),E+=p,S+=b;d+=p,v+=w}l.restore(),m=g=null}:function(t){var n=e.slice(arguments,1),r=t.getContext("2d");r.drawImage.apply(r,n)}}()})}),t("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,t){var n=e.noop,r=e.$;return t.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var t=this.owner,n=this.options,i=this._initAjax(),s=t._blob,o=n.server,u,a,f;n.sendAsBinary?(o+=(/\?/.test(o)?"&":"?")+r.param(t._formData),a=s.getSource()):(u=new FormData,r.each(t._formData,function(e,t){u.append(e,t)}),u.append(n.fileVal,s.getSource(),n.filename||t._formData.name||"")),n.withCredentials&&"withCredentials"in i?(i.open(n.method,o,!0),i.withCredentials=!0):i.open(n.method,o),this._setRequestHeader(i,n.headers),a?(i.overrideMimeType&&i.overrideMimeType("application/octet-stream"),e.os.android?(f=new FileReader,f.onload=function(){i.send(this.result),f=f.onload=null},f.readAsArrayBuffer(a)):i.send(a)):i.send(u)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var e=this._xhr;e&&(e.upload.onprogress=n,e.onreadystatechange=n,e.abort(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var e=this,t=new XMLHttpRequest,r=this.options;return r.withCredentials&&!("withCredentials"in t)&&typeof XDomainRequest!="undefined"&&(t=new XDomainRequest),t.upload.onprogress=function(t){var n=0;return t.lengthComputable&&(n=t.loaded/t.total),e.trigger("progress",n)},t.onreadystatechange=function(){if(t.readyState!==4)return;return t.upload.onprogress=n,t.onreadystatechange=n,e._xhr=null,e._status=t.status,t.status>=200&&t.status<300?(e._response=t.responseText,e.trigger("load")):t.status>=500&&t.status<600?(e._response=t.responseText,e.trigger("error","server")):e.trigger("error",e._status?"http":"abort")},e._xhr=t,t},_setRequestHeader:function(e,t){r.each(t,function(t,n){e.setRequestHeader(t,n)})},_parseJson:function(e){var t;try{t=JSON.parse(e)}catch(n){t={}}return t}})}),t("runtime/html5/md5",["runtime/html5/runtime"],function(e){var t=function(e,t){return e+t&4294967295},n=function(e,n,r,i,s,o){return n=t(t(n,e),t(i,o)),t(n<<s|n>>>32-s,r)},r=function(e,t,r,i,s,o,u){return n(t&r|~t&i,e,t,s,o,u)},i=function(e,t,r,i,s,o,u){return n(t&i|r&~i,e,t,s,o,u)},s=function(e,t,r,i,s,o,u){return n(t^r^i,e,t,s,o,u)},o=function(e,t,r,i,s,o,u){return n(r^(t|~i),e,t,s,o,u)},u=function(e,n){var u=e[0],a=e[1],f=e[2],l=e[3];u=r(u,a,f,l,n[0],7,-680876936),l=r(l,u,a,f,n[1],12,-389564586),f=r(f,l,u,a,n[2],17,606105819),a=r(a,f,l,u,n[3],22,-1044525330),u=r(u,a,f,l,n[4],7,-176418897),l=r(l,u,a,f,n[5],12,1200080426),f=r(f,l,u,a,n[6],17,-1473231341),a=r(a,f,l,u,n[7],22,-45705983),u=r(u,a,f,l,n[8],7,1770035416),l=r(l,u,a,f,n[9],12,-1958414417),f=r(f,l,u,a,n[10],17,-42063),a=r(a,f,l,u,n[11],22,-1990404162),u=r(u,a,f,l,n[12],7,1804603682),l=r(l,u,a,f,n[13],12,-40341101),f=r(f,l,u,a,n[14],17,-1502002290),a=r(a,f,l,u,n[15],22,1236535329),u=i(u,a,f,l,n[1],5,-165796510),l=i(l,u,a,f,n[6],9,-1069501632),f=i(f,l,u,a,n[11],14,643717713),a=i(a,f,l,u,n[0],20,-373897302),u=i(u,a,f,l,n[5],5,-701558691),l=i(l,u,a,f,n[10],9,38016083),f=i(f,l,u,a,n[15],14,-660478335),a=i(a,f,l,u,n[4],20,-405537848),u=i(u,a,f,l,n[9],5,568446438),l=i(l,u,a,f,n[14],9,-1019803690),f=i(f,l,u,a,n[3],14,-187363961),a=i(a,f,l,u,n[8],20,1163531501),u=i(u,a,f,l,n[13],5,-1444681467),l=i(l,u,a,f,n[2],9,-51403784),f=i(f,l,u,a,n[7],14,1735328473),a=i(a,f,l,u,n[12],20,-1926607734),u=s(u,a,f,l,n[5],4,-378558),l=s(l,u,a,f,n[8],11,-2022574463),f=s(f,l,u,a,n[11],16,1839030562),a=s(a,f,l,u,n[14],23,-35309556),u=s(u,a,f,l,n[1],4,-1530992060),l=s(l,u,a,f,n[4],11,1272893353),f=s(f,l,u,a,n[7],16,-155497632),a=s(a,f,l,u,n[10],23,-1094730640),u=s(u,a,f,l,n[13],4,681279174),l=s(l,u,a,f,n[0],11,-358537222),f=s(f,l,u,a,n[3],16,-722521979),a=s(a,f,l,u,n[6],23,76029189),u=s(u,a,f,l,n[9],4,-640364487),l=s(l,u,a,f,n[12],11,-421815835),f=s(f,l,u,a,n[15],16,530742520),a=s(a,f,l,u,n[2],23,-995338651),u=o(u,a,f,l,n[0],6,-198630844),l=o(l,u,a,f,n[7],10,1126891415),f=o(f,l,u,a,n[14],15,-1416354905),a=o(a,f,l,u,n[5],21,-57434055),u=o(u,a,f,l,n[12],6,1700485571),l=o(l,u,a,f,n[3],10,-1894986606),f=o(f,l,u,a,n[10],15,-1051523),a=o(a,f,l,u,n[1],21,-2054922799),u=o(u,a,f,l,n[8],6,1873313359),l=o(l,u,a,f,n[15],10,-30611744),f=o(f,l,u,a,n[6],15,-1560198380),a=o(a,f,l,u,n[13],21,1309151649),u=o(u,a,f,l,n[4],6,-145523070),l=o(l,u,a,f,n[11],10,-1120210379),f=o(f,l,u,a,n[2],15,718787259),a=o(a,f,l,u,n[9],21,-343485551),e[0]=t(u,e[0]),e[1]=t(a,e[1]),e[2]=t(f,e[2]),e[3]=t(l,e[3])},a=function(e){var t=[],n;for(n=0;n<64;n+=4)t[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return t},f=function(e){var t=[],n;for(n=0;n<64;n+=4)t[n>>2]=e[n]+(e[n+1]<<8)+(e[n+2]<<16)+(e[n+3]<<24);return t},l=function(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],r,i,s,o,f,l;for(r=64;r<=t;r+=64)u(n,a(e.substring(r-64,r)));e=e.substring(r-64),i=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<i;r+=1)s[r>>2]|=e.charCodeAt(r)<<(r%4<<3);s[r>>2]|=128<<(r%4<<3);if(r>55){u(n,s);for(r=0;r<16;r+=1)s[r]=0}return o=t*8,o=o.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=f,s[15]=l,u(n,s),n},c=function(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],r,i,s,o,a,l;for(r=64;r<=t;r+=64)u(n,f(e.subarray(r-64,r)));e=r-64<t?e.subarray(r-64):new Uint8Array(0),i=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<i;r+=1)s[r>>2]|=e[r]<<(r%4<<3);s[r>>2]|=128<<(r%4<<3);if(r>55){u(n,s);for(r=0;r<16;r+=1)s[r]=0}return o=t*8,o=o.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,u(n,s),n},h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],p=function(e){var t="",n;for(n=0;n<4;n+=1)t+=h[e>>n*8+4&15]+h[e>>n*8&15];return t},d=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")},v=function(e){return d(l(e))},m=function(){this.reset()};return v("hello")!=="5d41402abc4b2a76b9719d911017c592"&&(t=function(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}),m.prototype.append=function(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},m.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t=this._buff.length,n;for(n=64;n<=t;n+=64)u(this._state,a(this._buff.substring(n-64,n)));return this._buff=this._buff.substr(n-64),this},m.prototype.end=function(e){var t=this._buff,n=t.length,r,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s;for(r=0;r<n;r+=1)i[r>>2]|=t.charCodeAt(r)<<(r%4<<3);return this._finish(i,n),s=e?this._state:d(this._state),this.reset(),s},m.prototype._finish=function(e,t){var n=t,r,i,s;e[n>>2]|=128<<(n%4<<3);if(n>55){u(this._state,e);for(n=0;n<16;n+=1)e[n]=0}r=this._length*8,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),s=parseInt(r[1],16)||0,e[14]=i,e[15]=s,u(this._state,e)},m.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},m.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=l(e);return t?n:d(n)},m.hashBinary=function(e,t){var n=l(e);return t?n:d(n)},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(e){var t=this._concatArrayBuffer(this._buff,e),n=t.length,r;this._length+=e.byteLength;for(r=64;r<=n;r+=64)u(this._state,f(t.subarray(r-64,r)));return this._buff=r-64<n?t.subarray(r-64):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(e){var t=this._buff,n=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,s;for(i=0;i<n;i+=1)r[i>>2]|=t[i]<<(i%4<<3);return this._finish(r,n),s=e?this._state:d(this._state),this.reset(),s},m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var n=e.length,r=new Uint8Array(n+t.byteLength);return r.set(e),r.set(new Uint8Array(t),n),r},m.ArrayBuffer.hash=function(e,t){var n=c(new Uint8Array(e));return t?n:d(n)},e.register("Md5",{init:function(){},loadFromBlob:function(e){var t=e.getSource(),n=2097152,r=Math.ceil(t.size/n),i=0,s=this.owner,o=new m.ArrayBuffer,u=this,a=t.mozSlice||t.webkitSlice||t.slice,f,l;l=new FileReader,f=function(){var c,h;c=i*n,h=Math.min(c+n,t.size),l.onload=function(t){o.append(t.target.result),s.trigger("progress",{total:e.size,loaded:h})},l.onloadend=function(){l.onloadend=l.onload=null,++i<r?setTimeout(f,1):setTimeout(function(){s.trigger("load"),u.result=o.end(),f=e=t=o=null,s.trigger("complete")},50)},l.readAsArrayBuffer(a.call(t,c,h))},f()},getResult:function(){return this.result}})}),t("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(t,n,r){function u(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}function a(){function l(e,t){var n=e.type||e,r,s;r=n.split("::"),s=r[0],n=r[1],n==="Ready"&&s===a.uid?a.trigger("ready"):i[s]&&i[s].trigger(n.toLowerCase(),e,t)}var r={},i={},u=this.destroy,a=this,f=t.guid("webuploader_");n.apply(a,arguments),a.type=s,a.exec=function(e,n){var s=this,u=s.uid,f=t.slice(arguments,2),l;i[u]=s;if(o[e]){r[u]||(r[u]=new o[e](s,a)),l=r[u];if(l[n])return l[n].apply(l,f)}return a.flashExec.apply(s,arguments)},e[f]=function(){var e=arguments;setTimeout(function(){l.apply(null,e)},1)},this.jsreciver=f,this.destroy=function(){return u&&u.apply(this,arguments)},this.flashExec=function(e,n){var r=a.getFlash(),i=t.slice(arguments,2);return r.exec(this.uid,e,n,i)}}var i=t.$,s="flash",o={};return t.inherits(n,{constructor:a,init:function(){var e=this.getContainer(),n=this.options,r;e.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),r='<object id="'+this.uid+'" type="application/'+'x-shockwave-flash" data="'+n.swf+'" ',t.browser.ie&&(r+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),r+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+n.swf+'" />'+'<param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>",e.html(r)},getFlash:function(){return this._flash?this._flash:(this._flash=i("#"+this.uid).get(0),this._flash)}}),a.register=function(e,n){return n=o[e]=t.inherits(r,i.extend({flashExec:function(){var e=this.owner,t=this.getRuntime();return t.flashExec.apply(e,arguments)}},n)),n},u()>=11.4&&n.addRuntime(s,a),a}),t("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,t){var n=e.$;return t.register("FilePicker",{init:function(e){var t=n.extend({},e),r,i;r=t.accept&&t.accept.length;for(i=0;i<r;i++)t.accept[i].title||(t.accept[i].title="Files");delete t.button,delete t.id,delete t.container,this.flashExec("FilePicker","init",t)},destroy:function(){this.flashExec("FilePicker","destroy")}})}),t("runtime/flash/image",["runtime/flash/runtime"],function(e){return e.register("Image",{loadFromBlob:function(e){var t=this.owner;t.info()&&this.flashExec("Image","info",t.info()),t.meta()&&this.flashExec("Image","meta",t.meta()),this.flashExec("Image","loadFromBlob",e.uid)}})}),t("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(t,n,r){var i=t.$;return n.register("Transport",{init:function(){this._status=0,this._response=null,this._responseJson=null},send:function(){var e=this.owner,t=this.options,n=this._initAjax(),r=e._blob,s=t.server,o;n.connectRuntime(r.ruid),t.sendAsBinary?(s+=(/\?/.test(s)?"&":"?")+i.param(e._formData),o=r.uid):(i.each(e._formData,function(e,t){n.exec("append",e,t)}),n.exec("appendBlob",t.fileVal,r.uid,t.filename||e._formData.name||"")),this._setRequestHeader(n,t.headers),n.exec("send",{method:t.method,url:s,forceURLStream:t.forceURLStream,mimeType:"application/octet-stream"},o)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var e=this._xhr;e&&(e.exec("abort"),e.destroy(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,n=new r("XMLHttpRequest");return n.on("uploadprogress progress",function(e){var n=e.loaded/e.total;return n=Math.min(1,Math.max(0,n)),t.trigger("progress",n)}),n.on("load",function(){var r=n.exec("getStatus"),i=!1,s="",o;return n.off(),t._xhr=null,r>=200&&r<300?i=!0:r>=500&&r<600?(i=!0,s="server"):s="http",i&&(t._response=n.exec("getResponse"),t._response=decodeURIComponent(t._response),o=function(t){try{return e.JSON&&e.JSON.parse?JSON.parse(t):(new Function("return "+t)).call()}catch(n){return{}}},t._responseJson=t._response?o(t._response):{}),n.destroy(),n=null,s?t.trigger("error",s):t.trigger("load")}),n.on("error",function(){n.off(),t._xhr=null,t.trigger("error","http")}),t._xhr=n,n},_setRequestHeader:function(e,t){i.each(t,function(t,n){e.exec("setRequestHeader",t,n)})}})}),t("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,n){var r=this.flashExec("Blob","slice",e,n);return new t(this.getRuid(),r)}})}),t("runtime/flash/md5",["runtime/flash/runtime"],function(e){return e.register("Md5",{init:function(){},loadFromBlob:function(e){return this.flashExec("Md5","loadFromBlob",e.uid)}})}),t("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(e){return e}),t("widgets/log",["base","uploader","widgets/widget"],function(e,t){function u(e){var t=n.extend({},o,e),i=r.replace(/^(.*)\?/,"$1"+n.param(t)),s=new Image;s.src=i}var n=e.$,r=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",i=(location.hostname||location.host||"protected").toLowerCase(),s=i&&/baidu/i.exec(i),o;if(!s)return;return o={dv:3,master:"webuploader",online:/test/.exec(i)?0:1,module:"",product:i,type:0},t.register({name:"log",init:function(){var e=this.owner,t=0,n=0;e.on("error",function(e){u({type:2,c_error_code:e})}).on("uploadError",function(e,t){u({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+t})}).on("uploadComplete",function(e){t++,n+=e.size}).on("uploadFinished",function(){u({c_count:t,c_size:n}),t=n=0}),u({c_usage:1})}})}),t("xmuploader/widgets/xmloger",["base"],function(e){Date.prototype.uploadFormat=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)(new RegExp("("+n+")")).test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};var t=e.$;return function(e,n){var r="",i,s,o;typeof n.reason=="string"?(r=n.reason,s=r,i=n.status):typeof n.reason=="object"?(o=n.reason,i=n.status||o.status||"",s=n.msg||o.msg||""):(i=n.status,s=n.reason);var u={offset:"",uploaded:e.uploaded,fileSize:e.size,uploadAt:(new Date(e.starttime)).uploadFormat("yyyy-MM-dd HH:mm:ss"),uploadCost:(new Date).getTime()-e.starttime,retryCount:e.retryRecord&&e.retryRecord.count||-1,fileName:e.name,fileExt:e.ext,concurrent:"1",strategyId:"1",net:"wifi",location:"-",responseRet:n.ret||"",responseHttpStatus:i,responseMsg:s,sdk:"js",uid:n.uid||"未登录",reason:r};t.ajax({url:this.options.uploadPath+"/clamper-token/stat/file",type:"POST",headers:{Authorization:e.token},data:u})}}),t("xmuploader/widgets/md5Storage",["base"],function(t){var n=2592e5,r={getStorage:function(t){if("localStorage"in e){var r=localStorage.getItem("xmuploader");if(!r)return null;var i=JSON.parse(r);if(!t)return i;var s=(new Date).getTime();for(var o in i){var u=s-i[o].createTime;u>n&&delete i[o]}return i&&i[t]||{}}return null},setStorage:function(t,n,r){if(!("localStorage"in e))return null;var i=this.getStorage();i=i||{},i[t]={createTime:(new Date).getTime(),val:n,ip:r},i=JSON.stringify(i),localStorage.setItem("xmuploader",i)},clearByMd5:function(t){if(!("localStorage"in e))return null;var n=r.getStorage();localStorage.removeItem("xmuploader"),delete n[t];try{localStorage.setItem("xmuploader",JSON.stringify(n))}catch(i){return null}},clearByTime:function(e){var t=r.getStorage();for(var n in t)t[n].createTime<e&&delete t[n];t=JSON.stringify(t),localStorage.setItem("xmuploader",t)}};return r.clearByTime(1528182775084),r}),t("xmuploader/widgets/xmInit",["base","uploader","xmuploader/widgets/xmloger","xmuploader/widgets/md5Storage","widgets/widget"],function(t,n,r,i){var s=t.$;n.register({name:"xmInit",init:function(t){t.uploadPath=t.uploadPath||(/test\.ximalaya/.test(e.location.href)?"//upload.test.ximalaya.com":"//upload.ximalaya.com"),t.server=t.uploadPath+"/clamper-server/mkblk",t.timeout=12e4,t.sendAsBinary=!0,t.retryLimit=t.retryLimit===void 0?3:t.retryLimit;var n=this.owner;n.on("uploadBeforeSend",function(e,t,n){var r=e.file;if(r.retryRecord&&r.retryRecord.count!==void 0){var i=this.options.backUploadPath===void 0?this.options.uploadPath:this.options.backUploadPath;this.options.uploadPath=i,this.options.server=i+"/clamper-server/mkblk"}var s=e.file.serverIp;n.Authorization=e.file.token,n["x-clamper-server-ip"]=s||"",n["Content-Type"]="application/octet-stream",t.uid=this.options.uid||0}),n.on("uploadError",function(e,t,i){t==="请检查音频是否完整，且不可含有大段空白"&&(i=-6);if(t.status!==598&&t.stauts!==599&&i!==-5){var s=function(t){var r=10,i=setInterval(function(){r--,n.trigger("retryWaitCount",e,r),r<=0&&(clearInterval(i),t())},1e3)};e.retryRecord?e.retryRecord.count++:e.retryRecord={count:0},e.retryRecord&&e.retryRecord.count<this.options.retryLimit&&s(function(){n.retry(e)})}r.call(this,e,{status:i,reason:t,uid:this.options.uid})}),n.on("uploadAccept",function(e,t,n){if(e.md5!==t.md5||t.ret!==0||!t.ctx)return n("response md5 不一致"),!1;var r=e.file;r[r.md5][e.md5]=e.chunk+"__"+t.ctx,i.setStorage(r.md5,r[r.md5],t.serverIp||""),e.file.serverIp=t.serverIp}),n.on("uploadStart",function(e){e.starttime=(new Date).getTime()}),n.on("uploadSuccess",function(e,t){t.ret!==-1&&r.call(this,e,{status:200,uid:this.options.uid,ret:t.ret})}),n.on("chunkLogger",function(e,t,n,r){var i=t.file;s.ajax({url:this.options.uploadPath+"/clamper-token/stat/block",type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{retryCount:t.retried,uploaded:i.uploaded,fileSize:i.size,uploadAt:t.startTime,uploadCost:t.startTime&&Date.now()-t.startTime.getTime()||0,net:"wifi",location:"",responseRet:r&&r.ret||"",responseHttpStatus:n===void 0?200:n,responseMsg:r&&r.msg||"",sdk:"js",uid:this.options.uid||"未登录",reason:""}})})}})}),t("xmuploader/widgets/getToken",["base","uploader","xmuploader/widgets/md5Storage","widgets/widget"],function(e,t,n){var r=e.$;t.register({name:"getToken",beforeSendFile:function(t){var i=this,s=this.owner,o=e.Deferred(),u=this.options.uploadType,a=this.options.uploadPath,f=this.request("md5-file",t,function(e){var r=n.getStorage(e);t.md5=e,t[e]={};if(!r||r&&!r.ip)return;var i=r.ip,s=r.val||{};i&&(t.serverIp=i),t[e]=s});if(u!==void 0)var l=r.ajax({url:a+"/clamper-token/token",type:"post",xhrFields:{withCredentials:!0},data:{fileName:t.name,fileSize:t.size,uploadType:u,callerType:"ting"},success:function(e){e.ret===0?(t.token=e.token,t.strategy=e.strategy,f.then(function(){o.resolve(e)})):o.reject({msg:"get token error",status:l.status})},error:function(e,t){var n="get token error";if(e.status===400||e.status===598||e.status===599)n=JSON.parse(e.responseText).msg;o.reject({msg:n,status:l.status})}});else o.resolve();return o.promise()}})}),t("xmuploader/widgets/chunkMd5",["base","uploader","widgets/widget"],function(e,t){var n=e.$;t.register({name:"beforeSend","before-send":"beforeSend"},{beforeSend:function(t){var n=t.file,r=e.Deferred();return this.request("md5-file",t.blob,function(e){var i=n[n.md5][e];i&&typeof i=="string"?r.reject():(n[n.md5][e]=!0,t.md5=e,r.resolve())}),r.promise()}})}),t("xmuploader/widgets/createFile",["base","uploader","widgets/widget","xmuploader/widgets/md5Storage"],function(e,t,n,r){var i=e.$;t.register({name:"serverCreateFile","after-send-file":"afterSendFile"},{afterSendFile:function(t,n,s){var o=this.owner,u=t.serverIp,a=e.Deferred(),f=this.options.uploadType,l=!0,c=this.options.uploadType==="video"?"video/":"",h=this.options.uploadPath;if(f!==void 0){var p=[],d=t[t.md5];for(var v in d)p.push(d[v]);p.sort(function(e,t){var n=parseInt(e.split("__")[0]),r=parseInt(t.split("__")[0]);return n-r});for(var m=0;m<p.length;m++)p[m].split("__")[0]!=m&&(l=!1);if(!l)return a.reject("请检查音频是否完整，且不可含有大段空白");var g=i.ajax({url:h+"/clamper-server/mkfile/"+c+t.size+"/ext/"+t.ext,type:"post",xhrFields:{withCredentials:!0},headers:{Authorization:t.token,"Content-Type":"text/plain","x-clamper-server-ip":u||""},data:"ctxList="+p.join(",").replace(/\d*__/g,""),dataType:"json",success:function(e){r.clearByMd5(t.md5),a.resolve(e)},error:function(e,t,n){a.reject({msg:"crate file error",status:g.status||-5})}})}else a.resolve();return a.promise()}})}),t("xmuploader/index",["preset/all","widgets/log","xmuploader/widgets/xmInit","xmuploader/widgets/getToken","xmuploader/widgets/chunkMd5","xmuploader/widgets/createFile"],function(e){return e.Uploader.xmCreate=function(t){return e.create(t)},e}),t("preset/xuploader",["base","xmuploader/index","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(e){return e}),t("webuploader",["preset/xuploader"],function(e){return e}),n("webuploader")}),function(e,t){if(e.require&&e.define)define("plugin/uploader/xmupload",["jquery","plugin/uploader/webuploader.xm"],t);else{e.xm&&e.xm.uploader||null||(e.xm={uploader:{}});var n=e.xm.WebUploader||e.WebUploader,r=config.STATIC_PATH+"/lib/xmuploader/0.1.0/uploader.swf";e.xm.uploader.base=t($,n)}}(window,function(e,t,n){window.WebUploader=t;var r=function(r){var i={swf:n||config.STATIC_PATH+"/cdnswf/uploader.swf",auto:!0,threads:1,disableGlobalDnd:!0,duplicate:!0,chunked:!1};r=e.extend(i,r);var s=r.handlers||null,o;o||(o=new t.Uploader(r));if(s)for(var u in s)o.on(u,s[u]);return o};return r}),define("module/uploadVCodeModal/uploadVCodeModal",["jquery","plugin/dialog"],function(e,t){function o(t,r,i){e.ajax({url:"/xmcaptcha-service/getCaptcha/ts-123",data:{captchaInfo:t,captchaId:r,version:i},success:function(t){window.vCodeToken=t.token,n=t.background,e("#img_vcode_image").attr("src","/xmcaptcha-service"+n)}})}function u(){e("#img_vcode_submit").text("确定"),e("#img_vcode_input").val(""),e("#img_vcode_new_image").text("换一张"),clearInterval(s),r=0,i=!0,e("#img_vcode").hide(),n=""}window.vCodeToken="";var n="",r=0,i=!0,s,a={callModal:function(n,r){var i=n.captchaInfo,s=n.captchaId,a=n.version,f=r||1500;o(i,s,a);if(e("#img_vcode").length===0){var l='<style>#img_vcode_input::-webkit-input-placeholder{font-size: 18px; text-align: center}#img_vcode_input:-moz-placeholder{font-size: 18px; text-align: center}#img_vcode_input::-moz-placeholder{font-size: 18px; text-align: center}#img_vcode_input:-ms-input-placeholder{font-size: 18px; text-align: center}</style><div id="img_vcode" style="position: fixed;z-index: '+f+';top: 0;left: 0;right: 0;bottom: 0;background: rgba(0,0,0,0.5);">'+'<div style="position: absolute;top: 0;bottom: 0;left: 0;right: 0;margin: auto;height: 257px;width: 330px;background: white;box-sizing: border-box;border-top: 5px solid #F86442;border-image: linear-gradient(90deg, #FC9D77 0%, #F86442 100%) 30 30;padding: 0 40px;"'+"> "+'<div style="font-family: PingFangSC-Medium;font-size: 18px;color: #333333;letter-spacing: 1.5px;padding: 15px 0 20px;text-align: center">验证码</div>'+'<div><input id="img_vcode_input" style="font-size: 18px;border: 1px solid #e1e1e1;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;width: 250px;line-height: 44px;text-align:center;padding: 0;" placeholder="请输入验证码" type="text"/></div>'+'<div style="padding-top: 20px;-webkit-touch-callout: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;">'+'<img id="img_vcode_image" src="" style="-webkit-touch-callout: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;height: 42px;width: 134px;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;border: 1px solid #e1e1e1;">'+'<span id="img_vcode_new_image" style="-webkit-touch-callout: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;display: inline-block;vertical-align: middle;text-align: center;margin-left: 18px;height: 42px;width:94px;line-height: 42px;font-size: 18px;color: #F86442;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;border: 1px solid #F86442;cursor: pointer">换一张</span></div>'+'<div style="padding-top: 20px;">'+'<button id="img_vcode_close" style="width: 110px;border: 1px solid #e1e1e1;line-height: 42px;padding: 0;margin-right: 30px;font-size: 18px;color: #666666;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;"'+">取消</button>"+'<button id="img_vcode_submit" style="width: 110px;line-height: 42px;padding: 0;font-size: 18px;color: white;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;background-image: linear-gradient(90deg, #FF9973 1%, #F86442 95%);"'+">确认</button>"+"</div></div>";e("#mainbox").append(l),e("#img_vcode").on("click",function(e){if(e.target.id!=="img_vcode")return;u(),t.alert("上传失败")}),e("#img_vcode_close").on("click",function(e){u(),t.alert("上传失败")}),e("#img_vcode_new_image").on("click",function(){o(i,s,a)}),e("#img_vcode_submit").on("click",function(){if(e("#img_vcode_submit").text()==="校验中..."||!e("#img_vcode_input").val())return;e("#img_vcode_submit").text("校验中..."),e.ajax({url:"/xmcaptcha-service/checkCaptcha/ts-123",data:{token:window.vCodeToken,checkCode:e("#img_vcode_input").val()},success:function(n){var r;try{r=JSON.parse(n)}catch(f){r=n}if(r.ret===0&&r.result)t.alert("校验通过，请重新上传"),u();else{o(i,s,a),e("#img_vcode_submit").text("确认");var l=r.error||r.msg;t.alert(l)}}})})}else e("#img_vcode").show()}};return a}),function(e,t){if(e.require&&e.define)define("plugin/uploader/xmupload-image",["jquery","plugin/dialog","plugin/uploader/xmupload","module/uploadVCodeModal/uploadVCodeModal"],t);else{var n=e.xm.uploader.base,r=config.STATIC_PATH+"/lib/xmuploader/0.1.0/uploader.swf",i=e.xm.dialog||i;e.xm&&e.xm.uploader||null||(e.xm.uploader={}),e.xm.uploader.image=t($,i,n,r)}}(window,function(e,t,n,r,i){function o(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}var s={btnEl:".xmupload-image",swf:typeof i=="string"&&i||config.STATIC_PATH+"/cdnswf/uploader.swf",type:"",fileLimit:1,singleSizeLimit:2097152,allSizeLimit:null,uploadUrl:"",duplicate:!1,accept:null},u={fileQueued:function(t){var n=e(this.options.pick.id+"-list");n.length>0&&n.find(".pic.rel").addClass("is-loading").end().removeClass("hidden"),t.$pre=n},uploadBeforeSend:function(e,t){var n=e.file.retryUrl||this.options.server;n.indexOf("?")!=-1?url=n.substr(0,n.indexOf("?"))+"?&fileSize="+t.size:url=n+"?fileSize="+t.size,this.options.server=url,this.options.server+="&token="+o(config.TOKEN_LABEL)+"&rememberMe="+o(config.REMEMBERME_LABEL)},uploadStart:function(e){},uploadError:function(n,i,s){if(i==="need vcode"){this.removeFile(n.id);var o=e(".imgItem");for(var u=0;u<o.length;u++){var a=e(o[u]);a.siblings().length>0&&a.siblings()[0].className==="del"&&a.children()[0].width==0&&a.children()[0].height==0&&a.siblings()[0].click()}return r.callModal(s),!1}if(!n.retryRecord){var f=/test\.ximalaya\.com/.test(window.location.href)?window.location.protocol+"//192.168.1.171":window.location.protocol+"://114.80.170.66";return n.retryUrl=this.options.server.replace(/.*\.ximalaya\.com/,f),n.retryRecord=!0,this.retry(n),!1}n.$pre.length>0&&n.$pre.find(".pic.rel ").removeClass("is-loading"),this.removeFile(n.id),t.alert("上传图片失败！")},uploadSuccess:function(e,t){if(t.ret==50001)return this.trigger("uploadError",e,"need vcode",t.data),!1;if(!("status"in t))return this.trigger("uploadError",e,"parse error",499),!1;e.$pre.length>0&&e.$pre.find(".pic.rel ").removeClass("is-loading")},uploadProgress:function(e,t){},error:function(e,n){var r="";switch(e){case"Q_EXCEED_NUM_LIMIT":var i=this.options.fileNumLimit,r="上传图片数超过最大限制 <br>";break;case"Q_TYPE_DENIED":r="未定义的文件类型.";break;case"F_EXCEED_SIZE":var s=this.options.fileSingleSizeLimit/1024/1024;r="图片最大不超过"+s+"M";break;default:}!!r&&t.alert(r)}};return image=function(e){var t={accept:{title:"Images",extensions:"PNG,GIF,BMP,JPEG,JPG",mimeTypes:".PNG,.GIF,.BMP,.JPEG,.JPG"},duplicate:!1},r={duplicate:"duplicate",pick:"selector",fileNumLimit:"fileLimit",fileSingleSizeLimit:"singleSizeLimit",server:"uploadUrl",swfUrl:"swf"};for(var i in r)typeof e[r[i]]!="undefined"?t[i]=e[r[i]]:t[i]=s[r[i]];t.pick={id:t.pick||e.btnEl},e.accept&&(t.accept=e.accept),t.handlers=u,t.disableWidgets=["getToken","xmInit","serverCreateFile","beforeSend"];var o=n(t);return console.log(o),o}});var SWFUpload;define("plugin/swfupload/swfupload",[],function(){return SWFUpload==undefined&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings={},this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(e),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.1 2009-03-30",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120,JAVASCRIPT:-130},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){try{var t="";if(typeof e!="string"||e.match(/^https?:\/\//i)||e.match(/^\//)||e==="")return e;var n=window.location.pathname.lastIndexOf("/");return n<=0?t="/":t=window.location.pathname.substr(0,n)+"/",t+e}catch(r){return e}},SWFUpload.prototype.initSettings=function(e){this.ensureDefault=function(t,n){var r=e[t];if(r!=undefined)if(typeof r!="object"||r instanceof Array)this.settings[t]=r;else{var i={};for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);this.settings[t]=i}else this.settings[t]=n},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("requeue_on_error_time",30),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("button_click_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.ensureDefault("transcoding_url",""),this.ensureDefault("transcoding_success",null),this.customSettings=this.settings.custom_settings,!this.settings.prevent_swf_caching||(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(document.getElementById(this.movieName)!==null)throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(e==undefined)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;var n=(e.currentStyle&&e.currentStyle.display||window.getComputedStyle&&document.defaultView.getComputedStyle(e,null).getPropertyValue("display"))!=="block"?"span":"div";t=document.createElement(n),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),window[this.movieName]==undefined&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){this.movieElement==undefined&&(this.movieElement=document.getElementById(this.movieName));if(this.movieElement===null)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if(typeof e=="object")for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()));return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1),this.callFlash("StopExternalInterfaceCheck");var e=this.getMovieElement();this.cleanUp();if(e)try{e.parentNode.removeChild(e)}catch(t){}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(n){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler=="function").toString(),"\n","	","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler=="function").toString(),"\n","	","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler=="function").toString(),"\n","	","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler=="function").toString(),"\n","	","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler=="function").toString(),"\n","	","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler=="function").toString(),"\n","	","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler=="function").toString(),"\n","	","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler=="function").toString(),"\n","	","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler=="function").toString(),"\n","	","debug_handler assigned:             ",(typeof this.settings.debug_handler=="function").toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,n){return t==undefined?this.settings[e]=n:this.settings[e]=t},SWFUpload.prototype.getSetting=function(e){return this.settings[e]!=undefined?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return returnValue!=undefined&&typeof returnValue.post=="object"&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.requeueUpload=function(e){return this.callFlash("RequeueUpload",[e])},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return typeof e=="number"?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){typeof e=="string"&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){e==undefined&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var n=this.getMovieElement();n!=undefined&&(n.style.width=e+"px",n.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){t==undefined?t=[]:t instanceof Array||(t=[t]);var n=this;if(typeof this.settings[e]=="function")this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){n.executeNextEvent()},0);else if(this.settings[e]!==null)throw"Event handler "+e+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;typeof e=="function"&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t=/[$]([0-9a-f]{4})/i,n={},r;if(e!=undefined){for(var i in e.post)if(e.post.hasOwnProperty(i)){r=i;var s;while((s=t.exec(r))!==null)r=r.replace(s[0],String.fromCharCode(parseInt("0x"+s[1],16)));n[r]=e.post[i]}e.post=n}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(),this.queueEvent("swfupload_loaded_handler")},SWFUpload.prototype.cleanUp=function(){var e=this.getMovieElement();try{if(e&&typeof e.CallFunction=="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e)try{typeof e[t]=="function"&&(e[t]=null)}catch(n){}}}catch(r){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(n){}}},SWFUpload.prototype.buttonAction=function(){this.queueEvent("button_action_handler")},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,n])},SWFUpload.prototype.fileDialogComplete=function(e,t,n){this.queueEvent("file_dialog_complete_handler",[e,t,n])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if(typeof this.settings.upload_start_handler=="function")e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e);else if(this.settings.upload_start_handler!=undefined)throw"upload_start_handler must be a function";t===undefined&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,n])},SWFUpload.prototype.uploadError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,n])},SWFUpload.prototype.uploadSuccess=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,n])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.mouseClick=function(){console.log("mouseClick"),this.queueEvent("button_click_handler")},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,n=[];if(typeof e=="object"&&typeof e.name=="string"&&typeof e.message=="string"){for(var r in e)e.hasOwnProperty(r)&&n.push(r+": "+e[r]);t=n.join("\n")||"",n=t.split("\n"),t="EXCEPTION: "+n.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,n;try{t=document.getElementById("SWFUpload_Console"),t||(n=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(n),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",n.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(r){alert("Exception: "+r.name+" Message: "+r.message)}},SWFUpload}),define("plugin/swfupload/swfupload.queue",["./swfupload"],function(e){function t(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}return typeof e=="function"&&(e.queue={},e.prototype.initSettings=function(t){return function(n){typeof t=="function"&&t.call(this,n),this.queueSettings={},this.queueSettings.queue_cancelled_flag=!1,this.queueSettings.queue_upload_count=0,this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler,this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler,this.settings.upload_complete_handler=e.queue.uploadCompleteHandler,this.settings.upload_start_handler=e.queue.uploadStartHandler,this.settings.queue_complete_handler=n.queue_complete_handler||null}}(e.prototype.initSettings),e.prototype.startUpload=function(e){this.queueSettings.queue_cancelled_flag=!1,this.callFlash("StartUpload",[e])},e.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=!0,this.stopUpload();var e=this.getStats();while(e.files_queued>0)this.cancelUpload(),e=this.getStats()},e.queue.uploadStartHandler=function(e){var n=this.getSetting("upload_url");n.indexOf("?")>0?this.setUploadURL(n.substr(0,n.indexOf("?"))+"?fileSize="+e.size+"&token="+t(config.TOKEN_LABEL)+"&rememberMe="+t(config.REMEMBERME_LABEL)):this.setUploadURL(n+"?fileSize="+e.size+"&token="+t(config.TOKEN_LABEL)+"&rememberMe="+t(config.REMEMBERME_LABEL));var r;return typeof this.queueSettings.user_upload_start_handler=="function"&&(r=this.queueSettings.user_upload_start_handler.call(this,e)),r=r===!1?!1:!0,this.queueSettings.queue_cancelled_flag=!r,r},e.queue.uploadCompleteHandler=function(t){var n=this.queueSettings.user_upload_complete_handler,r;t.filestatus===e.FILE_STATUS.COMPLETE&&this.queueSettings.queue_upload_count++,typeof n=="function"?r=n.call(this,t)===!1?!1:!0:t.filestatus===e.FILE_STATUS.QUEUED?r=!1:r=!0;if(r){var i=this.getStats();if(i.files_queued>0&&this.queueSettings.queue_cancelled_flag===!1)if(i.upload_errors!=0&&this.settings.requeue_on_error){this.setStats({upload_errors:0});var s=this.settings.requeue_on_error_time,o=this;setTimeout(function(){o.startUpload(t.id)},s*1e3)}else this.startUpload();else this.queueSettings.queue_cancelled_flag===!1?(this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]),this.queueSettings.queue_upload_count=0):(this.queueSettings.queue_cancelled_flag=!1,this.queueSettings.queue_upload_count=0)}}),e}),define("module/uploadimg",["jquery","underscore","backbone","plugin/dialog","plugin/uploader/xmupload-image","plugin/swfupload/swfupload.queue"],function(e,t,n,r,i){var s=config.DIRECT_DTRES_ROOT+"/headerThumb/upload",o=n.View.extend({initialize:function(t){this.options=e.extend({url:s,$el:"",maxSize:3,beforeUpload:e.noop,success:e.noop,error:e.noop,textClass:"",file_queue_limit:1,file_upload_limit:1,file_queued_handler:e.noop,swfupload_loaded_handler:e.noop,repeat:!1},t),this.$el=this.options.$el,this.initUploadImg()},initUploadImg:function(){var t=this,n=this.$el,s=n.html(),o=this.options;n.css("position","relative");if(n.length<=0)return!1;n.html('<div class="'+o.textClass+'">'+s+'</div><div style="position: absolute;left:0;top:0;right:0;bottom:0;"><span id="imgUploadSwf"></span></div>');var u=config.STATIC_PATH+"/cdnswf/swfupload.swf",a={flash_url:u,upload_url:o.url,file_size_limit:o.maxSize+" MB",file_types:"*.gif; *.jpg; *.png;*.jpeg;*.bmp;",file_types_description:"Image Files",debug:!1,file_queue_limit:o.file_queue_limit,file_upload_limit:o.file_upload_limit,button_width:n.outerWidth(),button_height:n.outerHeight(),button_placeholder_id:"imgUploadSwf",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,swfupload_loaded_handler:function(){o.swfupload_loaded_handler.call(this)},file_queued_handler:function(e){o.file_queued_handler.call(this,e)},file_dialog_complete_handler:function(e,t){if(e==0)return;this.startUpload()},upload_error_handler:function(e,t,n){if(!e&&t)return;o.error.call(this,e,t,n)},file_queue_error_handler:function(e,t,n){t==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&r.alert("选择图片超过最大上传限制"),t==SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT&&r.alert("图片最大不超过"+o.maxSize+"M");return},upload_start_handler:function(e){o.beforeUpload.call(this,e)},upload_success_handler:function(t,n){var i=e.parseJSON(n);if(!i.status){r&&r.alert(i.msg),o.error.call(this,i,t);return}o.success.call(this,i,t,n)}};this.options.file_upload_limit==1&&(o.repeat=!0);var f=this.genBtnId(n),l=i({selector:"#"+f,fileLimit:o.file_upload_limit,uploadUrl:o.url,singleSizeLimit:o.maxSize*1024*1024});l.onReady=function(){o.swfupload_loaded_handler.call(t)},l.onFileQueued=function(e){o.file_queued_handler.call(this,e)},l.onUploadStart=function(e){o.beforeUpload.call(this,e)},l.onUploadError=function(e,t){o.file_upload_limit==1&&o.repeat&&this.reset();if(!e&&t)return;o.error.call(this,e,t)},l.onUploadSuccess=function(t,n){o.file_upload_limit==1&&o.repeat&&this.reset();var i=typeof n=="string"?e.parseJSON(n):n;if(!i.status){r&&r.alert(i.msg),o.error.call(this,i,t);return}o.success.call(this,i,t,n)},this.uploader=l},uploader:{},setButtonDisabled:function(t){var n=this.uploader;t?e(n.options.pick.id).find("div[id*='rt_rt_']").css("z-index","-10"):e(n.options.pick.id).find("div[id*='rt_rt_']").css("z-index","inherit")},genBtnId:function(t){var n=t.attr("id");if(!n)for(var r=1;r<100;r++)if(e("#js-upload-img-"+r).length<=0){n="js-upload-img-"+r,t.attr("id",n);break}return n},setFileUploadLimit:function(e){var t=this.uploader;t.trigger("flushFileNumLimit",e)},getFileUploadLimit:function(){var e=this.uploader;return e.options.fileNumLimit},increaseUploadLimit:function(e){var t=this.uploader;e?t.removeFile(e,!0):this.setFileUploadLimit(this.getFileUploadLimit()+1)},decreaseUploadLimit:function(){this.setFileUploadLimit(this.getFileUploadLimit()-1)}});return o}),define("module/album/tags",["jquery","plugin/dialog"],function(e,t){var n={1:"choose",2:"choose",3:"chooseInput",4:"input",5:"dropDown"},r={enter:13,space:32,backspace:8},i=12,s=function(){};s.prototype={selectedData:{},chooseType:function(){},parse:function(e,t){for(var n in t){var r=t[n],i=new RegExp("(\\$\\{"+n+"\\})","g");e=e.replace(i,function(e,t){return typeof r=="function"?r():""+r})}return e=e.replace(/\$\{.*\}/,""),e},updateAllTags:function(e){},updateSelected:function(e,t){if(!this.selectedData[e])this.selectedData[e]=[t];else{var n=this.selectedData[e],r=0,i=!1;for(;r<n.length;r++)if(n[r]===t){n.splice(r,1),i=!0;break}i||n.push(t),n.length||delete this.selectedData[e]}return this.selectedData},limitInput:function(e,t){t=t||12;var n=e.replace(/[^a-z|A-Z|0-9]/g,"aa");return n.length>12?!1:!0},limitCount:function(e,t){return e>t?!1:!0}};var o=function(e){this.selectedData={}};o.prototype=new s,o.addMethod=function(e){for(var t in e)o.prototype[t]||(o.prototype[t]=e[t])},methods={init:function(t){var r=this,i=t.data,s=i.metadataSummaryList,o=s.length,u="",a=this.targetEl=t.targetEl;this.inputName=t.inputName;for(var f=0;f<o;f++){var l=s[f],c=l.inputType;u+=r[n[c]+"Template"](l)}this.$tags=e(this.listTagsEl).html(u),this.$target=e(a).html(r.warpHtml(u)),this.$target.find(".js-tags-selecter-chosen_area").val(JSON.stringify(this.selectedData)),this.bindEvent()},bindEvent:function(){var n=this,i=this.$tags;this.$target.find(".selecter").selecter({onChange:function(){var t=this;e(this).hasClass("selected:not(.hidden)")||(e(this).siblings(".selected").not(".hidden").length&&e(t).siblings(".selected").attr("data-value")!=="-100"&&n.selectHandler(e(t).siblings(".selected")),e(this).attr("data-value")!=="-100"&&n.selectHandler(e(this)))}}),this.$target.find(".more-cont").on("click",".js-mytags .tagBtn",function(){var t=e(this).parents(".row-item").attr("data-limit");e(this).parent(".js-mytags").find(".on").length>=t&&!e(this).hasClass("on")?new n.wranError(e(this).parents(".row-item")):(e(this).toggleClass("on"),n.selectHandler(e(this)))}),this.$target.find(".tags-selecter-editor_area").on("keydown",function(i){var s=e(this).val();s=e.trim(s);var o=i.keyCode,u=e(this).parents("[metadata-id]").find(".js-mytags"),a=e(this).parents(".row-item").attr("data-limit"),f=/[^0-9a-zA-Z\u4e00-\u9fa5]/;if(!s&&(o==r.space||o==r.enter))return!1;if(e(this).parents(".row-item").find(".js-mytags").find(".on").length>=a)new n.wranError(e(this).parents(".row-item"));else{if(!(o!=r.space&&o!=r.enter||!f.test(s)))return new n.wranError(e(this).parents(".row-item"),"不能包含特殊字符"),!1;if(!(o!=r.space&&o!=r.enter||!n.checkExistsTag(u,s)))return t&&t.alert("不能添加同名标签"),!1;if((o==r.space||o==r.enter)&&!n.checkInputLimit(s))return t&&t.alert("最多输入6个汉字"),!1;if(o==r.space||o==r.enter){var l=e(this).parents("[metadata-id]").attr("metadata-id");return n.addNewTag(u,s,l),n.updateSelectedTag({tagId:"",tagName:s,metadataValue:s,metadataId:l}),e(this).val(""),!1}}}),this.$target.find(".js-mytags").on("click",".del",function(){var t=e.trim(e(this).parent(".tagBtn").text()),r=e(this).parents("[metadata-id]").attr("metadata-id");if(e(this).parent(".tagBtn").hasClass("on")){var i=e(this).parent(".tagBtn").attr("metadata-value");n.updateSelectedTag({tagId:"",tagName:t,metadataValue:i,metadataId:r})}return e(this).parent(".tagBtn").remove(),!1}),this.$target.find(".searchTagsPanel").find(".j-txt-more").on("click",function(){var t=e(this).text(),r=e(this).parent(".is-open").length;r?n.$target.find(".js-tags-selecter-chosen_area").val(""):n.$target.find(".js-tags-selecter-chosen_area").val(JSON.stringify(n.selectedData)),e(this).parent(".more").toggleClass("is-open"),e(n.listTagsEl).toggleClass("hidden")}),this.$target.find(".chooseInput").on("click",function(){e(this).toggleClass("on"),n.$target.find(".chooseInputContent").toggleClass("hidden")});var s=[];this.$target.find(".selecter .selecter-options").each(function(){e(this).find(".selected").length&&s.push({target:e(this).parent(".selecter"),text:e(this).find(".selected").text()})});for(var o=0;o<s.length;o++)s[o].target.selecter("val",s[o].text)},selectHandler:function(t){var n=this,r=e.trim(t.text()),i=t.attr("tag-id"),s=t.parents("[metadata-id]").attr("metadata-id"),o=t.attr("metadata-value");t.find(".del").length&&(s=s),n.updateSelectedTag({tagId:i,tagName:r,metadataValue:o,metadataId:s}),i&&n.switchCurrentTag(s,i)||e(".js-tags-selecter-chosen_area").change()},wranError:function(e,t){this.errorTimerId&&clearTimeout(this.errorTimerId),e.addClass("is-error"),t&&e.find(".custom_tag").text(","+t),this.errorTimerId=setTimeout(function(){e.removeClass("is-error"),e.find(".custom_tag").text("")},1500)},hadSelector:".searchTagsPanel .tagsBox1",listTagsEl:".searchTagsPanel .more-cont",warpHtml:function(e,t){var n=this;t=this.defSelectedHtml&&this.defSelectedHtml.join("")||t||"";var r={inputName:this.inputName,selectedTagsHTML:t||"",backupTagsHTML:e||""},i='<input name="${inputName}" type="hidden" id="chosen_area" class="js-tags-selecter-chosen_area">		<div class="searchTagsPanel"><div class="tagsBox1 hidden">${selectedTagsHTML}</div>       	<div class="more hidden">            	<span class="fl mgr-20">完善标签，就会有更多机会露出，就能让更多人听到</span>            	<a class="j-txt-more fr mgl-20 btn-flex " href="javascript:;" ><i class="icon iconmore iconmore-1"></i></a>            <hr></div>			<div class="more-cont " style="">${backupTagsHTML}</div>		</div>';return n.parse(i,r)},addNewTag:function(t,n){var r={isSeclected:"on",isShow:!0,parentId:0,tagId:"",metadataValue:n,displayValue:n};e(this.tagTemplate([r])).prependTo(t).addClass("tag-item").prepend('<i class="del"></i>')},getOptionalTagBtns:function(e,t){if(!e)return"";var n=[];for(var r=0;r<e.length;r++){var i={isSeclected:e[r].isSelected?"on":"",isShow:!0,parentId:0,tagId:"",metadataValue:e[r].optionalValue,displayValue:e[r].optionalValue};n.push(i)}return this.tagTemplate(n,t)},checkExistsTag:function(t,n){var r=!1;return e(t).find(".tagBtn").each(function(){var t=e(this).text();t===n&&(r=!0)}),r},checkInputLimit:function(e){var t=e.replace(/[\u0391-\uFFE5]/g,"aa");return t.length<=i},checkExisitsSelectedTag:function(e,t){},switchCurrentTag:function(e,t){this.toggleParentTags(e,t)},toggleParentTags:function(t,n){var r=this,i=e('[data-parentid="'+t+'"]'),s=[];i.find(".js-mytags .tagBtn").each(function(){var t=e(this).attr("tag-id");t&&e(this).addClass("hidden")}),i.find(".js-mytags .selecter-item").each(function(){!e(this).attr("data-id")==="-100"&&e(this).addClass("hidden"),e(this).addClass("hidden")}),i.each(function(){function u(){e(this).attr("data-parent-id")==n&&(!!e.trim(e(this).text())&&e(this).removeClass("hidden"),!o.hasClass("hidden")&&e(this).hasClass("on")?e(this).click():!o.hasClass("hidden")&&e(this).hasClass("selected")&&(e(this).parents(".selecter").selecter("val","-100"),r.selectHandler(e(this))),t=!0)}var t=!1,i=e(this).attr("id"),o=e(this);e(this).find(".tagBtn").each(u).end().find(".selecter-item").each(u),t&&s.push(i)}),s.length&&function(){for(var t=0;t<s.length;t++)e("#"+s[t]).toggleClass("hidden")}()},tagTemplate:function(e,t){var n=this,r='<a class="tagBtn ${isSeclected} ${isShow}" metadata-value="${metadataValue}" title="${note}"  href="javascript:;" data-parent-id="${parentId}" tag-id="${tagId}">${delTemp}<span>${tagName}</span></a>',i="";for(var s=0;s<e.length;s++){var o=e[s],u=n.subData(o,o.delTemp?o.isSeclected:""),a=r;t&&u.isSeclected()&&n.addDefSelectedTags(u.tagName,t,u.metadataValue),i+=n.parse(a,u)}return i},dropDownTag:function(e,t){var n=this,r='<li class="selecter-item ${isSeclected} ${isShow}" metadata-value="${metadataValue}" title="${note}" data-parent-id="${parentId}" tag-id="${tagId}" data-value="${tagName}"> ${tagName}</li>',i=n.subData,s='<li class="selecter-item "   data-value="-100"> 请选择</li>';for(var o=0;o<e.length;o++){var u=e[o],a=i(u,function(){return u.isSeclected?"selected":""}),f=r;t&&a.isSeclected()&&n.addDefSelectedTags(a.tagName,t,a.metadataValue),s+=n.parse(f,a)}return s},updateSelectedTag:function(t){var n=t.tagId,r=t.parentId,i=t.tagName,s=t.metadataId,o=t.metadataValue,u=0;e(this.hadSelector).find("span.tagBtn").each(function(t,n){var r=e(this).text(),o=e(this).attr("tag-id"),a=e(this).attr("metadata-id");r==i&&s==a&&(u=t+1)}),u?e(this.hadSelector).find(".tagBtn:eq("+(u-1)+")").remove():e(this.hadSelector).append('<span class="tagBtn selected-tag" tag-id="'+n+'" metadata-id="'+s+'" ><span>'+i+"</span></span>"),this.updateSelected(s,o),e(".js-tags-selecter-chosen_area").val(JSON.stringify(this.selectedData)).change()},addDefSelectedTags:function(e,t,n){this.defSelectedHtml=this.defSelectedHtml||[],this.defSelectedHtml.push('<span class="tagBtn selected-tag"  metadata-id="'+t+'" ><span>'+e+"</span></span>"),n=n||e,this.updateSelected(t,n)},baseData:function(e){var t=this,n={id:e.metadataId,name:e.metadataName,limit:e.inputValueCount,parentMetaDataId:e.parentMetaDataId,textValue:e.textValue||"",isShow:function(){return e.isShow?"":"hidden"},tagBtns:function(){return t.tagTemplate(e.displayMetadataValues,e.metadataId)},isMandatory:function(){return e.isMandatory?"":"hidden"},required:function(){return e.isMandatory?"true":"false"}};return n},subData:function(e,t){var n={tagId:e.metadataValueId||"",tagName:e.displayValue||"",metadataValue:e.metadataValue||"",parentId:e.parentMetaDataValueId||"",note:e.note||"",sourceData:encodeURIComponent(JSON.stringify(e)),delTemp:e.delTemp||"",isSeclected:t||function(){return e.isSeclected?"on":""},isShow:function(){return e.displayValue&&e.isShow?"":"hidden"}};return n},chooseTemplate:function(e){var t=this,n=t.baseData(e),r='<div class="row row-item ${isShow}" id="${id}" metadata-id="${id}" data-limit="${limit}" data-parentid ="${parentMetaDataId}"  required="${required}">	<div class="cell-1">${name}<span class="c04 ${isMandatory}">*</span></div>	<div class="cell-2"><div class="js-mytags"> ${tagBtns}</div> <p class="tips">最多选填${limit}枚标签</p></div></div>';return t.parse(r,n)},inputTemplate:function(e){var t=this,n=t.baseData(e);n.optionalTagBtns=function(){return t.getOptionalTagBtns(e.optionalValues,e.metadataId)};var r=this.saveCustomTag(n.textValue,n.id),i='<div class="row row-item ${isShow}" id="${id}" metadata-id="${id}" data-limit="${limit}"  data-parentid ="${parentMetaDataId}" required="${required}">	<div class="cell-1">${name}<span class="c04 ${isMandatory}">*</span></div>	<div class="cell-2">                           <div class="inputArea changeMode">            <div class="inputArea-tag"></div>            <div class="inputArea-txt">                <input id="sound_editor_area" type="text" class="tags-selecter-editor_area" placeholder="单个标签最长6个汉字，按回车或空格键确认" autocomplete="off">            </div>        </div>		<div class="js-mytags">${tagBtns}${optionalTagBtns}'+r+"</div>"+'		<p class="tips">最多选填${limit}枚标签<span class="custom_tag"></span></p>'+"	</div>"+"</div>";return t.parse(i,n)},dropDownTemplate:function(e){var t=this,n=t.baseData(e);n.tagBtns=t.dropDownTag(e.displayMetadataValues,e.metadataId),n.limit=1;var r='<div class="row row-item ${isShow}" id="${id}" metadata-id="${id}" data-limit="${limit}"  data-parentid ="${parentMetaDataId}" required="${required}"> 	<div class="cell-1">${name}<span class="c04 ${isMandatory}" >*</span></div>	<div class="cell-2">		<div id="" class="selecter selecter-s5 ">            <input type="hidden" name="">            <div class="selecter-selected" data-default-value="请选择">                <span class="selecter-text">请选择</span>                <em class="selecter-arrow">◆</em>            </div>            <div class="selecter-options">                <ul class="js-mytags">${tagBtns}</ul>            </div>         </div>		<span class="tips">最多选填${limit}枚标签</span>	</div></div>';return t.parse(r,n)},chooseInputTemplate:function(e){var t=this,n=t.baseData(e),r=this.saveCustomTag(n.textValue,n.id),i='<div class="row row-item ${isShow}" id="${id}" metadata-id="${id}" data-limit="${limit}"  data-parentid ="${parentMetaDataId}" required="${required}">	<div class="cell-1">${name}<span class="c04 ${isMandatory}">*</span></div>	<div class="cell-2">		<div class="js-mytags">${tagBtns}'+r+"</div>"+"		<div>"+'			<a class="chooseInput fl" style=" margin-right: 5px;" href="javascript:;">'+"		         其他"+"		    </a>"+'		    <div class="inputArea changeMode chooseInputContent hidden">'+'                <div class="inputArea-txt">'+'                    <input id="sound_editor_area" type="text" class="tags-selecter-editor_area" placeholder="单个标签最长6个汉字，按回车或空格键确认" autocomplete="off">'+"                </div>"+"            </div>"+"		</div><br>"+'		<p class="tips">最多选填${limit}枚标签<span class="custom_tag"></span></p>'+"	</div>"+"</div>";return t.parse(i,n)},saveCustomTag:function(t,n){if(!t)return"";var r=typeof t=="string"?t.split(","):t,i="";for(var s=0;s<r.length;s++){var o=e.trim(r[s]);i+=this.tagTemplate([{isSeclected:"on tag-item",isShow:!0,delTemp:'<i class="del"></i>',metadataValue:o,displayValue:o}]),this.addDefSelectedTags(o,n)}return i}},o.addMethod(methods);var u=function(e,t){this.target=e,this.tagsUI(t)};return u.prototype={tagsUI:function(t){var n=this;e(n.target).empty(),e(n.target).each(function(){var r=e(this).attr("output")||"tags",i=t.requestUrl||e(this).attr("request-url");i?n.requestData(i,{inputName:r,targetEl:this}):(n.ui=new o,n.ui.init({data:t,inputName:r,targetEl:this}))})},requestData:function(t,n){var r=this;e.ajax({url:t,type:"GET",dataType:"json",success:function(e){n.data=e.data,r.ui=new o,r.ui.init(n)},error:function(){window.console&&console.log("request error")}})},pass:function(){var t="";return e(this.target).find(".tagsBox1 .selected-tag").length&&e(".more-cont").find(".row-item[required=true]").not(".hidden").each(function(){if(t)return;e(this).find(".selecter").length?t=e(this).find(".selected").length&&e(this).find(".selected").attr("data-value")!=="-100"?"":"请检查标签必填项":e(this).find(".js-mytags .on").length||(t="请检查标签必填项")}),t},getData:function(){return this.ui.selectedData}},u}),define("module/dialogs/create_album_html",[],function(){var e={fromTemplate:function(){var e={title:'<div class="row">	<div class="cell-1">专辑名称<span class="c04">*</span></div>	<div class="cell-2">		<!--该INPUT用来防止在标题输入框中按回车form表单自动提交-->		<input class="" type="text" id="" name="" style="position:absolute;top:-10000px;">		<input class="inputW1" type="text" id="title" name="title">		<p class="tips mgt-5" data-def=" 好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）"> 			好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）</p>	</div></div>',image:'<div class="row">	<div class="cell-1">设置封面</div>	<div class="cell-2">		<div id="imageWrap" class="imageWrap">            <div class="imgBox2">                <div class="imgItem">                    <img id="album_cover_url" src="'+config.STATIC_PATH+'/css/img/common/track_100.jpg">'+'                    <input type="hidden" name="image">'+'                    <div class="imgLoading"></div>'+"                </div>"+"            </div>"+"        </div>"+"        <p>"+'            <a class="btn btn-secondary btn-upload" href="javascript:;" id="uploadPicBtn"><i class="icon icon-10 icon-upload1"></i> 上传图片</a>   '+'            <span class="tips" data-def="文件大小<3M,尺寸最好<500X500" >文件大小&lt;3M,尺寸最好&gt;500X500</span>'+"        </p>"+"	</div>"+"</div>",categories:' <div class="row">			<div class="cell-1">类型<span class="c04">*</span></div>			<div class="cell-2">				<div id="genre" class="selecter selecter-s5 ">                    <input type="hidden" name="category_id">                    <div class="selecter-selected">                        <span class="selecter-text">请选择</span>                        <em class="selecter-arrow">◆</em>                    </div>                    <div class="selecter-options">                        <ul>                                                                                    </ul>                    </div>                 </div>                 <div id="genre_sub" class="selecter selecter-s5 hidden">                    <input name="music_category" value="" type="hidden">                    <div class="selecter-selected" data-value="">                        <span class="selecter-text">                        	请选择                        </span>                        <em class="selecter-arrow">◆</em>                    </div>                    <div class="selecter-options">                        <ul>                             </ul>                    </div>                </div>				<span class="tips" data-def="该信息必填">该信息必填</span>			</div>		</div>',order:'<div class="row">	<div class="cell-1">专辑排序<span class="c04">*</span></div>	<div class="cell-2">		<label class="xm-radio mgr-20 ">			<input type="radio" name="is_records_desc" class="js-order-d" value="1"  >倒序 <span class="tips">最新在前（如：第3集、第2集、第1集）</span>		</label><br>		<label class="xm-radio ">			<input type="radio" name="is_records_desc" class="js-order-z" value="0">正序 <span class="tips">最新在后（如：第1集、第2集、第3集）</span>		</label>	</div></div>',is_pay:'		<div class="row">			<div class="cell-1">是否付费<span class="c04">*</span></div>			<div class="cell-2">				<label class="xm-radio  mgr-20">					<input type="radio" name="is_paid" value="1" data-show="js-price-paytype">是 				</label>				<label class="xm-radio" >					<input type="radio" name="is_paid" value="0">否 				</label><span class="tips" data-def=""></span>			</div>		</div>',pay_type:'		<div class="row  js-price-paytype hidden">			<div class="cell-1">售卖类型<span class="c04">*</span></div>			<div class="cell-2">				<div id="price_type_id" class="selecter selecter-s5 " style="width:250px;">                    <input type="hidden" name="price_type_mask">                    <div class="selecter-selected">                        <span class="selecter-text">请选择</span>                        <em class="selecter-arrow">◆</em>                    </div>                    <div class="selecter-options">                        <ul>                                                                                    </ul>                    </div>                 </div>				<span class="tips" data-def="该信息必填">该信息必填</span>			</div>		</div>',subTitle:'<div class="row js-price-paytype js-sub-title-contrain hidden"> <div class="cell-1">专辑副标题<span class="c04">*</span></div> <div class="cell-2">   <input class="inputW1 sub_title j-destory"  id="sub_title" name="custom_title" type="text">   <p class="tips mgt-5">请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">       查看展示位置       <span class="hover-detail">         <img src="'+config.STATIC_PATH+'/css/img/pic.png">'+"       </span>"+"     </span> "+"   </p>"+" </div>"+"</div>",tryting:'		<div class="row js-price-paytype hidden">		    <div class="cell-1">高级试听</div>		    <div class="cell-2">		      <label class="xm-checkbox"  id="isSample" data-wran-tips="js-sample-warn">		        <input type="checkbox" name="is_sample" checked value="1">本专辑内所有声音均可试听前N秒		      </label>		      <span class="txt-sm c04 js-sample-warn hidden" >据说99%销量领先的主播都勾选了此项哦~</span>		      <p class="tips">若声音时长≤10分钟，则试听时长为前90秒；若声音时长＞10分钟，则试听时长为前180秒</p>						      <label class="xm-checkbox"  id="eavesdropping" data-wran-tips="js-sample-warn2">		        <input type="checkbox" name="canShareAndStealListen" checked value="1">听众可免费听一条分享成功的声音		      </label>		      <span class="txt-sm c04 js-sample-warn2 hidden" >据说99%销量领先的主播都勾选了此项哦~</span>		      <p class="tips">同一听众最多只能分享免费听本专辑中的一条声音</p>		    </div>		</div>',soundpaster:'<div class="row js-price-paytype js-soundpaster hidden">      <div class="cell-1">试听引导语<span class="c04">*</span>      </div>      <div class="cell-2 pay-album-intro">          <p class="c02">请选择适合你节目性质的内容（试听部分结束后，将使用此语音引导用户购买哦）</p>      </div> </div>',paytypeRows:'		<div class="js-paytype-rows"></div>',freesubTitle:'<div class="row  js-free-sub-title-contrain "> <div class="cell-1">专辑副标题</div> <div class="cell-2">   <input class="inputW1 sub_title" id="sub_title" name="custom_title" type="text" data-require="false">   <p class="tips mgt-5">请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">       查看展示位置       <span class="hover-detail">         <img src="'+config.STATIC_PATH+'/css/img/pic.png">'+"       </span>"+"     </span> "+"   </p>"+" </div>"+"</div>",is_public:'		<div class="row js-is-public">			<div class="cell-1">是否公开<span class="c04">*</span></div>			<div class="cell-2">				<label class="xm-radio xm-is-checked">					<input type="radio" name="is_public" value="1" checked="checked">公开 <span class="tips">所有人可见(公开后，无法再设置为私密)</span>				</label>				<br>				<label class="xm-radio" >					<input type="radio" name="is_public" value="0">私密 <span class="tips">仅自己可见</span>				</label>			</div>		</div>',rich_intro:'		<div class="js-intro-row">		<div class="row">	<div class="cell-1">专辑简介</div>			<input id="description" type="hidden" name="intro_images" value="">			<input id="description"  data-params="{ &quot;maxSizeLimit&quot;:3000, &quot;must&quot; : false}" type="hidden" data-name="intro" name="intro" value="">			<div class="cell-2 textarea-wrapper">				<p class="placeholder">这档节目讲了什么？简单介绍一下吧~</p>				<textarea id="" rows="10" cols="30" name="rich_intro"></textarea>												<span class="tips hidden fr js-intro-min-size-tips">加油，还差<span class="c04">100</span>个字！</span>			</div>		</div></div>',editor_area:'		<div class="row">			<div class="cell-1">标签</div>			<div class="cell-2">				<div class="searchTagsPanel" id="searchTagsPanel"></div>			</div>		</div><p class="infoErr tc" id="infoErr"></p>',grate:'<div class="row tc js-copyright hidden">  <label class="xm-checkbox xm-is-checked">    <input type="checkbox" id="agreeDeal" checked="checked" name="is_hold_copyright">我已阅读并同意  </label>  <a class="a_tdu apply_deal " target="_blank" href="/upload/paid_content_distribution_rule">付费内容发布协议</a>  和 <a class="a_tdu apply_deal " target="_blank" href="/upload/copyright_rule">知识产权承诺</a> </div>',sureBtn:'	<div class="row tc">	       <a href="" class="btn btn-lg1 btn-primary ablum-createBtn" dialog-role="yes">${sureText}</a>		<a href="javascript:;" class="btn btn-lg1 btn-secondary mgl-20 album-preview-btn hidden" id="albumPreview">预览</a>	</div>'};return e},price_type_id:{1:'<div class="row soundPrice js-price-sound " >	<div class="cell-1">声音单价<span class="c04">*</span></div>	<div class="cell-2">		<input type="text" class="inputW3 tc mgr-5" id="price" name="price" maxlength="13">喜点/集		<span class="tips tips-hover">			<i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>		</span>		<p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p>	</div></div><div class="row js-price-sound " >	<div class="cell-1">折扣价</div>	<div class="cell-2">		<input type="text" class="inputW3 tc mgr-5" id="discountprice" name="discounted_price" maxlength="13">喜点/集		<span class="tips tips-hover">			<i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>		</span>		<p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p>	</div></div>',2:'<div class="row js-price-album " >	<div class="cell-1">专辑总价<span class="c04">*</span></div>	<div class="cell-2">		<input type="text" class="inputW3 tc mgr-5" id="albumprice" name="price2" maxlength="13">喜点		<span class="tips tips-hover">			<i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>		</span>		<p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p>	</div></div><div class="row js-price-album js-price-album2 " >	<div class="cell-1">折扣价</div>	<div class="cell-2">		<input type="text" class="inputW3 tc mgr-5" id="discountprice2" name="discounted_price2" maxlength="13">喜点		<span class="tips tips-hover">			<i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>		</span>		<p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p>	</div></div><div class="row js-price-album js-price-album2 ">	<div class="cell-1">更新说明<span class="c04">*</span></div>	<div class="cell-2">		<input class="inputW1" type="text" id="updatedescr" name="price_description">		<p class="tips mgt-5" data-def="请说明节目预计更新频率以及更新时间，供买方参考">请说明节目预计更新频率以及更新时间，供买方参考</p>	</div></div><div class="row js-price-album js-price-album2 " >	<div class="cell-1">预估总集数<span class="c04">*</span></div>	<div class="cell-2">		<input type="text" class="inputW3 tc mgr-5" id="countsound" name="price_track_count" maxlength="13">集		<p class="tips-error tips mgt-5" data-def="编辑时不允许减少预估集数，请确保集数准确性哦~">编辑时不允许减少预估集数，请确保集数准确性哦~</p>	</div></div><div class="row js-price-album">    <div class="cell-1">专辑简介<span class="c04">*</span></div>    <div class="cell-2 pay-album-intro">      <p class="c02">认真填写呦，精彩的介绍会吸引更多听众购买~</p>      <!-- s: 简介配图 -->      <div class="row js-album-moreintro">        <lable>简介配图<span class="c04">*</span></lable>        <div id="introImageWrap" class="imageWrap">          <div class="imgBox2">            <div class="imgItem">              <img src="'+config.STATIC_PATH+'/css/img/common/default/album-intro.png">'+'              <input type="hidden" name="detail_cover_path" required>'+'              <div class="imgLoading"></div>'+"            </div>"+"          </div>"+"        </div>"+'        <p class="mgt-5">'+'          <a class="btn btn-secondary btn-upload" id="introPicBtn" href="javascript:;"><i class="icon icon-10 icon-upload1"></i> 上传图片</a>'+'          <span class="tips">请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M</span>'+"        </p>"+"      </div>"+"      <!-- e: 简介配图 -->"+"      <!-- s: 简介 -->"+'      <div class="row js-album-moreintro"  data-name="简介">'+'		 <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500,&quot;minSizeLimit&quot;:100, &quot;must&quot; : true}" name="intro" data-name="intro" value="">'+'        <lable>简介<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'		   <textarea style="display:none;" id=""  rows="10" cols="30" name="rich_intro"></textarea>'+'          <p class="tips js-intro-min-size-tips" data-def="专辑内容概括性介绍，请尽量精简易懂，最多可填写500个汉字">专辑内容概括性介绍，请尽量精简易懂，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 简介 -->"+"      <!-- s: 主播 -->"+'      <div class="row js-album-moreintro" data-name="主播">'+'		 <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : true}"  data-name="personalDescription" value="">'+'        <lable>主播<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'		   <textarea style="display:none;" id=""  rows="10" cols="30" name="personalDescription"></textarea>'+'          <p class="tips" data-def="演播人员介绍，最多可填写500个汉字">演播人员介绍，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 主播 -->"+"      <!-- s: 适合谁听 -->"+'      <div class="row js-album-moreintro" data-name="适合谁听">'+'		 <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : true}" data-name="suitable" value="">'+'        <lable>适合谁听<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'		   <textarea style="display:none;" id=""  rows="10" cols="30" name="suitable"></textarea>'+'          <p class="tips" data-def="本专辑内容面向的听众类型，最多可填写500个汉字">本专辑内容面向的听众类型，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 适合谁听 -->"+"      <!-- s: 你将获得 -->"+'      <div class="row js-album-moreintro" data-name="你将获得">'+'		 <input  type="hidden" data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : false}" data-name="achieve" value="">'+"        <lable>你将获得</lable>"+'        <div class="">'+'          <div class="textarea-shou"></div>'+'		   <textarea style="display:none;" id=""  rows="10" cols="30" name="achieve"></textarea>'+'          <p class="tips" data-def="介绍本专辑卖点，最多可填写500个汉字">介绍本专辑卖点，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 你将获得 -->"+"      <!-- s: 购买须知 -->"+'      <div class="row js-album-moreintro" data-name="购买须知">'+'		 <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : true}" data-name="buy_notes" value="">'+'        <lable>购买须知<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'		   <textarea style="display:none;" id=""  rows="10" cols="30" name="buy_notes"></textarea>'+'          <p class="tips" data-def="填写注意事项、更新频率和福利活动等，最多可填写500个汉字">填写注意事项、更新频率和福利活动等，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 购买须知 -->"+'	 <div class="js-album-moreintro js-otherDesc" data-name="其他说明">'+"       <!-- s: 编辑状态加 is-edit -->"+'       <div class="other-explain">'+'         <span class="unedit">'+'           <span class="js-otherDescTitle">其他说明</span><a class="btn1 mgl-10" title="编辑"><i class="iconother icon-edit"></i></a>'+"         </span>"+'         <span class="edit">'+'           <input class="input-edit-other" type="text" name="other_title" id="other_title" value="其他说明"><a class="btn btn-primary btn-sm3 mgl-5 js-sure-edit">确认</a><a class="btn-sm3 js-cancel-edit">取消</a>'+"         </span>"+"       </div>"+'		 <input  type="hidden" data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : false}" data-name="other_content" value="">'+"       <!-- e: 编辑状态加 is-edit -->"+'       <div class="">'+'         <div class="textarea-shou"></div>'+'		   <textarea style="display:none;" id=""  rows="10" cols="30" name="other_content"></textarea>'+'         <p class="tips" data-def="其他说明事项（标题可自定义，不超过10个字），最多可填写500个汉字">其他说明事项（标题可自定义，不超过10个字），最多可填写500个汉字</p>'+"       </div>"+"     </div>"+"    </div>"+"  </div>"},one_intro:'<div class="row">			<div class="cell-1">专辑简介</div>			<input id="description" type="hidden" name="intro_images" value="">			<input id="description" data-params="{&quot;maxSizeLimit&quot;:3000 , &quot;minSizeLimit&quot;:100, &quot;must&quot; : false}" type="hidden" name="intro" data-name="intro" value="">			<div class="cell-2 textarea-wrapper">				<p class="placeholder">这档节目讲了什么？简单介绍一下吧~</p>				<textarea id="" rows="10" cols="30" name="rich_intro"></textarea>												<span class="tips hidden fr js-intro-min-size-tips">加油，还差<span class="c04">100</span>个字！</span>			</div>		</div>'};return e}),function(window,undefined){function _isArray(e){return e?Object.prototype.toString.call(e)==="[object Array]":!1}function _isFunction(e){return e?Object.prototype.toString.call(e)==="[object Function]":!1}function _inArray(e,t){for(var n=0,r=t.length;n<r;n++)if(e===t[n])return n;return-1}function _each(e,t){if(_isArray(e)){for(var n=0,r=e.length;n<r;n++)if(t.call(e[n],n,e[n])===!1)break}else for(var i in e)if(e.hasOwnProperty(i)&&t.call(e[i],i,e[i])===!1)break}function _trim(e){return e.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function _inString(e,t,n){return n=n===undefined?",":n,(n+t+n).indexOf(n+e+n)>=0}function _addUnit(e,t){return t=t||"px",e&&/^\d+$/.test(e)?e+t:e}function _removeUnit(e){var t;return e&&(t=/(\d+)/.exec(e))?parseInt(t[1],10):0}function _escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _unescape(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function _toCamel(e){var t=e.split("-");return e="",_each(t,function(t,n){e+=t>0?n.charAt(0).toUpperCase()+n.substr(1):n}),e}function _toHex(e){function t(e){var t=parseInt(e,10).toString(16).toUpperCase();return t.length>1?t:"0"+t}return e.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/ig,function(e,n,r,i){return"#"+t(n)+t(r)+t(i)})}function _toMap(e,t){t=t===undefined?",":t;var n={},r=_isArray(e)?e:e.split(t),i;return _each(r,function(e,t){if(i=/^(\d+)\.\.(\d+)$/.exec(t))for(var r=parseInt(i[1],10);r<=parseInt(i[2],10);r++)n[r.toString()]=!0;else n[t]=!0}),n}function _toArray(e,t){return Array.prototype.slice.call(e,t||0)}function _undef(e,t){return e===undefined?t:e}function _invalidUrl(e){return!e||/[<>"]/.test(e)}function _addParam(e,t){return e.indexOf("?")>=0?e+"&"+t:e+"?"+t}function _extend(e,t,n){n||(n=t,t=null);var r;if(t){var i=function(){};i.prototype=t.prototype,r=new i,_each(n,function(e,t){r[e]=t})}else r=n;r.constructor=e,e.prototype=r,e.parent=t?t.prototype:null}function _json(text){var match;if(match=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(text))text=match[0];var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+text+")");throw"JSON parse error"}function _getBasePath(){var e=document.getElementsByTagName("script"),t;for(var n=0,r=e.length;n<r;n++){t=e[n].src||"";if(/kindeditor[\w\-\.]*\.js/.test(t))return t.substring(0,t.lastIndexOf("/")+1)}return""}function _bindEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,_useCapture):e.attachEvent&&e.attachEvent("on"+t,n)}function _unbindEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,_useCapture):e.detachEvent&&e.detachEvent("on"+t,n)}function KEvent(e,t){this.init(e,t)}function _getId(e){return e[_eventExpendo]||null}function _setId(e){return e[_eventExpendo]=++_eventId,_eventId}function _removeId(e){try{delete e[_eventExpendo]}catch(t){e.removeAttribute&&e.removeAttribute(_eventExpendo)}}function _bind(e,t,n){if(t.indexOf(",")>=0){_each(t.split(","),function(){_bind(e,this,n)});return}var r=_getId(e);r||(r=_setId(e)),_eventData[r]===undefined&&(_eventData[r]={});var i=_eventData[r][t];i&&i.length>0?_unbindEvent(e,t,i[0]):(_eventData[r][t]=[],_eventData[r].el=e),i=_eventData[r][t],i.length===0&&(i[0]=function(t){var n=t?new KEvent(e,t):undefined;_each(i,function(t,r){t>0&&r&&r.call(e,n)})}),_inArray(n,i)<0&&i.push(n),_bindEvent(e,t,i[0])}function _unbind(e,t,n){if(t&&t.indexOf(",")>=0){_each(t.split(","),function(){_unbind(e,this,n)});return}var r=_getId(e);if(!r)return;if(t===undefined){r in _eventData&&(_each(_eventData[r],function(t,n){t!="el"&&n.length>0&&_unbindEvent(e,t,n[0])}),delete _eventData[r],_removeId(e));return}if(!_eventData[r])return;var i=_eventData[r][t];if(i&&i.length>0){n===undefined?(_unbindEvent(e,t,i[0]),delete _eventData[r][t]):(_each(i,function(e,t){e>0&&t===n&&i.splice(e,1)}),i.length==1&&(_unbindEvent(e,t,i[0]),delete _eventData[r][t]));var s=0;_each(_eventData[r],function(){s++}),s<2&&(delete _eventData[r],_removeId(e))}}function _fire(e,t){if(t.indexOf(",")>=0){_each(t.split(","),function(){_fire(e,this)});return}var n=_getId(e);if(!n)return;var r=_eventData[n][t];_eventData[n]&&r&&r.length>0&&r[0]()}function _ctrl(e,t,n){var r=this;t=/^\d{2,}$/.test(t)?t:t.toUpperCase().charCodeAt(0),_bind(e,"keydown",function(r){r.ctrlKey&&r.which==t&&!r.shiftKey&&!r.altKey&&(n.call(e),r.stop())})}function _ready(e){function n(){t||(t=!0,e(KindEditor))}function r(){if(!t){try{document.documentElement.doScroll("left")}catch(e){setTimeout(r,100);return}n()}}function i(){document.readyState==="complete"&&n()}var t=!1;if(document.addEventListener)_bind(document,"DOMContentLoaded",n);else if(document.attachEvent){_bind(document,"readystatechange",i);var s=!1;try{s=window.frameElement==null}catch(o){}document.documentElement.doScroll&&s&&r()}_bind(window,"load",n)}function _getCssList(e){var t={},n=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g,r;while(r=n.exec(e)){var i=_trim(r[1].toLowerCase()),s=_trim(_toHex(r[2]));t[i]=s}return t}function _getAttrList(e){var t={},n=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g,r;while(r=n.exec(e)){var i=(r[1]||r[2]||r[4]||r[6]).toLowerCase(),s=(r[2]?r[3]:r[4]?r[5]:r[7])||"";t[i]=s}return t}function _addClassToTag(e,t){return/\s+class\s*=/.test(e)?e=e.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(e,n,r,i){return(" "+r+" ").indexOf(" "+t+" ")<0?r===""?n+t+i:n+r+" "+t+i:e}):e=e.substr(0,e.length-1)+' class="'+t+'">',e}function _formatCss(e){var t="";return _each(_getCssList(e),function(e,n){t+=e+":"+n+";"}),t}function _formatUrl(e,t,n,r){function o(e){var t=e.split("/"),n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r];s==".."?n.length>0&&n.pop():s!==""&&s!="."&&n.push(s)}return"/"+n.join("/")}function u(t,n){if(e.substr(0,t.length)===t){var i=[];for(var o=0;o<n;o++)i.push("..");var a=".";return i.length>0&&(a+="/"+i.join("/")),r=="/"&&(a+="/"),a+e.substr(t.length)}if(s=/^(.*)\//.exec(t))return u(s[1],++n)}t=_undef(t,"").toLowerCase(),e.substr(0,5)!="data:"&&(e=e.replace(/([^:])\/\//g,"$1/"));if(_inArray(t,["absolute","relative","domain"])<0)return e;n=n||location.protocol+"//"+location.host;if(r===undefined){var i=location.pathname.match(/^(\/.*)\//);r=i?i[1]:""}var s;if(s=/^(\w+:\/\/[^\/]*)/.exec(e)){if(s[1]!==n)return e}else if(/^\w+:/.test(e))return e;return/^\//.test(e)?e=n+o(e.substr(1)):/^\w+:\/\//.test(e)||(e=n+o(r+"/"+e)),t==="relative"?e=u(n+r,0).substr(2):t==="absolute"&&e.substr(0,n.length)===n&&(e=e.substr(n.length)),e}function _formatHtml(e,t,n,r,i,s,o){n=n||"",r=_undef(r,!1),i=_undef(i,"	");var u="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/ig,function(e,t,n,r){return t+n.replace(/<(?:br|br\s[^>]*)>/ig,"\n")+r}),e=e.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/ig,"</p>"),e=e.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/ig,"$1<br />$2"),e=e.replace(/\u200B/g,""),e=e.replace(/\u00A9/g,"&copy;");var a={};t&&(_each(t,function(e,t){var n=e.split(",");for(var r=0,i=n.length;r<i;r++)a[n[r]]=_toMap(t)}),a.script||(e=e.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/ig,"")),a.style||(e=e.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/ig,"")));var f=/([ \t\n\r]*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>([ \t\n\r]*)/g,l=[];e=e.replace(f,function(e,f,c,h,p,d,v){var m=e,g=f||"",y=c||"",b=h.toLowerCase(),w=p||"",E=d?" "+d:"",S=v||"";if(t&&!a[b])return"";E===""&&_SINGLE_TAG_MAP[b]&&(E=" /"),b==="img"&&(E=""),_INLINE_TAG_MAP[b]&&(g&&(g=" "),S&&(S=" ")),_PRE_TAG_MAP[b]&&(y?S="\n":g="\n"),r&&b=="br"&&(S="\n");if(_BLOCK_TAG_MAP[b]&&!_PRE_TAG_MAP[b])if(r){y&&l.length>0&&l[l.length-1]===b?l.pop():l.push(b),g="\n",S="\n";for(var x=0,T=y?l.length:l.length-1;x<T;x++)g+=i,y||(S+=i);E?l.pop():y||(S+=i)}else g=S="";if(s){var N=o||[],C=N.join(","),k=_toMap("b,basefont,big,del,em,font,i,s,small,strike,u");k[b]&&!_toMap(C)[b]&&(b="strong")}if(w!==""){var L=_getAttrList(m);if(b==="font"){var A={},O="";_each(L,function(e,t){e==="color"&&(A.color=t,delete L[e]),e==="size"&&(A["font-size"]=u[parseInt(t,10)-1]||"",delete L[e]),e==="face"&&(A["font-family"]=t,delete L[e]),e==="style"&&(O=t)}),O&&!/;$/.test(O)&&(O+=";"),_each(A,function(e,t){if(t==="")return;/\s/.test(t)&&(t="'"+t+"'"),O+=e+":"+t+";"}),L.style=O}_each(L,function(e,r){_FILL_ATTR_MAP[e]&&(L[e]=e),_inArray(e,["src","href"])>=0&&(L[e]=_formatUrl(r,n)),(t&&e!=="style"&&!a[b]["*"]&&!a[b][e]||b==="body"&&e==="contenteditable"||/^kindeditor_\d+$/.test(e))&&delete L[e];if(e==="style"&&r!==""){var i=_getCssList(r);_each(i,function(e,n){t&&!a[b].style&&!a[b]["."+e]&&delete i[e]});var s="";_each(i,function(e,t){s+=e+":"+t+";"}),L.style=s}});if(b=="li"||b=="tr")b="p",L.style="";s&&b==="p"&&(!L["data-flag"]||L["data-flag"]==="normal")&&(L.style=_NORMAL_FORMAT,L["data-flag"]="normal",L.lang="en"),b==="span"&&(!L["data-flag"]||L["data-flag"]==="normal")&&(L.style="",delete L["data-flag"]),b==="a"&&(L.style="text-decoration: none;color:#4990E2;"),w="",_each(L,function(e,t){if(e==="style"&&t==="")return;t=t.replace(/"/g,"&quot;"),w+=" "+e+'="'+t+'"'})}else b==="p"&&!y?w+=' style="'+_NORMAL_FORMAT+'" data-flag="normal" lang="en" ':(b=="li"||b=="tr")&&!y&&(b="p",w+=' style="'+_NORMAL_FORMAT+'" data-flag="normal" lang="en" ');return b==="blockquote"&&!y&&(w=' style="'+BLOCKQUOTE_STYLE+'" data-flag="blockquote" '),b==="strong"&&!y&&(w=' style="'+_STRONG_FORMAT+'"'),_toMap("h1,h2,h3,h4,h5,h6")[b]&&(b="p",y||(w+=' style="'+_SUBTITLE_FORMAT+'" data-flag="subtitle" ')),b==="hr"&&!y&&(w=' style="margin: 20px 0px;height: 1px;background: #ddd;border-style: solid;border: 0px;display: inline-block;width: 100%;"'),b==="font"&&(b="span"),g+"<"+y+b+w+E+">"+S}),e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/ig,function(e,t,n,r){return t+n.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+r}),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n"),e=e.replace(/data-key="[^"]*"/g,"");var c=0;return e=e.replace(/<img/g,function(){return'<img data-key="'+c++ +'"'}),_trim(e)}function _clearMsWord(e,t){return e=e.replace(/<meta[\s\S]*?>/ig,"").replace(/<![\s\S]*?>/ig,"").replace(/<style[^>]*>[\s\S]*?<\/style>/ig,"").replace(/<script[^>]*>[\s\S]*?<\/script>/ig,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/ig,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/ig,"").replace(/<xml>[\s\S]*?<\/xml>/ig,"").replace(/<(?:table|td)[^>]*>/ig,function(e){return e.replace(/border-bottom:([#\w\s]+)/ig,"border:$1")}),_formatHtml(e,t)}function _mediaType(e){return/\.(rm|rmvb)(\?|$)/i.test(e)?"audio/x-pn-realaudio-plugin":/\.(swf|flv)(\?|$)/i.test(e)?"application/x-shockwave-flash":"video/x-ms-asf-plugin"}function _mediaClass(e){return/realaudio/i.test(e)?"ke-rm":/flash/i.test(e)?"ke-flash":"ke-media"}function _mediaAttrs(e){return _getAttrList(unescape(e))}function _mediaEmbed(e){var t="<embed ";return _each(e,function(e,n){t+=e+'="'+n+'" '}),t+="/>",t}function _mediaImg(e,t){var n=t.width,r=t.height,i=t.type||_mediaType(t.src),s=_mediaEmbed(t),o="";n>0&&(o+="width:"+n+"px;"),r>0&&(o+="height:"+r+"px;");var u='<img class="'+_mediaClass(i)+'" src="'+e+'" ';return o!==""&&(u+='style="'+o+'" '),u+='data-ke-tag="'+escape(s)+'" alt="" />',u}function _tmpl(e,t){var n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return t?n(t):n}function _contains(e,t){if(e.nodeType==9&&t.nodeType!=9)return!0;while(t=t.parentNode)if(t==e)return!0;return!1}function _getAttr(e,t){t=t.toLowerCase();var n=null;if(!_GET_SET_ATTRIBUTE&&e.nodeName.toLowerCase()!="script"){var r=e.ownerDocument.createElement("div");r.appendChild(e.cloneNode(!1));var i=_getAttrList(_unescape(r.innerHTML));t in i&&(n=i[t])}else if(e.getAttribute)try{n=e.getAttribute(t,2)}catch(s){n=e.getAttribute(t,1)}return t==="style"&&n!==null&&(n=_formatCss(n)),n}function _queryAll(e,t){function i(e){return typeof e!="string"?e:e.replace(/([^\w\-])/g,"\\$1")}function s(e){return e.replace(/\\/g,"")}function o(e,t){return e==="*"||e.toLowerCase()===i(t.toLowerCase())}function u(e,t,n){var r=[],i=n.ownerDocument||n,u=i.getElementById(s(e));return u&&o(t,u.nodeName)&&_contains(n,u)&&r.push(u),r}function a(e,t,n){var r=n.ownerDocument||n,i=[],u,a,f,l;if(n.getElementsByClassName){u=n.getElementsByClassName(s(e));for(a=0,f=u.length;a<f;a++)l=u[a],o(t,l.nodeName)&&i.push(l)}else if(r.querySelectorAll){u=r.querySelectorAll((n.nodeName!=="#document"?n.nodeName+" ":"")+t+"."+e);for(a=0,f=u.length;a<f;a++)l=u[a],_contains(n,l)&&i.push(l)}else{u=n.getElementsByTagName(t),e=" "+e+" ";for(a=0,f=u.length;a<f;a++){l=u[a];if(l.nodeType==1){var c=l.className;c&&(" "+c+" ").indexOf(e)>-1&&i.push(l)}}}return i}function f(e,t,n){var r=[],i=n.ownerDocument||n,u=i.getElementsByName(s(e)),a;for(var f=0,l=u.length;f<l;f++)a=u[f],o(t,a.nodeName)&&_contains(n,a)&&a.getAttributeNode("name")&&r.push(a);return r}function l(e,t,n,r){var s=[],o=r.getElementsByTagName(n),u;for(var a=0,f=o.length;a<f;a++)u=o[a],u.nodeType==1&&(t===null?_getAttr(u,e)!==null&&s.push(u):t===i(_getAttr(u,e))&&s.push(u));return s}function c(e,t){var n=[],r;r=/^((?:\\.|[^.#\s\[<>])+)/.exec(e);var i=r?r[1]:"*";if(r=/#((?:[\w\-]|\\.)+)$/.exec(e))n=u(r[1],i,t);else if(r=/\.((?:[\w\-]|\\.)+)$/.exec(e))n=a(r[1],i,t);else if(r=/\[((?:[\w\-]|\\.)+)\]/.exec(e))n=l(r[1].toLowerCase(),null,i,t);else if(r=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(e)){var s=r[1].toLowerCase(),o=r[2];s==="id"?n=u(o,i,t):s==="class"?n=a(o,i,t):s==="name"?n=f(o,i,t):n=l(s,o,i,t)}else{var c=t.getElementsByTagName(i),h;for(var p=0,d=c.length;p<d;p++)h=c[p],h.nodeType==1&&n.push(h)}return n}var n=e.split(",");if(n.length>1){var r=[];return _each(n,function(){_each(_queryAll(this,t),function(){_inArray(this,r)<0&&r.push(this)})}),r}t=t||document;var h=[],p,d=/((?:\\.|[^\s>])+|[\s>])/g;while(p=d.exec(e))p[1]!==" "&&h.push(p[1]);var v=[];if(h.length==1)return c(h[0],t);var m=!1,g,y,b,w,E,S,x,T,N,C,k;for(S=0,lenth=h.length;S<lenth;S++){g=h[S];if(g===">"){m=!0;continue}if(S>0){y=[];for(x=0,C=v.length;x<C;x++){w=v[x],b=c(g,w);for(T=0,k=b.length;T<k;T++)E=b[T],m?w===E.parentNode&&y.push(E):y.push(E)}v=y}else v=c(g,t);if(v.length===0)return[]}return v}function _query(e,t){var n=_queryAll(e,t);return n.length>0?n[0]:null}function _get(e){return K(e)[0]}function _getDoc(e){return e?e.ownerDocument||e.document||e:document}function _getWin(e){if(!e)return window;var t=_getDoc(e);return t.parentWindow||t.defaultView}function _setHtml(e,t){if(e.nodeType!=1)return;var n=_getDoc(e);try{e.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var r=n.getElementById("__kindeditor_temp_tag__");r.parentNode.removeChild(r)}catch(i){K(e).empty(),K("@"+t,n).each(function(){e.appendChild(this)})}}function _hasClass(e,t){return _inString(t,e.className," ")}function _setAttr(e,t,n){_IE&&_V<8&&t.toLowerCase()=="class"&&(t="className"),e.setAttribute(t,""+n)}function _removeAttr(e,t){_IE&&_V<8&&t.toLowerCase()=="class"&&(t="className"),_setAttr(e,t,""),e.removeAttribute(t)}function _getNodeName(e){return!e||!e.nodeName?"":e.nodeName.toLowerCase()}function _computedCss(e,t){var n=this,r=_getWin(e),i=_toCamel(t),s="";if(r.getComputedStyle){var o=r.getComputedStyle(e,null);s=o[i]||o.getPropertyValue(t)||e.style[i]}else e.currentStyle&&(s=e.currentStyle[i]||e.style[i]);return s}function _hasVal(e){return!!_VALUE_TAG_MAP[_getNodeName(e)]}function _docElement(e){return e=e||document,_QUIRKS?e.body:e.documentElement}function _docHeight(e){var t=_docElement(e);return Math.max(t.scrollHeight,t.clientHeight)}function _docWidth(e){var t=_docElement(e);return Math.max(t.scrollWidth,t.clientWidth)}function _getScrollPos(e){e=e||document;var t,n;return _IE||_OPERA?(t=_docElement(e).scrollLeft,n=_docElement(e).scrollTop):(t=_getWin(e).scrollX,n=_getWin(e).scrollY),{x:t,y:n}}function KNode(e){this.init(e)}function _updateCollapsed(e){return e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e}function _copyAndDelete(e,t,n){function s(r,s,o){var u=r.nodeValue.length,a;if(t){var f=r.cloneNode(!0);s>0?a=f.splitText(s):a=f,o<u&&a.splitText(o-s)}if(n){var l=r;s>0&&(l=r.splitText(s),e.setStart(r,s));if(o<u){var c=l.splitText(o-s);e.setEnd(c,0)}i.push(l)}return a}function o(){n&&e.up().collapse(!0);for(var t=0,r=i.length;t<r;t++){var s=i[t];s.parentNode&&s.parentNode.removeChild(s)}}function v(o,h){var p=o.firstChild,d;while(p){var m=(new KRange(r)).selectNode(p);a=m.compareBoundaryPoints(_START_TO_END,e),a>=0&&f<=0&&(f=m.compareBoundaryPoints(_START_TO_START,e)),f>=0&&l<=0&&(l=m.compareBoundaryPoints(_END_TO_END,e)),l>=0&&c<=0&&(c=m.compareBoundaryPoints(_END_TO_START,e));if(c>=0)return!1;d=p.nextSibling;if(a>0)if(p.nodeType==1)if(f>=0&&l<=0)t&&h.appendChild(p.cloneNode(!0)),n&&i.push(p);else{var g;t&&(g=p.cloneNode(!1),h.appendChild(g));if(v(p,g)===!1)return!1}else if(p.nodeType==3){var y;p==u.startContainer?y=s(p,u.startOffset,p.nodeValue.length):p==u.endContainer?y=s(p,0,u.endOffset):y=s(p,0,p.nodeValue.length);if(t)try{h.appendChild(y)}catch(b){}}p=d}}var r=e.doc,i=[],u=e.cloneRange().down(),a=-1,f=-1,l=-1,c=-1,h=e.commonAncestor(),p=r.createDocumentFragment();if(h.nodeType==3){var d=s(h,e.startOffset,e.endOffset);return t&&p.appendChild(d),o(),t?p:e}v(h,p),n&&e.up().collapse(!0);for(var m=0,g=i.length;m<g;m++){var y=i[m];y.parentNode&&y.parentNode.removeChild(y)}return t?p:e}function _moveToElementText(e,t){var n=t;while(n){var r=K(n);if(r.name=="marquee"||r.name=="select")return;n=n.parentNode}try{e.moveToElementText(t)}catch(i){}}function _getStartEnd(e,t){var n=e.parentElement().ownerDocument,r=e.duplicate();r.collapse(t);var i=r.parentElement(),s=i.childNodes;if(s.length===0)return{node:i.parentNode,offset:K(i).index()};var o=n,u=0,a=-1,f=e.duplicate();_moveToElementText(f,i);for(var l=0,c=s.length;l<c;l++){var h=s[l];a=f.compareEndPoints("StartToStart",r);if(a===0)return{node:h.parentNode,offset:l};if(h.nodeType==1){var p=e.duplicate(),d,v=K(h),m=h;v.isControl()&&(d=n.createElement("span"),v.after(d),m=d,u+=v.text().replace(/\r\n|\n|\r/g,"").length),_moveToElementText(p,m),f.setEndPoint("StartToEnd",p),a>0?u+=p.text.replace(/\r\n|\n|\r/g,"").length:u=0,d&&K(d).remove()}else h.nodeType==3&&(f.moveStart("character",h.nodeValue.length),u+=h.nodeValue.length);a<0&&(o=h)}if(a<0&&o.nodeType==1)return{node:i,offset:K(i.lastChild).index()+1};if(a>0)while(o.nextSibling&&o.nodeType==1)o=o.nextSibling;f=e.duplicate(),_moveToElementText(f,i),f.setEndPoint("StartToEnd",r),u-=f.text.replace(/\r\n|\n|\r/g,"").length;if(a>0&&o.nodeType==3){var g=o.previousSibling;while(g&&g.nodeType==3)u-=g.nodeValue.length,g=g.previousSibling}return{node:o,offset:u}}function _getEndRange(e,t){var n=e.ownerDocument||e,r=n.body.createTextRange();if(n==e)return r.collapse(!0),r;if(e.nodeType==1&&e.childNodes.length>0){var i=e.childNodes,s,o;t===0?(o=i[0],s=!0):(o=i[t-1],s=!1);if(!o)return r;if(K(o).name==="head")return t===1&&(s=!0),t===2&&(s=!1),r.collapse(s),r;if(o.nodeType==1){var u=K(o),a;return u.isControl()&&(a=n.createElement("span"),s?u.before(a):u.after(a),o=a),_moveToElementText(r,o),r.collapse(s),a&&K(a).remove(),r}e=o,t=s?0:o.nodeValue.length}var f=n.createElement("span");return K(e).before(f),_moveToElementText(r,f),r.moveStart("character",t),K(f).remove(),r}function _toRange(e){function r(e){K(e.node).name=="tr"&&(e.node=e.node.cells[e.offset],e.offset=0)}var t,n;if(_IE){if(e.item)return t=_getDoc(e.item(0)),n=new KRange(t),n.selectNode(e.item(0)),n;t=e.parentElement().ownerDocument;var i=_getStartEnd(e,!0),s=_getStartEnd(e,!1);return r(i),r(s),n=new KRange(t),n.setStart(i.node,i.offset),n.setEnd(s.node,s.offset),n}var o=e.startContainer;return t=o.ownerDocument||o,n=new KRange(t),n.setStart(o,e.startOffset),n.setEnd(e.endContainer,e.endOffset),n}function KRange(e){this.init(e)}function _range(e){return e.nodeName?new KRange(e):e.constructor===KRange?e:_toRange(e)}function _nativeCommand(e,t,n){try{e.execCommand(t,!1,n)}catch(r){}}function _nativeCommandValue(e,t){var n="";try{n=e.queryCommandValue(t)}catch(r){}return typeof n!="string"&&(n=""),n}function _getSel(e){var t=_getWin(e);return e.selection||t.getSelection()}function _getRng(e){var t=_getSel(e),n;try{t.rangeCount>0?n=t.getRangeAt(0):n=t.createRange()}catch(r){}return _IE&&(!n||!n.item&&n.parentElement().ownerDocument!==e)?null:n}function _singleKeyMap(e){var t={},n,r;return _each(e,function(e,i){n=e.split(",");for(var s=0,o=n.length;s<o;s++)r=n[s],t[r]=i}),t}function _hasAttrOrCss(e,t){return _hasAttrOrCssByKey(e,t,"*")||_hasAttrOrCssByKey(e,t)}function _hasAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1)return!1;var r=_singleKeyMap(t);if(!r[n])return!1;var i=r[n].split(",");for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u==="*")return!0;var a=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(u),f=a[1]?"css":"attr";u=a[2];var l=a[3]||"";if(l===""&&e[f](u)!=="")return!0;if(l!==""&&e[f](u)===l)return!0}return!1}function _removeAttrOrCss(e,t){if(e.type!=1)return;_removeAttrOrCssByKey(e,t,"*"),_removeAttrOrCssByKey(e,t)}function _removeAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1)return;var r=_singleKeyMap(t);if(!r[n])return;var i=r[n].split(","),s=!1;for(var o=0,u=i.length;o<u;o++){var a=i[o];if(a==="*"){s=!0;break}var f=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(a);a=f[2],f[1]?(a=_toCamel(a),e[0].style[a]&&(e[0].style[a]="")):e.removeAttr(a)}s&&e.remove(!0)}function _getInnerNode(e){var t=e;while(t.first())t=t.first();return t}function _isEmptyNode(e){return e.type==1&&e.html().replace(/<[^>]+>/g,"")===""}function _mergeWrapper(e,t){e=e.clone(!0);var n=_getInnerNode(e),r=e,i=!1;while(t){while(r)r.name===t.name&&(_mergeAttrs(r,t.attr(),t.css()),i=!0),r=r.first();i||n.append(t.clone(!1)),i=!1,t=t.first()}return e}function _wrapNode(e,t){t=t.clone(!0);if(e.type==3)return _getInnerNode(t).append(e.clone(!1)),e.replaceWith(t),t;var n=e,r;while((r=e.first())&&r.children().length==1)e=r;r=e.first();var i=e.doc.createDocumentFragment();while(r)i.appendChild(r[0]),r=r.next();return t=_mergeWrapper(n,t),i.firstChild&&_getInnerNode(t).append(i),n.replaceWith(t),t}function _mergeAttrs(e,t,n){_each(t,function(t,n){t!=="style"&&e.attr(t,n)}),_each(n,function(t,n){e.css(t,n)})}function _inPreElement(e){while(e&&e.name!="body"){if(_PRE_TAG_MAP[e.name]||e.name=="div"&&e.hasClass("ke-script"))return!0;e=e.parent()}return!1}function KCmd(e){this.init(e)}function _cmd(e){if(e.nodeName){var t=_getDoc(e);e=_range(t).selectNodeContents(t.body).collapse(!1)}return new KCmd(e)}function _drag(e){var t=e.moveEl,n=e.moveFn,r=e.clickEl||t,i=e.beforeDrag,s=e.iframeFix===undefined?!0:e.iframeFix,o=[document];s&&K("iframe").each(function(){var e=_formatUrl(this.src||"","absolute");if(/^https?:\/\//.test(e))return;var t;try{t=_iframeDoc(this)}catch(n){}if(t){var r=K(this).pos();K(t).data("pos-x",r.x),K(t).data("pos-y",r.y),o.push(t)}}),r.mousedown(function(e){function p(e){e.preventDefault();var t=K(_getDoc(e.target)),i=_round((t.data("pos-x")||0)+e.pageX-c),s=_round((t.data("pos-y")||0)+e.pageY-h);n.call(r,u,a,f,l,i,s)}function d(e){e.preventDefault()}function v(e){e.preventDefault(),K(o).unbind("mousemove",p).unbind("mouseup",v).unbind("selectstart",d),s.releaseCapture&&s.releaseCapture()}e.stopPropagation();var s=r.get(),u=_removeUnit(t.css("left")),a=_removeUnit(t.css("top")),f=t.width(),l=t.height(),c=e.pageX,h=e.pageY;i&&i(),K(o).mousemove(p).mouseup(v).bind("selectstart",d),s.setCapture&&s.setCapture()})}function KWidget(e){this.init(e)}function _widget(e){return new KWidget(e)}function _iframeDoc(e){return e=_get(e),e.contentDocument||e.contentWindow.document}function _getInitHtml(e,t,n,r){var i=[_direction===""?"<html>":'<html dir="'+_direction+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrap: break-word;}",'body {font-family: "FAE8F6F96C59ED1", Tahoma, Verdana, sans-serif, STHeiTi;}',"p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","li {list-style-image: none; list-style-type: none;}","a {color: #4694A9;}","a:hover {color: #00ccff;}","body, h1, h2, h3, h4, h5, h6, hr, p, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, th, td {margin: 0; padding: 0;}","img.ke-flash {","	border:1px solid #AAA;","	background-image:url("+e+"common/flash.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-rm {","	border:1px solid #AAA;","	background-image:url("+e+"common/rm.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-media {","	border:1px solid #AAA;","	background-image:url("+e+"common/media.gif);","	background-position:center center;","	background-repeat:no-repeat;","	width:100px;","	height:100px;","}","img.ke-anchor {","	border:1px dashed #666;","	width:16px;","	height:16px;","}",".ke-script, .ke-noscript {","	display:none;","	font-size:0;","	width:0;","	height:0;","}",".ke-pagebreak {","	border:1px dotted #AAA;","	font-size:0;","	height:2px;","}","</style>"];return _isArray(n)||(n=[n]),_each(n,function(e,t){t&&i.push('<link href="'+t+'" rel="stylesheet" />')}),r&&i.push("<style>"+r+"</style>"),i.push("</head><body "+(t?'class="'+t+'"':"")+"></body></html>"),i.join("\n")}function _elementVal(e,t){if(e.hasVal()){if(t===undefined){var n=e.val();return n=n.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/ig,""),n}return e.val(t)}return e.html(t)}function KEdit(e){this.init(e)}function _edit(e){return new KEdit(e)}function _selectToolbar(e,t){var n=this,r=n.get(e);if(r){if(r.hasClass("ke-disabled"))return;t(r)}}function KToolbar(e){this.init(e)}function _toolbar(e){return new KToolbar(e)}function KMenu(e){this.init(e)}function _menu(e){return new KMenu(e)}function KColorPicker(e){this.init(e)}function _colorpicker(e){return new KColorPicker(e)}function KUploadButton(e){this.init(e)}function _uploadbutton(e){return new KUploadButton(e)}function _createButton(e){e=e||{};var t=e.name||"",n=K('<span class="ke-button-common ke-button-outer" title="'+t+'"></span>'),r=K('<input class="ke-button-common ke-button" type="button" value="'+t+'" />');return e.click&&r.click(e.click),n.append(r),n}function KDialog(e){this.init(e)}function _dialog(e){return new KDialog(e)}function _tabs(e){var t=_widget(e),n=t.remove,r=e.afterSelect,i=t.div,s=[];i.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()});var o=K('<ul class="ke-tabs-ul ke-clearfix"></ul>');return i.append(o),t.add=function(e){var t=K('<li class="ke-tabs-li">'+e.title+"</li>");t.data("tab",e),s.push(t),o.append(t)},t.selectedIndex=0,t.select=function(e){t.selectedIndex=e,_each(s,function(n,r){r.unbind(),n===e?(r.addClass("ke-tabs-li-selected"),K(r.data("tab").panel).show("")):(r.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){K(this).addClass("ke-tabs-li-on")}).mouseout(function(){K(this).removeClass("ke-tabs-li-on")}).click(function(){t.select(n)}),K(r.data("tab").panel).hide())}),r&&r.call(t,e)},t.remove=function(){_each(s,function(){this.remove()}),o.remove(),n.call(t)},t}function _loadScript(e,t){var n=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),r=document.createElement("script");n.appendChild(r),r.src=e,r.charset="utf-8",r.onload=r.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded")t&&t(),r.onload=r.onreadystatechange=null,n.removeChild(r)}}function _chopQuery(e){var t=e.indexOf("?");return t>0?e.substr(0,t):e}function _loadStyle(e){var t=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),n=document.createElement("link"),r=_chopQuery(_formatUrl(e,"absolute")),i=K('link[rel="stylesheet"]',t);for(var s=0,o=i.length;s<o;s++)if(_chopQuery(_formatUrl(i[s].href,"absolute"))===r)return;t.appendChild(n),n.href=e,n.rel="stylesheet"}function _ajax(e,t,n,r,i){n=n||"GET",i=i||"json";var s=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");s.open(n,e,!0),s.onreadystatechange=function(){if(s.readyState==4&&s.status==200&&t){var e=_trim(s.responseText);i=="json"&&(e=_json(e)),t(e)}};if(n=="POST"){var o=[];_each(r,function(e,t){o.push(encodeURIComponent(e)+"="+encodeURIComponent(t))});try{s.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(u){}s.send(o.join("&"))}else s.send(null)}function _plugin(e,t){if(e===undefined)return _plugins;if(!t)return _plugins[e];_plugins[e]=t}function _parseLangKey(e){var t,n="core";if(t=/^(\w+)\.(\w+)$/.exec(e))n=t[1],e=t[2];return{ns:n,key:e}}function _lang(e,t){t=t===undefined?K.options.langType:t;if(typeof e=="string"){if(!_language[t])return"no language";var n=e.length-1;if(e.substr(n)===".")return _language[t][e.substr(0,n)];var r=_parseLangKey(e);return _language[t][r.ns][r.key]}_each(e,function(e,n){var r=_parseLangKey(e);_language[t]||(_language[t]={}),_language[t][r.ns]||(_language[t][r.ns]={}),_language[t][r.ns][r.key]=n})}function _getImageFromRange(e,t){if(e.collapsed)return;e=e.cloneRange().up();var n=e.startContainer,r=e.startOffset;if(!_WEBKIT&&!e.isControl())return;var i=K(n.childNodes[r]);if(!i||i.name!="img")return;if(t(i))return i}function _bindContextmenuEvent(){var e=this,t=e.edit.doc;K(t).contextmenu(function(t){e.menu&&e.hideMenu();if(!e.useContextmenu){t.preventDefault();return}if(e._contextmenus.length===0)return;var n=0,r=[];_each(e._contextmenus,function(){if(this.title=="-"){r.push(this);return}this.cond&&this.cond()&&(r.push(this),this.width&&this.width>n&&(n=this.width))});while(r.length>0&&r[0].title=="-")r.shift();while(r.length>0&&r[r.length-1].title=="-")r.pop();var i=null;_each(r,function(e){this.title=="-"&&i.title=="-"&&delete r[e],i=this});if(r.length>0){t.preventDefault();var s=K(e.edit.iframe).pos(),o=_menu({x:s.x+t.clientX,y:s.y+t.clientY,width:n,css:{visibility:"hidden"},shadowMode:e.shadowMode});_each(r,function(){this.title&&o.addItem(this)});var u=_docElement(o.doc),a=o.div.height();t.clientY+a>=u.clientHeight-100&&o.pos(o.x,_removeUnit(o.y)-a),o.div.css("visibility","visible"),e.menu=o}})}function _bindNewlineEvent(){function s(e){var t=K(e.commonAncestor());while(t){if(t.type==1&&!t.isStyle())break;t=t.parent()}return t.name}var e=this,t=e.edit.doc,n=e.newlineTag;if(_IE&&n!=="br")return;if(_GECKO&&_V<3&&n!=="p")return;if(_OPERA&&_V<9)return;var r=_toMap("h1,h2,h3,h4,h5,h6,pre,li"),i=_toMap("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote");K(t).keydown(function(o){if(o.which!=13||o.shiftKey||o.ctrlKey||o.altKey)return;e.cmd.selection();var u=s(e.cmd.range);if(u=="marquee"||u=="select")return;if(n==="br"&&!r[u]){o.preventDefault(),e.insertHtml("<br />"+(_IE&&_V<9?"":"​"));return}i[u]||_nativeCommand(t,"formatblock","<p>")}),K(t).keyup(function(r){var o=K("body",t).html();o===""&&K("body",t).html('<p data-flag="normal" style="'+_NORMAL_FORMAT+'" lang="en"><br></p>');var u=e.cmd.commonAncestor("font");if(u&&u[0]){var a=e.cmd.select().range,f=u[0].innerHTML,l='<strong data-falg="strong" style="'+_STRONG_FORMAT+'">'+f+"</strong>",c=K(u[0]).replaceWith(l);a.selectNodeContents(c[0]),a.collapse(!1),e.select(!0)}var h=e.cmd.range.startContainer.childNodes;if(h&&h.length>1){var p=!1;K.each(h,function(e,t){K(t).isBlock()&&(p=!0)}),p&&K.each(h,function(e,t){if(!K(t).isBlock()){var n=K(t).outer(),r='<p style="'+_NORMAL_FORMAT+'" data-falg="normal" lang="en">'+n+"</p>";K(t).text()&&K(t).replaceWith(r)}})}if(r.which!=13||r.shiftKey||r.ctrlKey||r.altKey)return;if(n=="br")return;if(_GECKO){var d=e.cmd.commonAncestor("p"),v=e.cmd.commonAncestor("a");v.text()==""&&(v.remove(!0),e.cmd.range.selectNodeContents(d[0]).collapse(!0),e.cmd.select());return}e.cmd.selection();var m=s(e.cmd.range);if(m=="marquee"||m=="select")return;i[m]||_nativeCommand(t,"formatblock","<p>");var g=e.cmd.commonAncestor("div");if(g){var y=K('<p data-flag="normal" style="'+_NORMAL_FORMAT+'" lang="en"></p>'),b=g[0].firstChild;while(b){var w=b.nextSibling;y.append(b),b=w}g.before(y),g.remove(),e.cmd.range.selectNodeContents(y[0]),e.cmd.select()}var y=e.cmd.commonAncestor("p");y&&y[0]&&(y[0].getAttribute("flag")||(y[0].style.cssText=_NORMAL_FORMAT,y[0].setAttribute("flag","normal"),y[0].setAttribute("lang","en"),K("span,p",y).each(function(){this.style.cssText=_NORMAL_FORMAT})))})}function _bindTabEvent(){var e=this,t=e.edit.doc;K(t).keydown(function(n){if(n.which==9){n.preventDefault();if(e.afterTab){e.afterTab.call(e,n);return}var r=e.cmd,i=r.range;i.shrink(),i.collapsed&&i.startContainer.nodeType==1&&(i.insertNode(K("@&nbsp;",t)[0]),r.select()),e.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function _bindFocusEvent(){var e=this;K(e.edit.textarea[0],e.edit.win).focus(function(t){e.afterFocus&&e.afterFocus.call(e,t)}).blur(function(t){e.afterBlur&&e.afterBlur.call(e,t)})}function _removeBookmarkTag(e){return _trim(e.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/ig,""))}function _removeTempTag(e){return e.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/ig,"")}function _addBookmarkToStack(e,t){if(e.length===0){e.push(t);return}var n=e[e.length-1];_removeBookmarkTag(t.html)!==_removeBookmarkTag(n.html)&&e.push(t)}function _undoToRedo(e,t){var n=this,r=n.edit,i=r.doc.body,s,o;if(e.length===0)return n;r.designMode?(s=n.cmd.range,o=s.createBookmark(!0),o.html=i.innerHTML):o={html:i.innerHTML},_addBookmarkToStack(t,o);var u=e.pop();return _removeBookmarkTag(o.html)===_removeBookmarkTag(u.html)&&e.length>0&&(u=e.pop()),r.designMode?(r.html(u.html),u.start&&(s.moveToBookmark(u),n.select())):K(i).html(_removeBookmarkTag(u.html)),n}function KEditor(e){function n(e,n){KEditor.prototype[e]===undefined&&(t[e]=n),t.options[e]=n}var t=this;t.options={},_each(e,function(t,r){n(t,e[t])}),_each(K.options,function(e,r){t[e]===undefined&&n(e,r)});var r=K(t.srcElement||"<textarea/>");t.width||(t.width=r[0].style.width||r.width()),t.height||(t.height=r[0].style.height||r.height()),n("width",_undef(t.width,t.minWidth)),n("height",_undef(t.height,t.minHeight)),n("width",_addUnit(t.width)),n("height",_addUnit(t.height)),_MOBILE&&(!_IOS||_V<534)&&(t.designMode=!1),t.srcElement=r,t.initContent="",t.plugin={},t.isCreated=!1,t.isLoading=!1,t._handlers={},t._contextmenus=[],t._undoStack=[],t._redoStack=[],t._calledPlugins={},t._firstAddBookmark=!0,t.menu=t.contextmenu=null,t.dialogs=[]}function _editor(e){return new KEditor(e)}function _create(e,t){function r(e){return _each(_plugins,function(t,n){n.call(e,KindEditor)}),e.create()}t=t||{},t.basePath=_undef(t.basePath,K.basePath),t.themesPath=_undef(t.themesPath,t.basePath+"themes/"),t.langPath=_undef(t.langPath,t.basePath+"lang/"),t.pluginsPath=_undef(t.pluginsPath,t.basePath+"plugins/");if(_undef(t.loadStyleMode,K.options.loadStyleMode))var n=_undef(t.themeType,K.options.themeType);var i=K(e);if(!i||i.length===0)return;if(i.length>1)return i.each(function(){_create(this,t)}),_instances[0];t.srcElement=i[0];var s=new KEditor(t);return _instances.push(s),_language[s.langType]?r(s):(_loadScript(s.langPath+s.langType+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){r(s)}),s)}function _eachEditor(e,t){K(e).each(function(e,n){K.each(_instances,function(e,r){if(r&&r.srcElement[0]==n)return t.call(r,e,r),!1})})}function initVCodeImg(){function s(n,r,i){e.ajax("/xmcaptcha-service/getCaptcha/ts-123?captchaInfo="+n+"&captchaId="+r+"&version="+i,function(n){window.vCodeToken=n.token,t=n.background,e("#img_vcode_image").attr("src","/xmcaptcha-service"+t)})}function o(){e("#img_vcode").hide(),e("#img_vcode_submit").html("确定"),e("#img_vcode_new_image").html("换一张"),e("#img_vcode_input").val(""),clearInterval(i),n=0,r=!0,t="",window.vCodeToken=""}var e=K,t="",n=0,r=!0,i,u={callModal:function(t){var n=t.captchaInfo,r=t.version,i=t.captchaId;if(e("#img_vcode").length===0){var u='<div><style>#img_vcode_input::-webkit-input-placeholder{font-size: 18px; text-align: center}#img_vcode_input:-moz-placeholder{font-size: 18px; text-align: center}#img_vcode_input::-moz-placeholder{font-size: 18px; text-align: center}#img_vcode_input:-ms-input-placeholder{font-size: 18px; text-align: center}</style><div id="img_vcode" style="position: fixed;z-index: 1500;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0,0,0,0.5);"><div style="position: absolute;top: 0;bottom: 0;left: 0;right: 0;margin: auto;height: 257px;width: 330px;background: white;box-sizing: border-box;border-top: 5px solid #F86442;border-image: linear-gradient(90deg, #FC9D77 0%, #F86442 100%) 30 30;padding: 0 40px;"> <div style="font-family: PingFangSC-Medium;font-size: 18px;color: #333333;letter-spacing: 1.5px;padding: 15px 0 20px;text-align: center">验证码</div><div><input id="img_vcode_input" style="font-size: 18px;border: 1px solid #e1e1e1;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;width: 250px;line-height: 44px;text-align:center;padding: 0;" placeholder="请输入验证码" type="text"/></div><div style="padding-top: 20px;-webkit-touch-callout: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;"><img id="img_vcode_image" src="" style="-webkit-touch-callout: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;height: 42px;width: 134px;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;border: 1px solid #e1e1e1;"><span id="img_vcode_new_image" style="-webkit-touch-callout: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;display: inline-block;vertical-align: middle;text-align: center;margin-left: 18px;height: 42px;width:94px;line-height: 42px;font-size: 18px;color: #F86442;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;border: 1px solid #F86442;cursor: pointer">换一张</span></div><div style="padding-top: 20px;"><button id="img_vcode_close" style="width: 110px;border: 1px solid #e1e1e1;line-height: 42px;padding: 0;margin-right: 30px;font-size: 18px;color: #666666;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;">取消</button><button id="img_vcode_submit" style="width: 110px;line-height: 42px;padding: 0;font-size: 18px;color: white;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;background-image: linear-gradient(90deg, #FF9973 1%, #F86442 95%);">确认</button></div></div></div>';e("#mainbox").append(u),e("#img_vcode").bind("click",function(e){if(e.target.id!=="img_vcode")return;o(),alert("上传失败")}),e("#img_vcode_close").bind("click",function(e){o(),alert("上传失败")}),e("#img_vcode_new_image").bind("click",function(){s(n,i,r)}),e("#img_vcode_submit").bind("click",function(){if(e("#img_vcode_submit").html()==="校验中..."||!e("#img_vcode_input").val())return;e("#img_vcode_submit").html("校验中..."),e.ajax("/xmcaptcha-service/checkCaptcha/ts-123?token="+window.vCodeToken+"&checkCode="+e("#img_vcode_input").val(),function(t){var u;try{u=JSON.parse(t)}catch(a){u=t}if(u.ret===0&&u.result)alert("校验通过，请重新上传"),o();else{s(n,i,r),e("#img_vcode_submit").html("确认");var f=u.error||u.msg;alert(f)}})})}else e("#img_vcode").show();s(n,i,r)}};return u}if(window.KindEditor)return;window.console||(window.console={}),console.log||(console.log=function(){});var _VERSION="4.1.4 (2017-06-21)",_ua=navigator.userAgent.toLowerCase(),_IE=_ua.indexOf("msie")>-1&&_ua.indexOf("opera")==-1,_GECKO=_ua.indexOf("gecko")>-1&&_ua.indexOf("khtml")==-1,_WEBKIT=_ua.indexOf("applewebkit")>-1,_OPERA=_ua.indexOf("opera")>-1,_MOBILE=_ua.indexOf("mobile")>-1,_IOS=/ipad|iphone|ipod/.test(_ua),_QUIRKS=document.compatMode!="CSS1Compat",_matches=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(_ua),_V=_matches?_matches[1]:"0",_TIME=(new Date).getTime(),_SUBTITLE_FORMAT="font-size: 17px; color: rgb(51, 51, 51); line-height: 30px;margin:10px 0px;font-weight: 900;",_NORMAL_FORMAT="font-size:16px;color:#333333;line-height:30px;font-family:Helvetica,Arial,sans-serif;font-weight:normal;text-align:justify;hyphens:auto;",_STRONG_FORMAT="color:#FC5832;word-break:break-all;font-family:Helvetica,Arial,sans-serif;font-weight: normal;",BLOCKQUOTE_STYLE="margin: 10px 0px; border-left: 5px solid rgb(232, 232, 232); padding-left: 15px; font-size: 14px; color: rgb(102, 102, 102);font-weight:normal;",_round=Math.round,K={DEBUG:!1,VERSION:_VERSION,IE:_IE,GECKO:_GECKO,WEBKIT:_WEBKIT,OPERA:_OPERA,V:_V,TIME:_TIME,each:_each,isArray:_isArray,isFunction:_isFunction,inArray:_inArray,inString:_inString,trim:_trim,addUnit:_addUnit,removeUnit:_removeUnit,escape:_escape,unescape:_unescape,toCamel:_toCamel,toHex:_toHex,toMap:_toMap,toArray:_toArray,undef:_undef,invalidUrl:_invalidUrl,addParam:_addParam,extend:_extend,json:_json},_INLINE_TAG_MAP=_toMap("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),_BLOCK_TAG_MAP=_toMap("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),_SINGLE_TAG_MAP=_toMap("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),_STYLE_TAG_MAP=_toMap("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),_CONTROL_TAG_MAP=_toMap("img,table,input,textarea,button"),_PRE_TAG_MAP=_toMap("pre,style,script"),_NOSPLIT_TAG_MAP=_toMap("html,head,body,td,tr,table,ol,ul,li"),_AUTOCLOSE_TAG_MAP=_toMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),_FILL_ATTR_MAP=_toMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),_VALUE_TAG_MAP=_toMap("input,button,textarea,select");K.basePath=_getBasePath(),K.options={designMode:!0,fullscreenMode:!1,filterMode:!0,wellFormatMode:!0,shadowMode:!0,loadStyleMode:!0,basePath:K.basePath,themesPath:K.basePath+"themes/",langPath:K.basePath+"lang/",pluginsPath:K.basePath+"plugins/",themeType:"default",langType:"zh_CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:!0,fullscreenShortcut:!1,bodyClass:"ke-content",indentChar:"	",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height",".padding",".margin","display"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"]},pasteFilteTags:{span:[],p:["data-flag","style","lang"],hr:["id","class",".page-break-after"],img:["id","class","src","width","height","data-origin","data-large","data-large-width","data-large-height","data-preview","data-preview-width","data-preview-height","border","alt","title","align",".width",".height",".border"],"br,li,ul,ol,b,strong,blockquote,tr":[],a:["id","class","href","target","name"],"h1,h2,h3,h4,h5,h6":[]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'};var _useCapture=!1,_INPUT_KEY_MAP=_toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),_CURSORMOVE_KEY_MAP=_toMap("33..40"),_CHANGE_KEY_MAP={};_each(_INPUT_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t}),_each(_CURSORMOVE_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});var _EVENT_PROPS="altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which".split(",");_extend(KEvent,{init:function(e,t){var n=this,r=e.ownerDocument||e.document||e;n.event=t,_each(_EVENT_PROPS,function(e,r){n[r]=t[r]}),n.target||(n.target=n.srcElement||r),n.target.nodeType===3&&(n.target=n.target.parentNode),!n.relatedTarget&&n.fromElement&&(n.relatedTarget=n.fromElement===n.target?n.toElement:n.fromElement);if(n.pageX==null&&n.clientX!=null){var i=r.documentElement,s=r.body;n.pageX=n.clientX+(i&&i.scrollLeft||s&&s.scrollLeft||0)-(i&&i.clientLeft||s&&s.clientLeft||0),n.pageY=n.clientY+(i&&i.scrollTop||s&&s.scrollTop||0)-(i&&i.clientTop||s&&s.clientTop||0)}!n.which&&(n.charCode||n.charCode===0?n.charCode:n.keyCode)&&(n.which=n.charCode||n.keyCode),!n.metaKey&&n.ctrlKey&&(n.metaKey=n.ctrlKey),!n.which&&n.button!==undefined&&(n.which=n.button&1?1:n.button&2?3:n.button&4?2:0);switch(n.which){case 186:n.which=59;break;case 187:case 107:case 43:n.which=61;break;case 189:case 45:n.which=109;break;case 42:n.which=106;break;case 47:n.which=111;break;case 78:n.which=110}n.which>=96&&n.which<=105&&(n.which-=48)},preventDefault:function(){var e=this.event;e.preventDefault&&e.preventDefault(),e.returnValue=!1},stopPropagation:function(){var e=this.event;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stop:function(){this.preventDefault(),this.stopPropagation()}});var _eventExpendo="kindeditor_"+_TIME,_eventId=0,_eventData={};_IE&&window.attachEvent("onunload",function(){_each(_eventData,function(e,t){t.el&&_unbind(t.el)})}),K.ctrl=_ctrl,K.ready=_ready,K.formatUrl=_formatUrl,K.formatHtml=_formatHtml,K.getCssList=_getCssList,K.getAttrList=_getAttrList,K.mediaType=_mediaType,K.mediaAttrs=_mediaAttrs,K.mediaEmbed=_mediaEmbed,K.mediaImg=_mediaImg,K.clearMsWord=_clearMsWord,K.tmpl=_tmpl;var _getSetAttrDiv=document.createElement("div");_getSetAttrDiv.setAttribute("className","t");var _GET_SET_ATTRIBUTE=_getSetAttrDiv.className!=="t";K.query=_query,K.queryAll=_queryAll,_extend(KNode,{init:function(e){var t=this;e=_isArray(e)?e:[e];var n=0;for(var r=0,i=e.length;r<i;r++)e[r]&&(t[r]=e[r].constructor===KNode?e[r][0]:e[r],n++);t.length=n,t.doc=_getDoc(t[0]),t.name=_getNodeName(t[0]),t.type=t.length>0?t[0].nodeType:null,t.win=_getWin(t[0])},each:function(e){var t=this;for(var n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===!1)return t;return t},bind:function(e,t){return this.each(function(){_bind(this,e,t)}),this},unbind:function(e,t){return this.each(function(){_unbind(this,e,t)}),this},fire:function(e){return this.length<1?this:(_fire(this[0],e),this)},hasAttr:function(e){return this.length<1?!1:!!_getAttr(this[0],e)},attr:function(e,t){var n=this;return e===undefined?_getAttrList(n.outer()):typeof e=="object"?(_each(e,function(e,t){n.attr(e,t)}),n):t===undefined?(t=n.length<1?null:_getAttr(n[0],e),t===null?"":t):(n.each(function(){_setAttr(this,e,t)}),n)},removeAttr:function(e){return this.each(function(){_removeAttr(this,e)}),this},get:function(e){return this.length<1?null:this[e||0]},eq:function(e){return this.length<1?null:this[e]?new KNode(this[e]):null},hasClass:function(e){return this.length<1?!1:_hasClass(this[0],e)},addClass:function(e){return this.each(function(){_hasClass(this,e)||(this.className=_trim(this.className+" "+e))}),this},removeClass:function(e){return this.each(function(){_hasClass(this,e)&&(this.className=_trim(this.className.replace(new RegExp("(^|\\s)"+e+"(\\s|$)")," ")))}),this},html:function(e){var t=this;return e===undefined?t.length<1||t.type!=1?"":_formatHtml(t[0].innerHTML):(t.each(function(){_setHtml(this,e)}),t)},text:function(){var e=this;return e.length<1?"":_IE?e[0].innerText:e[0].textContent},hasVal:function(){return this.length<1?!1:_hasVal(this[0])},val:function(e){var t=this;return e===undefined?t.length<1?"":t.hasVal()?t[0].value:t.attr("value"):(t.each(function(){_hasVal(this)?this.value=e:_setAttr(this,"value",e)}),t)},css:function(e,t){var n=this;return e===undefined?_getCssList(n.attr("style")):typeof e=="object"?(_each(e,function(e,t){n.css(e,t)}),n):t===undefined?n.length<1?"":n[0].style[_toCamel(e)]||_computedCss(n[0],e)||"":(n.each(function(){this.style[_toCamel(e)]=t}),n)},width:function(e){var t=this;return e===undefined?t.length<1?0:t[0].offsetWidth:t.css("width",_addUnit(e))},height:function(e){var t=this;return e===undefined?t.length<1?0:t[0].offsetHeight:t.css("height",_addUnit(e))},opacity:function(e){return this.each(function(){this.style.opacity===undefined?this.style.filter=e==1?"":"alpha(opacity="+e*100+")":this.style.opacity=e==1?"":e}),this},data:function(e,t){var n=this;return e="kindeditor_data_"+e,t===undefined?n.length<1?null:n[0][e]:(this.each(function(){this[e]=t}),n)},pos:function(){var e=this,t=e[0],n=0,r=0;if(t)if(t.getBoundingClientRect){var i=t.getBoundingClientRect(),s=_getScrollPos(e.doc);n=i.left+s.x,r=i.top+s.y}else while(t)n+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return{x:_round(n),y:_round(r)}},clone:function(e){return this.length<1?new KNode([]):new KNode(this[0].cloneNode(e))},append:function(e){return this.each(function(){this.appendChild&&this.appendChild(_get(e))}),this},appendTo:function(e){return this.each(function(){_get(e).appendChild(this)}),this},before:function(e){return this.each(function(){this.parentNode&&this.parentNode.insertBefore(_get(e),this)}),this},after:function(e){return this.each(function(){this.nextSibling?this.parentNode.insertBefore(_get(e),this.nextSibling):this.parentNode.appendChild(_get(e))}),this},replaceWith:function(e){var t=[];return this.each(function(n,r){_unbind(r);var i=_get(e);r.parentNode.replaceChild(i,r),t.push(i)}),K(t)},empty:function(){var e=this;return e.each(function(e,t){var n=t.firstChild;while(n){if(!t.parentNode)return;var r=n.nextSibling;n.parentNode.removeChild(n),n=r}}),e},remove:function(e){var t=this;return t.each(function(n,r){if(!r.parentNode)return;_unbind(r);if(e){var i=r.firstChild;while(i){var s=i.nextSibling;r.parentNode.insertBefore(i,r),i=s}}r.parentNode.removeChild(r),delete t[n]}),t.length=0,t},show:function(e){var t=this;return e===undefined&&(e=t._originDisplay||""),t.css("display")!="none"?t:t.css("display",e)},hide:function(){var e=this;return e.length<1?e:(e._originDisplay=e[0].style.display,e.css("display","none"))},outer:function(){var e=this;if(e.length<1)return"";var t=e.doc.createElement("div"),n;return t.appendChild(e[0].cloneNode(!0)),n=_formatHtml(t.innerHTML),t=null,n},isSingle:function(){return!!_SINGLE_TAG_MAP[this.name]},isInline:function(){return!!_INLINE_TAG_MAP[this.name]},isBlock:function(){return!!_BLOCK_TAG_MAP[this.name]},isStyle:function(){return!!_STYLE_TAG_MAP[this.name]},isControl:function(){return!!_CONTROL_TAG_MAP[this.name]},contains:function(e){return this.length<1?!1:_contains(this[0],_get(e))},parent:function(){if(this.length<1)return null;var e=this[0].parentNode;return e?new KNode(e):null},parents:function(e){var t=this.parent(),n=0;if(!t)return null;for(;;){if(t&&t.hasClass(e))break;if(n++>10||!t){t=null;break}t=t.parent()}return t},findBlockParent:function(e,t){var n,r=this,i=0;if(r.name==="body")return!1;try{while(!n){var s=!0;e&&(s=r.name===e),r.isBlock()&&s&&(t?r.parent().name==="body"&&(n=r):n=r);if(i++>10||r&&r.name==="body")break;r=r.parent()}}catch(o){n=!1}return n},findBlock:function(){var e=this;if(K(e).isBlock()||e.parent().name==="body")return e;var t=0;for(;;){e=e.parent();if(e.isBlock()&&e.name!=="body"||e.parent().name==="body")return e;if(t++>10||e&&e.name==="body")return!1}return e},findTop:function(){var e,t=this;if(t.parent().name==="body")return t;while(!e)t.parent().name==="body"?e=t:t=t.parent();return e},breakParent:function(e){var t=this[0],n,r=t,i=t,s,o;do{r=r.parentNode,s?(n=r.cloneNode(!1),n.appendChild(s),s=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(s=r.cloneNode(!1),o=s.cloneNode(!1));while(n=i.previousSibling)s.insertBefore(n,s.firstChild);while(n=i.nextSibling)o.appendChild(n);i=r}while(e!==r);return n=e.parentNode,n.insertBefore(s,e),n.insertBefore(o,e),n.insertBefore(t,o),K(e).remove(),t},children:function(){if(this.length<1)return new KNode([]);var e=[],t=this[0].firstChild;while(t)(t.nodeType!=3||_trim(t.nodeValue)!=="")&&e.push(t),t=t.nextSibling;return new KNode(e)},first:function(){var e=this.children();return e.length>0?e.eq(0):null},last:function(){var e=this.children();return e.length>0?e.eq(e.length-1):null},index:function(){if(this.length<1)return-1;var e=-1,t=this[0];while(t)e++,t=t.previousSibling;return e},prev:function(){if(this.length<1)return null;var e=this[0].previousSibling;return e?new KNode(e):null},next:function(){if(this.length<1)return null;var e=this[0].nextSibling;return e?new KNode(e):null},scan:function(e,t){function n(r){var i=t?r.firstChild:r.lastChild;while(i){var s=t?i.nextSibling:i.previousSibling;if(e(i)===!1)return!1;if(n(i)===!1)return!1;i=s}}if(this.length<1)return;return t=t===undefined?!0:t,n(this[0]),this}}),_each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),function(e,t){KNode.prototype[t]=function(e){return e?this.bind(t,e):this.fire(t)}});var _K=K;K=function(e,t){function n(e){return e[0]||(e=[]),new KNode(e)}if(e===undefined||e===null)return;if(typeof e=="string"){t&&(t=_get(t));var r=e.length;e.charAt(0)==="@"&&(e=e.substr(1));if(e.length!==r||/<.+>/.test(e)){var i=t?t.ownerDocument||t:document,s=i.createElement("div"),o=[];s.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+e;for(var u=0,a=s.childNodes.length;u<a;u++){var f=s.childNodes[u];if(f.id=="__kindeditor_temp_tag__")continue;o.push(f)}return n(o)}return n(_queryAll(e,t))}return e&&e.constructor===KNode?e:(e.toArray&&(e=e.toArray()),_isArray(e)?n(e):n(_toArray(arguments)))},_each(_K,function(e,t){K[e]=t}),K.NodeClass=KNode,window.KindEditor=K;var _START_TO_START=0,_START_TO_END=1,_END_TO_END=2,_END_TO_START=3,_BOOKMARK_ID=0;_extend(KRange,{init:function(e){var t=this;t.startContainer=e,t.startOffset=0,t.endContainer=e,t.endOffset=0,t.collapsed=!0,t.doc=e},commonAncestor:function(){function e(e){var t=[];while(e)t.push(e),e=e.parentNode;return t}var t=e(this.startContainer),n=e(this.endContainer),r=0,i=t.length,s=n.length,o,u;while(++r){o=t[i-r],u=n[s-r];if(!o||!u||o!==u)break}return t[i-r+1]},setStart:function(e,t){var n=this,r=n.doc;return n.startContainer=e,n.startOffset=t,n.endContainer===r&&(n.endContainer=e,n.endOffset=t),_updateCollapsed(this)},setEnd:function(e,t){var n=this,r=n.doc;return n.endContainer=e,n.endOffset=t,n.startContainer===r&&(n.startContainer=e,n.startOffset=t),_updateCollapsed(this)},setStartBefore:function(e){return this.setStart(e.parentNode||this.doc,K(e).index())},setStartAfter:function(e){return this.setStart(e.parentNode||this.doc,K(e).index()+1)},setEndBefore:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index())},setEndAfter:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index()+1)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){var t=K(e);if(t.type==3||t.isSingle())return this.selectNode(e);var n=t.children();return n.length>0?this.setStartBefore(n[0]).setEndAfter(n[n.length-1]):this.setStart(e,0).setEnd(e,0)},collapse:function(e){return e?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(e,t){var n=this.get(),r=t.get();if(!_IE)return n.compareBoundaryPoints(e,r);var i={};i[_START_TO_START]="StartToStart",i[_START_TO_END]="EndToStart",i[_END_TO_END]="EndToEnd",i[_END_TO_START]="StartToEnd";var s=n.compareEndPoints(i[e],r);if(s!==0)return s;var o,u,a,f,l;if(e===_START_TO_START||e===_END_TO_START)o=this.startContainer,f=this.startOffset;if(e===_START_TO_END||e===_END_TO_END)o=this.endContainer,f=this.endOffset;if(e===_START_TO_START||e===_START_TO_END)u=t.startContainer,l=t.startOffset;if(e===_END_TO_END||e===_END_TO_START)u=t.endContainer,l=t.endOffset;if(o===u){var c=f-l;return c>0?1:c<0?-1:0}a=u;while(a&&a.parentNode!==o)a=a.parentNode;if(a)return K(a).index()>=f?-1:1;a=o;while(a&&a.parentNode!==u)a=a.parentNode;if(a)return K(a).index()>=l?1:-1;a=K(u).next();if(a&&a.contains(o))return 1;a=K(o).next();if(a&&a.contains(u))return-1},cloneRange:function(){return(new KRange(this.doc)).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var e=this.get(),t=_IE?e.text:e.toString();return t.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return _copyAndDelete(this,!0,!1)},deleteContents:function(){return _copyAndDelete(this,!1,!0)},extractContents:function(){return _copyAndDelete(this,!0,!0)},insertNode:function(e){var t=this,n=t.startContainer,r=t.startOffset,i=t.endContainer,s=t.endOffset,o,u,a,f=1;return e.nodeName.toLowerCase()==="#document-fragment"&&(o=e.firstChild,u=e.lastChild,f=e.childNodes.length),n.nodeType==1?(a=n.childNodes[r],a?(n.insertBefore(e,a),n===i&&(s+=f)):n.appendChild(e)):n.nodeType==3&&(r===0?(n.parentNode.insertBefore(e,n),n.parentNode===i&&(s+=f)):r>=n.nodeValue.length?n.nextSibling?n.parentNode.insertBefore(e,n.nextSibling):n.parentNode.appendChild(e):(r>0?a=n.splitText(r):a=n,n.parentNode.insertBefore(e,a),n===i&&(i=a,s-=r))),o?t.setStartBefore(o).setEndAfter(u):t.selectNode(e),t.compareBoundaryPoints(_END_TO_END,t.cloneRange().setEnd(i,s))>=1?t:t.setEnd(i,s)},surroundContents:function(e){return e.appendChild(this.extractContents()),this.insertNode(e).selectNode(e)},isControl:function(){var e=this,t=e.startContainer,n=e.startOffset,r=e.endContainer,i=e.endOffset,s;return t.nodeType==1&&t===r&&n+1===i&&K(t.childNodes[n]).isControl()},get:function(e){var t=this,n=t.doc,r,i;if(!_IE){i=n.createRange();try{i.setStart(t.startContainer,t.startOffset),i.setEnd(t.endContainer,t.endOffset)}catch(s){}return i}if(e&&t.isControl())return i=n.body.createControlRange(),i.addElement(t.startContainer.childNodes[t.startOffset]),i;var o=t.cloneRange().down();return i=n.body.createTextRange(),i.setEndPoint("StartToStart",_getEndRange(o.startContainer,o.startOffset)),i.setEndPoint("EndToStart",_getEndRange(o.endContainer,o.endOffset)),i},html:function(){return K(this.cloneContents()).outer()},down:function(){function t(t,n,r){if(t.nodeType!=1)return;var i=K(t).children();if(i.length===0)return;var s,o,u,a;n>0&&(s=i.eq(n-1)),n<i.length&&(o=i.eq(n)),s&&s.type==3&&(u=s[0],a=u.nodeValue.length),o&&o.type==3&&(u=o[0],a=0);if(!u)return;r?e.setStart(u,a):e.setEnd(u,a)}var e=this;return t(e.startContainer,e.startOffset,!0),t(e.endContainer,e.endOffset,!1),e},up:function(){function t(t,n,r){if(t.nodeType!=3)return;n===0?r?e.setStartBefore(t):e.setEndBefore(t):n==t.nodeValue.length&&(r?e.setStartAfter(t):e.setEndAfter(t))}var e=this;return t(e.startContainer,e.startOffset,!0),t(e.endContainer,e.endOffset,!1),e},enlarge:function(e){function n(n,r,i){var s=K(n),o;if(s.type==3||_NOSPLIT_TAG_MAP[s.name]||!e&&s.isBlock())return;if(r===0){while(!s.prev()){o=s.parent();if(!o||_NOSPLIT_TAG_MAP[o.name]||!e&&o.isBlock())break;s=o}i?t.setStartBefore(s[0]):t.setEndBefore(s[0])}else if(r==s.children().length){while(!s.next()){o=s.parent();if(!o||_NOSPLIT_TAG_MAP[o.name]||!e&&o.isBlock())break;s=o}i?t.setStartAfter(s[0]):t.setEndAfter(s[0])}}var t=this;return t.up(),n(t.startContainer,t.startOffset,!0),n(t.endContainer,t.endOffset,!1),t},shrink:function(){var e=this,t,n=e.collapsed;while(e.startContainer.nodeType==1&&(t=e.startContainer.childNodes[e.startOffset])&&t.nodeType==1&&!K(t).isSingle())e.setStart(t,0);if(n)return e.collapse(n);while(e.endContainer.nodeType==1&&e.endOffset>0&&(t=e.endContainer.childNodes[e.endOffset-1])&&t.nodeType==1&&!K(t).isSingle())e.setEnd(t,t.childNodes.length);return e},createBookmark:function(e){var t=this,n=t.doc,r,i=K('<span style="display:none;"></span>',n)[0];return i.id="__kindeditor_bookmark_start_"+_BOOKMARK_ID++ +"__",t.collapsed||(r=i.cloneNode(!0),r.id="__kindeditor_bookmark_end_"+_BOOKMARK_ID++ +"__"),r&&t.cloneRange().collapse(!1).insertNode(r).setEndBefore(r),t.insertNode(i).setStartAfter(i),{start:e?"#"+i.id:i,end:r?e?"#"+r.id:r:null}},moveToBookmark:function(e){var t=this,n=t.doc,r=K(e.start,n),i=e.end?K(e.end,n):null;return!r||r.length<1?t:(t.setStartBefore(r[0]),r.remove(),i&&i.length>0?(t.setEndBefore(i[0]),i.remove()):t.collapse(!0),t)},dump:function(){console.log("--------------------"),console.log(this.startContainer.nodeType==3?this.startContainer.nodeValue:this.startContainer,this.startOffset),console.log(this.endContainer.nodeType==3?this.endContainer.nodeValue:this.endContainer,this.endOffset)}}),K.RangeClass=KRange,K.range=_range,K.START_TO_START=_START_TO_START,K.START_TO_END=_START_TO_END,K.END_TO_END=_END_TO_END,K.END_TO_START=_END_TO_START,_extend(KCmd,{init:function(e){var t=this,n=e.doc;t.doc=n,t.win=_getWin(n),t.sel=_getSel(n),t.range=e},selection:function(e){var t=this,n=t.doc,r=_getRng(n);return t.sel=_getSel(n),r?(t.range=_range(r),K(t.range.startContainer).name=="html"&&t.range.selectNodeContents(n.body).collapse(!1),t):(e&&t.range.selectNodeContents(n.body).collapse(!1),t)},select:function(e){e=_undef(e,!0);var t=this,n=t.sel,r=t.range.cloneRange().shrink(),i=r.startContainer,s=r.startOffset,o=r.endContainer,u=r.endOffset,a=_getDoc(i),f=t.win,l,c=!1;if(e&&i.nodeType==1&&r.collapsed){if(_IE){var h=K("<span>&nbsp;</span>",a);r.insertNode(h[0]),l=a.body.createTextRange();try{l.moveToElementText(h[0])}catch(p){}return l.collapse(!1),l.select(),h.remove(),f.focus(),t}if(_WEBKIT){var d=i.childNodes;if(K(i).isInline()||s>0&&K(d[s-1]).isInline()||d[s]&&K(d[s]).isInline())r.insertNode(a.createTextNode("​")),c=!0}}if(_IE)try{l=r.get(!0),l.select()}catch(v){}else c&&r.collapse(!1),l=r.get(!0),n.removeAllRanges(),n.addRange(l);return f.focus(),t},wrap:function(e){var t=this,n=t.doc,r=t.range,i;i=K(e,n);if(r.collapsed)return r.shrink(),r.insertNode(i[0]).selectNodeContents(i[0]),t;if(i.isBlock()){var s=i.clone(!0),o=s;while(o.first())o=o.first();return o.append(r.extractContents()),r.insertNode(s[0]).selectNode(s[0]),t}r.enlarge();var u=r.createBookmark(),a=r.commonAncestor(),f=!1;return K(a).scan(function(e){if(!f&&e==u.start){f=!0;return}if(f){if(e==u.end)return!1;var t=K(e);if(_inPreElement(t))return;if(t.type==3&&_trim(e.nodeValue).length>0){var n;while((n=t.parent())&&n.isStyle()&&n.children().length==1)t=n;_wrapNode(t,i)}}}),r.moveToBookmark(u),t},split:function(e,t){var n=this.range,r=n.doc,i=n.cloneRange().collapse(e),s=i.startContainer,o=i.startOffset,u=s.nodeType==3?s.parentNode:s,a=!1,f;while(u&&u.parentNode){f=K(u);if(t){if(!f.isStyle())break;if(!_hasAttrOrCss(f,t))break}else if(_NOSPLIT_TAG_MAP[f.name])break;a=!0,u=u.parentNode}if(a){var l=r.createElement("span");n.cloneRange().collapse(!e).insertNode(l),e?i.setStartBefore(u.firstChild).setEnd(s,o):i.setStart(s,o).setEndAfter(u.lastChild);var c=i.extractContents(),h=c.firstChild,p=c.lastChild;e?(i.insertNode(c),n.setStartAfter(p).setEndBefore(l)):(u.appendChild(c),n.setStartBefore(l).setEndBefore(h));var d=l.parentNode;if(d==n.endContainer){var v=K(l).prev(),m=K(l).next();v&&m&&v.type==3&&m.type==3?n.setEnd(v[0],v[0].nodeValue.length):e||n.setEnd(n.endContainer,n.endOffset-1)}d.removeChild(l)}return this},remove:function(e){var t=this,n=t.doc,r=t.range;r.enlarge();if(r.startOffset===0){var i=K(r.startContainer),s;while((s=i.parent())&&s.isStyle()&&s.children().length==1)i=s;r.setStart(i[0],0),i=K(r.startContainer),i.isBlock()&&_removeAttrOrCss(i,e);var o=i.parent();o&&o.isBlock()&&_removeAttrOrCss(o,e)}var u,a;if(r.collapsed){t.split(!0,e),u=r.startContainer,a=r.startOffset;if(a>0){var f=K(u.childNodes[a-1]);f&&_isEmptyNode(f)&&(f.remove(),r.setStart(u,a-1))}var l=K(u.childNodes[a]);return l&&_isEmptyNode(l)&&l.remove(),_isEmptyNode(u)&&(r.startBefore(u),u.remove()),r.collapse(!0),t}t.split(!0,e),t.split(!1,e);var c=n.createElement("span"),h=n.createElement("span");r.cloneRange().collapse(!1).insertNode(h),r.cloneRange().collapse(!0).insertNode(c);var p=[],d=!1;K(r.commonAncestor()).scan(function(e){if(!d&&e==c){d=!0;return}if(e==h)return!1;d&&p.push(e)}),K(c).remove(),K(h).remove(),u=r.startContainer,a=r.startOffset;var v=r.endContainer,m=r.endOffset;if(a>0){var g=K(u.childNodes[a-1]);g&&_isEmptyNode(g)&&(g.remove(),r.setStart(u,a-1),u==v&&r.setEnd(v,m-1));var y=K(u.childNodes[a]);y&&_isEmptyNode(y)&&(y.remove(),u==v&&r.setEnd(v,m-1))}var b=K(v.childNodes[r.endOffset]);b&&_isEmptyNode(b)&&b.remove();var w=r.createBookmark(!0);_each(p,function(t,n){_removeAttrOrCss(K(n),e)});var E,S,x=[],T=[];return _each(p,function(e,t){if(t.nodeType===3){!E&&x.push(t);if(S||!E){x.push(t),S=!1,E=!0;return}E&&(x[x.length-1].textContent+=t.textContent,!S&&T.push(t),S=!1)}else if(K(t).isBlock()||K(t).name=="img")S=!0}),_each(T,function(e,t){t.parentNode.removeChild(t)}),r.moveToBookmark(w),t},commonNode:function(e){function s(t){var n=t,r=t;while(r){if(_hasAttrOrCss(K(r),e))return K(r);r=r.parentNode}while(n&&(n=n.lastChild))if(_hasAttrOrCss(K(n),e))return K(n);return null}var t=this.range,n=t.endContainer,r=t.endOffset,i=n.nodeType==3||r===0?n:n.childNodes[r-1],o=s(i);if(o)return o;if(i.nodeType==1||n.nodeType==3&&r===0){var u=K(i).prev();if(u)return s(u)}return null},commonAncestor:function(e){function a(t){while(t){if(t.nodeType==1&&t.tagName.toLowerCase()===e)return t;t=t.parentNode}return null}var t=this.range,n=t.startContainer,r=t.startOffset,i=t.endContainer,s=t.endOffset,o=n.nodeType==3||r===0?n:n.childNodes[r-1],u=i.nodeType==3||s===0?i:i.childNodes[s-1],f=a(o),l=a(u);return f&&l&&f===l?K(f):null},state:function(e){var t=this,n=t.doc,r=!1;try{r=n.queryCommandState(e)}catch(i){}return r},val:function(e){function i(e){return e.toLowerCase()}var t=this,n=t.doc,r=t.range;e=i(e);var s="",o;return e==="fontfamily"||e==="fontname"?(s=_nativeCommandValue(n,"fontname"),s=s.replace(/['"]/g,""),i(s)):e==="formatblock"?(s=_nativeCommandValue(n,e),s===""&&(o=t.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"}),o&&(s=o.name)),s==="Normal"&&(s="p"),i(s)):e==="customformat"?(o=t.commonNode({"*":"data-flag"}),o&&(s=o.attr("data-flag")),i(s)):e==="customstrong"?(o=t.commonNode({strong:"*"}),o&&o.name):e==="customlink"?(o=t.commonNode({a:"href"}),{collapsed:r.collapsed,isA:!!o,url:o&&o.attr("href"),target:o}):e==="tag"?(o=t.commonNode({span:".font-size"}),s="font-size:"+o.css("font-size")+";color:"+_toHex(o.css("color"))+";"+"background:"+_toHex(o.css("background"))+";"+"display:"+o.css("display")+";",i(s)):e==="blockquote"?(o=t.commonNode({blockquote:"*"}),!!o):e==="b"?(o=t.commonNode({b:"*"}),!!o):e==="fontsize"?(o=t.commonNode({"*":".font-size"}),o&&(s=o.css("font-size")),i(s)):e==="forecolor"?(o=t.commonNode({"*":".color"}),o&&(s=o.css("color")),s=_toHex(s),s===""&&(s="default"),i(s)):e==="hilitecolor"?(o=t.commonNode({"*":".background-color"}),o&&(s=o.css("background-color")),s=_toHex(s),s===""&&(s="default"),i(s)):s},toggle:function(e,t){var n=this;return this.selection(),n.commonNode(t)?n.remove(t):n.wrap(e),n.select()},bold:function(e){return e=e||"",this.toggle("<strong "+e+"></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},b:function(){return this.toggle("<b></b>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(e){return this.toggle('<span style="color:'+e+';"></span>',{span:".color="+e,font:"color"})},hilitecolor:function(e){return this.toggle('<span style="background-color:'+e+';"></span>',{span:".background-color="+e})},fontsize:function(e){return this.toggle('<span style="font-size:'+e+';"></span>',{span:".font-size="+e,font:"size"})},fontname:function(e){return this.fontfamily(e)},fontfamily:function(e){return this.toggle('<span style="font-family:'+e+';"></span>',{span:".font-family="+e,font:"face"})},removeformat:function(){var e={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},t=_STYLE_TAG_MAP;return _each(t,function(t,n){e[t]="*"}),this.remove(e),this.select()},inserthtml:function(e,t,n){function s(e,t){t='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var n=e.get();n.item?n.item(0).outerHTML=t:n.pasteHTML(t);var i=e.doc.getElementById("__kindeditor_temp_tag__");i.parentNode.removeChild(i);var s=_toRange(n);e.setEnd(s.endContainer,s.endOffset),e.collapse(!1),r.select(!1)}function o(e,t){var n=e.doc,i=n.createDocumentFragment();K("@"+t,n).each(function(){i.appendChild(this)}),e.deleteContents(),e.insertNode(i),e.collapse(!1),r.select(!1)}var r=this,i=r.range;if(e==="")return r;if(_IE&&t){try{s(i,e)}catch(u){o(i,e)}return r}return n&&(K("p",i.doc).each(function(){var e=this.innerHTML;K.trim(e)===""&&!K("br",this).length&&this.parentElement.removeChild(this)}),K("span",i.doc).each(function(){var e=this.innerHTML;K.trim(e)===""&&!K("br",this).length&&this.parentElement.removeChild(this)}),K("blockquote",i.doc).length&&K("span",K("blockquote",i.doc)).each(function(){this.style.cssText="font-size:14px;color:#666;",K(this).attr("data-flag","bk-span")})),o(i,e),r},hr:function(){var e=this.select().range,t=e.startContainer,n=K(t).findBlockParent("blockquote");n&&e.selectNode(n[0]).collapse(!1);var r="margin: 20px 0px;height: 1px;background: #ddd;border-style: solid;border: 0px;display: inline-block;width: 100%;",i=this.inserthtml('<hr style="'+r+'"/>');return i},print:function(){return this.win.print(),this},insertimage:function(e,t,n,r,i,s,o){t=_undef(t,""),i=_undef(i,0);var u="";for(var a=0;a<o.length;a++)u+=o[a].name+'="'+o[a].value+'" ';var f='<img src="'+_escape(e)+'"  ';return n&&(f+='width="'+_escape(n)+'" '),r&&(f+='height="'+_escape(r)+'" '),t&&(f+='title="'+_escape(t)+'" '),s&&(f+='align="'+_escape(s)+'" '),f+='alt="'+_escape(t)+'" ',f+=u,f+="/>",this.inserthtml(f)},createlink:function(e,t){var n=this,r=n.doc,i=n.range;n.select();var s=n.commonNode({a:"*"});s&&!i.isControl()&&(i.selectNode(s.get()),n.select());var o='<a href="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" style="text-decoration:none;color:#4990E2;" ';t&&(o+=' target="'+_escape(t)+'"');if(i.collapsed)return o+=">"+_escape(e)+"</a>",n.inserthtml(o);if(i.isControl()){var u=K(i.startContainer.childNodes[i.startOffset]);return o+="></a>",u.after(K(o,r)),u.next().append(u),i.selectNode(u[0]),n.select()}o+=">"+i.toString()+"</a>";var a=K(o,r);return i.deleteContents(),n.wrap(o),n.select()},unlink:function(){var e=this,t=e.doc,n=e.range;e.select();var r=e.commonNode({a:"*"});r.attr("style","");if(n.collapsed){var r=e.commonNode({a:"*"});r&&(n.selectNode(r.get()),e.select()),_nativeCommand(t,"unlink",null);if(_WEBKIT&&K(n.startContainer).name==="img"){var i=K(n.startContainer).parent();i.name==="a"&&i.remove(!0)}}else _nativeCommand(t,"unlink",null);return e}}),_each("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript".split(","),function(e,t){KCmd.prototype[t]=function(e){var n=this;return n.select(),_nativeCommand(n.doc,t,e),(!_IE||_inArray(t,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0)&&n.selection(),n}}),_each("cut,copy,paste".split(","),function(e,t){KCmd.prototype[t]=function(){var e=this;if(!e.doc.queryCommandSupported(t))throw"not supported";return e.select(),_nativeCommand(e.doc,t,null),e}}),K.CmdClass=KCmd,K.cmd=_cmd,_extend(KWidget,{init:function(e){var t=this;t.name=e.name||"",t.doc=e.doc||document,t.win=_getWin(t.doc),t.x=_addUnit(e.x),t.y=_addUnit(e.y),t.z=e.z,t.width=_addUnit(e.width),t.height=_addUnit(e.height),t.div=K('<div style="display:block;"></div>'),t.options=e,t._alignEl=e.alignEl,t.width&&t.div.css("width",t.width),t.height&&t.div.css("height",t.height),t.z&&t.div.css({position:"absolute",left:t.x,top:t.y,"z-index":t.z}),t.z&&(t.x===undefined||t.y===undefined)&&t.autoPos(t.width,t.height),e.cls&&t.div.addClass(e.cls),e.shadowMode&&t.div.addClass("ke-shadow"),e.css&&t.div.css(e.css),e.src?K(e.src).replaceWith(t.div):K(t.doc.body).append(t.div),e.html&&t.div.html(e.html);if(e.autoScroll)if(_IE&&_V<7||_QUIRKS){var n=_getScrollPos();K(t.win).bind("scroll",function(e){var r=_getScrollPos(),i=r.x-n.x,s=r.y-n.y;t.pos(_removeUnit(t.x)+i,_removeUnit(t.y)+s,!1)})}else t.div.css("position","fixed")},pos:function(e,t,n){var r=this;return n=_undef(n,!0),e!==null&&(e=e<0?0:_addUnit(e),r.div.css("left",e),n&&(r.x=e)),t!==null&&(t=t<0?0:_addUnit(t),r.div.css("top",t),n&&(r.y=t)),r},autoPos:function(e,t){var n=this,r=_removeUnit(e)||0,i=_removeUnit(t)||0,s=_getScrollPos();if(n._alignEl){var o=K(n._alignEl),u=o.pos(),a=_round(o[0].clientWidth/2-r/2),f=_round(o[0].clientHeight/2-i/2);x=a<0?u.x:u.x+a,y=f<0?u.y:u.y+f}else{var l=_docElement(n.doc);x=_round(s.x+(l.clientWidth-r)/2),y=_round(s.y+(l.clientHeight-i)/2)}return _IE&&_V<7||_QUIRKS||(x-=s.x,y-=s.y),n.pos(x,y)},remove:function(){var e=this;return(_IE&&_V<7||_QUIRKS)&&K(e.win).unbind("scroll"),e.div.remove(),_each(e,function(t){e[t]=null}),this},show:function(){return this.div.show(),this},hide:function(){return this.div.hide(),this},draggable:function(e){var t=this;return e=e||{},e.moveEl=t.div,e.moveFn=function(e,n,r,i,s,o){(e+=s)<0&&(e=0),(n+=o)<0&&(n=0),t.pos(e,n)},_drag(e),t}}),K.WidgetClass=KWidget,K.widget=_widget;var html,_direction="";if(html=document.getElementsByTagName("html"))_direction=html[0].dir;_extend(KEdit,KWidget,{init:function(e){function f(){var u=_iframeDoc(t.iframe);u.open(),o&&(u.domain=document.domain),u.write(_getInitHtml(n,r,i,s)),u.close(),t.win=t.iframe[0].contentWindow,t.doc=u;var a=_cmd(u);t.afterChange(function(e){a.selection()}),_WEBKIT&&K(u).click(function(e){K(e.target).name==="img"&&(a.selection(!0),a.range.selectNode(e.target),a.select())}),_IE&&K(u).keydown(function(e){if(e.which==8){a.selection();var t=a.range;t.isControl()&&(t.collapse(!0),K(t.startContainer.childNodes[t.startOffset]).remove(),e.preventDefault())}}),t.cmd=a;var f=_elementVal(t.srcElement);f=f||'<p style="'+_NORMAL_FORMAT+'" data-flag="normal" lang="en"></p>',t.html(f),_IE?(u.body.disabled=!0,u.body.contentEditable=!0,u.body.removeAttribute("disabled")):u.designMode="on",e.afterCreate&&e.afterCreate.call(t)}var t=this;KEdit.parent.init.call(t,e),t.srcElement=K(e.srcElement),t.div.addClass("ke-edit"),t.designMode=_undef(e.designMode,!0),t.beforeGetHtml=e.beforeGetHtml,t.beforeSetHtml=e.beforeSetHtml,t.afterSetHtml=e.afterSetHtml;var n=_undef(e.themesPath,""),r=e.bodyClass,i=e.cssPath,s=e.cssData,o=location.host.replace(/:\d+/,"")!==document.domain,u="document.open();"+(o?'document.domain="'+document.domain+'";':"")+"document.close();",a=_IE?' src="javascript:void(function(){'+encodeURIComponent(u)+'}())"':"";t.iframe=K('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+a+"></iframe>").css("width","100%"),t.textarea=K('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%"),t.width&&t.setWidth(t.width),t.height&&t.setHeight(t.height),t.designMode?t.textarea.hide():t.iframe.hide(),o&&t.iframe.bind("load",function(e){t.iframe.unbind("load"),_IE?f():setTimeout(f,0)}),t.div.append(t.iframe),t.div.append(t.textarea),t.srcElement.hide(),!o&&f()},setWidth:function(e){return this.div.css("width",_addUnit(e)),this},setHeight:function(e){var t=this;e=_addUnit(e),t.div.css("height",e),t.iframe.css("height",e);if(_IE&&_V<8||_QUIRKS)e=_addUnit(_removeUnit(e)-2);return t.textarea.css("height",e),t},remove:function(){var e=this,t=e.doc;K(t.body).unbind(),K(t).unbind(),K(e.win).unbind(),_elementVal(e.srcElement,e.html()),e.srcElement.show(),t.write(""),e.iframe.unbind(),e.textarea.unbind(),KEdit.parent.remove.call(e)},html:function(e,t){var n=this,r=n.doc;if(n.designMode){var i=r.body;return e===undefined?(t?e="<!doctype html><html>"+i.parentNode.innerHTML+"</html>":e=i.innerHTML,n.beforeGetHtml&&(e=n.beforeGetHtml(e)),_GECKO&&e=="<br />"&&(e=""),e):(n.beforeSetHtml&&(e=n.beforeSetHtml(e)),e===""&&(e='<p data-flag="normal" style="'+_NORMAL_FORMAT+'" lang="en"><br></p>'),K(i).html(e),n.afterSetHtml&&n.afterSetHtml(),n)}return e===undefined?n.textarea.val():(n.textarea.val(e),n)},design:function(e){var t=this,n;return(e===undefined?!t.designMode:e)?t.designMode||(n=t.html(),t.designMode=!0,t.html(n),t.textarea.hide(),t.iframe.show()):t.designMode&&(n=t.html(),t.designMode=!1,t.html(n),t.iframe.hide(),t.textarea.show()),t.focus()},focus:function(){var e=this;return e.designMode?e.win.focus():e.textarea[0].focus(),e},blur:function(){var e=this;if(_IE){var t=K('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',e.div);e.div.append(t),t[0].focus(),t.remove()}else e.designMode?e.win.blur():e.textarea[0].blur();return e},afterChange:function(e){function i(t){setTimeout(function(){e(t)},1)}var t=this,n=t.doc,r=n.body;K(n).keyup(function(t){!t.ctrlKey&&!t.altKey&&_CHANGE_KEY_MAP[t.which]&&e(t)}),K(n).mouseup(e).contextmenu(e),K(t.win).blur(function(){var n=t.doc.body.childNodes,r,i=[];for(var s=0;s<n.length;s++){var o=n[s],u=!1;if(K(o).type===3&&K.trim(o.textContent)==="")o.parentNode.removeChild(o),s-=1;else{!K(o).isBlock()&&(K(o).name!=="br"||!r||K(r).name==="br")&&i.push(o),K(o).name==="br"?u=!0:K(o).isBlock()&&i.length&&(u=!0),r=n[s].cloneNode();if((u||n.length-1===s)&&i.length){var a=document.createElement("p");a.setAttribute("style",_NORMAL_FORMAT),a.setAttribute("flag","normal"),a.setAttribute("lang","en"),o.parentNode.insertBefore(a,o),_each(i,function(e,t){a.appendChild(t)}),s=s-i.length+1,i=[]}}}for(var s=0;s<n.length;s++){var o=n[s];K(o).name==="br"&&o.parentNode.removeChild(o)}e()});var s=function(e){i(e)};return K(r).unbind("paste",s),K(r).bind("paste",s),K(r).bind("cut",i),t}}),K.EditClass=KEdit,K.edit=_edit,K.iframeDoc=_iframeDoc,_extend(KToolbar,KWidget,{init:function(e){function n(e){var t=K(e);if(t.hasClass("ke-outline"))return t;if(t.hasClass("ke-toolbar-icon"))return t.parent()}function r(e,r){var i=n(e.target);if(i){t.toggleTitle(r,i);if(i.hasClass("ke-disabled"))return;if(i.hasClass("ke-selected"))return;i[r]("ke-on")}}var t=this;KToolbar.parent.init.call(t,e),t.disableMode=_undef(e.disableMode,!1),t.noDisableItemMap=_toMap(_undef(e.noDisableItems,[])),t._itemMap={},t.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()}).attr("unselectable","on"),t.div.mouseover(function(e){r(e,"addClass")}).mouseout(function(e){r(e,"removeClass")}).click(function(e){var r=n(e.target);if(r){if(r.hasClass("ke-disabled"))return;t.options.click.call(this,e,r.attr("data-name"))}})},get:function(e){return this._itemMap[e]?this._itemMap[e]:this._itemMap[e]=K("span.ke-icon-"+e,this.div).parent()},select:function(e){return _selectToolbar.call(this,e,function(e){e.addClass("ke-selected")}),self},unselect:function(e){return _selectToolbar.call(this,e,function(e){e.removeClass("ke-selected").removeClass("ke-on")}),self},enable:function(e){var t=this,n=e.get?e:t.get(e);return n&&(n.removeClass("ke-disabled"),n.opacity(1)),t},disable:function(e){var t=this,n=e.get?e:t.get(e);return n&&(n.removeClass("ke-selected").addClass("ke-disabled"),n.opacity(.5)),t},toggleTitle:function(e,t){var n=this;e==="addClass"?t&&n.showTitle(t):e==="removeClass"&&t&&n.hideTitle(t)},showTitle:function(e){var t=this,n=t.div.parent(),r=e.pos().x-t.div.pos().x+e.width()/2;if(K(".xmeditor-tips",n).length)return;var i="font-size:12px;line-height:29px;position: absolute;top: -26px;background: #555555;color: #ffffff;display: table-cell;vertical-align: middle;text-align: center;border-radius: 0.3125rem;padding: 0px 10px;";t.div.after('<span class="xmeditor-tips" style="'+i+'">'+e.attr("title")+"</span>"),r-=K(".xmeditor-tips",n).width()/2,K(".xmeditor-tips",n).css({left:r+"px"})},hideTitle:function(e){var t=this;clearTimeout(this.tipTimer),K(".xmeditor-tips",t.div.parent()).remove()},disableAll:function(e,t){var n=this,r=n.noDisableItemMap,i;return t&&(r=_toMap(t)),(e===undefined?!n.disableMode:e)?(K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);r[t]||n.disable(e)}),n.disableMode=!0):(K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);r[t]||n.enable(e)}),n.disableMode=!1),n}}),K.ToolbarClass=KToolbar,K.toolbar=_toolbar,_extend(KMenu,KWidget,{init:function(e){var t=this;e.z=e.z||811213,KMenu.parent.init.call(t,e),t.centerLineMode=_undef(e.centerLineMode,!0),t.div.addClass("ke-menu").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on")},addItem:function(e){var t=this;if(e.title==="-"){t.div.append(K('<div class="ke-menu-separator"></div>'));return}var n=K('<div class="ke-menu-item" unselectable="on"></div>'),r=K('<div class="ke-inline-block ke-menu-item-left"></div>'),i=K('<div class="ke-inline-block ke-menu-item-right"></div>'),s=_addUnit(e.height),o=_undef(e.iconClass,"");t.div.append(n),s&&(n.css("height",s),i.css("line-height",s));var u;return t.centerLineMode&&(u=K('<div class="ke-inline-block ke-menu-item-center"></div>'),s&&u.css("height",s)),n.mouseover(function(e){K(this).addClass("ke-menu-item-on"),u&&u.addClass("ke-menu-item-center-on")}).mouseout(function(e){K(this).removeClass("ke-menu-item-on"),u&&u.removeClass("ke-menu-item-center-on")}).click(function(t){e.click.call(K(this)),t.stopPropagation()}).append(r),u&&n.append(u),n.append(i),e.checked&&(o="ke-icon-checked"),o!==""&&r.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+o+'"></span>'),i.html(e.title),t},remove:function(){var e=this;return e.options.beforeRemove&&e.options.beforeRemove.call(e),K(".ke-menu-item",e.div[0]).unbind(),KMenu.parent.remove.call(e),e}}),K.MenuClass=KMenu,K.menu=_menu,_extend(KColorPicker,KWidget,{init:function(e){var t=this;e.z=e.z||811213,KColorPicker.parent.init.call(t,e);var n=e.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]];t.selectedColor=(e.selectedColor||"").toLowerCase(),t._cells=[],t.div.addClass("ke-colorpicker").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on");var r=t.doc.createElement("table");t.div.append(r),r.className="ke-colorpicker-table",r.cellPadding=0,r.cellSpacing=0,r.border=0;var i=r.insertRow(0),s=i.insertCell(0);s.colSpan=n[0].length,t._addAttr(s,"","ke-colorpicker-cell-top");for(var o=0;o<n.length;o++){i=r.insertRow(o+1);for(var u=0;u<n[o].length;u++)s=i.insertCell(u),t._addAttr(s,n[o][u],"ke-colorpicker-cell")}},_addAttr:function(e,t,n){var r=this;e=K(e).addClass(n),r.selectedColor===t.toLowerCase()&&e.addClass("ke-colorpicker-cell-selected"),e.attr("title",t||r.options.noColor),e.mouseover(function(e){K(this).addClass("ke-colorpicker-cell-on")}),e.mouseout(function(e){K(this).removeClass("ke-colorpicker-cell-on")}),e.click(function(e){e.stop(),r.options.click.call(K(this),t)}),t?e.append(K('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",t)):e.html(r.options.noColor),K(e).attr("unselectable","on"),r._cells.push(e)},remove:function(){var e=this;return _each(e._cells,function(){this.unbind()}),KColorPicker.parent.remove.call(e),e}}),K.ColorPickerClass=KColorPicker,K.colorpicker=_colorpicker,_extend(KUploadButton,{init:function(e){var t=this,n=K(e.button),r=e.fieldName||"file",i=e.url||"",s=n.val(),o=e.extraParams||{},u=n[0].className||"",a=e.target||"kindeditor_upload_iframe_"+(new Date).getTime();e.afterError=e.afterError||function(e){alert(e)};var f=[];for(var l in o)f.push('<input type="hidden" name="'+l+'" value="'+o[l]+'" />');var c=['<div class="ke-inline-block '+u+'">',e.target?"":'<iframe name="'+a+'" style="display:none;"></iframe>',e.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+a+'" action="'+i+'">','<span class="ke-button-common">',f.join(""),'<input type="button" class="ke-button-common ke-button" value="'+s+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+r+'" tabindex="-1" />',e.form?"</div>":"</form>","</div>"].join(""),h=K(c,n.doc);n.hide(),n.before(h),t.div=h,t.button=n,t.iframe=e.target?K('iframe[name="'+a+'"]'):K("iframe",h),t.form=e.form?K(e.form):K("form",h);var p=e.width||K(".ke-button-common",h).width();t.fileBox=K(".ke-upload-file",h).width(p),t.options=e},submit:function(){var e=this,t=e.iframe;return t.bind("load",function(){t.unbind();var n=document.createElement("form");e.fileBox.before(n),K(n).append(e.fileBox),n.reset(),K(n).remove(!0);var r=K.iframeDoc(t),i=r.getElementsByTagName("pre")[0],s="",o;i?s=i.innerHTML:s=r.body.innerHTML,t[0].src="javascript:false";try{o=K.json(s)}catch(u){e.options.afterError.call(e,"<!doctype html><html>"+r.body.parentNode.innerHTML+"</html>")}o&&e.options.afterUpload.call(e,o)}),e.form[0].submit(),e},remove:function(){var e=this;return e.fileBox&&e.fileBox.unbind(),e.iframe.remove(),e.div.remove(),e.button.show(),e}}),K.UploadButtonClass=KUploadButton,K.uploadbutton=_uploadbutton,_extend(KDialog,KWidget,{init:function(e){var t=this,n=_undef(e.shadowMode,!0);e.z=e.z||811213,e.shadowMode=!1,e.autoScroll=_undef(e.autoScroll,!0),KDialog.parent.init.call(t,e);var r=e.title,i=K(e.body,t.doc),s=e.previewBtn,o=e.yesBtn,u=e.noBtn,a=e.closeBtn,f=_undef(e.showMask,!0);t.div.addClass("ke-dialog").bind("click,mousedown",function(e){e.stopPropagation()});var l=K('<div class="ke-dialog-content"></div>').appendTo(t.div);_IE&&_V<7?t.iframeMask=K('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(t.div):n&&K('<div class="ke-dialog-shadow"></div>').appendTo(t.div);var c=K('<div class="ke-dialog-header"></div>');l.append(c),c.html(r),t.closeIcon=K('<span class="ke-dialog-icon-close" title="'+a.name+'"></span>').click(a.click),c.append(t.closeIcon),t.draggable({clickEl:c,beforeDrag:e.beforeDrag});var h=K('<div class="ke-dialog-body"></div>');l.append(h),h.append(i);var p=K('<div class="ke-dialog-footer"></div>');(s||o||u)&&l.append(p),_each([{btn:s,name:"preview"},{btn:o,name:"yes"},{btn:u,name:"no"}],function(){if(this.btn){var e=_createButton(this.btn);e.addClass("ke-dialog-"+this.name),p.append(e)}}),t.height&&h.height(_removeUnit(t.height)-c.height()-p.height()),t.div.width(t.div.width()),t.div.height(t.div.height()),t.mask=null;if(f){var d=_docElement(t.doc),v=Math.max(d.scrollWidth,d.clientWidth),m=Math.max(d.scrollHeight,d.clientHeight);t.mask=_widget({x:0,y:0,z:t.z-1,cls:"ke-dialog-mask",width:v,height:m})}t.autoPos(t.div.width(),t.div.height()),t.footerDiv=p,t.bodyDiv=h,t.headerDiv=c,t.isLoading=!1},setMaskIndex:function(e){var t=this;t.mask.div.css("z-index",e)},showLoading:function(e){e=_undef(e,"");var t=this,n=t.bodyDiv;return t.loading=K('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(n.height()/3)+'px;">'+e+"</div></div>").width(n.width()).height(n.height()).css("top",t.headerDiv.height()+"px"),n.css("visibility","hidden").after(t.loading),t.isLoading=!0,t},hideLoading:function(){return this.loading&&this.loading.remove(),this.bodyDiv.css("visibility","visible"),this.isLoading=!1,this},remove:function(){var e=this;return e.options.beforeRemove&&e.options.beforeRemove.call(e),e.mask&&e.mask.remove(),e.iframeMask&&e.iframeMask.remove(),e.closeIcon.unbind(),K("input",e.div).unbind(),K("button",e.div).unbind(),e.footerDiv.unbind(),e.bodyDiv.unbind(),e.headerDiv.unbind(),K("iframe",e.div).each(function(){K(this).remove()}),KDialog.parent.remove.call(e),e}});var _dialogCount=0,XMDialog=function(){function e(e,t){this.tasking=!1,this.opt={width:100,height:100,html:"",okHandler:null,mask:!1},this.isDestory=!1,this.position={left:0,top:0},this.isShow=!1,this.opt=e||{},this.editor=t,this.toolbarEl=this.editor.toolbar.div,_dialogCount+=1,this.id="xmEditor-dialog-"+_dialogCount,this.init()}return e.prototype.init=function(){var e=this,t=this.toolbarEl.parent();t.append(this.template()),this.$target=K("#"+this.id,t)},e.prototype.bindEvent=function(){var e=this;K('[role-btn="ok"]',this.$target).bind("click",function(t){var n=e.opt.okHandler&&e.opt.okHandler();n&&e.hide()}),K('[role-btn="cancel"]',this.$target).bind("click",function(t){e.hide()}),K(document).bind("mousedown",function(t){if(t.target.tagName.toLowerCase()==="input")return t.stopPropagation(),!1;var n=K(t.target).parents("xmeditor-dialog");!(t.target===e.$target[0]||n&&n.length)&&e.isShow&&setTimeout(function(){e.hide()},100)})},e.prototype.getPosition=function(e){var t=this.toolbarEl.pos(),n=K(e).pos(),r=K(e).height();return{left:n.x-t.x,top:r+15}},e.prototype.show=function(e){var t=this.getPosition(e);this.$target.css({left:t.left+"px",top:t.top+"px"}).removeClass("hidden"),this.isShow=!0,this.editor.xmDialogShow=!0},e.prototype.hide=function(){this.tasking||(this.$target.addClass("hidden"),this.isShow=!1,this.editor.xmDialogShow=!1)},e.prototype.setTasking=function(e){this.tasking=e},e.prototype.template=function(){var e=this.opt.width,t=this.opt.height,n=this.opt.html,r=""+(e?"width:"+e+"px;":"")+(t?"height:"+t+"px;":"");return'<div unselectable="on" id="'+this.id+'" class="xmeditor-dialog hidden"  style="'+r+'">'+n+"</div>\n        "},e}();K.DialogClass=KDialog,K.dialog=_dialog,K.tabs=_tabs,K.loadScript=_loadScript,K.loadStyle=_loadStyle,K.ajax=_ajax;var _plugins={},_language={};KEditor.prototype={lang:function(e){return _lang(e,this.langType)},loadPlugin:function(e,t){var n=this;return _plugins[e]?n._calledPlugins[e]?(t&&t.call(n),n):(_plugins[e].call(n,KindEditor),t&&t.call(n),n._calledPlugins[e]=!0,n):n.isLoading?n:(n.isLoading=!0,_loadScript(n.pluginsPath+e+"/"+e+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){n.isLoading=!1,_plugins[e]&&n.loadPlugin(e,t)}),n)},handler:function(e,t){var n=this;return n._handlers[e]||(n._handlers[e]=[]),_isFunction(t)?(n._handlers[e].push(t),n):(_each(n._handlers[e],function(){t=this.call(n,t)}),t)},clickToolbar:function(e,t){var n=this,r="clickToolbar"+e;return t===undefined?n._handlers[r]?n.handler(r):(n.loadPlugin(e,function(){n.handler(r)}),n):n.handler(r,t)},updateState:function(){var e=this;return e.cmd.val("customformat")==="subtitle"?e.toolbar.disable("customstrong"):e.toolbar.enable("customstrong"),e.cmd.val("customlink").collapsed&&!e.cmd.val("customlink").isA?e.toolbar.disable("customlink"):e.toolbar.enable("customlink"),_each("customformat,customstrong,customlink,blockquote,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,subscript,superscript,bold,b,italic,underline,strikethrough".split(","),function(t,n){var r=e.cmd.val(n);if(n==="customformat"){var i={normal:"正文",subtitle:"副标题",backup:"备注"};if(r==""){K(".ke-icon-customformat",e.toolbar.div).html(i.normal);return}_each(i,function(t,n){var s=!1;r==t&&(s=!0),s&&K(".ke-icon-customformat",e.toolbar.div).html(i[t])})}n==="customstrong"?r=="strong"?e.toolbar.select(n):e.toolbar.unselect(n):n==="blockquote"?r?e.toolbar.select(n):e.toolbar.unselect(n):n==="customlink"?r.isA?e.toolbar.select(n):e.toolbar.unselect(n):n==="b"?r?e.toolbar.select(n):e.toolbar.unselect(n):e.cmd.state(n)?e.toolbar.select(n):e.toolbar.unselect(n)}),e},addContextmenu:function(e){return this._contextmenus.push(e),this},afterCreate:function(e){return this.handler("afterCreate",e)},beforeRemove:function(e){return this.handler("beforeRemove",e)},beforeGetHtml:function(e){return this.handler("beforeGetHtml",e)},beforeSetHtml:function(e){return this.handler("beforeSetHtml",e)},afterSetHtml:function(e){return this.handler("afterSetHtml",e)},create:function(){function h(){if(u.height()===0){setTimeout(h,100);return}e.resize(n,r)}function p(t,n,r){r=_undef(r,!0),t&&t>=e.minWidth&&(e.resize(t,null),r&&(e.width=_addUnit(t))),n&&n>=e.minHeight&&(e.resize(null,n),r&&(e.height=_addUnit(n)))}var e=this,t=e.fullscreenMode;if(e.isCreated)return e;if(e.srcElement.data("kindeditor"))return e;e.srcElement.data("kindeditor","true"),t?_docElement().style.overflow="hidden":_docElement().style.overflow="";var n=t?_docElement().clientWidth+"px":e.width,r=t?_docElement().clientHeight+"px":e.height;if(_IE&&_V<8||_QUIRKS)r=_addUnit(_removeUnit(r)+2);var i=e.container=K(e.layout);t?K(document.body).append(i):e.srcElement.before(i);var s=K(".toolbar",i),o=K(".edit",i),u=e.statusbar=K(".statusbar",i);i.removeClass("container").addClass("ke-container ke-container-"+e.themeType).css("width",n),t?(i.css({position:"absolute",left:0,top:0,"z-index":811211}),_GECKO||(e._scrollPos=_getScrollPos()),window.scrollTo(0,0),K(document.body).css({height:"1px",overflow:"hidden"}),K(document.body.parentNode).css("overflow","hidden"),e._fullscreenExecuted=!0):(e._fullscreenExecuted&&(K(document.body).css({height:"",overflow:""}),K(document.body.parentNode).css("overflow","")),e._scrollPos&&window.scrollTo(e._scrollPos.x,e._scrollPos.y));var a=[];K.each(e.items,function(t,n){if(n=="|")a.push('<span class="ke-inline-block ke-separator"></span>');else if(n=="/")a.push('<div class="ke-hr"></div>');else{var r='data-tip="true" data-tip-content="'+e.lang(n)+'" class="tip--top"';n==="customformat"?(a.push('<span class="ke-outline ke-outline-select" data-name="'+n+'" '+r+' title="'+e.lang(n)+'"  unselectable="on">'),a.push('<span class="ke-toolbar-icon  ke-icon-'+n+'" unselectable="">正文</span><em  class="ke-toolbar-icon selecter-arrow">◆</em></span>')):(a.push('<span class="ke-outline" data-name="'+n+'" '+r+' title="'+e.lang(n)+'"  unselectable="on">'),a.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+n+'" unselectable="on"></span></span>'))}});var f=e.toolbar=_toolbar({src:s,html:a.join(""),noDisableItems:e.noDisableItems,click:function(t,n){t.stop();if(e.menu){var r=e.menu.name;e.hideMenu();if(r===n)return}e.clickToolbar(n)}}),l=_removeUnit(r)-f.div.height(),c=e.edit=_edit({height:l>0&&_removeUnit(r)>e.minHeight?l:e.minHeight,src:o,srcElement:e.srcElement,designMode:e.designMode,themesPath:e.themesPath,bodyClass:e.bodyClass,cssPath:e.cssPath,cssData:e.cssData,beforeGetHtml:function(t){return t=e.beforeGetHtml(t),_formatHtml(t,e.filterMode?e.htmlTags:null,e.urlType,e.wellFormatMode,e.indentChar)},beforeSetHtml:function(t){return t=_formatHtml(t,e.filterMode?e.htmlTags:null,"",!1),e.beforeSetHtml(t)},afterSetHtml:function(){e.edit=c=this,e.afterSetHtml()},afterCreate:function(){e.edit=c=this,e.cmd=c.cmd,e._docMousedownFn=function(t){e.menu&&e.hideMenu()},K(c.doc,document).mousedown(e._docMousedownFn),_bindContextmenuEvent.call(e),_bindNewlineEvent.call(e),_bindTabEvent.call(e),_bindFocusEvent.call(e),c.afterChange(function(t){if(!c.designMode)return;e.updateState(),e.addBookmark(),e.options.afterChange&&e.options.afterChange.call(e)}),c.textarea.keyup(function(t){!t.ctrlKey&&!t.altKey&&_INPUT_KEY_MAP[t.which]&&e.options.afterChange&&e.options.afterChange.call(e)}),e.readonlyMode&&e.readonly(),e.isCreated=!0,e.initContent===""&&(e.initContent=e.html()),e.afterCreate(),e.options.afterCreate&&e.options.afterCreate.call(e);var t=e.edit.doc.body.childNodes,n,r=[];for(var i=0;i<t.length;i++){var s=t[i],o=!1;if(K(s).type===3&&K.trim(s.textContent)==="")s.parentNode.removeChild(s),i-=1;else{!K(s).isBlock()&&(K(s).name!=="br"||!n||K(n).name==="br")&&r.push(s),K(s).name==="br"?o=!0:K(s).isBlock()&&r.length&&(o=!0),n=t[i].cloneNode();if((o||t.length-1===i)&&r.length){var u=document.createElement("p");u.setAttribute("style",_NORMAL_FORMAT),u.setAttribute("flag","normal"),u.setAttribute("lang","en"),s.parentNode.insertBefore(u,s),_each(r,function(e,t){u.appendChild(t)}),i=i-r.length+1,r=[]}}}for(var i=0;i<t.length;i++){var s=t[i];K(s).name==="br"&&s.parentNode.removeChild(s)}e.sync()}});return u.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>'),K(window).unbind("resize"),h(),t?(K(window).bind("resize",function(t){e.isCreated&&p(_docElement().clientWidth,_docElement().clientHeight,!1)}),f.select("fullscreen"),u.first().css("visibility","hidden"),u.last().css("visibility","hidden")):(_GECKO&&K(window).bind("scroll",function(t){e._scrollPos=_getScrollPos()}),e.resizeType>0?_drag({moveEl:i,clickEl:u,moveFn:function(e,t,n,r,i,s){r+=s,p(null,r)}}):u.first().css("visibility","hidden"),e.resizeType===2?_drag({moveEl:i,clickEl:u.last(),moveFn:function(e,t,n,r,i,s){n+=i,r+=s,p(n,r)}}):u.last().css("visibility","hidden")),e},remove:function(){var e=this;return e.isCreated?(e.beforeRemove(),e.srcElement.data("kindeditor",""),e.menu&&e.hideMenu(),_each(e.dialogs,function(){e.hideDialog()}),K(document).unbind("mousedown",e._docMousedownFn),e.toolbar.remove(),e.edit.remove(),e.statusbar.last().unbind(),e.statusbar.unbind(),e.container.remove(),e.container=e.toolbar=e.edit=e.menu=null,e.dialogs=[],e.isCreated=!1,e):e},resize:function(e,t){var n=this;return e!==null&&_removeUnit(e)>n.minWidth&&n.container.css("width",_addUnit(e)),t!==null&&n.toolbar.div&&n.statusbar&&(t=_removeUnit(t)-n.toolbar.div.height()-n.statusbar.height(),t>0&&_removeUnit(t)>n.minHeight&&n.edit.setHeight(t)),n},select:function(){return this.isCreated&&this.cmd.select(),this},html:function(e){var t=this;return e===undefined?t.isCreated?t.edit.html():_elementVal(t.srcElement):(t.isCreated?t.edit.html(e):_elementVal(t.srcElement,e),t)},fullHtml:function(){return this.isCreated?this.edit.html(undefined,!0):""},text:function(e){var t=this;return e===undefined?_trim(t.html().replace(/<(?!img|embed).*?>/ig,"").replace(/&nbsp;/ig," ")):t.html(_escape(e))},isEmpty:function(){return _trim(this.text().replace(/\r\n|\n|\r/,""))===""},isDirty:function(){return _trim(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==_trim(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){return this.isCreated?this.cmd.range.html():""},count:function(e){var t=this;return e=(e||"html").toLowerCase(),e==="html"?_removeBookmarkTag(_removeTempTag(t.html())).length:e==="text"?t.text().replace(/<(?:img|embed).*?>/ig,"K").replace(/\r\n|\n|\r/g,"").length:0},exec:function(e){e=e.toLowerCase();var t=this,n=t.cmd,r=_inArray(e,"selectall,copy,paste,print".split(","))<0;return r&&t.addBookmark(!1),n[e].apply(n,_toArray(arguments,1)),r&&(t.updateState(),t.addBookmark(!1),t.options.afterChange&&t.options.afterChange.call(t)),t},insertHtml:function(e,t,n){return this.isCreated?(e=this.beforeSetHtml(e),this.exec("inserthtml",e,t,n),this):this},appendHtml:function(e){this.html(this.html()+e);if(this.isCreated){var t=this.cmd;t.range.selectNodeContents(t.doc.body).collapse(!1),t.select()}return this},sync:function(){return _elementVal(this.srcElement,this.count("text")==0?"":this.html()),this},focus:function(){return this.isCreated?this.edit.focus():this.srcElement[0].focus(),this},blur:function(){return this.isCreated?this.edit.blur():this.srcElement[0].blur(),this},addBookmark:function(e){e=_undef(e,!0);var t=this,n=t.edit,r=n.doc.body,i=_removeTempTag(r.innerHTML),s;if(e&&t._undoStack.length>0){var o=t._undoStack[t._undoStack.length-1];if(Math.abs(i.length-_removeBookmarkTag(o.html).length)<t.minChangeSize)return t}if(n.designMode&&!t._firstAddBookmark){var u=t.cmd.range;s=u.createBookmark(!0),s.html=_removeTempTag(r.innerHTML),u.moveToBookmark(s)}else s={html:i};return t._firstAddBookmark=!1,_addBookmarkToStack(t._undoStack,s),t},undo:function(){return _undoToRedo.call(this,this._undoStack,this._redoStack)},redo:function(){return _undoToRedo.call(this,this._redoStack,this._undoStack)},fullscreen:function(e){return this.fullscreenMode=e===undefined?!this.fullscreenMode:e,this.remove().create()},readonly:function(e){e=_undef(e,!0);var t=this,n=t.edit,r=n.doc;t.designMode?t.toolbar.disableAll(e,[]):_each(t.noDisableItems,function(){t.toolbar[e?"disable":"enable"](this)}),_IE?r.body.contentEditable=!e:r.designMode=e?"off":"on",n.textarea[0].disabled=e},createMenu:function(e){var t=this,n=e.name,r=t.toolbar.get(n),i=r.pos();return e.x=i.x,e.y=i.y+r.height(),e.shadowMode=_undef(e.shadowMode,t.shadowMode),e.selectedColor!==undefined?(e.cls="ke-colorpicker-"+t.themeType,e.noColor=t.lang("noColor"),t.menu=_colorpicker(e)):(e.cls="ke-menu-"+t.themeType,e.centerLineMode=!1,t.menu=_menu(e)),t.menu},hideMenu:function(){return this.menu.remove(),this.menu=null,this},hideContextmenu:function(){return this.contextmenu.remove(),this.contextmenu=null,this},createXmDialog:function(e,t){var n=this;return this.xmDialogs=this.xmDialogs||{},this.xmDialogs[e.name]||(this.xmDialogs[e.name]=new XMDialog({width:e.width,height:e.height,html:e.html,okHandler:e._tagOkHanlder},n),t(this.xmDialogs[e.name])),this.xmDialogs[e.name]},removeXmDialog:function(e){this.xmDialogs[e]=null},createDialog:function(e){var t=this,n=e.name;e.shadowMode=_undef(e.shadowMode,t.shadowMode),e.closeBtn=_undef(e.closeBtn,{name:t.lang("close"),click:function(e){t.hideDialog(),_IE&&t.cmd&&t.cmd.select()}}),e.noBtn=_undef(e.noBtn,{name:t.lang(e.yesBtn?"no":"close"),click:function(e){t.hideDialog(),_IE&&t.cmd&&t.cmd.select()}}),t.dialogAlignType!="page"&&(e.alignEl=t.container),e.cls="ke-dialog-"+t.themeType;if(t.dialogs.length>0){var r=t.dialogs[0],i=t.dialogs[t.dialogs.length-1];r.setMaskIndex(i.z+2),e.z=i.z+3,e.showMask=!1}var s=_dialog(e);return t.dialogs.push(s),s},hideDialog:function(){var e=this;e.dialogs.length>0&&e.dialogs.pop().remove();if(e.dialogs.length>0){var t=e.dialogs[0],n=e.dialogs[e.dialogs.length-1];t.setMaskIndex(n.z-1)}return e},errorDialog:function(e){var t=this,n=t.createDialog({width:750,title:t.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'}),r=K("iframe",n.div),i=K.iframeDoc(r);return i.open(),i.write(e),i.close(),K(i.body).css("background-color","#FFF"),r[0].contentWindow.focus(),t}},_instances=[],K.remove=function(e){_eachEditor(e,function(e){this.remove(),_instances.splice(e,1)})},K.sync=function(e){_eachEditor(e,function(){this.sync()})},_IE&&_V<7&&_nativeCommand(document,"BackgroundImageCache",!0),K.EditorClass=KEditor,K.editor=_editor,K.create=_create,K.instances=_instances,K.plugin=_plugin,K.lang=_lang,_plugin("core",function(e){function i(){var t='<div style="padding:10px;">\n<div class="xmeditor-dialog-title">插入标签</div>\n                <div class="xmeditor-dialog-content">\n                    <span  class="xmeditor-input-tips">标签最多可输入10个字</span>\n                    <div > <input type="text" class="xmeditor-input" id="xmeditor-input-tag" placeholder="请输入标签内容"/> </div>\n                </div>\n                <div class="xmeditor-ok-btn disabled-btn" role-btn="ok">插入</div>\n                <div class="xmeditor-cancel-btn" role-btn="cancel" style="margin-left:10px;">取消</div></div>\n            ',n;return function(r,i){if(!n){n=new XMDialog({width:220,height:129,html:t,okHandler:i},r),e("#xmeditor-input-tag",n.$target).bind("keyup",function(t){if(e.trim(this.value)===""){e(".xmeditor-ok-btn",n.$target).addClass("disabled-btn");return}e(".xmeditor-ok-btn",n.$target).removeClass("disabled-btn");var r=this.value.replace(/[\u0391-\uFFE5]/g,"aa");r.length>=20?e(".xmeditor-dialog-content",n.$target).addClass("input-error"):e(".xmeditor-dialog-content",n.$target).removeClass("input-error"),t.keyCode===13&&e(".xmeditor-ok-btn",n.$target).click()}),n.bindEvent();var s=r.edit.doc;e(s).bind("keydown",function(e){if(e.keyCode===13){var t=r.cmd.val("tag");t==="font-size:16px;color:#ffffff;background:#fc5832;display:inline-block;"&&e.preventDefault()}})}return n}}function o(e){this.dialog=e,this.bindEvent()}function v(e,t){t=t||{};var n=e.children;if(n.length)for(var r=0;r<n.length;r++)t[n[r].nodeName.toLowerCase()]=!0,v(n[r],t);return t}function g(e,t){this.dialog=e,this.data=t||{},this.bindEvent()}var t=this,n={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};t.afterSetHtml(function(){t.options.afterChange&&t.options.afterChange.call(t)}),t.afterCreate(function(){if(t.syncType!="form")return;var n=e(t.srcElement),r=!1;while(n=n.parent())if(n.name=="form"){r=!0;break}if(r){n.bind("submit",function(n){t.sync(),e(window).bind("unload",function(){t.edit.textarea.remove()})});var i=e('[type="reset"]',n);i.click(function(){t.html(t.initContent),t.cmd.selection()}),t.beforeRemove(function(){n.unbind(),i.unbind()})}e("p",t.edit.doc).each(function(){var n=e(this).attr("data-flag");n||(this.style.cssText=_NORMAL_FORMAT,e(this).attr("data-flag","normal"),e(this).attr("lang","en")),e("span",e(this)).each(function(){var n=e(this).attr("data-flag"),r=e(this).attr("style"),i=t.cmd.commonNode({a:"*"});!n&&r&&!i&&(this.style.cssText=_NORMAL_FORMAT)})});var s=t.items||[],o=s.join(",");/^b,|(?:,b,)|^b$|,b$/.test(o)?/^customstrong,|(?:,customstrong,)|^customstrong$|,customstrong$/.test(o)||e("strong",t.edit.doc).each(function(){var t=this.innerHTML;e(this).replaceWith("<b>"+t+"</b>")}):e("b",t.edit.doc).each(function(){var t=this.innerHTML;e(this).replaceWith("<strong>"+t+"</strong>")}),e("strong",t.edit.doc).each(function(){var t=e(this).attr("data-flag");this.style.cssText=_STRONG_FORMAT,e(this).attr("data-flag","strong")})}),t.clickToolbar("source",function(){t.edit.designMode?(t.toolbar.disableAll(!0),t.edit.design(!1),t.toolbar.select("source")):(t.toolbar.disableAll(!1),t.edit.design(!0),t.toolbar.unselect("source")),t.designMode=t.edit.designMode}),t.afterCreate(function(){t.designMode||t.toolbar.disableAll(!0).select("source")}),t.clickToolbar("fullscreen",function(){t.fullscreen()});if(t.fullscreenShortcut){var r=!1;t.afterCreate(function(){e(t.edit.doc,t.edit.textarea).keyup(function(e){e.which==27&&setTimeout(function(){t.fullscreen()},0)});if(r){if(_IE&&!t.designMode)return;t.focus()}r||(r=!0)})}_each("undo,redo".split(","),function(e,r){n[r]&&t.afterCreate(function(){_ctrl(this.edit.doc,n[r],function(){t.clickToolbar(r)})}),t.clickToolbar(r,function(){t[r]()})});var s=i();t.clickToolbar("tag",function(){function i(){var n=e("#xmeditor-input-tag",r.$target).val();if(e.trim(n)===""||e(".xmeditor-dialog-content",r.$target).hasClass("input-error"))return;t.cmd.inserthtml('<p ><span data-flag="tag" style="background:#FC5832;font-size:16px;color :#fff;padding: 5px;margin:10px 0px;display:inline-block;">'+n+"</span><span>&nbsp;</span></p>"),r.hide(),e("#xmeditor-input-tag",r.$target).val(""),e(".xmeditor-ok-btn",r.$target).addClass("disabled-btn")}var n=t.edit.doc,r=s(t,i);r.show(t.toolbar.get("tag"))}),o.prototype={uploadImage:function(t){var n=this,r=n.dialog.$target,i=document.createElement("iframe");i.setAttribute("id","upload_iframe"),i.setAttribute("name","upload_iframe"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("border","0"),i.setAttribute("style","width: 0; height: 0; border: none;position: absolute;"),t.parentNode.appendChild(i),window.frames.upload_iframe.name="upload_iframe";var s=document.getElementById("upload_iframe");t.target="upload_iframe";var o,u=function(){var t;s.detachEvent?s.detachEvent("onload",u):s.removeEventListener("load",u,!1);try{n.dialog.setTasking(!1),s.contentDocument?o=s.contentDocument.body.innerHTML:s.contentWindow?o=s.contentWindow.document.body.innerHTML:s.document&&(o=s.document.body.innerHTML),o.replace(/<pre[^>]*>([^<]*)<\/pre>/g,function(e,t){o=t}),t=e.json(o),n.uploadComplate(s,"uploadComplate",t)}catch(r){window.console&&console.log(r),n.uploadComplate(s,"uploadComplate",null)}};s.addEventListener&&s.addEventListener("load",u,!0),s.attachEvent&&s.attachEvent("onload",u),t.submit()},uploadComplate:function(n,r,i,s){var o=this,u=o.dialog.$target;if(i){if(i.ret==50001)return e(".xmeditor-ok-btn",u).html("插入"),n&&setTimeout(function(){n.parentNode.removeChild(n)},250),initVCodeImg().callModal(i.data),!1;s?(i.attr=i.attr||[],i.attr.push({name:"style",value:"width:100%;"}),t.exec("insertimage",i.url,i.title,i.width,i.height,i.border,i.align,i.attr),o.dialog.hide()):i&&(i=t.uploadImageSuccess&&t.uploadImageSuccess(i))&&(i.error!==0?alert(i.msg||"上传失败，请重新上传"):(i.attr&&i.attr.push({name:"style",value:"width:100%;"}),t.exec("insertimage",i.url,i.title,i.width,i.height,i.border,i.align,i.attr),o.dialog.hide(),e("#xmeditor-select-file",u).val(""),e(".xmeditor-input",u).val("")))}else alert("上传失败，请重新上传");e(".xmeditor-ok-btn",u).html("插入"),n&&setTimeout(function(){n.parentNode.removeChild(n)},250)},bindEvent:function(){var n=this,r=n.dialog.$target;e(".xmeditor-dialog-tabber-item",r).bind("click",function(t){var n=e(t.target).attr("data-class");if(e("."+n,r).hasClass("on"))return!1;e(".tabber-container",r).removeClass("on"),e("."+n,r).addClass("on"),e(".xmeditor-dialog-tabber-item",r).removeClass("on"),e(this).addClass("on")}),e('[name="localUrl"]',r).bind("change",function(t){e(".xmeditor-input",r).val(e(this).val())}),e(".xmeditor-ok-btn",r).bind("click",function(i){if(e(".xmeditor-internet-img",r).hasClass("on")){var s=e(".xmeditor-input",r).val();if(s=="")return;n.uploadComplate(null,"uploadComplate",{url:s},!0)}else{var s=e('[name="localUrl"]',r).val();if(s=="")return;if(n.dialog.tasking)return;t.uploadImageBefore(s),n.dialog.setTasking(!0),e(this).html("上传中...."),n.uploadImage(e("form",r)[0])}})}};var u=function(e,t){if(e===t)return t;if(e.nodeType===3)return null;if(e.children.length)for(var n=0;n<e.children.length;n++){var r=u(e.children[n],t);if(r)return r}return null},a,f=t.fileAccept||"image/jpg,image/jpeg,image/png,image/gif,image/bmp",l=t.localUrl||"localUrl",c=e.undef(t.uploadJson,t.basePath+"php/upload_json.php"),h='<div style="padding:10px;" unselectable="on"><div class="xmeditor-dialog-title" unselectable="on">插入图片</div><div class="xmeditor-dialog-content" unselectable="on">    <div class="xmeditor-dialog-tabbar" unselectable="on"> <a class="xmeditor-dialog-tabber-item on" unselectable="on" data-class="xmeditor-internet-img">网络图片</a>        <a class="xmeditor-dialog-tabber-item mgt-left-20" unselectable="on" data-class="xmeditor-local-img">本地图片</a>     </div>    <div class="tabber-container xmeditor-internet-img on" unselectable="on">        <input type="text" class="xmeditor-input" unselectable="on" name="xmEditorInterInputImg" id="xmEditorInterInputImg" placeholder="图片地址"/>    </div>    <div class="tabber-container xmeditor-local-img" unselectable="on">         <form id="xmeditor-uploadImg-form"  method="post" enctype="multipart/form-data"  action="'+e.addParam(c,"dir=image")+'">'+'            <input type="text" class="xmeditor-input" unselectable="on" style="width:65%;" readonly name="xmEditorLocalInputImg" id="xmEditorInterInputImg" placeholder="上传图片"/>'+'            <div style="display:inline-block;">'+'                <input type="file" accept="'+f+'" unselectable="on" id="xmeditor-select-file" name="'+l+'" style="width: 62px;display: inline;position: absolute;height: 21px;filter: alpha(opacity=0);-moz-opacity:0.0;opacity: 0;">'+'                <span class="xmeditor-dialog-btn select-image" unselectable="on" >浏览</span>'+"            </div>"+"        </form>"+"    </div>"+"</div>"+'<div class="xmeditor-ok-btn" role-btn="ok" unselectable="on">插入</div>'+'<div class="xmeditor-cancel-btn" role-btn="cancel" style="margin-left:10px;" unselectable="on">取消</div></div> ';t.clickToolbar("customimage",function(){var e=t.edit.doc;t.focus();var n=t.createXmDialog({name:"image",width:260,html:h},function(t){a=new o(t),t.bindEvent()});n.show(t.toolbar.get("customimage"))});var p={normal:"p",subtitle:"h2",strong:"span",backup:"p"},d={normal:{"font-size":"16px",color:"#333333","line-height":"30px","font-weight":"normal","word-break":"break-all","font-family":"Helvetica,Arial,sans-serif"},subtitle:{"font-size":"17px",color:"#333333","line-height":"30px",margin:"10px 0px","font-weight":"900"},strong:{color:"#FC5832","word-break":"break-all"},backup:{"font-size":"14px",color:"#999999","line-height":"24px","font-weight":"normal","word-break":"break-all"}};t.clickToolbar("customformat",function(){var n=t.edit.doc;curVal=t.cmd.val("customformat"),menu=t.createMenu({name:"customformat",width:t.langType=="en"?200:150}),blocks={normal:"正文",subtitle:"副标题",backup:"备注"},_each(blocks,function(n,r){var i=!1;curVal==n&&(i=!0);var s={normal:"font-size:16px;color:#333333;",subtitle:"font-size:17px;color:#333333;margin:10px 0px;font-weight:900",strong:"color:#FC5832;",backup:"font-size:15px;color:#999999;"};menu.addItem({title:'<span style="'+s[n]+'" unselectable="on">'+r+"</span>",height:34,checked:i,click:function(){var r=t.cmd.range,i=p[n];i="p",t.select().exec("formatblock","<"+i+">"),r=t.cmd.select().range;var s=new KNode(r.startContainer),o=new KNode(r.endContainer),u=r.startOffset,a=r.endOffset,f=r.commonAncestor();s.name=="body"&&(s=new KNode(r.startContainer.childNodes[r.startOffset?r.startOffset-1:0]),o=new KNode(r.endContainer.childNodes[a]));if(n!=="normal"&&n!=="backup"&&p[n]!=="h2"||!s.findBlockParent("blockquote")){!r.collapsed&&r.enlarge();if(r.collapsed||r.startContainer==r.endContainer||r.startContainer.parentNode==r.endContainer.parentNode&&!e(r.startContainer).isBlock()){var l=s.findBlockParent(i);r.selectNode(l[0])}t.cmd.wrap('<p class="_temp_wrap"></p>');var c=e("._temp_wrap p",t.cmd.doc).attr({"data-flag":n,style:""}).css(d[n]);e("._temp_wrap span",t.cmd.doc).removeAttr("data-flag").attr({style:""}).css(d[n]),e("._temp_wrap",t.cmd.doc).remove(!0),c[0]&&c[0].lastChild&&r.selectNode(c[0].lastChild),r.collapse(!1),t.cmd.select(!1),t.hideMenu();return}return t.hideMenu()}})})}),t.clickToolbar("customstrong",function(){var e=t.cmd.val("customformat");if(e!=="subtitle"){var n="strong",r=t.cmd.val("customstrong")=="strong";if(r&&t.cmd.range.collapsed){var i=t.cmd.commonNode({strong:"*"});i[0]&&t.cmd.range.selectNode(i[0])}t.cmd.toggle('<strong style="'+_STRONG_FORMAT+'"></strong>',{span:".font-weight=bold",strong:"*",b:"*"}),t.cmd.select(),t.updateState()}});var m='<div style="padding:10px;" unselectable="on"><div class="xmeditor-dialog-title" unselectable="on" >插入超链接</div><div class="xmeditor-dialog-content" unselectable="on">    <div class="xmeditor-dialog-tabbar" unselectable="on" style="padding:5px 0px;">     </div>    <div class="xeditor-link-name on" style="font-size:12px;color:#666;margin-top:10px;" unselectable="on">        <span class="j-xeditor-link-name" style="word-break: break-all;"></span>    </div>    <div class="tabber-container on" unselectable="on">        <input type="text" class="xmeditor-input" unselectable="on" name="linkName" placeholder="链接地址"/>    </div>    <div >        <span class="xmeditor-link-tips" style="color:#F43530;font-size:12px;">注：只允许添加ximalaya.com域名下的内部链接地址</span>    </div></div><div class="xmeditor-ok-btn" role-btn="ok" unselectable="on">插入</div><div class="xmeditor-cancel-btn j-xmeditor-cancle-link " role-btn="cancel" style="margin-left:10px;margin-right:-5px;display:none;" unselectable="on">删除链接</div> <div class="xmeditor-cancel-btn j-xmeditor-cancle" role-btn="cancel" style="margin-left:10px;" unselectable="on">取消</div></div> ';g.prototype.bindEvent=function(){var n=this,r=this.dialog.$target,i=this.dialog;this.data.url&&e("input",r).val(url),e(".xmeditor-ok-btn",r).bind("click",function(){var n=e("input",r).val();n=n.replace(/^\s*|\s*$/g,"");if(!/^((http||https):\/\/)?(\w|\d|\.|-)+\.ximalaya\.com/.test(n)){alert("只允许添加ximalaya.com域名下的内部链接地址");return}/^(http||https):\/\//.test(n)||(n="http://"+n),t.cmd.createlink(n),e("input",r).val(""),i.hide()}),e(".j-xmeditor-cancle",r).bind("click",function(){e("input",r).val("")}),e("input",r).bind("keyup",function(){var t=e("input",r).val();t=t.replace(/^\s*|\s*$/g,""),n.name||(e(".j-xeditor-link-name",r).get().textContent="链接名称："+t)}),e(".j-xmeditor-cancle-link",r).bind("click",function(){t.cmd.unlink(),t.cmd.selection(),t.updateState(),e("input",r).val(""),i.hide()})},g.prototype.setName=function(t){this.name=t||"";var n=this.dialog.$target;e(".j-xeditor-link-name",n).get().textContent="链接名称："+t},g.prototype.setInputVal=function(t){if(!t)e(".j-xmeditor-cancle-link",n).css("display","none");else{var n=this.dialog.$target;e(".j-xmeditor-cancle-link",n).css("display",""),e("input",n).val(t)}};var y;t.clickToolbar("customlink",function(){var e=this,t=e.cmd.doc,n=e.cmd.range,r=e.cmd.val("customlink");r.isA&&n.selectNodeContents(r.target),e.select();var i=e.createXmDialog({name:"customlink",width:265,html:m},function(t){y=new g(t),t.bindEvent()}),s=n.toString();y.setName(s),y.setInputVal(r.url),i.show(e.toolbar.get("customlink"))}),t.clickToolbar("formatblock",function(){var e=t.lang("formatblock.formatBlock"),n={h1:28,h2:24,h3:18,H4:14,p:12},r=t.cmd.val("formatblock"),i=t.createMenu({name:"formatblock",width:t.langType=="en"?200:150});_each(e,function(e,s){var o="font-size:"+n[e]+"px;";e.charAt(0)==="h"&&(o+="font-weight:bold;"),i.addItem({title:'<span style="'+o+'" unselectable="on">'+s+"</span>",height:n[e]+12,checked:r===e||r===s,click:function(){t.select().exec("formatblock","<"+e+">").hideMenu()}})})}),t.clickToolbar("fontname",function(){var e=t.cmd.val("fontname"),n=t.createMenu({name:"fontname",width:150});_each(t.lang("fontname.fontName"),function(r,i){n.addItem({title:'<span style="font-family: '+r+';" unselectable="on">'+i+"</span>",checked:e===r.toLowerCase()||e===i.toLowerCase(),click:function(){t.exec("fontname",r).hideMenu()}})})}),t.clickToolbar("fontsize",function(){var e=t.cmd.val("fontsize"),n=t.createMenu({name:"fontsize",width:150});_each(t.fontSizeTable,function(r,i){n.addItem({title:'<span style="font-size:'+i+';" unselectable="on">'+i+"</span>",height:_removeUnit(i)+12,checked:e===i,click:function(){t.exec("fontsize",i).hideMenu()}})})}),_each("forecolor,hilitecolor".split(","),function(e,n){t.clickToolbar(n,function(){t.createMenu({name:n,selectedColor:t.cmd.val(n)||"default",colors:t.colorTable,click:function(e){t.exec(n,e).hideMenu()}})})}),_each("cut,copy,paste".split(","),function(e,n){t.clickToolbar(n,function(){t.focus();try{t.exec(n,null)}catch(e){alert(t.lang(n+"Error"))}})}),t.clickToolbar("about",function(){var e='<div style="margin:20px;"><div>KindEditor '+_VERSION+"</div>"+'<div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div>'+"</div>";t.createDialog({name:"about",width:300,title:t.lang("about"),body:e})}),t.plugin.getSelectedLink=function(){return t.cmd.commonAncestor("a")},t.plugin.getSelectedImage=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return!/^ke-\w+$/i.test(e[0].className)})},t.plugin.getSelectedFlash=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-flash"})},t.plugin.getSelectedMedia=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-media"||e[0].className=="ke-rm"})},t.plugin.getSelectedAnchor=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-anchor"})},_each("link,flash,media,anchor".split(","),function(e,n){var r=n.charAt(0).toUpperCase()+n.substr(1);_each("edit,delete".split(","),function(e,i){t.addContextmenu({title:t.lang(i+r),click:function(){t.loadPlugin(n,function(){t.plugin[n][i](),t.hideMenu()})},cond:t.plugin["getSelected"+r],width:150,iconClass:i=="edit"?"ke-icon-"+n:undefined})}),t.addContextmenu({title:"-"})}),t.plugin.getSelectedTable=function(){return t.cmd.commonAncestor("table")},t.plugin.getSelectedRow=function(){return t.cmd.commonAncestor("tr")},t.plugin.getSelectedCell=function(){return t.cmd.commonAncestor("td")},_each("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,rowsplit,colsplit,coldelete,rowdelete,insert,delete".split(","),function(e,n){var r=_inArray(n,["prop","delete"])<0?t.plugin.getSelectedCell:t.plugin.getSelectedTable;t.addContextmenu({title:t.lang("table"+n),click:function(){t.loadPlugin("table",function(){t.plugin.table[n](),t.hideMenu()})},cond:r,width:170,iconClass:"ke-icon-table"+n})}),t.addContextmenu({title:"-"}),_each("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript,hr,print,bold,b,italic,underline,strikethrough,removeformat,unlink".split(","),function(e,r){n[r]&&t.afterCreate(function(){_ctrl(this.edit.doc,n[r],function(){t.cmd.selection(),t.clickToolbar(r)})}),t.clickToolbar(r,function(){t.focus().exec(r,null)})}),t.afterCreate(function(){function a(){r.range.moveToBookmark(i),r.select(),_WEBKIT&&(e("div."+o,s).each(function(){e(this).after("<br />").remove(!0)}),e("span.Apple-style-span",s).remove(!0),e("span.Apple-tab-span",s).remove(!0),e("span[style]",s).each(function(){e(this).css("white-space")=="nowrap"&&e(this).remove(!0)}),e("meta",s).remove());var n=s[0].innerHTML;s.remove();if(n==="")return;t.pasteType===2&&(/schemas-microsoft-com|worddocument|mso-\w+/i.test(n)?n=_clearMsWord(n,t.filterMode?t.htmlTags:e.options.htmlTags):(n=_formatHtml(n,t.filterMode?t.htmlTags:null),n=t.beforeSetHtml(n))),t.pasteType===3&&(/schemas-microsoft-com|worddocument|mso-\w+/i.test(n)?n=_clearMsWord(n,t.filterMode?t.htmlTags:e.options.htmlTags):(n=_formatHtml(n,t.filterMode?t.htmlTags:null),n=t.beforeSetHtml(n)),n=n.replace(/<img[^>]+>/g,"")),t.pasteType===1&&(n=n.replace(/<br[^>]*>/ig,"\n"),n=n.replace(/<\/p><p[^>]*>/ig,"\n"),n=n.replace(/<[^>]+>/g,""),n=n.replace(/&nbsp;/ig," "),n=n.replace(/\n\s*\n/g,"\n"),n=n.replace(/ {2}/g," &nbsp;"),t.newlineTag=="p"?/\n/.test(n)&&(n=n.replace(/^/,"<p>").replace(/$/,"</p>").replace(/\n/g,"</p><p>")):n=n.replace(/\n/g,"<br />$&")),n=n.replace(/<([\/]?div)/g,function(e,t){return t==="div"?'<p data-init="paster"':"</p"});var u=!0;n=_formatHtml(n,e.options.pasteFilteTags,void 0,void 0,void 0,u,t.items),t.insertHtml(n,!0,u)}var n=t.edit.doc,r,i,s,o="__kindeditor_paste__",u=!1;e(n.body).bind("paste",function(f){if(t.pasteType===0){f.stop();return}if(u)return;u=!0,e("div."+o,n).remove(),r=t.cmd.selection(),i=r.range.createBookmark(),s=e('<div class="'+o+'"></div>',n).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:e(i.start).pos().y+"px","white-space":"nowrap"}),e(n.body).append(s);if(_IE){var l=r.range.get(!0);l.moveToElementText(s[0]),l.select(),l.execCommand("paste"),f.preventDefault()}else r.range.selectNodeContents(s[0]),r.select();setTimeout(function(){a(),u=!1},0)})}),t.beforeGetHtml(function(e){return e.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/ig,function(e,t,n,r){return t+_unescape(n).replace(/\s+/g," ")+r}).replace(/<img[^>]*class="?ke-(flash|rm|media)"?[^>]*>/ig,function(e){var t=_getAttrList(e),n=_getCssList(t.style||""),r=_mediaAttrs(t["data-ke-tag"]);return r.width=_undef(t.width,_removeUnit(_undef(n.width,""))),r.height=_undef(t.height,_removeUnit(_undef(n.height,""))),_mediaEmbed(r)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/ig,function(e){var t=_getAttrList(e);return'<a name="'+unescape(t["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/ig,function(e,t,n){return"<script"+unescape(t)+">"+unescape(n)+"</script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/ig,function(e,t,n){return"<noscript"+unescape(t)+">"+unescape(n)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/ig,function(e,t,n,r){return e=e.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(e,t,r){return t+_unescape(n)+r}),e=e.replace(/\s+data-ke-src="[^"]*"/i,""),e}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/ig,function(e,t,n){return t+n})}),t.beforeSetHtml(function(e){return e.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/ig,function(e){var n=_getAttrList(e);return n.src=_undef(n.src,""),n.width=_undef(n.width,0),n.height=_undef(n.height,0),_mediaImg(t.themesPath+"common/blank.gif",n)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/ig,function(e){var n=_getAttrList(e);return n.href!==undefined?e:'<img class="ke-anchor" src="'+t.themesPath+'common/anchor.gif" data-ke-name="'+escape(n.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/ig,function(e,t,n){return'<div class="ke-script" data-ke-script-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/ig,function(e,t,n){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/ig,function(e,t,n,r,i){return e.match(/\sdata-ke-src="[^"]*"/i)?e:(e=t+n+'="'+r+'"'+' data-ke-src="'+_escape(r)+'"'+i,e)}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/ig,function(e,t,n){return t+"data-ke-"+n}).replace(/<table[^>]*\s+border="0"[^>]*>/ig,function(e){return e.indexOf("ke-zeroborder")>=0?e:_addClassToTag(e,"ke-zeroborder")})})})}(window),define("plugin/kindeditor/kindeditor",function(){}),define("module/common/form_editor",["jquery","plugin/dialog","plugin/kindeditor/kindeditor"],function(e,t){function l(n,r,i,s,o){var f=this.obj,l=this.$cform;if(!a){var c=s.indexOf("customlink");c!==-1&&s.splice(c,1)}return KindEditor.create('textarea[name="'+n+'"]',{basePath:r,themesPath:i,resizeType:1,themeType:"simple",pasteType:2,width:"auto",height:400,newlineTag:"p",allowPreviewEmoticons:!1,uploadJson:"/dtres/picture/upload/crossdomain",fillDescAfterUploadImage:!0,imageData:{},cssData:"body {margin : 25px 25px 25px 25px;font-size:16px;color:#333;} img[data-key],img[data-origin] {width:100%;margin-top:10px;margin-bottom:10px;} ",afterCreate:function(){var t=this.text(),n=e('input[data-name="'+f.name+'"]').parent();return!t&&f.isHidden?(n.find(".ke-container").hide(),n.find(".textarea-shou").show()):(n.find(".ke-container").show(),n.find(".textarea-shou").hide()),f.afterHtml&&f.afterHtml.call(this),!0},uploadImageBefore:function(e){console.log(e),this.focus();var n="";return h(e)||(n="请上传正确的图片"),n?(t.alert(n),this.hideDialog(),!1):!0},uploadImageSuccess:function(e){var t={};if(e.status){var n=e.data[0].processResult,r=/gif$/.test(n.origin);r||(u=/test\./.test(window.location.href)?"http://fdfs.test.ximalaya.com":"http://image.xmcdn.com");var i=n.id,s=u+"/"+n.origin,o=n.origin_width,f=n.origin_height;this.imageData[s]=i;if(!a&&r)return t.msg="目前不支持gif格式的图片哦～",t.ret=-1,t;if(r&&(o!=375||f>667))return t.msg="请上传宽度为375px，高度≤667px的gif",t.ret=-1,t;var l=s+(r?"":"?op_type=4&device_type=ios&upload_type=attachment&name=mobile_large"),c=s+(r?"":"?op_type=4&device_type=ios&upload_type=attachment&name=mobile_small"),h=r?o:750,p=parseInt(parseInt(f)/parseInt(o)*h),d=r?o:140,v=parseInt(parseInt(f)/parseInt(o)*d),m=[];m.push({name:"data-origin",value:s+"?op_type=0"}),m.push({name:"data-large",value:l}),m.push({name:"data-large-width",value:h}),m.push({name:"data-large-height",value:p}),m.push({name:"data-preview",value:c}),m.push({name:"data-preview-width",value:d}),m.push({name:"data-preview-height",value:v}),url=l,t={error:0,url:url,attr:m}}else t=e,t.error=e.ret;return t},uploadImageError:function(e){this.hideDialog()},afterFocus:function(){var e=l.find('textarea[name="'+n+'"]');o.onfocus&&o.onfocus.call(this)},afterBlur:function(){this.sync(),o.onblur.call(this);var e=this.html(),t=this.text()},afterChange:function(){o.onChanges&&o.onChanges()},allowImageUpload:!0,items:s,htmlTags:{span:["style","data-flag"],div:[],p:["style","data-flag"],h2:["style","data-flag"],blockquote:["style"],strong:["style"],hr:["style"],a:["href","target","title","alt",".text-decoration"],img:["src","alt","title","align","data-origin","data-large","data-large-width","data-large-height","data-preview","data-preview-height","data-preview-width","data-key"],"li,br":[],"br,tbody,tr,b,sub,sup,em,i,u,strike,s,del":[]}})}function c(t,n,r){var i=this.$cform;if(r){r.sync();var s=r.html(),o=s.replace(/<(?!br|img)[^>]+>/g,"");o=o.replace(/(\n|\s)/g,"&nbsp;"),o=o.replace(/(&nbsp;)+/ig," "),o=o.replace(/^<br[^>]+>$/,""),o=o.replace(/(<[^>]+>)+/g," "),o=o.replace(/^\s+$/g,""),o=="<br>"&&(o=""),t&&e("[name='"+t+"']").val(o);var u=i.find("[name='"+t+"_images']"),a=[];for(var f in r.imageData)o.indexOf(f)!=-1&&a.push(r.imageData[f]);u.val(a.join(","))}else t&&i.find("[name='"+t+"']").val(i.find("[name='"+n+"']").val())}function h(t){var n=["gif","jpg","jpeg","png","bmp"],r=t,i=r.split(/\//);e.inArray("jpg",n)&&!e.inArray("jpeg",n)&&n.push("jpeg"),e.inArray("jpeg",n)&&!e.inArray("jpg",n)&&n.push("jpg");var s=n.join("|").toLowerCase(),o=new RegExp(""+s+"$");return o.test(r.toLowerCase())}var n=config.STATIC_ROOT+"/js/plugin/kindeditor/",r=config.STATIC_ROOT+"/css/plugin/kindeditor/themes/",i=["customformat","b","customstrong","customimage","tag","blockquote","hr","customlink"],s=config.DIRECT_DTRES_ROOT+"/album/upload",o=config.STATIC_ROOT+"/css/img/record/image.gif",u=config.FDFS_PATH||"http://fdfs.x.com/",a,f=function(e,t){t=t||{},this.$cform=e,this.richEditor={},a=t.allowEditorLink};return f.prototype={initRichEditor:function(t){var s=this;this.richEditor[t.name]=null,this.obj=t;var o=l.call(this,t.richName,n,r,t.items||i,{onblur:function(){c.call(s,t.name,t.richName,o),t.onblur&&t.onblur.call(this),t.isShowText&&u(this)},onfocus:function(){t.onfocus&&t.onfocus.call(this),t.isShowText&&u(this,!0)},onChanges:function(){t.onchange&&t.onchange.call(this);if(s.richEditor[t.name]===null)return;var n=t.syncSize&&s.flushIntoSize(e('input[data-name="'+t.name+'"]'));n&&s.limitImg(e('input[data-name="'+t.name+'"]'),10)}}),u=function(n,r){var i=e('input[data-name="'+t.name+'"]').parent();if(n){n.sync();var s=n.text();r?i.find(".placeholder").addClass("hidden"):!r&&s===""&&i.find(".placeholder").removeClass("hidden")}};return this.richEditor[t.name]=o,this.richEditor[t.name]._options=t,o},limitImg:function(t,n){var r="",i;typeof t=="string"?r=t:r=t.attr("name")||t.attr("data-name");var s=this.richEditor[r],o=s._options.richName;typeof t=="string"?i=e('textarea[name="'+o+'"]').parent():i=t.parent();var u=/<img/g,a,f=0,l="",c=s.html();while(a=u.exec(c))f++;f>n&&(l="最多只能添加"+n+"张图片"),l?this.setError(i,l):this.setRight(i)},flushIntoSize:function(e,t,n,r){var i=this,s=this.richEditor[e.attr("name")||e.attr("data-name")],o=e.attr("data-params");o&&(o=JSON.parse(o),t=t||o.minSizeLimit||0,n=n||o.maxSizeLimit,r=r||o.must||!1,e.attr("data-params",JSON.stringify({minSizeLimit:t,maxSizeLimit:n,must:r})));var u=s.text().replace(/\r\n|\n|\r/g,""),a=this.$el,f=this.getCount(s),l=parseInt(t-f),c=e.parent().attr("data-name")||e.parent().find("lable").text();c=c.replace("*","");var h=e.parent().find(".tips").attr("data-def");e.parent().find(".js-intro-min-size-tips").removeClass("hidden");if(f!==0&&l>0)return e.parent().find(".js-intro-min-size-tips").html('加油，还差<span class="c04">'+l+"</span>个字！"),e.parent().addClass("is-error"),!1;e.parent().find(".js-intro-min-size-tips").html("棒棒哒！精彩的介绍会吸引更多听众哟~"),e.parent().removeClass("is-error");if(f>n)return e.parent().find(".tips").html(c+"不能超过"+n+"字"),e.parent().addClass("is-error"),!1;e.parent().find(".tips").html(""),h&&e.parent().find(".tips").html(h),e.parent().removeClass("is-error");if(f===0&&r){e.parent().addClass("is-error");if(h)return e.parent().find(".tips").html("请填写"+c),!1}else f===0&&!r&&e.parent().removeClass("is-error");return!0},setError:function(e,t){var n=e.addClass("is-error").find(".tips").html(t)},setRight:function(e){var t=e.removeClass("is-error").find(".tips"),n=t.attr("data-def");t.html(n||"")},getCount:function(e){var t=e.html();t=t.replace(/>(\r\n|\n|\r|\s)*</g,"><");var n=t.replace(/<[^>]+>/g,"");return n=n.replace(/\r\n|\n|\r/g,""),n=n.replace(/(&nbsp;)+/ig," "),n=n.replace(/(<[^>]+>)+/g,""),n=n.replace(/^\s+$/g,""),n.length}},f}),define("module/common/form_uploadimg",["jquery","plugin/dialog","module/uploadimg"],function(e,t,n){var r=config.DIRECT_DTRES_ROOT+"/album/upload",i=config.STATIC_ROOT+"/css/img/record/image.gif",s=config.FDFS_PATH||"http://fdfs.x.com/",o=function(e,t){this.$cform=e,this.opt=t,this.richEditor={}};return o.prototype={uploadImgInit:function(i){var i=i||this.opt||{};this.opt=i;var o,u=i.picBtn||e("#uploadPicBtn"),a=i.imgWrap||e("#imageWrap"),f=i.imgBox||a.find(".imgBox2"),l=f.find("img"),c=i.limitWidth,h=i.limitHeight,p=i.url||r,d=i.tips;o=new n({url:p,$el:u,maxSize:3,file_upload_limit:1,repeat:!0,file_queued_handler:function(e){f.addClass("is-loading")},error:function(e,t){f.removeClass("is-loading")},success:function(e,n,r){function g(e,t){f.attr("src",e).removeClass("is-loading").addClass("is-fenmian").find("img").attr("src",e).end().find("input").val(t)}var i=e.data[0].processResult,o=s+"/"+i[100],l=s+"/"+i.origin,p=v(e),m=u.parent().find(".tips");m.html(m.attr("data-def")),a.parent().removeClass("is-error"),d&&u.parent().find(".tips").html(d).end(),u.attr("id")=="uploadPicBtn"?u.siblings(".suc-tip").removeClass("hidden"):"";var y=new Image;y.src=l,c&&h?y.onload=function(){if(c!==this.width||h!==this.height){t.alert("请上传"+c+"*"+h+"像素的图片"),f.removeClass("is-loading");return}g(l,i.origin)}:g(o,p)}});var v=function(e){var t={};return t.status=e.status,t.data=[{processResult:e.data[0].processResult,uploadTrack:e.data[0].uploadTrack}],JSON.stringify(t)};return o}},o}),define("module/dialogs/albumPreview",["jquery","plugin/dialog","plugin/pops","plugin/perfect-scrollbar/perfect-scrollbar.jquery"],function(e,t,n){var r={pop:function(e){var t=this._template(e),r={template:{dialog_close:"",dialog_header:"",dialog_body:'<div class="bd " dialog-role="body"></div>'},dialogClass:"pop-sound-preview popAlbPrev",header:"",fixed:!1,content:t,noheadDrop:!0,overlayer:{clickClose:!1}},i=new n.Modal({containerClass:"maskers hidden",dialogClass:"identy-pop pop-sound-preview popAlbPrev hidden",closeBtn:"sound-preview-close",template:'<div class="bd">'+t+"</div>"});i.open();var s=i.getEl()},_template:function(t){var n=t.soundFace||config.STATIC_PATH+"/lib/resource/last/css/img/default/album/150.jpg",r=(+(t.albumPrice||0)).toFixed(2),i=(+(t.discountPrice||r)).toFixed(2)||r,s=+(t.countSound||0),o=t.otherTitle||"",u=i,a=r,f=s?(i/s).toFixed(2):s;textareaNameObj=t.contentOption||{richIntro:"",personalDescription:"",outline:"",buyNotes:"",otherContent:"",masterRecommend:"",produceTeam:""},e.each(textareaNameObj,function(t,n){var r=e('textarea[name$="'+t+'"]').val().trim();r=r.replace(/href="([^"]*)"/g,'href="javascript:;"'),textareaNameObj[t]=r});var l=e.trim(textareaNameObj.achieve)?"":"hidden",c=e.trim(textareaNameObj.otherContent)?"":"hidden",h='<div class="sound-preview-close"><a href="javascript:;" dialog-role="close"> <i></i> <span>关闭预览</span></a></div><div class="sound-preview-phone"><div class="sound-content ps-container ps-active-y"><div class="buyintro-top"><h2 class="title">'+(t.title||"")+"</h2>"+'<span class="albPlayNum"> xxxx 万次播放</span>'+'<div class="pic">'+'<img src="'+n+'" alt="">'+"</div>"+"</div>"+'<div class="album-price">'+'<span class="album-subscribe fr">xxxx万人</span>'+'<span class="c-theme">'+'<ins class="album-price-old">'+u+"</ins>喜点"+"</span>"+'<del class="mgl-5">'+a+"喜点</del>"+"<p>"+"预计更新"+s+'期，每期只需<span class="c09">'+f+"喜点</span>"+"</p>"+"</div>"+'<section class="tagCoup mgb-10">'+'<span class="befIcon coupon">支持优惠券</span>'+'<span class="befIcon  free">分享免费听</span>'+'<span class="befIcon back">可退款 ></span>'+"</section>"+"<!-- s: 简介 -->"+'<section class="album-model bg-f mgb-10">'+'<p class="hr-under">'+'<span class="">简介</span>'+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.richIntro||"")+"</div>"+"</section>"+"<!-- e: 简介 -->"+"<!-- s: 大纲 -->"+'<section class="album-model bg-f mgb-10">'+'<p class="hr-under">'+'<span class="">大纲</span>'+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.outline||"")+"</div>"+"</section>"+"<!-- e: 大纲 -->"+"<!-- s: 主播 -->"+'<section class="album-model bg-f mgb-10">'+'<p class="hr-under">'+'<span class="">主播</span>'+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.personalDescription||"")+"</div>"+"</section>"+"<!-- e: 主播 -->"+"<!-- s: 大咖推荐 -->"+'<section class="album-model bg-f mgb-10">'+'<p class="hr-under ">'+'<span class="">大咖推荐</span>'+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.masterRecommend||"")+"</div>"+"</section>"+"<!-- e: 大咖推荐 -->"+"<!-- s: 购买须知 -->"+'<section class="album-model bg-f mgb-10">'+'<p class="hr-under ">'+'<span class="">购买须知</span>'+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.buyNotes||"")+"</div>"+"</section>"+"<!-- e: 购买须知 -->"+"<!-- s: 制作团队 -->"+'<section class="album-model bg-f mgb-10">'+'<p class="hr-under ">'+'<span class="">制作团队</span>'+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.produceTeam||"")+"</div>"+"</section>"+"<!-- e: 制作团队 -->"+"<!-- s: 其他说明 -->"+'<section class="album-model bg-f mgb-10 '+c+'">'+'<p class="hr-under ">'+'<span class="">'+o+"</span>"+"</p>"+'<div class="buyintro-cont">'+(textareaNameObj.otherContent||"")+"</div>"+"</section>"+"</div>"+'<footer class="buyintro-buy-wrapper album-newBtn-buy">'+'<div class="buyintro-buy">'+'<a href="javascript:;" class="btn1 btn-intro-buy">立即购买</a>'+'<span class="album-lisBtn inl-b">试听</span>'+"</div>"+"</footer>"+"</div>";return h}};return r}),define("plugin/jquery.validate",["jquery"],function(e){(function(t){t.extend(t.fn,{validate:function(e){if(!this.length){e&&e.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing.");return}var n=t.data(this[0],"validator");return n?n:(this.attr("novalidate","novalidate"),n=new t.validator(e,this[0]),t.data(this[0],"validator",n),n.settings.onsubmit&&(this.validateDelegate(":submit","click",function(e){n.settings.submitHandler&&(n.submitButton=e.target),t(e.target).hasClass("cancel")&&(n.cancelSubmit=!0),t(e.target).attr("formnovalidate")!==undefined&&(n.cancelSubmit=!0)}),this.submit(function(e){function r(){var r;return n.settings.submitHandler?(n.submitButton&&(r=t("<input type='hidden'/>").attr("name",n.submitButton.name).val(t(n.submitButton).val()).appendTo(n.currentForm)),n.settings.submitHandler.call(n,n.currentForm,e),n.submitButton&&r.remove(),!1):!0}return n.settings.debug&&e.preventDefault(),n.cancelSubmit?(n.cancelSubmit=!1,r()):n.form()?n.pendingRequest?(n.formSubmitted=!0,!1):r():(n.focusInvalid(),!1)})),n)},valid:function(){if(t(this[0]).is("form"))return this.validate().form();var e=!0,n=t(this[0].form).validate();return this.each(function(){e=e&&n.element(this)}),e},removeAttrs:function(e){var n={},r=this;return t.each(e.split(/\s/),function(e,t){n[t]=r.attr(t),r.removeAttr(t)}),n},rules:function(e,n){var r=this[0];if(e){var i=t.data(r.form,"validator").settings,s=i.rules,o=t.validator.staticRules(r);switch(e){case"add":t.extend(o,t.validator.normalizeRule(n)),delete o.messages,s[r.name]=o,n.messages&&(i.messages[r.name]=t.extend(i.messages[r.name],n.messages));break;case"remove":if(!n)return delete s[r.name],o;var u={};return t.each(n.split(/\s/),function(e,t){u[t]=o[t],delete o[t]}),u}}var a=t.validator.normalizeRules(t.extend({},t.validator.classRules(r),t.validator.attributeRules(r),t.validator.dataRules(r),t.validator.staticRules(r)),r);if(a.required){var f=a.required;delete a.required,a=t.extend({required:f},a)}return a}}),t.extend(t.expr[":"],{blank:function(e){return!t.trim(""+t(e).val())},filled:function(e){return!!t.trim(""+t(e).val())},unchecked:function(e){return!t(e).prop("checked")}}),t.validator=function(e,n){this.settings=t.extend(!0,{},t.validator.defaults,e),this.currentForm=n,this.init()},t.validator.format=function(e,n){return arguments.length===1?function(){var n=t.makeArray(arguments);return n.unshift(e),t.validator.format.apply(this,n)}:(arguments.length>2&&n.constructor!==Array&&(n=t.makeArray(arguments).slice(1)),n.constructor!==Array&&(n=[n]),t.each(n,function(t,n){e=e.replace(new RegExp("\\{"+t+"\\}","g"),function(){return n})}),e)},t.extend(t.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error1",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:t([]),errorLabelContainer:t([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(e,t){this.lastActive=e,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(e)).hide())},onfocusout:function(e,t){!this.checkable(e)&&(e.name in this.submitted||!this.optional(e))&&this.element(e)},onkeyup:function(e,t){if(t.which===9&&this.elementValue(e)==="")return;(e.name in this.submitted||e===this.lastElement)&&this.element(e)},onclick:function(e,t){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode)},highlight:function(e,n,r){e.type==="radio"?this.findByName(e.name).addClass(n).removeClass(r):t(e).addClass(n).removeClass(r)},unhighlight:function(e,n,r){e.type==="radio"?this.findByName(e.name).removeClass(n).addClass(r):t(e).removeClass(n).addClass(r)}},setDefaults:function(e){t.extend(t.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:t.validator.format("Please enter no more than {0} characters."),minlength:t.validator.format("Please enter at least {0} characters."),rangelength:t.validator.format("Please enter a value between {0} and {1} characters long."),range:t.validator.format("Please enter a value between {0} and {1}."),max:t.validator.format("Please enter a value less than or equal to {0}."),min:t.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function r(e){var n=t.data(this[0].form,"validator"),r="on"+e.type.replace(/^validate/,"");n.settings[r]&&n.settings[r].call(n,this[0],e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var e=this.groups={};t.each(this.settings.groups,function(n,r){typeof r=="string"&&(r=r.split(/\s/)),t.each(r,function(t,r){e[r]=n})});var n=this.settings.rules;t.each(n,function(e,r){n[e]=t.validator.normalizeRule(r)}),t(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",r).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",r),this.settings.invalidHandler&&t(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++)this.check(t[e]);return this.valid()},element:function(e){e=this.validationTargetFor(this.clean(e)),this.lastElement=e,this.prepareElement(e),this.currentElements=t(e);var n=this.check(e)!==!1;return n?delete this.invalid[e.name]:this.invalid[e.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),n},showErrors:function(e){if(e){t.extend(this.errorMap,e),this.errorList=[];for(var n in e)this.errorList.push({message:e[n],element:this.findByName(n)[0]});this.successList=t.grep(this.successList,function(t){return!(t.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){t.fn.resetForm&&t(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var t=0;for(var n in e)t++;return t},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()===0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{t(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var e=this.lastActive;return e&&t.grep(this.errorList,function(t){return t.element.name===e.name}).length===1&&e},elements:function(){var e=this,n={};return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in n||!e.objectLength(t(this).rules())?!1:(n[this.name]=!0,!0)})},clean:function(e){return t(e)[0]},errors:function(){var e=this.settings.errorClass.replace(" ",".");return t(this.settings.errorElement+"."+e,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=t([]),this.toHide=t([]),this.currentElements=t([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(e){this.reset(),this.toHide=this.errorsFor(e)},elementValue:function(e){var n=t(e).attr("type"),r=t(e).val();return n==="radio"||n==="checkbox"?t("input[name='"+t(e).attr("name")+"']:checked").val():typeof r=="string"?r.replace(/\r/g,""):r},check:function(e){e=this.validationTargetFor(this.clean(e));var n=t(e).rules(),r=!1,i=this.elementValue(e),s;for(var o in n){var u={method:o,parameters:n[o]};try{s=t.validator.methods[o].call(this,i,e,u.parameters);if(s==="dependency-mismatch"){r=!0;continue}r=!1;if(s==="pending"){this.toHide=this.toHide.not(this.errorsFor(e));return}if(!s)return this.formatAndAdd(e,u),!1}catch(a){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+e.id+", check the '"+u.method+"' method.",a),console.log(u),a}}if(r)return;return this.objectLength(n)&&this.successList.push(e),!0},customDataMessage:function(e,n){return t(e).data("msg-"+n.toLowerCase())||e.attributes&&t(e).attr("data-msg-"+n.toLowerCase())},customMessage:function(e,t){var n=this.settings.messages[e];return n&&(n.constructor===String?n:n[t])},findDefined:function(){for(var e=0;e<arguments.length;e++)if(arguments[e]!==undefined)return arguments[e];return undefined},defaultMessage:function(e,n){return this.findDefined(this.customMessage(e.name,n),this.customDataMessage(e,n),!this.settings.ignoreTitle&&e.title||undefined,t.validator.messages[n],"<strong>Warning: No message defined for "+e.name+"</strong>")},formatAndAdd:function(e,n){var r=this.defaultMessage(e,n.method),i=/\$?\{(\d+)\}/g;typeof r=="function"?r=r.call(this,n.parameters,e):i.test(r)&&(r=t.validator.format(r.replace(i,"{$1}"),n.parameters)),this.errorList.push({message:r,element:e}),this.errorMap[e.name]=r,this.submitted[e.name]=r},addWrapper:function(e){return this.settings.wrapper&&(e=e.add(e.parent(this.settings.wrapper))),e},defaultShowErrors:function(){var e,t;for(e=0;this.errorList[e];e++){var n=this.errorList[e];this.settings.highlight&&this.settings.highlight.call(this,n.element,this.settings.errorClass,this.settings.validClass),this.showLabel(n.element,n.message)}this.errorList.length&&(this.toShow=this.toShow.add(this.containers));if(this.settings.success)for(e=0;this.successList[e];e++)this.showLabel(this.successList[e]);if(this.settings.unhighlight)for(e=0,t=this.validElements();t[e];e++)this.settings.unhighlight.call(this,t[e],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return t(this.errorList).map(function(){return this.element})},showLabel:function(e,n){var r=this.errorsFor(e);r.length?(r.removeClass(this.settings.validClass).addClass(this.settings.errorClass),r.html(n)):(r=t("<"+this.settings.errorElement+">").attr("for",this.idOrName(e)).addClass(this.settings.errorClass).html(n||""),this.settings.wrapper&&(r=r.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(r).length||(this.settings.errorPlacement?this.settings.errorPlacement(r,t(e)):r.insertAfter(e))),!n&&this.settings.success&&(r.text(""),typeof this.settings.success=="string"?r.addClass(this.settings.success):this.settings.success(r,e)),this.toShow=this.toShow.add(r)},errorsFor:function(e){var n=this.idOrName(e);return this.errors().filter(function(){return t(this).attr("for")===n})},idOrName:function(e){return this.groups[e.name]||(this.checkable(e)?e.name:e.id||e.name)},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name).not(this.settings.ignore)[0]),e},checkable:function(e){return/radio|checkbox/i.test(e.type)},findByName:function(e){return t(this.currentForm).find("[name='"+e+"']")},getLength:function(e,n){switch(n.nodeName.toLowerCase()){case"select":return t("option:selected",n).length;case"input":if(this.checkable(n))return this.findByName(n.name).filter(":checked").length}return e.length},depend:function(e,t){return this.dependTypes[typeof e]?this.dependTypes[typeof e](e,t):!0},dependTypes:{"boolean":function(e,t){return e},string:function(e,n){return!!t(e,n.form).length},"function":function(e,t){return e(t)}},optional:function(e){var n=this.elementValue(e);return!t.validator.methods.required.call(this,n,e)&&"dependency-mismatch"},startRequest:function(e){this.pending[e.name]||(this.pendingRequest++,this.pending[e.name]=!0)},stopRequest:function(e,n){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[e.name],n&&this.pendingRequest===0&&this.formSubmitted&&this.form()?(t(this.currentForm).submit(),this.formSubmitted=!1):!n&&this.pendingRequest===0&&this.formSubmitted&&(t(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,n){e.constructor===String?this.classRuleSettings[e]=n:t.extend(this.classRuleSettings,e)},classRules:function(e){var n={},r=t(e).attr("class");return r&&t.each(r.split(" "),function(){this in t.validator.classRuleSettings&&t.extend(n,t.validator.classRuleSettings[this])}),n},attributeRules:function(e){var n={},r=t(e),i=r[0].getAttribute("type");for(var s in t.validator.methods){var o;s==="required"?(o=r.get(0).getAttribute(s),o===""&&(o=!0),o=!!o):o=r.attr(s),/min|max/.test(s)&&(i===null||/number|range|text/.test(i))&&(o=Number(o)),o?n[s]=o:i===s&&i!=="range"&&(n[s]=!0)}return n.maxlength&&/-1|2147483647|524288/.test(n.maxlength)&&delete n.maxlength,n},dataRules:function(e){var n,r,i={},s=t(e);for(n in t.validator.methods)r=s.data("rule-"+n.toLowerCase()),r!==undefined&&(i[n]=r);return i},staticRules:function(e){var n={},r=t.data(e.form,"validator");return r.settings.rules&&(n=t.validator.normalizeRule(r.settings.rules[e.name])||{}),n},normalizeRules:function(e,n){return t.each(e,function(r,i){if(i===!1){delete e[r];return}if(i.param||i.depends){var s=!0;switch(typeof i.depends){case"string":s=!!t(i.depends,n.form).length;break;case"function":s=i.depends.call(n,n)}s?e[r]=i.param!==undefined?i.param:!0:delete e[r]}}),t.each(e,function(r,i){e[r]=t.isFunction(i)?i(n):i}),t.each(["minlength","maxlength"],function(){e[this]&&(e[this]=Number(e[this]))}),t.each(["rangelength","range"],function(){var n;e[this]&&(t.isArray(e[this])?e[this]=[Number(e[this][0]),Number(e[this][1])]:typeof e[this]=="string"&&(n=e[this].split(/[\s,]+/),e[this]=[Number(n[0]),Number(n[1])]))}),t.validator.autoCreateRanges&&(e.min&&e.max&&(e.range=[e.min,e.max],delete e.min,delete e.max),e.minlength&&e.maxlength&&(e.rangelength=[e.minlength,e.maxlength],delete e.minlength,delete e.maxlength)),e},normalizeRule:function(e){if(typeof e=="string"){var n={};t.each(e.split(/\s/),function(){n[this]=!0}),e=n}return e},addMethod:function(e,n,r){t.validator.methods[e]=n,t.validator.messages[e]=r!==undefined?r:t.validator.messages[e],n.length<3&&t.validator.addClassRules(e,t.validator.normalizeRule(e))},methods:{required:function(e,n,r){if(!this.depend(r,n))return"dependency-mismatch";if(n.nodeName.toLowerCase()==="select"){var i=t(n).val();return i&&i.length>0}return this.checkable(n)?this.getLength(e,n)>0:t.trim(e).length>0},email:function(e,t){return this.optional(t)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},idcard:function(t,n,r){function i(e){var t=e.substr(0,2),n={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};return n[t]==undefined?!1:!0}function s(e){var t=e.length;if(t=="15"){var n=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/,r=e.match(n),i=r[2],s=r[3],u=r[4],a=new Date("19"+i+"/"+s+"/"+u);return o("19"+i,s,u,a)}if(t=="18"){var f=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/,r=e.match(f),i=parseInt(r[2],10),s=parseInt(r[3],10),u=parseInt(r[4],10),a=new Date(i+"/"+s+"/"+u);return o(i,s,u,a)}return!1}function o(e,t,n,r){var i=new Date,s=i.getFullYear();if(r.getFullYear()==e&&r.getMonth()+1==t&&r.getDate()==n){var o=s-e;return o>=2&&o<=150?!0:!1}return!1}function u(e){e=a(e);var t=e.length;if(t=="18"){var n=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),r=new Array("1","0","X","9","8","7","6","5","4","3","2"),i=0,s,o;for(s=0;s<17;s++)i+=e.substr(s,1)*n[s];return o=r[i%11],o==e.substr(17,1)?!0:!1}return!1}function a(e){if(e.length=="15"){var t=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),n=new Array("1","0","X","9","8","7","6","5","4","3","2"),r=0,i;e=e.substr(0,6)+"19"+e.substr(6,e.length-6);for(i=0;i<17;i++)r+=e.substr(i,1)*t[i];return e+=n[r%11],e}return e}if(e.trim(t)!=""){if(/(^\d{15}$)|(^\d{17}(\d|X)$)/.test(t)===!1)return!1;if(i(t)===!1)return!1;if(s(t)===!1)return!1;if(u(t)===!1)return!1}return!0},cellphone:function(e,t){return this.optional(t)||/^\d{11}$/.test(e)},url:function(e,t){return this.optional(t)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},date:function(e,t){return this.optional(t)||!/Invalid|NaN/.test((new Date(e)).toString())},dateISO:function(e,t){return this.optional(t)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e)},number:function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},positivenumber:function(e,t){return this.optional(t)||/^(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return this.optional(t)||/^\d+$/.test(e)},creditcard:function(e,t){if(this.optional(t))return"dependency-mismatch";if(/[^0-9 \-]+/.test(e))return!1;var n=0,r=0,i=!1;e=e.replace(/\D/g,"");for(var s=e.length-1;s>=0;s--){var o=e.charAt(s);r=parseInt(o,10),i&&(r*=2)>9&&(r-=9),n+=r,i=!i}return n%10===0},minlength:function(e,n,r){var i=t.isArray(e)?e.length:this.getLength(t.trim(e),n);return this.optional(n)||i>=r},maxlength:function(e,n,r){var i=t.isArray(e)?e.length:this.getLength(t.trim(e),n);return this.optional(n)||i<=r},rangelength:function(e,n,r){var i=t.isArray(e)?e.length:this.getLength(t.trim(e),n);return this.optional(n)||i>=r[0]&&i<=r[1]},min:function(e,t,n){return this.optional(t)||e>=n},max:function(e,t,n){return this.optional(t)||e<=n},range:function(e,t,n){return this.optional(t)||e>=n[0]&&e<=n[1]},equalTo:function(e,n,r){var i=t(r);return this.settings.onfocusout&&i.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(n).valid()}),e===i.val()},remote:function(e,n,r){if(this.optional(n))return"dependency-mismatch";var i=this.previousValue(n);this.settings.messages[n.name]||(this.settings.messages[n.name]={}),i.originalMessage=this.settings.messages[n.name].remote,this.settings.messages[n.name].remote=i.message,r=typeof r=="string"&&{url:r}||r;if(i.old===e)return i.valid;i.old=e;var s=this;this.startRequest(n);var o={};return o[n.name]=e,t.ajax(t.extend(!0,{url:r,mode:"abort",port:"validate"+n.name,dataType:"json",data:o,success:function(r){s.settings.messages[n.name].remote=i.originalMessage;var o=r===!0||r==="true";if(o){var u=s.formSubmitted;s.prepareElement(n),s.formSubmitted=u,s.successList.push(n),delete s.invalid[n.name],s.showErrors()}else{var a={},f=r||s.defaultMessage(n,"remote");a[n.name]=i.message=t.isFunction(f)?f(e):f,s.invalid[n.name]=!0,s.showErrors(a)}i.valid=o,s.stopRequest(n,o)}},r)),"pending"}}}),t.format=t.validator.format})(e),function(e){var t={};if(e.ajaxPrefilter)e.ajaxPrefilter(function(e,n,r){var i=e.port;e.mode==="abort"&&(t[i]&&t[i].abort(),t[i]=r)});else{var n=e.ajax;e.ajax=function(r){var i=("mode"in r?r:e.ajaxSettings).mode,s=("port"in r?r:e.ajaxSettings).port;return i==="abort"?(t[s]&&t[s].abort(),t[s]=n.apply(this,arguments),t[s]):n.apply(this,arguments)}}}(e),function(e){e.extend(e.fn,{validateDelegate:function(t,n,r){return this.bind(n,function(n){var i=e(n.target);if(i.is(t))return r.apply(i,arguments)})}})}(e)}),define("plugin/datepicker",["jquery"],function(e){var t=function(){var t={},n={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"},i={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',head:["<td>",'<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>','<th colspan="6" class="datepickerMonth"><a href="#"><span></span></a></th>','<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=week%></span></th>","<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>","<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[0].week%></span></a></th>','<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>','<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[1].week%></span></a></th>','<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>','<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[2].week%></span></a></th>','<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>','<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>','<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[3].week%></span></a></th>','<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>','<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[4].week%></span></a></th>','<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>','<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[5].week%></span></a></th>','<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>','<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]},s={flat:!1,starts:1,prev:"&#9664;",next:"&#9654;",lastSel:!1,mode:"single",view:"days",calendars:1,format:"Y-m-d",position:"bottom",eventName:"click",onRender:function(){return{}},onChange:function(){return!0},onShow:function(){return!0},onBeforeShow:function(){return!0},onHide:function(){return!0},locale_:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekMin:"wk"},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["日","一","二","三","四","五","六","日"],daysMin:["&nbsp;&nbsp;日","&nbsp;&nbsp;一","&nbsp;&nbsp;二","&nbsp;&nbsp;三","&nbsp;&nbsp;四","&nbsp;&nbsp;五","&nbsp;&nbsp;六","&nbsp;&nbsp;日"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekMin:"周"}},o=function(t){var n=e(t).data("datepicker"),s=e(t),o=Math.floor(n.calendars/2),u,f,l,c,h=0,p,d,v,m,g,y;s.find("td>table tbody").remove();for(var b=0;b<n.calendars;b++){u=new Date(n.current),u.addMonths(-o+b),y=s.find("table").eq(b+1);switch(y[0].className){case"datepickerViewDays":l=a(u,"B, Y");break;case"datepickerViewMonths":l=u.getFullYear();break;case"datepickerViewYears":l=u.getFullYear()-6+" - "+(u.getFullYear()+5)}y.find("thead tr:first th:eq(1) span").text(l),l=u.getFullYear()-6,f={data:[],className:"datepickerYears"};for(var w=0;w<12;w++)f.data.push(l+w);g=r(i.months.join(""),f),u.setDate(1),f={weeks:[],test:10},c=u.getMonth();var l=(u.getDay()-n.starts)%7;u.addDays(-(l+(l<0?7:0))),p=-1,h=0;while(h<42){v=parseInt(h/7,10),m=h%7,f.weeks[v]||(p=u.getWeekNumber(),f.weeks[v]={week:p,days:[]}),f.weeks[v].days[m]={text:u.getDate(),classname:[]},c!=u.getMonth()&&f.weeks[v].days[m].classname.push("datepickerNotInMonth"),u.getDay()==0&&f.weeks[v].days[m].classname.push("datepickerSunday"),u.getDay()==6&&f.weeks[v].days[m].classname.push("datepickerSaturday");var E=n.onRender(u),S=u.valueOf();(E.selected||n.date==S||e.inArray(S,n.date)>-1||n.mode=="range"&&S>=n.date[0]&&S<=n.date[1])&&f.weeks[v].days[m].classname.push("datepickerSelected"),E.disabled&&f.weeks[v].days[m].classname.push("datepickerDisabled"),E.className&&f.weeks[v].days[m].classname.push(E.className),f.weeks[v].days[m].classname=f.weeks[v].days[m].classname.join(" "),h++,u.addDays(1)}g=r(i.days.join(""),f)+g,f={data:n.locale.monthsShort,className:"datepickerMonths"},g=r(i.months.join(""),f)+g,y.append(g)}},u=function(e,t){if(e.constructor==Date)return new Date(e);var n=e.split(/\W+/),r=t.split(/\W+/),i,s,o,u,a,f=new Date;for(var l=0;l<n.length;l++)switch(r[l]){case"d":case"e":i=parseInt(n[l],10);break;case"m":s=parseInt(n[l],10)-1;break;case"Y":case"y":o=parseInt(n[l],10),o+=o>100?0:o<29?2e3:1900;break;case"H":case"I":case"k":case"l":u=parseInt(n[l],10);break;case"P":case"p":/pm/i.test(n[l])&&u<12?u+=12:/am/i.test(n[l])&&u>=12&&(u-=12);break;case"M":a=parseInt(n[l],10)}return new Date(o===undefined?f.getFullYear():o,s===undefined?f.getMonth():s,i===undefined?f.getDate():i,u===undefined?f.getHours():u,a===undefined?f.getMinutes():a,0)},a=function(e,t){var n=e.getMonth(),r=e.getDate(),i=e.getFullYear(),s=e.getWeekNumber(),o=e.getDay(),u={},a=e.getHours(),f=a>=12,l=f?a-12:a,c=e.getDayOfYear();l==0&&(l=12);var h=e.getMinutes(),p=e.getSeconds(),d=t.split(""),v;for(var m=0;m<d.length;m++){v=d[m];switch(d[m]){case"a":v=e.getDayName();break;case"A":v=e.getDayName(!0);break;case"b":v=e.getMonthName();break;case"B":v=e.getMonthName(!0);break;case"C":v=1+Math.floor(i/100);break;case"d":v=r<10?"0"+r:r;break;case"e":v=r;break;case"H":v=a<10?"0"+a:a;break;case"I":v=l<10?"0"+l:l;break;case"j":v=c<100?c<10?"00"+c:"0"+c:c;break;case"k":v=a;break;case"l":v=l;break;case"m":v=n<9?"0"+(1+n):1+n;break;case"M":v=h<10?"0"+h:h;break;case"p":case"P":v=f?"PM":"AM";break;case"s":v=Math.floor(e.getTime()/1e3);break;case"S":v=p<10?"0"+p:p;break;case"u":v=o+1;break;case"w":v=o;break;case"y":v=(""+i).substr(2,2);break;case"Y":v=i}d[m]=v}return d.join("")},f=function(e){if(Date.prototype.tempDate)return;Date.prototype.tempDate=null,Date.prototype.months=e.months,Date.prototype.monthsShort=e.monthsShort,Date.prototype.days=e.days,Date.prototype.daysShort=e.daysShort,Date.prototype.getMonthName=function(e){return this[e?"months":"monthsShort"][this.getMonth()]},Date.prototype.getDayName=function(e){return this[e?"days":"daysShort"][this.getDay()]},Date.prototype.addDays=function(e){this.setDate(this.getDate()+e),this.tempDate=this.getDate()},Date.prototype.addMonths=function(e){this.tempDate==null&&(this.tempDate=this.getDate()),this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.addYears=function(e){this.tempDate==null&&(this.tempDate=this.getDate()),this.setDate(1),this.setFullYear(this.getFullYear()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.getMaxDays=function(){var e=new Date(Date.parse(this)),t=28,n;n=e.getMonth(),t=28;while(e.getMonth()==n)t++,e.setDate(t);return t-1},Date.prototype.getFirstDay=function(){var e=new Date(Date.parse(this));return e.setDate(1),e.getDay()},Date.prototype.getWeekNumber=function(){var e=new Date(this);e.setDate(e.getDate()-(e.getDay()+6)%7+3);var t=e.valueOf();return e.setMonth(0),e.setDate(4),Math.round((t-e.valueOf())/6048e5)+1},Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),t=new Date(this.getFullYear(),0,0,0,0,0),n=e-t;return Math.floor(n/24*60*60*1e3)}},l=function(t){var n=e(t).data("datepicker"),r=e("#"+n.id);if(!n.extraHeight){var i=e(t).find("div");n.extraHeight=i.get(0).offsetHeight+i.get(1).offsetHeight,n.extraWidth=i.get(2).offsetWidth+i.get(3).offsetWidth}var s=r.find("table:first").get(0),o=s.offsetWidth,u=s.offsetHeight;r.css({width:o+n.extraWidth+"px",height:u+n.extraHeight+"px"}).find("div.datepickerContainer").css({width:o+"px",height:u+"px"})},c=function(t){e(t.target).is("span")&&(t.target=t.target.parentNode);var n=e(t.target);if(n.is("a")){t.target.blur();if(n.hasClass("datepickerDisabled"))return!1;var r=e(this).data("datepicker"),i=n.parent(),s=i.parent().parent().parent(),u=e("table",this).index(s.get(0))-1,f=new Date(r.current),l=!1,c=!1;if(i.is("th")){if(i.hasClass("datepickerWeek")&&r.mode=="range"&&!i.next().hasClass("datepickerDisabled")){var p=parseInt(i.next().text(),10);f.addMonths(u-Math.floor(r.calendars/2)),i.next().hasClass("datepickerNotInMonth")&&f.addMonths(p>15?-1:1),f.setDate(p),r.date[0]=f.setHours(0,0,0,0).valueOf(),f.setHours(23,59,59,0),f.addDays(6),r.date[1]=f.valueOf(),c=!0,l=!0,r.lastSel=!1}else if(i.hasClass("datepickerMonth")){f.addMonths(u-Math.floor(r.calendars/2));switch(s.get(0).className){case"datepickerViewDays":s.get(0).className="datepickerViewMonths",n.find("span").text(f.getFullYear());break;case"datepickerViewMonths":s.get(0).className="datepickerViewYears",n.find("span").text(f.getFullYear()-6+" - "+(f.getFullYear()+5));break;case"datepickerViewYears":s.get(0).className="datepickerViewDays",n.find("span").text(a(f,"B, Y"))}}else if(i.parent().parent().is("thead")){switch(s.get(0).className){case"datepickerViewDays":r.current.addMonths(i.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewMonths":r.current.addYears(i.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewYears":r.current.addYears(i.hasClass("datepickerGoPrev")?-12:12)}c=!0}}else if(i.is("td")&&!i.hasClass("datepickerDisabled")){switch(s.get(0).className){case"datepickerViewMonths":r.current.setMonth(s.find("tbody.datepickerMonths td").index(i)),r.current.setFullYear(parseInt(s.find("thead th.datepickerMonth span").text(),10)),r.current.addMonths(Math.floor(r.calendars/2)-u),s.get(0).className="datepickerViewDays";break;case"datepickerViewYears":r.current.setFullYear(parseInt(n.text(),10)),s.get(0).className="datepickerViewMonths";break;default:var p=parseInt(n.text(),10);f.addMonths(u-Math.floor(r.calendars/2)),i.hasClass("datepickerNotInMonth")&&f.addMonths(p>15?-1:1),f.setDate(p);switch(r.mode){case"multiple":p=f.setHours(0,0,0,0).valueOf(),e.inArray(p,r.date)>-1?e.each(r.date,function(e,t){if(t==p)return r.date.splice(e,1),!1}):r.date.push(p);break;case"range":r.lastSel||(r.date[0]=f.setHours(0,0,0,0).valueOf()),p=f.setHours(23,59,59,0).valueOf(),p<r.date[0]?(r.date[1]=r.date[0]+86399e3,r.date[0]=p-86399e3):r.date[1]=p,r.lastSel=!r.lastSel;break;default:r.date=f.valueOf()}}c=!0,l=!0}c&&o(this),l&&r.onChange.apply(this,h(r))}return!1},h=function(t){var n;return t.mode=="single"?(n=new Date(t.date),[a(n,t.format),n,t.el]):(n=[[],[],t.el],e.each(t.date,function(e,r){var i=new Date(r);n[0].push(a(i,t.format)),n[1].push(i)}),n)},p=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},d=function(e,t,n){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(e.compareDocumentPosition(t)&16);var r=t.parentNode;while(r&&r!=n){if(r==e)return!0;r=r.parentNode}return!1},v=function(t){var n=e("#"+e(this).data("datepickerId"));if(!n.is(":visible")){var r=n.get(0);o(r);var i=n.data("datepicker"),s=i.onBeforeShow.apply(this,[n.get(0)]);if(s===!1)return;var u=e(this).offset(),a=p(),f=u.top,c=u.left,h=e.css(r,"display");n.css({visibility:"hidden",display:"block"}),l(r);switch(i.position){case"top":f-=r.offsetHeight;break;case"left":c-=r.offsetWidth;break;case"right":c+=this.offsetWidth;break;case"bottom":f+=this.offsetHeight}f+r.offsetHeight>a.t+a.h&&(f=u.top-r.offsetHeight),f<a.t&&(f=u.top+this.offsetHeight+r.offsetHeight),c+r.offsetWidth>a.l+a.w&&(c=u.left-r.offsetWidth),c<a.l&&(c=u.left+this.offsetWidth),n.css({visibility:"visible",display:"block",top:f+"px",left:c+"px"}),i.onShow.apply(this,[n.get(0)])!=0&&n.show(),e(document).bind("mousedown",{cal:n,trigger:this},m)}return!1},m=function(t){t.target!=t.data.trigger&&!d(t.data.cal.get(0),t.target,t.data.cal.get(0))&&(t.data.cal.data("datepicker").onHide.apply(this,[t.data.cal.get(0)])!=0&&t.data.cal.hide(),e(document).unbind("mousedown",m))};return{init:function(t){return t=e.extend({},s,t||{}),f(t.locale),t.calendars=Math.max(1,parseInt(t.calendars,10)||1),t.mode=/single|multiple|range/.test(t.mode)?t.mode:"single",this.each(function(){if(!e(this).data("datepicker")){t.el=this,t.date.constructor==String&&(t.date=u(t.date,t.format),t.date.setHours(0,0,0,0));if(t.mode!="single")if(t.date.constructor!=Array)t.date=[t.date.valueOf()],t.mode=="range"&&t.date.push((new Date(t.date[0])).setHours(23,59,59,0).valueOf());else{for(var s=0;s<t.date.length;s++)t.date[s]=u(t.date[s],t.format).setHours(0,0,0,0).valueOf();t.mode=="range"&&(t.date[1]=(new Date(t.date[1])).setHours(23,59,59,0).valueOf())}else t.date=t.date.valueOf();t.current?t.current=u(t.current,t.format):t.current=new Date,t.current.setDate(1),t.current.setHours(0,0,0,0);var a="datepicker_"+parseInt(Math.random()*1e3),f;t.id=a,e(this).data("datepickerId",t.id);var h=e(i.wrapper).attr("id",a).bind("click",c).data("datepicker",t);t.className&&h.addClass(t.className);var p="";for(var s=0;s<t.calendars;s++)f=t.starts,s>0&&(p+=i.space),p+=r(i.head.join(""),{week:t.locale.weekMin,prev:t.prev,next:t.next,day1:t.locale.daysMin[f++%7],day2:t.locale.daysMin[f++%7],day3:t.locale.daysMin[f++%7],day4:t.locale.daysMin[f++%7],day5:t.locale.daysMin[f++%7],day6:t.locale.daysMin[f++%7],day7:t.locale.daysMin[f++%7]});h.find("tr:first").append(p).find("table").addClass(n[t.view]),o(h.get(0)),t.flat?(h.appendTo(this).show().css("position","relative"),l(h.get(0))):(h.appendTo(document.body),e(this).bind(t.eventName,v))}})},showPicker:function(){return this.each(function(){e(this).data("datepickerId")&&v.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("datepickerId")&&e("#"+e(this).data("datepickerId")).hide()})},setDate:function(t,n){return this.each(function(){if(e(this).data("datepickerId")){var r=e("#"+e(this).data("datepickerId")),i=r.data("datepicker");i.date=t,i.date.constructor==String&&(i.date=u(i.date,i.format),i.date.setHours(0,0,0,0));if(i.mode!="single")if(i.date.constructor!=Array)i.date=[i.date.valueOf()],i.mode=="range"&&i.date.push((new Date(i.date[0])).setHours(23,59,59,0).valueOf());else{for(var s=0;s<i.date.length;s++)i.date[s]=u(i.date[s],i.format).setHours(0,0,0,0).valueOf();i.mode=="range"&&(i.date[1]=(new Date(i.date[1])).setHours(23,59,59,0).valueOf())}else i.date=i.date.valueOf();n&&(i.current=new Date(i.mode!="single"?i.date[0]:i.date)),o(r.get(0))}})},getDate:function(t){if(this.size()>0)return h(e("#"+e(this).data("datepickerId")).data("datepicker"))[t?0:1]},clear:function(){return this.each(function(){if(e(this).data("datepickerId")){var t=e("#"+e(this).data("datepickerId")),n=t.data("datepicker");n.mode!="single"&&(n.date=[],o(t.get(0)))}})},fixLayout:function(){return this.each(function(){if(e(this).data("datepickerId")){var t=e("#"+e(this).data("datepickerId")),n=t.data("datepicker");n.flat&&l(t.get(0))}})}}}();e.fn.extend({DatePicker:t.init,DatePickerHide:t.hidePicker,DatePickerShow:t.showPicker,DatePickerSetDate:t.setDate,DatePickerGetDate:t.getDate,DatePickerClear:t.clear,DatePickerLayout:t.fixLayout});var n={},r=function i(e,t){var r=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):n[e]=n[e]||i(document.getElementById(e).innerHTML);return t?r(t):r}}),define("module/dialogs/create_album",["jquery","plugin/dialog","helper","module/dialogs/bindmobile","module/uploadimg","module/album/tags","module/dialogs/create_album_html","module/common/form_editor","module/common/form_uploadimg","module/dialogs/albumPreview","module/player/player","plugin/jquery.selecter","plugin/jquery.validate","plugin/jquery.input","plugin/datepicker"],function(e,t,n,r,i,s,o,u,a,f,l){function A(e,t){var n=e.replace(/[\u0391-\uFFE5]/g,"aa");return n.length<=t}function O(e,n){var i=this.$cform,s={dirty_words:'信息包含敏感词,请修改，如需帮助请 <a class="j-CustomUniqueTag" href="javascript: void(0);">联系在线客服。</a>'};s.files_dirty_words=s.dirty_words;var o="";for(var u=0,a=e.length;u<a;u++){var f=e[u][0],l=e[u][1];if(f=="page"){var c=i.find("#tr_validcode"),h=i.find("#btn_validcode"),p=c.find("input");M.setError(c,l,!1),h.trigger("click")}if(f=="mobile"){r.open(function(){t.success("绑定成功,将自动提交",{onClose:function(){i.find("#submit_save").trigger("click")},autoClose:2e3})});return}if(s[f]){o=s[f];for(var d in l){if(d==-17)return;var v,m=l[d];if(m){var g='信息包含敏感词,请修改,如需帮助请 <a class="j-CustomUniqueTag" href="javascript:void(0);">联系在线客服。</a>';d==-19&&(g="信息包含不支持的字符,请修改"),f=="dirty_words"&&(v=i.find("[name="+m+"]"),M.setError(v.parent(),g)),f=="files_dirty_words"&&(v=i.find("input[name="+m+"]"),M.setError(v.parent(),g),m=="title"?o="专辑名称"+o:m=="intro"&&(o="专辑简介"+o)),i.find("#btn_validcode").click()}}}else o+=l}n.html(o).css({color:"red"})}function _(t){var n=["gif","jpg","jpeg","png","bmp"],r=t,i=r.split(/\//);e.inArray("jpg",n)&&!e.inArray("jpeg",n)&&n.push("jpeg"),e.inArray("jpeg",n)&&!e.inArray("jpg",n)&&n.push("jpg");var s=n.join("|").toLowerCase(),o=new RegExp(""+s+"$");return o.test(r.toLowerCase())}var c=c||{},h=c&&c.categories||{},p=c&&c.music_categories||{},d=c&&c.recommend_tags||{},v=c&&c.positive_sort_categories||{},m=c&&c.allow_create_payable_album||{},g=c&&c.allow_create_payable_pack_album||{},y=c&&c.priceTypes||[],b=config.DIRECT_DTRES_ROOT+"/album/upload",w=config.STATIC_ROOT+"/css/img/record/image.gif",E=config.FDFS_PATH||"http://fdfs.x.com/",S="/operation_tagging/get_tags_by_category_id",x=config.STATIC_ROOT+"/js/plugin/kindeditor/",T=config.STATIC_ROOT+"/css/plugin/kindeditor/themes/",N,C,k,L=function(e,t){this.ajax_loading=!1,this.isVip=e.isVip,this.init(e,t)};L.prototype={getTemplate:function(){var e=o.fromTemplate();this.template="";for(var t in e)this.template+=e[t];return'<div class="tb-1"> <form class="js-createalbum-form">'+this.template+"</form></div>"},init:function(e,t){var n=this.sureText=(e||{}).sureText||"创建新专辑",r={sureText:n};this.submitCallBack=t,this.params=r},isShow:function(){return e(".pop-creat-album").length>0?!0:!1},initData:function(){var e='<li class="selecter-item" data-value="${id}">${title}</li>',t="";for(var n=0,r=h.length;n<r;n++){var i=h[n];t+=e.replace(/\$\{([^\}]*)\}/g,function(e,t){var n="";for(var r in i)r==t&&(n=i[r]);return n})}this.$cform.find("#genre ul").empty().append(t),e='<li class="selecter-item" data-value="${title}">${title}</li>';var s="";for(var n=0,r=p.length;n<r;n++){var o=p[n];s+=e.replace(/\$\{([^\}]*)\}/g,o)}this.$cform.find("#genre_sub ul").empty().append(s),e='<li class="selecter-item ${selected}" data-value="${id}" >${title}</li>';var u="";for(var n=0,r=y.length;n<r;n++){var a=y[n],f={id:a[0],title:a[1],selected:""};this.isVip&&f.id==3&&(f.selected="selected"),u+=e.replace(/\$\{([^\}]*)\}/g,function(e,t){var n="";for(var r in f)r==t&&(n=f[r]);return n})}this.$cform.find("#price_type_id ul").empty().append(u)},parseTemplate:function(e){var t=this.getTemplate();for(var n in e){var r=new RegExp("\\$\\{("+n+")\\}");t=t.replace(r,function(t,r){if(n==r)return e[n]})}return this.template=t,this.template},initOption:function(t){t=t||this.parseTemplate(this.params);var n=this,r={template:{dialog_close:"",dialog_header:'<div class="hd3 wrapper2 " dialog-role="header"></div>',dialog_body:'<div class="bd1 wrapper2" dialog-role="body"></div>'},dialogClass:"pop-c pop-creat-album",header:'<span class="btn1 fr"> <span class="icon1 icon1-cha " dialog-role="close">×</span></span>创建新专辑',fixed:!1,content:t,noheadDrop:!0,overlayer:{clickClose:!1},onYes:function(){var t=n.$cform.find('input[name="title"]'),r=n.$cform.find('input[name="is_paid"]:checked'),i=n.$cform.find('input[name="price_type_mask"]'),s=n.$cform.find("#albumprice"),o=n.$cform.find("#price"),u=n.$cform.find("#updatedescr"),a=n.$cform.find("#countsound"),f=n.$cform.find('input[name="intro"]'),l=n.$cform.find('input[name="is_refund"]'),c=n.$cform.find("input[name=date]"),h=n.$cform.find("input[name=hour]"),p=n.$cform.find("input[name=minutes]"),d=n.$cform.find('input[name="refund_time"]');t.val(e.trim(t.val()));if(t.parent(".is-error").length>0||t.val()=="")return M.setError(t.parent(),"请为专辑加上标题",!0),!1;var v=n.$cform.find("#genre").selecter("val");if(v==""){var m=n.$cform.find('input[name="category_id"]');return n.$cform.find("#genre").parent().addClass("is-error"),e(document).scrollTop(n.$cform.find("#genre").offset().top-50),!1}var g=function(t,n){if(e.trim(t.val())===""){t.parent().addClass("is-error");var r=t.parents(".cell-2"),i=r.find(".tips-error").length?r.find(".tips-error"):r.find(".tips");i.html(n+"不能为空")}t.parent(".is-error").length>0&&t.focus()};if(y.length&&r.length===0)return M.setError(n.$cform.find('input[name="is_paid"]').parents(".cell-2"),"请选择是否付费",!0),!1;var b=n.$cform.find("#price_type_id").selecter("val");if(y.length&&r.val()==="1"&&b=="")return M.setError(n.$cform.find('input[name="price_type_mask"]').parents(".cell-2"),"请选择售卖类型",!0),e(document).scrollTop(n.$cform.find("#price_type_id").offset().top-50),!1;var w=n.$cform.find('input[name="template_track"]:checked'),E=!!n.$cform.find('input[name="is_sample"]:checked').length;if(r.val()==="1"&&E&&!w.length){var S=n.$cform.find('input[name="template_track"]').parents(".cell-2");return S.find("p.tips").html("请选择试听引导语").end().addClass("is-error"),S.find("input").focus(),!1}(i.val()=="1"||i.val()=="4")&&g(o,"声音单价");if(i.val()=="2"||i.val()=="5")g(s,"专辑总价"),g(u,"更新说明"),g(a,"预估总集数");e(".js-sub-title-contrain").length&&!e(".js-sub-title-contrain").hasClass("hidden")&&n.checkInfo.subTitle(!0);var x=!1;e(".js-album-moreintro").each(function(){if(e(this).find("input[required]").length){var t=e(this).find("input[required]").val(),n=e(this).find("lable").text(),r="请填写"+n.replace("*","");n.indexOf("简介配图")!==-1&&(r="请上传简介配图");if(!e.trim(t))return e(this).addClass("is-error").find(".tips").html(r),e(document).scrollTop(e(this).offset().top-50),!1}});if(e.trim(f.val())!==""&&f.hasClass("is-error"))return f.focus(),!1;f.removeClass("is-error");if(n.$cform.find(".is-error").length>0)return!1;var T=n.albumTags.pass();return T?(n.$cform.find(".infoErr").text(T),!1):n.$cform.find("#agreeDeal:checked").length?(e(".j-destory").remove(),n.doSubmit(this),!1):(n.$cform.find(".infoErr").text("请先同意协议"),!1)},onClose:function(){e(".datepicker").remove()}};return r},open:function(){var n=this;if(this.isShow())return!1;e.ajax({url:"/upload/new_album_form_data"+(n.isVip?"?entrance=membership":""),success:function(e){if(n.isShow())return!1;e.res?n.renderAlbumByData(e):t.alert("数据加载失败！")},error:function(){t.alert("数据加载失败！")}})},renderAlbumByData:function(e){y=e.priceTypes||[],h=e.categories,d=e.recommend_tags,p=e.music_categories,v=e.positive_sort_categories,N=e["default"].album_cover_url,k=e.allowEditorLink,this.initAlbumData()},initAlbumData:function(){var n=this.initOption(),r=this,i=new t.Dialog(n);i.open(),this.$cform=e(".js-createalbum-form");var s=i.getEl();this._initSoundPaster(),this.initData(),this.bindEvents(s),this.$el=s,this.formEditor=new u(this.$cform,{allowEditorLink:k}),this.formUploadimg=new a(this.$cform),this.checkInfo=this.formValidate(),this.formUploadimg.uploadImgInit(),s.find("#album_cover_url").attr("src",N),this.rich_editor_intro=this.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0}),this.isVip&&this._initVip()},bindEvents:function(t){function i(i){var s=i,u={1:"1",2:"2",4:"1",5:"2"};e(".js-paytype-rows").html(o.price_type_id[u[s]]||""),t.find(".js-refund-time").addClass("hidden"),s==="1"||s==="4"?(n.formEditor.richEditor.intro&&n.formEditor.richEditor.intro.remove(),e(".js-intro-row").html(o.one_intro),n.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0}),n.albumPreview.btnHide(r)):s==="2"||s==="5"?(n.albumPreview.btnShow(r),n.formEditor.richEditor.intro&&n.formEditor.richEditor.intro.remove(),e(".js-intro-row").empty(),n.formUploadimg.uploadImgInit({picBtn:e("#introPicBtn"),imgWrap:e("#introImageWrap"),limitWidth:1250,limitHeight:1e3,tips:'请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M'}),e("#other_title").off("keyup"),e("#other_title").on("keyup",function(){var t=this.value,n=e(this).parents(".js-album-moreintro").find(".tips");if(!A(t,20))return e(this).parents(".js-album-moreintro").addClass("is-error").find(".tips").html("标题可自定义，不超过10个汉字"),!1;e(this).parents(".js-album-moreintro").removeClass("is-error").find(".tips").html(n.attr("data-def"))}),t.find('input[name="is_refund"]').off("change").beautify().on("change",function(){var n=this.value,r=t.find('input[name="is_refund"]:checked').attr("data-show");n=="1"?(t.find("."+r).removeClass("hidden"),t.find(".j-is-refund-1").removeClass("hidden")):n=="0"&&(t.find("."+r).addClass("hidden"),t.find(".j-is-refund-1").addClass("hidden")),M.setRight(e(this).parents(".cell-2"),"注意：提交成功后无法修改~")}),n._initSetDataPicker(t),e(".js-album-moreintro").each(function(){var t=e(this).find("input[data-params]").attr("data-name");if(!t)return;var r=e(this).find("textarea").attr("name"),i=e(this);n.formEditor.initRichEditor({name:t,richName:r,isHidden:!0,isShowText:!1,syncSize:!0,items:["b","customimage","customlink"],onblur:function(){if(this.xmDialogShow)return;this.sync();var e=this.text(),n=i.find("input[data-params]").attr("name");n!=t&&i.find("input[data-params]").val(e);var r=i.attr("data-showedit");setTimeout(function(){!e&&r!="true"?(i.find(".ke-container").hide(),i.find(".textarea-shou").show()):(i.find(".ke-container").show(),i.find(".textarea-shou").hide())},100)}})})):(e(".js-intro-row").html(o.one_intro),n.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0}),n.albumPreview.btnHide(r)),e(this).parents(".is-error").removeClass("is-error").find(".tips").html("")}function a(t){var n=t.value,r=/^\d{1,10}(\.\d{1,2})?$/,i=parseFloat(n);if(!r.test(n)||i<=0)return e(t).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("请输入十位以内的数字,可保留两位小数,最小值0.01"),!1;n&&e(t).val(parseFloat(n));var s="";return parseFloat(n)<.1&&parseFloat(n)>=.01&&(s=e(t).parent().removeClass("is-error").find(".tips-error").attr("data-def")||""),e(t).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html(s),!0}var n=this;this.minSizeLimit=0;var r=t.find("#albumPreview");y.length||(e("[name='is_paid']").parents(".row").remove(),e(".js-price-paytype").remove(),e(".js-price-album").remove(),e(".soundPrice").remove()),y.length==1&&y[0][0]==1&&e(".soundPrice").remove(),y.length==1&&y[0][0]==2&&e(".js-price-album2").remove(),t.find("#genre").selecter({onChange:function(r){var i=t.find("#genre_sub").parent(".cell-2");if(r==2){t.find("#genre_sub").removeClass("hidden");if(current_user.isVerified){var o='<p class="" id="musician-tips"><a href="http://form.mikecrm.com/0u7Pb7" class="link-red" target="_blank">认证音乐人，享受更多权利>></a></p>';i.append(o)}}else t.find("#genre_sub").addClass("hidden"),i.find("#musician-tips").remove();t.find("#genre_sub").parent().removeClass("is-error"),n.albumTags=null,n.albumTags=new s("#searchTagsPanel",{requestUrl:S+"?category_id="+r});if(v&&v.length){var u;for(u=0;u<v.length;u++)if(r==v[u]){e(".js-order-z").parent().click();break}u==v.length&&e(".js-order-d").parent().click()}}}),t.find("#genre_sub").selecter(),t.find("#genre_sub").selecter("val",p[0]||""),t.find("#price_type_id").selecter({onChange:i}),this.isVip&&t.find("#price_type_id").selecter("val","3"),t.find("input").beautify(),t.find('input[name="is_paid"]').on("change",function(){var r=this.value,i=0,s=t.find('input[name="is_paid"]:checked').attr("data-show");r!=="1"?(t.find(".js-copyright").addClass("hidden"),t.find('[class*="js-price-"]').addClass("hidden").find(".is-error").removeClass("is-error"),t.find('input[name="price_type_id"]:checked').removeAttr("checked").parent("label").removeClass("xm-is-checked"),t.find("#price_type_id").selecter("val",""),t.find("#price_type_id .selecter-text").text("请选择"),i=15,n.formEditor.richEditor.intro&&n.formEditor.richEditor.intro.remove(),e(".js-intro-row").html(o.one_intro),n.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0}),t.find(".js-is-public").removeClass("hidden"),t.find(".sub_title").addClass("j-destory"),t.find(".js-free-sub-title-contrain").removeClass("hidden").find(".sub_title").removeClass("j-destory")):(t.find(".sub_title").removeClass("j-destory"),t.find(".js-free-sub-title-contrain").addClass("hidden").find(".sub_title").addClass("j-destory"),t.find(".js-copyright").removeClass("hidden"),t.find("."+s).removeClass("hidden"),t.find(".js-is-public").addClass("hidden").find("label:eq(0)").click(),i=100),M.setRight(e(this).parents(".cell-2")),n.formEditor.flushIntoSize(e('input[name="intro"]'),i,3e3,!1)}),t.on("click",".textarea-shou",function(){var t=e(this).hide().parents(".js-album-moreintro");t.find(".ke-container").show(),n.formEditor.richEditor[t.find("input[data-params]").attr("data-name")].focus()}),t.on("change","#isSample,#eavesdropping",function(){var n=e(this).find("input:checked").val(),r=e(this).attr("data-wran-tips");if(e(this).find('input[name="is_sample"]').length){var i=n?"removeClass":"addClass";t.find(".js-soundpaster")[i]("hidden")}n?t.find("."+r).addClass("hidden"):t.find("."+r).removeClass("hidden")}),t.on("click",".js-otherDesc .icon-edit",function(){e(".js-otherDesc .unedit").hide(),e(".js-otherDesc .edit").show()}),t.on("click",".js-otherDesc .js-sure-edit",function(){var t=e("#other_title").val(),n=e(this).parents(".js-album-moreintro").find(".tips"),r=!1;e.trim(t)||(e(this).parents(".js-album-moreintro").addClass("is-error").find(".tips").html("标题可自定义，不能为空"),r=!0),A(t,20)||(e(this).parents(".js-album-moreintro").addClass("is-error").find(".tips").html("标题可自定义，不能超过10个汉字"),r=!0);if(!!r)return!1;e(this).parents(".js-album-moreintro").removeClass("is-error").find(".tips").html(n.attr("data-def")),e(".js-otherDesc .unedit").show(),e(".js-otherDesc .edit").hide(),e(".js-otherDesc").attr("data-name",e("#other_title").val()),e(".js-otherDescTitle").text(e("#other_title").val())}),t.on("click",".js-otherDesc .js-cancel-edit",function(){e(".js-otherDesc .unedit").show(),e(".js-otherDesc .edit").hide();var t=e(".js-otherDesc").attr("data-name");e("#other_title").val(t)});var u=function(t){var n=e.trim(this.value);if(n==="")n=0;else if(!a(this))return!1;parseFloat(n)>=parseFloat(t)?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("折扣价不能大于或等于原价哦"):e(this).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html("")};t.on("blur focus","#price",function(){a(this),u.call(t.find("#discountprice")[0],e(this).val())}).on("blur focus","#albumprice",function(){a(this),u.call(t.find("#discountprice2")[0],e(this).val())}).on("blur focus","#discountprice2",function(){u.call(this,t.find("#albumprice").val())}).on("blur focus","#discountprice",function(){u.call(this,t.find("#price").val())}),t.on("keyup","#updatedescr",function(){var t=this.value;defTip=e(this).parent().removeClass("is-error").find(".tips").attr("data-def")||"",A(t,60)?e(this).parent().removeClass("is-error").find(".tips").addClass("c02").removeClass("c01").html(defTip):M.setError(e(this).parent(),"字数不能超过30字")}),t.on("keyup","#countsound",function(){var t=this.value,r=parseFloat(t),i=/^\d{1,10}?$/,r=parseInt(t);defTip=e(this).parent().removeClass("is-error").find(".tips").attr("data-def")||"",!i.test(t)||r<=0?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("请输入十位以内的正整数"):(t&&e(n).val(parseFloat(t)),e(this).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html(defTip))}),r.on("click",function(){n.albumPreview.preview(t)})},_initVip:function(){this.$cform.find('[name="is_public"][value="0"]').parent().click().parents(".row").addClass("hidden"),this.$cform.find('[name="is_paid"][value="1"]').parent().click().siblings().addClass("hidden")},_initSetDataPicker:function(e){var t=this.$cform.find(".js-refund-time"),n=t.find("input[name=date]"),r=t.find(".calendarBtn"),i=t.find("#refund_time"),s=i.find("input[name=hour]").closest(".selecter"),o=i.find("input[name=minutes]").closest(".selecter"),u=function(e){return e<10?"0"+e:e},a=new Date;a.setDate(a.getDate()+7);var f=a.getFullYear(),l=a.getMonth()+1,c=a.getDate(),h=a.getHours(),p=a.getMinutes();n.val(f+"-"+u(l)+"-"+u(c)),s.selecter().selecter("val",h),o.selecter().selecter("val",p);var d=30;n.DatePicker({date:a,current:a,starts:1,position:"bottom",onBeforeShow:function(){if(i.hasClass("disabled"))return!1;n.DatePickerSetDate(n.val()||a,!0)},onChange:function(e,t){n.val(e)},onRender:function(e){var t=new Date;return t.addDays(-1),{disabled:e.valueOf()<t.valueOf()}}}),r.on("click",function(){n.click()})},_initSoundPaster:function(){var t=this;e.ajax({url:"/upload/query_voice_tempates",dataType:"json",success:function(e){if(e.res){var n=e.templates,r=[];for(var i=0;i<n.length;i++){var s=n[i];r.push('<div><label class="xm-radio mgb-10"> <input type="radio" name="template_track" value="'+s.id+'">'+'    <div class="smallPlayer" sound_extension="true" sound_id="upload_'+(i+11)+'" sound_url="'+s.url+'">'+'        <a href="javascript:;" class="playBtn"></a>'+"    </div>"+'    <span class="tips">'+s.name+"</span>"+"</label></div>")}r.push('<p class="tips mgt-5"></p>');var o=t.$cform.find(".pay-album-intro");o.append(r.join("")),o.find("input").beautify().on("change",function(){o.find("p.tips").html("").end().removeClass("is-error")}),l.render({$container:t.$cform.find(".smallPlayer")})}}})},uploadImgInit:function(n){n=n||{};var r,s=n.picBtn||e("#uploadPicBtn"),o=n.imgWrap||e("#imageWrap"),u=n.imgBox||o.find(".imgBox2"),a=u.find("img"),f=n.limitWidth,l=n.limitHeight,c=n.url||b;r=new i({url:b,$el:s,maxSize:3,file_upload_limit:1,repeat:!0,file_queued_handler:function(e){u.addClass("is-loading")},error:function(e,t){a.attr("src",w),u.removeClass("is-loading")},success:function(e,n,r){function c(e,t){u.attr("src",e).removeClass("is-loading").addClass("is-fenmian").find("img").attr("src",e).end().find("input").val(t)}var i=e.data[0].processResult,s=E+"/"+i[100],o=E+"/"+i.origin,a=h(e),p=new Image;p.src=o,f&&l?p.onload=function(){if(f!==this.width||l!==this.height){t.alert("请上传"+f+"*"+l+"像素的图片"),u.removeClass("is-loading");return}c(o,i.origin)}:c(s,a)}});var h=function(e){var t={};return t.status=e.status,t.data=[{processResult:e.data[0].processResult,uploadTrack:e.data[0].uploadTrack}],JSON.stringify(t)}},formValidate:function(){var t=e(".js-createalbum-form"),n=t.find("#title"),r=t.find("#origin"),i=t.find("#genre"),s=t.find("#genre_sub"),o=e("[name=rich_intro]"),u=e("[name=intro]"),a=40,f=!0,l={_commonTitle:function(e,t,n,r,i,s){var o=e.parent();if(e.length<=0)return!0;var u=e.val();return!u&&!s?(M.setError(o,n,r),!1):(M.setRight(o,t),o.removeClass("is-error"),i=i||a,A(u,i*2)?!0:(tip="标题太长，必须小于"+i+"个汉字或者"+i*2+"个字母",M.setError(o,tip,r),!1))},title:function(e){return this._commonTitle(n,"好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）","请为专辑加上标题",e)},subTitle:function(e,n,r){var i='  请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">查看展示位置       <span class="hover-detail"><img src="'+config.STATIC_PATH+'/css/img/pic.png"></span>'+"     </span>";return r=r||t.find(".sub_title:not('.j-destory')"),this._commonTitle(r,i,"请为专辑加上副标题",e,20,n)}};return n.on("keyup",function(){l.title()}),t.on("keyup",".sub_title",function(){var t=!1;e(this).attr("data-require")==="false"&&(t=!0),l.subTitle(!0,t,e(this))}),l},doSubmit:function(t){var n=this,r=this.$cform;if(this.ajax_loading)return;this.ajax_loading=!0;var i=this.$cform.serialize(),s=e(".ablum-createBtn");s.addClass("is-loading").text("保存中...");var o="/new_album/create";this.isVip&&(i+="&entrance=membership"),e.ajax({url:o,data:i,type:"POST",success:function(e){e.res?(n.submitCallBack(e),n.destroy(),t.close()):(O.call(n,e.errors,r.find("#infoErr")),s.removeClass("is-loading").text(n.sureText)),n.ajax_loading=!1},error:function(){n.ajax_loading=!1,n.$cform.find("#infoErr").css({color:"red"}).html("服务器未知错误"),s.removeClass("is-loading").text(n.sureText)}})},destroy:function(){for(var e in C)C[e]=null},albumPreview:{btnShow:function(e){e.removeClass("hidden")},btnHide:function(e){e.addClass("hidden")},preview:function(e){var t={title:e.find("#title").val(),soundFace:e.find("#introImageWrap img").attr("src"),albumPrice:e.find("#albumprice").val()||0,discountPrice:e.find("#discountprice2").val()||0,countSound:e.find("#countsound").val()||0,otherTitle:e.find(".js-otherDescTitle").text()||""};f.pop(t)}}};var M={setRight:function(e,t){e.find(".tips").end().removeClass("is-error");var n=e.find(".tips").attr("data-def");t=t||n,t=t||"",e.find(".tips").html(t)},setError:function(e,t,n){e.find(".tips").html(t).end().addClass("is-error"),n&&e.find("input").focus()}};return L}),define("page/center/album",["jquery","page/page_base","module/player/player","plugin/dialog","module/common/ifollow","module/dialogs/create_album","router"],function(e,t,n,r,i,s,o){var u=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),this.bindEvents(),i.init()},bindEvents:function(){var t=this;e("body").unbind("mousedown"),this.cAlbum=new s({sureText:"创建新专辑"},function(e){e.res&&o.toPage(window.location.href)}),e(".creatalbumBtn").unbind("click"),e(".creatalbum-btn,.js-createalbum").unbind("click"),e(".creatalbumBtn").on("click",function(){return t.cAlbum.open(),!1}),e(".creatalbum-btn,.js-createalbum").on("click",function(){return t.cAlbum.open(),!1}),this.$el.on("click",".miniPlayer3 .playBtn",function(){var n=e(this),r=n.closest(".miniPlayer3");if(r.attr("sound_id"))return;var i=n.closest("[album_id]"),s=i.attr("album_id");t.initSoundId(r,n,s)}),this.$el.on("click",".destroyBtn",function(){var n=e(this),i=n.closest("li[album_id]"),s=i.attr("album_id");if(i.hasClass("pay_album"))return;e.ajax({url:"/manage_album/album_voice_count?album_id="+s,type:"POST",success:function(e){if(e.res){e.album_voice_count==0?r.confirm("亲，确定要删除该专辑吗？",function(){t.destroyAlbum(s,!0,function(){i.fadeOut()})},{yesText:"删除"}):e.album_voice_count>0?r.alert("亲，该专辑内有声音，先去移动或删除专辑内的声音吧！"):r.alert("系统未知错误！");return}var n=e.msg||'"系统未知错误！"';r.alert(n)},error:function(){r.alert("系统未知错误！")}})})},destroyAlbum:function(t,n,i){e.post("/my_albums/"+t+"/destroy",{removeSound:n},function(e){if(e.res)r.success("删除成功"),i();else{var t=e.msg||'"系统未知错误！"';r.alert(t)}})},initSoundId:function(t,r,i){e.get("/album/"+i+"/sound_ids",function(e){var i=e[0];t.attr("sound_id",i),n.render({$container:t}),r.trigger("click")})},release:function(){this.callParent("release"),i.release()}});return new u}),define("module/my/fans",["jquery","underscore","backbone","model/user","module/common/ifollow","module/common/iletter","module/card"],function(e,t,n,r,i,s,o){var u=n.View.extend({init:function(){i.init(),s.init(),o.render({$container:e("#mainbox")})},release:function(){i.release(),s.release(),o.release()}});return new u({model:new r})}),define("module/feed_group/groupview",["jquery","underscore","backbone","model/feed_group","module/feed_group/group","plugin/dialog"],function(e,t,n,r,i,s){var o=['<div class="fl"><span><%=title%></span><input maxlength="8" style="display:none;" type="text" value="<%=title%>"></div>','<div class="fr"><a class="edit">编辑</a><a class="delete">删除</a><a class="save">保存</a><a class="cancel">取消</a></div></li>'].join(""),u=n.View.extend({template:t.template(o),tagName:"li",events:{"click .edit":"doEdit","click .delete":"doDelete","click .save":"doSave","click .cancel":"doCancelEdit"},doSave:function(e){var t=this,n=t.$(".fl input"),r=n.val();r?(t.model.set("title",r),t.model.changed.title||t.doCancelEdit()):s.alert("组名不能为空！")},doCancelEdit:function(e){var t=this;t.$(".fl span").show(),t.$(".fl input").hide(),t.$el.removeClass("is-edit"),t.model.off("change:title"),t.model.set("title",t.model.get("title1")),t.render()},doEdit:function(e){var t=this;t.$(".fl span").hide(),t.$(".fl input").show(),t.$el.addClass("is-edit"),t.model.set("title1",t.model.get("title")),t.model.on("change:title",this.doChangeTitle,this)},doDelete:function(e){var t=this;t.model.deleteGroup(function(e,n){i.doRemove(t.model),i.groups.remove(t.model),t.remove()},function(e,t){s.alert(t.msg)})},doChangeTitle:function(){var e=this;e.model.get("title")&&e.model.editGroup(function(t,n){e.render(),e.model.set("title1",t.get("title")),i.doEdit(t),e.doCancelEdit()},function(t,n){s.alert(n.msg),e.model.set({title:""},{slient:!0})})},initialize:function(){},render:function(){var e=this;return e.$el.html(e.template(e.model.toJSON())),this.undelegateEvents(),this.delegateEvents(this.events),e.$el}});return u}),define("module/feed_group/groupmanager",["jquery","underscore","backbone","module/feed_group/groupview","model/feed_group","module/feed_group/group","plugin/dialog"],function(e,t,n,r,i,s,o){var u=['		<div class="grouping_title">','			<div class="fl">组名</div>','			<div class="fr"><a href="javascript:;">为什么要设置分组</a>','           <div class="grouphelp_txt">',"				将关注的账号加入分组，可以帮助你更有效率地浏览关注的声音流和新鲜事。",'				<span class="arrow_group"><i></i></span>',"			</div>","           </div>","		</div>",'		<ul class="grouping_list">',"		</ul>",'		<div class="grouping_btm ">','			<a class="addgroup">+&nbsp;添加组名</a>','			<div class="addgroupdtl">','				<input type="text" maxlength="8">','				<div class="addgroupdtl_r">','					<a href="javascript:;" class="saveBtn">保存</a>','					<a href="javascript:;" class="removeBtn">取消</a>',"				</div>","			</div>","		</div>"].join(""),a=n.View.extend({template:t.template(u),events:{"click .addgroup":"doAddGroup","click .removeBtn":"doAddGroup","click .saveBtn":"doSaveGroup","click .close3Btn":"doClose"},initialize:function(){this.render()},doClose:function(){this.$el.remove()},doAddGroup:function(t){var n=e(t.currentTarget);n.closest(".grouping_btm").toggleClass("is-group-expand")},doSaveGroup:function(t){var n=e(".addgroupdtl input"),r=n.val(),u=this,a;r&&(a=new i({title:r}),a.createGroup(function(e,r){s.doAdd(e),u.doAddGroup(t),n.val("")},function(e,t){o.alert(t.msg)}))},render:function(){var e=this;e.$el.html(e.template()),s.onLoad("groupmanager",function(t){e.$el.find("ul").empty(),t.each(e.doAddGroupView,e)},e),s.onAdd("groupmanager",function(t,n){n=="add"&&e.doAddGroupView.call(e,t)},e),e.undelegateEvents(),e.delegateEvents(e.events)},doAddGroupView:function(e){this.$el.find("ul").append((new r({model:e})).render())},show:function(){var t=this,n=e.extend({id:"dialog_grouping",dialogClass:"grouping",header:"管理分组",content:t.$el},{}),r=new o.Dialog(n);r.open(),s.getGroups(),t.undelegateEvents(),t.delegateEvents(t.events)}});return new a({})}),define("module/feed_group/followgroup/paneldataview",["jquery","underscore","backbone"],function(e,t,n){var r='<label><input type="checkbox" <% if(checked){ %>checked <%}%>/>&nbsp;<%=title%></label>',i=n.View.extend({template:t.template(r),tagName:"li",events:{click:"doClick"},doClick:function(){var e=this.$("input").is(":checked");this.model.set("checked",e)},initialize:function(){this.model.on("change:checked",this.doChangeStatus,this)},doChangeStatus:function(){this.model.get("onCheckChange").call(this,this.model)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el}});return i}),define("module/feed_group/followgroup/panelview",["jquery","underscore","backbone","model/feed_group","module/feed_group/followgroup/paneldataview"],function(e,t,n,r,i){var s=["<ul></ul>",'<div class="groupcreate">','<a href="javascript:;" class="group_add">+创建新分组</a>','<div class="edit">','<input type="text" class="text" maxlength="8" />','<div><a class="editConfirm">确认</a><a class="cancel">取消</a></div>',"</div></div>"].join(""),o=n.View.extend({template:t.template(s),className:"dropdowngroup",titleView:null,$jq:null,timeOutID:0,list:null,events:{"click .group_add":"doShowNew","click .cancel":"doShowNew","click .editConfirm":"doSaveNew"},doShowNew:function(t){var n=e(t.currentTarget);return n.closest(".groupcreate").toggleClass("is-group-create"),!1},doSaveNew:function(e){var t=this,n=t.$("input.text").val();return n&&t.model.get("onSaveNew").call(t.$jq,n,function(n){t.$("input.text").val(""),t.doAddOne(t,n,[]),t.doShowNew(e)}),!1},doSaveGroups:function(e){var t=[],n=this,r=!1;if(n.model.get("changed")===!0){n.list.each(function(e){e.get("id")==-1&&(r=!0),t.push(e.get("id")+"")},n);var i=n.$jq.combobox("options");n.model.get("onChangeGroups").call(n.$jq,t,r,i.uid,function(){n.model.set("changed",!1),e.click()})}else e.click()},render:function(){var e=this;return e.list=new n.Collection,e.$el.html(e.template(e.model.toJSON())),e.titleView.model.set("onChangeStatus",function(t){if(t){var n=e.titleView.$a();if(e.model.get("onBeforeShowGroups").call(e.$jq)==0){n.click();return}e.$el.show(),n.off().on({focus:function(){clearTimeout(e.timeOutID)},blur:function(){e.timeOutID=setTimeout(function(){e.doSaveGroups(n)},300)}}).focus(),e.$el.off("mouseenter").off("mouseleave").off("mouseout").off("mouseover").on({mouseenter:function(){clearTimeout(e.timeOutID),n.blur(),clearTimeout(e.timeOutID)},mouseover:function(){clearTimeout(e.timeOutID),n.blur(),clearTimeout(e.timeOutID)},mouseout:function(){},mouseleave:function(){clearTimeout(e.timeOutID),n.focus()}})}else e.titleView.$a().off(),clearTimeout(e.timeOutID),e.$el.hide()}),e.$el.hide(),e.$el.css("right",7),e.$el},doChangeStatus:function(e){var t="";e&&(this.model.set("changed",!0),e.get("checked")?this.list.add(e):this.list.remove(e));var n=!1;this.list.each(function(e,r){if(!n)if(!t)t+=e.get("title");else{if(!(t.length+e.get("title").length<=7))return t+="...",n=!0,!1;t+=","+e.get("title")}},this),t||(t="未分组"),this.titleView.doChangeTitle(t)},doInitData:function(e,n){var i=this,s;i.$("ul").empty(),t.each(e,function(e,t){e.checked=!1,s=new r(e),i.doAddOne(i,s,n)}),this.doChangeStatus()},doAddOne:function(e,t,n){t.set("onCheckChange",function(t){e.doChangeStatus(t)}),t.set("checked",jQuery.inArray(t.get("id")+"",n)>=0),view=new i({model:t}),t.get("checked")&&e.list.add(t),e.$("ul").append(view.render())}});return o}),define("module/feed_group/followgroup/titleview",["jquery","underscore","backbone"],function(e,t,n){var r='<a href="javascript:;" class="combobox_group group"><em><%= text %></em><span class="arrow_btm"></span></a><p class="cl"></p>',i=n.View.extend({template:t.template(r),className:"",events:{click:"doChangeStatus"},doChangeStatus:function(){var e=this.$("span"),t=!1;return e.is(".arrow_btm")?(e.attr("class","arrow_top"),t=!0):e.attr("class","arrow_btm"),this.model.get("onChangeStatus").call(this,t),!1},$a:function(){return this.$("a")},doChangeTitle:function(e){this.model.set("text",e),this.$("em").text(e),this.$("a").attr("title",e)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el}});return i}),define("plugin/jquery.combobox",["jquery","plugin/jquery.parser"],function(e){(function(e){function t(t){var n=e(t),r=n.combobox("options");n.empty(),r.titleView=new r.TitleView({model:new Backbone.Model({text:decodeURIComponent(r.defaultText)})}),r.panelView=new r.PanelView({model:new Backbone.Model({})}),r.ids=r.sids.split(","),r.panelView.$jq=n,r.panelView.model.set("onSaveNew",r.onSaveNew),r.panelView.model.set("onChangeGroups",r.onChangeGroups),r.panelView.model.set("onBeforeShowGroups",r.onBeforeShowGroups),r.panelView.titleView=r.titleView,n.append(r.titleView.render()),n.append(r.panelView.render())}function n(t,n){var r=e(t),i=r.combobox("options");n&&(i.values=n),i.panelView.doInitData(i.values,i.ids)}function r(t){var n=e(t),r=n.combobox("options");r.titleView.$a().click()}e.fn.combobox=function(n,r){if(typeof n=="string"){var i=e.fn.combobox.methods[n];return i&&e.isFunction(i)?i(this,r):this}return n=n||{},this.each(function(){var r=e.data(this,"combobox");return r?e.extend(r.options,n):(r=e.data(this,"combobox",{options:e.extend({},e.fn.combobox.defaults,e.fn.combobox.parseOptions(this),n)}),t(this)),this})},e.fn.combobox.methods={options:function(t,n){if(t.size())return n=n||"options",e.data(t[0],"combobox")[n]},setDatas:function(e,t){e.size()&&n(e,t)},showPanel:function(e){if(e.size())return r(e[0])},destroy:function(e){if(e.size())return doDestroy(e[0])}},e.fn.combobox.parseOptions=function(t){return e.extend({},e.parser.parseOptions(t,[{values:"array",sids:"string",uid:"number"}]))},e.fn.combobox.defaults=e.extend({},{values:[],ids:[],PanelView:null,TitleView:null,panelView:null,titleView:null,isLoadGroups:!1,sids:"",uid:0,onSaveNew:function(e,t){t(new Backbone.Model({id:10,title:e}))},onChangeGroups:function(t,n,r){var i=this,s=e(i).combobox("options");alert(t.join(",")+n),s.ids=t,r()},onBeforeShowGroups:function(){var t=this,n=e(t).combobox("options");return n.isLoadGroups?e(t).combobox("setDatas",[{title:"必听组",id:-1,checked:!1},{title:"1",id:1,checked:!1},{title:"2",id:2,checked:!1},{title:"3",id:3,checked:!1}]):setTimeout(function(){n.isLoadGroups=!0,e(t).combobox("setDatas",[{title:"必听组",id:-1,checked:!1},{title:"1",id:1,checked:!1}]),e(t).combobox("showPanel")},2e3),n.isLoadGroups},defaultText:"未分组"})})(e)}),define("module/my/follow",["jquery","underscore","backbone","model/user","module/common/ifollow","module/feed_group/groupmanager","module/feed_group/group","module/feed_group/followgroup/panelview","module/feed_group/followgroup/titleview","model/feed_group","module/card","module/common/iletter","plugin/dialog","router","plugin/jquery.combobox"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=n.View.extend({init:function(){i.init(),c.init(),e.fn.combobox.defaults.TitleView=a,e.fn.combobox.defaults.PanelView=u,l.render({$container:e("#mainbox")})},initFeedGroupInfo:function(){var t=this,n=e("div.selecter.group-select"),r=e("<div class='selecter'></div>");o.onLoad("follow",function(e){var t=e.toJSON();o.onRemoveLoad("follow"),t.unshift({id:-1,title:"必听组"}),t.unshift({id:0,title:"分组",selected:!0}),r.addClass("fl group-select").selecter({isCreate:!0,options:t,filed:{name:"title",value:"id",selected:n.attr("val")},customClass:"selecter-s3",onDrop:function(){}}),n.after(r),n.remove(),r.off("change").on("change",function(){var e=r.selecter("val");if(e){var t=location.href;t=t.substring(0,t.indexOf("/")),e=="0"?p.toPage(t+"/#/"+config.CURRENT_USER.uid+"/follow/"):p.toPage(t+"/#/"+config.CURRENT_USER.uid+"/follow?following_group_id="+e)}}),r.find("ul").append('<li><div class="groupmng"><a href="javascript:;">管理分组</a></div></li>'),r.find("ul .groupmng").on("click",function(){s.show()})},t),o.onAdd("follow",function(e,t){t=="add"?r.selecter("add",{value:e.get("id"),name:e.get("title")},-1):t=="remove"?r.selecter("del",e.get("id")):t=="edit"&&r.selecter("edit",{value:e.get("id"),name:e.get("title")})},this),o.getGroups()},release:function(){i.release(),o.onRemoveAdd("follow"),o.onRemoveLoad("follow"),l.release(),c.release()}});return new d({model:new r})}),define("page/center/fans",["jquery","underscore","backbone","module/my/fans","module/my/follow","page/page_base"],function(e,t,n,r,i,s){var o=s.extend({init:function(){this.callParent("init"),r.init(),i.init()},release:function(){this.callParent("release"),r.release()}});return new o}),define("model/report",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{report_id:undefined,content:{},album_id:undefined,uid:undefined,nickname:undefined,content_title:undefined,is_processed:undefined,content_type:undefined,fujian_path:undefined,track_id:undefined},doReport:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/report/create",type:"post",data:r.toJSON(),success:function(e,r,i){r&&r.result=="success"?t(e,r,i):n(e,r,i)}})}});return r}),define("module/common/soundreportview",["jquery","underscore","backbone","json2","model/report","plugin/dialog","module/uploadimg","plugin/jquery.validate"],function(e,t,n,r,i,s,o){var u=["<form>",'	<dl class="report_r1">',"		<dt>如果你觉得该声音内容存在问题，欢迎向管理员举报:</dt>",'		<dd><label><input name="reportType" type="radio" value="3">含有反动内容</label></dd>','		<dd><label><input name="reportType" type="radio" value="2">版权侵权</label></dd>','		<dd><label><input name="reportType" type="radio" value="1">广告欺诈</label></dd>','		<dd><label><input name="reportType" type="radio" value="5">包含色情内容</label></dd>','		<dd><label><input name="reportType" type="radio" value="4">其他</label></dd>',"	</dl>",'	<dl class="popup_dl">',"		<dt>说明</dt>",'		<dd><textarea class="reportText" name="content"></textarea></dd>',"	</dl>",'	<div class="report_tort hidden">','		<div class="fl">',"			<dl>","				<dt>联系人（著作本人或代理律师）</dt>",'				<dd><input type="text" id="username" name="username"></dd>',"			</dl>","			<dl>","				<dt>邮箱</dt>",'				<dd><input type="text" id="email" name="email"></dd>',"			</dl>","			<dl>","				<dt>电话</dt>",'				<dd><input type="text" id="phone" name="phone"></dd>',"			</dl>","		</div>",'		<div class="fr" style="position:relative;">','			<div class="uploadImg report_tort_pic">','               <span style="z-index:1;position: absolute;top: 0px;left: 0px;padding:5px;">侵权证明材料：<br>著作权声明及版权拥有声明等(支持jpeg,jpg,bmp,png格式）</span>','               <img style="width:100%;height:100%;z-index:0;" src="" alt="" />',"           </div>",'           <input type="text" style="position:absolute;top:-10000px;" id="imgPath" name="imgPath">','           <a class="uploadPicBtn">上传图片</a>',"		</div>","       ","	</div>",'	<div class="operate"><a href="javascript:;" class="confirmBtn">确认</a></div>',"</form>"].join(""),a=config.DIRECT_DTRES_ROOT+"/cover/upload",f=n.View.extend({template:t.template(u),events:{"click .confirmBtn":"doReport","click [name='reportType']":"doClick"},doClick:function(t){var n=e(t.currentTarget);n.val()=="2"?this.$el.find(".report_tort").removeClass("hidden"):this.$el.find(".report_tort").addClass("hidden"),this.pop.setPosition()},initialize:function(){this.render()},show:function(){var t=this,n=e.extend({id:"report_aftattention",dialogClass:"report",header:"举报",width:420,content:t.$el},{});t.render(),t.pop=new s.Dialog(n),t.pop.open(),t.$el.find("[name='reportType']:eq(0)").attr("checked","checked"),new o({url:a,$el:t.$el.find(".uploadPicBtn"),maxSize:5,success:function(e,n){var r=e.data[0];t.$el.find(" img").attr("src",config.FDFS_PATH+"//"+r.dfsId),t.$el.find("#imgPath").val(config.FDFS_PATH+"//"+r.dfsId)}}),t.$el.find("form").validate({rules:{username:{required:!0},email:{required:!0,email:!0},phone:{required:!0},imgPath:{required:!0}},messages:{username:{required:"联系人不能为空"},email:{required:"邮箱不能为空",email:"请填写正确的邮箱"},phone:{required:"电话不能为空"},imgPath:{required:"图片不能为空"}},onfocusout:!1,onkeyup:!1,onclick:!1,showErrors:function(t,n){var r=[];n.length&&(e.each(n,function(e,t){r.push(t.message)}),s.alert(r.join("</br>")))},submitHandler:function(){var e=t.$el.find("[name='reportType']:checked").val(),n=t.$el.find(".reportText").val(),i=t.$el.find("#username").val(),o=t.$el.find("#email").val(),u=t.$el.find("#phone").val(),a=t.$el.find("#imgPath").val();e=="2"?n={content:n,picpath:a,mail:o,to_nick:i,phone:u}:n={content:n},t.model.set({report_id:e,content:r.stringify(n)}),t.model.doReport(function(){s.success("举报成功!"),t.pop.close()},function(e,t){s.alert("举报失败!")})}})},doReport:function(e){this.$el.find("form").submit()},render:function(){this.$el.html(this.template(this.model.toJSON())),this.undelegateEvents(),this.delegateEvents(this.events)}});return new f({model:new i})}),define("module/common/commentreportview",["jquery","underscore","backbone","model/report","plugin/dialog"],function(e,t,n,r,i){var s=['<dl class="report_r1">',"	<dt>如果你觉得该声音内容存在问题，欢迎向管理员举报:</dt>",'	<dd><label><input name="reportType" type="radio" value="6">垃圾广告</label></dd>','	<dd><label><input name="reportType" type="radio" value="10">人身攻击我</label></dd>','	<dd><label><input name="reportType" type="radio" value="7">虚假中奖</label></dd>','	<dd><label><input name="reportType" type="radio" value="11">骚扰我</label></dd>','	<dd><label><input name="reportType" type="radio" value="8">含有色情内容</label></dd>','	<dd><label><input name="reportType" type="radio" value="12">冒充我</label></dd>','	<dd><label><input name="reportType" type="radio" value="9">含有反动内容</label></dd>','	<dd><label><input name="reportType" type="radio" value="13">泄露我隐私</label></dd>','	<dd><label><input name="reportType" type="radio" value="14">其他</label></dd>',"</dl>",'<dl class="popup_dl">',"	<dt>说明</dt>",'	<dd><input type="text" class="reportText" name="content"/></dd>',"</dl>",'<div class="operate"><a class="confirmBtn">确认</a></div>'].join(""),o=n.View.extend({template:t.template(s),events:{"click .confirmBtn":"doReport"},initialize:function(){this.render()},show:function(){var t=this,n=e.extend({id:"report_aftattention",dialogClass:"report",header:"举报",content:t.$el},{});t.render(),t.pop=new i.Dialog(n),t.pop.open(),t.$el.find("[name='reportType']:eq(0)").attr("checked","checked"),t.undelegateEvents(),t.delegateEvents(t.events)},doReport:function(e){var t=this,n=t.$el.find("[name='reportType']:checked").val(),r=t.$el.find(".reportText").val();t.model.set({report_id:n,content:JSON.stringify({content:r})}),t.model.doReport(function(){i.success("举报成功!"),t.pop.close()},function(e,t){i.alert("举报失败!")})},render:function(){this.$el.html(this.template(this.model.toJSON()))}});return new o({model:new r})}),define("module/common/ireport",["jquery","underscore","backbone","model/report","module/common/soundreportview","module/common/commentreportview","module/dialogs/login_box"],function(e,t,n,r,i,s,o){var u=n.View.extend({init:function(t){this.release(),t!=="reportBtn"&&t!=="j-report"&&t!=="reportBtn2"&&t&&e("."+t).on("click",[this],this.doReport),e(".reportBtn").off().on("click",[this],this.doReport),e(".reportBtn2").off().on("click",[this],this.doReport),e(".j-report").off().on("click",[this],this.doReport)},doBindOne:function(e){e.on("click",[this],this.doReport)},doReport:function(e){if(!helper.isLogin())return;var t=e.data[0];t.doReport1(this,t)},doReport1:function(t,n){var o=e.extend({},e.parser.parseOptions(t,[{track_id:"number",content_title:"string",content_type:"number"}]));o.content_type==2?(s.model=new r(o),s.show()):o.content_type==1&&(i.model=new r(o),i.show())},release:function(){e(".reportBtn").off("click"),e(".reportBtn2").off("click")}});return new u({model:new r})}),define("page/center/favorites",["jquery","page/page_base","module/player/player","module/common/ifollow","module/common/ireport"],function(e,t,n,r,i){var s=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),n.render({$container:this.$el}),i.init(),r.init()},release:function(){this.callParent("release"),r.release()}});return new s}),define("page/center/follow",["jquery","underscore","backbone","page/page_base","module/my/follow"],function(e,t,n,r,i){var s=r.extend({init:function(){this.callParent("init"),i.init()},release:function(){this.callParent("release"),i.release()}});return new s}),define("page/center/listened",["jquery","page/page_base","module/player/player"],function(e,t,n){var r=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),n.render({$container:this.$el})},release:function(){this.callParent("release")}});return new r}),define("module/albumslist",["jquery","module/dialogs/create_album","plugin/dialog","plugin/EventEmiter","plugin/jquery.selecter"],function(e,t,n,r){var i=function(t,n,r,i){this.$albumlist=e(".js-albumlist"),this.$ul=this.$albumlist.find(".js-album-selecter-ul"),this.$more=this.$albumlist.find(".js-album-more");if(!(n instanceof Function)&&n instanceof Object){this.options=n;for(var s in this.options)this[s]=this.options[s];this.isFromVoice=!0,this.$create=e(".js-album-add")}else this.customCreate=n,this.customChange=r,this.$create=this.$albumlist.find(".js-album-add");this.init(t,this.needSelect)};return i.prototype={init:function(e,n){var r=this;this.$ul.find("li").remove(),n=n||this.needSelect,n=n===!1?!1:!0,this.addList(e,n),!this.customCreate&&(this.cAlbum=new t({sureText:"创建并选择"},function(e){var t={list:[{album_id:e.album.id,cover_url:e.album.cover_url,is_public:e.album.is_public,title:e.album.title,category_id:e.album.category_id,music_category:e.album.music_category,is_paid:e.album.is_paid,upload_source:e.album.upload_source,price_type_id:e.album.price_type_id,discounted_price:e.album.discounted_price,is_sample:e.album.is_sample}]};r.getAlbums(),r.addList(t,!1,!0)})),this.bindEvents(),e||(this.initPageSize=1,this.getMore(this.$more)),this.initPageSize=2,this.currSize=null},onChange:function(e){var t=this,n=e.find(".info").text()||"选择声音所属专辑",r=e.parents(".js-albumlist"),i=e.find("img").attr("src")||config.STATIC_PATH+"/css/img/common/album_100.jpg?v=100",s=e.attr("data-value"),o=e.attr("data-category-id"),u=e.attr("data-music-category"),a=e.attr("data-ispaid"),f=e.find(".privacy").text()||"",l=e.attr("data-upload-source"),c=e.attr("is-sample"),h=e.attr("data-price-type"),p=e.attr("data-discounted-price");this.$albumlist.find(".selecter-selected").find(".info").text(n).end().find("img").attr("src",i).end().find(".privacy").text(f),this.$albumlist.find('input[type="hidden"]').val(s),this.customChange&&this.customChange({album_id:s,title:n,img_src:i,category_id:o,music_category:u,is_public:f,is_paid:a,price_type_id:h,discounted_price:p,is_sample:c,upload_source:l})},bindEvents:function(){var t=this;this.$albumlist.removeAttr("inited"),this.albumSelecter=this.$albumlist.off().selecter({onChange:function(r){if(t.isFromVoice){var i=e(this),s=t.track.isPublic=="true"&&i.attr("data-ispublic")=="私密",o=i.attr("data-ispaid")=="true",u=t.track.isPublic=="false"&&i.attr("data-ispublic")=="公开",a=i.attr("data-upload-source")=="6",f=i.attr("data-album-type")=="2";return s?(n.alert("公开声音不可移入私密专辑"),!1):o?(n.alert("普通声音不可移入付费专辑"),!1):u?(n.confirm("加入此公开专辑后，声音将会被公开哦~",function(){return t.onChange(i),!1}),!1):a?(n.alert("普通声音不可移入A+专辑"),!1):f?(n.alert("该专辑已下架"),!1):(t.onChange(e(this)),!1)}var l=e(this).attr("data-upload-source");if(l==6)return n.confirm("您选择的是有声化平台专辑，编辑有声化平台专辑请到有声化平台。",function(){window.open("http://a.ximalaya.com/member/mytask")},{yesText:"去编辑"}),!1;t.onChange(e(this))}}),this.$more.off().on("click",function(){t.getMore(this)}),this.$create.off().on("click",function(){t.openAlbumPage()})},getCurPage:function(){return this.currSize=this.currSize||this.initPageSize,this.currSize++},getAlbums:function(){var t=[];return this.$albumlist.find(".js-album-selecter-ul li").each(function(){var n=e(this).attr("data-value"),r=e(this).find(".privacy ").text()=="公开"?!0:!1;t.push({ablum_id:n,is_public:r})}),t},getMore:function(t){var n=this,r=e(t),i=e(t).parents(".js-albumlist").find(".js-album-selecter-ul"),s=this.getCurPage(i);r.addClass("is-loading").find("span").addClass("hidden");var o=this.getMoreUrl?this.getMoreUrl+s:"/upload2/choose_album?page="+s;e.ajax({url:o,dataType:"json",success:function(e){e.res&&n.addList(e.albums),r.removeClass("is-loading").find("span").removeClass("hidden")},fail:function(){r.removeClass("is-loading").find("span").removeClass("hidden")}})},addList:function(t,n,r){var i=this;t=t||{},this.$albumlist.each(function(){var s='<li class="selecter-item" data-value="${album_id}" is-sample="${is_sample}" data-discounted-price="${discounted_price}" data-price-type="${price_type_id}" data-album-type="${album_type}" data-upload-source="${upload_source}" data-ispaid="${dataIsPaid}" data-category-id="${category_id}" data-music-category="${music_category}">	<div class="pic fl">		<img src="${cover_url}">	</div> 	<span class="privacy fr">${is_public}</span>  ${is_paid}	<div class="info">${title}	</div></li>  ',o=e(this).find(".js-album-selecter-ul"),u="",a=t&&t.list||[];for(var f=0,l=a.length;f<l;f++){var c=a[f],h=i.beforeAddTemplate&&i.beforeAddTemplate(c);c.dataIsPaid=c.is_paid,c.upload_source=c.upload_source||"",u+=(h||s).replace(/\$\{([^\}]*)\}/g,function(e,t){var n="";for(var r in c)if(t==r){var s=c[r];r=="is_public"&&(s=s?"公开":"私密"),r=="is_paid"&&(i.beforeAddTemplate?s=s?'<span class="c11">精品</span>':"":s=s?'<span class="mglr-10 fr c05 txt-sm">精品</span>':""),n=s}return n||""})}if(r){o.find("li").length>0?o.find("li:eq(0)").before(u):e(u).prependTo(o);var p=o.find("li:eq(0)").addClass("selected").siblings().removeClass("selected").end();return i.onChange(p),!0}o.find("li").length>0?o.find("li:last").after(u):e(u).prependTo(o);var d=o.find("li").length;d==0||d>=t.count?e(".js-album-more").addClass("hidden"):e(".js-album-more").removeClass("hidden");if(n){var p=o.find('li[data-upload-source=""]:eq(0)').addClass("selected").siblings().removeClass("selected").end();i.onChange(p)}})},createAlbum:function(){var e=this.customCreate;if(e&&typeof e=="function"){e();return}this.cAlbum.open()},openAlbumPage:function(){var t=this,n=window.open(config.STUDIO_ROOT+"createAlbum");e.extend(window,r),window.$once("albumResult",function(e){var n={list:[{album_id:e.album.id,cover_url:e.album.cover_url,is_public:e.album.is_public,title:e.album.title,category_id:e.album.category_id,music_category:e.album.music_category,is_paid:e.album.is_paid,upload_source:e.album.upload_source,price_type_id:e.album.price_type_id,discounted_price:e.album.discounted_price}]};t.addList(n,!1,!0)})}},i}),define("module/dialogs/album",["jquery","plugin/dialog","helper","module/dialogs/bindmobile","module/albumslist","plugin/jquery.selecter"],function(e,t,n,r,i){var s={open:function(e){this.options=e,this.curData=e.curData,this.createPop()},albums:[],getAlbumList:function(){var n=this;e.ajax({type:"POST",url:"/handle_track/album_list",dataType:"json",data:{source:n.options.source},success:function(e){e=e.response,n.createPop(e)},error:function(){t.alert("服务器繁忙,请稍后再试!")}})},createPop:function(r){var s=this,o="",u=this.options.album_id,a="",f=this.options.is_public,l='<div class="mgt-10">   <div class=" ">                                            <div class="selecter selecter-s8 js-albumlist"  data-default-value="">        <input type="hidden" name="" value="${curId}">        <div class="selecter-selected" data-value="${curId}">            <div class="selecter-cont">                     <div class="pic fl">                    <img src="${curImage}">                </div>                <span class="privacy fr">${isPublic}</span>                <div class="info">                    ${curTitle}                </div>            </div>            <em class="selecter-arrow">◆</em>        </div>        <div class="selecter-options ">           <div class="options-wrapper">                <ul class="js-album-selecter-ul">  </ul>                <p class="txt-more js-album-more">更多专辑<i class="icon icon-loading"></i></p>           </div>           <div class="wrapper1 bd-t">                <p class="bottom tc js-album-add">                    <span class="icon1 icon-add c05">+</span>创建新专辑                </p>            </div>        </div>    </div>    <!--s: 创建专辑 -->    <div class="create-album cl hidden js-create-album">                                        <div class="pic fl mgr-10">            <img src="${staticPath}/css/img/common/album_100.jpg">        </div>        <div class="info">            <input type="text" name="album_title">            <a class="btn btn-primary btn-sm1 mgl-5 js-create-ablum-btn" href="javascript:;">确认</a>            <a class="btn btn-secondary btn-sm1 mgl-5 js-cancel-create-btn" href="javascript:;">取消</a>        </div>    </div>    <p class="ta-r mgt-5">        <span class="btn1 btn-sm2 btn-add js-album-add"><span class="icon1 icon1-add c05">+</span>创建新专辑</span>    </p>    <p class="infoErr"></p>    <!--e: 创建专辑 --></div><div class="operate wrapper">    <a class="btn btn-primary btn-lg1 js-btn-save-change" dialog-role="yes" href="javascript:;">确认</a>    <a class="btn btn-secondary btn-lg1" dialog-role="cancel" href="javascript:;">取消</a>                 </div></div>';l=l.replace(/\$\{([^}]*)\}/g,function(e,t){for(var n in s.curData)if(t==n)return s.curData[n]||""});var c={dialogClass:"add-to-album pop-c",template:{dialog_close:"",dialog_header:'<div class="hd3 " dialog-role="header"></div>',dialog_body:'<div class="bd1 tb-1" dialog-role="body"></div>'},header:'<span class="btn1 fr"><span class="icon1 icon1-cha" dialog-role="close">×</span>   </span>添加至专辑',content:l,fixed:!1,onYes:function(){if(!e(".js-create-album").is(".hidden")){e(".js-create-ablum-btn").click();if(e(".js-create-ablum-btn").is(".is-error"))return!1}var t=s.$el.find(".js-albumlist input").val();return u==t?(s.pop.close(),!1):(s.joinAlbum(t,f),!1)}},h=new t.Dialog(c);h.open(),this.pop=h,this.$el=h.getEl(),this.albumsList=new i(null,function(){s.createAlbum()},null,!1),this.$el.find(".js-album-add").on("click",function(){s.createAlbum()}),this.$el.find(".js-create-ablum-btn").on("click",function(){var r=s.$el.find(".create-album").find("input").val();if(e.trim(r)==""){e(this).addClass("is-error"),t.alert("专辑标题不能为空");return}if(n.gblen(e.trim(r))>80){e(this).addClass("is-error"),t.alert("标题太长，必须小于40个汉字或者80个字母");return}e(this).removeClass("is-error"),s.saveNewAlbum(r)}),this.$el.find(".js-cancel-create-btn").on("click",function(){s.$el.find(".js-albumlist").removeClass("hidden"),s.$el.find(".create-album").addClass("hidden")})},createAlbum:function(){this.$el.find(".js-albumlist").addClass("hidden"),this.$el.find(".js-create-album").removeClass("hidden").find("input").focus()},saveNewAlbum:function(t){var n=this,r=e(".js-albumlist").find(".selecter-selected");r.attr("data-title",t).attr("data-value",""),r.find("img").attr("src",config.STATIC_PATH+"/css/img/common/album_100.jpg?v=100"),r.find(".privacy").text("公开"),r.find(".info").text(t),e(".js-albumlist > input").val(""),n.$el.find(".js-albumlist").removeClass("hidden"),n.$el.find(".create-album").addClass("hidden")},isPublicAlbum:function(e){var t=this.albumsList.getAlbums();for(var n=0;n<t.length;n++){var r=t[n];if(r.ablum_id==e)return r.is_public}},joinAlbum:function(n,i){function a(){e.ajax({type:"POST",url:"/handle_track/join_album",dataType:"json",data:u,success:function(e){if(e.res)e.id&&e.title?s.options.callback(e):(e.error&&e["error"]=="track_destroyed"&&t.alert("该声音已被原作者删除"),e.error&&e["error"]=="album_full"&&t.alert("哎呀，你选择的专辑已经塞满啦"));else{var n=e.error;if(n)n=="track_destroyed"?t.alert("该声音已被原作者删除"):t.alert(n);else{if(!e.errors){t.alert("不知道什么错误");return}var i=e.errors[0];if(i[0]=="dirty_words"){if(i[1]["-11"]=="album_intro"){t.alert("添加专辑失败，简介包含敏感词");return}if(i[1]["-11"]=="album_title"){t.alert("添加专辑失败，标题包含敏感词");return}}if(i[0]=="mobile"){r.open(function(){t.success("绑定成功",{autoClose:2e3})});return}if(i[0]=="page"&&e.error_symbol==="soundable_platform"){var o="哎呀，该条声音归属于有声化平台，不可删除或移动至其他专辑哟~<br>如该条声音录制效果不理想，您可移驾至有声化平台对该条声音进行替换。";t.confirm(o,function(){window.open(e.edit_url)},{yesText:"去替换",width:"440px"}),s.pop.close();return}if(i[0]=="page"){i[1]!=""&&t.alert(i[1]),s.pop.close();return}}}s.pop.close()},error:function(){t.alert("服务器繁忙,请稍后再试!")}})}var s=this,o=e(".js-albumlist").find(".selecter-selected").attr("data-title"),u={record_id:s.options.record_id};if(o!=""&&!n)u.album_title=o;else{if(!n){t.alert("您还没有选择专辑");return}u.album_id=n}if(i){if(this.isPublicAlbum(n)===!1){t.alert("公开声音只能添加至公开专辑");return}}else if(this.isPublicAlbum(n)===!0){t.confirm("确定要添加私密声音至公开专辑吗？",a);return}a()},doCreate:function(){var i=this.$el||e(".js-create-album"),s=this,o=e.trim(i.find("input[name='album_title']").val());if(!o){t.alert("专辑标题不能为空");return}if(n.gblen(o)>80){t.alert("标题太长，必须小于40个汉字或者80个字母");return}e.ajax({type:"POST",url:"/handle_track/join_album",dataType:"json",data:{record_id:s.options.record_id,album_title:o},success:function(e){if(e.res)e.id&&e.title?(s.$el.find(".js-albumlist").removeClass("hidden"),s.$el.find(".create-album").addClass("hidden")):t.alert("添加专辑失败");else{var n=e.error;if(n)n=="track_destroyed"?t.alert("该声音已被原作者删除"):t.alert(n);else{if(!e.errors){t.alert("不知道什么错误");return}var i=e.errors[0];i[0]=="dirty_words"&&i[1]["-11"]=="album_title"&&t.alert("添加专辑失败，标题包含敏感词");if(i[0]=="mobile"){r.open(function(){t.success("绑定成功",{autoClose:2e3})});return}}}},error:function(){t.alert("服务器繁忙,请稍后再试!")}})}};return s}),define("page/center/sound",["jquery","page/page_base","module/player/player","module/dialogs/album","plugin/dialog","module/common/ifollow","router","plugin/jquery.selecter"],function(e,t,n,r,i,s,o){var u=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),n.render({$container:this.$el}),this.$el.find("li.pay_sound").each(function(){e(this).find(".destroyBtn").attr("destroy_id","")}),s.init(),this.bindEvents()},bindEvents:function(){var t=this;this.$el.find('[data-transcode-state="1"]').each(function(){var n=e(this).find(".content_wrap"),r=e(this).attr("data-upload-id");r=r.replace("u_","");var i=setInterval(function(){e.ajax({url:"/dtres/zhuanma/"+r+"/jindu/"+(new Date).getTime(),dataType:"json",success:function(e){var r="";switch(e.state){case"success":r="转码成功",clearInterval(i);break;case"lowbitrate":r="音质过低",clearInterval(i);break;case"error":r="转码失败",clearInterval(i);break;case"processing":t.transcoding=!0;if(parseInt(e.value)>=100)return;r="转码进度 "+e.value+"%";break;case"queueing":r="等待转码";break;case"unkown":clearInterval(i)}var s='<div class="listenhelp is-review js-listenhelp"><span class="tit">'+r+"</span></div>";n.find(".js-listenhelp").remove(),n.append(s)}})},1e3)}),this.$el.on("click",".personal_addtoAlbum",function(){var t=e(this),n=t.closest(".sound_titlebar"),s=n.find(".from"),o=e.parseJSON(t.attr("data-options")||"{}"),u=t.attr("data-album-id"),a=!t.closest(".sound_unexpandBox").find(".privacyIcon").size(),f=n.find(".sound_title").find("i");o.callback=function(e){t.html("更改专辑").attr("data-album-id",e.id);var n='&nbsp;&nbsp;来自<a href="/'+config.CURRENT_USER.uid+"/album/"+e.id+'" hashlink>《'+e.title+"》</a>";t.attr("data-image-url",config.STATIC_PATH+"/css/img/common/album_100.jpg?v=100"),t.attr("data-album-title",e.title),t.attr("data-is-public",e.is_public),s.html(n),e.is_public&&f.remove(),i.success()},o.album_id=u,o.is_public=a;var l=u,c=t.attr("data-image-url"),h=t.attr("data-album-title"),p=t.attr("data-is-public")=="true"?"公开":"私密",d=config&&config.STATIC_PATH||"//s1.xmcdn.com";o.curData={curId:l,curImage:c,curTitle:h,isPublic:p,staticPath:d},r.open(o)}),this.$el.find(".selecter").selecter().on("change",function(e,t){if(!history.pushState)return;var n=t.attr("href");o.toPage(n)})},release:function(){this.callParent("release"),s.release()}});return new u}),define("page/center/publish",["jquery","page/page_base","module/player/player","plugin/dialog"],function(e,t,n,r){var i=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),soundManager.setup({onready:function(){n.render({$container:this.$el}),soundManager.isOnReady=!0}}),this.bindEvents()},bindEvents:function(){var t=this;this.$el.on("click",".moreBtn",function(){var t=e(this),n=t.closest(".item");return n.find(".gapB.hidden").slideToggle(),t.toggleClass("expand").toggleClass("unexpand"),!1}),this.$el.on("click",".personal_deleteBtn[track_destroy_id]",function(){var n=e(this),r=n.attr("track_destroy_id");t.destroyPublish("delayed_track_id",r,function(){n.closest("li.item").slideUp()})}),this.$el.on("click",".deleteBtn[album_destroy_id]",function(){var n=e(this),r=n.attr("album_destroy_id");t.destroyPublish("delayed_album_id",r,function(){n.closest("li.item").slideUp()})})},destroyPublish:function(t,n,i){i=i||e.noop;var s={};s[t]=n,r.confirm("确定要删除吗？",function(t){e.ajax({url:"/my_publish_tracks_and_album/destroy",type:"post",dataType:"json",data:s,success:function(e){r.success("操作成功"),i(e)},error:function(){r.alert("操作失败")}})},{yesText:"删除"})},release:function(){this.callParent("release")}});return new i}),define("module/my/soundwallbg",["jquery","underscore","backbone","module/uploadimg","plugin/dialog","model/setting","plugin/jquery.easydrag"],function(e,t,n,r,i,s){var o=new s,u=n.View.extend({init:function(){this.$el=e(".personal-center");var t=this.$el.find("#uploadCoverBtn");t.attr("id","uploadCoverBtn");if(t.size()==0)return;this.$img=this.$el.find(".bg-img-wrapper img"),this.saveData={uploadTrackId:"",y:0},this.bindEvents(),this.initUploadImg(),this.copyStatus()},copyStatus:function(){var e=this.$img;this._oldStatus={src:e.attr("src"),top:e.position().top}},initUploadImg:function(){var t=this,n=this.$el.find(".bg-img-wrapper");new r({url:config.UPLOAD_ROOT+"/picture/upload",$el:t.$el.find("#uploadCoverBtn"),file_upload_limit:1,repeat:!0,beforeUpload:function(e){n.addClass("loadingMore"),t.$img.attr("src",""),t.$img.css("visibility","hidden")},success:function(r,i){var s=r.data[0].uploadTrack;t.$img[0].onload=function(){t.$img.css("top",0),t.saveData.uploadTrackId=s.id,t.startDrag(),n.removeClass("loadingMore"),t.$el.addClass("is-save"),t.$img[0].onload=null,t.$img.css("visibility","visible")},t.$img.attr("src",config.FDFS_PATH+"/"+s.url),e("#comfirm_div").show(),e("#head_masker").hide()}})},startDrag:function(){var e=this.$img,t=this;e.ondrag(function(t,n){e.css("left",0);var r=e.position().top,i=e.height();r>0&&e.css("top",0),r+i<350&&e.css("top",350-i)}),e.easydrag()},cancelChange:function(){var t=this._oldStatus,n=this.$img;n.attr("src",t.src),n.css("top",t.top),this.stopDrag(),e("#comfirm_div").hide(),e("#head_masker").show()},bindEvents:function(){var e=this,t=this.$el;t.on("click","#comfirm_btn",function(){e.saveChange()}),t.on("click","#moveImg",function(){e.startDrag()}),t.on("click","#concel_btn",function(){e.cancelChange()})},saveChange:function(){var t=this;this.saveData.y=this.$img.position().top,o.background(this.saveData,function(){t.saveData.uploadTrackId="",i.success("保存成功"),t.stopDrag(),t.copyStatus(),e("#comfirm_div").hide(),e("#head_masker").css("z-index","99999999999").show()},function(){})},stopDrag:function(){this.$img.dragOff(),this.$img.css("cursor","default"),this.$el.removeClass("is-save")},release:function(){this.$el.off()}}),a=new u;return a}),define("page/center/common",["jquery","page/page_base","module/my/soundwallbg","module/header/message","plugin/jquery.selecter"],function(e,t,n,r){var i=t.extend({init:function(){this.callParent("init"),n.init();var t=e('[m-name="menu"]'),i=e('[m-name="sub-menu"]'),s=e('[category="community"]');s.find(i).children().off().each(function(t){var n=this,i=e(n).attr("category");if(!i)return;var o=i.replace(/(_[a-z])/,function(e,t){return t.substring(1).toUpperCase()});r.messageModel.get(o)>0&&(e(n).addClass("red-dot"),e(n).off().on("click",r.toOne),s.removeClass("red-dot").addClass("red-dot"))}),t.children().off().on("click",".aside_title",function(){var t=e(this).parent(),n=e(".j-pageTitle").text(),r="",i="",s="";e(this).attr("xmlog-title")==="首页"?(r="pageview",i="pageview",s="首页"):(i="event",r="click",s="一级菜单"),xmLog&&xmLog("pv.create",{item:n,itemId:""}),xmLog&&xmLog("pv.send",i,{serviceId:r,srcPage:"主播中心",srcModule:s,srcTitle:e(this).attr("xmlog-title")}),t.toggleClass("active"),t.siblings().removeClass("active")}),i.off().on("click","li",function(t){var n=e(this),r=e(".j-pageTitle").text();xmLog&&xmLog("pv.create",{item:r,itemId:""}),xmLog&&xmLog("pv.send","pageview",{serviceId:"pageview",srcPage:"主播中心",srcModule:"二级菜单",item:e(this).find("[xmlog-item]").attr("xmlog-item"),srcTitle:e(this).find("[xmlog-title]").attr("xmlog-title")}),n.find("a").attr("target")===undefined&&(i.find("li").removeClass("active"),n.addClass("active"))})},release:function(){this.callParent("release")}});return new i}),define("page/center/live_manage",["jquery","backbone","page/page_base","module/player/player","plugin/dialog","module/uploadimg"],function(e,t,n,r,i,s){var o=n.extend({init:function(){this.bindEvents()},bindEvents:function(){var t=this,n=[],r=new s({url:config.UPLOAD_ROOT+"/liveActivity/upload",$el:e(".imgBox .btn-upload"),maxSize:3,file_queue_limit:4,file_upload_limit:5,swfupload_loaded_handler:function(){},file_dialog_complete_handler:function(){},file_queued_handler:function(t){var n=e('<div class="imgBox is-loading"><a class="del"></a><div class="imgItem"><img src=""><input type="hidden" name=""><div class="imgLoading"></div></div></div>').prependTo(e(".live_pic_div")),r=e(".live_pic_div .imgBox").length;r==6?e(".live_pic_div").find(".imgBox:last").hide():e(".live_pic_div").find(".imgBox:last").show()},error:function(e,t){},success:function(t,r,i){e.each(e(".live_pic_div .imgBox"),function(){if(e(this).hasClass("is-loading")){var n=e("<div></div>").addClass("imgItem img_div");e(this).find(".imgItem").replaceWith(n),e(this).removeClass("is-loading");var r=e("<img>").attr({src:config.FDFS_PATH+"/"+t.data[0].processResult[100],dfsId:t.data[0].dfsId,large_pic:t.data[0].processResult["640n"]}).prependTo(n);return!1}}),n.push(t.data[0].dfsId)}});e(document).on("click",".live_pic_div .img_div",function(){var n=e(this).find("img").attr("large_pic");e("#pic_view_div .cont").find("img").attr("src",config.FDFS_PATH+"/"+n),e("#pic_view_div").fadeIn(100);var r=e(".live_pic_div .img_div").length,i=e(".live_pic_div .img_div").index(this);e("#pic_view_div .total_pic").text(r),e("#pic_view_div .current_pic").text(i+1),t.check_view_page(i,r),e("#pic_view_div .pic_view_left").off().on("click",function(){var n=e(".live_pic_div .img_div").eq(i-1).find("img").attr("large_pic");e("#pic_view_div .cont").find("img").attr("src",config.FDFS_PATH+"/"+n),i--,e("#pic_view_div .current_pic").text(i+1),t.check_view_page(i,r)}),e("#pic_view_div .pic_view_right").off().on("click",function(){var n=e(".live_pic_div .img_div").eq(i+1).find("img").attr("large_pic");e("#pic_view_div .cont").find("img").attr("src",config.FDFS_PATH+"/"+n),i++,e("#pic_view_div .current_pic").text(i+1),t.check_view_page(i,r)})}),e(".live_record_pics").on("click","a",function(){var n=e(this).attr("data-big-picture");e("#pic_view_div .cont").find("img").attr("src",n),e("#pic_view_div").fadeIn(100);var r=e(this).parent().find("a").length,i=e(this).index(),s=e(this);e("#pic_view_div .total_pic").text(r),e("#pic_view_div .current_pic").text(i+1),t.check_view_page(i,r),e("#pic_view_div .pic_view_left").off().on("click",function(){var n=s.parent().find("a").eq(i-1).attr("data-big-picture");e("#pic_view_div .cont").find("img").attr("src",n),i--,e("#pic_view_div .current_pic").text(i+1),t.check_view_page(i,r)}),e("#pic_view_div .pic_view_right").off().on("click",function(){var n=s.parent().find("a").eq(i+1).attr("data-big-picture");e("#pic_view_div .cont").find("img").attr("src",n),i++,e("#pic_view_div .current_pic").text(i+1),t.check_view_page(i,r)})}),e("#pic_view_div").on("click","button.pic_view_del",function(){e("#pic_view_div").fadeOut(100)}),e(".live_pic_div").on("click","a.del",function(){var t=e(this).parent().find("img").attr("dfsId");n.splice(e.inArray(t,n),1),e(this).parent().remove(),r.increaseUploadLimit();var i=e(".live_pic_div .imgBox").length;i!=6&&e(".live_pic_div").find(".imgBox:last").show()}),e("#live_send_btn").on("click",function(){e.ajax({url:"/activity-live/create_message",type:"POST",data:{live_id:e(this).attr("data-live-id"),text:e("#live_create_input").val(),images:n.reverse()},success:function(e){if(e.res===!1){alert(e.msg);return}router.toPage(e.refresh_url)},error:function(){alert("请求失败")}})}),e(document).off("click",".list-log button"),e(document).on("click",".list-log button",function(){var t=e(".paging-bar a.on").text(),n=e(".list-log ul li").length;n==1&&t--,e.ajax({url:"/activity-live/destroy_message",type:"POST",data:{live_id:e(this).attr("data-live-id"),message_id:e(this).attr("data-message-id"),page:t},success:function(e){if(e.res===!1){alert(e.msg);return}router.toPage(e.refresh_url)},error:function(){alert("请求失败")}})})},check_view_page:function(t,n){t==0?e("#pic_view_div .pic_view_left").addClass("hidden"):e("#pic_view_div .pic_view_left").removeClass("hidden"),t==n-1?e("#pic_view_div .pic_view_right").addClass("hidden"):e("#pic_view_div .pic_view_right").removeClass("hidden")},release:function(){this.callParent("release")}});return new o}),define("page/center/comment",["jquery","page/page_base","page/center/common","plugin/face","router","plugin/dialog","module/common/ireport"],function(e,t,n,r,i,s,o){var u=t.extend({init:function(){var t=this;n.init(),this.pageInit(),this.faceFormat(),this.replyInit(r),e(".j-del").click(function(){var t=e(this),n=t.attr("data-url"),r=JSON.parse(t.attr("data-options"));s.confirm("确定删除？",function(){e.post(n,r).done(function(n){n.res===!0?t.closest("li").slideUp(function(){e(this).remove()}):s.alert(n.msg)})})}),o.init("j-report"),e(document).off("click",".j-subcomt"),e(document).on("click",".j-subcomt",function(){var n=e(this).closest("li"),r=n.find(".j-reply"),i=n.find("textarea"),s=n.find(".reply-msg"),o=r.attr("data-url"),u=JSON.parse(r.attr("data-options"));u.content=i.val(),u.shareList="",e.post(o,u).done(function(e){e.res?(s.remove(),t.toastInit("评论成功")):t.toastInit(e.msg)})})},pageInit:function(){var t=e(".paging-bar").find("a");e.each(t,function(t,n){var r=e(this),i=r.attr("href");r.attr("href",i)})},faceFormat:function(){e(".talk-info").each(function(){var t=this,n=e(this),i=n.find(".talk-msg"),s=n.find(".past-msg");i.length&&i.html(r.getHtml(i.html())),s.length&&s.html(r.getHtml(s.html()))})},replyInit:function(t){var n=this,r=e(".reply-msg .user-head").attr("src"),i='<div class="reply-msg j-replyBox hidden">   <a href=""><img class="user-head fl" src="'+r+'"></a>'+'   <textarea class="reply-box"></textarea>'+'   <p class="edit-rest">还可以输入140个字</p>'+'   <div class="cl reply-btn">'+'       <a href="javascript:;" data-url="/center/comment/createComment" class="btn btn-primary btn-sm6 disabled-white fr j-subcomt"><span>评论</span></a>'+'       <span class="face-icon">表情</span>'+"    </div>"+"</div>";e(".j-reply").click(function(r){var s=e(this),o=s.closest("p"),u=s.closest("li"),a=e(i),f=a.find("textarea"),l=a.find(".j-subcomt");e.each(e(".j-reply"),function(){s.get(0)===this?u.find(".reply-msg").length===0?(a.insertBefore(o),a.slideDown()):e(this).parent().siblings(".reply-msg").slideUp(function(){e(this).remove()}):e(this).parent().siblings(".reply-msg").slideUp(function(){e(this).remove()})}),t.init(a.find(".face-icon"),a.find("textarea")),n.checkCount(f,l,140)})},checkCount:function(t,n,r){var i=t.next(),s=0;t.on("keydown keyup focus change input blur",function(){var t=e(this).val().length;s&&clearTimeout(s),s=setTimeout(function(){var e=r-t;e>=0&&(i.text("还可以输入"+e+"个字"),n.removeClass("disabled-white"),i.removeClass("text-red")),e<0&&(i.text("已超出"+Math.abs(e)+"个字"),n.addClass("disabled-white"),i.addClass("text-red")),t===0&&(n.addClass("disabled-white"),i.removeClass("text-red"))},100)})},toastInit:function(t){var n=e(document.body),r,i='<span class="anchor-toast">'+t+"</span>";n.append(i),r&&clearTimeout(r),r=setTimeout(function(){e(".anchor-toast").remove()},2e3)},release:function(){this.callParent("release")}});return new u}),define("page/center/like",["jquery","page/page_base","page/center/common","module/player/player"],function(e,t,n,r){var i=t.extend({init:function(){n.init(),this.callParent("init"),this.$el=e("#mainbox"),r.render({$container:this.$el})},release:function(){this.callParent("release")}});return new i}),define("page/center/dataCenterUtils",["jquery","underscore"],function(e,t){var n={getUrlHost:function(){var e=window.helper.getParameterByName("realId"),t=/test\./gi.test(window.location.host),n={web:t?"http://hybrid.test.ximalaya.com/data/web":"http://hybrid.ximalaya.com/data/web",ops:t?"http://hybrid.test.ximalaya.com/data/ops":"http://hybrid.ximalaya.com/data/ops"},r=e?"ops":"web";return n[r]},getRealId:function(){return window.helper.getParameterByName("realId")||null},parseCompared:function(e){var t=' <i class="iconfont icon-ic_drop"></i> ',n=' <i class="iconfont icon-ic_rise"></i> ';return e.charAt(0)==="-"?e=t+e.substr(-e.length):e=n+e,e}};return n}),define("page/center/index",["jquery","page/page_base","page/center/common","page/center/dataCenterUtils"],function(e,t,n,r){var i=t.extend({init:function(){this.callParent("init"),n.init(),this.bindEvents(),this.calcuBar(),this.fetchData()},bindEvents:function(){e(".icon-ic_x").on("click",function(){e(this).parent().addClass("hidden"),e.cookie("grade_hover","false",{expires:31536e3,domain:".ximalaya.com",path:"/"})}),xmLog&&xmLog("pv.create",{item:"Web主播中心-Banner",itemId:""}),e(".host-banner").on("click",function(){xmLog&&xmLog("pv.send","event",{serviceId:"click",srcPage:"主播中心",srcModule:e(this).attr("xmlog-mod")})}),e(".news-lists").on("click","li>a",function(t){var n=e(t.currentTarget),r=/\?id=(\d+)/.exec(n.attr("href"))[1],i=n.find(".text-content").text().trim();xmLog&&xmLog("pv.send","event",{serviceId:"pageClick",srcTitle:i,srcPage:"主播中心",srcModule:"官方公告列表",item:"官方公告",itemId:r})})},calcuBar:function(){var t=e(".j-score").attr("data-rate")*100;e(".redBar").css({width:t+"%"})},release:function(){this.callParent("release")},fetchData:function(){var t=this,n=r.getUrlHost(),i=n+"/anchorKpis/ts-"+Date.now();e.ajax({url:i,type:"get",xhrFields:{withCredentials:!0},success:function(e){e.ret===200?t.setData(e):t.toastError()},error:function(e){t.toastError()}})},setData:function(t){var n=e(".js-playedTotal"),r=e(".js-followerTotal"),i=e(".js-subscribedTotal");n.text(t.playedTotal),r.text(t.followerTotal),i.text(t.subscribedTotal)},toastError:function(){var t=e("#sub-main-box"),n=e('<div class="toast"></div>');n.text("服务器异常，请稍后重试"),t.append(n),setTimeout(function(){n.remove()},1500)}});return new i}),define("page/center/voice",["jquery","plugin/dialog","helper","page/page_base","page/center/common","module/player/player","router","module/albumslist","module/dialogs/share2friend","plugin/jquery.selecter"],function(e,t,n,r,i,s,o,u,a){function c(n,r,i){e.ajax({url:"/center/voice/getListJson",type:"GET",dataType:"json",data:n,success:function(e){e.res&&(r.html(e.Html),i&&i())},error:function(){t.alert("服务器繁忙,请稍后再试!")}})}function h(t,n){var r=e.trim(t.val()),i=f.voiceType,s=location.href.match(/voiceType=(\d+)/),i=s?s[1]:"3";f={voiceType:i,keyWord:decodeURIComponent(r)},c(f,e("#trackList"),n)}var f={},l="/center/voice";(function(){var t=location.href.match(/voiceType=(\d+)/),n=t?t[1]:"3";f.voiceType=n})();var p={album:{},track:{},lockDialog:!1,createAlbum:function(r){var i=this;i.$addToAlbum=e(".addTo-album"),i.$addToAlbum.find(".js-btn-save-change").addClass("disabled-white"),i.$addToAlbum.find(".js-album-add").addClass("hidden"),i.$addToAlbum.find(".js-create-album").removeClass("hidden"),i.$addToAlbum.find(".js-create-album").find("input").on("keyup",function(t){var n=t.target.value;e.trim(n)!=""?i.$addToAlbum.find(".js-create-album-btn").addClass("on"):i.$addToAlbum.find(".js-create-album-btn").removeClass("on")}),i.$addToAlbum.find(".js-create-album-btn").off().on("click",function(){var s=i.$addToAlbum.find(".js-create-album").find("input").val();if(e.trim(s)==""){t.alert("专辑标题不能为空");return}if(n.gblen(e.trim(s))>80){t.alert("标题不能超过40个字哦~");return}i.createNewAlbum(s,r)})},createNewAlbum:function(n,r){var i=this;e.ajax({type:"POST",url:"/center/myAlbum/createDefault",dataType:"json",data:{albumTitle:n},success:function(s){if(s.res){i.album.isPublic=s.isPublic;function o(t,n){var s=e(".js-albumlist").find(".selecter-selected");s.attr("data-title",t).attr("data-value",""),s.find(".privacy").text(n.isPublic?"公开":"私密"),s.find("img").attr("src",config.STATIC_PATH+"/css/img/common/album_100.jpg?v=100"),s.find(".info").text(t),e(".js-create-album > input").val(""),e(".js-create-album").addClass("hidden"),e(".js-album-add").removeClass("hidden"),e(".js-btn-save-change").removeClass("disabled-white"),r.init(),i.saveChange(n,r)}if(i.track.isPublic=="false")i.lockDialog||(i.lockDialog=!0,t.confirm("加入此公开专辑后，声音将会被公开哦~",function(){return i.lockDialog=!1,o(n,s),!1},{cancel:function(){return i.lockDialog=!1,e(".js-create-album > input").val(""),e(".js-create-album").addClass("hidden"),e(".js-album-add").removeClass("hidden"),r.init(),!1}}));else if(i.track.isPublic!="false")return o(n,s),!1}else t.alert(s.msg)},error:function(){t.alert("服务器繁忙,请稍后再试!")}})},saveChange:function(n,r){var i=this;e(".js-btn-save-change").off().on("click",function(){e.ajax({type:"POST",url:"/center/voice/moveAlbum",dataType:"json",data:{trackId:i.track.trackId,albumId:n.albumId||n.album_id},success:function(r){r.res?(e(".maskers").addClass("hidden"),t.success("更改成功"),n.albumId?(i.$moveAlbumBtn.attr("data-album-id",n.albumId),i.$moveAlbumBtn.attr("data-album-title",n.albumTitle),i.$moveAlbumBtn.attr("data-album-paid",!1),i.$moveAlbumBtn.attr("data-image-url",n.coverPath||config.STATIC_PATH+"/css/img/common/album_100.jpg?v=100"),i.$moveAlbumBtn.attr("data-album-ap",!1),i.$moveAlbumBtn.attr("data-album-public",!0)):(i.$moveAlbumBtn.attr("data-album-id",n.album_id),i.$moveAlbumBtn.attr("data-album-title",n.title),i.$moveAlbumBtn.attr("data-album-paid",n.is_paid),i.$moveAlbumBtn.attr("data-image-url",n.img_src),i.$moveAlbumBtn.attr("data-album-ap",n.upload_source=="6"?!0:!1),i.$moveAlbumBtn.attr("data-album-public",n.is_public=="公开"?!0:!1)),f.filter=="privacy"&&i.album.isPublic&&i.track.isPublic=="false"?i.$moveAlbumBtn.parent().parent().parent().fadeOut():f.filter!="privacy"&&i.album.isPublic&&i.track.isPublic=="false"&&(i.$moveAlbumBtn.parent().parent().parent().find(".js-voice-status .private-tag").remove(),i.$moveAlbumBtn.parent().parent().parent().find(".js-voice-status").append("<span class='link-tag open-tag'>公开</span>"))):t.alert(r.msg)},error:function(){t.alert("服务器繁忙,请稍后再试!")}})})}},d=r.extend({init:function(){i.init(),this.parmsO=f,this.bindEvents(),this.lockDialog=!1},bindEvents:function(){var e=this;s.render({$container:e.$el}),e.playVoice(),e.shiftTab(),e.shiftSelecter(),e.moveAlbum(),e.downloadTrack(),e.orderShift(),e.paging(),e.deleteTrack(),e.shareTrack(),e.searchKeyword(),e.share2friend();if(window._bd_share_main){if(window._bd_share_config&&window._bd_share_config.common){var t=window._bd_share_config.common.onBeforeClick;window._bd_share_config.common.onBeforeClick=function(e){t.apply(this,arguments)}}_bd_share_main.init()}},playVoice:function(){var n=this;e(".miniPlayer5 .js-play").off().on("click",function(e){t.alert("该节目已被删除或下架")})},shiftTab:function(){e(".comment-tab").children().each(function(){var t=e(this),n=t.attr("type-value");t.on("click",function(){f={voiceType:n},o.toPage(l+"?isPlug=true&voiceType="+n,!0,"#sub-main-box")})})},shiftSelecter:function(){var t=this;e(".selecter-s5").selecter({onChange:function(n){var r=f.voiceType;f={voiceType:r,filter:n},c(f,e("#trackList"),function(){t.bindEvents()})}})},orderShift:function(){var t=this;e(".voice-table .arr-th").on("click",function(){f.pageNum&&delete f.pageNum,e(this).hasClass("open")?f.order=2:f.order=1,c(f,e("#trackList"),function(){t.bindEvents()})})},moveAlbum:function(){window.top!=window.self&&e(".maskers").css("background","none"),e('[category="moveAlbum"]').each(function(){var t=e(this);t.on("click",function(){p.$moveAlbumBtn=t;var n=t.attr("data-album-id"),r=t.attr("data-album-title"),i=t.attr("data-album-paid"),s=t.attr("data-image-url"),o=t.attr("data-album-public"),a=t.attr("data-album-ap"),f=t.parent().parent().parent().find(".album-msg");p.track.trackId=f.attr("sound_id"),p.track.isPublic=f.attr("is_public"),p.track.priceType=f.attr("price_type"),p.track.uploadSource=f.attr("upload_source"),p.track.isDeleted=f.attr("is_deleted");var l='<span class="sel-alb-arrow icon1 icon1-arrow1 fr">◆</span><img src="'+s+'" alt="" class="sel-alb-pic fl">'+'<p class="sel-alb-tit txt-mid2 elli info">'+r+"</p>"+'<p class="sel-alb-info">'+'<span class="c02 privacy">'+(o=="true"?"公开":"私密")+"</span>"+(i=="true"?'<span class="c11">精品</span>':"")+"</p>",c=e(".js-albumlist");c.find(".selecter-selected").html(l);if(window.top!=window.self){var h=e(window.top).scrollTop()+e(window.top).height()/2-100;e(".addTo-album").css("top",h)}e(".addTo-album").parent().removeClass("hidden"),e(".addTo-album").find(".js-album-selecter-ul li").remove();var d=new u(null,{pageSize:10,customCreate:function(){var e=this;p.createAlbum(d)},customChange:function(t){var n=this;e(".js-btn-save-change").removeClass("disabled-white"),t.is_public=="公开"?p.album.isPublic=!0:t.is_public=="私密"&&(p.album.isPublic=!1),p.album.isPaid=t.is_paid=="true"?!0:!1,p.album.uploadSource=t.upload_source,p.saveChange(t,d)},needSelect:!1,track:p.track,beforeAddTemplate:function(e){var t="",n=p.track.isPublic=="true"&&!e.is_public,r=e.is_paid,i=e.upload_source==6,s=e.album_type===2;if(n||r||i||s)t="not-select";var o='<li class="select-alb-cont selecter-item cl '+t+'" '+'data-value="${album_id}" is-sample="${is_sample}" data-ispaid="${dataIsPaid}" data-discounted-price="${discounted_price}" data-price-type="${price_type_id}" data-title="${title}" data-ispublic="${is_public}" data-album-type=${album_type} data-upload-source="${upload_source}" data-category-id="${category_id}" >'+'<img src="${cover_url}" alt="" class="sel-alb-pic fl">'+'<p class="sel-alb-tit txt-mid2 elli info">${title}</p>'+'<p class="sel-alb-info">'+'<span class="c02 privacy">${is_public}</span>'+'<span class="c11">${is_paid}</span>'+"</p>"+"</li>";return o},getMoreUrl:"/center/myAlbum/querySimpleAlbums?pageNum="});e(".js-btn-cancel-change, .addTo-album .icon-ic_x").on("click",function(){e(".maskers").addClass("hidden")})})})},downloadTrack:function(){e('[category="downloadTrack"]').off().click(function(n){n.preventDefault();var r=n.target.href;e.ajax({url:r,type:"get",success:function(n){if(n.res)var r=n.url,i=e("<iframe/>").hide().attr("src",r).appendTo("body").load(function(){i.remove()});else t.alert(n.msg||"系统未知错误！")},error:function(){t.alert("服务器繁忙,请稍后再试!")}})})},deleteTrack:function(){var n=this;e('[category="deleteTrack"]').off().click(function(){var n=e(this),r=n.closest("tr"),i=r.find(".album-msg").attr("sound_id");t.confirm("确定要删除该声音吗？",function(){e.ajax({url:"/center/voice/delete",type:"POST",data:{trackId:i},success:function(e){e.res?(t.success("删除成功！"),r.fadeOut()):t.alert(e.msg||"系统未知错误！")},error:function(){t.alert("系统未知错误！")}})},{yesText:"删除"})})},shareTrack:function(){e('[category="shareTrack"]').each(function(){var t=e(this);t.on("click",function(){t.find(".js-share-div").toggle()}),t.on("blur",function(){t.find(".js-share-div").hide()})})},share2friend:function(){e(".more_operate .item").each(function(){var t=this,n=e(this);e(this).attr("data-value")==3&&n.on("click",function(){var t=e(this),n=t.attr("track_id"),r=t.attr("track_uid");a.open("sound",n,r)})})},paging:function(){var t=this,n=e("#trackList .paging-bar"),r=e.trim(e(".page-num").val()),i=e.trim(e(".page-btn").attr("max-size"));n.on("click",".paging-num",function(n){n.preventDefault();var r=e(this).attr("data-index");e(this).hasClass("active")||(f.pageNum=r,c(f,e("#trackList"),function(){e("body,html").animate({scrollTop:0},1e3),t.bindEvents()}))}),n.on("keyup",".page-num",function(r){var s=e.trim(r.target.value)*1;s>0&&s<=i&&s%1==0?(e(".page-btn").removeClass("off disabled").addClass("on"),n.on("click",".page-btn",function(n){n.preventDefault(),f.pageNum=s,c(f,e("#trackList"),function(){e("body,html").animate({scrollTop:0},1e3),t.bindEvents()})})):e(".page-btn").removeClass("on").addClass("off disabled")})},searchKeyword:function(){var t=this;e(".search-btn").on("click",function(){h(e(".input-search"),function(){t.bindEvents()})}),e(".input-search").on("keyup",function(n){n.keyCode==13&&h(e(this),function(){t.bindEvents()})})},release:function(){this.callParent("release")}});return new d}),define("page/center/myAlbum",["jquery","plugin/dialog","page/page_base","page/center/common","module/dialogs/create_album","module/dialogs/share2friend","router"],function(e,t,n,r,i,s,o){function u(){var e=location.href,t=window.parent,n=!1;return e.indexOf("isPlug=true")>-1&&(n=!0),t.location.href.indexOf("studio")>-1&&(n=!0),n}function l(t,n){var r=e.trim(t.val()),i=location.href.match(/albumType=(\d+)/),s=i?i[1]:"3";a={albumType:s,keyWord:decodeURIComponent(r)},c(a,e("#albumList"),n)}function c(n,r,i){e.ajax({url:"/center/myAlbum/getListJson",type:"GET",dataType:"json",data:n,success:function(e){e.res?(r.html(e.Html),i&&i()):t.alert(e.msg)},error:function(){t.alert("服务器繁忙,请稍后再试!")}})}xmLog&&xmLog("pv.create",{item:"button"}),e(".mgt-10.link5.tc.block").on("click",function(){xmLog("pv.send","event",{item:"button",serviceId:"pageClick",srcPage:"主播工作台",srcModule:"我的专辑",itemId:"专辑完整度"})});var a={},f="/center/myAlbum";(function(){var t=location.href.match(/albumType=(\d+)/),n=t?t[1]:"3";a.albumType=n})();var h=n.extend({$el:e("#sub-main-box"),init:function(){this.parmsO=a,r.init(),this.bindEvents()},bindEvents:function(){var t=this;t.shiftTab(),t.orderShift(),t.deleteAlbum(),t.shareAlbum(),t.paging(),t.searchKeyword(),t.share2friend();if(window._bd_share_main){if(window._bd_share_config&&window._bd_share_config.common){var n=window._bd_share_config.common.onBeforeClick;window._bd_share_config.common.onBeforeClick=function(e){n.apply(this,arguments)}}_bd_share_main.init()}this.cAlbum=new i({sureText:"创建新专辑"},function(e){e.res&&o.toPage(window.location.href)}),e(".js-createalbum").unbind("click"),e(".js-createalbum").on("click",function(){return t.cAlbum.open(),!1})},shiftTab:function(){var t=u()?"&isPlug=true":"";e(".comment-tab").children().each(function(){var n=e(this),r=n.attr("type-value");n.off().on("click",function(){a={albumType:r},o.toPage(f+"?albumType="+r+t,!0,"#sub-main-box")})})},orderShift:function(){var t=this;e("#albumList .voice-table .arr-th").on("click",function(){a.pageNum&&delete a.pageNum,e(this).hasClass("open")?a.order=2:a.order=1,c(a,e("#albumList"),function(){t.bindEvents()})})},deleteAlbum:function(){var n=this;e('[category="deleteAlbum"]').off().on("click",function(){var n=e(this),r=n.closest("tr"),i=r.find(".album-msg").attr("album_id");t.confirm("确定要删除该专辑吗？",function(){e.ajax({url:"/center/myAlbum/delete",type:"POST",data:{albumId:i},success:function(e){e.res?(t.success("删除成功！"),r.fadeOut()):t.alert(e.msg||"系统未知错误！")},error:function(){t.alert("系统未知错误！")}})},{yesText:"删除"})})},shareAlbum:function(){e('[category="shareAlbum"]').each(function(){var t=e(this);t.on("click",function(){t.find(".js-share-div").toggle()}),t.on("blur",function(){t.find(".js-share-div").hide()})})},share2friend:function(){e(".more_operate .item").each(function(){var t=this,n=e(this);e(this).attr("data-value")==3&&n.on("click",function(){var t=e(this),n=t.attr("album_id"),r=t.attr("album_uid");s.open("album",n,r)})})},paging:function(){var t=this,n=e("#albumList .paging-bar"),r=e.trim(e(".page-num").val()),i=e.trim(e(".page-btn").attr("max-size"));n.on("click",".paging-num",function(n){n.preventDefault();var r=e(this).attr("data-index");e(this).hasClass("active")||(a.pageNum=r,c(a,e("#albumList"),function(){e("body,html").animate({scrollTop:0},1e3),t.bindEvents()}))}),n.on("keyup",".page-num",function(r){var s=e.trim(r.target.value)*1;s>0&&s<=i&&s%1==0?(e(".page-btn").removeClass("off disabled").addClass("on"),n.on("click",".page-btn",function(n){n.preventDefault(),a.pageNum=s,c(a,e("#albumList"),function(){e("body,html").animate({scrollTop:0},1e3),t.bindEvents()})})):e(".page-btn").removeClass("on").addClass("off disabled")})},searchKeyword:function(){var t=this;e(".search-btn").on("click",function(){l(e(this).parent().find(".input-search"),function(){t.bindEvents()})}),e(".input-search").on("keyup",function(n){n.keyCode==13&&l(e(this),function(){t.bindEvents()})})},release:function(){this.callParent("release")}});return new h}),!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("moment",t):e.moment=t()}(this,function(){function e(){return Pr.apply(null,arguments)}function t(e){Pr=e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function i(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function o(e,t){for(var n in t)s(t,n)&&(e[n]=t[n]);return s(t,"toString")&&(e.toString=t.toString),s(t,"valueOf")&&(e.valueOf=t.valueOf),e}function u(e,t,n,r){return Lt(e,t,n,r,!0).utc()}function a(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function f(e){return null==e._pf&&(e._pf=a()),e._pf}function l(e){if(null==e._isValid){var t=f(e);e._isValid=!(isNaN(e._d.getTime())||!(t.overflow<0)||t.empty||t.invalidMonth||t.invalidWeekday||t.nullInput||t.invalidFormat||t.userInvalidated),e._strict&&(e._isValid=e._isValid&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)}return e._isValid}function c(e){var t=u(NaN);return null!=e?o(f(t),e):f(t).userInvalidated=!0,t}function h(e,t){var n,r,i;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=f(t)),"undefined"!=typeof t._locale&&(e._locale=t._locale),Br.length>0)for(n in Br)r=Br[n],i=t[r],"undefined"!=typeof i&&(e[r]=i);return e}function p(t){h(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),jr===!1&&(jr=!0,e.updateOffset(this),jr=!1)}function d(e){return e instanceof p||null!=e&&null!=e._isAMomentObject}function v(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=v(t)),n}function g(e,t,n){var r,i=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(r=0;i>r;r++)(n&&e[r]!==t[r]||!n&&m(e[r])!==m(t[r]))&&o++;return o+s}function y(){}function b(e){return e?e.toLowerCase().replace("_","-"):e}function w(e){for(var t,n,r,i,s=0;s<e.length;){for(i=b(e[s]).split("-"),t=i.length,n=b(e[s+1]),n=n?n.split("-"):null;t>0;){if(r=E(i.slice(0,t).join("-")))return r;if(n&&n.length>=t&&g(i,n,!0)>=t-1)break;t--}s++}return null}function E(e){var t=null;if(!Fr[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=Hr._abbr,require("./locale/"+e),S(t)}catch(n){}return Fr[e]}function S(e,t){var n;return e&&(n="undefined"==typeof t?T(e):x(e,t),n&&(Hr=n)),Hr._abbr}function x(e,t){return null!==t?(t.abbr=e,Fr[e]=Fr[e]||new y,Fr[e].set(t),S(e),Fr[e]):(delete Fr[e],null)}function T(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Hr;if(!n(e)){if(t=E(e))return t;e=[e]}return w(e)}function N(e,t){var n=e.toLowerCase();Ir[n]=Ir[n+"s"]=Ir[t]=e}function C(e){return"string"==typeof e?Ir[e]||Ir[e.toLowerCase()]:void 0}function k(e){var t,n,r={};for(n in e)s(e,n)&&(t=C(n),t&&(r[t]=e[n]));return r}function L(t,n){return function(r){return null!=r?(O(this,t,r),e.updateOffset(this,n),this):A(this,t)}}function A(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function O(e,t,n){return e._d["set"+(e._isUTC?"UTC":"")+t](n)}function M(e,t){var n;if("object"==typeof e)for(n in e)this.set(n,e[n]);else if(e=C(e),"function"==typeof this[e])return this[e](t);return this}function _(e,t,n){var r=""+Math.abs(e),i=t-r.length,s=e>=0;return(s?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+r}function D(e,t,n,r){var i=r;"string"==typeof r&&(i=function(){return this[r]()}),e&&(zr[e]=i),t&&(zr[t[0]]=function(){return _(i.apply(this,arguments),t[1],t[2])}),n&&(zr[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function P(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function H(e){var t,n,r=e.match(qr);for(t=0,n=r.length;n>t;t++)zr[r[t]]?r[t]=zr[r[t]]:r[t]=P(r[t]);return function(i){var s="";for(t=0;n>t;t++)s+=r[t]instanceof Function?r[t].call(i,e):r[t];return s}}function B(e,t){return e.isValid()?(t=j(t,e.localeData()),Ur[t]=Ur[t]||H(t),Ur[t](e)):e.localeData().invalidDate()}function j(e,t){function n(e){return t.longDateFormat(e)||e}var r=5;for(Rr.lastIndex=0;r>=0&&Rr.test(e);)e=e.replace(Rr,n),Rr.lastIndex=0,r-=1;return e}function F(e){return"function"==typeof e&&"[object Function]"===Object.prototype.toString.call(e)}function I(e,t,n){ii[e]=F(t)?t:function(e){return e&&n?n:t}}function q(e,t){return s(ii,e)?ii[e](t._strict,t._locale):new RegExp(R(e))}function R(e){return e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function U(e,t){var n,r=t;for("string"==typeof e&&(e=[e]),"number"==typeof t&&(r=function(e,n){n[t]=m(e)}),n=0;n<e.length;n++)si[e[n]]=r}function z(e,t){U(e,function(e,n,r,i){r._w=r._w||{},t(e,r._w,r,i)})}function W(e,t,n){null!=t&&s(si,e)&&si[e](t,n._a,n,e)}function X(e,t){return(new Date(Date.UTC(e,t+1,0))).getUTCDate()}function V(e){return this._months[e.month()]}function $(e){return this._monthsShort[e.month()]}function J(e,t,n){var r,i,s;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;12>r;r++){if(i=u([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(s="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(s.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}}function K(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),X(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function Q(t){return null!=t?(K(this,t),e.updateOffset(this,!0),this):A(this,"Month")}function G(){return X(this.year(),this.month())}function Y(e){var t,n=e._a;return n&&-2===f(e).overflow&&(t=n[ui]<0||n[ui]>11?ui:n[ai]<1||n[ai]>X(n[oi],n[ui])?ai:n[fi]<0||n[fi]>24||24===n[fi]&&(0!==n[li]||0!==n[ci]||0!==n[hi])?fi:n[li]<0||n[li]>59?li:n[ci]<0||n[ci]>59?ci:n[hi]<0||n[hi]>999?hi:-1,f(e)._overflowDayOfYear&&(oi>t||t>ai)&&(t=ai),f(e).overflow=t),e}function Z(t){e.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function et(e,t){var n=!0;return o(function(){return n&&(Z(e+"\n"+(new Error).stack),n=!1),t.apply(this,arguments)},t)}function tt(e,t){vi[e]||(Z(t),vi[e]=!0)}function nt(e){var t,n,r=e._i,i=mi.exec(r);if(i){for(f(e).iso=!0,t=0,n=gi.length;n>t;t++)if(gi[t][1].exec(r)){e._f=gi[t][0];break}for(t=0,n=yi.length;n>t;t++)if(yi[t][1].exec(r)){e._f+=(i[6]||" ")+yi[t][0];break}r.match(ti)&&(e._f+="Z"),Et(e)}else e._isValid=!1}function rt(t){var n=bi.exec(t._i);return null!==n?void (t._d=new Date(+n[1])):(nt(t),void (t._isValid===!1&&(delete t._isValid,e.createFromInputFallback(t))))}function it(e,t,n,r,i,s,o){var u=new Date(e,t,n,r,i,s,o);return 1970>e&&u.setFullYear(e),u}function st(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function ot(e){return ut(e)?366:365}function ut(e){return e%4===0&&e%100!==0||e%400===0}function at(){return ut(this.year())}function ft(e,t,n){var r,i=n-t,s=n-e.day();return s>i&&(s-=7),i-7>s&&(s+=7),r=At(e).add(s,"d"),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function lt(e){return ft(e,this._week.dow,this._week.doy).week}function ct(){return this._week.dow}function ht(){return this._week.doy}function pt(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")}function dt(e){var t=ft(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")}function vt(e,t,n,r,i){var s,o=6+i-r,u=st(e,0,1+o),a=u.getUTCDay();return i>a&&(a+=7),n=null!=n?1*n:i,s=1+o+7*(t-1)-a+n,{year:s>0?e:e-1,dayOfYear:s>0?s:ot(e-1)+s}}function mt(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")}function gt(e,t,n){return null!=e?e:null!=t?t:n}function yt(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function bt(e){var t,n,r,i,s=[];if(!e._d){for(r=yt(e),e._w&&null==e._a[ai]&&null==e._a[ui]&&wt(e),e._dayOfYear&&(i=gt(e._a[oi],r[oi]),e._dayOfYear>ot(i)&&(f(e)._overflowDayOfYear=!0),n=st(i,0,e._dayOfYear),e._a[ui]=n.getUTCMonth(),e._a[ai]=n.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=s[t]=r[t];for(;7>t;t++)e._a[t]=s[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[fi]&&0===e._a[li]&&0===e._a[ci]&&0===e._a[hi]&&(e._nextDay=!0,e._a[fi]=0),e._d=(e._useUTC?st:it).apply(null,s),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[fi]=24)}}function wt(e){var t,n,r,i,s,o,u;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(s=1,o=4,n=gt(t.GG,e._a[oi],ft(At(),1,4).year),r=gt(t.W,1),i=gt(t.E,1)):(s=e._locale._week.dow,o=e._locale._week.doy,n=gt(t.gg,e._a[oi],ft(At(),s,o).year),r=gt(t.w,1),null!=t.d?(i=t.d,s>i&&++r):i=null!=t.e?t.e+s:s),u=vt(n,r,i,o,s),e._a[oi]=u.year,e._dayOfYear=u.dayOfYear}function Et(t){if(t._f===e.ISO_8601)return void nt(t);t._a=[],f(t).empty=!0;var n,r,i,s,o,u=""+t._i,a=u.length,l=0;for(i=j(t._f,t._locale).match(qr)||[],n=0;n<i.length;n++)s=i[n],r=(u.match(q(s,t))||[])[0],r&&(o=u.substr(0,u.indexOf(r)),o.length>0&&f(t).unusedInput.push(o),u=u.slice(u.indexOf(r)+r.length),l+=r.length),zr[s]?(r?f(t).empty=!1:f(t).unusedTokens.push(s),W(s,r,t)):t._strict&&!r&&f(t).unusedTokens.push(s);f(t).charsLeftOver=a-l,u.length>0&&f(t).unusedInput.push(u),f(t).bigHour===!0&&t._a[fi]<=12&&t._a[fi]>0&&(f(t).bigHour=void 0),t._a[fi]=St(t._locale,t._a[fi],t._meridiem),bt(t),Y(t)}function St(e,t,n){var r;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?(r=e.isPM(n),r&&12>t&&(t+=12),r||12!==t||(t=0),t):t}function xt(e){var t,n,r,i,s;if(0===e._f.length)return f(e).invalidFormat=!0,void (e._d=new Date(NaN));for(i=0;i<e._f.length;i++)s=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Et(t),l(t)&&(s+=f(t).charsLeftOver,s+=10*f(t).unusedTokens.length,f(t).score=s,(null==r||r>s)&&(r=s,n=t));o(e,n||t)}function Tt(e){if(!e._d){var t=k(e._i);e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],bt(e)}}function Nt(e){var t=new p(Y(Ct(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function Ct(e){var t=e._i,i=e._f;return e._locale=e._locale||T(e._l),null===t||void 0===i&&""===t?c({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),d(t)?new p(Y(t)):(n(i)?xt(e):i?Et(e):r(t)?e._d=t:kt(e),e))}function kt(t){var s=t._i;void 0===s?t._d=new Date:r(s)?t._d=new Date(+s):"string"==typeof s?rt(t):n(s)?(t._a=i(s.slice(0),function(e){return parseInt(e,10)}),bt(t)):"object"==typeof s?Tt(t):"number"==typeof s?t._d=new Date(s):e.createFromInputFallback(t)}function Lt(e,t,n,r,i){var s={};return"boolean"==typeof n&&(r=n,n=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=i,s._l=n,s._i=e,s._f=t,s._strict=r,Nt(s)}function At(e,t,n,r){return Lt(e,t,n,r,!1)}function Ot(e,t){var r,i;if(1===t.length&&n(t[0])&&(t=t[0]),!t.length)return At();for(r=t[0],i=1;i<t.length;++i)(!t[i].isValid()||t[i][e](r))&&(r=t[i]);return r}function Mt(){var e=[].slice.call(arguments,0);return Ot("isBefore",e)}function _t(){var e=[].slice.call(arguments,0);return Ot("isAfter",e)}function Dt(e){var t=k(e),n=t.year||0,r=t.quarter||0,i=t.month||0,s=t.week||0,o=t.day||0,u=t.hour||0,a=t.minute||0,f=t.second||0,l=t.millisecond||0;this._milliseconds=+l+1e3*f+6e4*a+36e5*u,this._days=+o+7*s,this._months=+i+3*r+12*n,this._data={},this._locale=T(),this._bubble()}function Pt(e){return e instanceof Dt}function Ht(e,t){D(e,0,0,function(){var e=this.utcOffset(),n="+";return 0>e&&(e=-e,n="-"),n+_(~~(e/60),2)+t+_(~~e%60,2)})}function Bt(e){var t=(e||"").match(ti)||[],n=t[t.length-1]||[],r=(n+"").match(Ti)||["-",0,0],i=+(60*r[1])+m(r[2]);return"+"===r[0]?i:-i}function jt(t,n){var i,s;return n._isUTC?(i=n.clone(),s=(d(t)||r(t)?+t:+At(t))- +i,i._d.setTime(+i._d+s),e.updateOffset(i,!1),i):At(t).local()}function Ft(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function It(t,n){var r,i=this._offset||0;return null!=t?("string"==typeof t&&(t=Bt(t)),Math.abs(t)<16&&(t=60*t),!this._isUTC&&n&&(r=Ft(this)),this._offset=t,this._isUTC=!0,null!=r&&this.add(r,"m"),i!==t&&(!n||this._changeInProgress?tn(this,Qt(t-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?i:Ft(this)}function qt(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function Rt(e){return this.utcOffset(0,e)}function Ut(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ft(this),"m")),this}function zt(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Bt(this._i)),this}function Wt(e){return e=e?At(e).utcOffset():0,(this.utcOffset()-e)%60===0}function Xt(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Vt(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var e={};if(h(e,this),e=Ct(e),e._a){var t=e._isUTC?u(e._a):At(e._a);this._isDSTShifted=this.isValid()&&g(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function $t(){return!this._isUTC}function Jt(){return this._isUTC}function Kt(){return this._isUTC&&0===this._offset}function Qt(e,t){var n,r,i,o=e,u=null;return Pt(e)?o={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(o={},t?o[t]=e:o.milliseconds=e):(u=Ni.exec(e))?(n="-"===u[1]?-1:1,o={y:0,d:m(u[ai])*n,h:m(u[fi])*n,m:m(u[li])*n,s:m(u[ci])*n,ms:m(u[hi])*n}):(u=Ci.exec(e))?(n="-"===u[1]?-1:1,o={y:Gt(u[2],n),M:Gt(u[3],n),d:Gt(u[4],n),h:Gt(u[5],n),m:Gt(u[6],n),s:Gt(u[7],n),w:Gt(u[8],n)}):null==o?o={}:"object"==typeof o&&("from"in o||"to"in o)&&(i=Zt(At(o.from),At(o.to)),o={},o.ms=i.milliseconds,o.M=i.months),r=new Dt(o),Pt(e)&&s(e,"_locale")&&(r._locale=e._locale),r}function Gt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Yt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t- +e.clone().add(n.months,"M"),n}function Zt(e,t){var n;return t=jt(t,e),e.isBefore(t)?n=Yt(e,t):(n=Yt(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function en(e,t){return function(n,r){var i,s;return null===r||isNaN(+r)||(tt(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),s=n,n=r,r=s),n="string"==typeof n?+n:n,i=Qt(n,r),tn(this,i,e),this}}function tn(t,n,r,i){var s=n._milliseconds,o=n._days,u=n._months;i=null==i?!0:i,s&&t._d.setTime(+t._d+s*r),o&&O(t,"Date",A(t,"Date")+o*r),u&&K(t,A(t,"Month")+u*r),i&&e.updateOffset(t,o||u)}function nn(e,t){var n=e||At(),r=jt(n,this).startOf("day"),i=this.diff(r,"days",!0),s=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(t&&t[s]||this.localeData().calendar(s,this,At(n)))}function rn(){return new p(this)}function sn(e,t){var n;return t=C("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=d(e)?e:At(e),+this>+e):(n=d(e)?+e:+At(e),n<+this.clone().startOf(t))}function on(e,t){var n;return t=C("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=d(e)?e:At(e),+e>+this):(n=d(e)?+e:+At(e),+this.clone().endOf(t)<n)}function un(e,t,n){return this.isAfter(e,n)&&this.isBefore(t,n)}function an(e,t){var n;return t=C(t||"millisecond"),"millisecond"===t?(e=d(e)?e:At(e),+this===+e):(n=+At(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))}function fn(e,t,n){var r,i,s=jt(e,this),o=6e4*(s.utcOffset()-this.utcOffset());return t=C(t),"year"===t||"month"===t||"quarter"===t?(i=ln(this,s),"quarter"===t?i/=3:"year"===t&&(i/=12)):(r=this-s,i="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-o)/864e5:"week"===t?(r-o)/6048e5:r),n?i:v(i)}function ln(e,t){var n,r,i=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(i,"months");return 0>t-s?(n=e.clone().add(i-1,"months"),r=(t-s)/(s-n)):(n=e.clone().add(i+1,"months"),r=(t-s)/(n-s)),-(i+r)}function cn(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function hn(){var e=this.clone().utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():B(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):B(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function pn(t){var n=B(this,t||e.defaultFormat);return this.localeData().postformat(n)}function dn(e,t){return this.isValid()?Qt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function vn(e){return this.from(At(),e)}function mn(e,t){return this.isValid()?Qt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function gn(e){return this.to(At(),e)}function yn(e){var t;return void 0===e?this._locale._abbr:(t=T(e),null!=t&&(this._locale=t),this)}function bn(){return this._locale}function wn(e){switch(e=C(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this}function En(e){return e=C(e),void 0===e||"millisecond"===e?this:this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")}function Sn(){return+this._d-6e4*(this._offset||0)}function xn(){return Math.floor(+this/1e3)}function Tn(){return this._offset?new Date(+this):this._d}function Nn(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function Cn(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function kn(){return l(this)}function Ln(){return o({},f(this))}function An(){return f(this).overflow}function On(e,t){D(0,[e,e.length],0,t)}function Mn(e,t,n){return ft(At([e,11,31+t-n]),t,n).week}function _n(e){var t=ft(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")}function Dn(e){var t=ft(this,1,4).year;return null==e?t:this.add(e-t,"y")}function Pn(){return Mn(this.year(),1,4)}function Hn(){var e=this.localeData()._week;return Mn(this.year(),e.dow,e.doy)}function Bn(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}function jn(e,t){return"string"!=typeof e?e:isNaN(e)?(e=t.weekdaysParse(e),"number"==typeof e?e:null):parseInt(e,10)}function Fn(e){return this._weekdays[e.day()]}function In(e){return this._weekdaysShort[e.day()]}function qn(e){return this._weekdaysMin[e.day()]}function Rn(e){var t,n,r;for(this._weekdaysParse=this._weekdaysParse||[],t=0;7>t;t++)if(this._weekdaysParse[t]||(n=At([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t}function Un(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=jn(e,this.localeData()),this.add(e-t,"d")):t}function zn(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")}function Wn(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)}function Xn(e,t){D(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Vn(e,t){return t._meridiemParse}function $n(e){return"p"===(e+"").toLowerCase().charAt(0)}function Jn(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"}function Kn(e,t){t[hi]=m(1e3*("0."+e))}function Qn(){return this._isUTC?"UTC":""}function Gn(){return this._isUTC?"Coordinated Universal Time":""}function Yn(e){return At(1e3*e)}function Zn(){return At.apply(null,arguments).parseZone()}function er(e,t,n){var r=this._calendar[e];return"function"==typeof r?r.call(t,n):r}function tr(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])}function nr(){return this._invalidDate}function rr(e){return this._ordinal.replace("%d",e)}function ir(e){return e}function sr(e,t,n,r){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,r):i.replace(/%d/i,e)}function or(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)}function ur(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function ar(e,t,n,r){var i=T(),s=u().set(r,t);return i[n](s,e)}function fr(e,t,n,r,i){if("number"==typeof e&&(t=e,e=void 0),e=e||"",null!=t)return ar(e,t,n,i);var s,o=[];for(s=0;r>s;s++)o[s]=ar(e,s,n,i);return o}function lr(e,t){return fr(e,t,"months",12,"month")}function cr(e,t){return fr(e,t,"monthsShort",12,"month")}function hr(e,t){return fr(e,t,"weekdays",7,"day")}function pr(e,t){return fr(e,t,"weekdaysShort",7,"day")}function dr(e,t){return fr(e,t,"weekdaysMin",7,"day")}function vr(){var e=this._data;return this._milliseconds=Ki(this._milliseconds),this._days=Ki(this._days),this._months=Ki(this._months),e.milliseconds=Ki(e.milliseconds),e.seconds=Ki(e.seconds),e.minutes=Ki(e.minutes),e.hours=Ki(e.hours),e.months=Ki(e.months),e.years=Ki(e.years),this}function mr(e,t,n,r){var i=Qt(t,n);return e._milliseconds+=r*i._milliseconds,e._days+=r*i._days,e._months+=r*i._months,e._bubble()}function gr(e,t){return mr(this,e,t,1)}function yr(e,t){return mr(this,e,t,-1)}function br(e){return 0>e?Math.floor(e):Math.ceil(e)}function wr(){var e,t,n,r,i,s=this._milliseconds,o=this._days,u=this._months,a=this._data;return s>=0&&o>=0&&u>=0||0>=s&&0>=o&&0>=u||(s+=864e5*br(Sr(u)+o),o=0,u=0),a.milliseconds=s%1e3,e=v(s/1e3),a.seconds=e%60,t=v(e/60),a.minutes=t%60,n=v(t/60),a.hours=n%24,o+=v(n/24),i=v(Er(o)),u+=i,o-=br(Sr(i)),r=v(u/12),u%=12,a.days=o,a.months=u,a.years=r,this}function Er(e){return 4800*e/146097}function Sr(e){return 146097*e/4800}function xr(e){var t,n,r=this._milliseconds;if(e=C(e),"month"===e||"year"===e)return t=this._days+r/864e5,n=this._months+Er(t),"month"===e?n:n/12;switch(t=this._days+Math.round(Sr(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}}function Tr(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*m(this._months/12)}function Nr(e){return function(){return this.as(e)}}function Cr(e){return e=C(e),this[e+"s"]()}function kr(e){return function(){return this._data[e]}}function Lr(){return v(this.days()/7)}function Ar(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function Or(e,t,n){var r=Qt(e).abs(),i=cs(r.as("s")),s=cs(r.as("m")),o=cs(r.as("h")),u=cs(r.as("d")),a=cs(r.as("M")),f=cs(r.as("y")),l=i<hs.s&&["s",i]||1===s&&["m"]||s<hs.m&&["mm",s]||1===o&&["h"]||o<hs.h&&["hh",o]||1===u&&["d"]||u<hs.d&&["dd",u]||1===a&&["M"]||a<hs.M&&["MM",a]||1===f&&["y"]||["yy",f];return l[2]=t,l[3]=+e>0,l[4]=n,Ar.apply(null,l)}function Mr(e,t){return void 0===hs[e]?!1:void 0===t?hs[e]:(hs[e]=t,!0)}function _r(e){var t=this.localeData(),n=Or(this,!e,t);return e&&(n=t.pastFuture(+this,n)),t.postformat(n)}function Dr(){var e,t,n,r=ps(this._milliseconds)/1e3,i=ps(this._days),s=ps(this._months);e=v(r/60),t=v(e/60),r%=60,e%=60,n=v(s/12),s%=12;var o=n,u=s,a=i,f=t,l=e,c=r,h=this.asSeconds();return h?(0>h?"-":"")+"P"+(o?o+"Y":"")+(u?u+"M":"")+(a?a+"D":"")+(f||l||c?"T":"")+(f?f+"H":"")+(l?l+"M":"")+(c?c+"S":""):"P0D"}var Pr,Hr,Br=e.momentProperties=[],jr=!1,Fr={},Ir={},qr=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Rr=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ur={},zr={},Wr=/\d/,Xr=/\d\d/,Vr=/\d{3}/,$r=/\d{4}/,Jr=/[+-]?\d{6}/,Kr=/\d\d?/,Qr=/\d{1,3}/,Gr=/\d{1,4}/,Yr=/[+-]?\d{1,6}/,Zr=/\d+/,ei=/[+-]?\d+/,ti=/Z|[+-]\d\d:?\d\d/gi,ni=/[+-]?\d+(\.\d{1,3})?/,ri=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,ii={},si={},oi=0,ui=1,ai=2,fi=3,li=4,ci=5,hi=6;D("M",["MM",2],"Mo",function(){return this.month()+1}),D("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),D("MMMM",0,0,function(e){return this.localeData().months(this,e)}),N("month","M"),I("M",Kr),I("MM",Kr,Xr),I("MMM",ri),I("MMMM",ri),U(["M","MM"],function(e,t){t[ui]=m(e)-1}),U(["MMM","MMMM"],function(e,t,n,r){var i=n._locale.monthsParse(e,r,n._strict);null!=i?t[ui]=i:f(n).invalidMonth=e});var pi="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),di="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),vi={};e.suppressDeprecationWarnings=!1;var mi=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gi=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],yi=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],bi=/^\/?Date\((\-?\d+)/i;e.createFromInputFallback=et("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),D(0,["YY",2],0,function(){return this.year()%100}),D(0,["YYYY",4],0,"year"),D(0,["YYYYY",5],0,"year"),D(0,["YYYYYY",6,!0],0,"year"),N("year","y"),I("Y",ei),I("YY",Kr,Xr),I("YYYY",Gr,$r),I("YYYYY",Yr,Jr),I("YYYYYY",Yr,Jr),U(["YYYYY","YYYYYY"],oi),U("YYYY",function(t,n){n[oi]=2===t.length?e.parseTwoDigitYear(t):m(t)}),U("YY",function(t,n){n[oi]=e.parseTwoDigitYear(t)}),e.parseTwoDigitYear=function(e){return m(e)+(m(e)>68?1900:2e3)};var wi=L("FullYear",!1);D("w",["ww",2],"wo","week"),D("W",["WW",2],"Wo","isoWeek"),N("week","w"),N("isoWeek","W"),I("w",Kr),I("ww",Kr,Xr),I("W",Kr),I("WW",Kr,Xr),z(["w","ww","W","WW"],function(e,t,n,r){t[r.substr(0,1)]=m(e)});var Ei={dow:0,doy:6};D("DDD",["DDDD",3],"DDDo","dayOfYear"),N("dayOfYear","DDD"),I("DDD",Qr),I("DDDD",Vr),U(["DDD","DDDD"],function(e,t,n){n._dayOfYear=m(e)}),e.ISO_8601=function(){};var Si=et("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var e=At.apply(null,arguments);return this>e?this:e}),xi=et("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var e=At.apply(null,arguments);return e>this?this:e});Ht("Z",":"),Ht("ZZ",""),I("Z",ti),I("ZZ",ti),U(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Bt(e)});var Ti=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var Ni=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Ci=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Qt.fn=Dt.prototype;var ki=en(1,"add"),Li=en(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Ai=et("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});D(0,["gg",2],0,function(){return this.weekYear()%100}),D(0,["GG",2],0,function(){return this.isoWeekYear()%100}),On("gggg","weekYear"),On("ggggg","weekYear"),On("GGGG","isoWeekYear"),On("GGGGG","isoWeekYear"),N("weekYear","gg"),N("isoWeekYear","GG"),I("G",ei),I("g",ei),I("GG",Kr,Xr),I("gg",Kr,Xr),I("GGGG",Gr,$r),I("gggg",Gr,$r),I("GGGGG",Yr,Jr),I("ggggg",Yr,Jr),z(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,r){t[r.substr(0,2)]=m(e)}),z(["gg","GG"],function(t,n,r,i){n[i]=e.parseTwoDigitYear(t)}),D("Q",0,0,"quarter"),N("quarter","Q"),I("Q",Wr),U("Q",function(e,t){t[ui]=3*(m(e)-1)}),D("D",["DD",2],"Do","date"),N("date","D"),I("D",Kr),I("DD",Kr,Xr),I("Do",function(e,t){return e?t._ordinalParse:t._ordinalParseLenient}),U(["D","DD"],ai),U("Do",function(e,t){t[ai]=m(e.match(Kr)[0],10)});var Oi=L("Date",!0);D("d",0,"do","day"),D("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),D("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),D("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),D("e",0,0,"weekday"),D("E",0,0,"isoWeekday"),N("day","d"),N("weekday","e"),N("isoWeekday","E"),I("d",Kr),I("e",Kr),I("E",Kr),I("dd",ri),I("ddd",ri),I("dddd",ri),z(["dd","ddd","dddd"],function(e,t,n){var r=n._locale.weekdaysParse(e);null!=r?t.d=r:f(n).invalidWeekday=e}),z(["d","e","E"],function(e,t,n,r){t[r]=m(e)});var Mi="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),_i="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Di="Su_Mo_Tu_We_Th_Fr_Sa".split("_");D("H",["HH",2],0,"hour"),D("h",["hh",2],0,function(){return this.hours()%12||12}),Xn("a",!0),Xn("A",!1),N("hour","h"),I("a",Vn),I("A",Vn),I("H",Kr),I("h",Kr),I("HH",Kr,Xr),I("hh",Kr,Xr),U(["H","HH"],fi),U(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),U(["h","hh"],function(e,t,n){t[fi]=m(e),f(n).bigHour=!0});var Pi=/[ap]\.?m?\.?/i,Hi=L("Hours",!0);D("m",["mm",2],0,"minute"),N("minute","m"),I("m",Kr),I("mm",Kr,Xr),U(["m","mm"],li);var Bi=L("Minutes",!1);D("s",["ss",2],0,"second"),N("second","s"),I("s",Kr),I("ss",Kr,Xr),U(["s","ss"],ci);var ji=L("Seconds",!1);D("S",0,0,function(){return~~(this.millisecond()/100)}),D(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),D(0,["SSS",3],0,"millisecond"),D(0,["SSSS",4],0,function(){return 10*this.millisecond()}),D(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),D(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),D(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),D(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),D(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),N("millisecond","ms"),I("S",Qr,Wr),I("SS",Qr,Xr),I("SSS",Qr,Vr);var Fi;for(Fi="SSSS";Fi.length<=9;Fi+="S")I(Fi,Zr);for(Fi="S";Fi.length<=9;Fi+="S")U(Fi,Kn);var Ii=L("Milliseconds",!1);D("z",0,0,"zoneAbbr"),D("zz",0,0,"zoneName");var qi=p.prototype;qi.add=ki,qi.calendar=nn,qi.clone=rn,qi.diff=fn,qi.endOf=En,qi.format=pn,qi.from=dn,qi.fromNow=vn,qi.to=mn,qi.toNow=gn,qi.get=M,qi.invalidAt=An,qi.isAfter=sn,qi.isBefore=on,qi.isBetween=un,qi.isSame=an,qi.isValid=kn,qi.lang=Ai,qi.locale=yn,qi.localeData=bn,qi.max=xi,qi.min=Si,qi.parsingFlags=Ln,qi.set=M,qi.startOf=wn,qi.subtract=Li,qi.toArray=Nn,qi.toObject=Cn,qi.toDate=Tn,qi.toISOString=hn,qi.toJSON=hn,qi.toString=cn,qi.unix=xn,qi.valueOf=Sn,qi.year=wi,qi.isLeapYear=at,qi.weekYear=_n,qi.isoWeekYear=Dn,qi.quarter=qi.quarters=Bn,qi.month=Q,qi.daysInMonth=G,qi.week=qi.weeks=pt,qi.isoWeek=qi.isoWeeks=dt,qi.weeksInYear=Hn,qi.isoWeeksInYear=Pn,qi.date=Oi,qi.day=qi.days=Un,qi.weekday=zn,qi.isoWeekday=Wn,qi.dayOfYear=mt,qi.hour=qi.hours=Hi,qi.minute=qi.minutes=Bi,qi.second=qi.seconds=ji,qi.millisecond=qi.milliseconds=Ii,qi.utcOffset=It,qi.utc=Rt,qi.local=Ut,qi.parseZone=zt,qi.hasAlignedHourOffset=Wt,qi.isDST=Xt,qi.isDSTShifted=Vt,qi.isLocal=$t,qi.isUtcOffset=Jt,qi.isUtc=Kt,qi.isUTC=Kt,qi.zoneAbbr=Qn,qi.zoneName=Gn,qi.dates=et("dates accessor is deprecated. Use date instead.",Oi),qi.months=et("months accessor is deprecated. Use month instead",Q),qi.years=et("years accessor is deprecated. Use year instead",wi),qi.zone=et("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",qt);var Ri=qi,Ui={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},zi={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Wi="Invalid date",Xi="%d",Vi=/\d{1,2}/,$i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Ji=y.prototype;Ji._calendar=Ui,Ji.calendar=er,Ji._longDateFormat=zi,Ji.longDateFormat=tr,Ji._invalidDate=Wi,Ji.invalidDate=nr,Ji._ordinal=Xi,Ji.ordinal=rr,Ji._ordinalParse=Vi,Ji.preparse=ir,Ji.postformat=ir,Ji._relativeTime=$i,Ji.relativeTime=sr,Ji.pastFuture=or,Ji.set=ur,Ji.months=V,Ji._months=pi,Ji.monthsShort=$,Ji._monthsShort=di,Ji.monthsParse=J,Ji.week=lt,Ji._week=Ei,Ji.firstDayOfYear=ht,Ji.firstDayOfWeek=ct,Ji.weekdays=Fn,Ji._weekdays=Mi,Ji.weekdaysMin=qn,Ji._weekdaysMin=Di,Ji.weekdaysShort=In,Ji._weekdaysShort=_i,Ji.weekdaysParse=Rn,Ji.isPM=$n,Ji._meridiemParse=Pi,Ji.meridiem=Jn,S("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===m(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),e.lang=et("moment.lang is deprecated. Use moment.locale instead.",S),e.langData=et("moment.langData is deprecated. Use moment.localeData instead.",T);var Ki=Math.abs,Qi=Nr("ms"),Gi=Nr("s"),Yi=Nr("m"),Zi=Nr("h"),es=Nr("d"),ts=Nr("w"),ns=Nr("M"),rs=Nr("y"),is=kr("milliseconds"),ss=kr("seconds"),os=kr("minutes"),us=kr("hours"),as=kr("days"),fs=kr("months"),ls=kr("years"),cs=Math.round,hs={s:45,m:45,h:22,d:26,M:11},ps=Math.abs,ds=Dt.prototype;ds.abs=vr,ds.add=gr,ds.subtract=yr,ds.as=xr,ds.asMilliseconds=Qi,ds.asSeconds=Gi,ds.asMinutes=Yi,ds.asHours=Zi,ds.asDays=es,ds.asWeeks=ts,ds.asMonths=ns,ds.asYears=rs,ds.valueOf=Tr,ds._bubble=wr,ds.get=Cr,ds.milliseconds=is,ds.seconds=ss,ds.minutes=os,ds.hours=us,ds.days=as,ds.weeks=Lr,ds.months=fs,ds.years=ls,ds.humanize=_r,ds.toISOString=Dr,ds.toString=Dr,ds.toJSON=Dr,ds.locale=yn,ds.localeData=bn,ds.toIsoString=et("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Dr),ds.lang=Ai,D("X",0,0,"unix"),D("x",0,0,"valueOf"),I("x",ei),I("X",ni),U("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),U("x",function(e,t,n){n._d=new Date(m(e))}),e.version="2.10.6",t(At),e.fn=Ri,e.min=Mt,e.max=_t,e.utc=u,e.unix=Yn,e.months=lr,e.isDate=r,e.locale=S,e.invalid=c,e.duration=Qt,e.isMoment=d,e.weekdays=hr,e.parseZone=Zn,e.localeData=T,e.isDuration=Pt,e.monthsShort=cr,e.weekdaysMin=dr,e.defineLocale=x,e.weekdaysShort=pr,e.normalizeUnits=C,e.relativeTimeThreshold=Mr;var vs=e;return vs}),define("module/my/albumSearch",["jquery","plugin/dialog","router","plugin/jquery.selecter"],function(e,t,n){var r=function(e){this.albumChange=e},i={DOWN:40,ENTER:13,UP:38};return r.prototype={init:function(){this.$el=e(document),this.$input=e(".j-albumSearch"),this.$box=e(".j-searchResult"),this.$ul=this.$box.children("ul"),this.key=e.trim(this.$input.val()),this.pageSize=8,this.hasMore=!0,this.bindEvents()},bindEvents:function(){var e=this;e.searchResult(e.$input,!0),e.selectAlbum(),e.keyupAlbum(),e.loadMoreResult()},fetchAlbumData:function(n,r){var i=this;e.ajax({url:"/center/dataAnalyze/searchAlbum",type:"GET",dataType:"json",data:n,success:function(t){e(".toast").fadeOut(500).prev().addClass("hidden"),r?r(t):t.res&&(e(".j-loadMore").removeClass("hidden"),i.$ul.html(t.html),i.hasMore=t.hasMore,t.hasMore||e(".j-loadMore").addClass("hidden"))},error:function(){t.alert("服务器繁忙,请稍后再试!")}})},searchResult:function(t,n){var r=this,i;n||(r.key=e.trim(t.val()),i={realId:window.helper.getParameterByName("realId")||"",keyWord:r.key}),r.fetchAlbumData(i)},getCurrentPage:function(e){var t=this,n=Math.floor(e.find("li").length/t.pageSize);return n},selectAlbum:function(){var t=this;e(".j-albumSearchSelector").selecter({onDrop:function(){t.$ul.find("li").removeClass("selected")},onChange:function(n){var r=this,i=t.albumChange;i(n,e(r))}})},keyupAlbum:function(){var t=this;e(".j-albumSearchSelector").on("keydown keyup",".j-albumSearch",function(n){var r=e.trim(t.$input.val());n.type==="keydown"&&t.listenDirection(n)}),t.$input.off().on("input",function(n){t.searchResult(e(".j-albumSearch"))})},listenDirection:function(t){var n=this,r=n.$ul.find("li"),s=r.length,o=n.$ul.find("li.selected"),u=e(r).index(o),a=function(t){t===-1?r.removeClass("selected"):e(r[t]).addClass("selected").siblings("li").removeClass("selected")};switch(t.keyCode){case i.UP:u--,u<-1&&(u=s-1),a(u),t.preventDefault();break;case i.DOWN:u++,u===s&&(u=-1),a(u),t.preventDefault();break;case i.ENTER:if(u==-1)return;var f=n.albumChange;f(e(r[u]).attr("data-value"),e(r[u])),e(".j-albumSearchSelector").removeClass("open")}},loadMoreResult:function(){var t=this;e(".j-loadMore").off().on("click",function(){var n={realId:window.helper.getParameterByName("realId")||"",keyWord:t.key,pageNum:t.getCurrentPage(t.$ul)+1};t.fetchAlbumData(n,function(n){t.$ul.append(n.html),t.hasMore=n.hasMore,n.hasMore||e(".j-loadMore").addClass("hidden")})})},release:function(){this.$input.off()}},r}),function(e,t){typeof module=="object"&&module.exports?module.exports=e.document?t(e):t:define?define("highchart",t):e.Highcharts=t(e)}(typeof window!="undefined"?window:this,function(e){var t=function(){var e=window,t=e.document,n="http://www.w3.org/2000/svg",r=e.navigator&&e.navigator.userAgent||"",i=t&&t.createElementNS&&!!t.createElementNS(n,"svg").createSVGRect,s=/(edge|msie|trident)/i.test(r)&&!window.opera,o=!i,u=/Firefox/.test(r),a=u&&parseInt(r.split("Firefox/")[1],10)<4,f=e.Highcharts?e.Highcharts.error(16,!0):{product:"Highcharts",version:"5.0.10",deg2rad:Math.PI*2/360,doc:t,hasBidiBug:a,hasTouch:t&&t.documentElement.ontouchstart!==undefined,isMS:s,isWebKit:/AppleWebKit/.test(r),isFirefox:u,isTouchDevice:/(Mobile|Android|Windows Phone)/.test(r),SVG_NS:n,chartCount:0,seriesTypes:{},symbolSizes:{},svg:i,vml:o,win:e,charts:[],marginNames:["plotTop","marginRight","marginBottom","plotLeft"],noop:function(){return undefined}};return f}();return function(e){var t=[],n=e.charts,r=e.doc,i=e.win;e.error=function(t,n){var r=e.isNumber(t)?"Highcharts error #"+t+": www.highcharts.com/errors/"+t:t;if(n)throw new Error(r);i.console&&console.log(r)},e.Fx=function(e,t,n){this.options=t,this.elem=e,this.prop=n},e.Fx.prototype={dSetter:function(){var e=this.paths[0],t=this.paths[1],n=[],r=this.now,i=e.length,s;if(r===1)n=this.toD;else if(i===t.length&&r<1)while(i--)s=parseFloat(e[i]),n[i]=isNaN(s)?e[i]:r*parseFloat(t[i]-s)+s;else n=t;this.elem.attr("d",n,null,!0)},update:function(){var e=this.elem,t=this.prop,n=this.now,r=this.options.step;this[t+"Setter"]?this[t+"Setter"]():e.attr?e.element&&e.attr(t,n,null,!0):e.style[t]=n+this.unit,r&&r.call(e,n,this)},run:function(e,n,r){var i=this,s=function(e){return s.stopped?!1:i.step(e)},o;this.startTime=+(new Date),this.start=e,this.end=n,this.unit=r,this.now=this.start,this.pos=0,s.elem=this.elem,s.prop=this.prop,s()&&t.push(s)===1&&(s.timerId=setInterval(function(){for(o=0;o<t.length;o++)t[o]()||t.splice(o--,1);t.length||clearInterval(s.timerId)},13))},step:function(e){var t=+(new Date),n,r,i=this.options,s=this.elem,o=i.complete,u=i.duration,a=i.curAnim,f;if(s.attr&&!s.element)n=!1;else if(e||t>=u+this.startTime){this.now=this.end,this.pos=1,this.update(),a[this.prop]=!0,r=!0;for(f in a)a[f]!==!0&&(r=!1);r&&o&&o.call(s),n=!1}else this.pos=i.easing((t-this.startTime)/u),this.now=this.start+(this.end-this.start)*this.pos,this.update(),n=!0;return n},initPath:function(t,n,r){function g(e){var t,n;c=e.length;while(c--)t=e[c]==="M"||e[c]==="L",n=/[a-zA-Z]/.test(e[c+3]),t&&n&&e.splice(c+1,0,e[c+1],e[c+2],e[c+1],e[c+2])}function y(e,t,n){[].splice.apply(e,[n,0].concat(t))}function b(e,t){while(e.length<f)e[0]=t[f-e.length],y(e,e.slice(0,a),0),d&&(y(e,e.slice(e.length-a),e.length),c--);e[0]="M"}function w(e,t){var n=(f-e.length)/a;while(n>0&&n--)l=e.slice().splice(e.length/v-a,a*v),l[0]=t[f-a-n*a],u&&(l[a-6]=l[a-2],l[a-5]=l[a-1]),y(e,l,e.length/v),d&&n--}n=n||"";var i,s=t.startX,o=t.endX,u=n.indexOf("C")>-1,a=u?7:3,f,l,c,h=n.split(" "),p=r.slice(),d=t.isArea,v=d?2:1,m;u&&(g(h),g(p));if(s&&o){for(c=0;c<s.length;c++){if(s[c]===o[0]){i=c;break}if(s[0]===o[o.length-s.length+c]){i=c,m=!0;break}}i===undefined&&(h=[])}return h.length&&e.isNumber(i)&&(f=p.length+i*v*a,m?(b(h,p),w(p,h)):(b(p,h),w(h,p))),[h,p]}},e.extend=function(e,t){var n;e||(e={});for(n in t)e[n]=t[n];return e},e.merge=function(){var t,n=arguments,r,i={},s=function(t,n){var r,i;typeof t!="object"&&(t={});for(i in n)n.hasOwnProperty(i)&&(r=n[i],e.isObject(r,!0)&&i!=="renderTo"&&typeof r.nodeType!="number"?t[i]=s(t[i]||{},r):t[i]=n[i]);return t};n[0]===!0&&(i=n[1],n=Array.prototype.slice.call(n,2)),r=n.length;for(t=0;t<r;t++)i=s(i,n[t]);return i},e.pInt=function(e,t){return parseInt(e,t||10)},e.isString=function(e){return typeof e=="string"},e.isArray=function(e){var t=Object.prototype.toString.call(e);return t==="[object Array]"||t==="[object Array Iterator]"},e.isObject=function(t,n){return t&&typeof t=="object"&&(!n||!e.isArray(t))},e.isNumber=function(e){return typeof e=="number"&&!isNaN(e)},e.erase=function(e,t){var n=e.length;while(n--)if(e[n]===t){e.splice(n,1);break}},e.defined=function(e){return e!==undefined&&e!==null},e.attr=function(t,n,r){var i,s;if(e.isString(n))e.defined(r)?t.setAttribute(n,r):t&&t.getAttribute&&(s=t.getAttribute(n));else if(e.defined(n)&&e.isObject(n))for(i in n)t.setAttribute(i,n[i]);return s},e.splat=function(t){return e.isArray(t)?t:[t]},e.syncTimeout=function(e,t,n){if(t)return setTimeout(e,t,n);e.call(0,n)},e.pick=function(){var e=arguments,t,n,r=e.length;for(t=0;t<r;t++){n=e[t];if(n!==undefined&&n!==null)return n}},e.css=function(t,n){e.isMS&&!e.svg&&n&&n.opacity!==undefined&&(n.filter="alpha(opacity="+n.opacity*100+")"),e.extend(t.style,n)},e.createElement=function(t,n,i,s,o){var u=r.createElement(t),a=e.css;return n&&e.extend(u,n),o&&a(u,{padding:0,border:"none",margin:0}),i&&a(u,i),s&&s.appendChild(u),u},e.extendClass=function(t,n){var r=function(){};return r.prototype=new t,e.extend(r.prototype,n),r},e.pad=function(e,t,n){return(new Array((t||2)+1-String(e).length)).join(n||0)+e},e.relativeLength=function(e,t){return/%$/.test(e)?t*parseFloat(e)/100:parseFloat(e)},e.wrap=function(e,t,n){var r=e[t];e[t]=function(){var e=Array.prototype.slice.call(arguments),t=arguments,i=this,s;return i.proceed=function(){r.apply(i,arguments.length?arguments:t)},e.unshift(r),s=n.apply(this,e),i.proceed=null,s}},e.getTZOffset=function(t){var n=e.Date;return(n.hcGetTimezoneOffset&&n.hcGetTimezoneOffset(t)||n.hcTimezoneOffset||0)*6e4},e.dateFormat=function(t,n,r){if(!e.defined(n)||isNaN(n))return e.defaultOptions.lang.invalidDate||"";t=e.pick(t,"%Y-%m-%d %H:%M:%S");var i=e.Date,s=new i(n-e.getTZOffset(n)),o,u=s[i.hcGetHours](),a=s[i.hcGetDay](),f=s[i.hcGetDate](),l=s[i.hcGetMonth](),c=s[i.hcGetFullYear](),h=e.defaultOptions.lang,p=h.weekdays,d=h.shortWeekdays,v=e.pad,m=e.extend({a:d?d[a]:p[a].substr(0,3),A:p[a],d:v(f),e:v(f,2," "),w:a,b:h.shortMonths[l],B:h.months[l],m:v(l+1),y:c.toString().substr(2,2),Y:c,H:v(u),k:u,I:v(u%12||12),l:u%12||12,M:v(s[i.hcGetMinutes]()),p:u<12?"AM":"PM",P:u<12?"am":"pm",S:v(s.getSeconds()),L:v(Math.round(n%1e3),3)},e.dateFormats);for(o in m)while(t.indexOf("%"+o)!==-1)t=t.replace("%"+o,typeof m[o]=="function"?m[o](n):m[o]);return r?t.substr(0,1).toUpperCase()+t.substr(1):t},e.formatSingle=function(t,n){var r=/f$/,i=/\.([0-9])/,s=e.defaultOptions.lang,o;return r.test(t)?(o=t.match(i),o=o?o[1]:-1,n!==null&&(n=e.numberFormat(n,o,s.decimalPoint,t.indexOf(",")>-1?s.thousandsSep:""))):n=e.dateFormat(t,n),n},e.format=function(t,n){var r="{",i=!1,s,o,u,a,f,l=[],c,h;while(t){h=t.indexOf(r);if(h===-1)break;s=t.slice(0,h);if(i){o=s.split(":"),u=o.shift().split("."),f=u.length,c=n;for(a=0;a<f;a++)c=c[u[a]];o.length&&(c=e.formatSingle(o.join(":"),c)),l.push(c)}else l.push(s);t=t.slice(h+1),i=!i,r=i?"}":"{"}return l.push(t),l.join("")},e.getMagnitude=function(e){return Math.pow(10,Math.floor(Math.log(e)/Math.LN10))},e.normalizeTickInterval=function(t,n,r,i,s){var o,u,a=t;r=e.pick(r,1),o=t/r,n||(n=s?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],i===!1&&(r===1?n=e.grep(n,function(e){return e%1===0}):r<=.1&&(n=[1/r])));for(u=0;u<n.length;u++){a=n[u];if(s&&a*r>=t||!s&&o<=(n[u]+(n[u+1]||n[u]))/2)break}return a=e.correctFloat(a*r,-Math.round(Math.log(.001)/Math.LN10)),a},e.stableSort=function(e,t){var n=e.length,r,i;for(i=0;i<n;i++)e[i].safeI=i;e.sort(function(e,n){return r=t(e,n),r===0?e.safeI-n.safeI:r});for(i=0;i<n;i++)delete e[i].safeI},e.arrayMin=function(e){var t=e.length,n=e[0];while(t--)e[t]<n&&(n=e[t]);return n},e.arrayMax=function(e){var t=e.length,n=e[0];while(t--)e[t]>n&&(n=e[t]);return n},e.destroyObjectProperties=function(e,t){var n;for(n in e)e[n]&&e[n]!==t&&e[n].destroy&&e[n].destroy(),delete e[n]},e.discardElement=function(t){var n=e.garbageBin;n||(n=e.createElement("div")),t&&n.appendChild(t),n.innerHTML=""},e.correctFloat=function(e,t){return parseFloat(e.toPrecision(t||14))},e.setAnimation=function(t,n){n.renderer.globalAnimation=e.pick(t,n.options.chart.animation,!0)},e.animObject=function(t){return e.isObject(t)?e.merge(t):{duration:t?500:0}},e.timeUnits={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},e.numberFormat=function(t,n,r,i){t=+t||0,n=+n;var s=e.defaultOptions.lang,o=(t.toString().split(".")[1]||"").length,u,a,f,l;return n===-1?n=Math.min(o,20):e.isNumber(n)||(n=2),l=(Math.abs(t)+Math.pow(10,-Math.max(n,o)-1)).toFixed(n),u=String(e.pInt(l)),a=u.length>3?u.length%3:0,r=e.pick(r,s.decimalPoint),i=e.pick(i,s.thousandsSep),f=t<0?"-":"",f+=a?u.substr(0,a)+i:"",f+=u.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+i),n&&(f+=r+l.slice(-n)),f},Math.easeInOutSine=function(e){return-0.5*(Math.cos(Math.PI*e)-1)},e.getStyle=function(t,n){var r;return n==="width"?Math.min(t.offsetWidth,t.scrollWidth)-e.getStyle(t,"padding-left")-e.getStyle(t,"padding-right"):n==="height"?Math.min(t.offsetHeight,t.scrollHeight)-e.getStyle(t,"padding-top")-e.getStyle(t,"padding-bottom"):(r=i.getComputedStyle(t,undefined),r&&e.pInt(r.getPropertyValue(n)))},e.inArray=function(e,t){return t.indexOf?t.indexOf(e):[].indexOf.call(t,e)},e.grep=function(e,t){return[].filter.call(e,t)},e.find=function(e,t){return[].find.call(e,t)},e.map=function(e,t){var n=[],r=0,i=e.length;for(;r<i;r++)n[r]=t.call(e[r],e[r],r,e);return n},e.offset=function(e){var t=r.documentElement,n=e.getBoundingClientRect();return{top:n.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0),left:n.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}},e.stop=function(e,n){var r=t.length;while(r--)t[r].elem===e&&(!n||n===t[r].prop)&&(t[r].stopped=!0)},e.each=function(e,t,n){return Array.prototype.forEach.call(e,t,n)},e.addEvent=function(t,n,r){function o(e){e.target=e.srcElement||i,r.call(t,e)}var s=t.hcEvents=t.hcEvents||{};return t.addEventListener?t.addEventListener(n,r,!1):t.attachEvent&&(t.hcEventsIE||(t.hcEventsIE={}),t.hcEventsIE[r.toString()]=o,t.attachEvent("on"+n,o)),s[n]||(s[n]=[]),s[n].push(r),function(){e.removeEvent(t,n,r)}},e.removeEvent=function(t,n,r){function u(e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.attachEvent&&(n=t.hcEventsIE[n.toString()],t.detachEvent("on"+e,n))}function a(){var e,r,i;if(!t.nodeName)return;n?(e={},e[n]=!0):e=s;for(i in e)if(s[i]){r=s[i].length;while(r--)u(i,s[i][r])}}var i,s=t.hcEvents,o;s&&(n?(i=s[n]||[],r?(o=e.inArray(r,i),o>-1&&(i.splice(o,1),s[n]=i),u(n,r)):(a(),s[n]=[])):(a(),t.hcEvents={}))},e.fireEvent=function(t,n,i,s){var o,u=t.hcEvents,a,f,l,c;i=i||{};if(r.createEvent&&(t.dispatchEvent||t.fireEvent))o=r.createEvent("Events"),o.initEvent(n,!0,!0),e.extend(o,i),t.dispatchEvent?t.dispatchEvent(o):t.fireEvent(n,o);else if(u){a=u[n]||[],f=a.length,i.target||e.extend(i,{preventDefault:function(){i.defaultPrevented=!0},target:t,type:n});for(l=0;l<f;l++)c=a[l],c&&c.call(t,i)===!1&&i.preventDefault()}s&&!i.defaultPrevented&&s(i)},e.animate=function(t,n,r){var i,s="",o,u,a,f;e.isObject(r)||(a=arguments,r={duration:a[2],easing:a[3],complete:a[4]}),e.isNumber(r.duration)||(r.duration=400),r.easing=typeof r.easing=="function"?r.easing:Math[r.easing]||Math.easeInOutSine,r.curAnim=e.merge(n);for(f in n)e.stop(t,f),u=new e.Fx(t,r,f),o=null,f==="d"?(u.paths=u.initPath(t,t.d,n.d),u.toD=n.d,i=0,o=1):t.attr?i=t.attr(f):(i=parseFloat(e.getStyle(t,f))||0,f!=="opacity"&&(s="px")),o||(o=n[f]),o&&o.match&&o.match("px")&&(o=o.replace(/px/g,"")),u.run(i,o,s)},e.seriesType=function(t,n,r,i,s){var o=e.getOptions(),u=e.seriesTypes;return o.plotOptions[t]=e.merge(o.plotOptions[n],r),u[t]=e.extendClass(u[n]||function(){},i),u[t].prototype.type=t,s&&(u[t].prototype.pointClass=e.extendClass(e.Point,s)),u[t]},e.uniqueKey=function(){var e=Math.random().toString(36).substring(2,9),t=0;return function(){return"highcharts-"+e+"-"+t++}}(),i.jQuery&&(i.jQuery.fn.highcharts=function(){var t=[].slice.call(arguments);if(this[0])return t[0]?(new(e[e.isString(t[0])?t.shift():"Chart"])(this[0],t[0],t[1]),this):n[e.attr(this[0],"data-highcharts-chart")]}),r&&!r.defaultView&&(e.getStyle=function(t,n){var r,i={width:"clientWidth",height:"clientHeight"}[n];return t.style[n]?e.pInt(t.style[n]):(n==="opacity"&&(n="filter"),i?(t.style.zoom=1,Math.max(t[i]-2*e.getStyle(t,"padding"),0)):(r=t.currentStyle[n.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()})],n==="filter"&&(r=r.replace(/alpha\(opacity=([0-9]+)\)/,function(e,t){return t/100})),r===""?1:e.pInt(r)))}),Array.prototype.forEach||(e.each=function(e,t,n){var r=0,i=e.length;for(;r<i;r++)if(t.call(n,e[r],r,e)===!1)return r}),Array.prototype.indexOf||(e.inArray=function(e,t){var n,r=0;if(t){n=t.length;for(;r<n;r++)if(t[r]===e)return r}return-1}),Array.prototype.filter||(e.grep=function(e,t){var n=[],r=0,i=e.length;for(;r<i;r++)t(e[r],r)&&n.push(e[r]);return n}),Array.prototype.find||(e.find=function(e,t){var n,r=e.length;for(n=0;n<r;n++)if(t(e[n],n))return e[n]})}(t),function(e){var t=e.each,n=e.isNumber,r=e.map,i=e.merge,s=e.pInt;e.Color=function(t){if(!(this instanceof e.Color))return new e.Color(t);this.init(t)},e.Color.prototype={parsers:[{regex:/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,parse:function(e){return[s(e[1]),s(e[2]),s(e[3]),parseFloat(e[4],10)]}},{regex:/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,parse:function(e){return[s(e[1]),s(e[2]),s(e[3]),1]}}],names:{white:"#ffffff",black:"#000000"},init:function(t){var n,i,s,o,u;this.input=t=this.names[t&&t.toLowerCase?t.toLowerCase():""]||t;if(t&&t.stops)this.stops=r(t.stops,function(t){return new e.Color(t[1])});else{t&&t[0]==="#"&&(u=t.length,t=parseInt(t.substr(1),16),u===7?i=[(t&16711680)>>16,(t&65280)>>8,t&255,1]:u===4&&(i=[(t&3840)>>4|(t&3840)>>8,(t&240)>>4|t&240,(t&15)<<4|t&15,1]));if(!i){s=this.parsers.length;while(s--&&!i)o=this.parsers[s],n=o.regex.exec(t),n&&(i=o.parse(n))}}this.rgba=i||[]},get:function(e){var r=this.input,s=this.rgba,o;return this.stops?(o=i(r),o.stops=[].concat(o.stops),t(this.stops,function(t,n){o.stops[n]=[o.stops[n][0],t.get(e)]})):s&&n(s[0])?e==="rgb"||!e&&s[3]===1?o="rgb("+s[0]+","+s[1]+","+s[2]+")":e==="a"?o=s[3]:o="rgba("+s.join(",")+")":o=r,o},brighten:function(e){var r,i=this.rgba;if(this.stops)t(this.stops,function(t){t.brighten(e)});else if(n(e)&&e!==0)for(r=0;r<3;r++)i[r]+=s(e*255),i[r]<0&&(i[r]=0),i[r]>255&&(i[r]=255);return this},setOpacity:function(e){return this.rgba[3]=e,this}},e.color=function(t){return new e.Color(t)}}(t),function(e){var t,n,r=e.addEvent,i=e.animate,s=e.attr,o=e.charts,u=e.color,a=e.css,f=e.createElement,l=e.defined,c=e.deg2rad,h=e.destroyObjectProperties,p=e.doc,d=e.each,v=e.extend,m=e.erase,g=e.grep,y=e.hasTouch,b=e.inArray,w=e.isArray,E=e.isFirefox,S=e.isMS,x=e.isObject,T=e.isString,N=e.isWebKit,C=e.merge,k=e.noop,L=e.pick,A=e.pInt,O=e.removeEvent,M=e.splat,_=e.stop,D=e.svg,P=e.SVG_NS,H=e.symbolSizes,B=e.win;t=e.SVGElement=function(){return this},t.prototype={opacity:1,SVG_NS:P,textProps:["direction","fontSize","fontWeight","fontFamily","fontStyle","color","lineHeight","width","textAlign","textDecoration","textOverflow","textOutline"],init:function(e,t){this.element=t==="span"?f(t):p.createElementNS(this.SVG_NS,t),this.renderer=e},animate:function(t,n,r){var s=e.animObject(L(n,this.renderer.globalAnimation,!0));return s.duration!==0?(r&&(s.complete=r),i(this,t,s)):(this.attr(t,null,r),s.step&&s.step.call(this)),this},colorGradient:function(t,n,r){var i=this.renderer,s,o,u,a,f,c,h,p,v,m,g,y,b=[],E;t.radialGradient?o="radialGradient":t.linearGradient&&(o="linearGradient");if(o){u=t[o],f=i.gradients,h=t.stops,m=r.radialReference,w(u)&&(t[o]=u={x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientUnits:"userSpaceOnUse"}),o==="radialGradient"&&m&&!l(u.gradientUnits)&&(a=u,u=C(u,i.getRadialAttr(m,a),{gradientUnits:"userSpaceOnUse"}));for(g in u)g!=="id"&&b.push(g,u[g]);for(g in h)b.push(h[g]);b=b.join(","),f[b]?y=f[b].attr("id"):(u.id=y=e.uniqueKey(),f[b]=c=i.createElement(o).attr(u).add(i.defs),c.radAttr=a,c.stops=[],d(h,function(t){var n;t[1].indexOf("rgba")===0?(s=e.color(t[1]),p=s.get("rgb"),v=s.get("a")):(p=t[1],v=1),n=i.createElement("stop").attr({offset:t[0],"stop-color":p,"stop-opacity":v}).add(c),c.stops.push(n)})),E="url("+i.url+"#"+y+")",r.setAttribute(n,E),r.gradient=b,t.toString=function(){return E}}},applyTextOutline:function(t){var n=this.element,r,i,o=t.indexOf("contrast")!==-1,u={},a,f,l,c;o&&(u.textOutline=t=t.replace(/contrast/g,this.renderer.getContrast(n.style.fill))),t=t.split(" "),a=t[t.length-1],f=t[0];if(f&&f!=="none"&&e.svg){this.fakeTS=!0,r=[].slice.call(n.getElementsByTagName("tspan")),this.ySetter=this.xSetter,f=f.replace(/(^[\d\.]+)(.*?)$/g,function(e,t,n){return 2*t+n}),c=r.length;while(c--)i=r[c],i.getAttribute("class")==="highcharts-text-outline"&&m(r,n.removeChild(i));l=n.firstChild,d(r,function(e,t){var r;t===0&&(e.setAttribute("x",n.getAttribute("x")),t=n.getAttribute("y"),e.setAttribute("y",t||0),t===null&&n.setAttribute("y",0)),r=e.cloneNode(1),s(r,{"class":"highcharts-text-outline",fill:a,stroke:a,"stroke-width":f,"stroke-linejoin":"round"}),n.insertBefore(r,l)})}},attr:function(e,t,n,r){var i,s,o=this.element,u,a=this,f,l;typeof e=="string"&&t!==undefined&&(i=e,e={},e[i]=t);if(typeof e=="string")a=(this[e+"Getter"]||this._defaultGetter).call(this,e,o);else{for(i in e)s=e[i],f=!1,r||_(this,i),this.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)$/.test(i)&&(u||(this.symbolAttr(e),u=!0),f=!0),this.rotation&&(i==="x"||i==="y")&&(this.doTransform=!0),f||(l=this[i+"Setter"]||this._defaultSetter,l.call(this,s,i,o),this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(i)&&this.updateShadows(i,s,l));this.doTransform&&(this.updateTransform(),this.doTransform=!1)}return n&&n(),a},updateShadows:function(e,t,n){var r=this.shadows,i=r.length;while(i--)n.call(r[i],e==="height"?Math.max(t-(r[i].cutHeight||0),0):e==="d"?this.d:t,e,r[i])},addClass:function(e,t){var n=this.attr("class")||"";return n.indexOf(e)===-1&&(t||(e=(n+(n?" ":"")+e).replace("  "," ")),this.attr("class",e)),this},hasClass:function(e){return s(this.element,"class").indexOf(e)!==-1},removeClass:function(e){return s(this.element,"class",(s(this.element,"class")||"").replace(e,"")),this},symbolAttr:function(e){var t=this;d(["x","y","r","start","end","width","height","innerR","anchorX","anchorY"],function(n){t[n]=L(e[n],t[n])}),t.attr({d:t.renderer.symbols[t.symbolName](t.x,t.y,t.width,t.height,t)})},clip:function(e){return this.attr("clip-path",e?"url("+this.renderer.url+"#"+e.id+")":"none")},crisp:function(e,t){var n=this,r,i={},s;t=t||e.strokeWidth||0,s=Math.round(t)%2/2,e.x=Math.floor(e.x||n.x||0)+s,e.y=Math.floor(e.y||n.y||0)+s,e.width=Math.floor((e.width||n.width||0)-2*s),e.height=Math.floor((e.height||n.height||0)-2*s),l(e.strokeWidth)&&(e.strokeWidth=t);for(r in e)n[r]!==e[r]&&(n[r]=i[r]=e[r]);return i},css:function(e){var t=this.styles,n={},r=this.element,i,o,u="",f,l=!t,c=["textOutline","textOverflow","width"];e&&e.color&&(e.fill=e.color);if(t)for(o in e)e[o]!==t[o]&&(n[o]=e[o],l=!0);if(l){t&&(e=v(t,n)),i=this.textWidth=e&&e.width&&e.width!=="auto"&&r.nodeName.toLowerCase()==="text"&&A(e.width),this.styles=e,i&&!D&&this.renderer.forExport&&delete e.width;if(S&&!D)a(this.element,e);else{f=function(e,t){return"-"+t.toLowerCase()};for(o in e)b(o,c)===-1&&(u+=o.replace(/([A-Z])/g,f)+":"+e[o]+";");u&&s(r,"style",u)}this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),e&&e.textOutline&&this.applyTextOutline(e.textOutline))}return this},strokeWidth:function(){return this["stroke-width"]||0},on:function(e,t){var n=this,r=n.element;return y&&e==="click"?(r.ontouchstart=function(e){n.touchEventFired=Date.now(),e.preventDefault(),t.call(r,e)},r.onclick=function(e){(B.navigator.userAgent.indexOf("Android")===-1||Date.now()-(n.touchEventFired||0)>1100)&&t.call(r,e)}):r["on"+e]=t,this},setRadialReference:function(e){var t=this.renderer.gradients[this.element.gradient];return this.element.radialReference=e,t&&t.radAttr&&t.animate(this.renderer.getRadialAttr(e,t.radAttr)),this},translate:function(e,t){return this.attr({translateX:e,translateY:t})},invert:function(e){var t=this;return t.inverted=e,t.updateTransform(),t},updateTransform:function(){var e=this,t=e.translateX||0,n=e.translateY||0,r=e.scaleX,i=e.scaleY,s=e.inverted,o=e.rotation,u=e.element,a;s&&(t+=e.width,n+=e.height),a=["translate("+t+","+n+")"],s?a.push("rotate(90) scale(-1,1)"):o&&a.push("rotate("+o+" "+(u.getAttribute("x")||0)+" "+(u.getAttribute("y")||0)+")"),(l(r)||l(i))&&a.push("scale("+L(r,1)+" "+L(i,1)+")"),a.length&&u.setAttribute("transform",a.join(" "))},toFront:function(){var e=this.element;return e.parentNode.appendChild(e),this},align:function(e,t,n){var r,i,s,o,u={},a,f=this.renderer,l=f.alignedObjects,c,h;if(e){this.alignOptions=e,this.alignByTranslate=t;if(!n||T(n))this.alignTo=a=n||"renderer",m(l,this),l.push(this),n=null}else e=this.alignOptions,t=this.alignByTranslate,a=this.alignTo;return n=L(n,f[a],f),r=e.align,i=e.verticalAlign,s=(n.x||0)+(e.x||0),o=(n.y||0)+(e.y||0),r==="right"?c=1:r==="center"&&(c=2),c&&(s+=(n.width-(e.width||0))/c),u[t?"translateX":"x"]=Math.round(s),i==="bottom"?h=1:i==="middle"&&(h=2),h&&(o+=(n.height-(e.height||0))/h),u[t?"translateY":"y"]=Math.round(o),this[this.placed?"animate":"attr"](u),this.placed=!0,this.alignAttr=u,this},getBBox:function(e,t){var n=this,r,i=n.renderer,s,o,u,a,f=n.element,l=n.styles,h,p=n.textStr,m,g=i.cache,y=i.cacheKeys,b;u=L(t,n.rotation),a=u*c,h=l&&l.fontSize,p!==undefined&&(b=p.toString(),b.indexOf("<")===-1&&(b=b.replace(/[0-9]/g,"0")),b+=["",u||0,h,l&&l.width,l&&l.textOverflow].join(",")),b&&!e&&(r=g[b]);if(!r){if(f.namespaceURI===n.SVG_NS||i.forExport){try{m=this.fakeTS&&function(e){d(f.querySelectorAll(".highcharts-text-outline"),function(t){t.style.display=e})},m&&m("none"),r=f.getBBox?v({},f.getBBox()):{width:f.offsetWidth,height:f.offsetHeight},m&&m("")}catch(w){}if(!r||r.width<0)r={width:0,height:0}}else r=n.htmlGetBBox();i.isSVG&&(s=r.width,o=r.height,l&&l.fontSize==="11px"&&Math.round(o)===17&&(r.height=o=14),u&&(r.width=Math.abs(o*Math.sin(a))+Math.abs(s*Math.cos(a)),r.height=Math.abs(o*Math.cos(a))+Math.abs(s*Math.sin(a))));if(b&&r.height>0){while(y.length>250)delete g[y.shift()];g[b]||y.push(b),g[b]=r}}return r},show:function(e){return this.attr({visibility:e?"inherit":"visible"})},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(e){var t=this;t.animate({opacity:0},{duration:e||150,complete:function(){t.attr({y:-9999})}})},add:function(e){var t=this.renderer,n=this.element,r;e&&(this.parentGroup=e),this.parentInverted=e&&e.inverted,this.textStr!==undefined&&t.buildText(this),this.added=!0;if(!e||e.handleZ||this.zIndex)r=this.zIndexSetter();return r||(e?e.element:t.box).appendChild(n),this.onAdd&&this.onAdd(),this},safeRemoveChild:function(e){var t=e.parentNode;t&&t.removeChild(e)},destroy:function(){var e=this,t=e.element||{},n=e.renderer.isSVG&&t.nodeName==="SPAN"&&e.parentGroup,r,i,s;t.onclick=t.onmouseout=t.onmouseover=t.onmousemove=t.point=null,_(e),e.clipPath&&(d(e.element.ownerSVGElement.querySelectorAll("[clip-path]"),function(t){t.getAttribute("clip-path").indexOf(e.clipPath.element.id)>-1&&t.removeAttribute("clip-path")}),e.clipPath=e.clipPath.destroy());if(e.stops){for(s=0;s<e.stops.length;s++)e.stops[s]=e.stops[s].destroy();e.stops=null}e.safeRemoveChild(t),e.destroyShadows();while(n&&n.div&&n.div.childNodes.length===0)r=n.parentGroup,e.safeRemoveChild(n.div),delete n.div,n=r;e.alignTo&&m(e.renderer.alignedObjects,e);for(i in e)delete e[i];return null},shadow:function(e,t,n){var r=[],i,o,u=this.element,a,f,l,c;if(!e)this.destroyShadows();else if(!this.shadows){f=L(e.width,3),l=(e.opacity||.15)/f,c=this.parentInverted?"(-1,-1)":"("+L(e.offsetX,1)+", "+L(e.offsetY,1)+")";for(i=1;i<=f;i++)o=u.cloneNode(0),a=f*2+1-2*i,s(o,{isShadow:"true",stroke:e.color||"#000000","stroke-opacity":l*i,"stroke-width":a,transform:"translate"+c,fill:"none"}),n&&(s(o,"height",Math.max(s(o,"height")-a,0)),o.cutHeight=a),t?t.element.appendChild(o):u.parentNode.insertBefore(o,u),r.push(o);this.shadows=r}return this},destroyShadows:function(){d(this.shadows||[],function(e){this.safeRemoveChild(e)},this),this.shadows=undefined},xGetter:function(e){return this.element.nodeName==="circle"&&(e==="x"?e="cx":e==="y"&&(e="cy")),this._defaultGetter(e)},_defaultGetter:function(e){var t=L(this[e],this.element?this.element.getAttribute(e):null,0);return/^[\-0-9\.]+$/.test(t)&&(t=parseFloat(t)),t},dSetter:function(e,t,n){e&&e.join&&(e=e.join(" ")),/(NaN| {2}|^$)/.test(e)&&(e="M 0 0"),n.setAttribute(t,e),this[t]=e},dashstyleSetter:function(e){var t,n=this["stroke-width"];n==="inherit"&&(n=1),e=e&&e.toLowerCase();if(e){e=e.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(","),t=e.length;while(t--)e[t]=A(e[t])*n;e=e.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",e)}},alignSetter:function(e){var t={left:"start",center:"middle",right:"end"};this.element.setAttribute("text-anchor",t[e])},opacitySetter:function(e,t,n){this[t]=e,n.setAttribute(t,e)},titleSetter:function(e){var t=this.element.getElementsByTagName("title")[0];t||(t=p.createElementNS(this.SVG_NS,"title"),this.element.appendChild(t)),t.firstChild&&t.removeChild(t.firstChild),t.appendChild(p.createTextNode(String(L(e),"").replace(/<[^>]*>/g,"")))},textSetter:function(e){e!==this.textStr&&(delete this.bBox,this.textStr=e,this.added&&this.renderer.buildText(this))},fillSetter:function(e,t,n){typeof e=="string"?n.setAttribute(t,e):e&&this.colorGradient(e,t,n)},visibilitySetter:function(e,t,n){e==="inherit"?n.removeAttribute(t):n.setAttribute(t,e)},zIndexSetter:function(e,t){var n=this.renderer,r=this.parentGroup,i=r||n,s=i.element||n.box,o,u,a,f=this.element,c,h=this.added,p;l(e)&&(f.zIndex=e,e=+e,this[t]===e&&(h=!1),this[t]=e);if(h){e=this.zIndex,e&&r&&(r.handleZ=!0),o=s.childNodes;for(p=0;p<o.length&&!c;p++)u=o[p],a=u.zIndex,u!==f&&(A(a)>e||!l(e)&&l(a)||e<0&&!l(a)&&s!==n.box)&&(s.insertBefore(f,u),c=!0);c||s.appendChild(f)}return c},_defaultSetter:function(e,t,n){n.setAttribute(t,e)}},t.prototype.yGetter=t.prototype.xGetter,t.prototype.translateXSetter=t.prototype.translateYSetter=t.prototype.rotationSetter=t.prototype.verticalAlignSetter=t.prototype.scaleXSetter=t.prototype.scaleYSetter=function(e,t){this[t]=e,this.doTransform=!0},t.prototype["stroke-widthSetter"]=t.prototype.strokeSetter=function(e,n,r){this[n]=e,this.stroke&&this["stroke-width"]?(t.prototype.fillSetter.call(this,this.stroke,"stroke",r),r.setAttribute("stroke-width",this["stroke-width"]),this.hasStroke=!0):n==="stroke-width"&&e===0&&this.hasStroke&&(r.removeAttribute("stroke"),this.hasStroke=!1)},n=e.SVGRenderer=function(){this.init.apply(this,arguments)},n.prototype={Element:t,SVG_NS:P,init:function(e,t,n,i,o,u){var f=this,l,c,h;l=f.createElement("svg").attr({version:"1.1","class":"highcharts-root"}).css(this.getStyle(i)),c=l.element,e.appendChild(c),e.innerHTML.indexOf("xmlns")===-1&&s(c,"xmlns",this.SVG_NS),f.isSVG=!0,this.box=c,this.boxWrapper=l,f.alignedObjects=[],this.url=(E||N)&&p.getElementsByTagName("base").length?B.location.href.replace(/#.*?$/,"").replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"",h=this.createElement("desc").add(),h.element.appendChild(p.createTextNode("Created with Highcharts 5.0.10")),f.defs=this.createElement("defs").add(),f.allowHTML=u,f.forExport=o,f.gradients={},f.cache={},f.cacheKeys=[],f.imgCount=0,f.setSize(t,n,!1);var d,v;E&&e.getBoundingClientRect&&(d=function(){a(e,{left:0,top:0}),v=e.getBoundingClientRect(),a(e,{left:Math.ceil(v.left)-v.left+"px",top:Math.ceil(v.top)-v.top+"px"})},d(),f.unSubPixelFix=r(B,"resize",d))},getStyle:function(e){return this.style=v({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},e),this.style},setStyle:function(e){this.boxWrapper.css(this.getStyle(e))},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var e=this,t=e.defs;return e.box=null,e.boxWrapper=e.boxWrapper.destroy(),h(e.gradients||{}),e.gradients=null,t&&(e.defs=t.destroy()),e.unSubPixelFix&&e.unSubPixelFix(),e.alignedObjects=null,null},createElement:function(e){var t=new this.Element;return t.init(this,e),t},draw:k,getRadialAttr:function(e,t){return{cx:e[0]-e[2]/2+t.cx*e[2],cy:e[1]-e[2]/2+t.cy*e[2],r:t.r*e[2]}},getSpanWidth:function(e,t){var n=this,r=e.getBBox(!0),i=r.width;return!D&&n.forExport&&(i=n.measureSpanWidth(t.firstChild.data,e.styles)),i},applyEllipsis:function(e,t,n,r){var i=this,s=i.getSpanWidth(e,t),o=s>r,u=n,a,f=0,l=n.length,c=function(e){t.removeChild(t.firstChild),e&&t.appendChild(p.createTextNode(e))};if(o){while(f<=l)a=Math.ceil((f+l)/2),u=n.substring(0,a)+"…",c(u),s=i.getSpanWidth(e,t),f===l?f=l+1:s>r?l=a-1:f=a;l===0&&c("")}return o},buildText:function(e){var t=e.element,n=this,r=n.forExport,i=L(e.textStr,"").toString(),o=i.indexOf("<")!==-1,u,f=t.childNodes,l,c,h,v,m=s(t,"x"),y=e.styles,b=e.textWidth,w=y&&y.lineHeight,E=y&&y.textOutline,S=y&&y.textOverflow==="ellipsis",x=y&&y.whiteSpace==="nowrap",T=y&&y.fontSize,N,C,k=f.length,O=b&&!e.added&&this.box,M=function(e){var r;return r=/(px|em)$/.test(e&&e.style.fontSize)?e.style.fontSize:T||n.style.fontSize||12,w?A(w):n.fontMetrics(r,e.getAttribute("style")?e:t).h},_=function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">")};N=[i,S,x,w,E,T,b].join(",");if(N===e.textCache)return;e.textCache=N;while(k--)t.removeChild(f[k]);!o&&!E&&!S&&!b&&i.indexOf(" ")===-1?t.appendChild(p.createTextNode(_(i))):(l=/<.*class="([^"]+)".*>/,c=/<.*style="([^"]+)".*>/,h=/<.*href="(http[^"]+)".*>/,O&&O.appendChild(t),o?u=i.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g):u=[i],u=g(u,function(e){return e!==""}),d(u,function(o,u){var f,g=0;o=o.replace(/^\s+|\s+$/g,"").replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||"),f=o.split("|||"),d(f,function(o){if(o!==""||f.length===1){var d={},y=p.createElementNS(n.SVG_NS,"tspan"),w,E;l.test(o)&&(w=o.match(l)[1],s(y,"class",w)),c.test(o)&&(E=o.match(c)[1].replace(/(;| |^)color([ :])/,"$1fill$2"),s(y,"style",E)),h.test(o)&&!r&&(s(y,"onclick",'location.href="'+o.match(h)[1]+'"'),a(y,{cursor:"pointer"})),o=_(o.replace(/<(.|\n)*?>/g,"")||" ");if(o!==" "){y.appendChild(p.createTextNode(o)),g?d.dx=0:u&&m!==null&&(d.x=m),s(y,d),t.appendChild(y),!g&&C&&(!D&&r&&a(y,{display:"block"}),s(y,"dy",M(y)));if(b){var T=o.replace(/([^\^])-/g,"$1- ").split(" "),N=f.length>1||u||T.length>1&&!x,k,L=[],A,O=M(y),H=e.rotation;S&&(v=n.applyEllipsis(e,y,o,b));while(!S&&N&&(T.length||L.length))e.rotation=0,A=n.getSpanWidth(e,y),k=A>b,v===undefined&&(v=k),!k||T.length===1?(T=L,L=[],T.length&&!x&&(y=p.createElementNS(P,"tspan"),s(y,{dy:O,x:m}),E&&s(y,"style",E),t.appendChild(y)),A>b&&(b=A)):(y.removeChild(y.firstChild),L.unshift(T.pop())),T.length&&y.appendChild(p.createTextNode(T.join(" ").replace(/- /g,"-")));e.rotation=H}g++}}}),C=C||t.childNodes.length}),v&&e.attr("title",e.textStr),O&&O.removeChild(t),E&&e.applyTextOutline&&e.applyTextOutline(E))},getContrast:function(e){return e=u(e).rgba,e[0]+e[1]+e[2]>510?"#000000":"#FFFFFF"},button:function(e,t,n,i,s,o,u,a,f){var l=this.label(e,t,n,f,null,null,null,null,"button"),c=0;l.attr(C({padding:8,r:2},s));var h,p,d,m;return s=C({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},s),h=s.style,delete s.style,o=C(s,{fill:"#e6e6e6"},o),p=o.style,delete o.style,u=C(s,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},u),d=u.style,delete u.style,a=C(s,{style:{color:"#cccccc"}},a),m=a.style,delete a.style,r(l.element,S?"mouseover":"mouseenter",function(){c!==3&&l.setState(1)}),r(l.element,S?"mouseout":"mouseleave",function(){c!==3&&l.setState(c)}),l.setState=function(e){e!==1&&(l.state=c=e),l.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][e||0]),l.attr([s,o,u,a][e||0]).css([h,p,d,m][e||0])},l.attr(s).css(v({cursor:"default"},h)),l.on("click",function(e){c!==3&&i.call(l,e)})},crispLine:function(e,t){return e[1]===e[4]&&(e[1]=e[4]=Math.round(e[1])-t%2/2),e[2]===e[5]&&(e[2]=e[5]=Math.round(e[2])+t%2/2),e},path:function(e){var t={fill:"none"};return w(e)?t.d=e:x(e)&&v(t,e),this.createElement("path").attr(t)},circle:function(e,t,n){var r=x(e)?e:{x:e,y:t,r:n},i=this.createElement("circle");return i.xSetter=i.ySetter=function(e,t,n){n.setAttribute("c"+t,e)},i.attr(r)},arc:function(e,t,n,r,i,s){var o,u;return x(e)?(u=e,t=u.y,n=u.r,r=u.innerR,i=u.start,s=u.end,e=u.x):u={innerR:r,start:i,end:s},o=this.symbol("arc",e,t,n,n,u),o.r=n,o},rect:function(e,t,n,r,i,o){i=x(e)?e.r:i;var u=this.createElement("rect"),a=x(e)?e:e===undefined?{}:{x:e,y:t,width:Math.max(n,0),height:Math.max(r,0)};return o!==undefined&&(a.strokeWidth=o,a=u.crisp(a)),a.fill="none",i&&(a.r=i),u.rSetter=function(e,t,n){s(n,{rx:e,ry:e})},u.attr(a)},setSize:function(e,t,n){var r=this,i=r.alignedObjects,s=i.length;r.width=e,r.height=t,r.boxWrapper.animate({width:e,height:t},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:L(n,!0)?undefined:0});while(s--)i[s].align()},g:function(e){var t=this.createElement("g");return e?t.attr({"class":"highcharts-"+e}):t},image:function(e,t,n,r,i){var s={preserveAspectRatio:"none"},o;return arguments.length>1&&v(s,{x:t,y:n,width:r,height:i}),o=this.createElement("image").attr(s),o.element.setAttributeNS?o.element.setAttributeNS("http://www.w3.org/1999/xlink","href",e):o.element.setAttribute("hc-svg-href",e),o},symbol:function(e,t,n,r,i,s){var u=this,c,h=this.symbols[e],m=l(t)&&h&&this.symbols[e](Math.round(t),Math.round(n),r,i,s),g=/^url\((.*?)\)$/,y,b;return h?(c=this.path(m),c.attr("fill","none"),v(c,{symbolName:e,x:t,y:n,width:r,height:i}),s&&v(c,s)):g.test(e)&&(y=e.match(g)[1],c=this.image(y),c.imgwidth=L(H[y]&&H[y].width,s&&s.width),c.imgheight=L(H[y]&&H[y].height,s&&s.height),b=function(){c.attr({width:c.width,height:c.height})},d(["width","height"],function(e){c[e+"Setter"]=function(e,t){var n={},r=this["img"+t],i=t==="width"?"translateX":"translateY";this[t]=e,l(r)&&(this.element&&this.element.setAttribute(t,r),this.alignByTranslate||(n[i]=((this[t]||0)-r)/2,this.attr(n)))}}),l(t)&&c.attr({x:t,y:n}),c.isImg=!0,l(c.imgwidth)&&l(c.imgheight)?b():(c.attr({width:0,height:0}),f("img",{onload:function(){var e=o[u.chartIndex];this.width===0&&(a(this,{position:"absolute",top:"-999em"}),p.body.appendChild(this)),H[y]={width:this.width,height:this.height},c.imgwidth=this.width,c.imgheight=this.height,c.element&&b(),this.parentNode&&this.parentNode.removeChild(this),u.imgCount--,!u.imgCount&&e&&e.onload&&e.onload()},src:y}),this.imgCount++)),c},symbols:{circle:function(e,t,n,r){return this.arc(e+n/2,t+r/2,n/2,r/2,{start:0,end:Math.PI*2,open:!1})},square:function(e,t,n,r){return["M",e,t,"L",e+n,t,e+n,t+r,e,t+r,"Z"]},triangle:function(e,t,n,r){return["M",e+n/2,t,"L",e+n,t+r,e,t+r,"Z"]},"triangle-down":function(e,t,n,r){return["M",e,t,"L",e+n,t,e+n/2,t+r,"Z"]},diamond:function(e,t,n,r){return["M",e+n/2,t,"L",e+n,t+r/2,e+n/2,t+r,e,t+r/2,"Z"]},arc:function(e,t,n,r,i){var s=i.start,o=i.r||n,u=i.r||r||n,a=i.end-.001,f=i.innerR,c=i.open,h=Math.cos(s),p=Math.sin(s),d=Math.cos(a),v=Math.sin(a),m=i.end-s<Math.PI?0:1,g;return g=["M",e+o*h,t+u*p,"A",o,u,0,m,1,e+o*d,t+u*v],l(f)&&g.push(c?"M":"L",e+f*d,t+f*v,"A",f,f,0,m,0,e+f*h,t+f*p),g.push(c?"":"Z"),g},callout:function(e,t,n,r,i){var s=6,o=6,u=Math.min(i&&i.r||0,n,r),a=u+o,f=i&&i.anchorX,l=i&&i.anchorY,c;return c=["M",e+u,t,"L",e+n-u,t,"C",e+n,t,e+n,t,e+n,t+u,"L",e+n,t+r-u,"C",e+n,t+r,e+n,t+r,e+n-u,t+r,"L",e+u,t+r,"C",e,t+r,e,t+r,e,t+r-u,"L",e,t+u,"C",e,t,e,t,e+u,t],f&&f>n?l>t+a&&l<t+r-a?c.splice(13,3,"L",e+n,l-o,e+n+s,l,e+n,l+o,e+n,t+r-u):c.splice(13,3,"L",e+n,r/2,f,l,e+n,r/2,e+n,t+r-u):f&&f<0?l>t+a&&l<t+r-a?c.splice(33,3,"L",e,l+o,e-s,l,e,l-o,e,t+u):c.splice(33,3,"L",e,r/2,f,l,e,r/2,e,t+u):l&&l>r&&f>e+a&&f<e+n-a?c.splice(23,3,"L",f+o,t+r,f,t+r+s,f-o,t+r,e+u,t+r):l&&l<0&&f>e+a&&f<e+n-a&&c.splice(3,3,"L",f-o,t,f,t-s,f+o,t,n-u,t),c}},clipRect:function(t,n,r,i){var s,o=e.uniqueKey(),u=this.createElement("clipPath").attr({id:o}).add(this.defs);return s=this.rect(t,n,r,i,0).add(u),s.id=o,s.clipPath=u,s.count=0,s},text:function(e,t,n,r){var i=this,s=!D&&i.forExport,o,u={};if(r&&(i.allowHTML||!i.forExport))return i.html(e,t,n);u.x=Math.round(t||0),n&&(u.y=Math.round(n));if(e||e===0)u.text=e;return o=i.createElement("text").attr(u),s&&o.css({position:"absolute"}),r||(o.xSetter=function(e,t,n){var r=n.getElementsByTagName("tspan"),i,s=n.getAttribute(t),o;for(o=0;o<r.length;o++)i=r[o],i.getAttribute(t)===s&&i.setAttribute(t,e);n.setAttribute(t,e)}),o},fontMetrics:function(e,t){var n,r;return e=e||t&&t.style&&t.style.fontSize||this.style&&this.style.fontSize,/px/.test(e)?e=A(e):/em/.test(e)?e=parseFloat(e)*(t?this.fontMetrics(null,t.parentNode).f:16):e=12,n=e<24?e+3:Math.round(e*1.2),r=Math.round(n*.8),{h:n,b:r,f:e}},rotCorr:function(e,t,n){var r=e;return t&&n&&(r=Math.max(r*Math.cos(t*c),4)),{x:-e/3*Math.sin(t*c),y:r}},label:function(n,r,i,s,o,u,a,f,c){var h=this,p=h.g(c!=="button"&&"label"),m=p.text=h.text("",0,0,a).attr({zIndex:1}),g,y,b=0,w=3,E=0,S,x,T,N,k,L={},A,M,_=/^url\((.*?)\)$/.test(s),D=_,P,H,B,j;c&&p.addClass("highcharts-"+c),D=_,P=function(){return(A||0)%2/2},H=function(){var e=m.element.style,t,n={};y=(S===undefined||x===undefined||k)&&l(m.textStr)&&m.getBBox(),p.width=(S||y.width||0)+2*w+E,p.height=(x||y.height||0)+2*w,M=w+h.fontMetrics(e&&e.fontSize,m).b,D&&(g||(p.box=g=h.symbols[s]||_?h.symbol(s):h.rect(),g.addClass((c==="button"?"":"highcharts-label-box")+(c?" highcharts-"+c+"-box":"")),g.add(p),t=P(),n.x=t,n.y=(f?-M:0)+t),n.width=Math.round(p.width),n.height=Math.round(p.height),g.attr(v(n,L)),L={})},B=function(){var e=E+w,t;t=f?0:M,l(S)&&y&&(k==="center"||k==="right")&&(e+={center:.5,right:1}[k]*(S-y.width));if(e!==m.x||t!==m.y)m.attr("x",e),t!==undefined&&m.attr("y",t);m.x=e,m.y=t},j=function(e,t){g?g.attr(e,t):L[e]=t},p.onAdd=function(){m.add(p),p.attr({text:n||n===0?n:"",x:r,y:i}),g&&l(o)&&p.attr({anchorX:o,anchorY:u})},p.widthSetter=function(t){S=e.isNumber(t)?t:null},p.heightSetter=function(e){x=e},p["text-alignSetter"]=function(e){k=e},p.paddingSetter=function(e){l(e)&&e!==w&&(w=p.padding=e,B())},p.paddingLeftSetter=function(e){l(e)&&e!==E&&(E=e,B())},p.alignSetter=function(e){e={left:0,center:.5,right:1}[e],e!==b&&(b=e,y&&p.attr({x:T}))},p.textSetter=function(e){e!==undefined&&m.textSetter(e),H(),B()},p["stroke-widthSetter"]=function(e,t){e&&(D=!0),A=this["stroke-width"]=e,j(t,e)},p.strokeSetter=p.fillSetter=p.rSetter=function(e,t){t==="fill"&&e&&(D=!0),j(t,e)},p.anchorXSetter=function(e,t){o=e,j(t,Math.round(e)-P()-T)},p.anchorYSetter=function(e,t){u=e,j(t,e-N)},p.xSetter=function(e){p.x=e,b&&(e-=b*((S||y.width)+2*w)),T=Math.round(e),p.attr("translateX",T)},p.ySetter=function(e){N=p.y=Math.round(e),p.attr("translateY",N)};var F=p.css;return v(p,{css:function(e){if(e){var t={};e=C(e),d(p.textProps,function(n){e[n]!==undefined&&(t[n]=e[n],delete e[n])}),m.css(t)}return F.call(p,e)},getBBox:function(){return{width:y.width+2*w,height:y.height+2*w,x:y.x-w,y:y.y-w}},shadow:function(e){return e&&(H(),g&&g.shadow(e)),p},destroy:function(){O(p.element,"mouseenter"),O(p.element,"mouseleave"),m&&(m=m.destroy()),g&&(g=g.destroy()),t.prototype.destroy.call(p),p=h=H=B=j=null}})}},e.Renderer=n}(t),function(e){var t=e.attr,n=e.createElement,r=e.css,i=e.defined,s=e.each,o=e.extend,u=e.isFirefox,a=e.isMS,f=e.isWebKit,l=e.pInt,c=e.SVGElement,h=e.SVGRenderer,p=e.win,d=e.wrap;o(c.prototype,{htmlCss:function(e){var t=this,n=t.element,i=e&&n.tagName==="SPAN"&&e.width;return i&&(delete e.width,t.textWidth=i,t.updateTransform()),e&&e.textOverflow==="ellipsis"&&(e.whiteSpace="nowrap",e.overflow="hidden"),t.styles=o(t.styles,e),r(t.element,e),t},htmlGetBBox:function(){var e=this,t=e.element;return t.nodeName==="text"&&(t.style.position="absolute"),{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}},htmlUpdateTransform:function(){if(!this.added){this.alignOnAdd=!0;return}var e=this,t=e.renderer,n=e.element,o=e.translateX||0,u=e.translateY||0,a=e.x||0,c=e.y||0,h=e.textAlign||"left",p={left:0,center:.5,right:1}[h],d=e.styles;r(n,{marginLeft:o,marginTop:u}),e.shadows&&s(e.shadows,function(e){r(e,{marginLeft:o+1,marginTop:u+1})}),e.inverted&&s(n.childNodes,function(e){t.invertChild(e,n)});if(n.tagName==="SPAN"){var v=e.rotation,m,g=l(e.textWidth),y=d&&d.whiteSpace,b=[v,h,n.innerHTML,e.textWidth,e.textAlign].join(",");b!==e.cTT&&(m=t.fontMetrics(n.style.fontSize).b,i(v)&&e.setSpanRotation(v,p,m),r(n,{width:"",whiteSpace:y||"nowrap"}),n.offsetWidth>g&&/[ \-]/.test(n.textContent||n.innerText)&&r(n,{width:g+"px",display:"block",whiteSpace:y||"normal"}),e.getSpanCorrection(n.offsetWidth,m,p,v,h)),r(n,{left:a+(e.xCorr||0)+"px",top:c+(e.yCorr||0)+"px"}),f&&(m=n.offsetHeight),e.cTT=b}},setSpanRotation:function(e,t,n){var i={},s=a?"-ms-transform":f?"-webkit-transform":u?"MozTransform":p.opera?"-o-transform":"";i[s]=i.transform="rotate("+e+"deg)",i[s+(u?"Origin":"-origin")]=i.transformOrigin=t*100+"% "+n+"px",r(this.element,i)},getSpanCorrection:function(e,t,n){this.xCorr=-e*n,this.yCorr=-t}}),o(h.prototype,{html:function(e,r,i){var u=this.createElement("span"),a=u.element,f=u.renderer,l=f.isSVG,c=function(e,t){s(["opacity","visibility"],function(n){d(e,n+"Setter",function(e,n,r,i){e.call(this,n,r,i),t[r]=n})})};return u.textSetter=function(e){e!==a.innerHTML&&delete this.bBox,a.innerHTML=this.textStr=e,u.htmlUpdateTransform()},l&&c(u,u.element.style),u.xSetter=u.ySetter=u.alignSetter=u.rotationSetter=function(e,t){t==="align"&&(t="textAlign"),u[t]=e,u.htmlUpdateTransform()},u.attr({text:e,x:Math.round(r),y:Math.round(i)}).css({fontFamily:this.style.fontFamily,fontSize:this.style.fontSize,position:"absolute"}),a.style.whiteSpace="nowrap",u.css=u.htmlCss,l&&(u.add=function(e){var r,i=f.box.parentNode,l,h=[];this.parentGroup=e;if(e){r=e.div;if(!r){l=e;while(l)h.push(l),l=l.parentGroup;s(h.reverse(),function(e){var s,a=t(e.element,"class");a&&(a={className:a}),r=e.div=e.div||n("div",a,{position:"absolute",left:(e.translateX||0)+"px",top:(e.translateY||0)+"px",display:e.display,opacity:e.opacity,pointerEvents:e.styles&&e.styles.pointerEvents},r||i),s=r.style,o(e,{on:function(){return u.on.apply({element:h[0].div},arguments),e},translateXSetter:function(t,n){s.left=t+"px",e[n]=t,e.doTransform=!0},translateYSetter:function(t,n){s.top=t+"px",e[n]=t,e.doTransform=!0}}),c(e,s)})}}else r=i;return r.appendChild(a),u.added=!0,u.alignOnAdd&&u.htmlUpdateTransform(),u}),u}})}(t),function(e){var t,n,r,i=e.createElement,s=e.css,o=e.defined,u=e.deg2rad,a=e.discardElement,f=e.doc,l=e.each,c=e.erase,h=e.extend,p=e.extendClass,d=e.isArray,v=e.isNumber,m=e.isObject,g=e.merge,y=e.noop,b=e.pick,w=e.pInt,E=e.svg,S=e.SVGElement,x=e.SVGRenderer,T=e.win;E||(r={docMode8:f&&f.documentMode===8,init:function(e,t){var n=this,r=["<",t,' filled="f" stroked="f"'],s=["position: ","absolute",";"],o=t==="div";(t==="shape"||o)&&s.push("left:0;top:0;width:1px;height:1px;"),s.push("visibility: ",o?"hidden":"visible"),r.push(' style="',s.join(""),'"/>'),t&&(r=o||t==="span"||t==="img"?r.join(""):e.prepVML(r),n.element=i(r)),n.renderer=e},add:function(e){var t=this,n=t.renderer,r=t.element,i=n.box,s=e&&e.inverted,o=e?e.element||e:i;return e&&(this.parentGroup=e),s&&n.invertChild(r,o),o.appendChild(r),t.added=!0,t.alignOnAdd&&!t.deferUpdateTransform&&t.updateTransform(),t.onAdd&&t.onAdd(),this.className&&this.attr("class",this.className),t},updateTransform:S.prototype.htmlUpdateTransform,setSpanRotation:function(){var e=this.rotation,t=Math.cos(e*u),n=Math.sin(e*u);s(this.element,{filter:e?["progid:DXImageTransform.Microsoft.Matrix(M11=",t,", M12=",-n,", M21=",n,", M22=",t,", sizingMethod='auto expand')"].join(""):"none"})},getSpanCorrection:function(e,t,n,r,i){var o=r?Math.cos(r*u):1,a=r?Math.sin(r*u):0,f=b(this.elemHeight,this.element.offsetHeight),l,c=i&&i!=="left";this.xCorr=o<0&&-e,this.yCorr=a<0&&-f,l=o*a<0,this.xCorr+=a*t*(l?1-n:n),this.yCorr-=o*t*(r?l?n:1-n:1),c&&(this.xCorr-=e*n*(o<0?-1:1),r&&(this.yCorr-=f*n*(a<0?-1:1)),s(this.element,{textAlign:i}))},pathToVML:function(e){var t=e.length,n=[];while(t--)v(e[t])?n[t]=Math.round(e[t]*10)-5:e[t]==="Z"?n[t]="x":(n[t]=e[t],e.isArc&&(e[t]==="wa"||e[t]==="at")&&(n[t+5]===n[t+7]&&(n[t+7]+=e[t+7]>e[t+5]?1:-1),n[t+6]===n[t+8]&&(n[t+8]+=e[t+8]>e[t+6]?1:-1)));return n.join(" ")||"x"},clip:function(e){var t=this,n,r;return e?(n=e.members,c(n,t),n.push(t),t.destroyClip=function(){c(n,t)},r=e.getCSS(t)):(t.destroyClip&&t.destroyClip(),r={clip:t.docMode8?"inherit":"rect(auto)"}),t.css(r)},css:S.prototype.htmlCss,safeRemoveChild:function(e){e.parentNode&&a(e)},destroy:function(){return this.destroyClip&&this.destroyClip(),S.prototype.destroy.apply(this)},on:function(e,t){return this.element["on"+e]=function(){var e=T.event;e.target=e.srcElement,t(e)},this},cutOffPath:function(e,t){var n;e=e.split(/[ ,]/),n=e.length;if(n===9||n===11)e[n-4]=e[n-2]=w(e[n-2])-10*t;return e.join(" ")},shadow:function(e,t,n){var r=[],s,o=this.element,u=this.renderer,a,f=o.style,l,c=o.path,h,p,d,v;c&&typeof c.value!="string"&&(c="x"),p=c;if(e){d=b(e.width,3),v=(e.opacity||.15)/d;for(s=1;s<=3;s++)h=d*2+1-2*s,n&&(p=this.cutOffPath(c.value,h+.5)),l=['<shape isShadow="true" strokeweight="',h,'" filled="false" path="',p,'" coordsize="10 10" style="',o.style.cssText,'" />'],a=i(u.prepVML(l),null,{left:w(f.left)+b(e.offsetX,1),top:w(f.top)+b(e.offsetY,1)}),n&&(a.cutOff=h+1),l=['<stroke color="',e.color||"#000000",'" opacity="',v*s,'"/>'],i(u.prepVML(l),null,null,a),t?t.element.appendChild(a):o.parentNode.insertBefore(a,o),r.push(a);this.shadows=r}return this},updateShadows:y,setAttr:function(e,t){this.docMode8?this.element[e]=t:this.element.setAttribute(e,t)},classSetter:function(e){(this.added?this.element:this).className=e},dashstyleSetter:function(e,t,n){var r=n.getElementsByTagName("stroke")[0]||i(this.renderer.prepVML(["<stroke/>"]),null,null,n);r[t]=e||"solid",this[t]=e},dSetter:function(e,t,n){var r,i=this.shadows;e=e||[],this.d=e.join&&e.join(" "),n.path=e=this.pathToVML(e);if(i){r=i.length;while(r--)i[r].path=i[r].cutOff?this.cutOffPath(e,i[r].cutOff):e}this.setAttr(t,e)},fillSetter:function(e,t,n){var r=n.nodeName;r==="SPAN"?n.style.color=e:r!=="IMG"&&(n.filled=e!=="none",this.setAttr("fillcolor",this.renderer.color(e,n,t,this)))},"fill-opacitySetter":function(e,t,n){i(this.renderer.prepVML(["<",t.split("-")[0],' opacity="',e,'"/>']),null,null,n)},opacitySetter:y,rotationSetter:function(e,t,n){var r=n.style;this[t]=r[t]=e,r.left=-Math.round(Math.sin(e*u)+1)+"px",r.top=Math.round(Math.cos(e*u))+"px"},strokeSetter:function(e,t,n){this.setAttr("strokecolor",this.renderer.color(e,n,t,this))},"stroke-widthSetter":function(e,t,n){n.stroked=!!e,this[t]=e,v(e)&&(e+="px"),this.setAttr("strokeweight",e)},titleSetter:function(e,t){this.setAttr(t,e)},visibilitySetter:function(e,t,n){e==="inherit"&&(e="visible"),this.shadows&&l(this.shadows,function(n){n.style[t]=e}),n.nodeName==="DIV"&&(e=e==="hidden"?"-999em":0,this.docMode8||(n.style[t]=e?"visible":"hidden"),t="top"),n.style[t]=e},xSetter:function(e,t,n){this[t]=e,t==="x"?t="left":t==="y"&&(t="top"),this.updateClipping?(this[t]=e,this.updateClipping()):n.style[t]=e},zIndexSetter:function(e,t,n){n.style[t]=e}},r["stroke-opacitySetter"]=r["fill-opacitySetter"],e.VMLElement=r=p(S,r),r.prototype.ySetter=r.prototype.widthSetter=r.prototype.heightSetter=r.prototype.xSetter,n={Element:r,isIE8:T.navigator.userAgent.indexOf("MSIE 8.0")>-1,init:function(e,t,n){var r=this,i,s,o;r.alignedObjects=[],i=r.createElement("div").css({position:"relative"}),s=i.element,e.appendChild(i.element),r.isVML=!0,r.box=s,r.boxWrapper=i,r.gradients={},r.cache={},r.cacheKeys=[],r.imgCount=0,r.setSize(t,n,!1);if(!f.namespaces.hcv){f.namespaces.add("hcv","urn:schemas-microsoft-com:vml"),o="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } ";try{f.createStyleSheet().cssText=o}catch(u){f.styleSheets[0].cssText+=o}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(e,t,n,r){var i=this.createElement(),s=m(e);return h(i,{members:[],count:0,left:(s?e.x:e)+1,top:(s?e.y:t)+1,width:(s?e.width:n)-1,height:(s?e.height:r)-1,getCSS:function(e){var t=e.element,n=t.nodeName,r=n==="shape",i=e.inverted,s=this,o=s.top-(r?t.offsetTop:0),u=s.left,a=u+s.width,f=o+s.height,l={clip:"rect("+Math.round(i?u:o)+"px,"+Math.round(i?f:a)+"px,"+Math.round(i?a:f)+"px,"+Math.round(i?o:u)+"px)"};return!i&&e.docMode8&&n==="DIV"&&h(l,{width:a+"px",height:f+"px"}),l},updateClipping:function(){l(i.members,function(e){e.element&&e.css(i.getCSS(e))})}})},color:function(t,n,r,s){var o=this,u,a=/^rgba/,f,c,h="none";t&&t.linearGradient?c="gradient":t&&t.radialGradient&&(c="pattern");if(c){var p,d,v=t.linearGradient||t.radialGradient,m,g,y,b,w,E,S,x,T="",N=t.stops,C,k,L=[],A=function(){f=['<fill colors="'+L.join(",")+'" opacity="',E,'" o:opacity2="',w,'" type="',c,'" ',T,'focus="100%" method="any" />'],i(o.prepVML(f),null,null,n)};C=N[0],k=N[N.length-1],C[0]>0&&N.unshift([0,C[1]]),k[0]<1&&N.push([1,k[1]]),l(N,function(t,n){a.test(t[1])?(u=e.color(t[1]),p=u.get("rgb"),d=u.get("a")):(p=t[1],d=1),L.push(t[0]*100+"% "+p),n?(E=d,S=p):(w=d,x=p)});if(r==="fill")if(c==="gradient")m=v.x1||v[0]||0,g=v.y1||v[1]||0,y=v.x2||v[2]||0,b=v.y2||v[3]||0,T='angle="'+(90-Math.atan((b-g)/(y-m))*180/Math.PI)+'"',A();else{var O=v.r,M=O*2,_=O*2,D=v.cx,P=v.cy,B=n.radialReference,j,F=function(){B&&(j=s.getBBox(),D+=(B[0]-j.x)/j.width-.5,P+=(B[1]-j.y)/j.height-.5,M*=B[2]/j.width,_*=B[2]/j.height),T='src="'+e.getOptions().global.VMLRadialGradientURL+'" '+'size="'+M+","+_+'" '+'origin="0.5,0.5" '+'position="'+D+","+P+'" '+'color2="'+x+'" ',A()};s.added?F():s.onAdd=F,h=S}else h=p}else if(a.test(t)&&n.tagName!=="IMG")u=e.color(t),s[r+"-opacitySetter"](u.get("a"),r,n),h=u.get("rgb");else{var I=n.getElementsByTagName(r);I.length&&(I[0].opacity=1,I[0].type="solid"),h=t}return h},prepVML:function(e){var t="display:inline-block;behavior:url(#default#VML);",n=this.isIE8;return e=e.join(""),n?(e=e.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />'),e.indexOf('style="')===-1?e=e.replace("/>",' style="'+t+'" />'):e=e.replace('style="','style="'+t)):e=e.replace("<","<hcv:"),e},text:x.prototype.html,path:function(e){var t={coordsize:"10 10"};return d(e)?t.d=e:m(e)&&h(t,e),this.createElement("shape").attr(t)},circle:function(e,t,n){var r=this.symbol("circle");return m(e)&&(n=e.r,t=e.y,e=e.x),r.isCircle=!0,r.r=n,r.attr({x:e,y:t})},g:function(e){var t,n;return e&&(n={className:"highcharts-"+e,"class":"highcharts-"+e}),t=this.createElement("div").attr(n),t},image:function(e,t,n,r,i){var s=this.createElement("img").attr({src:e});return arguments.length>1&&s.attr({x:t,y:n,width:r,height:i}),s},createElement:function(e){return e==="rect"?this.symbol(e):x.prototype.createElement.call(this,e)},invertChild:function(e,t){var n=this,r=t.style,i=e.tagName==="IMG"&&e.style;s(e,{flip:"x",left:w(r.width)-(i?w(i.top):1),top:w(r.height)-(i?w(i.left):1),rotation:-90}),l(e.childNodes,function(t){n.invertChild(t,e)})},symbols:{arc:function(e,t,n,r,i){var s=i.start,o=i.end,u=i.r||n||r,a=i.innerR,f=Math.cos(s),l=Math.sin(s),c=Math.cos(o),h=Math.sin(o),p;return o-s===0?["x"]:(p=["wa",e-u,t-u,e+u,t+u,e+u*f,t+u*l,e+u*c,t+u*h],i.open&&!a&&p.push("e","M",e,t),p.push("at",e-a,t-a,e+a,t+a,e+a*c,t+a*h,e+a*f,t+a*l,"x","e"),p.isArc=!0,p)},circle:function(e,t,n,r,i){return i&&o(i.r)&&(n=r=2*i.r),i&&i.isCircle&&(e-=n/2,t-=r/2),["wa",e,t,e+n,t+r,e+n,t+r/2,e+n,t+r/2,"e"]},rect:function(e,t,n,r,i){return x.prototype.symbols[!o(i)||!i.r?"square":"callout"].call(0,e,t,n,r,i)}}},e.VMLRenderer=t=function(){this.init.apply(this,arguments)},t.prototype=g(x.prototype,n),e.Renderer=t),x.prototype.measureSpanWidth=function(e,t){var n=f.createElement("span"),r,i=f.createTextNode(e);return n.appendChild(i),s(n,t),this.box.appendChild(n),r=n.offsetWidth,a(n),r}}(t),function(e){function f(){var t=e.defaultOptions.global,n=a.moment;if(t.timezone){if(!!n)return function(e){return-n.tz(e,t.timezone).utcOffset()};e.error(25)}return t.useUTC&&t.getTimezoneOffset}function l(){var t=e.defaultOptions.global,i,s=t.useUTC,u=s?"getUTC":"get",l=s?"setUTC":"set";e.Date=i=t.Date||a.Date,i.hcTimezoneOffset=s&&t.timezoneOffset,i.hcGetTimezoneOffset=f(),i.hcMakeTime=function(e,t,n,u,a,f){var l;return s?(l=i.UTC.apply(0,arguments),l+=r(l)):l=(new i(e,t,o(n,1),o(u,0),o(a,0),o(f,0))).getTime(),l},n(["Minutes","Hours","Day","Date","Month","FullYear"],function(e){i["hcGet"+e]=u+e}),n(["Milliseconds","Seconds","Minutes","Hours","Date","Month","FullYear"],function(e){i["hcSet"+e]=l+e})}var t=e.color,n=e.each,r=e.getTZOffset,i=e.isTouchDevice,s=e.merge,o=e.pick,u=e.svg,a=e.win;e.defaultOptions={colors:"#7cb5ec #434348 #90ed7d #f7a35c #8085e9 #f15c80 #e4d354 #2b908f #f45b5b #91e8e1".split(" "),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalPoint:".",numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:" "},global:{useUTC:!0,VMLRadialGradientURL:"http://code.highcharts.com/5.0.10/gfx/vml-radial-gradient.png"},chart:{borderRadius:0,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{zIndex:20},position:{align:"right",x:-10,y:10}},width:null,height:null,borderColor:"#335cad",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{text:"Chart title",align:"center",margin:15,widthAdjust:-44},subtitle:{text:"",align:"center",widthAdjust:-44},plotOptions:{},labels:{style:{position:"absolute",color:"#333333"}},legend:{enabled:!0,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{activeColor:"#003399",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",fontSize:"12px",fontWeight:"bold"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#cccccc"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:u,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},footerFormat:"",padding:8,snap:i?25:10,backgroundColor:t("#f7f7f7").setOpacity(.85).get(),borderWidth:1,headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',shadow:!0,style:{color:"#333333",cursor:"default",fontSize:"12px",pointerEvents:"none",whiteSpace:"nowrap"}},credits:{enabled:!1,href:"http://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"9px"},text:"Highcharts.com"}},e.setOptions=function(t){return e.defaultOptions=s(!0,e.defaultOptions,t),l(),e.defaultOptions},e.getOptions=function(){return e.defaultOptions},e.defaultPlotOptions=e.defaultOptions.plotOptions,l()}(t),function(e){var t=e.arrayMax,n=e.arrayMin,r=e.defined,i=e.destroyObjectProperties,s=e.each,o=e.erase,u=e.merge,a=e.pick;e.PlotLineOrBand=function(e,t){this.axis=e,t&&(this.options=t,this.id=t.id)},e.PlotLineOrBand.prototype={render:function(){var e=this,t=e.axis,n=t.horiz,i=e.options,s=i.label,o=e.label,f=i.to,l=i.from,c=i.value,h=r(l)&&r(f),p=r(c),d=e.svgElem,v=!d,m=[],g,y,b=i.color,w=a(i.zIndex,0),E=i.events,S={"class":"highcharts-plot-"+(h?"band ":"line ")+(i.className||"")},x={},T=t.chart.renderer,N=h?"bands":"lines",C,k=t.log2lin;t.isLog&&(l=k(l),f=k(f),c=k(c)),p?(S={stroke:b,"stroke-width":i.width},i.dashStyle&&(S.dashstyle=i.dashStyle)):h&&(b&&(S.fill=b),i.borderWidth&&(S.stroke=i.borderColor,S["stroke-width"]=i.borderWidth)),x.zIndex=w,N+="-"+w,C=t.plotLinesAndBandsGroups[N],C||(t.plotLinesAndBandsGroups[N]=C=T.g("plot-"+N).attr(x).add()),v&&(e.svgElem=d=T.path().attr(S).add(C));if(p)m=t.getPlotLinePath(c,d.strokeWidth());else{if(!h)return;m=t.getPlotBandPath(l,f,i)}if(v&&m&&m.length){d.attr({d:m});if(E){g=function(t){d.on(t,function(n){E[t].apply(e,[n])})};for(y in E)g(y)}}else d&&(m?(d.show(),d.animate({d:m})):(d.hide(),o&&(e.label=o=o.destroy())));return s&&r(s.text)&&m&&m.length&&t.width>0&&t.height>0&&!m.flat?(s=u({align:n&&h&&"center",x:n?!h&&4:10,verticalAlign:!n&&h&&"middle",y:n?h?16:10:h?6:-4,rotation:n&&!h&&90},s),this.renderLabel(s,m,h,w)):o&&o.hide(),e},renderLabel:function(e,r,i,s){var o=this,u=o.label,a=o.axis.chart.renderer,f,l,c,h,p;u||(f={align:e.textAlign||e.align,rotation:e.rotation,"class":"highcharts-plot-"+(i?"band":"line")+"-label "+(e.className||"")},f.zIndex=s,o.label=u=a.text(e.text,0,0,e.useHTML).attr(f).add(),u.css(e.style)),l=[r[1],r[4],i?r[6]:r[1]],c=[r[2],r[5],i?r[7]:r[2]],h=n(l),p=n(c),u.align(e,!1,{x:h,y:p,width:t(l)-h,height:t(c)-p}),u.show()},destroy:function(){o(this.axis.plotLinesAndBands,this),delete this.axis,i(this)}},e.AxisPlotLineOrBandExtension={getPlotBandPath:function(e,t){var n=this.getPlotLinePath(t,null,null,!0),r=this.getPlotLinePath(e,null,null,!0),i=this.horiz,s=1,o=e<this.min&&t<this.min||e>this.max&&t>this.max;return r&&n?(o&&(r.flat=r.toString()===n.toString(),s=0),r.push(i&&n[4]===r[4]?n[4]+s:n[4],!i&&n[5]===r[5]?n[5]+s:n[5],i&&n[1]===r[1]?n[1]+s:n[1],!i&&n[2]===r[2]?n[2]+s:n[2])):r=null,r},addPlotBand:function(e){return this.addPlotBandOrLine(e,"plotBands")},addPlotLine:function(e){return this.addPlotBandOrLine(e,"plotLines")},addPlotBandOrLine:function(t,n){var r=(new e.PlotLineOrBand(this,t)).render(),i=this.userOptions;return r&&(n&&(i[n]=i[n]||[],i[n].push(t)),this.plotLinesAndBands.push(r)),r},removePlotBandOrLine:function(e){var t=this.plotLinesAndBands,n=this.options,r=this.userOptions,i=t.length;while(i--)t[i].id===e&&t[i].destroy();s([n.plotLines||[],r.plotLines||[],n.plotBands||[],r.plotBands||[]],function(t){i=t.length;while(i--)t[i].id===e&&o(t,t[i])})}}}(t),function(e){var t=e.correctFloat,n=e.defined,r=e.destroyObjectProperties,i=e.isNumber,s=e.merge,o=e.pick,u=e.deg2rad;e.Tick=function(e,t,n,r){this.axis=e,this.pos=t,this.type=n||"",this.isNew=!0,!n&&!r&&this.addLabel()},e.Tick.prototype={addLabel:function(){var e=this,r=e.axis,i=r.options,u=r.chart,a=r.categories,f=r.names,l=e.pos,c=i.labels,h,p=r.tickPositions,d=l===p[0],v=l===p[p.length-1],m=a?o(a[l],f[l],l):l,g=e.label,y=p.info,b;r.isDatetimeAxis&&y&&(b=i.dateTimeLabelFormats[y.higherRanks[l]||y.unitName]),e.isFirst=d,e.isLast=v,h=r.labelFormatter.call({axis:r,chart:u,isFirst:d,isLast:v,dateTimeLabelFormat:b,value:r.isLog?t(r.lin2log(m)):m}),n(g)?g&&g.attr({text:h}):(e.label=g=n(h)&&c.enabled?u.renderer.text(h,0,0,c.useHTML).css(s(c.style)).add(r.labelGroup):null,e.labelLength=g&&g.getBBox().width,e.rotation=0)},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},handleOverflow:function(e){var t=this.axis,n=e.x,r=t.chart.chartWidth,i=t.chart.spacing,s=o(t.labelLeft,Math.min(t.pos,i[3])),a=o(t.labelRight,Math.max(t.pos+t.len,r-i[1])),f=this.label,l=this.rotation,c={left:0,center:.5,right:1}[t.labelAlign],h=f.getBBox().width,p=t.getSlotWidth(),d=p,v=c,m=1,g,y,b,w={};if(!l){g=n-c*h,y=n+(1-c)*h,g<s?d=e.x+d*(1-c)-s:y>a&&(d=a-e.x+d*c,m=-1),d=Math.min(p,d),d<p&&t.labelAlign==="center"&&(e.x+=m*(p-d-v*(p-Math.min(h,d))));if(h>d||t.autoRotation&&(f.styles||{}).width)b=d}else l<0&&n-c*h<s?b=Math.round(n/Math.cos(l*u)-s):l>0&&n+c*h>a&&(b=Math.round((r-n)/Math.cos(l*u)));b&&(w.width=b,(t.options.labels.style||{}).textOverflow||(w.textOverflow="ellipsis"),f.css(w))},getPosition:function(e,t,n,r){var i=this.axis,s=i.chart,o=r&&s.oldChartHeight||s.chartHeight;return{x:e?i.translate(t+n,null,null,r)+i.transB:i.left+i.offset+(i.opposite?(r&&s.oldChartWidth||s.chartWidth)-i.right-i.left:0),y:e?o-i.bottom+i.offset-(i.opposite?i.height:0):o-i.translate(t+n,null,null,r)-i.transB}},getLabelPosition:function(e,t,r,i,s,o,a,f){var l=this.axis,c=l.transA,h=l.reversed,p=l.staggerLines,d=l.tickRotCorr||{x:0,y:0},v=s.y,m;return n(v)||(l.side===0?v=r.rotation?-8:-r.getBBox().height:l.side===2?v=d.y+8:v=Math.cos(r.rotation*u)*(d.y-r.getBBox(!1,0).height/2)),e=e+s.x+d.x-(o&&i?o*c*(h?-1:1):0),t=t+v-(o&&!i?o*c*(h?1:-1):0),p&&(m=a/(f||1)%p,l.opposite&&(m=p-m-1),t+=m*(l.labelOffset/p)),{x:e,y:Math.round(t)}},getMarkPath:function(e,t,n,r,i,s){return s.crispLine(["M",e,t,"L",e+(i?0:-n),t+(i?n:0)],r)},renderGridLine:function(e,t,n){var r=this,i=r.axis,s=i.options,o=r.gridLine,u,a={},f=r.pos,l=r.type,c=i.tickmarkOffset,h=i.chart.renderer,p=l?l+"Grid":"grid",d=s[p+"LineWidth"],v=s[p+"LineColor"],m=s[p+"LineDashStyle"];o||(a.stroke=v,a["stroke-width"]=d,m&&(a.dashstyle=m),l||(a.zIndex=1),e&&(a.opacity=0),r.gridLine=o=h.path().attr(a).addClass("highcharts-"+(l?l+"-":"")+"grid-line").add(i.gridGroup)),!e&&o&&(u=i.getPlotLinePath(f+c,o.strokeWidth()*n,e,!0),u&&o[r.isNew?"attr":"animate"]({d:u,opacity:t}))},renderMark:function(e,t,n){var r=this,i=r.axis,s=i.options,u=i.chart.renderer,a=r.type,f=a?a+"Tick":"tick",l=i.tickSize(f),c=r.mark,h=!c,p=e.x,d=e.y,v=o(s[f+"Width"],!a&&i.isXAxis?1:0),m=s[f+"Color"];l&&(i.opposite&&(l[0]=-l[0]),h&&(r.mark=c=u.path().addClass("highcharts-"+(a?a+"-":"")+"tick").add(i.axisGroup),c.attr({stroke:m,"stroke-width":v})),c[h?"attr":"animate"]({d:r.getMarkPath(p,d,l[0],c.strokeWidth()*n,i.horiz,u),opacity:t}))},renderLabel:function(e,t,n,r){var s=this,u=s.axis,a=u.horiz,f=u.options,l=s.label,c=f.labels,h=c.step,p=u.tickmarkOffset,d=!0,v=e.x,m=e.y;l&&i(v)&&(l.xy=e=s.getLabelPosition(v,m,l,a,c,p,r,h),s.isFirst&&!s.isLast&&!o(f.showFirstLabel,1)||s.isLast&&!s.isFirst&&!o(f.showLastLabel,1)?d=!1:a&&!u.isRadial&&!c.step&&!c.rotation&&!t&&n!==0&&s.handleOverflow(e),h&&r%h&&(d=!1),d&&i(e.y)?(e.opacity=n,l[s.isNew?"attr":"animate"](e)):l.attr("y",-9999),s.isNew=!1)},render:function(e,t,n){var r=this,i=r.axis,s=i.horiz,u=r.pos,a=i.tickmarkOffset,f=r.getPosition(s,u,a,t),l=f.x,c=f.y,h=s&&l===i.pos+i.len||!s&&c===i.pos?-1:1;n=o(n,1),this.isActive=!0,this.renderGridLine(t,n,h),this.renderMark(f,n,h),this.renderLabel(f,t,n,e)},destroy:function(){r(this,this.axis)}}}(t),function(e){var t=e.addEvent,n=e.animObject,r=e.arrayMax,i=e.arrayMin,s=e.AxisPlotLineOrBandExtension,o=e.color,u=e.correctFloat,a=e.defaultOptions,f=e.defined,l=e.deg2rad,c=e.destroyObjectProperties,h=e.each,p=e.extend,d=e.fireEvent,v=e.format,m=e.getMagnitude,g=e.grep,y=e.inArray,b=e.isArray,w=e.isNumber,E=e.isString,S=e.merge,x=e.normalizeTickInterval,T=e.pick,N=e.PlotLineOrBand,C=e.removeEvent,k=e.splat,L=e.syncTimeout,A=e.Tick;e.Axis=function(){this.init.apply(this,arguments)},e.Axis.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,labels:{enabled:!0,style:{color:"#666666",cursor:"default",fontSize:"11px"},x:0},minPadding:.01,maxPadding:.01,minorTickLength:2,minorTickPosition:"outside",startOfWeek:1,startOnTick:!1,tickLength:10,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",title:{align:"middle",style:{color:"#666666"}},type:"linear",minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#ccd6eb",lineWidth:1,gridLineColor:"#e6e6e6",tickColor:"#ccd6eb"},defaultYAxisOptions:{endOnTick:!0,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8},maxPadding:.05,minPadding:.05,startOnTick:!0,title:{rotation:270,text:"Values"},stackLabels:{enabled:!1,formatter:function(){return e.numberFormat(this.total,-1)},style:{fontSize:"11px",fontWeight:"bold",color:"#000000",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0},defaultLeftAxisOptions:{labels:{x:-15},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:15},title:{rotation:90}},defaultBottomAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},defaultTopAxisOptions:{labels:{autoRotation:[-45],x:0},title:{rotation:0}},init:function(e,n){var r=n.isX,i=this;i.chart=e,i.horiz=e.inverted?!r:r,i.isXAxis=r,i.coll=i.coll||(r?"xAxis":"yAxis"),i.opposite=n.opposite,i.side=n.side||(i.horiz?i.opposite?0:2:i.opposite?1:3),i.setOptions(n);var s=this.options,o=s.type,u=o==="datetime";i.labelFormatter=s.labels.formatter||i.defaultLabelFormatter,i.userOptions=n,i.minPixelPadding=0,i.reversed=s.reversed,i.visible=s.visible!==!1,i.zoomEnabled=s.zoomEnabled!==!1,i.hasNames=o==="category"||s.categories===!0,i.categories=s.categories||i.hasNames,i.names=i.names||[],i.plotLinesAndBandsGroups={},i.isLog=o==="logarithmic",i.isDatetimeAxis=u,i.positiveValuesOnly=i.isLog&&!i.allowNegativeLog,i.isLinked=f(s.linkedTo),i.ticks={},i.labelEdge=[],i.minorTicks={},i.plotLinesAndBands=[],i.alternateBands={},i.len=0,i.minRange=i.userMinRange=s.minRange||s.maxZoom,i.range=s.range,i.offset=s.offset||0,i.stacks={},i.oldStacks={},i.stacksTouched=0,i.max=null,i.min=null,i.crosshair=T(s.crosshair,k(e.options.tooltip.crosshairs)[r?0:1],!1);var a,l=i.options.events;y(i,e.axes)===-1&&(r?e.axes.splice(e.xAxis.length,0,i):e.axes.push(i),e[i.coll].push(i)),i.series=i.series||[],e.inverted&&r&&i.reversed===undefined&&(i.reversed=!0),i.removePlotBand=i.removePlotBandOrLine,i.removePlotLine=i.removePlotBandOrLine;for(a in l)t(i,a,l[a]);i.lin2log=s.linearToLogConverter||i.lin2log,i.isLog&&(i.val2lin=i.log2lin,i.lin2val=i.lin2log)},setOptions:function(e){this.options=S(this.defaultOptions,this.coll==="yAxis"&&this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],S(a[this.coll],e))},defaultLabelFormatter:function(){var t=this.axis,n=this.value,r=t.categories,i=this.dateTimeLabelFormat,s=a.lang,o=s.numericSymbols,u=s.numericSymbolMagnitude||1e3,f=o&&o.length,l,c,h=t.options.labels.format,p=t.isLog?Math.abs(n):t.tickInterval;if(h)c=v(h,this);else if(r)c=n;else if(i)c=e.dateFormat(i,n);else if(f&&p>=1e3)while(f--&&c===undefined)l=Math.pow(u,f+1),p>=l&&n*10%l===0&&o[f]!==null&&n!==0&&(c=e.numberFormat(n/l,-1)+o[f]);return c===undefined&&(Math.abs(n)>=1e4?c=e.numberFormat(n,-1):c=e.numberFormat(n,-1,undefined,"")),c},getSeriesExtremes:function(){var e=this,t=e.chart;e.hasVisibleSeries=!1,e.dataMin=e.dataMax=e.threshold=null,e.softThreshold=!e.isXAxis,e.buildStacks&&e.buildStacks(),h(e.series,function(n){if(n.visible||!t.options.chart.ignoreHiddenSeries){var s=n.options,o,u=s.threshold,a,l;e.hasVisibleSeries=!0,e.positiveValuesOnly&&u<=0&&(u=null);if(e.isXAxis)o=n.xData,o.length&&(a=i(o),!w(a)&&!(a instanceof Date)&&(o=g(o,function(e){return w(e)}),a=i(o)),e.dataMin=Math.min(T(e.dataMin,o[0]),a),e.dataMax=Math.max(T(e.dataMax,o[0]),r(o)));else{n.getExtremes(),l=n.dataMax,a=n.dataMin,f(a)&&f(l)&&(e.dataMin=Math.min(T(e.dataMin,a),a),e.dataMax=Math.max(T(e.dataMax,l),l)),f(u)&&(e.threshold=u);if(!s.softThreshold||e.positiveValuesOnly)e.softThreshold=!1}}})},translate:function(e,t,n,r,i,s){var o=this.linkedParent||this,u=1,a=0,f=r?o.oldTransA:o.transA,l=r?o.oldMin:o.min,c,h=o.minPixelPadding,p=(o.isOrdinal||o.isBroken||o.isLog&&i)&&o.lin2val;return f||(f=o.transA),n&&(u*=-1,a=o.len),o.reversed&&(u*=-1,a-=u*(o.sector||o.len)),t?(e=e*u+a,e-=h,c=e/f+l,p&&(c=o.lin2val(c))):(p&&(e=o.val2lin(e)),c=u*(e-l)*f+a+u*h+(w(s)?f*s:0)),c},toPixels:function(e,t){return this.translate(e,!1,!this.horiz,null,!0)+(t?0:this.pos)},toValue:function(e,t){return this.translate(e-(t?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(e,t,n,r,i){var s=this,o=s.chart,u=s.left,a=s.top,f,l,c,h,p=n&&o.oldChartHeight||o.chartHeight,d=n&&o.oldChartWidth||o.chartWidth,v,m=s.transB,g=function(e,t,n){if(e<t||e>n)r?e=Math.min(Math.max(t,e),n):v=!0;return e};return i=T(i,s.translate(e,null,null,n)),f=c=Math.round(i+m),l=h=Math.round(p-i-m),w(i)?s.horiz?(l=a,h=p-s.bottom,f=c=g(f,u,u+s.width)):(f=u,c=d-s.right,l=h=g(l,a,a+s.height)):v=!0,v&&!r?null:o.renderer.crispLine(["M",f,l,"L",c,h],t||1)},getLinearTickPositions:function(e,t,n){var r,i,s=u(Math.floor(t/e)*e),o=u(Math.ceil(n/e)*e),a=[];if(this.single)return[t];r=s;while(r<=o){a.push(r),r=u(r+e);if(r===i)break;i=r}return a},getMinorTickPositions:function(){var e=this,t=e.options,n=e.tickPositions,r=e.minorTickInterval,i=[],s,o=e.pointRangePadding||0,u=e.min-o,a=e.max+o,f=a-u;if(f&&f/r<e.len/3)if(e.isLog)h(this.paddedTicks,function(t,n,s){n&&i.push.apply(i,e.getLogTickPositions(r,s[n-1],s[n],!0))});else if(e.isDatetimeAxis&&t.minorTickInterval==="auto")i=i.concat(e.getTimeTicks(e.normalizeTimeTickInterval(r),u,a,t.startOfWeek));else for(s=u+(n[0]-u)%r;s<=a;s+=r){if(s===i[0])break;i.push(s)}return i.length!==0&&e.trimTicks(i),i},adjustForMinRange:function(){var e=this,t=e.options,n=e.min,s=e.max,o,u=e.dataMax-e.dataMin>=e.minRange,a,l,c,p,d,v,m,g;e.isXAxis&&e.minRange===undefined&&!e.isLog&&(f(t.min)||f(t.max)?e.minRange=null:(h(e.series,function(e){p=e.xData,d=e.xIncrement?1:p.length-1;for(l=d;l>0;l--){c=p[l]-p[l-1];if(a===undefined||c<a)a=c}}),e.minRange=Math.min(a*5,e.dataMax-e.dataMin))),s-n<e.minRange&&(g=e.minRange,o=(g-s+n)/2,v=[n-o,T(t.min,n-o)],u&&(v[2]=e.isLog?e.log2lin(e.dataMin):e.dataMin),n=r(v),m=[n+g,T(t.max,n+g)],u&&(m[2]=e.isLog?e.log2lin(e.dataMax):e.dataMax),s=i(m),s-n<g&&(v[0]=s-g,v[1]=T(t.min,s-g),n=r(v))),e.min=n,e.max=s},getClosest:function(){var e;return this.categories?e=1:h(this.series,function(t){var n=t.closestPointRange,r=t.visible||!t.chart.options.chart.ignoreHiddenSeries;!t.noSharedTooltip&&f(n)&&r&&(e=f(e)?Math.min(e,n):n)}),e},nameToX:function(e){var t=b(this.categories),n=t?this.categories:this.names,r=e.options.x,i;return e.series.requireSorting=!1,f(r)||(r=this.options.uniqueNames===!1?e.series.autoIncrement():y(e.name,n)),r===-1?t||(i=n.length):i=r,i!==undefined&&(this.names[i]=e.name),i},updateNames:function(){var e=this;this.names.length>0&&(this.names.length=0,this.minRange=undefined,h(this.series||[],function(t){t.xIncrement=null;if(!t.points||t.isDirtyData)t.processData(),t.generatePoints();h(t.points,function(n,r){var i;n.options&&(i=e.nameToX(n),i!==undefined&&i!==n.x&&(n.x=i,t.xData[r]=i))})}))},setAxisTranslation:function(e){var t=this,n=t.max-t.min,r=t.axisPointRange||0,i,s=0,o=0,u=t.linkedParent,a,f=!!t.categories,l=t.transA,c=t.isXAxis;if(c||f||r)i=t.getClosest(),u?(s=u.minPointOffset,o=u.pointRangePadding):h(t.series,function(e){var n=f?1:c?T(e.options.pointRange,i,0):t.axisPointRange||0,u=e.options.pointPlacement;r=Math.max(r,n),t.single||(s=Math.max(s,E(u)?0:n/2),o=Math.max(o,u==="on"?0:n))}),a=t.ordinalSlope&&i?t.ordinalSlope/i:1,t.minPointOffset=s*=a,t.pointRangePadding=o*=a,t.pointRange=Math.min(r,n),c&&(t.closestPointRange=i);e&&(t.oldTransA=l),t.translationSlope=t.transA=l=t.options.staticScale||t.len/(n+o||1),t.transB=t.horiz?t.left:t.bottom,t.minPixelPadding=l*s},minFromRange:function(){return this.max-this.range},setTickInterval:function(t){var n=this,r=n.chart,i=n.options,s=n.isLog,o=n.log2lin,a=n.isDatetimeAxis,l=n.isXAxis,c=n.isLinked,p=i.maxPadding,v=i.minPadding,g,y,b=i.tickInterval,E,S=i.tickPixelInterval,N=n.categories,C=n.threshold,k=n.softThreshold,L,A,O,M;!a&&!N&&!c&&this.getTickAmount(),O=T(n.userMin,i.min),M=T(n.userMax,i.max),c?(n.linkedParent=r[n.coll][i.linkedTo],y=n.linkedParent.getExtremes(),n.min=T(y.min,y.dataMin),n.max=T(y.max,y.dataMax),i.type!==n.linkedParent.options.type&&e.error(11,1)):(!k&&f(C)&&(n.dataMin>=C?(L=C,v=0):n.dataMax<=C&&(A=C,p=0)),n.min=T(O,L,n.dataMin),n.max=T(M,A,n.dataMax)),s&&(n.positiveValuesOnly&&!t&&Math.min(n.min,T(n.dataMin,n.min))<=0&&e.error(10,1),n.min=u(o(n.min),15),n.max=u(o(n.max),15)),n.range&&f(n.max)&&(n.userMin=n.min=O=Math.max(n.min,n.minFromRange()),n.userMax=M=n.max,n.range=null),d(n,"foundExtremes"),n.beforePadding&&n.beforePadding(),n.adjustForMinRange(),!N&&!n.axisPointRange&&!n.usePercentage&&!c&&f(n.min)&&f(n.max)&&(g=n.max-n.min,g&&(!f(O)&&v&&(n.min-=g*v),!f(M)&&p&&(n.max+=g*p))),w(i.softMin)&&(n.min=Math.min(n.min,i.softMin)),w(i.softMax)&&(n.max=Math.max(n.max,i.softMax)),w(i.floor)&&(n.min=Math.max(n.min,i.floor)),w(i.ceiling)&&(n.max=Math.min(n.max,i.ceiling)),k&&f(n.dataMin)&&(C=C||0,!f(O)&&n.min<C&&n.dataMin>=C?n.min=C:!f(M)&&n.max>C&&n.dataMax<=C&&(n.max=C)),n.min===n.max||n.min===undefined||n.max===undefined?n.tickInterval=1:c&&!b&&S===n.linkedParent.options.tickPixelInterval?n.tickInterval=b=n.linkedParent.tickInterval:n.tickInterval=T(b,this.tickAmount?(n.max-n.min)/Math.max(this.tickAmount-1,1):undefined,N?1:(n.max-n.min)*S/Math.max(n.len,S)),l&&!t&&h(n.series,function(e){e.processData(n.min!==n.oldMin||n.max!==n.oldMax)}),n.setAxisTranslation(!0),n.beforeSetTickPositions&&n.beforeSetTickPositions(),n.postProcessTickInterval&&(n.tickInterval=n.postProcessTickInterval(n.tickInterval)),n.pointRange&&!b&&(n.tickInterval=Math.max(n.pointRange,n.tickInterval)),E=T(i.minTickInterval,n.isDatetimeAxis&&n.closestPointRange),!b&&n.tickInterval<E&&(n.tickInterval=E),!a&&!s&&!b&&(n.tickInterval=x(n.tickInterval,null,m(n.tickInterval),T(i.allowDecimals,!(n.tickInterval>.5&&n.tickInterval<5&&n.max>1e3&&n.max<9999)),!!this.tickAmount)),this.tickAmount||(n.tickInterval=n.unsquish()),this.setTickPositions()},setTickPositions:function(){var e=this.options,t,n=e.tickPositions,r=e.tickPositioner,i=e.startOnTick,s=e.endOnTick;this.tickmarkOffset=this.categories&&e.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.minorTickInterval=e.minorTickInterval==="auto"&&this.tickInterval?this.tickInterval/5:e.minorTickInterval,this.single=this.min===this.max&&f(this.min)&&!this.tickAmount&&e.allowDecimals!==!1,this.tickPositions=t=n&&n.slice(),t||(this.isDatetimeAxis?t=this.getTimeTicks(this.normalizeTimeTickInterval(this.tickInterval,e.units),this.min,this.max,e.startOfWeek,this.ordinalPositions,this.closestPointRange,!0):this.isLog?t=this.getLogTickPositions(this.tickInterval,this.min,this.max):t=this.getLinearTickPositions(this.tickInterval,this.min,this.max),t.length>this.len&&(t=[t[0],t.pop()]),this.tickPositions=t,r&&(r=r.apply(this,[this.min,this.max]),r&&(this.tickPositions=t=r))),this.paddedTicks=t.slice(0),this.trimTicks(t,i,s),this.isLinked||(this.single&&(this.min-=.5,this.max+=.5),!n&&!r&&this.adjustTickAmount())},trimTicks:function(e,t,n){var r=e[0],i=e[e.length-1],s=this.minPointOffset||0;if(!this.isLinked){if(t&&r!==-Infinity)this.min=r;else while(this.min-s>e[0])e.shift();if(n)this.max=i;else while(this.max+s<e[e.length-1])e.pop();e.length===0&&f(r)&&e.push((i+r)/2)}},alignToOthers:function(){var e={},t,n=this.options;return this.chart.options.chart.alignTicks!==!1&&n.alignTicks!==!1&&!this.isLog&&h(this.chart[this.coll],function(n){var r=n.options,i=n.horiz,s=[i?r.left:r.top,r.width,r.height,r.pane].join(",");n.series.length&&(e[s]?t=!0:e[s]=1)}),t},getTickAmount:function(){var e=this.options,t=e.tickAmount,n=e.tickPixelInterval;!f(e.tickInterval)&&this.len<n&&!this.isRadial&&!this.isLog&&e.startOnTick&&e.endOnTick&&(t=2),!t&&this.alignToOthers()&&(t=Math.ceil(this.len/n)+1),t<4&&(this.finalTickAmt=t,t=5),this.tickAmount=t},adjustTickAmount:function(){var e=this.tickInterval,t=this.tickPositions,n=this.tickAmount,r=this.finalTickAmt,i=t&&t.length,s,o;if(i<n){while(t.length<n)t.push(u(t[t.length-1]+e));this.transA*=(i-1)/(n-1),this.max=t[t.length-1]}else i>n&&(this.tickInterval*=2,this.setTickPositions());if(f(r)){s=o=t.length;while(s--)(r===3&&s%2===1||r<=2&&s>0&&s<o-1)&&t.splice(s,1);this.finalTickAmt=undefined}},setScale:function(){var e=this,t,n;e.oldMin=e.min,e.oldMax=e.max,e.oldAxisLength=e.len,e.setAxisSize(),n=e.len!==e.oldAxisLength,h(e.series,function(e){if(e.isDirtyData||e.isDirty||e.xAxis.isDirty)t=!0}),n||t||e.isLinked||e.forceRedraw||e.userMin!==e.oldUserMin||e.userMax!==e.oldUserMax||e.alignToOthers()?(e.resetStacks&&e.resetStacks(),e.forceRedraw=!1,e.getSeriesExtremes(),e.setTickInterval(),e.oldUserMin=e.userMin,e.oldUserMax=e.userMax,e.isDirty||(e.isDirty=n||e.min!==e.oldMin||e.max!==e.oldMax)):e.cleanStacks&&e.cleanStacks()},setExtremes:function(e,t,n,r,i){var s=this,o=s.chart;n=T(n,!0),h(s.series,function(e){delete e.kdTree}),i=p(i,{min:e,max:t}),d(s,"setExtremes",i,function(){s.userMin=e,s.userMax=t,s.eventArgs=i,n&&o.redraw(r)})},zoom:function(e,t){var n=this.dataMin,r=this.dataMax,i=this.options,s=Math.min(n,T(i.min,n)),o=Math.max(r,T(i.max,r));if(e!==this.min||t!==this.max)this.allowZoomOutside||(f(n)&&(e<s&&(e=s),e>o&&(e=o)),f(r)&&(t<s&&(t=s),t>o&&(t=o))),this.displayBtn=e!==undefined||t!==undefined,this.setExtremes(e,t,!1,undefined,{trigger:"zoom"});return!0},setAxisSize:function(){var e=this.chart,t=this.options,n=t.offsets||[0,0,0,0],r=this.horiz,i=T(t.width,e.plotWidth-n[3]+n[1]),s=T(t.height,e.plotHeight-n[0]+n[2]),o=T(t.top,e.plotTop+n[0]),u=T(t.left,e.plotLeft+n[3]),a=/%$/;a.test(s)&&(s=Math.round(parseFloat(s)/100*e.plotHeight)),a.test(o)&&(o=Math.round(parseFloat(o)/100*e.plotHeight+e.plotTop)),this.left=u,this.top=o,this.width=i,this.height=s,this.bottom=e.chartHeight-s-o,this.right=e.chartWidth-i-u,this.len=Math.max(r?i:s,0),this.pos=r?u:o},getExtremes:function(){var e=this,t=e.isLog,n=e.lin2log;return{min:t?u(n(e.min)):e.min,max:t?u(n(e.max)):e.max,dataMin:e.dataMin,dataMax:e.dataMax,userMin:e.userMin,userMax:e.userMax}},getThreshold:function(e){var t=this,n=t.isLog,r=t.lin2log,i=n?r(t.min):t.min,s=n?r(t.max):t.max;return e===null?e=i:i>e?e=i:s<e&&(e=s),t.translate(e,0,1,0,1)},autoLabelAlign:function(e){var t,n=(T(e,0)-this.side*90+720)%360;return n>15&&n<165?t="right":n>195&&n<345?t="left":t="center",t},tickSize:function(e){var t=this.options,n=t[e+"Length"],r=T(t[e+"Width"],e==="tick"&&this.isXAxis?1:0);if(r&&n)return t[e+"Position"]==="inside"&&(n=-n),[n,r]},labelMetrics:function(){return this.chart.renderer.fontMetrics(this.options.labels.style&&this.options.labels.style.fontSize,this.ticks[0]&&this.ticks[0].label)},unsquish:function(){var e=this.options.labels,t=this.horiz,n=this.tickInterval,r=n,i=this.len/(((this.categories?1:0)+this.max-this.min)/n),s,o=e.rotation,u=this.labelMetrics(),a,c=Number.MAX_VALUE,p,d=function(e){var t=e/(i||1);return t=t>1?Math.ceil(t):1,t*n};return t?(p=!e.staggerLines&&!e.step&&(f(o)?[o]:i<T(e.autoRotationLimit,80)&&e.autoRotation),p&&h(p,function(e){var t;if(e===o||e&&e>=-90&&e<=90)a=d(Math.abs(u.h/Math.sin(l*e))),t=a+Math.abs(e/360),t<c&&(c=t,s=e,r=a)})):e.step||(r=d(u.h)),this.autoRotation=p,this.labelRotation=T(s,o),r},getSlotWidth:function(){var e=this.chart,t=this.horiz,n=this.options.labels,r=Math.max(this.tickPositions.length-(this.categories?0:1),1),i=e.margin[3];return t&&(n.step||0)<2&&!n.rotation&&(this.staggerLines||1)*this.len/r||!t&&(i&&i-e.spacing[3]||e.chartWidth*.33)},renderUnsquish:function(){var e=this.chart,t=e.renderer,n=this.tickPositions,r=this.ticks,i=this.options.labels,s=this.horiz,o=this.getSlotWidth(),u=Math.max(1,Math.round(o-2*(i.padding||5))),a={},f=this.labelMetrics(),l=i.style&&i.style.textOverflow,c,p=0,d,v,m;E(i.rotation)||(a.rotation=i.rotation||0),h(n,function(e){e=r[e],e&&e.labelLength>p&&(p=e.labelLength)}),this.maxLabelLength=p;if(this.autoRotation)p>u&&p>f.h?a.rotation=this.labelRotation:this.labelRotation=0;else if(o){c={width:u+"px"};if(!l){c.textOverflow="clip",v=n.length;while(!s&&v--)m=n[v],d=r[m].label,d&&(d.styles&&d.styles.textOverflow==="ellipsis"?d.css({textOverflow:"clip"}):r[m].labelLength>o&&d.css({width:o+"px"}),d.getBBox().height>this.len/n.length-(f.h-f.f)&&(d.specCss={textOverflow:"ellipsis"}))}}a.rotation&&(c={width:(p>e.chartHeight*.5?e.chartHeight*.33:e.chartHeight)+"px"},l||(c.textOverflow="ellipsis")),this.labelAlign=i.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(a.align=this.labelAlign),h(n,function(e){var t=r[e],n=t&&t.label;n&&(n.attr(a),c&&n.css(S(c,n.specCss)),delete n.specCss,t.rotation=a.rotation)}),this.tickRotCorr=t.rotCorr(f.b,this.labelRotation||0,this.side!==0)},hasData:function(){return this.hasVisibleSeries||f(this.min)&&f(this.max)&&!!this.tickPositions},addTitle:function(e){var t=this,n=t.chart.renderer,r=t.horiz,i=t.opposite,s=t.options,o=s.title,u;t.axisTitle||(u=o.textAlign,u||(u=(r?{low:"left",middle:"center",high:"right"}:{low:i?"right":"left",middle:"center",high:i?"left":"right"})[o.align]),t.axisTitle=n.text(o.text,0,0,o.useHTML).attr({zIndex:7,rotation:o.rotation||0,align:u}).addClass("highcharts-axis-title").css(o.style).add(t.axisGroup),t.axisTitle.isNew=!0),t.axisTitle[e?"show":"hide"](!0)},generateTick:function(e){var t=this.ticks;t[e]?t[e].addLabel():t[e]=new A(this,e)},getOffset:function(){var e=this,t=e.chart,n=t.renderer,r=e.options,i=e.tickPositions,s=e.ticks,o=e.horiz,u=e.side,a=t.inverted?[1,0,3,2][u]:u,l,c,p=0,d,v=0,m=r.title,g=r.labels,y=0,b,w=t.axisOffset,E=t.clipOffset,S,x=[-1,1,1,-1][u],N,C=r.className,k=e.axisParent,L,A=this.tickSize("tick");l=e.hasData(),e.showAxis=c=l||T(r.showEmpty,!0),e.staggerLines=e.horiz&&g.staggerLines,e.axisGroup||(e.gridGroup=n.g("grid").attr({zIndex:r.gridZIndex||1}).addClass("highcharts-"+this.coll.toLowerCase()+"-grid "+(C||"")).add(k),e.axisGroup=n.g("axis").attr({zIndex:r.zIndex||2}).addClass("highcharts-"+this.coll.toLowerCase()+" "+(C||"")).add(k),e.labelGroup=n.g("axis-labels").attr({zIndex:g.zIndex||7}).addClass("highcharts-"+e.coll.toLowerCase()+"-labels "+(C||"")).add(k));if(l||e.isLinked)h(i,function(t,n){e.generateTick(t,n)}),e.renderUnsquish(),g.reserveSpace!==!1&&(u===0||u===2||{1:"left",3:"right"}[u]===e.labelAlign||e.labelAlign==="center")&&h(i,function(e){y=Math.max(s[e].getLabelSize(),y)}),e.staggerLines&&(y*=e.staggerLines,e.labelOffset=y*(e.opposite?-1:1));else for(N in s)s[N].destroy(),delete s[N];m&&m.text&&m.enabled!==!1&&(e.addTitle(c),c&&(p=e.axisTitle.getBBox()[o?"height":"width"],d=m.offset,v=f(d)?0:T(m.margin,o?5:10))),e.renderLine(),e.offset=x*T(r.offset,w[u]),e.tickRotCorr=e.tickRotCorr||{x:0,y:0},u===0?L=-e.labelMetrics().h:u===2?L=e.tickRotCorr.y:L=0,b=Math.abs(y)+v,y&&(b-=L,b+=x*(o?T(g.y,e.tickRotCorr.y+x*8):g.x)),e.axisTitleMargin=T(d,b),w[u]=Math.max(w[u],e.axisTitleMargin+p+x*e.offset,b,l&&i.length&&A?A[0]+x*e.offset:0),S=r.offset?0:Math.floor(e.axisLine.strokeWidth()/2)*2,E[a]=Math.max(E[a],S)},getLinePath:function(e){var t=this.chart,n=this.opposite,r=this.offset,i=this.horiz,s=this.left+(n?this.width:0)+r,o=t.chartHeight-this.bottom-(n?this.height:0)+r;return n&&(e*=-1),t.renderer.crispLine(["M",i?this.left:s,i?o:this.top,"L",i?t.chartWidth-this.right:s,i?o:t.chartHeight-this.bottom],e)},renderLine:function(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))},getTitlePosition:function(){var e=this.horiz,t=this.left,n=this.top,r=this.len,i=this.options.title,s=e?t:n,o=this.opposite,u=this.offset,a=i.x||0,f=i.y||0,l=this.chart.renderer.fontMetrics(i.style&&i.style.fontSize,this.axisTitle).f,c={low:s+(e?0:r),middle:s+r/2,high:s+(e?r:0)}[i.align],h=(e?n+this.height:t)+(e?1:-1)*(o?-1:1)*this.axisTitleMargin+(this.side===2?l:0);return{x:e?c+a:h+(o?this.width:0)+u+a,y:e?h+f-(o?this.height:0)+u:c+f}},renderMinorTick:function(e){var t=this.chart.hasRendered&&w(this.oldMin),n=this.minorTicks;n[e]||(n[e]=new A(this,e,"minor")),t&&n[e].isNew&&n[e].render(null,!0),n[e].render(null,!1,1)},renderTick:function(e,t){var n=this.isLinked,r=this.ticks,i=this.chart.hasRendered&&w(this.oldMin);if(!n||e>=this.min&&e<=this.max)r[e]||(r[e]=new A(this,e)),i&&r[e].isNew&&r[e].render(t,!0,.1),r[e].render(t)},render:function(){var e=this,t=e.chart,r=t.renderer,i=e.options,s=e.isLog,o=e.lin2log,u=e.isLinked,a=e.tickPositions,f=e.axisTitle,l=e.ticks,c=e.minorTicks,p=e.alternateBands,d=i.stackLabels,v=i.alternateGridColor,m=e.tickmarkOffset,g=e.axisLine,y=e.showAxis,b=n(r.globalAnimation),w,E;e.labelEdge.length=0,e.overlap=!1,h([l,c,p],function(e){var t;for(t in e)e[t].isActive=!1});if(e.hasData()||u)e.minorTickInterval&&!e.categories&&h(e.getMinorTickPositions(),function(t){e.renderMinorTick(t)}),a.length&&(h(a,function(t,n){e.renderTick(t,n)}),m&&(e.min===0||e.single)&&(l[-1]||(l[-1]=new A(e,-1,null,!0)),l[-1].render(-1))),v&&h(a,function(n,r){E=a[r+1]!==undefined?a[r+1]+m:e.max-m,r%2===0&&n<e.max&&E<=e.max+(t.polar?-m:m)&&(p[n]||(p[n]=new N(e)),w=n+m,p[n].options={from:s?o(w):w,to:s?o(E):E,color:v},p[n].render(),p[n].isActive=!0)}),e._addedPlotLB||(h((i.plotLines||[]).concat(i.plotBands||[]),function(t){e.addPlotBandOrLine(t)}),e._addedPlotLB=!0);h([l,c,p],function(e){var n,r,i=[],s=b.duration,o=function(){r=i.length;while(r--)e[i[r]]&&!e[i[r]].isActive&&(e[i[r]].destroy(),delete e[i[r]])};for(n in e)e[n].isActive||(e[n].render(n,!1,0),e[n].isActive=!1,i.push(n));L(o,e===p||!t.hasRendered||!s?0:s)}),g&&(g[g.isPlaced?"animate":"attr"]({d:this.getLinePath(g.strokeWidth())}),g.isPlaced=!0,g[y?"show":"hide"](!0)),f&&y&&(f[f.isNew?"attr":"animate"](e.getTitlePosition()),f.isNew=!1),d&&d.enabled&&e.renderStackTotals(),e.isDirty=!1},redraw:function(){this.visible&&(this.render(),h(this.plotLinesAndBands,function(e){e.render()})),h(this.series,function(e){e.isDirty=!0})},keepProps:["extKey","hcEvents","names","series","userMax","userMin"],destroy:function(e){var t=this,n=t.stacks,r,i=t.plotLinesAndBands,s,o,u;e||C(t);for(r in n)c(n[r]),n[r]=null;h([t.ticks,t.minorTicks,t.alternateBands],function(e){c(e)});if(i){o=i.length;while(o--)i[o].destroy()}h(["stackTotalGroup","axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross"],function(e){t[e]&&(t[e]=t[e].destroy())});for(s in t.plotLinesAndBandsGroups)t.plotLinesAndBandsGroups[s]=t.plotLinesAndBandsGroups[s].destroy();for(u in t)t.hasOwnProperty(u)&&y(u,t.keepProps)===-1&&delete t[u]},drawCrosshair:function(e,t){var n,r=this.crosshair,i=T(r.snap,!0),s,u,a=this.cross;e||(e=this.cross&&this.cross.e);if(!this.crosshair||(f(t)||!i)===!1)this.hideCrosshair();else{i?f(t)&&(s=this.isXAxis?t.plotX:this.len-t.plotY):s=e&&(this.horiz?e.chartX-this.pos:this.len-e.chartY+this.pos),f(s)&&(n=this.getPlotLinePath(t&&(this.isXAxis?t.x:T(t.stackY,t.y)),null,null,null,s)||null);if(!f(n)){this.hideCrosshair();return}u=this.categories&&!this.isRadial,a||(this.cross=a=this.chart.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(u?"category ":"thin ")+r.className).attr({zIndex:T(r.zIndex,2)}).add(),a.attr({stroke:r.color||(u?o("#ccd6eb").setOpacity(.25).get():"#cccccc"),"stroke-width":T(r.width,1)}),r.dashStyle&&a.attr({dashstyle:r.dashStyle})),a.show().attr({d:n}),u&&!r.width&&a.attr({"stroke-width":this.transA}),this.cross.e=e}},hideCrosshair:function(){this.cross&&this.cross.hide()}},p(e.Axis.prototype,s)}(t),function(e){var t=e.Axis,n=e.Date,r=e.dateFormat,i=e.defaultOptions,s=e.defined,o=e.each,u=e.extend,a=e.getMagnitude,f=e.getTZOffset,l=e.normalizeTickInterval,c=e.pick,h=e.timeUnits;t.prototype.getTimeTicks=function(e,t,a,l){var p=[],d,v={},m=i.global.useUTC,g,y=new n(t-Math.abs(f(t))),b=n.hcMakeTime,w=e.unitRange,E=e.count,S;if(s(t)){y[n.hcSetMilliseconds](w>=h.second?0:E*Math.floor(y.getMilliseconds()/E)),w>=h.second&&y[n.hcSetSeconds](w>=h.minute?0:E*Math.floor(y.getSeconds()/E)),w>=h.minute&&y[n.hcSetMinutes](w>=h.hour?0:E*Math.floor(y[n.hcGetMinutes]()/E)),w>=h.hour&&y[n.hcSetHours](w>=h.day?0:E*Math.floor(y[n.hcGetHours]()/E)),w>=h.day&&y[n.hcSetDate](w>=h.month?1:E*Math.floor(y[n.hcGetDate]()/E)),w>=h.month&&(y[n.hcSetMonth](w>=h.year?0:E*Math.floor(y[n.hcGetMonth]()/E)),g=y[n.hcGetFullYear]()),w>=h.year&&(g-=g%E,y[n.hcSetFullYear](g)),w===h.week&&y[n.hcSetDate](y[n.hcGetDate]()-y[n.hcGetDay]()+c(l,1)),g=y[n.hcGetFullYear]();var x=y[n.hcGetMonth](),T=y[n.hcGetDate](),N=y[n.hcGetHours]();if(n.hcTimezoneOffset||n.hcGetTimezoneOffset)S=(!m||!!n.hcGetTimezoneOffset)&&(a-t>4*h.month||f(t)!==f(a)),y=y.getTime(),y=new n(y+f(y));var C=y.getTime();d=1;while(C<a)p.push(C),w===h.year?C=b(g+d*E,0):w===h.month?C=b(g,x+d*E):!S||w!==h.day&&w!==h.week?S&&w===h.hour?C=b(g,x,T,N+d*E):C+=w*E:C=b(g,x,T+d*E*(w===h.day?1:7)),d++;p.push(C),w<=h.hour&&p.length<1e4&&o(p,function(e){e%18e5===0&&r("%H%M%S%L",e)==="000000000"&&(v[e]="day")})}return p.info=u(e,{higherRanks:v,totalRange:w*E}),p},t.prototype.normalizeTimeTickInterval=function(e,t){var n=t||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],r=n[n.length-1],i=h[r[0]],s=r[1],o,u;for(u=0;u<n.length;u++){r=n[u],i=h[r[0]],s=r[1];if(n[u+1]){var f=(i*s[s.length-1]+h[n[u+1][0]])/2;if(e<=f)break}}return i===h.year&&e<5*i&&(s=[1,2,5]),o=l(e/i,s,r[0]==="year"?Math.max(a(e/i),1):1),{unitRange:i,count:o,unitName:r[0]}}}(t),function(e){var t=e.Axis,n=e.getMagnitude,r=e.map,i=e.normalizeTickInterval,s=e.pick;t.prototype.getLogTickPositions=function(e,t,o,u){var a=this,f=a.options,l=a.len,c=a.lin2log,h=a.log2lin,p=[];u||(a._minorAutoInterval=null);if(e>=.5)e=Math.round(e),p=a.getLinearTickPositions(e,t,o);else if(e>=.08){var d=Math.floor(t),v,m,g,y,b,w,E;e>.3?v=[1,2,4]:e>.15?v=[1,2,4,6,8]:v=[1,2,3,4,5,6,7,8,9];for(m=d;m<o+1&&!E;m++){y=v.length;for(g=0;g<y&&!E;g++)b=h(c(m)*v[g]),b>t&&(!u||w<=o)&&w!==undefined&&p.push(w),w>o&&(E=!0),w=b}}else{var S=c(t),x=c(o),T=f[u?"minorTickInterval":"tickInterval"],N=T==="auto"?null:T,C=f.tickPixelInterval/(u?5:1),k=u?l/a.tickPositions.length:l;e=s(N,a._minorAutoInterval,(x-S)*C/(k||1)),e=i(e,null,n(e)),p=r(a.getLinearTickPositions(e,S,x),h),u||(a._minorAutoInterval=e/5)}return u||(a.tickInterval=e),p},t.prototype.log2lin=function(e){return Math.log(e)/Math.LN10},t.prototype.lin2log=function(e){return Math.pow(10,e)}}(t),function(e){var t=e.dateFormat,n=e.each,r=e.extend,i=e.format,s=e.isNumber,o=e.map,u=e.merge,a=e.pick,f=e.splat,l=e.syncTimeout,c=e.timeUnits;e.Tooltip=function(){this.init.apply(this,arguments)},e.Tooltip.prototype={init:function(e,t){this.chart=e,this.options=t,this.crosshairs=[],this.now={x:0,y:0},this.isHidden=!0,this.split=t.split&&!e.inverted,this.shared=t.shared||this.split},cleanSplit:function(e){n(this.chart.series,function(t){var n=t&&t.tt;n&&(!n.isActive||e?t.tt=n.destroy():n.isActive=!1)})},getLabel:function(){var e=this.chart.renderer,t=this.options;return this.label||(this.split?this.label=e.g("tooltip"):(this.label=e.label("",0,0,t.shape||"callout",null,null,t.useHTML,null,"tooltip").attr({padding:t.padding,r:t.borderRadius}),this.label.attr({fill:t.backgroundColor,"stroke-width":t.borderWidth}).css(t.style).shadow(t.shadow)),this.label.attr({zIndex:8}).add()),this.label},update:function(e){this.destroy(),this.init(this.chart,u(!0,this.options,e))},destroy:function(){this.label&&(this.label=this.label.destroy()),this.split&&this.tt&&(this.cleanSplit(this.chart,!0),this.tt=this.tt.destroy()),clearTimeout(this.hideTimer),clearTimeout(this.tooltipTimeout)},move:function(e,t,n,i){var s=this,o=s.now,u=s.options.animation!==!1&&!s.isHidden&&(Math.abs(e-o.x)>1||Math.abs(t-o.y)>1),a=s.followPointer||s.len>1;r(o,{x:u?(2*o.x+e)/3:e,y:u?(o.y+t)/2:t,anchorX:a?undefined:u?(2*o.anchorX+n)/3:n,anchorY:a?undefined:u?(o.anchorY+i)/2:i}),s.getLabel().attr(o),u&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){s&&s.move(e,t,n,i)},32))},hide:function(e){var t=this;clearTimeout(this.hideTimer),e=a(e,this.options.hideDelay,500),this.isHidden||(this.hideTimer=l(function(){t.getLabel()[e?"fadeOut":"hide"](),t.isHidden=!0},e))},getAnchor:function(e,t){var r,i=this.chart,s=i.inverted,u=i.plotTop,a=i.plotLeft,l=0,c=0,h,p;return e=f(e),r=e[0].tooltipPos,this.followPointer&&t&&(t.chartX===undefined&&(t=i.pointer.normalize(t)),r=[t.chartX-i.plotLeft,t.chartY-u]),r||(n(e,function(e){h=e.series.yAxis,p=e.series.xAxis,l+=e.plotX+(!s&&p?p.left-a:0),c+=(e.plotLow?(e.plotLow+e.plotHigh)/2:e.plotY)+(!s&&h?h.top-u:0)}),l/=e.length,c/=e.length,r=[s?i.plotWidth-c:l,this.shared&&!s&&e.length>1&&t?t.chartY-u:s?i.plotHeight-l:c]),o(r,Math.round)},getPosition:function(e,t,n){var r=this.chart,i=this.distance,s={},o=n.h||0,u,f=["y",r.chartHeight,t,n.plotY+r.plotTop,r.plotTop,r.plotTop+r.plotHeight],l=["x",r.chartWidth,e,n.plotX+r.plotLeft,r.plotLeft,r.plotLeft+r.plotWidth],c=!this.followPointer&&a(n.ttBelow,!r.inverted==!!n.negative),h=function(e,t,n,r,u,a){var f=n<r-i,l=r+i+n<t,h=r-i-n,p=r+i;if(c&&l)s[e]=p;else if(!c&&f)s[e]=h;else if(f)s[e]=Math.min(a-n,h-o<0?h:h-o);else{if(!l)return!1;s[e]=Math.max(u,p+o+n>t?p:p+o)}},p=function(e,t,n,r){var o;return r<i||r>t-i?o=!1:r<n/2?s[e]=1:r>t-n/2?s[e]=t-n-2:s[e]=r-n/2,o},d=function(e){var t=f;f=l,l=t,u=e},v=function(){h.apply(0,f)!==!1?p.apply(0,l)===!1&&!u&&(d(!0),v()):u?s.x=s.y=0:(d(!0),v())};return(r.inverted||this.len>1)&&d(),v(),s},defaultFormatter:function(e){var t=this.points||f(this),n;return n=[e.tooltipFooterHeaderFormatter(t[0])],n=n.concat(e.bodyFormatter(t)),n.push(e.tooltipFooterHeaderFormatter(t[0],!0)),n},refresh:function(e,t){var r=this,i,s=r.options,o,u,l=e,c,h={},p,d=[],v=s.formatter||r.defaultFormatter,m=r.shared,g;clearTimeout(this.hideTimer),r.followPointer=f(l)[0].series.tooltipOptions.followPointer,c=r.getAnchor(l,t),o=c[0],u=c[1],m&&(!l.series||!l.series.noSharedTooltip)?(n(l,function(e){e.setState("hover"),d.push(e.getLabelConfig())}),h={x:l[0].category,y:l[0].y},h.points=d,l=l[0]):h=l.getLabelConfig(),this.len=d.length,p=v.call(h,r),g=l.series,this.distance=a(g.tooltipOptions.distance,16),p===!1?this.hide():(i=r.getLabel(),r.isHidden&&i.attr({opacity:1}).show(),r.split?this.renderSplit(p,e):(i.attr({text:p&&p.join?p.join(""):p}),i.removeClass(/highcharts-color-[\d]+/g).addClass("highcharts-color-"+a(l.colorIndex,g.colorIndex)),i.attr({stroke:s.borderColor||l.color||g.color||"#666666"}),r.updatePosition({plotX:o,plotY:u,negative:l.negative,ttBelow:l.ttBelow,h:c[2]||0})),this.isHidden=!1)},renderSplit:function(t,r){var i=this,s=[],o=this.chart,u=o.renderer,f=!0,l=this.options,c,h=this.getLabel();n(t.slice(0,r.length+1),function(e,t){var n=r[t-1]||{isHeader:!0,plotX:r[0].plotX},p=n.series||i,d=p.tt,v=n.series||{},m="highcharts-color-"+a(n.colorIndex,v.colorIndex,"none"),g,y,b,w;d||(p.tt=d=u.label(null,null,null,"callout").addClass("highcharts-tooltip-box "+m).attr({padding:l.padding,r:l.borderRadius,fill:l.backgroundColor,stroke:n.color||v.color||"#333333","stroke-width":l.borderWidth}).add(h)),d.isActive=!0,d.attr({text:e}),d.css(l.style),b=d.getBBox(),w=b.width+d.strokeWidth(),n.isHeader?(c=b.height,y=Math.max(0,Math.min(n.plotX+o.plotLeft-w/2,o.chartWidth-w))):y=n.plotX+o.plotLeft-a(l.distance,16)-w,y<0&&(f=!1),g=(n.series&&n.series.yAxis&&n.series.yAxis.pos)+(n.plotY||0),g-=o.plotTop,s.push({target:n.isHeader?o.plotHeight+c:g,rank:n.isHeader?1:0,size:p.tt.getBBox().height+1,point:n,x:y,tt:d})}),this.cleanSplit(),e.distribute(s,o.plotHeight+c),n(s,function(e){var t=e.point,n=t.series;e.tt.attr({visibility:e.pos===undefined?"hidden":"inherit",x:f||t.isHeader?e.x:t.plotX+o.plotLeft+a(l.distance,16),y:e.pos+o.plotTop,anchorX:t.isHeader?t.plotX+o.plotLeft:t.plotX+n.xAxis.pos,anchorY:t.isHeader?e.pos+o.plotTop-15:t.plotY+n.yAxis.pos})})},updatePosition:function(e){var t=this.chart,n=this.getLabel(),r=(this.options.positioner||this.getPosition).call(this,n.width,n.height,e);this.move(Math.round(r.x),Math.round(r.y||0),e.plotX+t.plotLeft,e.plotY+t.plotTop)},getDateFormat:function(e,n,r,i){var s=t("%m-%d %H:%M:%S.%L",n),o,u,a="01-01 00:00:00.000",f={millisecond:15,second:12,minute:9,hour:6,day:3},l="millisecond";for(u in c){if(e===c.week&&+t("%w",n)===r&&s.substr(6)===a.substr(6)){u="week";break}if(c[u]>e){u=l;break}if(f[u]&&s.substr(f[u])!==a.substr(f[u]))break;u!=="week"&&(l=u)}return u&&(o=i[u]),o},getXDateFormat:function(e,t,n){var r,i=t.dateTimeLabelFormats,s=n&&n.closestPointRange;return s?r=this.getDateFormat(s,e.x,n.options.startOfWeek,i):r=i.day,r||i.year},tooltipFooterHeaderFormatter:function(e,t){var n=t?"footer":"header",r=e.series,o=r.tooltipOptions,u=o.xDateFormat,a=r.xAxis,f=a&&a.options.type==="datetime"&&s(e.key),l=o[n+"Format"];return f&&!u&&(u=this.getXDateFormat(e,o,a)),f&&u&&(l=l.replace("{point.key}","{point.key:"+u+"}")),i(l,{point:e,series:r})},bodyFormatter:function(e){return o(e,function(e){var t=e.series.tooltipOptions;return(t.pointFormatter||e.point.tooltipFormatter).call(e.point,t.pointFormat)})}}}(t),function(e){var t=e.addEvent,n=e.attr,r=e.charts,i=e.color,s=e.css,o=e.defined,u=e.doc,a=e.each,f=e.extend,l=e.fireEvent,c=e.offset,h=e.pick,p=e.removeEvent,d=e.splat,v=e.Tooltip,m=e.win;e.Pointer=function(e,t){this.init(e,t)},e.Pointer.prototype={init:function(e,t){this.options=t,this.chart=e,this.runChartClick=t.chart.events&&!!t.chart.events.click,this.pinchDown=[],this.lastValidTouch={},v&&t.tooltip.enabled&&(e.tooltip=new v(e,t.tooltip),this.followTouchMove=h(t.tooltip.followTouchMove,!0)),this.setDOMEvents()},zoomOption:function(e){var t=this.chart,n=t.options.chart,r=n.zoomType||"",i=t.inverted,s,o;/touch/.test(e.type)&&(r=h(n.pinchType,r)),this.zoomX=s=/x/.test(r),this.zoomY=o=/y/.test(r),this.zoomHor=s&&!i||o&&i,this.zoomVert=o&&!i||s&&i,this.hasZoom=s||o},normalize:function(e,t){var n,r,i;return e=e||m.event,e.target||(e.target=e.srcElement),i=e.touches?e.touches.length?e.touches.item(0):e.changedTouches[0]:e,t||(this.chartPosition=t=c(this.chart.container)),i.pageX===undefined?(n=Math.max(e.x,e.clientX-t.left),r=e.y):(n=i.pageX-t.left,r=i.pageY-t.top),f(e,{chartX:Math.round(n),chartY:Math.round(r)})},getCoordinates:function(e){var t={xAxis:[],yAxis:[]};return a(this.chart.axes,function(n){t[n.isXAxis?"xAxis":"yAxis"].push({axis:n,value:n.toValue(e[n.horiz?"chartX":"chartY"])})}),t},getKDPoints:function(e,t,n){var r=[],i,s,o,u;a(e,function(e){i=e.noSharedTooltip&&t,s=!t&&e.directTouch,e.visible&&!s&&h(e.options.enableMouseTracking,!0)&&(o=e.searchPoint(n,!i&&e.options.findNearestPointBy.indexOf("y")<0),o&&o.series&&r.push(o))}),r.sort(function(e,n){var r=e.distX-n.distX,i=e.dist-n.dist,s=(n.series.group&&n.series.group.zIndex)-(e.series.group&&e.series.group.zIndex),o;return r!==0&&t?o=r:i!==0?o=i:s!==0?o=s:o=e.series.index>n.series.index?-1:1,o});if(t&&r[0]&&!r[0].series.noSharedTooltip){u=r.length;while(u--)(r[u].x!==r[0].x||r[u].series.noSharedTooltip)&&r.splice(u,1)}return r},getPointFromEvent:function(e){var t=e.target,n;while(t&&!n)n=t.point,t=t.parentNode;return n},getHoverData:function(t,n,r,i,s,o){var u=t,f=n,l,c;return i?s?(c=[],a(r,function(e){var t=e.noSharedTooltip&&s,n=!s&&e.directTouch,r;e.visible&&!t&&!n&&h(e.options.enableMouseTracking,!0)&&(r=e.searchKDTree({clientX:u.clientX,plotY:u.plotY},!t&&e.kdDimensions===1),r&&r.series&&c.push(r))}),c.length===0&&(c=[u])):c=[u]:f&&!f.stickyTracking?(s||(r=[f]),c=this.getKDPoints(r,s,o),u=e.find(c,function(e){return e.series===f})):(l=e.grep(r,function(e){return e.stickyTracking}),c=this.getKDPoints(l,s,o),u=c[0],f=u&&u.series,s&&(c=this.getKDPoints(r,s,o))),c.sort(function(e,t){return e.series.index-t.series.index}),{hoverPoint:u,hoverSeries:f,hoverPoints:c}},runPointActions:function(n,i){var s=this,o=s.chart,f=o.series,l=o.tooltip,c=l?l.shared:!1,p=i||o.hoverPoint,d=p&&p.series||o.hoverSeries,v=!!i||!c&&d&&d.directTouch,m=this.getHoverData(p,d,f,v,c,n),g,y,b,w;p=m.hoverPoint,d=m.hoverSeries,y=d&&d.tooltipOptions.followPointer,g=c&&p&&!p.series.noSharedTooltip,w=g?m.hoverPoints:p?[p]:[],p&&(p!==o.hoverPoint||l&&l.isHidden)?(a(o.hoverPoints||[],function(t){e.inArray(t,w)===-1&&t.setState()}),a(w||[],function(e){e.setState("hover")}),o.hoverSeries!==d&&d.onMouseOver(),d&&!d.directTouch&&(o.hoverPoint&&o.hoverPoint.firePointEvent("mouseOut"),p.firePointEvent("mouseOver")),o.hoverPoints=w,o.hoverPoint=p,l&&l.refresh(g?w:p,n)):y&&l&&!l.isHidden&&(b=l.getAnchor([{}],n),l.updatePosition({plotX:b[0],plotY:b[1]})),s.unDocMouseMove||(s.unDocMouseMove=t(u,"mousemove",function(t){var n=r[e.hoverChartIndex];n&&n.pointer.onDocumentMouseMove(t)})),a(o.axes,function(t){h(t.crosshair.snap,!0)?a(w,function(e){e.series[t.coll]===t&&t.drawCrosshair(n,e)}):t.drawCrosshair(n)})},reset:function(e,t){var n=this,r=n.chart,i=r.hoverSeries,s=r.hoverPoint,o=r.hoverPoints,u=r.tooltip,f=u&&u.shared?o:s;e&&f&&a(d(f),function(t){t.series.isCartesian&&t.plotX===undefined&&(e=!1)}),e?u&&f&&(u.refresh(f),s&&(s.setState(s.state,!0),a(r.axes,function(e){e.crosshair&&e.drawCrosshair(null,s)}))):(s&&s.onMouseOut(),o&&a(o,function(e){e.setState()}),i&&i.onMouseOut(),u&&u.hide(t),n.unDocMouseMove&&(n.unDocMouseMove=n.unDocMouseMove()),a(r.axes,function(e){e.hideCrosshair()}),n.hoverX=r.hoverPoints=r.hoverPoint=null)},scaleGroups:function(e,t){var n=this.chart,r;a(n.series,function(i){r=e||i.getPlotBox(),i.xAxis&&i.xAxis.zoomEnabled&&i.group&&(i.group.attr(r),i.markerGroup&&(i.markerGroup.attr(r),i.markerGroup.clip(t?n.clipRect:null)),i.dataLabelsGroup&&i.dataLabelsGroup.attr(r))}),n.clipRect.attr(t||n.clipBox)},dragStart:function(e){var t=this.chart;t.mouseIsDown=e.type,t.cancelClick=!1,t.mouseDownX=this.mouseDownX=e.chartX,t.mouseDownY=this.mouseDownY=e.chartY},drag:function(e){var t=this.chart,n=t.options.chart,r=e.chartX,s=e.chartY,o=this.zoomHor,u=this.zoomVert,a=t.plotLeft,f=t.plotTop,l=t.plotWidth,c=t.plotHeight,h,p,d=this.selectionMarker,v=this.mouseDownX,m=this.mouseDownY,g=n.panKey&&e[n.panKey+"Key"];if(d&&d.touch)return;r<a?r=a:r>a+l&&(r=a+l),s<f?s=f:s>f+c&&(s=f+c),this.hasDragged=Math.sqrt(Math.pow(v-r,2)+Math.pow(m-s,2)),this.hasDragged>10&&(h=t.isInsidePlot(v-a,m-f),t.hasCartesianSeries&&(this.zoomX||this.zoomY)&&h&&!g&&(d||(this.selectionMarker=d=t.renderer.rect(a,f,o?1:l,u?1:c,0).attr({fill:n.selectionMarkerFill||i("#335cad").setOpacity(.25).get(),"class":"highcharts-selection-marker",zIndex:7}).add())),d&&o&&(p=r-v,d.attr({width:Math.abs(p),x:(p>0?0:p)+v})),d&&u&&(p=s-m,d.attr({height:Math.abs(p),y:(p>0?0:p)+m})),h&&!d&&n.panning&&t.pan(e,n.panning))},drop:function(e){var t=this,n=this.chart,r=this.hasPinched;if(this.selectionMarker){var i={originalEvent:e,xAxis:[],yAxis:[]},u=this.selectionMarker,c=u.attr?u.attr("x"):u.x,h=u.attr?u.attr("y"):u.y,p=u.attr?u.attr("width"):u.width,d=u.attr?u.attr("height"):u.height,v;if(this.hasDragged||r)a(n.axes,function(n){if(n.zoomEnabled&&o(n.min)&&(r||t[{xAxis:"zoomX",yAxis:"zoomY"}[n.coll]])){var s=n.horiz,u=e.type==="touchend"?n.minPixelPadding:0,a=n.toValue((s?c:h)+u),f=n.toValue((s?c+p:h+d)-u);i[n.coll].push({axis:n,min:Math.min(a,f),max:Math.max(a,f)}),v=!0}}),v&&l(n,"selection",i,function(e){n.zoom(f(e,r?{animation:!1}:null))});this.selectionMarker=this.selectionMarker.destroy(),r&&this.scaleGroups()}n&&(s(n.container,{cursor:n._cursor}),n.cancelClick=this.hasDragged>10,n.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[])},onContainerMouseDown:function(e){e=this.normalize(e),this.zoomOption(e),e.preventDefault&&e.preventDefault(),this.dragStart(e)},onDocumentMouseUp:function(t){r[e.hoverChartIndex]&&r[e.hoverChartIndex].pointer.drop(t)},onDocumentMouseMove:function(e){var t=this.chart,n=this.chartPosition;e=this.normalize(e,n),n&&!this.inClass(e.target,"highcharts-tracker")&&!t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop)&&this.reset()},onContainerMouseLeave:function(t){var n=r[e.hoverChartIndex];n&&(t.relatedTarget||t.toElement)&&(n.pointer.reset(),n.pointer.chartPosition=null)},onContainerMouseMove:function(t){var n=this.chart;if(!o(e.hoverChartIndex)||!r[e.hoverChartIndex]||!r[e.hoverChartIndex].mouseIsDown)e.hoverChartIndex=n.index;t=this.normalize(t),t.returnValue=!1,n.mouseIsDown==="mousedown"&&this.drag(t),(this.inClass(t.target,"highcharts-tracker")||n.isInsidePlot(t.chartX-n.plotLeft,t.chartY-n.plotTop))&&!n.openMenu&&this.runPointActions(t)},inClass:function(e,t){var r;while(e){r=n(e,"class");if(r){if(r.indexOf(t)!==-1)return!0;if(r.indexOf("highcharts-container")!==-1)return!1}e=e.parentNode}},onTrackerMouseOut:function(e){var t=this.chart.hoverSeries,n=e.relatedTarget||e.toElement;t&&n&&!t.stickyTracking&&!this.inClass(n,"highcharts-tooltip")&&(!this.inClass(n,"highcharts-series-"+t.index)||!this.inClass(n,"highcharts-tracker"))&&t.onMouseOut()},onContainerClick:function(e){var t=this.chart,n=t.hoverPoint,r=t.plotLeft,i=t.plotTop;e=this.normalize(e),t.cancelClick||(n&&this.inClass(e.target,"highcharts-tracker")?(l(n.series,"click",f(e,{point:n})),t.hoverPoint&&n.firePointEvent("click",e)):(f(e,this.getCoordinates(e)),t.isInsidePlot(e.chartX-r,e.chartY-i)&&l(t,"click",e)))},setDOMEvents:function(){var n=this,r=n.chart.container;r.onmousedown=function(e){n.onContainerMouseDown(e)},r.onmousemove=function(e){n.onContainerMouseMove(e)},r.onclick=function(e){n.onContainerClick(e)},t(r,"mouseleave",n.onContainerMouseLeave),e.chartCount===1&&t(u,"mouseup",n.onDocumentMouseUp),e.hasTouch&&(r.ontouchstart=function(e){n.onContainerTouchStart(e)},r.ontouchmove=function(e){n.onContainerTouchMove(e)},e.chartCount===1&&t(u,"touchend",n.onDocumentTouchEnd))},destroy:function(){var t;this.unDocMouseMove&&this.unDocMouseMove(),p(this.chart.container,"mouseleave",this.onContainerMouseLeave),e.chartCount||(p(u,"mouseup",this.onDocumentMouseUp),p(u,"touchend",this.onDocumentTouchEnd)),clearInterval(this.tooltipTimeout);for(t in this)this[t]=null}}}(t),function(e){var t=e.charts,n=e.each,r=e.extend,i=e.map,s=e.noop,o=e.pick,u=e.Pointer;r(u.prototype,{pinchTranslate:function(e,t,n,r,i,s){this.zoomHor&&this.pinchTranslateDirection(!0,e,t,n,r,i,s),this.zoomVert&&this.pinchTranslateDirection(!1,e,t,n,r,i,s)},pinchTranslateDirection:function(e,t,n,r,i,s,o,u){var a=this.chart,f=e?"x":"y",l=e?"X":"Y",c="chart"+l,h=e?"width":"height",p=a["plot"+(e?"Left":"Top")],d,v,m,g=u||1,y=a.inverted,b=a.bounds[e?"h":"v"],w=t.length===1,E=t[0][c],S=n[0][c],x=!w&&t[1][c],T=!w&&n[1][c],N,C,k,L=function(){!w&&Math.abs(E-x)>20&&(g=u||Math.abs(S-T)/Math.abs(E-x)),m=(p-S)/g+E,d=a["plot"+(e?"Width":"Height")]/g};L(),v=m,v<b.min?(v=b.min,N=!0):v+d>b.max&&(v=b.max-d,N=!0),N?(S-=.8*(S-o[f][0]),w||(T-=.8*(T-o[f][1])),L()):o[f]=[S,T],y||(s[f]=m-p,s[h]=d),k=y?e?"scaleY":"scaleX":"scale"+l,C=y?1/g:g,i[h]=d,i[f]=v,r[k]=g,r["translate"+l]=C*p+(S-C*E)},pinch:function(e){var t=this,u=t.chart,a=t.pinchDown,f=e.touches,l=f.length,c=t.lastValidTouch,h=t.hasZoom,p=t.selectionMarker,d={},v=l===1&&(t.inClass(e.target,"highcharts-tracker")&&u.runTrackerClick||t.runChartClick),m={};l>1&&(t.initiated=!0),h&&t.initiated&&!v&&e.preventDefault(),i(f,function(e){return t.normalize(e)}),e.type==="touchstart"?(n(f,function(e,t){a[t]={chartX:e.chartX,chartY:e.chartY}}),c.x=[a[0].chartX,a[1]&&a[1].chartX],c.y=[a[0].chartY,a[1]&&a[1].chartY],n(u.axes,function(e){if(e.zoomEnabled){var t=u.bounds[e.horiz?"h":"v"],n=e.minPixelPadding,r=e.toPixels(o(e.options.min,e.dataMin)),i=e.toPixels(o(e.options.max,e.dataMax)),s=Math.min(r,i),a=Math.max(r,i);t.min=Math.min(e.pos,s-n),t.max=Math.max(e.pos+e.len,a+n)}}),t.res=!0):t.followTouchMove&&l===1?this.runPointActions(t.normalize(e)):a.length&&(p||(t.selectionMarker=p=r({destroy:s,touch:!0},u.plotBox)),t.pinchTranslate(a,f,d,p,m,c),t.hasPinched=h,t.scaleGroups(d,m),t.res&&(t.res=!1,this.reset(!1,0)))},touch:function(t,n){var r=this.chart,i,s,u;r.index!==e.hoverChartIndex&&this.onContainerMouseLeave({relatedTarget:!0}),e.hoverChartIndex=r.index,t.touches.length===1?(t=this.normalize(t),u=r.isInsidePlot(t.chartX-r.plotLeft,t.chartY-r.plotTop),u&&!r.openMenu?(n&&this.runPointActions(t),t.type==="touchmove"&&(s=this.pinchDown,i=s[0]?Math.sqrt(Math.pow(s[0].chartX-t.chartX,2)+Math.pow(s[0].chartY-t.chartY,2))>=4:!1),o(i,!0)&&this.pinch(t)):n&&this.reset()):t.touches.length===2&&this.pinch(t)},onContainerTouchStart:function(e){this.zoomOption(e),this.touch(e,!0)},onContainerTouchMove:function(e){this.touch(e)},onDocumentTouchEnd:function(n){t[e.hoverChartIndex]&&t[e.hoverChartIndex].pointer.drop(n)}})}(t),function(e){var t=e.addEvent,n=e.charts,r=e.css,i=e.doc,s=e.extend,o=e.noop,u=e.Pointer,a=e.removeEvent,f=e.win,l=e.wrap;if(f.PointerEvent||f.MSPointerEvent){var c={},h=!!f.PointerEvent,p=function(){var e,t=[];t.item=function(e){return this[e]};for(e in c)c.hasOwnProperty(e)&&t.push({pageX:c[e].pageX,pageY:c[e].pageY,target:c[e].target});return t},d=function(t,r,i,s){var u;(t.pointerType==="touch"||t.pointerType===t.MSPOINTER_TYPE_TOUCH)&&n[e.hoverChartIndex]&&(s(t),u=n[e.hoverChartIndex].pointer,u[r]({type:i,target:t.currentTarget,preventDefault:o,touches:p()}))};s(u.prototype,{onContainerPointerDown:function(e){d(e,"onContainerTouchStart","touchstart",function(e){c[e.pointerId]={pageX:e.pageX,pageY:e.pageY,target:e.currentTarget}})},onContainerPointerMove:function(e){d(e,"onContainerTouchMove","touchmove",function(e){c[e.pointerId]={pageX:e.pageX,pageY:e.pageY},c[e.pointerId].target||(c[e.pointerId].target=e.currentTarget)})},onDocumentPointerUp:function(e){d(e,"onDocumentTouchEnd","touchend",function(e){delete c[e.pointerId]})},batchMSEvents:function(e){e(this.chart.container,h?"pointerdown":"MSPointerDown",this.onContainerPointerDown),e(this.chart.container,h?"pointermove":"MSPointerMove",this.onContainerPointerMove),e(i,h?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}}),l(u.prototype,"init",function(e,t,n){e.call(this,t,n),this.hasZoom&&r(t.container,{"-ms-touch-action":"none","touch-action":"none"})}),l(u.prototype,"setDOMEvents",function(e){e.apply(this),(this.hasZoom||this.followTouchMove)&&this.batchMSEvents(t)}),l(u.prototype,"destroy",function(e){this.batchMSEvents(a),e.call(this)})}}(t),function(e){var t,n=e.addEvent,r=e.css,i=e.discardElement,s=e.defined,o=e.each,u=e.isFirefox,a=e.marginNames,f=e.merge,l=e.pick,c=e.setAnimation,h=e.stableSort,p=e.win,d=e.wrap;t=e.Legend=function(e,t){this.init(e,t)},t.prototype={init:function(e,t){this.chart=e,this.setOptions(t),t.enabled&&(this.render(),n(this.chart,"endResize",function(){this.legend.positionCheckboxes()}))},setOptions:function(e){var t=l(e.padding,8);this.options=e,this.itemStyle=e.itemStyle,this.itemHiddenStyle=f(this.itemStyle,e.itemHiddenStyle),this.itemMarginTop=e.itemMarginTop||0,this.padding=t,this.initialItemY=t-5,this.maxItemWidth=0,this.itemHeight=0,this.symbolWidth=l(e.symbolWidth,16),this.pages=[]},update:function(e,t){var n=this.chart;this.setOptions(f(!0,this.options,e)),this.destroy(),n.isDirtyLegend=n.isDirtyBox=!0,l(t,!0)&&n.redraw()},colorizeItem:function(e,t){e.legendGroup[t?"removeClass":"addClass"]("highcharts-legend-item-hidden");var n=this,r=n.options,i=e.legendItem,s=e.legendLine,o=e.legendSymbol,u=n.itemHiddenStyle.color,a=t?r.itemStyle.color:u,f=t?e.color||u:u,l=e.options&&e.options.marker,c={fill:f},h;i&&i.css({fill:a,color:a}),s&&s.attr({stroke:f});if(o){if(l&&o.isMarker){c=e.pointAttribs();if(!t)for(h in c)c[h]=u}o.attr(c)}},positionItem:function(e){var t=this,n=t.options,r=n.symbolPadding,i=!n.rtl,s=e._legendItemPos,o=s[0],u=s[1],a=e.checkbox,f=e.legendGroup;f&&f.element&&f.translate(i?o:t.legendWidth-o-2*r-4,u),a&&(a.x=o,a.y=u)},destroyItem:function(e){var t=e.checkbox;o(["legendItem","legendLine","legendSymbol","legendGroup"],function(t){e[t]&&(e[t]=e[t].destroy())}),t&&i(e.checkbox)},destroy:function(){function e(e){this[e]&&(this[e]=this[e].destroy())}o(this.getAllItems(),function(t){o(["legendItem","legendGroup"],e,t)}),o(["clipRect","up","down","pager","nav","box","title","group"],e,this),this.display=null},positionCheckboxes:function(e){var t=this.group&&this.group.alignAttr,n,i=this.clipHeight||this.legendHeight,s=this.titleHeight;t&&(n=t.translateY,o(this.allItems,function(o){var u=o.checkbox,a;u&&(a=n+s+u.y+(e||0)+3,r(u,{left:t.translateX+o.checkboxOffset+u.x-20+"px",top:a+"px",display:a>n-6&&a<n+i-6?"":"none"}))}))},renderTitle:function(){var e=this.options,t=this.padding,n=e.title,r=0,i;n.text&&(this.title||(this.title=this.chart.renderer.label(n.text,t-3,t-4,null,null,null,null,null,"legend-title").attr({zIndex:1}).css(n.style).add(this.group)),i=this.title.getBBox(),r=i.height,this.offsetWidth=i.width,this.contentGroup.attr({translateY:r})),this.titleHeight=r},setText:function(t){var n=this.options;t.legendItem.attr({text:n.labelFormat?e.format(n.labelFormat,t):n.labelFormatter.call(t)})},renderItem:function(e){var t=this,n=t.chart,r=n.renderer,i=t.options,s=i.layout==="horizontal",o=t.symbolWidth,u=i.symbolPadding,a=t.itemStyle,c=t.itemHiddenStyle,h=t.padding,p=s?l(i.itemDistance,20):0,d=!i.rtl,v,m=i.width,g=i.itemMarginBottom||0,y=t.itemMarginTop,b,w,E=e.legendItem,S=!e.series,x=!S&&e.series.drawLegendSymbol?e.series:e,T=x.options,N=t.createCheckboxForItem&&T&&T.showCheckbox,C=i.useHTML,k=12,L=e.options.className;E||(e.legendGroup=r.g("legend-item").addClass("highcharts-"+x.type+"-series "+"highcharts-color-"+e.colorIndex+(L?" "+L:"")+(S?" highcharts-series-"+e.index:"")).attr({zIndex:1}).add(t.scrollGroup),e.legendItem=E=r.text("",d?o+u:-u,t.baseline||0,C).css(f(e.visible?a:c)).attr({align:d?"left":"right",zIndex:2}).add(e.legendGroup),t.baseline||(k=a.fontSize,t.fontMetrics=r.fontMetrics(k,E),t.baseline=t.fontMetrics.f+3+y,E.attr("y",t.baseline)),t.symbolHeight=i.symbolHeight||t.fontMetrics.f,x.drawLegendSymbol(t,e),t.setItemEvents&&t.setItemEvents(e,E,C),N&&t.createCheckboxForItem(e)),t.colorizeItem(e,e.visible),t.setText(e),b=E.getBBox(),w=e.checkboxOffset=i.itemWidth||e.legendItemWidth||o+u+b.width+p+(N?20:0),t.itemHeight=v=Math.round(e.legendItemHeight||b.height||t.symbolHeight),s&&t.itemX-h+w>(m||n.spacingBox.width-2*h-i.x)&&(t.itemX=h,t.itemY+=y+t.lastLineHeight+g,t.lastLineHeight=0),t.maxItemWidth=Math.max(t.maxItemWidth,w),t.lastItemY=y+t.itemY+g,t.lastLineHeight=Math.max(v,t.lastLineHeight),e._legendItemPos=[t.itemX,t.itemY],s?t.itemX+=w:(t.itemY+=y+v+g,t.lastLineHeight=v),t.offsetWidth=m||Math.max((s?t.itemX-h-p:w)+h,t.offsetWidth)},getAllItems:function(){var e=[];return o(this.chart.series,function(t){var n=t&&t.options;t&&l(n.showInLegend,s(n.linkedTo)?!1:undefined,!0)&&(e=e.concat(t.legendItems||(n.legendType==="point"?t.data:t)))}),e},adjustMargins:function(e,t){var n=this.chart,r=this.options,i=r.align.charAt(0)+r.verticalAlign.charAt(0)+r.layout.charAt(0);r.floating||o([/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/],function(o,u){o.test(i)&&!s(e[u])&&(n[a[u]]=Math.max(n[a[u]],n.legend[(u+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][u]*r[u%2?"x":"y"]+l(r.margin,12)+t[u]))})},render:function(){var e=this,t=e.chart,n=t.renderer,r=e.group,i,s,u,a,l=e.box,c=e.options,p=e.padding;e.itemX=p,e.itemY=e.initialItemY,e.offsetWidth=0,e.lastItemY=0,r||(e.group=r=n.g("legend").attr({zIndex:7}).add(),e.contentGroup=n.g().attr({zIndex:1}).add(r),e.scrollGroup=n.g().add(e.contentGroup)),e.renderTitle(),i=e.getAllItems(),h(i,function(e,t){return(e.options&&e.options.legendIndex||0)-(t.options&&t.options.legendIndex||0)}),c.reversed&&i.reverse(),e.allItems=i,e.display=s=!!i.length,e.lastLineHeight=0,o(i,function(t){e.renderItem(t)}),u=(c.width||e.offsetWidth)+p,a=e.lastItemY+e.lastLineHeight+e.titleHeight,a=e.handleOverflow(a),a+=p,l||(e.box=l=n.rect().addClass("highcharts-legend-box").attr({r:c.borderRadius}).add(r),l.isNew=!0),l.attr({stroke:c.borderColor,"stroke-width":c.borderWidth||0,fill:c.backgroundColor||"none"}).shadow(c.shadow),u>0&&a>0&&(l[l.isNew?"attr":"animate"](l.crisp({x:0,y:0,width:u,height:a},l.strokeWidth())),l.isNew=!1),l[s?"show":"hide"](),e.legendWidth=u,e.legendHeight=a,o(i,function(t){e.positionItem(t)}),s&&r.align(f(c,{width:u,height:a}),!0,"spacingBox"),t.isResizing||this.positionCheckboxes()},handleOverflow:function(e){var t=this,n=this.chart,r=n.renderer,i=this.options,s=i.y,u=i.verticalAlign==="top",a=this.padding,f=n.spacingBox.height+(u?-s:s)-a,c=i.maxHeight,h,p=this.clipRect,d=i.navigation,v=l(d.animation,!0),m=d.arrowSize||12,g=this.nav,y=this.pages,b,w=this.allItems,E=function(e){e?p.attr({height:e}):p&&(t.clipRect=p.destroy(),t.contentGroup.clip()),t.contentGroup.div&&(t.contentGroup.div.style.clip=e?"rect("+a+"px,9999px,"+(a+e)+"px,0)":"auto")};return i.layout==="horizontal"&&i.verticalAlign!=="middle"&&!i.floating&&(f/=2),c&&(f=Math.min(f,c)),y.length=0,e>f&&d.enabled!==!1?(this.clipHeight=h=Math.max(f-20-this.titleHeight-a,0),this.currentPage=l(this.currentPage,1),this.fullHeight=e,o(w,function(e,t){var n=e._legendItemPos[1],r=Math.round(e.legendItem.getBBox().height),i=y.length;if(!i||n-y[i-1]>h&&(b||n)!==y[i-1])y.push(b||n),i++;t===w.length-1&&n+r-y[i-1]>h&&y.push(n),n!==b&&(b=n)}),p||(p=t.clipRect=r.clipRect(0,a,9999,0),t.contentGroup.clip(p)),E(h),g||(this.nav=g=r.g().attr({zIndex:1}).add(this.group),this.up=r.symbol("triangle",0,0,m,m).on("click",function(){t.scroll(-1,v)}).add(g),this.pager=r.text("",15,10).addClass("highcharts-legend-navigation").css(d.style).add(g),this.down=r.symbol("triangle-down",0,0,m,m).on("click",function(){t.scroll(1,v)}).add(g)),t.scroll(0),e=f):g&&(E(),this.nav=g.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),e},scroll:function(e,t){var n=this.pages,r=n.length,i=this.currentPage+e,s=this.clipHeight,o=this.options.navigation,u=this.pager,a=this.padding,f;i>r&&(i=r),i>0&&(t!==undefined&&c(t,this.chart),this.nav.attr({translateX:a,translateY:s+this.padding+7+this.titleHeight,visibility:"visible"}),this.up.attr({"class":i===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"}),u.attr({text:i+"/"+r}),this.down.attr({x:18+this.pager.getBBox().width,"class":i===r?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"}),this.up.attr({fill:i===1?o.inactiveColor:o.activeColor}).css({cursor:i===1?"default":"pointer"}),this.down.attr({fill:i===r?o.inactiveColor:o.activeColor}).css({cursor:i===r?"default":"pointer"}),f=-n[i-1]+this.initialItemY,this.scrollGroup.animate({translateY:f}),this.currentPage=i,this.positionCheckboxes(f))}},e.LegendSymbolMixin={drawRectangle:function(e,t){var n=e.options,r=e.symbolHeight,i=n.squareSymbol,s=i?r:e.symbolWidth;t.legendSymbol=this.chart.renderer.rect(i?(e.symbolWidth-r)/2:0,e.baseline-r+1,s,r,l(e.options.symbolRadius,r/2)).addClass("highcharts-point").attr({zIndex:3}).add(t.legendGroup)},drawLineMarker:function(e){var t=this.options,n=t.marker,r,i,s=e.symbolWidth,o=e.symbolHeight,u=o/2,a=this.chart.renderer,c=this.legendGroup,h=e.baseline-Math.round(e.fontMetrics.b*.3),p={};p={"stroke-width":t.lineWidth||0},t.dashStyle&&(p.dashstyle=t.dashStyle),this.legendLine=a.path(["M",0,h,"L",s,h]).addClass("highcharts-graph").attr(p).add(c),n&&n.enabled!==!1&&(r=Math.min(l(n.radius,u),u),this.symbol.indexOf("url")===0&&(n=f(n,{width:o,height:o}),r=0),this.legendSymbol=i=a.symbol(this.symbol,s/2-r,h-r,2*r,2*r,n).addClass("highcharts-point").add(c),i.isMarker=!0)}},(/Trident\/7\.0/.test(p.navigator.userAgent)||u)&&d(t.prototype,"positionItem",function(e,t){var n=this,r=function(){t._legendItemPos&&e.call(n,t)};r(),setTimeout(r)})}(t),function(e){var t=e.addEvent,n=e.animate,r=e.animObject,i=e.attr,s=e.doc,o=e.Axis,u=e.createElement,a=e.defaultOptions,f=e.discardElement,l=e.charts,c=e.css,h=e.defined,p=e.each,d=e.extend,v=e.find,m=e.fireEvent,g=e.getStyle,y=e.grep,b=e.isNumber,w=e.isObject,E=e.isString,S=e.Legend,x=e.marginNames,T=e.merge,N=e.Pointer,C=e.pick,k=e.pInt,L=e.removeEvent,A=e.seriesTypes,O=e.splat,M=e.svg,_=e.syncTimeout,D=e.win,P=e.Renderer,H=e.Chart=function(){this.getArgs.apply(this,arguments)};e.chart=function(e,t,n){return new H(e,t,n)},H.prototype={callbacks:[],getArgs:function(){var e=[].slice.call(arguments);if(E(e[0])||e[0].nodeName)this.renderTo=e.shift();this.init(e[0],e[1])},init:function(n,r){var i,s=n.series;n.series=null,i=T(a,n),i.series=n.series=s,this.userOptions=n;var o=i.chart,u=o.events;this.margin=[],this.spacing=[],this.bounds={h:{},v:{}},this.callback=r,this.isResizing=0,this.options=i,this.axes=[],this.series=[],this.hasCartesianSeries=o.showAxes;var f=this,c;f.index=l.length,l.push(f),e.chartCount++;if(u)for(c in u)t(f,c,u[c]);f.xAxis=[],f.yAxis=[],f.pointCount=f.colorCounter=f.symbolCounter=0,f.firstRender()},initSeries:function(t){var n=this,r=n.options.chart,i=t.type||r.type||r.defaultSeriesType,s,o=A[i];return o||e.error(17,!0),s=new o,s.init(this,t),s},orderSeries:function(e){var t=this.series,n=e||0;for(;n<t.length;n++)t[n]&&(t[n].index=n,t[n].name=t[n].name||"Series "+(t[n].index+1))},isInsidePlot:function(e,t,n){var r=n?t:e,i=n?e:t;return r>=0&&r<=this.plotWidth&&i>=0&&i<=this.plotHeight},redraw:function(t){var n=this,r=n.axes,i=n.series,s=n.pointer,o=n.legend,u=n.isDirtyLegend,a,f,l=n.hasCartesianSeries,c=n.isDirtyBox,h,v,g=n.renderer,y=g.isHidden(),b=[];n.setResponsive&&n.setResponsive(!1),e.setAnimation(t,n),y&&n.cloneRenderTo(),n.layOutTitles(),h=i.length;while(h--){v=i[h];if(v.options.stacking){a=!0;if(v.isDirty){f=!0;break}}}if(f){h=i.length;while(h--)v=i[h],v.options.stacking&&(v.isDirty=!0)}p(i,function(e){e.isDirty&&e.options.legendType==="point"&&(e.updateTotals&&e.updateTotals(),u=!0),e.isDirtyData&&m(e,"updatedData")}),u&&o.options.enabled&&(o.render(),n.isDirtyLegend=!1),a&&n.getStacks(),l&&p(r,function(e){e.updateNames(),e.setScale()}),n.getMargins(),l&&(p(r,function(e){e.isDirty&&(c=!0)}),p(r,function(e){var t=e.min+","+e.max;e.extKey!==t&&(e.extKey=t,b.push(function(){m(e,"afterSetExtremes",d(e.eventArgs,e.getExtremes())),delete e.eventArgs})),(c||a)&&e.redraw()})),c&&n.drawChartBox(),m(n,"predraw"),p(i,function(e){(c||e.isDirty)&&e.visible&&e.redraw(),e.isDirtyData=!1}),s&&s.reset(!0),g.draw(),m(n,"redraw"),m(n,"render"),y&&n.cloneRenderTo(!0),p(b,function(e){e.call()})},get:function(e){function i(t){return t.id===e||t.options&&t.options.id===e}var t,n=this.series,r;t=v(this.axes,i)||v(this.series,i);for(r=0;!t&&r<n.length;r++)t=v(n[r].points||[],i);return t},getAxes:function(){var e=this,t=this.options,n=t.xAxis=O(t.xAxis||{}),r=t.yAxis=O(t.yAxis||{}),i;p(n,function(e,t){e.index=t,e.isX=!0}),p(r,function(e,t){e.index=t}),i=n.concat(r),p(i,function(t){new o(e,t)})},getSelectedPoints:function(){var e=[];return p(this.series,function(t){e=e.concat(y(t.points||[],function(e){return e.selected}))}),e},getSelectedSeries:function(){return y(this.series,function(e){return e.selected})},setTitle:function(e,t,n){var r=this,i=r.options,s,o;s=i.title=T({style:{color:"#333333",fontSize:i.isStock?"16px":"18px"}},i.title,e),o=i.subtitle=T({style:{color:"#666666"}},i.subtitle,t),p([["title",e,s],["subtitle",t,o]],function(e,t){var n=e[0],i=r[n],s=e[1],o=e[2];i&&s&&(r[n]=i=i.destroy()),o&&o.text&&!i&&(r[n]=r.renderer.text(o.text,0,0,o.useHTML).attr({align:o.align,"class":"highcharts-"+n,zIndex:o.zIndex||4}).add(),r[n].update=function(e){r.setTitle(!t&&e,t&&e)},r[n].css(o.style))}),r.layOutTitles(n)},layOutTitles:function(e){var t=0,n,r=this.renderer,i=this.spacingBox;p(["title","subtitle"],function(e){var n=this[e],s=this.options[e],o;n&&(o=s.style.fontSize,o=r.fontMetrics(o,n).b,n.css({width:(s.width||i.width+s.widthAdjust)+"px"}).align(d({y:t+o+(e==="title"?-3:2)},s),!1,"spacingBox"),!s.floating&&!s.verticalAlign&&(t=Math.ceil(t+n.getBBox(s.useHTML).height)))},this),n=this.titleOffset!==t,this.titleOffset=t,!this.isDirtyBox&&n&&(this.isDirtyBox=n,this.hasRendered&&C(e,!0)&&this.isDirtyBox&&this.redraw())},getChartSize:function(){var t=this,n=t.options.chart,r=n.width,i=n.height,s=t.renderToClone||t.renderTo;h(r)||(t.containerWidth=g(s,"width")),h(i)||(t.containerHeight=g(s,"height")),t.chartWidth=Math.max(0,r||t.containerWidth||600),t.chartHeight=Math.max(0,e.relativeLength(i,t.chartWidth)||t.containerHeight||400)},cloneRenderTo:function(e){var t=this.renderToClone,n=this.container;if(e){if(t){while(t.childNodes.length)this.renderTo.appendChild(t.firstChild);f(t),delete this.renderToClone}}else n&&n.parentNode===this.renderTo&&this.renderTo.removeChild(n),this.renderToClone=t=this.renderTo.cloneNode(0),c(t,{position:"absolute",top:"-9999px",display:"block"}),t.style.setProperty&&t.style.setProperty("display","block","important"),s.body.appendChild(t),n&&t.appendChild(n)},setClassName:function(e){this.container.className="highcharts-container "+(e||"")},getContainer:function(){var t=this,n,r=t.options,o=r.chart,a,f,c=t.renderTo,h="data-highcharts-chart",p,v,m=e.uniqueKey(),g,y;c||(t.renderTo=c=o.renderTo),E(c)&&(t.renderTo=c=s.getElementById(c)),c||e.error(13,!0),p=k(i(c,h)),b(p)&&l[p]&&l[p].hasRendered&&l[p].destroy(),i(c,h,t.index),c.innerHTML="",!o.skipClone&&!c.offsetWidth&&t.cloneRenderTo(),t.getChartSize(),a=t.chartWidth,f=t.chartHeight,g=d({position:"relative",overflow:"hidden",width:a+"px",height:f+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},o.style),t.container=n=u("div",{id:m},g,t.renderToClone||c),t._cursor=n.style.cursor,v=e[o.renderer]||P,t.renderer=new v(n,a,f,null,o.forExport,r.exporting&&r.exporting.allowHTML),t.setClassName(o.className),t.renderer.setStyle(o.style),t.renderer.chartIndex=t.index},getMargins:function(e){var t=this,n=t.spacing,r=t.margin,i=t.titleOffset;t.resetMargins(),i&&!h(r[0])&&(t.plotTop=Math.max(t.plotTop,i+t.options.title.margin+n[0])),t.legend.display&&t.legend.adjustMargins(r,n),t.extraMargin&&(t[t.extraMargin.type]=(t[t.extraMargin.type]||0)+t.extraMargin.value),t.extraTopMargin&&(t.plotTop+=t.extraTopMargin),e||this.getAxisMargins()},getAxisMargins:function(){var e=this,t=e.axisOffset=[0,0,0,0],n=e.margin;e.hasCartesianSeries&&p(e.axes,function(e){e.visible&&e.getOffset()}),p(x,function(r,i){h(n[i])||(e[r]+=t[i])}),e.setChartSize()},reflow:function(e){var t=this,n=t.options.chart,r=t.renderTo,i=h(n.width),o=n.width||g(r,"width"),u=n.height||g(r,"height"),a=e?e.target:D;if(!i&&!t.isPrinting&&o&&u&&(a===D||a===s)){if(o!==t.containerWidth||u!==t.containerHeight)clearTimeout(t.reflowTimeout),t.reflowTimeout=_(function(){t.container&&t.setSize(undefined,undefined,!1)},e?100:0);t.containerWidth=o,t.containerHeight=u}},initReflow:function(){var e=this,n;n=t(D,"resize",function(t){e.reflow(t)}),t(e,"destroy",n)},setSize:function(t,i,s){var o=this,u=o.renderer,a;o.isResizing+=1,e.setAnimation(s,o),o.oldChartHeight=o.chartHeight,o.oldChartWidth=o.chartWidth,t!==undefined&&(o.options.chart.width=t),i!==undefined&&(o.options.chart.height=i),o.getChartSize(),a=u.globalAnimation,(a?n:c)(o.container,{width:o.chartWidth+"px",height:o.chartHeight+"px"},a),o.setChartSize(!0),u.setSize(o.chartWidth,o.chartHeight,s),p(o.axes,function(e){e.isDirty=!0,e.setScale()}),o.isDirtyLegend=!0,o.isDirtyBox=!0,o.layOutTitles(),o.getMargins(),o.redraw(s),o.oldChartHeight=null,m(o,"resize"),_(function(){o&&m(o,"endResize",null,function(){o.isResizing-=1})},r(a).duration)},setChartSize:function(e){var t=this,n=t.inverted,r=t.renderer,i=t.chartWidth,s=t.chartHeight,o=t.options.chart,u=t.spacing,a=t.clipOffset,f,l,c,h,d,v,m;t.plotLeft=c=Math.round(t.plotLeft),t.plotTop=h=Math.round(t.plotTop),t.plotWidth=d=Math.max(0,Math.round(i-c-t.marginRight)),t.plotHeight=v=Math.max(0,Math.round(s-h-t.marginBottom)),t.plotSizeX=n?v:d,t.plotSizeY=n?d:v,t.plotBorderWidth=o.plotBorderWidth||0,t.spacingBox=r.spacingBox={x:u[3],y:u[0],width:i-u[3]-u[1],height:s-u[0]-u[2]},t.plotBox=r.plotBox={x:c,y:h,width:d,height:v},m=2*Math.floor(t.plotBorderWidth/2),f=Math.ceil(Math.max(m,a[3])/2),l=Math.ceil(Math.max(m,a[0])/2),t.clipBox={x:f,y:l,width:Math.floor(t.plotSizeX-Math.max(m,a[1])/2-f),height:Math.max(0,Math.floor(t.plotSizeY-Math.max(m,a[2])/2-l))},e||p(t.axes,function(e){e.setAxisSize(),e.setAxisTranslation()})},resetMargins:function(){var e=this,t=e.options.chart;p(["margin","spacing"],function(r){var i=t[r],s=w(i)?i:[i,i,i,i];p(["Top","Right","Bottom","Left"],function(n,i){e[r][i]=C(t[r+n],s[i])})}),p(x,function(t,n){e[t]=C(e.margin[n],e.spacing[n])}),e.axisOffset=[0,0,0,0],e.clipOffset=[0,0,0,0]},drawChartBox:function(){var e=this,t=e.options.chart,n=e.renderer,r=e.chartWidth,i=e.chartHeight,s=e.chartBackground,o=e.plotBackground,u=e.plotBorder,a,f=e.plotBGImage,l=t.backgroundColor,c=t.plotBackgroundColor,h=t.plotBackgroundImage,p,d,v=e.plotLeft,m=e.plotTop,g=e.plotWidth,y=e.plotHeight,b=e.plotBox,w=e.clipRect,E=e.clipBox,S="animate";s||(e.chartBackground=s=n.rect().addClass("highcharts-background").add(),S="attr"),a=t.borderWidth||0,p=a+(t.shadow?8:0),d={fill:l||"none"};if(a||s["stroke-width"])d.stroke=t.borderColor,d["stroke-width"]=a;s.attr(d).shadow(t.shadow),s[S]({x:p/2,y:p/2,width:r-p-a%2,height:i-p-a%2,r:t.borderRadius}),S="animate",o||(S="attr",e.plotBackground=o=n.rect().addClass("highcharts-plot-background").add()),o[S](b),o.attr({fill:c||"none"}).shadow(t.plotShadow),h&&(f?f.animate(b):e.plotBGImage=n.image(h,v,m,g,y).add()),w?w.animate({width:E.width,height:E.height}):e.clipRect=n.clipRect(E),S="animate",u||(S="attr",e.plotBorder=u=n.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),u.attr({stroke:t.plotBorderColor,"stroke-width":t.plotBorderWidth||0,fill:"none"}),u[S](u.crisp({x:v,y:m,width:g,height:y},-u.strokeWidth())),e.isDirtyBox=!1},propFromSeries:function(){var e=this,t=e.options.chart,n,r=e.options.series,i,s;p(["inverted","angular","polar"],function(o){n=A[t.type||t.defaultSeriesType],s=t[o]||n&&n.prototype[o],i=r&&r.length;while(!s&&i--)n=A[r[i].type],n&&n.prototype[o]&&(s=!0);e[o]=s})},linkSeries:function(){var e=this,t=e.series;p(t,function(e){e.linkedSeries.length=0}),p(t,function(t){var n=t.options.linkedTo;E(n)&&(n===":previous"?n=e.series[t.index-1]:n=e.get(n),n&&n.linkedParent!==t&&(n.linkedSeries.push(t),t.linkedParent=n,t.visible=C(t.options.visible,n.options.visible,t.visible)))})},renderSeries:function(){p(this.series,function(e){e.translate(),e.render()})},renderLabels:function(){var e=this,t=e.options.labels;t.items&&p(t.items,function(n){var r=d(t.style,n.style),i=k(r.left)+e.plotLeft,s=k(r.top)+e.plotTop+12;delete r.left,delete r.top,e.renderer.text(n.html,i,s).attr({zIndex:2}).css(r).add()})},render:function(){var e=this,t=e.axes,n=e.renderer,r=e.options,i,s,o,u;e.setTitle(),e.legend=new S(e,r.legend),e.getStacks&&e.getStacks(),e.getMargins(!0),e.setChartSize(),i=e.plotWidth,s=e.plotHeight=e.plotHeight-21,p(t,function(e){e.setScale()}),e.getAxisMargins(),o=i/e.plotWidth>1.1,u=s/e.plotHeight>1.05;if(o||u)p(t,function(e){(e.horiz&&o||!e.horiz&&u)&&e.setTickInterval(!0)}),e.getMargins();e.drawChartBox(),e.hasCartesianSeries&&p(t,function(e){e.visible&&e.render()}),e.seriesGroup||(e.seriesGroup=n.g("series-group").attr({zIndex:3}).add()),e.renderSeries(),e.renderLabels(),e.addCredits(),e.setResponsive&&e.setResponsive(),e.hasRendered=!0},addCredits:function(e){var t=this;e=T(!0,this.options.credits,e),e.enabled&&!this.credits&&(this.credits=this.renderer.text(e.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){e.href&&(D.location.href=e.href)}).attr({align:e.position.align,zIndex:8}).css(e.style).add().align(e.position),this.credits.update=function(e){t.credits=t.credits.destroy(),t.addCredits(e)})},destroy:function(){var t=this,n=t.axes,r=t.series,i=t.container,s,o=i&&i.parentNode;m(t,"destroy"),l[t.index]=undefined,e.chartCount--,t.renderTo.removeAttribute("data-highcharts-chart"),L(t),s=n.length;while(s--)n[s]=n[s].destroy();this.scroller&&this.scroller.destroy&&this.scroller.destroy(),s=r.length;while(s--)r[s]=r[s].destroy();p(["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"],function(e){var n=t[e];n&&n.destroy&&(t[e]=n.destroy())}),i&&(i.innerHTML="",L(i),o&&f(i));for(s in t)delete t[s]},isReadyToRender:function(){var e=this;return!M&&D==D.top&&s.readyState!=="complete"?(s.attachEvent("onreadystatechange",function(){s.detachEvent("onreadystatechange",e.firstRender),s.readyState==="complete"&&e.firstRender()}),!1):!0},firstRender:function(){var e=this,t=e.options;if(!e.isReadyToRender())return;e.getContainer(),m(e,"init"),e.resetMargins(),e.setChartSize(),e.propFromSeries(),e.getAxes(),p(t.series||[],function(t){e.initSeries(t)}),e.linkSeries(),m(e,"beforeRender"),N&&(e.pointer=new N(e,t)),e.render(),!e.renderer.imgCount&&e.onload&&e.onload(),e.cloneRenderTo(!0)},onload:function(){p([this.callback].concat(this.callbacks),function(e){e&&this.index!==undefined&&e.apply(this,[this])},this),m(this,"load"),m(this,"render"),h(this.index)&&this.options.chart.reflow!==!1&&this.initReflow(),this.onload=null}}}(t),function(e){var t,n=e.each,r=e.extend,i=e.erase,s=e.fireEvent,o=e.format,u=e.isArray,a=e.isNumber,f=e.pick,l=e.removeEvent;t=e.Point=function(){},t.prototype={init:function(e,t,n){var r=this,i,s=e.chart.options.chart.colorCount,o;return r.series=e,r.color=e.color,r.applyOptions(t,n),e.options.colorByPoint?(i=e.options.colors||e.chart.options.colors,r.color=r.color||i[e.colorCounter],s=i.length,o=e.colorCounter,e.colorCounter++,e.colorCounter===s&&(e.colorCounter=0)):o=e.colorIndex,r.colorIndex=f(r.colorIndex,o),e.chart.pointCount++,r},applyOptions:function(e,n){var i=this,s=i.series,o=s.options.pointValKey||s.pointValKey;return e=t.prototype.optionsToObject.call(this,e),r(i,e),i.options=i.options?r(i.options,e):e,e.group&&delete i.group,o&&(i.y=i[o]),i.isNull=f(i.isValid&&!i.isValid(),i.x===null||!a(i.y,!0)),i.selected&&(i.state="select"),"name"in i&&n===undefined&&s.xAxis&&s.xAxis.hasNames&&(i.x=s.xAxis.nameToX(i)),i.x===undefined&&s&&(n===undefined?i.x=s.autoIncrement(i):i.x=n),i},optionsToObject:function(e){var t={},n=this.series,r=n.options.keys,i=r||n.pointArrayMap||["y"],s=i.length,o,f=0,l=0;if(a(e)||e===null)t[i[0]]=e;else if(u(e)){!r&&e.length>s&&(o=typeof e[0],o==="string"?t.name=e[0]:o==="number"&&(t.x=e[0]),f++);while(l<s){if(!r||e[f]!==undefined)t[i[l]]=e[f];f++,l++}}else typeof e=="object"&&(t=e,e.dataLabels&&(n._hasPointLabels=!0),e.marker&&(n._hasPointMarkers=!0));return t},getClassName:function(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==undefined?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")},getZone:function(){var e=this.series,t=e.zones,n=e.zoneAxis||"y",r=0,i;i=t[r];while(this[n]>=i.value)i=t[++r];return i&&i.color&&!this.options.color&&(this.color=i.color),i},destroy:function(){var e=this,t=e.series,n=t.chart,r=n.hoverPoints,s;n.pointCount--,r&&(e.setState(),i(r,e),r.length||(n.hoverPoints=null)),e===n.hoverPoint&&e.onMouseOut();if(e.graphic||e.dataLabel)l(e),e.destroyElements();e.legendItem&&n.legend.destroyItem(e);for(s in e)e[s]=null},destroyElements:function(){var e=this,t=["graphic","dataLabel","dataLabelUpper","connector","shadowGroup"],n,r=6;while(r--)n=t[r],e[n]&&(e[n]=e[n].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(e){var t=this.series,r=t.tooltipOptions,i=f(r.valueDecimals,""),s=r.valuePrefix||"",u=r.valueSuffix||"";return n(t.pointArrayMap||["y"],function(t){t="{point."+t;if(s||u)e=e.replace(t+"}",s+t+"}"+u);e=e.replace(t+"}",t+":,."+i+"f}")}),o(e,{point:this,series:this.series})},firePointEvent:function(e,t,n){var r=this,i=this.series,o=i.options;(o.point.events[e]||r.options&&r.options.events&&r.options.events[e])&&this.importEvents(),e==="click"&&o.allowPointSelect&&(n=function(e){r.select&&r.select(null,e.ctrlKey||e.metaKey||e.shiftKey)}),s(this,e,t,n)},visible:!0}}(t),function(e){var t=e.addEvent,n=e.animObject,r=e.arrayMax,i=e.arrayMin,s=e.correctFloat,o=e.Date,u=e.defaultOptions,a=e.defaultPlotOptions,f=e.defined,l=e.each,c=e.erase,h=e.extend,p=e.fireEvent,d=e.grep,v=e.isArray,m=e.isNumber,g=e.isString,y=e.LegendSymbolMixin,b=e.merge,w=e.pick,E=e.Point,S=e.removeEvent,x=e.splat,T=e.SVGElement,N=e.syncTimeout,C=e.win;e.Series=e.seriesType("line",null,{lineWidth:2,allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},marker:{lineWidth:0,lineColor:"#ffffff",radius:4,states:{hover:{animation:{duration:50},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{align:"center",formatter:function(){return this.y===null?"":e.numberFormat(this.y,-1)},style:{fontSize:"11px",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0,padding:5},cropThreshold:300,pointRange:0,softThreshold:!0,states:{hover:{animation:{duration:50},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{marker:{}}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},{isCartesian:!0,pointClass:E,sorted:!0,requireSorting:!0,directTouch:!1,axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],coll:"series",init:function(e,n){var r=this,i,s,o=e.series,u;r.chart=e,r.options=n=r.setOptions(n),r.linkedSeries=[],r.bindAxes(),h(r,{name:n.name,state:"",visible:n.visible!==!1,selected:n.selected===!0}),s=n.events;for(i in s)t(r,i,s[i]);if(s&&s.click||n.point&&n.point.events&&n.point.events.click||n.allowPointSelect)e.runTrackerClick=!0;r.getColor(),r.getSymbol(),l(r.parallelArrays,function(e){r[e+"Data"]=[]}),r.setData(n.data,!1),r.isCartesian&&(e.hasCartesianSeries=!0),o.length&&(u=o[o.length-1]),r._i=w(u&&u._i,-1)+1,e.orderSeries(this.insert(o))},insert:function(e){var t=this.options.index,n;if(m(t)){n=e.length;while(n--)if(t>=w(e[n].options.index,e[n]._i)){e.splice(n+1,0,this);break}n===-1&&e.unshift(this),n+=1}else e.push(this);return w(n,e.length-1)},bindAxes:function(){var t=this,n=t.options,r=t.chart,i;l(t.axisTypes||[],function(s){l(r[s],function(e){i=e.options;if(n[s]===i.index||n[s]!==undefined&&n[s]===i.id||n[s]===undefined&&i.index===0)t.insert(e.series),t[s]=e,e.isDirty=!0}),!t[s]&&t.optionalAxis!==s&&e.error(18,!0)})},updateParallelArrays:function(e,t){var n=e.series,r=arguments,i=m(t)?function(r){var i=r==="y"&&n.toYData?n.toYData(e):e[r];n[r+"Data"][t]=i}:function(e){Array.prototype[t].apply(n[e+"Data"],Array.prototype.slice.call(r,2))};l(n.parallelArrays,i)},autoIncrement:function(){var e=this.options,t=this.xIncrement,n,r,i=e.pointIntervalUnit;return t=w(t,e.pointStart,0),this.pointInterval=r=w(this.pointInterval,e.pointInterval,1),i&&(n=new o(t),i==="day"?n=+n[o.hcSetDate](n[o.hcGetDate]()+r):i==="month"?n=+n[o.hcSetMonth](n[o.hcGetMonth]()+r):i==="year"&&(n=+n[o.hcSetFullYear](n[o.hcGetFullYear]()+r)),r=n-t),this.xIncrement=t+r,t},setOptions:function(e){var t=this.chart,n=t.options,r=n.plotOptions,i=t.userOptions||{},s=i.plotOptions||{},o=r[this.type],a,l;return this.userOptions=e,a=b(o,r.series,e),this.tooltipOptions=b(u.tooltip,u.plotOptions[this.type].tooltip,i.tooltip,s.series&&s.series.tooltip,s[this.type]&&s[this.type].tooltip,e.tooltip),this.stickyTracking=w(e.stickyTracking,s[this.type]&&s[this.type].stickyTracking,s.series&&s.series.stickyTracking,this.tooltipOptions.shared&&!this.noSharedTooltip?!0:a.stickyTracking),o.marker===null&&delete a.marker,this.zoneAxis=a.zoneAxis,l=this.zones=(a.zones||[]).slice(),(a.negativeColor||a.negativeFillColor)&&!a.zones&&l.push({value:a[this.zoneAxis+"Threshold"]||a.threshold||0,className:"highcharts-negative",color:a.negativeColor,fillColor:a.negativeFillColor}),l.length&&f(l[l.length-1].value)&&l.push({color:this.color,fillColor:this.fillColor}),a},getCyclic:function(e,t,n){var r,i=this.chart,s=this.userOptions,o=e+"Index",u=e+"Counter",a=n?n.length:w(i.options.chart[e+"Count"],i[e+"Count"]),l;t||(l=w(s[o],s["_"+o]),f(l)?r=l:(i.series.length||(i[u]=0),s["_"+o]=r=i[u]%a,i[u]+=1),n&&(t=n[r])),r!==undefined&&(this[o]=r),this[e]=t},getColor:function(){this.options.colorByPoint?this.options.color=null:this.getCyclic("color",this.options.color||a[this.type].color,this.chart.options.colors)},getSymbol:function(){var e=this.options.marker;this.getCyclic("symbol",e.symbol,this.chart.options.symbols)},drawLegendSymbol:y.drawLineMarker,setData:function(t,n,r,i){var s=this,o=s.points,u=o&&o.length||0,a,f=s.options,c=s.chart,h=null,p=s.xAxis,d,y=f.turboThreshold,b,E=this.xData,S=this.yData,x=s.pointArrayMap,T=x&&x.length;t=t||[],a=t.length,n=w(n,!0);if(i!==!1&&a&&u===a&&!s.cropped&&!s.hasGroupedData&&s.visible)l(t,function(e,t){o[t].update&&e!==f.data[t]&&o[t].update(e,!1,null,!1)});else{s.xIncrement=null,s.colorCounter=0,l(this.parallelArrays,function(e){s[e+"Data"].length=0});if(y&&a>y){d=0;while(h===null&&d<a)h=t[d],d++;if(m(h))for(d=0;d<a;d++)E[d]=this.autoIncrement(),S[d]=t[d];else if(v(h))if(T)for(d=0;d<a;d++)b=t[d],E[d]=b[0],S[d]=b.slice(1,T+1);else for(d=0;d<a;d++)b=t[d],E[d]=b[0],S[d]=b[1];else e.error(12)}else for(d=0;d<a;d++)t[d]!==undefined&&(b={series:s},s.pointClass.prototype.applyOptions.apply(b,[t[d]]),s.updateParallelArrays(b,d));g(S[0])&&e.error(14,!0),s.data=[],s.options.data=s.userOptions.data=t,d=u;while(d--)o[d]&&o[d].destroy&&o[d].destroy();p&&(p.minRange=p.userMinRange),s.isDirty=c.isDirtyBox=!0,s.isDirtyData=!!o,r=!1}f.legendType==="point"&&(this.processData(),this.generatePoints()),n&&c.redraw(r)},processData:function(t){var n=this,r=n.xData,i=n.yData,s=r.length,o,u=0,a,f,l,c=n.xAxis,h,p=n.options,d=p.cropThreshold,v=n.getExtremesFromAll||p.getExtremesFromAll,m=n.isCartesian,g,y=c&&c.val2lin,b=c&&c.isLog,w,E;if(m&&!n.isDirty&&!c.isDirty&&!n.yAxis.isDirty&&!t)return!1;c&&(g=c.getExtremes(),w=g.min,E=g.max);if(m&&n.sorted&&!v&&(!d||s>d||n.forceCrop))if(r[s-1]<w||r[0]>E)r=[],i=[];else if(r[0]<w||r[s-1]>E)o=this.cropData(n.xData,n.yData,w,E),r=o.xData,i=o.yData,u=o.start,a=!0;h=r.length||1;while(--h)f=b?y(r[h])-y(r[h-1]):r[h]-r[h-1],f>0&&(l===undefined||f<l)?l=f:f<0&&n.requireSorting&&e.error(15);n.cropped=a,n.cropStart=u,n.processedXData=r,n.processedYData=i,n.closestPointRange=l},cropData:function(e,t,n,r){var i=e.length,s=0,o=i,u=w(this.cropShoulder,1),a,f;for(a=0;a<i;a++)if(e[a]>=n){s=Math.max(0,a-u);break}for(f=a;f<i;f++)if(e[f]>r){o=f+u;break}return{xData:e.slice(s,o),yData:t.slice(s,o),start:s,end:o}},generatePoints:function(){var e=this,t=e.options,n=t.data,r=e.data,i,s=e.processedXData,o=e.processedYData,u=e.pointClass,a=s.length,f=e.cropStart||0,l,c=e.hasGroupedData,h,p=[],d;if(!r&&!c){var v=[];v.length=n.length,r=e.data=v}for(d=0;d<a;d++)l=f+d,c?(h=(new u).init(e,[s[d]].concat(x(o[d]))),h.dataGroup=e.groupMap[d]):(h=r[l],!h&&n[l]!==undefined&&(r[l]=h=(new u).init(e,n[l],s[d]))),h&&(h.index=l,p[d]=h);if(r&&(a!==(i=r.length)||c))for(d=0;d<i;d++)d===f&&!c&&(d+=a),r[d]&&(r[d].destroyElements(),r[d].plotX=undefined);e.data=r,e.points=p},getExtremes:function(e){var t=this.xAxis,n=this.yAxis,s=this.processedXData,o,u=[],a=0,f=t.getExtremes(),l=f.min,c=f.max,h,p,d,g,y,b;e=e||this.stackedYData||this.processedYData||[],o=e.length;for(y=0;y<o;y++){d=s[y],g=e[y],h=(m(g,!0)||v(g))&&(!n.positiveValuesOnly||g.length||g>0),p=this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||(s[y]||d)>=l&&(s[y]||d)<=c;if(h&&p){b=g.length;if(b)while(b--)g[b]!==null&&(u[a++]=g[b]);else u[a++]=g}}this.dataMin=i(u),this.dataMax=r(u)},translate:function(){this.processedXData||this.processData(),this.generatePoints();var e=this,t=e.options,n=t.stacking,r=e.xAxis,i=r.categories,o=e.yAxis,u=e.points,a=u.length,l=!!e.modifyValue,c,h=t.pointPlacement,p=h==="between"||m(h),d=t.threshold,v=t.startFromThreshold?d:0,g,y,b,E,S=Number.MAX_VALUE;h==="between"&&(h=.5),m(h)&&(h*=w(t.pointRange||r.pointRange));for(c=0;c<a;c++){var x=u[c],T=x.x,N=x.y,C=x.low,k=n&&o.stacks[(e.negStacks&&N<(v?0:d)?"-":"")+e.stackKey],L,A;o.positiveValuesOnly&&N!==null&&N<=0&&(x.isNull=!0),x.plotX=g=s(Math.min(Math.max(-1e5,r.translate(T,0,0,0,1,h,this.type==="flags")),1e5)),n&&e.visible&&!x.isNull&&k&&k[T]&&(E=e.getStackIndicator(E,T,e.index),L=k[T],A=L.points[E.key],C=A[0],N=A[1],C===v&&E.key===k[T].base&&(C=w(d,o.min)),o.positiveValuesOnly&&C<=0&&(C=null),x.total=x.stackTotal=L.total,x.percentage=L.total&&x.y/L.total*100,x.stackY=N,L.setOffset(e.pointXOffset||0,e.barW||0)),x.yBottom=f(C)?o.translate(C,0,1,0,1):null,l&&(N=e.modifyValue(N,x)),x.plotY=y=typeof N=="number"&&N!==Infinity?Math.min(Math.max(-1e5,o.translate(N,0,1,0,1)),1e5):undefined,x.isInside=y!==undefined&&y>=0&&y<=o.len&&g>=0&&g<=r.len,x.clientX=p?s(r.translate(T,0,0,0,1,h)):g,x.negative=x.y<(d||0),x.category=i&&i[x.x]!==undefined?i[x.x]:x.x,x.isNull||(b!==undefined&&(S=Math.min(S,Math.abs(g-b))),b=g),x.zone=this.zones.length&&x.getZone()}e.closestPointRangePx=S},getValidPoints:function(e,t){var n=this.chart;return d(e||this.points||[],function(r){return t&&!n.isInsidePlot(r.plotX,r.plotY,n.inverted)?!1:!r.isNull})},setClip:function(e){var t=this.chart,n=this.options,r=t.renderer,i=t.inverted,s=this.clipBox,o=s||t.clipBox,u=this.sharedClipKey||["_sharedClip",e&&e.duration,e&&e.easing,o.height,n.xAxis,n.yAxis].join(","),a=t[u],f=t[u+"m"];a||(e&&(o.width=0,t[u+"m"]=f=r.clipRect(-99,i?-t.plotLeft:-t.plotTop,99,i?t.chartWidth:t.chartHeight)),t[u]=a=r.clipRect(o),a.count={length:0}),e&&(a.count[this.index]||(a.count[this.index]=!0,a.count.length+=1)),n.clip!==!1&&(this.group.clip(e||s?a:t.clipRect),this.markerGroup.clip(f),this.sharedClipKey=u),e||(a.count[this.index]&&(delete a.count[this.index],a.count.length-=1),a.count.length===0&&u&&t[u]&&(s||(t[u]=t[u].destroy()),t[u+"m"]&&(t[u+"m"]=t[u+"m"].destroy())))},animate:function(e){var t=this,r=t.chart,i,s=n(t.options.animation),o;e?t.setClip(s):(o=this.sharedClipKey,i=r[o],i&&i.animate({width:r.plotSizeX},s),r[o+"m"]&&r[o+"m"].animate({width:r.plotSizeX+99},s),t.animate=null)},afterAnimate:function(){this.setClip(),p(this,"afterAnimate")},drawPoints:function(){var e=this,t=e.points,n=e.chart,r,i,s,o,u,a=e.options,f=a.marker,l,c,h,p,d=e.markerGroup,v=e.xAxis,g,y=w(f.enabled,v.isRadial?!0:null,e.closestPointRangePx>=2*f.radius);if(f.enabled!==!1||e._hasPointMarkers)for(i=0;i<t.length;i++)s=t[i],r=s.plotY,u=s.graphic,l=s.marker||{},c=!!s.marker,h=y&&l.enabled===undefined||l.enabled,p=s.isInside,h&&m(r)&&s.y!==null?(o=w(l.symbol,e.symbol),s.hasImage=o.indexOf("url")===0,g=e.markerAttribs(s,s.selected&&"select"),u?u[p?"show":"hide"](!0).animate(g):p&&(g.width>0||s.hasImage)&&(s.graphic=u=n.renderer.symbol(o,g.x,g.y,g.width,g.height,c?l:f).add(d)),u&&u.attr(e.pointAttribs(s,s.selected&&"select")),u&&u.addClass(s.getClassName(),!0)):u&&(s.graphic=u.destroy())},markerAttribs:function(e,t){var n=this.options.marker,r,i=e.marker||{},s,o=w(i.radius,n.radius),u;return t&&(r=n.states[t],s=i.states&&i.states[t],o=w(s&&s.radius,r&&r.radius,o+(r&&r.radiusPlus||0))),e.hasImage&&(o=0),u={x:Math.floor(e.plotX)-o,y:e.plotY-o},o&&(u.width=u.height=2*o),u},pointAttribs:function(e,t){var n=this.options.marker,r,i=e&&e.options,s=i&&i.marker||{},o,u=this.color,a=i&&i.color,f=e&&e.color,l=w(s.lineWidth,n.lineWidth),c=e&&e.zone&&e.zone.color,h,p;return u=a||c||f||u,h=s.fillColor||n.fillColor||u,p=s.lineColor||n.lineColor||u,t&&(r=n.states[t],o=s.states&&s.states[t]||{},l=w(o.lineWidth,r.lineWidth,l+w(o.lineWidthPlus,r.lineWidthPlus,0)),h=o.fillColor||r.fillColor||h,p=o.lineColor||r.lineColor||p),{stroke:p,"stroke-width":l,fill:h}},destroy:function(){var e=this,t=e.chart,n=/AppleWebKit\/533/.test(C.navigator.userAgent),r,i,s=e.data||[],o,u,a;p(e,"destroy"),S(e),l(e.axisTypes||[],function(t){a=e[t],a&&a.series&&(c(a.series,e),a.isDirty=a.forceRedraw=!0)}),e.legendItem&&e.chart.legend.destroyItem(e),i=s.length;while(i--)o=s[i],o&&o.destroy&&o.destroy();e.points=null,clearTimeout(e.animationTimeout);for(u in e)e[u]instanceof T&&!e[u].survive&&(r=n&&u==="group"?"hide":"destroy",e[u][r]());t.hoverSeries===e&&(t.hoverSeries=null),c(t.series,e),t.orderSeries();for(u in e)delete e[u]},getGraphPath:function(e,t,n){var r=this,i=r.options,s=i.step,o,u=[],a=[],c;return e=e||r.points,o=e.reversed,o&&e.reverse(),s={right:1,center:2}[s]||s&&3,s&&o&&(s=4-s),i.connectNulls&&!t&&!n&&(e=this.getValidPoints(e)),l(e,function(o,l){var h=o.plotX,p=o.plotY,d=e[l-1],v;(o.leftCliff||d&&d.rightCliff)&&!n&&(c=!0),o.isNull&&!f(t)&&l>0?c=!i.connectNulls:o.isNull&&!t?c=!0:(l===0||c?v=["M",o.plotX,o.plotY]:r.getPointSpline?v=r.getPointSpline(e,o,l):s?(s===1?v=["L",d.plotX,p]:s===2?v=["L",(d.plotX+h)/2,d.plotY,"L",(d.plotX+h)/2,p]:v=["L",h,d.plotY],v.push("L",h,p)):v=["L",h,p],a.push(o.x),s&&a.push(o.x),u.push.apply(u,v),c=!1)}),u.xMap=a,r.graphPath=u,u},drawGraph:function(){var e=this,t=this.options,n=(this.gappedPath||this.getGraphPath).call(this),r=[["graph","highcharts-graph",t.lineColor||this.color,t.dashStyle]];l(this.zones,function(n,i){r.push(["zone-graph-"+i,"highcharts-graph highcharts-zone-graph-"+i+" "+(n.className||""),n.color||e.color,n.dashStyle||t.dashStyle])}),l(r,function(r,i){var s=r[0],o=e[s],u;o?(o.endX=n.xMap,o.animate({d:n})):n.length&&(e[s]=e.chart.renderer.path(n).addClass(r[1]).attr({zIndex:1}).add(e.group),u={stroke:r[2],"stroke-width":t.lineWidth,fill:e.fillGraph&&e.color||"none"},r[3]?u.dashstyle=r[3]:t.linecap!=="square"&&(u["stroke-linecap"]=u["stroke-linejoin"]="round"),o=e[s].attr(u).shadow(i<2&&t.shadow)),o&&(o.startX=n.xMap,o.isArea=n.isArea)})},applyZones:function(){var e=this,t=this.chart,n=t.renderer,r=this.zones,i,s,o=this.clips||[],u,a=this.graph,f=this.area,c=Math.max(t.chartWidth,t.chartHeight),h=this[(this.zoneAxis||"y")+"Axis"],p,d,v=t.inverted,m,g,y,b,E=!1;r.length&&(a||f)&&h&&h.min!==undefined&&(d=h.reversed,m=h.horiz,a&&a.hide(),f&&f.hide(),p=h.getExtremes(),l(r,function(r,l){i=d?m?t.plotWidth:0:m?0:h.toPixels(p.min),i=Math.min(Math.max(w(s,i),0),c),s=Math.min(Math.max(Math.round(h.toPixels(w(r.value,p.max),!0)),0),c),E&&(i=s=h.toPixels(p.max)),g=Math.abs(i-s),y=Math.min(i,s),b=Math.max(i,s),h.isXAxis?(u={x:v?b:y,y:0,width:g,height:c},m||(u.x=t.plotHeight-u.x)):(u={x:0,y:v?b:y,width:c,height:g},m&&(u.y=t.plotWidth-u.y)),v&&n.isVML&&(h.isXAxis?u={x:0,y:d?y:b,height:u.width,width:t.chartWidth}:u={x:u.y-t.plotLeft-t.spacingBox.x,y:0,width:u.height,height:t.chartHeight}),o[l]?o[l].animate(u):(o[l]=n.clipRect(u),a&&e["zone-graph-"+l].clip(o[l]),f&&e["zone-area-"+l].clip(o[l])),E=r.value>p.max}),this.clips=o)},invertGroups:function(e){function s(){l(["group","markerGroup"],function(t){n[t]&&(r.renderer.isVML&&n[t].attr({width:n.yAxis.len,height:n.xAxis.len}),n[t].width=n.yAxis.len,n[t].height=n.xAxis.len,n[t].invert(e))})}var n=this,r=n.chart,i;if(!n.xAxis)return;i=t(r,"resize",s),t(n,"destroy",i),s(e),n.invertGroups=s},plotGroup:function(e,t,n,r,i){var s=this[e],o=!s;return o&&(this[e]=s=this.chart.renderer.g(t).attr({zIndex:r||.1}).add(i),s.addClass("highcharts-series-"+this.index+" highcharts-"+this.type+"-series highcharts-color-"+this.colorIndex+" "+(this.options.className||""))),s.attr({visibility:n})[o?"attr":"animate"](this.getPlotBox()),s},getPlotBox:function(){var e=this.chart,t=this.xAxis,n=this.yAxis;return e.inverted&&(t=n,n=this.xAxis),{translateX:t?t.left:e.plotLeft,translateY:n?n.top:e.plotTop,scaleX:1,scaleY:1}},render:function(){var e=this,t=e.chart,r,i=e.options,s=!!e.animate&&t.renderer.isSVG&&n(i.animation).duration,o=e.visible?"inherit":"hidden",u=i.zIndex,a=e.hasRendered,f=t.seriesGroup,l=t.inverted;r=e.plotGroup("group","series",o,u,f),e.markerGroup=e.plotGroup("markerGroup","markers",o,u,f),s&&e.animate(!0),r.inverted=e.isCartesian?l:!1,e.drawGraph&&(e.drawGraph(),e.applyZones()),e.drawDataLabels&&e.drawDataLabels(),e.visible&&e.drawPoints(),e.drawTracker&&e.options.enableMouseTracking!==!1&&e.drawTracker(),e.invertGroups(l),i.clip!==!1&&!e.sharedClipKey&&!a&&r.clip(t.clipRect),s&&e.animate(),a||(e.animationTimeout=N(function(){e.afterAnimate()},s)),e.isDirty=!1,e.hasRendered=!0},redraw:function(){var e=this,t=e.chart,n=e.isDirty||e.isDirtyData,r=e.group,i=e.xAxis,s=e.yAxis;r&&(t.inverted&&r.attr({width:t.plotWidth,height:t.plotHeight}),r.animate({translateX:w(i&&i.left,t.plotLeft),translateY:w(s&&s.top,t.plotTop)})),e.translate(),e.render(),n&&delete this.kdTree},kdAxisArray:["clientX","plotY"],searchPoint:function(e,t){var n=this,r=n.xAxis,i=n.yAxis,s=n.chart.inverted;return this.searchKDTree({clientX:s?r.len-e.chartY+r.pos:e.chartX-r.pos,plotY:s?i.len-e.chartX+i.pos:e.chartY-i.pos},t)},buildKDTree:function(){function n(t,r,i){var s,o,u=t&&t.length;if(u)return s=e.kdAxisArray[r%i],t.sort(function(e,t){return e[s]-t[s]}),o=Math.floor(u/2),{point:t[o],left:n(t.slice(0,o),r+1,i),right:n(t.slice(o+1),r+1,i)}}function r(){e.kdTree=n(e.getValidPoints(null,!e.directTouch),t,t),e.buildingKdTree=!1}this.buildingKdTree=!0;var e=this,t=e.options.findNearestPointBy.indexOf("y")>-1?2:1;delete e.kdTree,N(r,e.options.kdNow?0:1)},searchKDTree:function(e,t){function u(e,t){var n=f(e[r])&&f(t[r])?Math.pow(e[r]-t[r],2):null,s=f(e[i])&&f(t[i])?Math.pow(e[i]-t[i],2):null,o=(n||0)+(s||0);t.dist=f(o)?Math.sqrt(o):Number.MAX_VALUE,t.distX=f(n)?Math.sqrt(n):Number.MAX_VALUE}function a(e,t,r,i){var o=t.point,f=n.kdAxisArray[r%i],l,c,h,p=o,d,v;return u(e,o),l=e[f]-o[f],c=l<0?"left":"right",h=l<0?"right":"left",t[c]&&(d=a(e,t[c],r+1,i),p=d[s]<p[s]?d:o),t[h]&&Math.sqrt(l*l)<p[s]&&(v=a(e,t[h],r+1,i),p=v[s]<p[s]?v:p),p}var n=this,r=this.kdAxisArray[0],i=this.kdAxisArray[1],s=t?"distX":"dist",o=n.options.findNearestPointBy.indexOf("y")>-1?2:1;!this.kdTree&&!this.buildingKdTree&&this.buildKDTree();if(this.kdTree)return a(e,this.kdTree,o,o)}})}(t),function(e){function l(e,t,n,r,i){var s=e.chart.inverted;this.axis=e,this.isNegative=n,this.options=t,this.x=r,this.total=null,this.points={},this.stack=i,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:t.align||(s?n?"left":"right":"center"),verticalAlign:t.verticalAlign||(s?"middle":n?"bottom":"top"),y:a(t.y,s?4:n?14:-6),x:a(t.x,s?n?-6:6:0)},this.textAlign=t.textAlign||(s?n?"right":"left":"center")}var t=e.Axis,n=e.Chart,r=e.correctFloat,i=e.defined,s=e.destroyObjectProperties,o=e.each,u=e.format,a=e.pick,f=e.Series;l.prototype={destroy:function(){s(this,this.axis)},render:function(e){var t=this.options,n=t.format,r=n?u(n,this):t.formatter.call(this);this.label?this.label.attr({text:r,visibility:"hidden"}):this.label=this.axis.chart.renderer.text(r,null,null,t.useHTML).css(t.style).attr({align:this.textAlign,rotation:t.rotation,visibility:"hidden"}).add(e)},setOffset:function(e,t){var n=this,r=n.axis,i=r.chart,s=i.inverted,o=r.reversed,u=this.isNegative&&!o||!this.isNegative&&o,a=r.translate(r.usePercentage?100:this.total,0,0,0,1),f=r.translate(0),l=Math.abs(a-f),c=i.xAxis[0].translate(this.x)+e,h=i.plotHeight,p={x:s?u?a:a-l:c,y:s?h-c-t:u?h-a-l:h-a,width:s?l:t,height:s?t:l},d=this.label,v;d&&(d.align(this.alignOptions,null,p),v=d.alignAttr,d[this.options.crop===!1||i.isInsidePlot(v.x,v.y)?"show":"hide"](!0))}},n.prototype.getStacks=function(){var e=this;o(e.yAxis,function(e){e.stacks&&e.hasVisibleSeries&&(e.oldStacks=e.stacks)}),o(e.series,function(t){t.options.stacking&&(t.visible===!0||e.options.chart.ignoreHiddenSeries===!1)&&(t.stackKey=t.type+a(t.options.stack,""))})},t.prototype.buildStacks=function(){var e=this.series,t,n=a(this.options.reversedStacks,!0),r=e.length,i;if(!this.isXAxis){this.usePercentage=!1,i=r;while(i--)e[n?i:r-i-1].setStackedPoints();i=r;while(i--)t=e[n?i:r-i-1],t.setStackCliffs&&t.setStackCliffs();if(this.usePercentage)for(i=0;i<r;i++)e[i].setPercentStacks()}},t.prototype.renderStackTotals=function(){var e=this,t=e.chart,n=t.renderer,r=e.stacks,i,s,o,u=e.stackTotalGroup;u||(e.stackTotalGroup=u=n.g("stack-labels").attr({visibility:"visible",zIndex:6}).add()),u.translate(t.plotLeft,t.plotTop);for(i in r){s=r[i];for(o in s)s[o].render(u)}},t.prototype.resetStacks=function(){var e=this.stacks,t,n;if(!this.isXAxis)for(t in e)for(n in e[t])e[t][n].touched<this.stacksTouched?(e[t][n].destroy(),delete e[t][n]):(e[t][n].total=null,e[t][n].cum=null)},t.prototype.cleanStacks=function(){var e,t,n;if(!this.isXAxis){this.oldStacks&&(e=this.stacks=this.oldStacks);for(t in e)for(n in e[t])e[t][n].cum=e[t][n].total}},f.prototype.setStackedPoints=function(){if(!this.options.stacking||this.visible!==!0&&this.chart.options.chart.ignoreHiddenSeries!==!1)return;var e=this,t=e.processedXData,n=e.processedYData,s=[],o=n.length,u=e.options,f=u.threshold,c=u.startFromThreshold?f:0,h=u.stack,p=u.stacking,d=e.stackKey,v="-"+d,m=e.negStacks,g=e.yAxis,y=g.stacks,b=g.oldStacks,w,E,S,x,T,N,C,k,L;g.stacksTouched+=1;for(C=0;C<o;C++)k=t[C],L=n[C],w=e.getStackIndicator(w,k,e.index),N=w.key,E=m&&L<(c?0:f),T=E?v:d,y[T]||(y[T]={}),y[T][k]||(b[T]&&b[T][k]?(y[T][k]=b[T][k],y[T][k].total=null):y[T][k]=new l(g,g.options.stackLabels,E,k,h)),S=y[T][k],L!==null&&(S.points[N]=S.points[e.index]=[a(S.cum,c)],i(S.cum)||(S.base=N),S.touched=g.stacksTouched,w.index>0&&e.singleStacks===!1&&(S.points[N][0]=S.points[e.index+","+k+",0"][0])),p==="percent"?(x=E?d:v,m&&y[x]&&y[x][k]?(x=y[x][k],S.total=x.total=Math.max(x.total,S.total)+Math.abs(L)||0):S.total=r(S.total+(Math.abs(L)||0))):S.total=r(S.total+(L||0)),S.cum=a(S.cum,c)+(L||0),L!==null&&(S.points[N].push(S.cum),s[C]=S.cum);p==="percent"&&(g.usePercentage=!0),this.stackedYData=s,g.oldStacks={}},f.prototype.setPercentStacks=function(){var e=this,t=e.stackKey,n=e.yAxis.stacks,i=e.processedXData,s;o([t,"-"+t],function(t){var o=i.length,u,a,f,l;while(o--)u=i[o],s=e.getStackIndicator(s,u,e.index,t),a=n[t]&&n[t][u],f=a&&a.points[s.key],f&&(l=a.total?100/a.total:0,f[0]=r(f[0]*l),f[1]=r(f[1]*l),e.stackedYData[o]=f[1])})},f.prototype.getStackIndicator=function(e,t,n,r){return!i(e)||e.x!==t||r&&e.key!==r?e={x:t,index:0,key:r}:e.index++,e.key=[n,t,e.index].join(","),e}}(t),function(e){var t=e.addEvent,n=e.animate,r=e.Axis,i=e.Chart,s=e.createElement,o=e.css,u=e.defined,a=e.each,f=e.erase,l=e.extend,c=e.fireEvent,h=e.inArray,p=e.isNumber,d=e.isObject,v=e.merge,m=e.pick,g=e.Point,y=e.Series,b=e.seriesTypes,w=e.setAnimation,E=e.splat;l(i.prototype,{addSeries:function(e,t,n){var r,i=this;return e&&(t=m(t,!0),c(i,"addSeries",{options:e},function(){r=i.initSeries(e),i.isDirtyLegend=!0,i.linkSeries(),t&&i.redraw(n)})),r},addAxis:function(e,t,n,i){var s=t?"xAxis":"yAxis",o=this.options,u=v(e,{index:this[s].length,isX:t});new r(this,u),o[s]=E(o[s]||{}),o[s].push(u),m(n,!0)&&this.redraw(i)},showLoading:function(e){var r=this,i=r.options,u=r.loadingDiv,a=i.loading,f=function(){u&&o(u,{left:r.plotLeft+"px",top:r.plotTop+"px",width:r.plotWidth+"px",height:r.plotHeight+"px"})};u||(r.loadingDiv=u=s("div",{className:"highcharts-loading highcharts-loading-hidden"},null,r.container),r.loadingSpan=s("span",{className:"highcharts-loading-inner"},null,u),t(r,"redraw",f)),u.className="highcharts-loading",r.loadingSpan.innerHTML=e||i.lang.loading,o(u,l(a.style,{zIndex:10})),o(r.loadingSpan,a.labelStyle),r.loadingShown||(o(u,{opacity:0,display:""}),n(u,{opacity:a.style.opacity||.5},{duration:a.showDuration||0})),r.loadingShown=!0,f()},hideLoading:function(){var e=this.options,t=this.loadingDiv;t&&(t.className="highcharts-loading highcharts-loading-hidden",n(t,{opacity:0},{duration:e.loading.hideDuration||100,complete:function(){o(t,{display:"none"})}})),this.loadingShown=!1},propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions"],update:function(e,t){var n,r={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle"},i=e.chart,s,o,f,l;if(i){v(!0,this.options.chart,i),"className"in i&&this.setClassName(i.className);if("inverted"in i||"polar"in i)this.propFromSeries(),s=!0;"alignTicks"in i&&(s=!0);for(n in i)i.hasOwnProperty(n)&&(h("chart."+n,this.propsRequireUpdateSeries)!==-1&&(o=!0),h(n,this.propsRequireDirtyBox)!==-1&&(this.isDirtyBox=!0));"style"in i&&this.renderer.setStyle(i.style)}for(n in e)this[n]&&typeof this[n].update=="function"?this[n].update(e[n],!1):typeof this[r[n]]=="function"&&this[r[n]](e[n]),n!=="chart"&&h(n,this.propsRequireUpdateSeries)!==-1&&(o=!0);e.colors&&(this.options.colors=e.colors),e.plotOptions&&v(!0,this.options.plotOptions,e.plotOptions),a(["xAxis","yAxis","series","colorAxis","pane"],function(t){e[t]&&a(E(e[t]),function(e,n){var r=u(e.id)&&this.get(e.id)||this[t][n];r&&r.coll===t&&r.update(e,!1)},this)},this),s&&a(this.axes,function(e){e.update({},!1)}),o&&a(this.series,function(e){e.update({},!1)}),e.loading&&v(!0,this.options.loading,e.loading),f=i&&i.width,l=i&&i.height,p(f)&&f!==this.chartWidth||p(l)&&l!==this.chartHeight?this.setSize(f,l):m(t,!0)&&this.redraw()},setSubtitle:function(e){this.setTitle(undefined,e)}}),l(g.prototype,{update:function(e,t,n,r){function l(){i.applyOptions(e),i.y===null&&o&&(i.graphic=o.destroy()),d(e,!0)&&(o&&o.element&&e&&e.marker&&e.marker.symbol&&(i.graphic=o.destroy()),e&&e.dataLabels&&i.dataLabel&&(i.dataLabel=i.dataLabel.destroy())),u=i.index,s.updateParallelArrays(i,u),f.data[u]=d(f.data[u],!0)||d(e,!0)?i.options:e,s.isDirty=s.isDirtyData=!0,!s.fixedBox&&s.hasCartesianSeries&&(a.isDirtyBox=!0),f.legendType==="point"&&(a.isDirtyLegend=!0),t&&a.redraw(n)}var i=this,s=i.series,o=i.graphic,u,a=s.chart,f=s.options;t=m(t,!0),r===!1?l():i.firePointEvent("update",{options:e},l)},remove:function(e,t){this.series.removePoint(h(this,this.series.data),e,t)}}),l(y.prototype,{addPoint:function(e,t,n,r){var i=this,s=i.options,o=i.data,u=i.chart,a=i.xAxis,f=a&&a.hasNames&&a.names,l=s.data,c,h,p=i.xData,d,v;t=m(t,!0),c={series:i},i.pointClass.prototype.applyOptions.apply(c,[e]),v=c.x,d=p.length;if(i.requireSorting&&v<p[d-1]){h=!0;while(d&&p[d-1]>v)d--}i.updateParallelArrays(c,"splice",d,0,0),i.updateParallelArrays(c,d),f&&c.name&&(f[v]=c.name),l.splice(d,0,e),h&&(i.data.splice(d,0,null),i.processData()),s.legendType==="point"&&i.generatePoints(),n&&(o[0]&&o[0].remove?o[0].remove(!1):(o.shift(),i.updateParallelArrays(c,"shift"),l.shift())),i.isDirty=!0,i.isDirtyData=!0,t&&u.redraw(r)},removePoint:function(e,t,n){var r=this,i=r.data,s=i[e],o=r.points,u=r.chart,a=function(){o&&o.length===i.length&&o.splice(e,1),i.splice(e,1),r.options.data.splice(e,1),r.updateParallelArrays(s||{series:r},"splice",e,1),s&&s.destroy(),r.isDirty=!0,r.isDirtyData=!0,t&&u.redraw()};w(n,u),t=m(t,!0),s?s.firePointEvent("remove",null,a):a()},remove:function(e,t,n){function s(){r.destroy(),i.isDirtyLegend=i.isDirtyBox=!0,i.linkSeries(),m(e,!0)&&i.redraw(t)}var r=this,i=r.chart;n!==!1?c(r,"remove",null,s):s()},update:function(e,t){var n=this,r=this.chart,i=this.userOptions,s=this.oldType||this.type,o=e.type||i.type||r.options.chart.type,u=b[s].prototype,f=["group","markerGroup","dataLabelsGroup"],c;if(o&&o!==s||e.zIndex!==undefined)f.length=0;a(f,function(e){f[e]=n[e],delete n[e]}),e=v(i,{animation:!1,index:this.index,pointStart:this.xData[0]},{data:this.options.data},e),this.remove(!1,null,!1);for(c in u)this[c]=undefined;l(this,b[o||s].prototype),a(f,function(e){n[e]=f[e]}),this.init(r,e),this.oldType=s,r.linkSeries(),m(t,!0)&&r.redraw(!1)}}),l(r.prototype,{update:function(e,t){var n=this.chart;e=n.options[this.coll][this.options.index]=v(this.userOptions,e),this.destroy(!0),this.init(n,l(e,{events:undefined})),n.isDirtyBox=!0,m(t,!0)&&n.redraw()},remove:function(e){var t=this.chart,n=this.coll,r=this.series,i=r.length;while(i--)r[i]&&r[i].remove(!1);f(t.axes,this),f(t[n],this),t.options[n].splice(this.options.index,1),a(t[n],function(e,t){e.options.index=t}),this.destroy(),t.isDirtyBox=!0,m(e,!0)&&t.redraw()},setTitle:function(e,t){this.update({title:e},t)},setCategories:function(e,t){this.update({categories:e},t)}})}(t),function(e){var t=e.color,n=e.each,r=e.LegendSymbolMixin,i=e.map,s=e.pick,o=e.Series,u=e.seriesType;u("area","line",{softThreshold:!1,threshold:0},{singleStacks:!1,getStackPoints:function(){var e=this,t=[],r=[],o=this.xAxis,u=this.yAxis,a=u.stacks[this.stackKey],f={},l=this.points,c=e.index,h=u.series,p=h.length,d,v=s(u.options.reversedStacks,!0)?1:-1,m,g;if(this.options.stacking){for(m=0;m<l.length;m++)f[l[m].x]=l[m];for(g in a)a[g].total!==null&&r.push(g);r.sort(function(e,t){return e-t}),d=i(h,function(){return this.visible}),n(r,function(e,i){var s=0,l,h;if(f[e]&&!f[e].isNull)t.push(f[e]),n([-1,1],function(t){var n=t===1?"rightNull":"leftNull",s=t===1?"rightCliff":"leftCliff",o=0,u=a[r[i+t]];if(u){m=c;while(m>=0&&m<p)l=u.points[m],l||(m===c?f[e][n]=!0:d[m]&&(h=a[e].points[m],h&&(o-=h[1]-h[0]))),m+=v}f[e][s]=o});else{m=c;while(m>=0&&m<p){l=a[e].points[m];if(l){s=l[1];break}m+=v}s=u.translate(s,0,1,0,1),t.push({isNull:!0,plotX:o.translate(e,0,0,0,1),x:e,plotY:s,yBottom:s})}})}return t},getGraphPath:function(e){var t=o.prototype.getGraphPath,n,r=this.options,i=r.stacking,u=this.yAxis,a,f,l=[],c=[],h=this.index,p,d,v,m=u.stacks[this.stackKey],g=r.threshold,y=u.getThreshold(r.threshold),b,w,E=r.connectNulls||i==="percent",S=function(t,n,r){var s=e[t],o=i&&m[s.x].points[h],a=s[r+"Null"]||0,f=s[r+"Cliff"]||0,p,d,b=!0;f||a?(p=(a?o[0]:o[1])+f,d=o[0]+f,b=!!a):!i&&e[n]&&e[n].isNull&&(p=d=g),p!==undefined&&(c.push({plotX:v,plotY:p===null?y:u.getThreshold(p),isNull:b,isCliff:!0}),l.push({plotX:v,plotY:d===null?y:u.getThreshold(d),doCurve:!1}))};e=e||this.points,i&&(e=this.getStackPoints());for(p=0;p<e.length;p++){b=e[p].isNull,v=s(e[p].rectPlotX,e[p].plotX),w=s(e[p].yBottom,y);if(!b||E)E||S(p,p-1,"left"),b&&!i&&E||(c.push(e[p]),l.push({x:p,plotX:v,plotY:w})),E||S(p,p+1,"right")}return a=t.call(this,c,!0,!0),l.reversed=!0,f=t.call(this,l,!0,!0),f.length&&(f[0]="L"),d=a.concat(f),n=t.call(this,c,!1,E),d.xMap=a.xMap,this.areaPath=d,n},drawGraph:function(){this.areaPath=[],o.prototype.drawGraph.apply(this);var e=this,r=this.areaPath,i=this.options,u=this.zones,a=[["area","highcharts-area",this.color,i.fillColor]];n(u,function(t,n){a.push(["zone-area-"+n,"highcharts-area highcharts-zone-area-"+n+" "+t.className,t.color||e.color,t.fillColor||i.fillColor])}),n(a,function(n){var o=n[0],u=e[o];u?(u.endX=r.xMap,u.animate({d:r})):(u=e[o]=e.chart.renderer.path(r).addClass(n[1]).attr({fill:s(n[3],t(n[2]).setOpacity(s(i.fillOpacity,.75)).get()),zIndex:0}).add(e.group),u.isArea=!0),u.startX=r.xMap,u.shiftUnit=i.step?2:1})},drawLegendSymbol:r.drawRectangle})}(t),function(e){var t=e.pick,n=e.seriesType;n("spline","line",{},{getPointSpline:function(e,n,r){function v(e){return e&&!e.isNull&&e.doCurve!==!1&&!n.isCliff}var i=1.5,s=i+1,o=n.plotX,u=n.plotY,a=e[r-1],f=e[r+1],l,c,h,p,d;if(v(a)&&v(f)){var m=a.plotX,g=a.plotY,y=f.plotX,b=f.plotY,w=0;l=(i*o+m)/s,c=(i*u+g)/s,h=(i*o+y)/s,p=(i*u+b)/s,h!==l&&(w=(p-c)*(h-o)/(h-l)+u-p),c+=w,p+=w,c>g&&c>u?(c=Math.max(g,u),p=2*u-c):c<g&&c<u&&(c=Math.min(g,u),p=2*u-c),p>b&&p>u?(p=Math.max(b,u),c=2*u-p):p<b&&p<u&&(p=Math.min(b,u),c=2*u-p),n.rightContX=h,n.rightContY=p}return d=["C",t(a.rightContX,a.plotX),t(a.rightContY,a.plotY),t(l,o),t(c,u),o,u],a.rightContX=a.rightContY=null,d}})}(t),function(e){var t=e.seriesTypes.area.prototype,n=e.defaultPlotOptions,r=e.LegendSymbolMixin,i=e.seriesType;i("areaspline","spline",n.area,{getStackPoints:t.getStackPoints,getGraphPath:t.getGraphPath,setStackCliffs:t.setStackCliffs,drawGraph:t.drawGraph,drawLegendSymbol:r.drawRectangle})}(t),function(e){var t=e.animObject,n=e.color,r=e.each,i=e.extend,s=e.isNumber,o=e.LegendSymbolMixin,u=e.merge,a=e.noop,f=e.pick,l=e.Series,c=e.seriesType,h=e.svg;c("column","line",{borderRadius:0,crisp:!0,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1,shadow:!1},select:{color:"#cccccc",borderColor:"#000000",shadow:!1}},dataLabels:{align:null,verticalAlign:null,y:null},softThreshold:!1,startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"},{cropShoulder:0,directTouch:!0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){l.prototype.init.apply(this,arguments);var e=this,t=e.chart;t.hasRendered&&r(t.series,function(t){t.type===e.type&&(t.isDirty=!0)})},getColumnMetrics:function(){var e=this,t=e.options,n=e.xAxis,i=e.yAxis,s=n.reversed,o,u={},a=0;t.grouping===!1?a=1:r(e.chart.series,function(t){var n=t.options,r=t.yAxis,s;t.type===e.type&&t.visible&&i.len===r.len&&i.pos===r.pos&&(n.stacking?(o=t.stackKey,u[o]===undefined&&(u[o]=a++),s=u[o]):n.grouping!==!1&&(s=a++),t.columnIndex=s)});var l=Math.min(Math.abs(n.transA)*(n.ordinalSlope||t.pointRange||n.closestPointRange||n.tickInterval||1),n.len),c=l*t.groupPadding,h=l-2*c,p=h/(a||1),d=Math.min(t.maxPointWidth||n.len,f(t.pointWidth,p*(1-2*t.pointPadding))),v=(p-d)/2,m=(e.columnIndex||0)+(s?1:0),g=v+(c+m*p-l/2)*(s?-1:1);return e.columnMetrics={width:d,offset:g},e.columnMetrics},crispCol:function(e,t,n,r){var i=this.chart,s=this.borderWidth,o=-(s%2?.5:0),u=s%2?.5:1,a,f,l;return i.inverted&&i.renderer.isVML&&(u+=1),this.options.crisp&&(a=Math.round(e+n)+o,e=Math.round(e)+o,n=a-e),f=Math.round(t+r)+u,l=Math.abs(t)<=.5&&f>.5,t=Math.round(t)+u,r=f-t,l&&r&&(t-=1,r+=1),{x:e,y:t,width:n,height:r}},translate:function(){var e=this,t=e.chart,n=e.options,i=e.dense=e.closestPointRange*e.xAxis.transA<2,s=e.borderWidth=f(n.borderWidth,i?0:1),o=e.yAxis,u=n.threshold,a=e.translatedThreshold=o.getThreshold(u),c=f(n.minPointLength,5),h=e.getColumnMetrics(),p=h.width,d=e.barW=Math.max(p,1+2*s),v=e.pointXOffset=h.offset;t.inverted&&(a-=.5),n.pointPadding&&(d=Math.ceil(d)),l.prototype.translate.apply(e),r(e.points,function(n){var r=f(n.yBottom,a),i=999+Math.abs(r),s=Math.min(Math.max(-i,n.plotY),o.len+i),u=n.plotX+v,l=d,h=Math.min(s,r),m,g=Math.max(s,r)-h;Math.abs(g)<c&&c&&(g=c,m=!o.reversed&&!n.negative||o.reversed&&n.negative,h=Math.abs(h-a)>c?r-c:a-(m?c:0)),n.barX=u,n.pointWidth=p,n.tooltipPos=t.inverted?[o.len+o.pos-t.plotLeft-s,e.xAxis.len-u-l/2,g]:[u+l/2,s+o.pos-t.plotTop,g],n.shapeType="rect",n.shapeArgs=e.crispCol.apply(e,n.isNull?[n.plotX,o.len/2,0,0]:[u,h,l,g])})},getSymbol:a,drawLegendSymbol:o.drawRectangle,drawGraph:function(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")},pointAttribs:function(e,t){var r=this.options,i,s,o=this.pointAttrToOptions||{},a=o.stroke||"borderColor",f=o["stroke-width"]||"borderWidth",l=e&&e.color||this.color,c=e[a]||r[a]||this.color||l,h=e[f]||r[f]||this[f]||0,p=r.dashStyle,d,v;return e&&this.zones.length&&(d=e.getZone(),l=d&&d.color||e.options.color||this.color),t&&(i=u(r.states[t],e.options.states&&e.options.states[t]||{}),v=i.brightness,l=i.color||v!==undefined&&n(l).brighten(i.brightness).get()||l,c=i[a]||c,h=i[f]||h,p=i.dashStyle||p),s={fill:l,stroke:c,"stroke-width":h},r.borderRadius&&(s.r=r.borderRadius),p&&(s.dashstyle=p),s},drawPoints:function(){var e=this,t=this.chart,n=e.options,i=t.renderer,o=n.animationLimit||250,a;r(e.points,function(r){var f=r.plotY,l=r.graphic;s(f)&&r.y!==null?(a=r.shapeArgs,l?l[t.pointCount<o?"animate":"attr"](u(a)):r.graphic=l=i[r.shapeType](a).add(r.group||e.group),l.attr(e.pointAttribs(r,r.selected&&"select")).shadow(n.shadow,null,n.stacking&&!n.borderRadius),l.addClass(r.getClassName(),!0)):l&&(r.graphic=l.destroy())})},animate:function(e){var n=this,r=this.yAxis,s=n.options,o=this.chart.inverted,u={},a;h&&(e?(u.scaleY=.001,a=Math.min(r.pos+r.len,Math.max(r.pos,r.toPixels(s.threshold))),o?u.translateX=a-r.len:u.translateY=a,n.group.attr(u)):(u[o?"translateX":"translateY"]=r.pos,n.group.animate(u,i(t(n.options.animation),{step:function(e,t){n.group.attr({scaleY:Math.max(.001,t.pos)})}})),n.animate=null))},remove:function(){var e=this,t=e.chart;t.hasRendered&&r(t.series,function(t){t.type===e.type&&(t.isDirty=!0)}),l.prototype.remove.apply(e,arguments)}})}(t),function(e){var t=e.seriesType;t("bar","column",null,{inverted:!0})}(t),function(e){var t=e.Series,n=e.seriesType;n("scatter","line",{lineWidth:0,findNearestPointBy:"xy",marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.85em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}},{sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1,drawGraph:function(){this.options.lineWidth&&t.prototype.drawGraph.call(this)}})}(t),function(e){var t=e.pick,n=e.relativeLength;e.CenteredSeriesMixin={getCenter:function(){var e=this.options,r=this.chart,i=2*(e.slicedOffset||0),s,o=r.plotWidth-2*i,u=r.plotHeight-2*i,a=e.center,f=[t(a[0],"50%"),t(a[1],"50%"),e.size||"100%",e.innerSize||0],l=Math.min(o,u),c,h;for(c=0;c<4;++c)h=f[c],s=c<2||c===2&&/%$/.test(h),f[c]=n(h,[o,u,l,f[2]][c])+(s?i:0);return f[3]>f[2]&&(f[3]=f[2]),f}}}(t),function(e){var t=e.addEvent,n=e.CenteredSeriesMixin,r=e.defined,i=e.each,s=e.extend,o=e.inArray,u=e.LegendSymbolMixin,a=e.noop,f=e.pick,l=e.Point,c=e.Series,h=e.seriesType,p=e.seriesTypes,d=e.setAnimation;h("pie","line",{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{distance:30,enabled:!0,formatter:function(){return this.y===null?undefined:this.point.name},x:0},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,states:{hover:{brightness:.1,shadow:!1}}},{isCartesian:!1,requireSorting:!1,directTouch:!0,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttribs:p.column.prototype.pointAttribs,animate:function(e){var t=this,n=t.points,r=t.startAngleRad;e||(i(n,function(e){var n=e.graphic,i=e.shapeArgs;n&&(n.attr({r:e.startR||t.center[3]/2,start:r,end:r}),n.animate({r:i.r,start:i.start,end:i.end},t.options.animation))}),t.animate=null)},updateTotals:function(){var e,t=0,n=this.points,r=n.length,i,s=this.options.ignoreHiddenPoint;for(e=0;e<r;e++)i=n[e],i.y<0&&(i.y=null),t+=s&&!i.visible?0:i.y;this.total=t;for(e=0;e<r;e++)i=n[e],i.percentage=t>0&&(i.visible||!s)?i.y/t*100:0,i.total=t},generatePoints:function(){c.prototype.generatePoints.call(this),this.updateTotals()},translate:function(e){this.generatePoints();var t=this,n=0,r=1e3,i=t.options,s=i.slicedOffset,o=s+(i.borderWidth||0),u,a,l,c=i.startAngle||0,h=t.startAngleRad=Math.PI/180*(c-90),p=t.endAngleRad=Math.PI/180*(f(i.endAngle,c+360)-90),d=p-h,v=t.points,m,g,y=i.dataLabels.distance,b=i.ignoreHiddenPoint,w,E=v.length,S;e||(t.center=e=t.getCenter()),t.getX=function(t,n){return l=Math.asin(Math.min((t-e[1])/(e[2]/2+y),1)),e[0]+(n?-1:1)*Math.cos(l)*(e[2]/2+y)};for(w=0;w<E;w++){S=v[w],u=h+n*d;if(!b||S.visible)n+=S.percentage/100;a=h+n*d,S.shapeType="arc",S.shapeArgs={x:e[0],y:e[1],r:e[2]/2,innerR:e[3]/2,start:Math.round(u*r)/r,end:Math.round(a*r)/r},l=(a+u)/2,l>1.5*Math.PI?l-=2*Math.PI:l<-Math.PI/2&&(l+=2*Math.PI),S.slicedTranslation={translateX:Math.round(Math.cos(l)*s),translateY:Math.round(Math.sin(l)*s)},m=Math.cos(l)*e[2]/2,g=Math.sin(l)*e[2]/2,S.tooltipPos=[e[0]+m*.7,e[1]+g*.7],S.half=l<-Math.PI/2||l>Math.PI/2?1:0,S.angle=l,o=Math.min(o,y/5),S.labelPos=[e[0]+m+Math.cos(l)*y,e[1]+g+Math.sin(l)*y,e[0]+m+Math.cos(l)*o,e[1]+g+Math.sin(l)*o,e[0]+m,e[1]+g,y<0?"center":S.half?"right":"left",l]}},drawGraph:null,drawPoints:function(){var e=this,t=e.chart,n=t.renderer,r,o,u,a,f=e.options.shadow;f&&!e.shadowGroup&&(e.shadowGroup=n.g("shadow").add(e.group)),i(e.points,function(t){if(t.y!==null){o=t.graphic,a=t.shapeArgs,r=t.getTranslate();var i=t.shadowGroup;f&&!i&&(i=t.shadowGroup=n.g("shadow").add(e.shadowGroup)),i&&i.attr(r),u=e.pointAttribs(t,t.selected&&"select"),o?o.setRadialReference(e.center).attr(u).animate(s(a,r)):(t.graphic=o=n[t.shapeType](a).setRadialReference(e.center).attr(r).add(e.group),t.visible||o.attr({visibility:"hidden"}),o.attr(u).attr({"stroke-linejoin":"round"}).shadow(f,i)),o.addClass(t.getClassName())}})},searchPoint:a,sortByAngle:function(e,t){e.sort(function(e,n){return e.angle!==undefined&&(n.angle-e.angle)*t})},drawLegendSymbol:u.drawRectangle,getCenter:n.getCenter,getSymbol:a},{init:function(){l.prototype.init.apply(this,arguments);var e=this,n;return e.name=f(e.name,"Slice"),n=function(t){e.slice(t.type==="select")},t(e,"select",n),t(e,"unselect",n),e},setVisible:function(e,t){var n=this,r=n.series,s=r.chart,u=r.options.ignoreHiddenPoint;t=f(t,u),e!==n.visible&&(n.visible=n.options.visible=e=e===undefined?!n.visible:e,r.options.data[o(n,r.data)]=n.options,i(["graphic","dataLabel","connector","shadowGroup"],function(t){n[t]&&n[t][e?"show":"hide"](!0)}),n.legendItem&&s.legend.colorizeItem(n,e),!e&&n.state==="hover"&&n.setState(""),u&&(r.isDirty=!0),t&&s.redraw())},slice:function(e,t,n){var i=this,s=i.series,u=s.chart;d(n,u),t=f(t,!0),i.sliced=i.options.sliced=e=r(e)?e:!i.sliced,s.options.data[o(i,s.data)]=i.options,i.graphic.animate(this.getTranslate()),i.shadowGroup&&i.shadowGroup.animate(this.getTranslate())},getTranslate:function(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}},haloPath:function(e){var t=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(t.x,t.y,t.r+e,t.r+e,{innerR:this.shapeArgs.r,start:t.start,end:t.end})}})}(t),function(e){var t=e.addEvent,n=e.arrayMax,r=e.defined,i=e.each,s=e.extend,o=e.format,u=e.map,a=e.merge,f=e.noop,l=e.pick,c=e.relativeLength,h=e.Series,p=e.seriesTypes,d=e.stableSort;e.distribute=function(e,t){function c(e,t){return e.target-t.target}var n,r=!0,s=e,o=[],a,f,l=0;n=e.length;while(n--)l+=e[n].size;if(l>t){d(e,function(e,t){return(t.rank||0)-(e.rank||0)}),n=0,l=0;while(l<=t)l+=e[n].size,n++;o=e.splice(n-1,e.length)}d(e,c),e=u(e,function(e){return{size:e.size,targets:[e.target]}});while(r){n=e.length;while(n--)a=e[n],f=(Math.min.apply(0,a.targets)+Math.max.apply(0,a.targets))/2,a.pos=Math.min(Math.max(0,f-a.size/2),t-a.size);n=e.length,r=!1;while(n--)n>0&&e[n-1].pos+e[n-1].size>e[n].pos&&(e[n-1].size+=e[n].size,e[n-1].targets=e[n-1].targets.concat(e[n].targets),e[n-1].pos+e[n-1].size>t&&(e[n-1].pos=t-e[n-1].size),e.splice(n,1),r=!0)}n=0,i(e,function(e){var t=0;i(e.targets,function(){s[n].pos=e.pos+t,t+=s[n].size,n++})}),s.push.apply(s,o),d(s,c)},h.prototype.drawDataLabels=function(){var e=this,n=e.options,s=n.dataLabels,u=e.points,f,c,h=e.hasRendered||0,p,d,v=l(s.defer,!0),m=e.chart.renderer;if(s.enabled||e._hasPointLabels)e.dlProcessOptions&&e.dlProcessOptions(s),d=e.plotGroup("dataLabelsGroup","data-labels",v&&!h?"hidden":"visible",s.zIndex||6),v&&(d.attr({opacity:+h}),h||t(e,"afterAnimate",function(){e.visible&&d.show(!0),d[n.animation?"animate":"attr"]({opacity:1},{duration:200})})),c=s,i(u,function(t){var i,u=t.dataLabel,h,v,g,y,b=t.connector,w=!u,E;f=t.dlOptions||t.options&&t.options.dataLabels,i=l(f&&f.enabled,c.enabled)&&t.y!==null;if(i){s=a(c,f),h=t.getLabelConfig(),p=s.format?o(s.format,h):s.formatter.call(h,s),E=s.style,y=s.rotation,E.color=l(s.color,E.color,e.color,"#000000"),E.color==="contrast"&&(t.contrastColor=m.getContrast(t.color||e.color),E.color=s.inside||s.distance<0||!!n.stacking?t.contrastColor:"#000000"),n.cursor&&(E.cursor=n.cursor),v={fill:s.backgroundColor,stroke:s.borderColor,"stroke-width":s.borderWidth,r:s.borderRadius||0,rotation:y,padding:s.padding,zIndex:1};for(g in v)v[g]===undefined&&delete v[g]}u&&(!i||!r(p))?(t.dataLabel=u=u.destroy(),b&&(t.connector=b.destroy())):i&&r(p)&&(u?v.text=p:(u=t.dataLabel=m[y?"text":"label"](p,0,-9999,s.shape,null,null,s.useHTML,null,"data-label"),u.addClass("highcharts-data-label-color-"+t.colorIndex+" "+(s.className||"")+(s.useHTML?"highcharts-tracker":""))),u.attr(v),u.css(E).shadow(s.shadow),u.added||u.add(d),e.alignDataLabel(t,u,s,null,w))})},h.prototype.alignDataLabel=function(e,t,n,r,i){var o=this.chart,u=o.inverted,a=l(e.plotX,-9999),f=l(e.plotY,-9999),c=t.getBBox(),h,p,d=n.rotation,v,m,g=n.align,y,b=this.visible&&(e.series.forceDL||o.isInsidePlot(a,Math.round(f),u)||r&&o.isInsidePlot(a,u?r.x+1:r.y+r.height-1,u)),w,E=l(n.overflow,"justify")==="justify";b&&(h=n.style.fontSize,p=o.renderer.fontMetrics(h,t).b,r=s({x:u?o.plotWidth-f:a,y:Math.round(u?o.plotHeight-a:f),width:0,height:0},r),s(n,{width:c.width,height:c.height}),d?(E=!1,y=o.renderer.rotCorr(p,d),w={x:r.x+n.x+r.width/2+y.x,y:r.y+n.y+{top:0,middle:.5,bottom:1}[n.verticalAlign]*r.height},t[i?"attr":"animate"](w).attr({align:g}),v=(d+720)%360,m=v>180&&v<360,g==="left"?w.y-=m?c.height:0:g==="center"?(w.x-=c.width/2,w.y-=c.height/2):g==="right"&&(w.x-=c.width,w.y-=m?0:c.height)):(t.align(n,null,r),w=t.alignAttr),E?e.isLabelJustified=this.justifyDataLabel(t,n,w,c,r,i):l(n.crop,!0)&&(b=o.isInsidePlot(w.x,w.y)&&o.isInsidePlot(w.x+c.width,w.y+c.height)),n.shape&&!d&&t.attr({anchorX:e.plotX,anchorY:e.plotY})),b||(t.attr({y:-9999}),t.placed=!1)},h.prototype.justifyDataLabel=function(e,t,n,r,i,s){var o=this.chart,u=t.align,a=t.verticalAlign,f,l,c=e.box?0:e.padding||0;return f=n.x+c,f<0&&(u==="right"?t.align="left":t.x=-f,l=!0),f=n.x+r.width-c,f>o.plotWidth&&(u==="left"?t.align="right":t.x=o.plotWidth-f,l=!0),f=n.y+c,f<0&&(a==="bottom"?t.verticalAlign="top":t.y=-f,l=!0),f=n.y+r.height-c,f>o.plotHeight&&(a==="top"?t.verticalAlign="bottom":t.y=o.plotHeight-f,l=!0),l&&(e.placed=!s,e.align(t,null,i)),l},p.pie&&(p.pie.prototype.drawDataLabels=function(){var t=this,r=t.data,s,o=t.chart,a=t.options.dataLabels,f=l(a.connectorPadding,10),c=l(a.connectorWidth,1),p=o.plotWidth,d=o.plotHeight,v,m=a.distance,g=t.center,y=g[2]/2,b=g[1],w=m>0,E,S,x,T,N=[[],[]],C,k,L,A,O=[0,0,0,0];if(!t.visible||!a.enabled&&!t._hasPointLabels)return;i(r,function(e){e.dataLabel&&e.visible&&e.dataLabel.shortened&&(e.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),e.dataLabel.shortened=!1)}),h.prototype.drawDataLabels.apply(t),i(r,function(e){e.dataLabel&&e.visible&&(N[e.half].push(e),e.dataLabel._pos=null)}),i(N,function(n,r){var i,l,c=n.length,h,v,w,N;if(!c)return;t.sortByAngle(n,r-.5),m>0&&(i=Math.max(0,b-y-m),l=Math.min(b+y+m,o.plotHeight),h=u(n,function(e){if(e.dataLabel)return N=e.dataLabel.getBBox().height||21,{target:e.labelPos[1]-i+N/2,size:N,rank:e.y}}),e.distribute(h,l+N-i));for(A=0;A<c;A++)s=n[A],x=s.labelPos,E=s.dataLabel,L=s.visible===!1?"hidden":"inherit",v=x[1],h?h[A].pos===undefined?L="hidden":(T=h[A].size,k=i+h[A].pos):k=v,a.justify?C=g[0]+(r?-1:1)*(y+m):C=t.getX(k<i+2||k>l-2?v:k,r),E._attr={visibility:L,align:x[6]},E._pos={x:C+a.x+({left:f,right:-f}[x[6]]||0),y:k+a.y-10},x.x=C,x.y=k,t.options.size===null&&(S=E.getBBox().width,w=null,C-S<f?(w=Math.round(S-C+f),O[3]=Math.max(w,O[3])):C+S>p-f&&(w=Math.round(C+S-p+f),O[1]=Math.max(w,O[1])),k-T/2<0?O[0]=Math.max(Math.round(-k+T/2),O[0]):k+T/2>d&&(O[2]=Math.max(Math.round(k+T/2-d),O[2])),E.sideOverflow=w)});if(n(O)===0||this.verifyDataLabelOverflow(O))this.placeDataLabels(),w&&c&&i(this.points,function(e){var n;v=e.connector,E=e.dataLabel,E&&E._pos&&e.visible?(L=E._attr.visibility,n=!v,n&&(e.connector=v=o.renderer.path().addClass("highcharts-data-label-connector highcharts-color-"+e.colorIndex).add(t.dataLabelsGroup),v.attr({"stroke-width":c,stroke:a.connectorColor||e.color||"#666666"})),v[n?"attr":"animate"]({d:t.connectorPath(e.labelPos)}),v.attr("visibility",L)):v&&(e.connector=v.destroy())})},p.pie.prototype.connectorPath=function(e){var t=e.x,n=e.y;return l(this.options.dataLabels.softConnector,!0)?["M",t+(e[6]==="left"?5:-5),n,"C",t,n,2*e[2]-e[4],2*e[3]-e[5],e[2],e[3],"L",e[4],e[5]]:["M",t+(e[6]==="left"?5:-5),n,"L",e[2],e[3],"L",e[4],e[5]]},p.pie.prototype.placeDataLabels=function(){i(this.points,function(e){var t=e.dataLabel,n;t&&e.visible&&(n=t._pos,n?(t.sideOverflow&&(t._attr.width=t.getBBox().width-t.sideOverflow,t.css({width:t._attr.width+"px",textOverflow:"ellipsis"}),t.shortened=!0),t.attr(t._attr),t[t.moved?"animate":"attr"](n),t.moved=!0):t&&t.attr({y:-9999}))},this)},p.pie.prototype.alignDataLabel=f,p.pie.prototype.verifyDataLabelOverflow=function(e){var t=this.center,n=this.options,r=n.center,i=n.minSize||80,s=i,o;return r[0]!==null?s=Math.max(t[2]-Math.max(e[1],e[3]),i):(s=Math.max(t[2]-e[1]-e[3],i),t[0]+=(e[3]-e[1])/2),r[1]!==null?s=Math.max(Math.min(s,t[2]-Math.max(e[0],e[2])),i):(s=Math.max(Math.min(s,t[2]-e[0]-e[2]),i),t[1]+=(e[0]-e[2])/2),s<t[2]?(t[2]=s,t[3]=Math.min(c(n.innerSize||0,s),s),this.translate(t),this.drawDataLabels&&this.drawDataLabels()):o=!0,o}),p.column&&(p.column.prototype.alignDataLabel=function(e,t,n,r,i){var s=this.chart.inverted,o=e.series,u=e.dlBox||e.shapeArgs,f=l(e.below,e.plotY>l(this.translatedThreshold,o.yAxis.len)),c=l(n.inside,!!this.options.stacking),p;u&&(r=a(u),r.y<0&&(r.height+=r.y,r.y=0),p=r.y+r.height-o.yAxis.len,p>0&&(r.height-=p),s&&(r={x:o.yAxis.len-r.y-r.height,y:o.xAxis.len-r.x-r.width,width:r.height,height:r.width}),c||(s?(r.x+=f?0:r.width,r.width=0):(r.y+=f?r.height:0,r.height=0))),n.align=l(n.align,!s||c?"center":f?"right":"left"),n.verticalAlign=l(n.verticalAlign,s||c?"middle":f?"top":"bottom"),h.prototype.alignDataLabel.call(this,e,t,n,r,i),e.isLabelJustified&&e.contrastColor&&e.dataLabel.css({color:e.contrastColor})})}(t),function(e){var t=e.Chart,n=e.each,r=e.pick,i=e.addEvent;t.prototype.callbacks.push(function(e){function t(){var t=[];n(e.series||[],function(e){var i=e.options.dataLabels,s=e.dataLabelCollections||["dataLabel"];(i.enabled||e._hasPointLabels)&&!i.allowOverlap&&e.visible&&n(s,function(i){n(e.points,function(e){e[i]&&(e[i].labelrank=r(e.labelrank,e.shapeArgs&&e.shapeArgs.height),t.push(e[i]))})})}),e.hideOverlappingLabels(t)}t(),i(e,"redraw",t)}),t.prototype.hideOverlappingLabels=function(e){var t=e.length,r,i,s,o,u,a,f,l,c,h,p,d=function(e,t,n,r,i,s,o,u){return!(i>e+n||i+o<e||s>t+r||s+u<t)};for(i=0;i<t;i++)r=e[i],r&&(r.oldOpacity=r.opacity,r.newOpacity=1);e.sort(function(e,t){return(t.labelrank||0)-(e.labelrank||0)});for(i=0;i<t;i++){o=e[i];for(s=i+1;s<t;++s)u=e[s],o&&u&&o!==u&&o.placed&&u.placed&&o.newOpacity!==0&&u.newOpacity!==0&&(f=o.alignAttr,l=u.alignAttr,c=o.parentGroup,h=u.parentGroup,p=2*(o.box?0:o.padding),a=d(f.x+c.translateX,f.y+c.translateY,o.width-p,o.height-p,l.x+h.translateX,l.y+h.translateY,u.width-p,u.height-p),a&&((o.labelrank<u.labelrank?o:u).newOpacity=0))}n(e,function(e){var t,n;e&&(n=e.newOpacity,e.oldOpacity!==n&&e.placed&&(n?e.show(!0):t=function(){e.hide()},e.alignAttr.opacity=n,e[e.isOld?"animate":"attr"](e.alignAttr,null,t)),e.isOld=!0)})}}(t),function(e){var t=e.addEvent,n=e.Chart,r=e.createElement,i=e.css,s=e.defaultOptions,o=e.defaultPlotOptions,u=e.each,a=e.extend,f=e.fireEvent,l=e.hasTouch,c=e.inArray,h=e.isObject,p=e.Legend,d=e.merge,v=e.pick,m=e.Point,g=e.Series,y=e.seriesTypes,b=e.svg,w;w=e.TrackerMixin={drawTrackerPoint:function(){var e=this,t=e.chart,n=t.pointer,r=function(e){var t=n.getPointFromEvent(e);t!==undefined&&t.onMouseOver(e)};u(e.points,function(e){e.graphic&&(e.graphic.element.point=e),e.dataLabel&&(e.dataLabel.div?e.dataLabel.div.point=e:e.dataLabel.element.point=e)}),e._hasTracking||(u(e.trackerGroups,function(t){e[t]&&(e[t].addClass("highcharts-tracker").on("mouseover",r).on("mouseout",function(e){n.onTrackerMouseOut(e)}),l&&e[t].on("touchstart",r),e.options.cursor&&e[t].css(i).css({cursor:e.options.cursor}))}),e._hasTracking=!0)},drawTrackerGraph:function(){var e=this,t=e.options,n=t.trackByArea,r=[].concat(n?e.areaPath:e.graphPath),i=r.length,s=e.chart,o=s.pointer,a=s.renderer,f=s.options.tooltip.snap,c=e.tracker,h,p=function(){s.hoverSeries!==e&&e.onMouseOver()},d="rgba(192,192,192,"+(b?1e-4:.002)+")";if(i&&!n){h=i+1;while(h--)r[h]==="M"&&r.splice(h+1,0,r[h+1]-f,r[h+2],"L"),(h&&r[h]==="M"||h===i)&&r.splice(h,0,"L",r[h-2]+f,r[h-1])}c?c.attr({d:r}):e.graph&&(e.tracker=a.path(r).attr({"stroke-linejoin":"round",visibility:e.visible?"visible":"hidden",stroke:d,fill:n?d:"none","stroke-width":e.graph.strokeWidth()+(n?0:2*f),zIndex:2}).add(e.group),u([e.tracker,e.markerGroup],function(e){e.addClass("highcharts-tracker").on("mouseover",p).on("mouseout",function(e){o.onTrackerMouseOut(e)}),t.cursor&&e.css({cursor:t.cursor}),l&&e.on("touchstart",p)}))}},y.column&&(y.column.prototype.drawTracker=w.drawTrackerPoint),y.pie&&(y.pie.prototype.drawTracker=w.drawTrackerPoint),y.scatter&&(y.scatter.prototype.drawTracker=w.drawTrackerPoint),a(p.prototype,{setItemEvents:function(e,t,n){var r=this,i=r.chart.renderer.boxWrapper,s="highcharts-legend-"+(e.series?"point":"series")+"-active";(n?t:e.legendGroup).on("mouseover",function(){e.setState("hover"),i.addClass(s),t.css(r.options.itemHoverStyle)}).on("mouseout",function(){t.css(e.visible?r.itemStyle:r.itemHiddenStyle),i.removeClass(s),e.setState()}).on("click",function(t){var n="legendItemClick",r=function(){e.setVisible&&e.setVisible()};t={browserEvent:t},e.firePointEvent?e.firePointEvent(n,t,r):f(e,n,t,r)})},createCheckboxForItem:function(e){var n=this;e.checkbox=r("input",{type:"checkbox",checked:e.selected,defaultChecked:e.selected},n.options.itemCheckboxStyle,n.chart.container),t(e.checkbox,"click",function(t){var n=t.target;f(e.series||e,"checkboxClick",{checked:n.checked,item:e},function(){e.select()})})}}),s.legend.itemStyle.cursor="pointer",a(n.prototype,{showResetZoom:function(){function u(){e.zoomOut()}var e=this,t=s.lang,n=e.options.chart.resetZoomButton,r=n.theme,i=r.states,o=n.relativeTo==="chart"?null:"plotBox";this.resetZoomButton=e.renderer.button(t.resetZoom,null,null,u,r,i&&i.hover).attr({align:n.position.align,title:t.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(n.position,!1,o)},zoomOut:function(){var e=this;f(e,"selection",{resetSelection:!0},function(){e.zoom()})},zoom:function(e){var t=this,n,r=t.pointer,i=!1,s;!e||e.resetSelection?u(t.axes,function(e){n=e.zoom()}):u(e.xAxis.concat(e.yAxis),function(e){var t=e.axis,s=t.isXAxis;r[s?"zoomX":"zoomY"]&&(n=t.zoom(e.min,e.max),t.displayBtn&&(i=!0))}),s=t.resetZoomButton,i&&!s?t.showResetZoom():!i&&h(s)&&(t.resetZoomButton=s.destroy()),n&&t.redraw(v(t.options.chart.animation,e&&e.animation,t.pointCount<100))},pan:function(e,t){var n=this,r=n.hoverPoints,s;r&&u(r,function(e){e.setState()}),u(t==="xy"?[1,0]:[1],function(t){var r=n[t?"xAxis":"yAxis"][0],i=r.horiz,o=e[i?"chartX":"chartY"],u=i?"mouseDownX":"mouseDownY",a=n[u],f=(r.pointRange||0)/2,l=r.getExtremes(),c=r.toValue(a-o,!0)+f,h=r.toValue(a+r.len-o,!0)-f,p=h<c,d=p?h:c,v=p?c:h,m=r.toValue(r.toPixels(l.min)-r.minPixelPadding),g=r.toValue(r.toPixels(l.max)+r.minPixelPadding),y=Math.min(l.dataMin,m)-d,b=v-Math.max(l.dataMax,g);r.series.length&&y<0&&b<0&&(r.setExtremes(d,v,!1,!1,{trigger:"pan"}),s=!0),n[u]=o}),s&&n.redraw(!1),i(n.container,{cursor:"move"})}}),a(m.prototype,{select:function(e,t){var n=this,r=n.series,i=r.chart;e=v(e,!n.selected),n.firePointEvent(e?"select":"unselect",{accumulate:t},function(){n.selected=n.options.selected=e,r.options.data[c(n,r.data)]=n.options,n.setState(e&&"select"),t||u(i.getSelectedPoints(),function(e){e.selected&&e!==n&&(e.selected=e.options.selected=!1,r.options.data[c(e,r.data)]=e.options,e.setState(""),e.firePointEvent("unselect"))})})},onMouseOver:function(e){var t=this,n=t.series,r=n.chart,i=r.pointer;t.firePointEvent("mouseOver"),i.runPointActions(e,t)},onMouseOut:function(){var e=this,t=e.series.chart;e.firePointEvent("mouseOut"),u(t.hoverPoints||[],function(e){e.setState()}),t.hoverPoints=t.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var e=this,n=d(e.series.options.point,e.options),r=n.events,i;e.events=r;for(i in r)t(e,i,r[i]);this.hasImportedEvents=!0}},setState:function(e,t){var n=this,r=Math.floor(n.plotX),i=n.plotY,s=n.series,u=s.options.states[e]||{},f=o[s.type].marker&&s.options.marker,l=f&&f.enabled===!1,c=f&&f.states&&f.states[e]||{},h=c.enabled===!1,p=s.stateMarkerGraphic,d=n.marker||{},m=s.chart,g=s.halo,y,b,w=f&&s.markerAttribs,E;e=e||"";if(e===n.state&&!t||n.selected&&e!=="select"||u.enabled===!1||e&&(h||l&&c.enabled===!1)||e&&d.states&&d.states[e]&&d.states[e].enabled===!1)return;w&&(b=s.markerAttribs(n,e)),n.graphic?(n.state&&n.graphic.removeClass("highcharts-point-"+n.state),e&&n.graphic.addClass("highcharts-point-"+e),n.graphic.attr(s.pointAttribs(n,e)),b&&n.graphic.animate(b,v(m.options.chart.animation,c.animation,f.animation)),p&&p.hide()):(e&&c&&(E=d.symbol||s.symbol,p&&p.currentSymbol!==E&&(p=p.destroy()),p?p[t?"animate":"attr"]({x:b.x,y:b.y}):E&&(s.stateMarkerGraphic=p=m.renderer.symbol(E,b.x,b.y,b.width,b.height).add(s.markerGroup),p.currentSymbol=E),p&&p.attr(s.pointAttribs(n,e))),p&&(p[e&&m.isInsidePlot(r,i,m.inverted)?"show":"hide"](),p.element.point=n)),y=u.halo,y&&y.size?(g||(s.halo=g=m.renderer.path().add(w?s.markerGroup:s.group)),g[t?"animate":"attr"]({d:n.haloPath(y.size)}),g.attr({"class":"highcharts-halo highcharts-color-"+v(n.colorIndex,s.colorIndex)}),g.point=n,g.attr(a({fill:n.color||s.color,"fill-opacity":y.opacity,zIndex:-1},y.attributes))):g&&g.point&&g.point.haloPath&&g.animate({d:g.point.haloPath(0)}),n.state=e},haloPath:function(e){var t=this.series,n=t.chart;return n.renderer.symbols.circle(Math.floor(this.plotX)-e,this.plotY-e,e*2,e*2)}}),a(g.prototype,{onMouseOver:function(){var e=this,t=e.chart,n=t.hoverSeries;n&&n!==e&&n.onMouseOut(),e.options.events.mouseOver&&f(e,"mouseOver"),e.setState("hover"),t.hoverSeries=e},onMouseOut:function(){var e=this,t=e.options,n=e.chart,r=n.tooltip,i=n.hoverPoint;n.hoverSeries=null,i&&i.onMouseOut(),e&&t.events.mouseOut&&f(e,"mouseOut"),r&&!e.stickyTracking&&(!r.shared||e.noSharedTooltip)&&r.hide(),e.setState()},setState:function(e){var t=this,n=t.options,r=t.graph,i=n.states,s=n.lineWidth,o,a=0;e=e||"";if(t.state!==e){u([t.group,t.markerGroup,t.dataLabelsGroup],function(n){n&&(t.state&&n.removeClass("highcharts-series-"+t.state),e&&n.addClass("highcharts-series-"+e))}),t.state=e;if(i[e]&&i[e].enabled===!1)return;e&&(s=i[e].lineWidth||s+(i[e].lineWidthPlus||0));if(r&&!r.dashstyle){o={"stroke-width":s},r.animate(o,v(t.chart.options.chart.animation,i[e]&&i[e].animation));while(t["zone-graph-"+a])t["zone-graph-"+a].attr(o),a+=1}}},setVisible:function(e,t){var n=this,r=n.chart,i=n.legendItem,s,o=r.options.chart.ignoreHiddenSeries,a=n.visible;n.visible=e=n.options.visible=n.userOptions.visible=e===undefined?!a:e,s=e?"show":"hide",u(["group","dataLabelsGroup","markerGroup","tracker","tt"],function(e){n[e]&&n[e][s]()}),(r.hoverSeries===n||(r.hoverPoint&&r.hoverPoint.series)===n)&&n.onMouseOut(),i&&r.legend.colorizeItem(n,e),n.isDirty=!0,n.options.stacking&&u(r.series,function(e){e.options.stacking&&e.visible&&(e.isDirty=!0)}),u(n.linkedSeries,function(t){t.setVisible(e,!1)}),o&&(r.isDirtyBox=!0),t!==!1&&r.redraw(),f(n,s)},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(e){var t=this;t.selected=e=e===undefined?!t.selected:e,t.checkbox&&(t.checkbox.checked=e),f(t,e?"select":"unselect")},drawTracker:w.drawTrackerGraph})}(t),function(e){var t=e.Chart,n=e.each,r=e.inArray,i=e.isArray,s=e.isObject,o=e.pick,u=e.splat;t.prototype.setResponsive=function(t){var r=this.options.responsive,i=[],s=this.currentResponsive,o;r&&r.rules&&n(r.rules,function(n){n._id===undefined&&(n._id=e.uniqueKey()),this.matchResponsiveRule(n,i,t)},this);var u=e.merge.apply(0,e.map(i,function(t){return e.find(r.rules,function(e){return e._id===t}).chartOptions}));i=i.toString()||undefined,o=s&&s.ruleIds,i!==o&&(s&&this.update(s.undoOptions,t),i?(this.currentResponsive={ruleIds:i,mergedOptions:u,undoOptions:this.currentOptions(u)},this.update(u,t)):this.currentResponsive=undefined)},t.prototype.matchResponsiveRule=function(e,t){var n=e.condition,r=n.callback||function(){return this.chartWidth<=o(n.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=o(n.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=o(n.minWidth,0)&&this.chartHeight>=o(n.minHeight,0)};r.call(this)&&t.push(e._id)},t.prototype.currentOptions=function(e){function n(e,t,o,a){var f,l;for(f in e)if(!a&&r(f,["series","xAxis","yAxis"])>-1){e[f]=u(e[f]),o[f]=[];for(l=0;l<e[f].length;l++)t[f][l]&&(o[f][l]={},n(e[f][l],t[f][l],o[f][l],a+1))}else s(e[f])?(o[f]=i(e[f])?[]:{},n(e[f],t[f]||{},o[f],a+1)):o[f]=t[f]||null}var t={};return n(e,this.options,t,0),t}}(t),t}),function(e){typeof module=="object"&&module.exports?module.exports=e:define?define("exporting",["highchart"],e):e(Highcharts)}(function(e){(function(e){var t=e.defaultOptions,n=e.doc,r=e.Chart,i=e.addEvent,s=e.removeEvent,o=e.fireEvent,u=e.createElement,a=e.discardElement,f=e.css,l=e.merge,c=e.pick,h=e.each,p=e.extend,d=e.isTouchDevice,v=e.win,m=e.SVGRenderer,g=e.Renderer.prototype.symbols;p(t.lang,{printChart:"打印图表",downloadPNG:"保存为PNG格式图片",downloadJPEG:"保存为JPEG格式图片",downloadPDF:"保存为PDF文档",downloadSVG:"保存为SVG格式图片",contextButtonTitle:"图表菜单"}),t.navigation={buttonOptions:{theme:{},symbolSize:14,symbolX:12.5,symbolY:10.5,align:"right",buttonSpacing:3,height:22,verticalAlign:"top",width:24}},l(!0,t.navigation,{menuStyle:{border:"1px solid #999999",background:"#ffffff",padding:"5px 0"},menuItemStyle:{padding:"0.5em 1em",background:"none",color:"#333333",fontSize:d?"14px":"11px",transition:"background 250ms, color 250ms"},menuItemHoverStyle:{background:"#335cad",color:"#ffffff"},buttonOptions:{symbolFill:"#666666",symbolStroke:"#666666",symbolStrokeWidth:3,theme:{fill:"#ffffff",stroke:"none",padding:5}}}),t.exporting={type:"image/png",url:"https://export.highcharts.com/",printMaxWidth:780,scale:2,buttons:{contextButton:{className:"highcharts-contextbutton",menuClassName:"highcharts-contextmenu",symbol:"menu",_titleKey:"contextButtonTitle",menuItems:[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChart()}},{textKey:"downloadJPEG",onclick:function(){this.exportChart({type:"image/jpeg"})}},{textKey:"downloadPDF",onclick:function(){this.exportChart({type:"application/pdf"})}},{textKey:"downloadSVG",onclick:function(){this.exportChart({type:"image/svg+xml"})}}]}}},e.post=function(e,t,r){var i,s;s=u("form",l({method:"post",action:e,enctype:"multipart/form-data"},r),{display:"none"},n.body);for(i in t)u("input",{type:"hidden",name:i,value:t[i]},null,s);s.submit(),a(s)},p(r.prototype,{sanitizeSVG:function(e,t){if(t&&t.exporting&&t.exporting.allowHTML){var n=e.match(/<\/svg>(.*?$)/);n&&n[1]&&(n='<foreignObject x="0" y="0" width="'+t.chart.width+'" '+'height="'+t.chart.height+'">'+'<body xmlns="http://www.w3.org/1999/xhtml">'+n[1]+"</body>"+"</foreignObject>",e=e.replace("</svg>",n+"</svg>"))}return e=e.replace(/zIndex="[^"]+"/g,"").replace(/isShadow="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/url\(("|&quot;)(\S+)("|&quot;)\)/g,"url($2)").replace(/url\([^#]+#/g,"url(#").replace(/<svg /,'<svg xmlns:xlink="http://www.w3.org/1999/xlink" ').replace(/ (NS[0-9]+\:)?href=/g," xlink:href=").replace(/\n/," ").replace(/<\/svg>.*?$/,"</svg>").replace(/(fill|stroke)="rgba\(([ 0-9]+,[ 0-9]+,[ 0-9]+),([ 0-9\.]+)\)"/g,'$1="rgb($2)" $1-opacity="$3"').replace(/&nbsp;/g," ").replace(/&shy;/g,"­"),e=e.replace(/<IMG /g,"<image ").replace(/<(\/?)TITLE>/g,"<$1title>").replace(/height=([^" ]+)/g,'height="$1"').replace(/width=([^" ]+)/g,'width="$1"').replace(/hc-svg-href="([^"]+)">/g,'xlink:href="$1"/>').replace(/ id=([^" >]+)/g,' id="$1"').replace(/class=([^" >]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(e){return e.toLowerCase()}),e},getChartHTML:function(){return this.container.innerHTML},getSVG:function(t){var r=this,i,s,o,f,c,d,v,m,g=l(r.options,t);return n.createElementNS||(n.createElementNS=function(e,t){return n.createElement(t)}),s=u("div",null,{position:"absolute",top:"-9999em",width:r.chartWidth+"px",height:r.chartHeight+"px"},n.body),v=r.renderTo.style.width,m=r.renderTo.style.height,c=g.exporting.sourceWidth||g.chart.width||/px$/.test(v)&&parseInt(v,10)||600,d=g.exporting.sourceHeight||g.chart.height||/px$/.test(m)&&parseInt(m,10)||400,p(g.chart,{animation:!1,renderTo:s,forExport:!0,renderer:"SVGRenderer",width:c,height:d}),g.exporting.enabled=!1,delete g.data,g.series=[],h(r.series,function(e){f=l(e.userOptions,{animation:!1,enableMouseTracking:!1,showCheckbox:!1,visible:e.visible}),f.isInternal||g.series.push(f)}),h(r.axes,function(t){t.userOptions.internalKey||(t.userOptions.internalKey=e.uniqueKey())}),i=new e.Chart(g,r.callback),t&&h(["xAxis","yAxis","series"],function(e){var n={};t[e]&&(n[e]=t[e],i.update(n))}),h(r.axes,function(t){var n=e.find(i.axes,function(e){return e.options.internalKey===t.userOptions.internalKey}),r=t.getExtremes(),s=r.userMin,o=r.userMax;n&&(s!==undefined||o!==undefined)&&n.setExtremes(s,o,!0,!1)}),o=i.getChartHTML(),o=r.sanitizeSVG(o,g),g=null,i.destroy(),a(s),o},getSVGForExport:function(e,t){var n=this.options.exporting;return this.getSVG(l({chart:{borderRadius:0}},n.chartOptions,t,{exporting:{sourceWidth:e&&e.sourceWidth||n.sourceWidth,sourceHeight:e&&e.sourceHeight||n.sourceHeight}}))},exportChart:function(t,n){var r=this.getSVGForExport(t,n);t=l(this.options.exporting,t),e.post(t.url,{filename:t.filename||"chart",type:t.type,width:t.width||0,scale:t.scale,svg:r},t.formAttributes)},print:function(){var e=this,t=e.container,r=[],i=t.parentNode,s=n.body,u=s.childNodes,a=e.options.exporting.printMaxWidth,f,l;if(e.isPrinting)return;e.isPrinting=!0,e.pointer.reset(null,0),o(e,"beforePrint"),l=a&&e.chartWidth>a,l&&(f=[e.options.chart.width,undefined,!1],e.setSize(a,undefined,!1)),h(u,function(e,t){e.nodeType===1&&(r[t]=e.style.display,e.style.display="none")}),s.appendChild(t),v.focus(),v.print(),setTimeout(function(){i.appendChild(t),h(u,function(e,t){e.nodeType===1&&(e.style.display=r[t])}),e.isPrinting=!1,l&&e.setSize.apply(e,f),o(e,"afterPrint")},1e3)},contextMenu:function(e,t,r,s,o,a,l){var c=this,d=c.options.navigation,v=c.chartWidth,m=c.chartHeight,g="cache-"+e,y=c[g],b=Math.max(o,a),w,E,S;y||(c[g]=y=u("div",{className:e},{position:"absolute",zIndex:1e3,padding:b+"px"},c.container),w=u("div",{className:"highcharts-menu"},null,y),f(w,p({MozBoxShadow:"3px 3px 10px #888",WebkitBoxShadow:"3px 3px 10px #888",boxShadow:"3px 3px 10px #888"},d.menuStyle)),E=function(){f(y,{display:"none"}),l&&l.setState(0),c.openMenu=!1},c.exportEvents.push(i(y,"mouseleave",function(){y.hideTimer=setTimeout(E,500)}),i(y,"mouseenter",function(){clearTimeout(y.hideTimer)}),i(n,"mouseup",function(t){c.pointer.inClass(t.target,e)||E()})),h(t,function(e){if(e){var t;e.separator?t=u("hr",null,null,w):(t=u("div",{className:"highcharts-menu-item",onclick:function(t){t&&t.stopPropagation(),E(),e.onclick&&e.onclick.apply(c,arguments)},innerHTML:e.text||c.options.lang[e.textKey]},null,w),t.onmouseover=function(){f(this,d.menuItemHoverStyle)},t.onmouseout=function(){f(this,d.menuItemStyle)},f(t,p({cursor:"pointer"},d.menuItemStyle))),c.exportDivElements.push(t)}}),c.exportDivElements.push(w,y),c.exportMenuWidth=y.offsetWidth,c.exportMenuHeight=y.offsetHeight),S={display:"block"},r+c.exportMenuWidth>v?S.right=v-r-o-b+"px":S.left=r-b+"px",s+a+c.exportMenuHeight>m&&l.alignOptions.verticalAlign!=="top"?S.bottom=m-s-b+"px":S.top=s+a-b+"px",f(y,S),c.openMenu=!0},addButton:function(e){var t=this,n=t.renderer,r=l(t.options.navigation.buttonOptions,e),i=r.onclick,s=r.menuItems,o,u,a=r.symbolSize||12;t.btnCount||(t.btnCount=0),t.exportDivElements||(t.exportDivElements=[],t.exportSVGElements=[]);if(r.enabled===!1)return;var f=r.theme,h=f.states,d=h&&h.hover,v=h&&h.select,m;delete f.states,i?m=function(e){e.stopPropagation(),i.call(t,e)}:s&&(m=function(){t.contextMenu(u.menuClassName,s,u.translateX,u.translateY,u.width,u.height,u),u.setState(2)}),r.text&&r.symbol?f.paddingLeft=c(f.paddingLeft,25):r.text||p(f,{width:r.width,height:r.height,padding:0}),u=n.button(r.text,0,0,m,f,d,v).addClass(e.className).attr({"stroke-linecap":"round",title:t.options.lang[r._titleKey],zIndex:3}),u.menuClassName=e.menuClassName||"highcharts-menu-"+t.btnCount++,r.symbol&&(o=n.symbol(r.symbol,r.symbolX-a/2,r.symbolY-a/2,a,a).addClass("highcharts-button-symbol").attr({zIndex:1}).add(u),o.attr({stroke:r.symbolStroke,fill:r.symbolFill,"stroke-width":r.symbolStrokeWidth||1})),u.add().align(p(r,{width:u.width,x:c(r.x,t.buttonOffset)}),!0,"spacingBox"),t.buttonOffset+=(u.width+r.buttonSpacing)*(r.align==="right"?-1:1),t.exportSVGElements.push(u,o)},destroyExport:function(e){var t=e?e.target:this,n=t.exportSVGElements,r=t.exportDivElements,i=t.exportEvents,o;n&&(h(n,function(e,n){e&&(e.onclick=e.ontouchstart=null,o="cache-"+e.menuClassName,t[o]&&delete t[o],t.exportSVGElements[n]=e.destroy())}),n.length=0),r&&(h(r,function(e,n){clearTimeout(e.hideTimer),s(e,"mouseleave"),t.exportDivElements[n]=e.onmouseout=e.onmouseover=e.ontouchstart=e.onclick=null,a(e)}),r.length=0),i&&(h(i,function(e){e()}),i.length=0)}}),g.menu=function(e,t,n,r){var i=["M",e,t+2.5,"L",e+n,t+2.5,"M",e,t+r/2+.5,"L",e+n,t+r/2+.5,"M",e,t+r-1.5,"L",e+n,t+r-1.5];return i},r.prototype.renderExporting=function(){var e,t=this.options.exporting,n=t.buttons,r=this.isDirtyExporting||!this.exportSVGElements;this.buttonOffset=0,this.isDirtyExporting&&this.destroyExport();if(r&&t.enabled!==!1){this.exportEvents=[];for(e in n)this.addButton(n[e]);this.isDirtyExporting=!1}i(this,"destroy",this.destroyExport)},r.prototype.callbacks.push(function(e){function t(t,n,r){e.isDirtyExporting=!0,l(!0,e.options[t],n),c(r,!0)&&e.redraw()}e.renderExporting(),i(e,"redraw",e.renderExporting),h(["exporting","navigation"],function(n){e[n]={update:function(e,r){t(n,e,r)}}})})})(e)}),function(e){typeof define=="function"&&define.amd?define("datepicker",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){function C(e){return N.call(e).slice(8,-1).toLowerCase()}function k(){var e=config.STATIC_PATH+"/js/plugin/datepicker/datepicker.css",t=n.getElementsByTagName("head").item(0),r=n.createElement("link");r.href=e,r.rel="stylesheet",r.type="text/css",t.appendChild(r)}function L(e){return typeof e=="string"}function A(e){return typeof e=="number"&&!isNaN(e)}function O(e){return typeof e=="undefined"}function M(e){return C(e)==="date"}function _(e,t){var n=[];return Array.from?Array.from(e).slice(t||0):(A(t)&&n.push(t),n.slice.apply(e,n))}function D(e,t){var n=_(arguments,2);return function(){return e.apply(t,n.concat(_(arguments)))}}function P(e){return e%4===0&&e%100!==0||e%400===0}function H(e,t){return[31,P(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]}function B(e){var t=String(e).toLowerCase(),n=t.match(p),r,i;if(!n||n.length===0)throw new Error("Invalid date format.");e={source:t,parts:n},r=n.length;for(i=0;i<r;i++)switch(n[i]){case"dd":case"d":e.hasDay=!0;break;case"mm":case"m":e.hasMonth=!0;break;case"yyyy":case"yy":e.hasYear=!0}return e}function j(t,n){n=e.isPlainObject(n)?n:{},n.language&&(n=e.extend({},j.LANGUAGES[n.language],n)),this.$element=e(t),this.options=e.extend({},j.DEFAULTS,n),this.isBuilt=!1,this.isShown=!1,this.isInput=!1,this.isInline=!1,this.initialValue="",this.initialDate=null,this.startDate=null,this.endDate=null,this.init()}var t=e(window),n=window.document,r=e(n),i=window.Number,s="datepicker",o="click."+s,u="keyup."+s,a="focus."+s,f="resize."+s,l="show."+s,c="hide."+s,h="pick."+s,p=/(y|m|d)+/g,d=/\d+/g,v=/^\d{2,4}$/,m=s+"-inline",g=s+"-dropdown",y=s+"-top-left",b=s+"-top-right",w=s+"-bottom-left",E=s+"-bottom-right",S=[y,b,w,E].join(" "),x=s+"-hide",T=Math.min,N=Object.prototype.toString;k(),j.prototype={constructor:j,init:function(){var t=this.options,n=this.$element,r=t.startDate,i=t.endDate,s=t.date;this.$trigger=e(t.trigger),this.isInput=n.is("input")||n.is("textarea"),this.isInline=t.inline&&(t.container||!this.isInput),this.format=B(t.format),this.oldValue=this.initialValue=this.getValue(),s=this.parseDate(s||this.initialValue),r&&(r=this.parseDate(r),s.getTime()<r.getTime()&&(s=new Date(r)),this.startDate=r),i&&(i=this.parseDate(i),r&&i.getTime()<r.getTime()&&(i=new Date(r)),s.getTime()>i.getTime()&&(s=new Date(i)),this.endDate=i),this.date=s,this.viewDate=new Date(s),this.initialDate=new Date(this.date),this.bind(),(t.autoShow||this.isInline)&&this.show(),t.autoPick&&this.pick()},build:function(){var t=this.options,r=this.$element,i;if(this.isBuilt)return;this.isBuilt=!0,this.$picker=i=e(t.template),this.$week=i.find('[data-view="week"]'),this.$yearsPicker=i.find('[data-view="years picker"]'),this.$yearsPrev=i.find('[data-view="years prev"]'),this.$yearsNext=i.find('[data-view="years next"]'),this.$yearsCurrent=i.find('[data-view="years current"]'),this.$years=i.find('[data-view="years"]'),this.$monthsPicker=i.find('[data-view="months picker"]'),this.$yearPrev=i.find('[data-view="year prev"]'),this.$yearNext=i.find('[data-view="year next"]'),this.$yearCurrent=i.find('[data-view="year current"]'),this.$months=i.find('[data-view="months"]'),this.$daysPicker=i.find('[data-view="days picker"]'),this.$monthPrev=i.find('[data-view="month prev"]'),this.$monthNext=i.find('[data-view="month next"]'),this.$monthCurrent=i.find('[data-view="month current"]'),this.$days=i.find('[data-view="days"]'),this.isInline?e(t.container||r).append(i.addClass(m)):(e(n.body).append(i.addClass(g)),i.addClass(x)),this.fillWeek()},unbuild:function(){if(!this.isBuilt)return;this.isBuilt=!1,this.$picker.remove()},bind:function(){var t=this.options,n=this.$element;e.isFunction(t.show)&&n.on(l,t.show),e.isFunction(t.hide)&&n.on(c,t.hide),e.isFunction(t.pick)&&n.on(h,t.pick),this.isInput&&n.on(u,e.proxy(this.keyup,this)),this.isInline||(t.trigger?this.$trigger.on(o,e.proxy(this.toggle,this)):this.isInput?n.on(a,e.proxy(this.show,this)):n.on(o,e.proxy(this.show,this)))},unbind:function(){var t=this.options,n=this.$element;e.isFunction(t.show)&&n.off(l,t.show),e.isFunction(t.hide)&&n.off(c,t.hide),e.isFunction(t.pick)&&n.off(h,t.pick),this.isInput&&n.off(u,this.keyup),this.isInline||(t.trigger?this.$trigger.off(o,this.toggle):this.isInput?n.off(a,this.show):n.off(o,this.show))},showView:function(e){var t=this.$yearsPicker,n=this.$monthsPicker,r=this.$daysPicker,s=this.format;if(s.hasYear||s.hasMonth||s.hasDay)switch(i(e)){case 2:case"years":n.addClass(x),r.addClass(x),s.hasYear?(this.fillYears(),t.removeClass(x),this.place()):this.showView(0);break;case 1:case"months":t.addClass(x),r.addClass(x),s.hasMonth?(this.fillMonths(),n.removeClass(x),this.place()):this.showView(2);break;default:t.addClass(x),n.addClass(x),s.hasDay?(this.fillDays(),r.removeClass(x),this.place()):this.showView(1)}},hideView:function(){!this.isInline&&this.options.autoHide&&this.hide()},place:function(){if(this.isInline)return;var e=this.options,t=this.$element,n=this.$picker,i=r.outerWidth(),s=r.outerHeight(),o=t.outerWidth(),u=t.outerHeight(),a=n.width(),f=n.height(),l=t.offset(),c=l.left,h=l.top,p=parseFloat(e.offset)||10,d=y;h>f&&h+u+f>s?(h-=f+p,d=w):h+=u+p,c+a>i&&(c=c+o-a,d=d.replace("left","right")),n.removeClass(S).addClass(d).css({top:h,left:c,zIndex:parseInt(e.zIndex,10)})},trigger:function(t,n){var r=e.Event(t,n);return this.$element.trigger(r),r},createItem:function(t){var n=this.options,r=n.itemTag,i={text:"",view:"",muted:!1,picked:!1,disabled:!1,highlighted:!1},s=[];return e.extend(i,t),i.muted&&s.push(n.mutedClass),i.highlighted&&s.push(n.highlightedClass),i.picked&&s.push(n.pickedClass),i.disabled&&s.push(n.disabledClass),"<"+r+' class="'+s.join(" ")+'"'+(i.view?' data-view="'+i.view+'"':"")+">"+i.text+"</"+r+">"},fillAll:function(){this.fillYears(),this.fillMonths(),this.fillDays()},fillWeek:function(){var t=this.options,n=parseInt(t.weekStart,10)%7,r=t.daysMin,i="",s;r=e.merge(r.slice(n),r.slice(0,n));for(s=0;s<=6;s++)i+=this.createItem({text:r[s]});this.$week.html(i)},fillYears:function(){var t=this.options,n=t.disabledClass||"",r=t.yearSuffix||"",i=e.isFunction(t.filter)&&t.filter,s=this.startDate,o=this.endDate,u=this.viewDate,a=u.getFullYear(),f=u.getMonth(),l=u.getDate(),c=this.date,h=c.getFullYear(),p=!1,d=!1,v=!1,m=!1,g=!1,y="",b=-5,w=6,E;for(E=b;E<=w;E++)c=new Date(a+E,f,l),g=E===b||E===w,m=a+E===h,v=!1,s&&(v=c.getFullYear()<s.getFullYear(),E===b&&(p=v)),!v&&o&&(v=c.getFullYear()>o.getFullYear(),E===w&&(d=v)),!v&&i&&(v=i.call(this.$element,c)===!1),y+=this.createItem({text:a+E,view:v?"year disabled":m?"year picked":"year",muted:g,picked:m,disabled:v});this.$yearsPrev.toggleClass(n,p),this.$yearsNext.toggleClass(n,d),this.$yearsCurrent.toggleClass(n,!0).html(a+b+r+" - "+(a+w)+r),this.$years.html(y)},fillMonths:function(){var t=this.options,n=t.disabledClass||"",r=t.monthsShort,i=e.isFunction(t.filter)&&t.filter,s=this.startDate,o=this.endDate,u=this.viewDate,a=u.getFullYear(),f=u.getDate(),l=this.date,c=l.getFullYear(),h=l.getMonth(),p=!1,d=!1,v=!1,m=!1,g="",y;for(y=0;y<=11;y++)l=new Date(a,y,f),m=a===c&&y===h,v=!1,s&&(p=l.getFullYear()===s.getFullYear(),v=p&&l.getMonth()<s.getMonth()),!v&&o&&(d=l.getFullYear()===o.getFullYear(),v=d&&l.getMonth()>o.getMonth()),!v&&i&&(v=i.call(this.$element,l)===!1),g+=this.createItem({index:y,text:r[y],view:v?"month disabled":m?"month picked":"month",picked:m,disabled:v});this.$yearPrev.toggleClass(n,p),this.$yearNext.toggleClass(n,d),this.$yearCurrent.toggleClass(n,p&&d).html(a+t.yearSuffix||""),this.$months.html(g)},fillDays:function(){var t=this.options,n=t.disabledClass||"",r=t.yearSuffix||"",i=t.monthsShort,s=parseInt(t.weekStart,10)%7,o=e.isFunction(t.filter)&&t.filter,u=this.startDate,a=this.endDate,f=this.viewDate,l=f.getFullYear(),c=f.getMonth(),h=l,p=c,d=l,v=new Date,m=v.getFullYear(),g=v.getMonth(),y=v.getDate(),b=c,w=this.date,E=w.getFullYear(),S=w.getMonth(),x=w.getDate(),T=!1,N=!1,C=!1,k=!1,L=[],A=[],O=[],M=42,_,D,P;c===0?(h-=1,p=11):p-=1,_=H(h,p),w=new Date(l,c,1),P=w.getDay()-s,P<=0&&(P+=7),u&&(T=w.getTime()<=u.getTime());for(D=_-(P-1);D<=_;D++)w=new Date(h,p,D),C=!1,u&&(C=w.getTime()<u.getTime()),!C&&o&&(C=o.call(this.$element,w)===!1),L.push(this.createItem({text:D,view:"day prev",muted:!0,disabled:C,highlighted:h===m&&p===g&&w.getDate()===y}));c===11?(d+=1,b=0):b+=1,_=H(l,c),P=M-(L.length+_),w=new Date(l,c,_),a&&(N=w.getTime()>=a.getTime());for(D=1;D<=P;D++)w=new Date(d,b,D),C=!1,a&&(C=w.getTime()>a.getTime()),!C&&o&&(C=o.call(this.$element,w)===!1),A.push(this.createItem({text:D,view:"day next",muted:!0,disabled:C,highlighted:d===m&&b===g&&w.getDate()===y}));for(D=1;D<=_;D++)w=new Date(l,c,D),k=l===E&&c===S&&D===x,C=!1,u&&(C=w.getTime()<u.getTime()),!C&&a&&(C=w.getTime()>a.getTime()),!C&&o&&(C=o.call(this.$element,w)===!1),O.push(this.createItem({text:D,view:C?"day disabled":k?"day picked":"day",picked:k,disabled:C,highlighted:l===m&&c===g&&w.getDate()===y}));this.$monthPrev.toggleClass(n,T),this.$monthNext.toggleClass(n,N),this.$monthCurrent.toggleClass(n,T&&N).html(t.yearFirst?l+r+" "+i[c]:i[c]+" "+l+r),this.$days.html(L.join("")+O.join(" ")+A.join(""))},click:function(t){var n=e(t.target),r=this.viewDate,i,s,o,u,a,f;t.stopPropagation(),t.preventDefault();if(n.hasClass("disabled"))return;i=r.getFullYear(),s=r.getMonth(),o=r.getDate(),f=n.data("view");switch(f){case"years prev":case"years next":i=f==="years prev"?i-10:i+10,a=n.text(),u=v.test(a),u&&(i=parseInt(a,10),this.date=new Date(i,s,T(o,28))),this.viewDate=new Date(i,s,T(o,28)),this.fillYears(),u&&(this.showView(1),this.pick("year"));break;case"year prev":case"year next":i=f==="year prev"?i-1:i+1,this.viewDate=new Date(i,s,T(o,28)),this.fillMonths();break;case"year current":this.format.hasYear&&this.showView(2);break;case"year picked":this.format.hasMonth?this.showView(1):this.hideView(),this.pick("year");break;case"year":i=parseInt(n.text(),10),this.date=new Date(i,s,T(o,28)),this.viewDate=new Date(i,s,T(o,28)),this.format.hasMonth?this.showView(1):this.hideView(),this.pick("year");break;case"month prev":case"month next":s=f==="month prev"?s-1:f==="month next"?s+1:s,this.viewDate=new Date(i,s,T(o,28)),this.fillDays();break;case"month current":this.format.hasMonth&&this.showView(1);break;case"month picked":this.format.hasDay?this.showView(0):this.hideView(),this.pick("month");break;case"month":s=e.inArray(n.text(),this.options.monthsShort),this.date=new Date(i,s,T(o,28)),this.viewDate=new Date(i,s,T(o,28)),this.format.hasDay?this.showView(0):this.hideView(),this.pick("month");break;case"day prev":case"day next":case"day":s=f==="day prev"?s-1:f==="day next"?s+1:s,o=parseInt(n.text(),10),this.date=new Date(i,s,o),this.viewDate=new Date(i,s,o),this.fillDays(),f==="day"&&this.hideView(),this.pick("day");break;case"day picked":this.hideView(),this.pick("day")}},clickDoc:function(e){var t=e.target,r=this.$element[0],i=this.$trigger[0],s;while(t!==n){if(t===i||t===r){s=!0;break}t=t.parentNode}s||this.hide()},keyup:function(){this.update()},keyupDoc:function(e){this.isInput&&e.target!==this.$element[0]&&this.isShown&&(e.key==="Tab"||e.keyCode===9)&&this.hide()},getValue:function(){var e=this.$element,t="";return this.isInput?t=e.val():this.isInline?this.options.container&&(t=e.text()):t=e.text(),t},setValue:function(e){var t=this.$element;e=L(e)?e:"",this.isInput?t.val(e):this.isInline?this.options.container&&t.text(e):t.text(e)},show:function(){this.isBuilt||this.build();if(this.isShown)return;if(this.trigger(l).isDefaultPrevented())return;this.isShown=!0,this.$picker.removeClass(x).on(o,e.proxy(this.click,this)),this.showView(this.options.startView),this.isInline||(t.on(f,this._place=D(this.place,this)),r.on(o,this._clickDoc=D(this.clickDoc,this)),r.on(u,this._keyupDoc=D(this.keyupDoc,this)),this.place())},hide:function(){if(!this.isShown)return;if(this.trigger(c).isDefaultPrevented())return;this.isShown=!1,this.$picker.addClass(x).off(o,this.click),this.isInline||(t.off(f,this._place),r.off(o,this._clickDoc),r.off(u,this._keyupDoc))},toggle:function(){this.isShown?this.hide():this.show()},update:function(){var e=this.getValue();if(e===this.oldValue)return;this.setDate(e,!0),this.oldValue=e},pick:function(e){var t=this.$element,n=this.date;if(this.trigger(h,{view:e||"",date:n}).isDefaultPrevented())return;this.setValue(n=this.formatDate(this.date)),this.isInput&&t.trigger("change")},reset:function(){this.setDate(this.initialDate,!0),this.setValue(this.initialValue),this.isShown&&this.showView(this.options.startView)},getMonthName:function(t,n){var r=this.options,s=r.months;return e.isNumeric(t)?t=i(t):O(n)&&(n=t),n===!0&&(s=r.monthsShort),s[A(t)?t:this.date.getMonth()]},getDayName:function(t,n,r){var s=this.options,o=s.days;return e.isNumeric(t)?t=i(t):(O(r)&&(r=n),O(n)&&(n=t)),o=r===!0?s.daysMin:n===!0?s.daysShort:o,o[A(t)?t:this.date.getDay()]},getDate:function(e){var t=this.date;return e?this.formatDate(t):new Date(t)},setDate:function(t,n){var r=this.options.filter;if(M(t)||L(t)){t=this.parseDate(t);if(e.isFunction(r)&&r.call(this.$element,t)===!1)return;this.date=t,this.viewDate=new Date(t),n||this.pick(),this.isBuilt&&this.fillAll()}},setStartDate:function(e){if(M(e)||L(e))this.startDate=this.parseDate(e),this.isBuilt&&this.fillAll()},setEndDate:function(e){if(M(e)||L(e))this.endDate=this.parseDate(e),this.isBuilt&&this.fillAll()},parseDate:function(e){var t=this.format,n=[],r,i,s,o,u,a;if(M(e))return new Date(e.getFullYear(),e.getMonth(),e.getDate());L(e)&&(n=e.match(d)||[]),e=new Date,i=e.getFullYear(),s=e.getDate(),o=e.getMonth(),r=t.parts.length;if(n.length===r)for(a=0;a<r;a++){u=parseInt(n[a],10)||1;switch(t.parts[a]){case"dd":case"d":s=u;break;case"mm":case"m":o=u-1;break;case"yy":i=2e3+u;break;case"yyyy":i=u}}return new Date(i,o,s)},formatDate:function(e){var t=this.format,n="",r,i,s,o,u;if(M(e)){n=t.source,i=e.getFullYear(),o={d:e.getDate(),m:e.getMonth()+1,yy:i.toString().substring(2),yyyy:i},o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m,r=t.parts.length;for(u=0;u<r;u++)s=t.parts[u],n=n.replace(s,o[s])}return n},destroy:function(){this.unbind(),this.unbuild(),this.$element.removeData(s)}},j.LANGUAGES={},j.DEFAULTS={autoShow:!1,autoHide:!0,autoPick:!1,inline:!1,container:null,trigger:null,language:"zh-CN",format:"yyyy-mm-dd",date:null,startDate:null,endDate:null,startView:0,weekStart:1,yearFirst:!0,yearSuffix:"年",days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["周日","周一","周二","周三","周四","周五","周六"],daysMin:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],itemTag:"li",mutedClass:"muted",pickedClass:"picked",disabledClass:"disabled",highlightedClass:"highlighted",template:'<div class="datepicker-container"><div class="datepicker-panel" data-view="years picker"><ul><li data-view="years prev">&lsaquo;</li><li data-view="years current"></li><li data-view="years next">&rsaquo;</li></ul><ul data-view="years"></ul></div><div class="datepicker-panel" data-view="months picker"><ul><li data-view="year prev">&lsaquo;</li><li data-view="year current"></li><li data-view="year next">&rsaquo;</li></ul><ul data-view="months"></ul></div><div class="datepicker-panel" data-view="days picker"><ul><li data-view="month prev">&lsaquo;</li><li data-view="month current"></li><li data-view="month next">&rsaquo;</li></ul><ul data-view="week"></ul><ul data-view="days"></ul></div></div>',offset:10,zIndex:1e3,filter:null,show:null,hide:null,pick:null},j.setDefaults=function(t){t=e.isPlainObject(t)?t:{},t.language&&(t=e.extend({},j.LANGUAGES[t.language],t)),e.extend(j.DEFAULTS,t)},j.other=e.fn.datepicker,e.fn.datepicker=function(t){var n=_(arguments,1),r;return this.each(function(){var i=e(this),o=i.data(s),u,a;if(!o){if(/destroy/.test(t))return;u=e.extend({},i.data(),e.isPlainObject(t)&&t),i.data(s,o=new j(this,u))}L(t)&&e.isFunction(a=o[t])&&(r=a.apply(o,n))}),O(r)?this:r},e.fn.datepicker.Constructor=j,e.fn.datepicker.languages=j.LANGUAGES,e.fn.datepicker.setDefaults=j.setDefaults,e.fn.datepicker.noConflict=function(){return e.fn.datepicker=j.other,this}}),define("module/my/voiceAnalysis",["jquery","backbone","moment","plugin/dialog","module/my/albumSearch","exporting","datepicker"],function(e,t,n,r,i){var s=t.View.extend({albumId:e(".j-analyzeAlbumName").attr("albumid"),realId:window.helper.getParameterByName("realId")||"",voiceModel:null,period:30,yesterday:n().subtract(1,"d"),init:function(){this.voiceModel=new t.Model({realId:this.realId,albumId:this.albumId,startStamp:+n().subtract(this.period,"d").startOf("day"),endStamp:+n().subtract(1,"d").startOf("day")}),this.voiceModel.on("change",function(){this.getVoiceData()},this),this.initAlbumSearch(),this.bindEvents()},initAlbumSearch:function(){var t=this;this.albumSearch=new i(function(r,i){e(".j-analyzeAlbumName").text(r).attr("albumid",i.attr("data-albumid")),!i.attr("data-albumid")||t.voiceModel.clear({silent:!0}).set({realId:t.realId,albumId:i.attr("data-albumid"),startStamp:+n().subtract(t.period,"d").startOf("day"),endStamp:+n().subtract(1,"d").startOf("day")})}),this.albumSearch.init()},bindEvents:function(){var e=this;e.datePickerHandler(),e.orderShift(),e.paging(),e.showChart(),e.downloadChart()},getVoiceData:function(){var t=this;t.model.fetch({url:"/center/dataAnalyze/getVoiceDataListJson",data:t.voiceModel.toJSON(),type:"GET",dataType:"json",beforeSend:function(){e(".toast").fadeIn(100).prev().removeClass("hidden")},success:function(n,r,i){e(".toast").fadeOut(500).prev().addClass("hidden"),e(".j-voiceTable").html(r.Html),t.bindEvents()},error:function(t,n){e(".toast").fadeOut(500).prev().addClass("hidden")},removed:function(t,n){e(".toast").fadeOut(500).prev().addClass("hidden"),e(".j-voiceTable").html('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')}})},orderShift:function(){var t=this,n=e("[data-order]");n.on("click",function(){var n=e(this),r=n.attr("data-order"),i=!n.children(".arr-group").hasClass("open");t.voiceModel.set({order:r,asc:i})})},paging:function(){var t=this,n=e("#j-voiceTable .paging-bar"),r=e.trim(e(".page-num").val()),i=e.trim(e(".page-btn").attr("max-size"));e(".paging-num").on("click",function(n){n.preventDefault();var r=e(this).attr("data-index");e(this).hasClass("active")||t.voiceModel.set({pageNum:r})}),e(".page-num").on("keyup",function(n){var r=e.trim(n.target.value)*1;r>0&&r<=i&&r%1==0?(e(".page-btn").removeClass("off disabled").addClass("on"),e(".page-btn").on("click",function(e){e.preventDefault(),t.voiceModel.set({pageNum:r})})):e(".page-btn").removeClass("on").addClass("off disabled")})},downloadChart:function(){var t=this;e(".j-downloadBtn").off().on("click",function(){var n=e(".j-analyzeAlbumName").attr("albumid"),i=t.voiceModel.get("startStamp"),s=t.voiceModel.get("endStamp");if(n=="0")r.alert("该专辑暂无声音");else var o=e("<iframe/>").hide().attr("src","/center/dataAnalyze/downloadVoiceData?albumId="+n+"&startStamp="+i+"&endStamp="+s).appendTo("body").load(function(){o.remove()})})},showChart:function(){var t=this;e('[category="showChart"]').on("click",function(){var n=e(this),r=n.attr("data-trackid");n.text()==="查看"?e.ajax({url:"/center/dataAnalyze/getVoiceListenedRateJson",type:"GET",dataType:"json",data:{realId:window.helper.getParameterByName("realId")||"",trackId:r,startStamp:t.voiceModel.get("startStamp"),endStamp:t.voiceModel.get("endStamp")},beforeSend:function(){e(".toast").fadeIn(100).prev().removeClass("hidden")},success:function(t){e(".toast").fadeOut(500).prev().addClass("hidden");var r=n.closest("li").find(".cont");t.res?(n.closest("li").find('[category="showChart"]').text("收起"),n.closest("li").find(".j-chartWrapper").removeClass("hidden"),n.closest("li").siblings().find(".j-chartWrapper").addClass("hidden"),n.closest("li").siblings().find('[category="showChart"]').text("查看"),!r.siblings(".no-data")||r.siblings(".no-data").remove(),r.highcharts({chart:{type:"spline"},colors:["#fc5832","#ddd7d5"],title:{text:t.titleText},xAxis:{categories:t.categories},yAxis:{title:{text:t.yAxisText}},tooltip:{valueSuffix:t.valueSuffix},series:t.series})):r.empty().parent().append('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')},error:function(t){e(".toast").fadeOut(500).prev().addClass("hidden"),$chart.empty().parent().append('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')}}):(n.closest("li").find('[category="showChart"]').text("查看"),n.closest("li").find(".j-chartWrapper").addClass("hidden"),n.closest("li").siblings().find(".j-chartWrapper").addClass("hidden"),n.closest("li").siblings().find('[category="showChart"]').text("查看"))})},datePickerHandler:function(){var t=this,i=e("#startDate"),s=e("#endDate"),o=e("[data-period]"),u="2016-01-01",a=n.max(n().subtract(6,"M"),n(u)).format("YYYY-MM-DD");e(document).on("focus","#startDate",function(){var i=s.val();e(this).datepicker("destroy").datepicker({startDate:a,endDate:i,pick:function(e){var i=n(e.date).add(60,"d"),u=n.min(i,t.yesterday,n(s.val())).format("YYYY-MM-DD");s.val(u),e.view==="day"&&(+n(e.date)<=+n(u)?(t.voiceModel.set({startStamp:+n(e.date),endStamp:+n(u)}),o.removeClass("primary")):r.warn("请选择合理的时间哦"))}})}).on("focus","#endDate",function(){var r=n(i.val()).add(60,"d"),s=n.min(r,t.yesterday).format("YYYY-MM-DD");e(this).datepicker("destroy").datepicker({startDate:i.val(),endDate:s,pick:function(e){e.view==="day"&&(t.voiceModel.set({endStamp:+n(e.date),pageNum:1}),o.removeClass("primary"))}})}).on("click","[data-period]",function(){var r=e(this),u=parseInt(r.attr("data-period")),a=+n().subtract(u,"d").startOf("day"),f=+n().subtract(1,"d").startOf("day");t.voiceModel.set({startStamp:a,endStamp:f,pageNum:1}),i.val(n(a).format("YYYY-MM-DD")),s.val(n(f).format("YYYY-MM-DD")),o.removeClass("primary"),r.addClass("primary")})},release:function(){this.voiceModel.off(),this.$el.off(),this.albumSearch.release()}});return new s({model:new t.Model})}),define("page/center/voiceAnalysis",["jquery","page/page_base","plugin/dialog","page/center/common","module/my/voiceAnalysis"],function(e,t,n,r,i){var s=t.extend({init:function(){r.init(),i.init()},release:function(){this.callpParent("release"),i.release()}});return new s}),define("module/my/albumAnalysis",["jquery","backbone","moment","module/my/albumSearch","plugin/dialog","page/center/dataCenterUtils","exporting","datepicker","plugin/jquery.selecter"],function(e,t,n,r,i,s){var o=s.getUrlHost(),u=t.View.extend({albumId:e(".j-analyzeAlbumName").attr("albumid"),realId:window.helper.getParameterByName("realId")||"",coreModel:null,rankModel:null,listenModel:null,saveModel:null,soldModel:null,period:30,today:n().startOf("day"),yesterday:n().subtract(1,"d"),init:function(){this.initCoreData(),this.coreModel=new t.Model({realId:this.realId,albumId:this.albumId,kpi:9,startStamp:+n().subtract(this.period,"d").startOf("day"),endStamp:+n().subtract(1,"d").startOf("day")}),this.rankModel=new t.Model({albumId:this.albumId,realId:this.realId,startStamp:+n().subtract(this.period,"d").startOf("day"),endStamp:+n().subtract(1,"d").startOf("day")}),this.listenModel=new t.Model({realId:this.realId,albumId:this.albumId}),this.saveModel=new t.Model({realId:this.realId,albumId:this.albumId,pageNum:1}),this.soldModel=new t.Model({albumId:this.albumId,startStamp:+n().subtract(this.period-1,"d").startOf("day"),endStamp:+n().startOf("day")}),this.coreModel.on("change",function(){this.getChartData(e("#core_chart").find(".cont"),"core",this.coreModel.toJSON())},this),this.rankModel.on("change",function(){this.getChartData(e("#rank_chart").find(".cont"),"rank",this.rankModel.toJSON())},this),this.saveModel.on("change",function(){this.getSavedData(e("#save_chart").find("tbody"))},this),this.soldModel.on("change",function(){this.getChartData(e("#sold_chart").find(".cont"),"sold",this.soldModel.toJSON())},this),this.initAlbumSearch(),this.bindEvents(),this.getChartData(e("#core_chart").find(".cont"),"core",this.coreModel.toJSON()),this.getChartData(e("#rank_chart").find(".cont"),"rank",this.rankModel.toJSON()),this.getChartData(e("#listen_chart").find(".cont"),"listen",this.listenModel.toJSON()),this.getSavedData(e("#save_chart").find("tbody")),this.getChartData(e("#sold_chart").find(".cont"),"sold",this.soldModel.toJSON())},initCoreData:function(){this.getAlbumTotalKpis()},getAlbumTotalKpis:function(){var t=this,n=o+"/albumTotalKpis/ts-"+Date.now();e.ajax({url:n,type:"get",data:{albumId:t.albumId,realId:t.realId},xhrFields:{withCredentials:!0},success:function(e){console.log(e,"---");if(e.res===200){var n=[e.subscribedCount,e.playedCount,e.finishedRate];t.setAlbumTotalKpis(n)}},error:function(e){}})},setAlbumTotalKpis:function(t){var n=s.parseCompared,r=e(".data-up-down"),i=r.find("li");i.each(function(r,i){var s=e(this);s.find(".data-week").eq(0).find(".data-week-arr").html(n(t[r].yesterday)),s.find(".data-week").eq(1).find(".data-week-arr").html(n(t[r].comparedYest)),s.find(".data-week").eq(2).find(".data-week-arr").html(n(t[r].total))})},initAlbumSearch:function(){var t=this;this.albumSearch=new r(function(n,r){e(".j-analyzeAlbumName").text(n).attr("albumid",r.attr("data-albumid"));var i=r.attr("data-albumid"),s=[];t.albumId=i,i&&s.push("albumId="+i),t.realId&&s.push("realId="+t.realId);var o="/center/dataAnalyze/albumData?"+s.join("&");router.toPage(o,!0,"#sub-main-box")}),this.albumSearch.init()},bindEvents:function(){var t=this;t.shiftTab(),t.getMoreSavedData(),t.selectWeek(),t.downloadChart();var n=e("#core_chart #startDate"),r=e("#core_chart #endDate"),i=e("#core_chart [data-period]"),s=e("#rank_chart #startDate"),o=e("#rank_chart #endDate"),u=e("#rank_chart [data-period]");$soldStartDate=e("#sold_chart #startDate"),$soldEndDate=e("#sold_chart #endDate"),$soldDateBtns=e("#sold_chart [data-period]"),t.datePickerHandler(e("#core_chart"),t.coreModel,n,r,i),t.datePickerHandler(e("#rank_chart"),t.rankModel,s,o,u),t.datePickerHandler(e("#sold_chart"),t.soldModel,$soldStartDate,$soldEndDate,$soldDateBtns,!0)},datePickerHandler:function(t,r,s,o,u,a){var f=this,l="2016-01-01",c=n.max(n().subtract(2,"y"),n(l)).format("YYYY-MM-DD");t.on("click","[kpitype]",function(){t.find("[kpitype]").removeClass("on"),r.set("kpi",e(this).addClass("on").attr("kpitype"))}).on("focus","#startDate",function(){var t=o.val();e(this).datepicker("destroy").datepicker({startDate:c,endDate:t,pick:function(e){var t=n(e.date).add(60,"d"),s=n.min(t,f.yesterday,n(o.val())).format("YYYY-MM-DD");a&&(s=n.min(t,f.today,n(o.val())).format("YYYY-MM-DD")),o.val(s),e.view==="day"&&(+n(e.date)<=+n(s)?(r.set({startStamp:+n(e.date),endStamp:+n(s)}),u.removeClass("primary")):i.warn("请选择合理的时间哦"))}})}).on("focus","#endDate",function(){var t=n(s.val()).add(60,"d"),i=n.min(t,f.yesterday).format("YYYY-MM-DD");a&&(i=n.min(t,f.today).format("YYYY-MM-DD")),e(this).datepicker("destroy").datepicker({startDate:s.val(),endDate:i,pick:function(e){e.view==="day"&&(r.set({endStamp:+n(e.date)}),u.removeClass("primary"))}})}).on("click","[data-period]",function(){var t=e(this),i=parseInt(t.attr("data-period")),f=+n().subtract(i,"d").startOf("day"),l=+n().subtract(1,"d").startOf("day");a&&(f=+n().subtract(i-1,"d").startOf("day"),l=+n().startOf("day")),r.set({startStamp:f,endStamp:l}),s.val(n(f).format("YYYY-MM-DD")),o.val(n(l).format("YYYY-MM-DD")),u.removeClass("primary"),t.addClass("primary")})},shiftTab:function(){e(".j-analyzeTab").children().each(function(){var t=e(this),n=t.attr("type");t.off().on("click",function(){e(".j-analyzeTab").children().removeClass("active"),t.addClass("active");var n=t.attr("type");n==="albumQualityAnalyze"?(e(".data-program").removeClass("hidden"),e(".data-sales").addClass("hidden")):n==="albumSalesAnalyze"&&(e(".data-program").addClass("hidden"),e(".data-sales").removeClass("hidden"))})})},getMoreSavedData:function(){var t=this;e("#save_chart .data-addmor").on("click",function(){t.saveModel.set("pageNum",t.saveModel.get("pageNum")+1)})},selectWeek:function(){var t=this;e("#save_chart .selecter").selecter({onChange:function(n){var r=this;e("#save_chart").find("tbody").empty(),n==="全部"?t.saveModel.clear({silent:!0}).set({albumId:t.albumId,pageNum:1}):t.saveModel.set({startStamp:e(r).attr("data-time"),pageNum:1})}})},getChartData:function(t,n,r){var i=this,s,u=["#fc5832","#ddd7d5"];if(!r.albumId)return;switch(n){case"core":s=o+"/albumDailyKpis/ts-"+Date.now(),u=["#ddd7d5","#fc5832"];break;case"rank":s="/center/dataAnalyze/getAlbumRankDataJson";break;case"listen":s="/center/dataAnalyze/getAlbumTotalPlayDistJson";break;case"sold":s="/center/dataAnalyze/getAlbumDailySoldDataJson";break;default:s="/center/dataAnalyze/getAlbumMainIndexJson"}i.model.fetch({url:s,data:r,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},beforeSend:function(){e(".toast").fadeIn(100).prev().removeClass("hidden")},success:function(n,r){e(".toast").fadeOut(500).prev().addClass("hidden"),!t.siblings(".no-data")||t.siblings(".no-data").remove(),t.highcharts({chart:{type:"spline",width:750,height:400},colors:u,title:{text:""},xAxis:{categories:r.categories},yAxis:{title:{text:r.yAxisText}},tooltip:{formatter:function(){var e=this.x,t=r.valueSuffix;return this.color==="red"?e+="<br/>"+this.series.name+": "+"<b>"+"计算中"+"<b/>":e+="<br/>"+this.series.name+": "+"<b>"+this.y+t+"<b/>",e},shared:!1,valueSuffix:r.valueSuffix},series:r.series}),s.indexOf("getAlbumMainIndexJson")!==-1&&r.rangeSumAverage?(e(".j-rangeSumAverage").removeClass("hidden"),e(".j-rangeSumAverage").find("span").text(r.rangeSumAverage)):s.indexOf("getAlbumMainIndexJson")!==-1&&!r.rangeSumAverage&&e(".j-rangeSumAverage").addClass("hidden"),s.indexOf("getAlbumDailySoldDataJson")!==-1&&r.albumTotalSold?(e(".j-totalSold").removeClass("hidden"),e(".j-totalSold").find("span").text(r.albumTotalSold)):s.indexOf("getAlbumDailySoldDataJson")!==-1&&!r.albumTotalSold&&e(".j-totalSold").addClass("hidden")},error:function(n,r){e(".toast").fadeOut(500).prev().addClass("hidden"),!t.siblings(".no-data")||t.siblings(".no-data").remove(),t.empty().parent().append('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')},removed:function(n,r){e(".toast").fadeOut(500).prev().addClass("hidden"),!t.siblings(".no-data")||t.siblings(".no-data").remove(),t.empty().parent().append('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')}})},getSavedData:function(t){var n=this,r=n.saveModel.get("albumId");if(!r)return;n.model.fetch({url:"/center/dataAnalyze/getAlbumRetentionJson",data:n.saveModel.toJSON(),type:"GET",dataType:"json",beforeSend:function(){e(".toast").fadeIn(100).prev().removeClass("hidden")},success:function(n,r){e(".toast").fadeOut(500).prev().addClass("hidden"),r.hasMore?(e("#save_chart .j-showMoreBtn").removeClass("hidden"),t.html(t.html()+r.html)):(e("#save_chart .j-showMoreBtn").addClass("hidden"),t.html(t.html()+r.html))},error:function(t,n){e(".toast").fadeOut(500).prev().addClass("hidden")},removed:function(t,n){e(".toast").fadeOut(500).prev().addClass("hidden")}})},downloadChart:function(){var t=this;e(".j-downloadBtn").off().on("click",function(){var n=e(".j-analyzeAlbumName").attr("albumid"),r=t.soldModel.get("startStamp"),i=t.soldModel.get("endStamp"),s=e("<iframe/>").hide().attr("src","/center/dataAnalyze/downloadAlbumSoldData?albumId="+n+"&startStamp="+r+"&endStamp="+i).appendTo("body").load(function(){s.remove()})})},release:function(){this.coreModel.off(),this.rankModel.off(),this.listenModel.off(),this.saveModel.off(),this.soldModel.off(),this.albumSearch.release()}});return new u({model:new t.Model})}),define("page/center/albumAnalysis",["jquery","page/page_base","page/center/common","module/my/albumAnalysis"],function(e,t,n,r){var i=t.extend({init:function(){n.init(),r.init()},release:function(){this.callParent("release"),r.release()}});return new i}),define("module/my/dataPreview",["jquery","backbone","moment","plugin/dialog","page/center/dataCenterUtils","exporting","datepicker"],function(e,t,n,r,i){var s=i.getUrlHost(),o=t.View.extend({coreModel:null,rankModel:null,period:30,yesterday:n().subtract(1,"d"),anchorDailyKpiArr:[1,3,9,14,20],init:function(){this.initCoreData(),this.coreModel=new t.Model({realId:window.helper.getParameterByName("realId")||null,kpiType:1,startStamp:+n().subtract(this.period,"d").startOf("day"),endStamp:+n().subtract(1,"d").startOf("day")}),this.rankModel=new t.Model({realId:window.helper.getParameterByName("realId")||null,kpiType:17,startStamp:+n().subtract(this.period,"d").startOf("day"),endStamp:+n().subtract(1,"d").startOf("day")}),this.coreModel.on("change",function(){this.getChartData(e("#trend_chart").find(".cont"),this.coreModel.toJSON())},this),this.rankModel.on("change",function(){this.getChartData(e("#rank_chart").find(".cont"),this.rankModel.toJSON())},this),this.bindEvents(),this.getChartData(e("#trend_chart").find(".cont"),this.coreModel.toJSON()),this.getChartData(e("#rank_chart").find(".cont"),this.rankModel.toJSON())},bindEvents:function(){var t=this,n=e("#trend_chart #startDate"),r=e("#trend_chart #endDate"),i=e("#trend_chart [data-period]"),s=e("#trend_chart #listenStartDate"),o=e("#trend_chart #listenEndDate"),u=e("#trend_chart [data-listen-period]"),a=e("#rank_chart #startDate"),f=e("#rank_chart #endDate"),l=e("#rank_chart [data-period]");t.datePickerHandler(e("#trend_chart"),t.coreModel,n,r,i),t.datePickerHandler(e("#trend_chart"),t.coreModel,s,o,u,!0),t.datePickerHandler(e("#rank_chart"),t.rankModel,a,f,l),t.kpiTypeShift()},initCoreData:function(){this.getAnchorTotalKpis()},kpiTypeShift:function(){var t=this;e("#trend_chart").on("click","[kpitype]",function(){e(this).siblings().removeClass("on");var r=e(this).addClass("on").attr("kpitype");r==6?(e('[category="listen"]').removeClass("hidden"),e('[category="other"]').addClass("hidden"),t.coreModel.set({kpiType:e(this).addClass("on").attr("kpitype"),startStamp:+n(e("#trend_chart").find("#listenStartDate").val()),endStamp:+n(e("#trend_chart").find("#listenEndDate").val())})):(e('[category="listen"]').addClass("hidden"),e('[category="other"]').removeClass("hidden"),t.coreModel.set({kpiType:r,startStamp:+n(e("#trend_chart").find("#startDate").val()),endStamp:+n(e("#trend_chart").find("#endDate").val())}))}),e("#rank_chart").on("click","[kpitype]",function(){e(this).siblings().removeClass("on");var r=e(this).addClass("on").attr("kpitype");t.rankModel.set({kpiType:r,startStamp:+n(e("#rank_chart").find("#startDate").val()),endStamp:+n(e("#rank_chart").find("#endDate").val())})})},datePickerHandler:function(t,i,s,o,u,a){var f=this;if(a){var l="2016-07-01",c=n.max(n().subtract(2,"y"),n(l)).format("YYYY-MM-DD");t.on("focus","#listenStartDate",function(){var t=o.val();e(this).datepicker("destroy").datepicker({startDate:c,endDate:t,pick:function(e){var t=n(e.date).add(60,"d"),s=n.min(t,f.yesterday,n(o.val())).format("YYYY-MM-DD");o.val(s),e.view==="day"&&(+n(e.date)<=+n(s)?(i.set({startStamp:+n(e.date),endStamp:+n(s)}),u.removeClass("primary")):r.warn("请选择合理的时间哦"))}})}).on("focus","#listenEndDate",function(){var t=n(s.val()).add(60,"d"),r=n.min(t,f.yesterday).format("YYYY-MM-DD");e(this).datepicker("destroy").datepicker({startDate:s.val(),endDate:r,pick:function(e){e.view==="day"&&(i.set({endStamp:+n(e.date)}),u.removeClass("primary"))}})}).on("click","[data-listen-period]",function(){var t=e(this),r=parseInt(t.attr("data-listen-period")),a=+n().subtract(r,"d").startOf("day"),f=+n().subtract(1,"d").startOf("day");i.set({startStamp:a,endStamp:f}),s.val(n(a).format("YYYY-MM-DD")),o.val(n(f).format("YYYY-MM-DD")),u.removeClass("primary"),t.addClass("primary")})}else{var l="2016-01-01",c=n.max(n().subtract(2,"y"),n(l)).format("YYYY-MM-DD");t.on("focus","#startDate",function(){var t=o.val();e(this).datepicker("destroy").datepicker({startDate:c,endDate:t,pick:function(e){var t=n(e.date).add(60,"d"),s=n.min(t,f.yesterday,n(o.val())).format("YYYY-MM-DD");o.val(s),e.view==="day"&&(+n(e.date)<=+n(s)?(i.set({startStamp:+n(e.date),endStamp:+n(s)}),u.removeClass("primary")):r.warn("请选择合理的时间哦"))}})}).on("focus","#endDate",function(){var t=n(s.val()).add(60,"d"),r=n.min(t,f.yesterday).format("YYYY-MM-DD");e(this).datepicker("destroy").datepicker({startDate:s.val(),endDate:r,pick:function(e){e.view==="day"&&(i.set({endStamp:+n(e.date)}),u.removeClass("primary"))}})}).on("click","[data-period]",function(){var t=e(this),r=parseInt(t.attr("data-period")),a=+n().subtract(r,"d").startOf("day"),f=+n().subtract(1,"d").startOf("day");i.set({startStamp:a,endStamp:f}),s.val(n(a).format("YYYY-MM-DD")),o.val(n(f).format("YYYY-MM-DD")),u.removeClass("primary"),t.addClass("primary")})}},getChartData:function(t,n){var r=this,i=s+"/anchorDailyKpis/ts-"+Date.now(),o="/center/dataAnalyze/getDataPreviewJson",u=r.anchorDailyKpiArr.indexOf(+n.kpiType)>-1?i:o;r.model.fetch({url:u,data:n,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},beforeSend:function(){e(".toast").fadeIn(100).prev().removeClass("hidden")},success:function(n,r){console.log(r),e(".toast").fadeOut(500).prev().addClass("hidden"),!t.siblings(".no-data")||t.siblings(".no-data").remove(),t.highcharts({chart:{type:"spline"},colors:["#fc5832","#ddd7d5"],title:{text:""},xAxis:{categories:r.categories},yAxis:{title:{text:r.yAxisText}},tooltip:{formatter:function(){var e=this.x,t=r.valueSuffix;return this.color==="red"?e+="<br/>"+this.series.name+": "+"<b>"+"计算中"+"<b/>":e+="<br/>"+this.series.name+": "+"<b>"+this.y+t+"<b/>",e},shared:!1,valueSuffix:r.valueSuffix},series:r.series})},error:function(n,r){e(".toast").fadeOut(500).prev().addClass("hidden"),!t.siblings(".no-data")||t.siblings(".no-data").remove(),t.empty().parent().append('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')},removed:function(n,r){e(".toast").fadeOut(500).prev().addClass("hidden"),!t.siblings(".no-data")||t.siblings(".no-data").remove(),t.empty().parent().append('<div class="no-data mgt-40"><span class="iconfont icon-ic_test2"></span><span>暂无数据，加油哦！</span></div>')}})},getAnchorTotalKpis:function(){var t=this,n=s+"/anchorTotalKpis/ts-"+Date.now();e.ajax({url:n,type:"get",data:{realId:i.getRealId()},xhrFields:{withCredentials:!0},success:function(e){e.res&&t.setAnchorTotalKpis(e.data)},error:function(e){}})},setAnchorTotalKpis:function(t){var n=i.parseCompared,r=e(".data-up-down"),s=r.find("li");s.each(function(r,i){var s=e(this);s.find(".data-week-sub")[0].firstChild.textContent=t[r].title+" ",s.find(".data-week-num").text(t[r].totalKpi),s.find(".data-week").eq(0).find(".data-week-arr").html(n(t[r].dayCompared)),s.find(".data-week").eq(1).find(".data-week-arr").html(n(t[r].weekCompared)),s.find(".data-week").eq(2).find(".data-week-arr").html(n(t[r].monthCompared))})},release:function(){this.coreModel.off(),this.rankModel.off()}});return new o({model:new t.Model})}),define("page/center/dataPreview",["jquery","page/page_base","page/center/common","module/my/dataPreview"],function(e,t,n,r){var i=t.extend({init:function(){n.init(),r.init()},release:function(){this.callParent("release"),r.release()}});return new i}),function(e){typeof module=="object"&&module.exports?module.exports=e:define?define("highmap",["highchart"],e):e(Highcharts)}(function(e){window.Highcharts=e,function(e){var t=e.Axis,n=e.each,r=e.pick,i=e.wrap;i(t.prototype,"getSeriesExtremes",function(e){var t=this.isXAxis,i,s,o=[],u;t&&n(this.series,function(e,t){e.useMapGeometry&&(o[t]=e.xData,e.xData=[])}),e.call(this),t&&(i=r(this.dataMin,Number.MAX_VALUE),s=r(this.dataMax,-Number.MAX_VALUE),n(this.series,function(e,t){e.useMapGeometry&&(i=Math.min(i,r(e.minX,i)),s=Math.max(s,r(e.maxX,i)),e.xData=o[t],u=!0)}),u&&(this.dataMin=i,this.dataMax=s))}),i(t.prototype,"setAxisTranslation",function(e){var t=this.chart,r,i=t.plotWidth/t.plotHeight,s,o=t.xAxis[0],u,a,f,l;e.call(this),this.coll==="yAxis"&&o.transA!==undefined&&n(this.series,function(e){e.preserveAspectRatio&&(l=!0)});if(l){this.transA=o.transA=Math.min(this.transA,o.transA),r=i/((o.max-o.min)/(this.max-this.min)),u=r<1?this:o,s=(u.max-u.min)*u.transA,u.pixelPadding=u.len-s,u.minPixelPadding=u.pixelPadding/2,a=u.fixTo;if(a){f=a[1]-u.toValue(a[0],!0),f*=u.transA;if(Math.abs(f)>u.minPixelPadding||u.min===u.dataMin&&u.max===u.dataMax)f=0;u.minPixelPadding-=f}}}),i(t.prototype,"render",function(e){e.call(this),this.fixTo=null})}(e),function(e){var t=e.Axis,n=e.Chart,r=e.color,i,s=e.each,o=e.extend,u=e.isNumber,a=e.Legend,f=e.LegendSymbolMixin,l=e.noop,c=e.merge,h=e.pick,p=e.wrap;i=e.ColorAxis=function(){this.init.apply(this,arguments)},o(i.prototype,t.prototype),o(i.prototype,{defaultColorAxisOptions:{lineWidth:0,minPadding:0,maxPadding:0,gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{overflow:"justify",rotation:0},minColor:"#e6ebf5",maxColor:"#003399",tickLength:5,showInLegend:!0},keepProps:["legendGroup","legendItemHeight","legendItemWidth","legendItem","legendSymbol"].concat(t.prototype.keepProps),init:function(e,n){var r=e.options.legend.layout!=="vertical",i;this.coll="colorAxis",i=c(this.defaultColorAxisOptions,{side:r?2:1,reversed:!r},n,{opposite:!r,showEmpty:!1,title:null}),t.prototype.init.call(this,e,i),n.dataClasses&&this.initDataClasses(n),this.initStops(n),this.horiz=r,this.zoomEnabled=!1,this.defaultLegendLength=200},tweenColors:function(e,t,n){var r,i;return!t.rgba.length||!e.rgba.length?i=t.input||"none":(e=e.rgba,t=t.rgba,r=t[3]!==1||e[3]!==1,i=(r?"rgba(":"rgb(")+Math.round(t[0]+(e[0]-t[0])*(1-n))+","+Math.round(t[1]+(e[1]-t[1])*(1-n))+","+Math.round(t[2]+(e[2]-t[2])*(1-n))+(r?","+(t[3]+(e[3]-t[3])*(1-n)):"")+")"),i},initDataClasses:function(e){var t=this,n=this.chart,i,o=0,u=n.options.chart.colorCount,a=this.options,f=e.dataClasses.length;this.dataClasses=i=[],this.legendItems=[],s(e.dataClasses,function(e,s){var l;e=c(e),i.push(e),e.color||(a.dataClassColor==="category"?(l=n.options.colors,u=l.length,e.color=l[o],e.colorIndex=o,o++,o===u&&(o=0)):e.color=t.tweenColors(r(a.minColor),r(a.maxColor),f<2?.5:s/(f-1)))})},initStops:function(e){this.stops=e.stops||[[0,this.options.minColor],[1,this.options.maxColor]],s(this.stops,function(e){e.color=r(e[1])})},setOptions:function(e){t.prototype.setOptions.call(this,e),this.options.crosshair=this.options.marker},setAxisSize:function(){var e=this.legendSymbol,t=this.chart,n=t.options.legend||{},r,i,s,o;e?(this.left=r=e.attr("x"),this.top=i=e.attr("y"),this.width=s=e.attr("width"),this.height=o=e.attr("height"),this.right=t.chartWidth-r-s,this.bottom=t.chartHeight-i-o,this.len=this.horiz?s:o,this.pos=this.horiz?r:i):this.len=(this.horiz?n.symbolWidth:n.symbolHeight)||this.defaultLegendLength},toColor:function(e,t){var n,r=this.stops,i,s,o,u=this.dataClasses,a,f;if(u){f=u.length;while(f--){a=u[f],i=a.from,s=a.to;if((i===undefined||e>=i)&&(s===undefined||e<=s)){o=a.color,t&&(t.dataClass=f,t.colorIndex=a.colorIndex);break}}}else{this.isLog&&(e=this.val2lin(e)),n=1-(this.max-e)/(this.max-this.min||1),f=r.length;while(f--)if(n>r[f][0])break;i=r[f]||r[f+1],s=r[f+1]||i,n=1-(s[0]-n)/(s[0]-i[0]||1),o=this.tweenColors(i.color,s.color,n)}return o},getOffset:function(){var e=this.legendGroup,n=this.chart.axisOffset[this.side];e&&(this.axisParent=e,t.prototype.getOffset.call(this),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=n)},setLegendColor:function(){var e,t=this.horiz,n=this.options,r=this.reversed,i=r?1:0,s=r?0:1;e=t?[i,0,s,0]:[0,s,0,i],this.legendColor={linearGradient:{x1:e[0],y1:e[1],x2:e[2],y2:e[3]},stops:n.stops||[[0,n.minColor],[1,n.maxColor]]}},drawLegendSymbol:function(e,t){var n=e.padding,r=e.options,i=this.horiz,s=h(r.symbolWidth,i?this.defaultLegendLength:12),o=h(r.symbolHeight,i?12:this.defaultLegendLength),u=h(r.labelPadding,i?16:30),a=h(r.itemDistance,10);this.setLegendColor(),t.legendSymbol=this.chart.renderer.rect(0,e.baseline-11,s,o).attr({zIndex:1}).add(t.legendGroup),this.legendItemWidth=s+n+(i?a:u),this.legendItemHeight=o+n+(i?u:0)},setState:l,visible:!0,setVisible:l,getSeriesExtremes:function(){var e=this.series,t=e.length;this.dataMin=Infinity,this.dataMax=-Infinity;while(t--)e[t].valueMin!==undefined&&(this.dataMin=Math.min(this.dataMin,e[t].valueMin),this.dataMax=Math.max(this.dataMax,e[t].valueMax))},drawCrosshair:function(e,n){var r=n&&n.plotX,i=n&&n.plotY,s,o=this.pos,u=this.len;n&&(s=this.toPixels(n[n.series.colorKey]),s<o?s=o-2:s>o+u&&(s=o+u+2),n.plotX=s,n.plotY=this.len-s,t.prototype.drawCrosshair.call(this,e,n),n.plotX=r,n.plotY=i,this.cross&&(this.cross.addClass("highcharts-coloraxis-marker").add(this.legendGroup),this.cross.attr({fill:this.crosshair.color})))},getPlotLinePath:function(e,n,r,i,s){return u(s)?this.horiz?["M",s-4,this.top-6,"L",s+4,this.top-6,s,this.top,"Z"]:["M",this.left,s,"L",this.left-6,s+6,this.left-6,s-6,"Z"]:t.prototype.getPlotLinePath.call(this,e,n,r,i)},update:function(e,n){var r=this.chart,i=r.legend;s(this.series,function(e){e.isDirtyData=!0}),e.dataClasses&&i.allItems&&(s(i.allItems,function(e){e.isDataClass&&e.legendGroup.destroy()}),r.isDirtyLegend=!0),r.options[this.coll]=c(this.userOptions,e),t.prototype.update.call(this,e,n),this.legendItem&&(this.setLegendColor(),i.colorizeItem(this,!0))},getDataClassLegendSymbols:function(){var t=this,n=this.chart,r=this.legendItems,i=n.options.legend,u=i.valueDecimals,a=i.valueSuffix||"",c;return r.length||s(this.dataClasses,function(i,h){var p=!0,d=i.from,v=i.to;c="",d===undefined?c="< ":v===undefined&&(c="> "),d!==undefined&&(c+=e.numberFormat(d,u)+a),d!==undefined&&v!==undefined&&(c+=" - "),v!==undefined&&(c+=e.numberFormat(v,u)+a),r.push(o({chart:n,name:c,options:{},drawLegendSymbol:f.drawRectangle,visible:!0,setState:l,isDataClass:!0,setVisible:function(){p=this.visible=!p,s(t.series,function(e){s(e.points,function(e){e.dataClass===h&&e.setVisible(p)})}),n.legend.colorizeItem(this,p)}},i))}),r},name:""}),s(["fill","stroke"],function(t){e.Fx.prototype[t+"Setter"]=function(){this.elem.attr(t,i.prototype.tweenColors(r(this.start),r(this.end),this.pos),null,!0)}}),p(n.prototype,"getAxes",function(e){var t=this.options,n=t.colorAxis;e.call(this),this.colorAxis=[],n&&new i(this,n)}),p(a.prototype,"getAllItems",function(e){var t=[],n=this.chart.colorAxis[0];return n&&n.options&&(n.options.showInLegend&&(n.options.dataClasses?t=t.concat(n.getDataClassLegendSymbols()):t.push(n)),s(n.series,function(e){e.options.showInLegend=!1})),t.concat(e.call(this))}),p(a.prototype,"colorizeItem",function(e,t,n){e.call(this,t,n),n&&t.legendColor&&t.legendSymbol.attr({fill:t.legendColor})})}(e),function(e){var t=e.defined,n=e.each,r=e.noop,i=e.seriesTypes;e.colorPointMixin={isValid:function(){return this.value!==null},setVisible:function(e){var t=this,r=e?"show":"hide";n(["graphic","dataLabel"],function(e){t[e]&&t[e][r]()})},setState:function(t){e.Point.prototype.setState.call(this,t),this.graphic&&this.graphic.attr({zIndex:t==="hover"?1:0})}},e.colorSeriesMixin={pointArrayMap:["value"],axisTypes:["xAxis","yAxis","colorAxis"],optionalAxis:"colorAxis",trackerGroups:["group","markerGroup","dataLabelsGroup"],getSymbol:r,parallelArrays:["x","y","value"],colorKey:"value",pointAttribs:i.column.prototype.pointAttribs,translateColors:function(){var e=this,t=this.options.nullColor,r=this.colorAxis,i=this.colorKey;n(this.data,function(n){var s=n[i],o;o=n.options.color||(n.isNull?t:r&&s!==undefined?r.toColor(s,n):n.color||e.color),o&&(n.color=o)})},colorAttribs:function(e){var n={};return t(e.color)&&(n[this.colorProp||"fill"]=e.color),n}}}(e),function(e){function f(e){e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)}function l(e){this.init(e)}var t=e.addEvent,n=e.Chart,r=e.doc,i=e.each,s=e.extend,o=e.merge,u=e.pick,a=e.wrap;l.prototype.init=function(e){this.chart=e,e.mapNavButtons=[]},l.prototype.update=function(e){var n=this.chart,r=n.options.mapNavigation,i,a,l,c,h,p,d,v,m=function(e){this.handler.call(n,e),f(e)},g=n.mapNavButtons;e&&(r=n.options.mapNavigation=o(n.options.mapNavigation,e));while(g.length)g.pop().destroy();if(u(r.enableButtons,r.enabled)&&!n.renderer.forExport){i=r.buttons;for(a in i)i.hasOwnProperty(a)&&(c=o(r.buttonOptions,i[a]),h=c.theme,h.style=o(c.theme.style,c.style),p=h.states,d=p&&p.hover,v=p&&p.select,l=n.renderer.button(c.text,0,0,m,h,d,v,0,a==="zoomIn"?"topbutton":"bottombutton").addClass("highcharts-map-navigation").attr({width:c.width,height:c.height,title:n.options.lang[a],padding:c.padding,zIndex:5}).add(),l.handler=c.onclick,l.align(s(c,{width:l.width,height:2*l.height}),null,c.alignTo),t(l.element,"dblclick",f),g.push(l))}this.updateEvents(r)},l.prototype.updateEvents=function(e){var n=this.chart;u(e.enableDoubleClickZoom,e.enabled)||e.enableDoubleClickZoomTo?this.unbindDblClick=this.unbindDblClick||t(n.container,"dblclick",function(e){n.pointer.onContainerDblClick(e)}):this.unbindDblClick&&(this.unbindDblClick=this.unbindDblClick()),u(e.enableMouseWheelZoom,e.enabled)?this.unbindMouseWheel=this.unbindMouseWheel||t(n.container,r.onmousewheel===undefined?"DOMMouseScroll":"mousewheel",function(e){return n.pointer.onContainerMouseWheel(e),f(e),!1}):this.unbindMouseWheel&&(this.unbindMouseWheel=this.unbindMouseWheel())},s(n.prototype,{fitToBox:function(e,t){return i([["x","width"],["y","height"]],function(n){var r=n[0],i=n[1];e[r]+e[i]>t[r]+t[i]&&(e[i]>t[i]?(e[i]=t[i],e[r]=t[r]):e[r]=t[r]+t[i]-e[i]),e[i]>t[i]&&(e[i]=t[i]),e[r]<t[r]&&(e[r]=t[r])}),e},mapZoom:function(e,t,n,r,i){var s=this,o=s.xAxis[0],a=o.max-o.min,f=u(t,o.min+a/2),l=a*e,c=s.yAxis[0],h=c.max-c.min,p=u(n,c.min+h/2),d=h*e,v=r?(r-o.pos)/o.len:.5,m=i?(i-c.pos)/c.len:.5,g=f-l*v,y=p-d*m,b=s.fitToBox({x:g,y:y,width:l,height:d},{x:o.dataMin,y:c.dataMin,width:o.dataMax-o.dataMin,height:c.dataMax-c.dataMin}),w=b.x<=o.dataMin&&b.width>=o.dataMax-o.dataMin&&b.y<=c.dataMin&&b.height>=c.dataMax-c.dataMin;r&&(o.fixTo=[r-o.pos,t]),i&&(c.fixTo=[i-c.pos,n]),e!==undefined&&!w?(o.setExtremes(b.x,b.x+b.width,!1),c.setExtremes(b.y,b.y+b.height,!1)):(o.setExtremes(undefined,undefined,!1),c.setExtremes(undefined,undefined,!1)),s.redraw()}}),a(n.prototype,"render",function(e){this.mapNavigation=new l(this),this.mapNavigation.update(),e.call(this)})}(e),function(e){var t=e.extend,n=e.pick,r=e.Pointer,i=e.wrap;t(r.prototype,{onContainerDblClick:function(e){var t=this.chart;e=this.normalize(e),t.options.mapNavigation.enableDoubleClickZoomTo?t.pointer.inClass(e.target,"highcharts-tracker")&&t.hoverPoint&&t.hoverPoint.zoomTo():t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop)&&t.mapZoom(.5,t.xAxis[0].toValue(e.chartX),t.yAxis[0].toValue(e.chartY),e.chartX,e.chartY)},onContainerMouseWheel:function(e){var t=this.chart,n;e=this.normalize(e),n=e.detail||-(e.wheelDelta/120),t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop)&&t.mapZoom(Math.pow(t.options.mapNavigation.mouseWheelSensitivity,n),t.xAxis[0].toValue(e.chartX),t.yAxis[0].toValue(e.chartY),e.chartX,e.chartY)}}),i(r.prototype,"zoomOption",function(e){var t=this.chart.options.mapNavigation;n(t.enableTouchZoom,t.enabled)&&(this.chart.options.chart.pinchType="xy"),e.apply(this,[].slice.call(arguments,1))}),i(r.prototype,"pinchTranslate",function(e,t,n,r,i,s,o){var u;e.call(this,t,n,r,i,s,o),this.chart.options.chart.type==="map"&&this.hasZoom&&(u=r.scaleX>r.scaleY,this.pinchTranslateDirection(!u,t,n,r,i,s,o,u?r.scaleX:r.scaleY))})}(e),function(e){var t=e.color,n=e.ColorAxis,r=e.colorPointMixin,i=e.colorSeriesMixin,s=e.doc,o=e.each,u=e.extend,a=e.isNumber,f=e.LegendSymbolMixin,l=e.map,c=e.merge,h=e.noop,p=e.pick,d=e.isArray,v=e.Point,m=e.Series,g=e.seriesType,y=e.seriesTypes,b=e.splat,w=s.documentElement.style.vectorEffect!==undefined;g("map","scatter",{allAreas:!0,animation:!1,nullColor:"#f7f7f7",borderColor:"#cccccc",borderWidth:1,marker:null,stickyTracking:!1,joinBy:"hc-key",dataLabels:{formatter:function(){return this.point.value},inside:!0,verticalAlign:"middle",crop:!1,overflow:!1,padding:0},turboThreshold:0,tooltip:{followPointer:!0,pointFormat:"{point.name}: {point.value}<br/>"},states:{normal:{animation:!0},hover:{brightness:.2,halo:null},select:{color:"#cccccc"}}},c(i,{type:"map",supportsDrilldown:!0,getExtremesFromAll:!0,useMapGeometry:!0,forceDL:!0,searchPoint:h,directTouch:!0,preserveAspectRatio:!0,pointArrayMap:["value"],getBox:function(t){var n=Number.MAX_VALUE,r=-n,i=n,s=-n,u=n,f=n,l=this.xAxis,c=this.yAxis,h;o(t||[],function(t){if(t.path){typeof t.path=="string"&&(t.path=e.splitPath(t.path));var o=t.path||[],l=o.length,c=!1,d=-n,v=n,m=-n,g=n,y=t.properties;if(!t._foundBox){while(l--)a(o[l])&&(c?(d=Math.max(d,o[l]),v=Math.min(v,o[l])):(m=Math.max(m,o[l]),g=Math.min(g,o[l])),c=!c);t._midX=v+(d-v)*(t.middleX||y&&y["hc-middle-x"]||.5),t._midY=g+(m-g)*(t.middleY||y&&y["hc-middle-y"]||.5),t._maxX=d,t._minX=v,t._maxY=m,t._minY=g,t.labelrank=p(t.labelrank,(d-v)*(m-g)),t._foundBox=!0}r=Math.max(r,t._maxX),i=Math.min(i,t._minX),s=Math.max(s,t._maxY),u=Math.min(u,t._minY),f=Math.min(t._maxX-t._minX,t._maxY-t._minY,f),h=!0}}),h&&(this.minY=Math.min(u,p(this.minY,n)),this.maxY=Math.max(s,p(this.maxY,-n)),this.minX=Math.min(i,p(this.minX,n)),this.maxX=Math.max(r,p(this.maxX,-n)),l&&l.options.minRange===undefined&&(l.minRange=Math.min(5*f,(this.maxX-this.minX)/5,l.minRange||n)),c&&c.options.minRange===undefined&&(c.minRange=Math.min(5*f,(this.maxY-this.minY)/5,c.minRange||n)))},getExtremes:function(){m.prototype.getExtremes.call(this,this.valueData),this.chart.hasRendered&&this.isDirtyData&&this.getBox(this.options.data),this.valueMin=this.dataMin,this.valueMax=this.dataMax,this.dataMin=this.minY,this.dataMax=this.maxY},translatePath:function(e){var t=this,n=!1,r=t.xAxis,i=t.yAxis,s=r.min,o=r.transA,u=r.minPixelPadding,f=i.min,l=i.transA,c=i.minPixelPadding,h,p=[];if(e){h=e.length;while(h--)a(e[h])?(p[h]=n?(e[h]-s)*o+u:(e[h]-f)*l+c,n=!n):p[h]=e[h]}return p},setData:function(t,n,r,i){var s=this.options,u=this.chart.options.chart,f=u&&u.map,h=s.mapData,p=s.joinBy,v=p===null,g=s.keys||this.pointArrayMap,y=[],w={},E,S,x=this.chart.mapTransforms,T,N;!h&&f&&(h=typeof f=="string"?e.maps[f]:f),v&&(p="_i"),p=this.joinBy=b(p),p[1]||(p[1]=p[0]),t&&o(t,function(e,n){var r=0;if(a(e))t[n]={value:e};else if(d(e)){t[n]={},!s.keys&&e.length>g.length&&typeof e[0]=="string"&&(t[n]["hc-key"]=e[0],++r);for(var i=0;i<g.length;++i,++r)g[i]&&(t[n][g[i]]=e[r])}v&&(t[n]._i=n)}),this.getBox(t),this.chart.mapTransforms=x=u&&u.mapTransforms||h&&h["hc-transform"]||x;if(x)for(S in x)x.hasOwnProperty(S)&&S.rotation&&(S.cosAngle=Math.cos(S.rotation),S.sinAngle=Math.sin(S.rotation));if(h){h.type==="FeatureCollection"&&(this.mapTitle=h.title,h=e.geojson(h,this.type,this)),this.mapData=h,this.mapMap={};for(N=0;N<h.length;N++)E=h[N],T=E.properties,E._i=N,p[0]&&T&&T[p[0]]&&(E[p[0]]=T[p[0]]),w[E[p[0]]]=E;this.mapMap=w,t&&p[1]&&o(t,function(e){w[e[p[1]]]&&y.push(w[e[p[1]]])}),s.allAreas?(this.getBox(h),t=t||[],p[1]&&o(t,function(e){y.push(e[p[1]])}),y="|"+l(y,function(e){return e&&e[p[0]]}).join("|")+"|",o(h,function(e){if(!p[0]||y.indexOf("|"+e[p[0]]+"|")===-1)t.push(c(e,{value:null})),i=!1})):this.getBox(y)}m.prototype.setData.call(this,t,n,r,i)},drawGraph:h,drawDataLabels:h,doFullTranslate:function(){return this.isDirtyData||this.chart.isResizing||this.chart.renderer.isVML||!this.baseTrans},translate:function(){var e=this,t=e.xAxis,n=e.yAxis,r=e.doFullTranslate();e.generatePoints(),o(e.data,function(i){i.plotX=t.toPixels(i._midX,!0),i.plotY=n.toPixels(i._midY,!0),r&&(i.shapeType="path",i.shapeArgs={d:e.translatePath(i.path)})}),e.translateColors()},pointAttribs:function(e,t){var n;return n=y.column.prototype.pointAttribs.call(this,e,t),e.isFading&&delete n.fill,w?n["vector-effect"]="non-scaling-stroke":n["stroke-width"]="inherit",n},drawPoints:function(){var e=this,t=e.xAxis,n=e.yAxis,r=e.group,i=e.chart,s=i.renderer,u,a,f,l,c=this.baseTrans,h,p,d,v,m;e.transformGroup||(e.transformGroup=s.g().attr({scaleX:1,scaleY:1}).add(r),e.transformGroup.survive=!0),e.doFullTranslate()?(i.hasRendered&&o(e.points,function(t){t.shapeArgs&&(t.shapeArgs.fill=e.pointAttribs(t,t.state).fill)}),e.group=e.transformGroup,y.column.prototype.drawPoints.apply(e),e.group=r,o(e.points,function(e){e.graphic&&(e.name&&e.graphic.addClass("highcharts-name-"+e.name.replace(/ /g,"-").toLowerCase()),e.properties&&e.properties["hc-key"]&&e.graphic.addClass("highcharts-key-"+e.properties["hc-key"].toLowerCase()))}),this.baseTrans={originX:t.min-t.minPixelPadding/t.transA,originY:n.min-n.minPixelPadding/n.transA+(n.reversed?0:n.len/n.transA),transAX:t.transA,transAY:n.transA},this.transformGroup.animate({translateX:0,translateY:0,scaleX:1,scaleY:1})):(u=t.transA/c.transAX,a=n.transA/c.transAY,f=t.toPixels(c.originX,!0),l=n.toPixels(c.originY,!0),u>.99&&u<1.01&&a>.99&&a<1.01&&(u=1,a=1,f=Math.round(f),l=Math.round(l)),h=this.transformGroup,i.renderer.globalAnimation?(p=h.attr("translateX"),d=h.attr("translateY"),v=h.attr("scaleX"),m=h.attr("scaleY"),h.attr({animator:0}).animate({animator:1},{step:function(e,t){h.attr({translateX:p+(f-p)*t.pos,translateY:d+(l-d)*t.pos,scaleX:v+(u-v)*t.pos,scaleY:m+(a-m)*t.pos})}})):h.attr({translateX:f,translateY:l,scaleX:u,scaleY:a})),w||e.group.element.setAttribute("stroke-width",e.options[e.pointAttrToOptions&&e.pointAttrToOptions["stroke-width"]||"borderWidth"]/(u||1)),this.drawMapDataLabels()},drawMapDataLabels:function(){m.prototype.drawDataLabels.call(this),this.dataLabelsGroup&&this.dataLabelsGroup.clip(this.chart.clipRect)},render:function(){var e=this,t=m.prototype.render;e.chart.renderer.isVML&&e.data.length>3e3?setTimeout(function(){t.call(e)}):t.call(e)},animate:function(e){var t=this.chart,n=this.options.animation,r=this.group,i=this.xAxis,s=this.yAxis,o=i.pos,u=s.pos;t.renderer.isSVG&&(n===!0&&(n={duration:1e3}),e?r.attr({translateX:o+i.len/2,translateY:u+s.len/2,scaleX:.001,scaleY:.001}):(r.animate({translateX:o,translateY:u,scaleX:1,scaleY:1},n),this.animate=null))},animateDrilldown:function(e){var t=this.chart.plotBox,n=this.chart.drilldownLevels[this.chart.drilldownLevels.length-1],r=n.bBox,i=this.chart.options.drilldown.animation,s;e||(s=Math.min(r.width/t.width,r.height/t.height),n.shapeArgs={scaleX:s,scaleY:s,translateX:r.x,translateY:r.y},o(this.points,function(e){e.graphic&&e.graphic.attr(n.shapeArgs).animate({scaleX:1,scaleY:1,translateX:0,translateY:0},i)}),this.animate=null)},drawLegendSymbol:f.drawRectangle,animateDrillupFrom:function(e){y.column.prototype.animateDrillupFrom.call(this,e)},animateDrillupTo:function(e){y.column.prototype.animateDrillupTo.call(this,e)}}),u({applyOptions:function(e,t){var n=v.prototype.applyOptions.call(this,e,t),r=this.series,i=r.joinBy,s;return r.mapData&&(s=n[i[1]]!==undefined&&r.mapMap[n[i[1]]],s?(r.xyFromShape&&(n.x=s._midX,n.y=s._midY),u(n,s)):n.value=n.value||null),n},onMouseOver:function(e){clearTimeout(this.colorInterval),this.value!==null?v.prototype.onMouseOver.call(this,e):this.series.onMouseOut(e)},onMouseOut:function(){var e=this,r=+(new Date),i=t(this.series.pointAttribs(e).fill),s=t(this.series.pointAttribs(e,"hover").fill),o=e.series.options.states.normal.animation,u=o&&(o.duration||500);u&&i.rgba.length===4&&s.rgba.length===4&&e.state!=="select"&&(clearTimeout(e.colorInterval),e.colorInterval=setInterval(function(){var t=(new Date-r)/u,o=e.graphic;t>1&&(t=1),o&&o.attr("fill",n.prototype.tweenColors.call(0,s,i,t)),t>=1&&clearTimeout(e.colorInterval)},13),e.isFading=!0),v.prototype.onMouseOut.call(e),e.isFading=null},zoomTo:function(){var e=this,t=e.series;t.xAxis.setExtremes(e._minX,e._maxX,!1),t.yAxis.setExtremes(e._minY,e._maxY,!1),t.chart.redraw()}},r))}(e),function(e){var t=e.seriesType,n=e.seriesTypes;t("mapline","map",{lineWidth:1,fillColor:"none"},{type:"mapline",colorProp:"stroke",pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth"},pointAttribs:function(e,t){var r=n.map.prototype.pointAttribs.call(this,e,t);return r.fill=this.options.fillColor,r},drawLegendSymbol:n.line.prototype.drawLegendSymbol})}(e),function(e){var t=e.merge,n=e.Point,r=e.seriesType;r("mappoint","scatter",{dataLabels:{enabled:!0,formatter:function(){return this.point.name},crop:!1,defer:!1,overflow:!1,style:{color:"#000000"}}},{type:"mappoint",forceDL:!0},{applyOptions:function(e,r){var i=e.lat!==undefined&&e.lon!==undefined?t(e,this.series.chart.fromLatLonToPoint(e)):e;return n.prototype.applyOptions.call(this,i,r)}})}(e),function(e){var t=e.arrayMax,n=e.arrayMin,r=e.Axis,i=e.color,s=e.each,o=e.isNumber,u=e.noop,a=e.pick,f=e.pInt,l=e.Point,c=e.Series,h=e.seriesType,p=e.seriesTypes;h("bubble","scatter",{dataLabels:{formatter:function(){return this.point.z},inside:!0,verticalAlign:"middle"},marker:{lineColor:null,lineWidth:1,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:!1,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"},{pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["markerGroup","dataLabelsGroup"],bubblePadding:!0,zoneAxis:"z",directTouch:!0,pointAttribs:function(e,t){var n=this.options.marker,r=a(n.fillOpacity,.5),s=c.prototype.pointAttribs.call(this,e,t);return r!==1&&(s.fill=i(s.fill).setOpacity(r).get("rgba")),s},getRadii:function(e,t,n,r){var i,s,o,u=this.zData,a=[],f=this.options,l=f.sizeBy!=="width",c=f.zThreshold,h=t-e,p,d;for(s=0,i=u.length;s<i;s++)p=u[s],f.sizeByAbsoluteValue&&p!==null&&(p=Math.abs(p-c),t=Math.max(t-c,Math.abs(e-c)),e=0),p===null?d=null:p<e?d=n/2-1:(o=h>0?(p-e)/h:.5,l&&o>=0&&(o=Math.sqrt(o)),d=Math.ceil(n+o*(r-n))/2),a.push(d);this.radii=a},animate:function(e){var t=this.options.animation;e||(s(this.points,function(e){var n=e.graphic,r;n&&n.width&&(r={x:n.x,y:n.y,width:n.width,height:n.height},n.attr({x:e.plotX,y:e.plotY,width:1,height:1}),n.animate(r,t))}),this.animate=null)},translate:function(){var t,n=this.data,r,i,s=this.radii;p.scatter.prototype.translate.call(this),t=n.length;while(t--)r=n[t],i=s?s[t]:0,o(i)&&i>=this.minPxSize/2?(r.marker=e.extend(r.marker,{radius:i,width:2*i,height:2*i}),r.dlBox={x:r.plotX-i,y:r.plotY-i,width:2*i,height:2*i}):r.shapeArgs=r.plotY=r.dlBox=undefined},alignDataLabel:p.column.prototype.alignDataLabel,buildKDTree:u,applyZones:u},{haloPath:function(e){return l.prototype.haloPath.call(this,e===0?0:(this.marker?this.marker.radius||0:0)+e)},ttBelow:!1}),r.prototype.beforePadding=function(){var e=this,r=this.len,i=this.chart,u=0,l=r,c=this.isXAxis,h=c?"xData":"yData",p=this.min,d={},v=Math.min(i.plotWidth,i.plotHeight),m=Number.MAX_VALUE,g=-Number.MAX_VALUE,y=this.max-p,b=r/y,w=[];s(this.series,function(r){var o=r.options,u;r.bubblePadding&&(r.visible||!i.options.chart.ignoreHiddenSeries)&&(e.allowZoomOutside=!0,w.push(r),c&&(s(["minSize","maxSize"],function(e){var t=o[e],n=/%$/.test(t);t=f(t),d[e]=n?v*t/100:t}),r.minPxSize=d.minSize,r.maxPxSize=Math.max(d.maxSize,d.minSize),u=r.zData,u.length&&(m=a(o.zMin,Math.min(m,Math.max(n(u),o.displayNegative===!1?o.zThreshold:-Number.MAX_VALUE))),g=a(o.zMax,Math.max(g,t(u))))))}),s(w,function(t){var n=t[h],r=n.length,i;c&&t.getRadii(m,g,t.minPxSize,t.maxPxSize);if(y>0)while(r--)o(n[r])&&e.dataMin<=n[r]&&n[r]<=e.dataMax&&(i=t.radii[r],u=Math.min((n[r]-p)*b-i,u),l=Math.max((n[r]-p)*b+i,l))}),w.length&&y>0&&!this.isLog&&(l-=r,b*=(r+u-l)/r,s([["min","userMin",u],["max","userMax",l]],function(t){a(e.options[t[0]],e[t[1]])===undefined&&(e[t[0]]+=t[2]/b)}))}}(e),function(e){var t=e.merge,n=e.Point,r=e.seriesType,i=e.seriesTypes;i.bubble&&r("mapbubble","bubble",{animationLimit:500,tooltip:{pointFormat:"{point.name}: {point.z}"}},{xyFromShape:!0,type:"mapbubble",pointArrayMap:["z"],getMapData:i.map.prototype.getMapData,getBox:i.map.prototype.getBox,setData:i.map.prototype.setData},{applyOptions:function(e,r){var s;return e&&e.lat!==undefined&&e.lon!==undefined?s=n.prototype.applyOptions.call(this,t(e,this.series.chart.fromLatLonToPoint(e)),r):s=i.map.prototype.pointClass.prototype.applyOptions.call(this,e,r),s},ttBelow:!1})}(e),function(e){var t=e.colorPointMixin,n=e.colorSeriesMixin,r=e.each,i=e.LegendSymbolMixin,s=e.merge,o=e.noop,u=e.pick,a=e.Series,f=e.seriesType,l=e.seriesTypes;f("heatmap","scatter",{animation:!1,borderWidth:0,nullColor:"#f7f7f7",dataLabels:{formatter:function(){return this.point.value},inside:!0,verticalAlign:"middle",crop:!1,overflow:!1,padding:0},marker:null,pointRange:null,tooltip:{pointFormat:"{point.x}, {point.y}: {point.value}<br/>"},states:{normal:{animation:!0},hover:{halo:!1,brightness:.2}}},s(n,{pointArrayMap:["y","value"],hasPointSpecificOptions:!0,supportsDrilldown:!0,getExtremesFromAll:!0,directTouch:!0,init:function(){var e;l.scatter.prototype.init.apply(this,arguments),e=this.options,e.pointRange=u(e.pointRange,e.colsize||1),this.yAxis.axisPointRange=e.rowsize||1},translate:function(){var e=this,t=e.options,n=e.xAxis,i=e.yAxis,s=function(e,t,n){return Math.min(Math.max(t,e),n)};e.generatePoints(),r(e.points,function(e){var r=(t.colsize||1)/2,o=(t.rowsize||1)/2,u=s(Math.round(n.len-n.translate(e.x-r,0,1,0,1)),-n.len,2*n.len),a=s(Math.round(n.len-n.translate(e.x+r,0,1,0,1)),-n.len,2*n.len),f=s(Math.round(i.translate(e.y-o,0,1,0,1)),-i.len,2*i.len),l=s(Math.round(i.translate(e.y+o,0,1,0,1)),-i.len,2*i.len);e.plotX=e.clientX=(u+a)/2,e.plotY=(f+l)/2,e.shapeType="rect",e.shapeArgs={x:Math.min(u,a),y:Math.min(f,l),width:Math.abs(a-u),height:Math.abs(l-f)}}),e.translateColors()},drawPoints:function(){l.column.prototype.drawPoints.call(this),r(this.points,function(e){e.graphic.attr(this.colorAttribs(e))},this)},animate:o,getBox:o,drawLegendSymbol:i.drawRectangle,alignDataLabel:l.column.prototype.alignDataLabel,getExtremes:function(){a.prototype.getExtremes.call(this,this.valueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,a.prototype.getExtremes.call(this)}}),t)}(e),function(e){function a(e,t){var n,r,i,s,o=!1,u=e.x,a=e.y;for(n=0,r=t.length-1;n<t.length;r=n++)i=t[n][1]>a,s=t[r][1]>a,i!==s&&u<(t[r][0]-t[n][0])*(a-t[n][1])/(t[r][1]-t[n][1])+t[n][0]&&(o=!o);return o}var t=e.Chart,n=e.each,r=e.extend,i=e.format,s=e.merge,o=e.win,u=e.wrap;t.prototype.transformFromLatLon=function(t,n){if(o.proj4===undefined)return e.error(21),{x:0,y:null};var r=o.proj4(n.crs,[t.lon,t.lat]),i=n.cosAngle||n.rotation&&Math.cos(n.rotation),s=n.sinAngle||n.rotation&&Math.sin(n.rotation),u=n.rotation?[r[0]*i+r[1]*s,-r[0]*s+r[1]*i]:r;return{x:((u[0]-(n.xoffset||0))*(n.scale||1)+(n.xpan||0))*(n.jsonres||1)+(n.jsonmarginX||0),y:(((n.yoffset||0)-u[1])*(n.scale||1)+(n.ypan||0))*(n.jsonres||1)-(n.jsonmarginY||0)}},t.prototype.transformToLatLon=function(t,n){if(o.proj4===undefined){e.error(21);return}var r={x:((t.x-(n.jsonmarginX||0))/(n.jsonres||1)-(n.xpan||0))/(n.scale||1)+(n.xoffset||0),y:((-t.y-(n.jsonmarginY||0))/(n.jsonres||1)+(n.ypan||0))/(n.scale||1)+(n.yoffset||0)},i=n.cosAngle||n.rotation&&Math.cos(n.rotation),s=n.sinAngle||n.rotation&&Math.sin(n.rotation),u=o.proj4(n.crs,"WGS84",n.rotation?{x:r.x*i+r.y*-s,y:r.x*s+r.y*i}:r);return{lat:u.y,lon:u.x}},t.prototype.fromPointToLatLon=function(t){var n=this.mapTransforms,r;if(!n){e.error(22);return}for(r in n)if(n.hasOwnProperty(r)&&n[r].hitZone&&a({x:t.x,y:-t.y},n[r].hitZone.coordinates[0]))return this.transformToLatLon(t,n[r]);return this.transformToLatLon(t,n["default"])},t.prototype.fromLatLonToPoint=function(t){var n=this.mapTransforms,r,i;if(!n)return e.error(22),{x:0,y:null};for(r in n)if(n.hasOwnProperty(r)&&n[r].hitZone){i=this.transformFromLatLon(t,n[r]);if(a({x:i.x,y:-i.y},n[r].hitZone.coordinates[0]))return i}return this.transformFromLatLon(t,n["default"])},e.geojson=function(e,t,s){var o=[],u=[],a=function(e){var t,n=e.length;u.push("M");for(t=0;t<n;t++)t===1&&u.push("L"),u.push(e[t][0],-e[t][1])};return t=t||"map",n(e.features,function(e){var i=e.geometry,s=i.type,f=i.coordinates,l=e.properties,c;u=[],t==="map"||t==="mapbubble"?(s==="Polygon"?(n(f,a),u.push("Z")):s==="MultiPolygon"&&(n(f,function(e){n(e,a)}),u.push("Z")),u.length&&(c={path:u})):t==="mapline"?(s==="LineString"?a(f):s==="MultiLineString"&&n(f,a),u.length&&(c={path:u})):t==="mappoint"&&s==="Point"&&(c={x:f[0],y:-f[1]}),c&&o.push(r(c,{name:l.name||l.NAME,properties:l}))}),s&&e.copyrightShort&&(s.chart.mapCredits=i(s.chart.options.credits.mapText,{geojson:e}),s.chart.mapCreditsFull=i(s.chart.options.credits.mapTextFull,{geojson:e})),o},u(t.prototype,"addCredits",function(e,t){t=s(!0,this.options.credits,t),this.mapCredits&&(t.href=null),e.call(this,t),this.credits&&this.mapCreditsFull&&this.credits.attr({title:this.mapCreditsFull})})}(e),function(e){function l(e,t,n,r,i,s,o,u){return["M",e+i,t,"L",e+n-s,t,"C",e+n-s/2,t,e+n,t+s/2,e+n,t+s,"L",e+n,t+r-o,"C",e+n,t+r-o/2,e+n-o/2,t+r,e+n-o,t+r,"L",e+u,t+r,"C",e+u/2,t+r,e,t+r-u/2,e,t+r-u,"L",e,t+i,"C",e,t+i/2,e+i/2,t,e+i,t,"Z"]}var t=e.Chart,n=e.defaultOptions,r=e.each,i=e.extend,s=e.merge,o=e.pick,u=e.Renderer,a=e.SVGRenderer,f=e.VMLRenderer;i(n.lang,{zoomIn:"Zoom in",zoomOut:"Zoom out"}),n.mapNavigation={buttonOptions:{alignTo:"plotBox",align:"left",verticalAlign:"top",x:0,width:18,height:18,padding:5,style:{fontSize:"15px",fontWeight:"bold"},theme:{"stroke-width":1,"text-align":"center"}},buttons:{zoomIn:{onclick:function(){this.mapZoom(.5)},text:"+",y:0},zoomOut:{onclick:function(){this.mapZoom(2)},text:"-",y:28}},mouseWheelSensitivity:1.1},e.splitPath=function(e){var t;e=e.replace(/([A-Za-z])/g," $1 "),e=e.replace(/^\s*/,"").replace(/\s*$/,""),e=e.split(/[ ,]+/);for(t=0;t<e.length;t++)/[a-zA-Z]/.test(e[t])||(e[t]=parseFloat(e[t]));return e},e.maps={},a.prototype.symbols.topbutton=function(e,t,n,r,i){return l(e-1,t-1,n,r,i.r,i.r,0,0)},a.prototype.symbols.bottombutton=function(e,t,n,r,i){return l(e-1,t-1,n,r,0,0,i.r,i.r)},u===f&&r(["topbutton","bottombutton"],function(e){f.prototype.symbols[e]=a.prototype.symbols[e]}),e.Map=e.mapChart=function(n,r,i){var u=typeof n=="string"||n.nodeName,a=arguments[u?1:0],f={endOnTick:!1,visible:!1,minPadding:0,maxPadding:0,startOnTick:!1},l,c=e.getOptions().credits;return l=a.series,a.series=null,a=s({chart:{panning:"xy",type:"map"},credits:{mapText:o(c.mapText,' © <a href="{geojson.copyrightUrl}">{geojson.copyrightShort}</a>'),mapTextFull:o(c.mapTextFull,"{geojson.copyright}")},tooltip:{followTouchMove:!1},xAxis:f,yAxis:s(f,{reversed:!0})},a,{chart:{inverted:!1,alignTicks:!1}}),a.series=l,u?new t(n,a,i):new t(a,r)}}(e)}),define("plugin/highchart/maps/highchartData",["highmap"],function(){var e={11:{cities:{"00":"北京",11:"房山区",12:"通州区",13:"顺义区",14:"昌平区",15:"大兴区",16:"怀柔区",17:"平谷区",28:"密云县",29:"延庆县","08":"海淀区","09":"门头沟区","04":"宣武区","05":"朝阳区","06":"丰台区","07":"石景山区","01":"东城区","02":"西城区","03":"崇文区"},name:"北京"},12:{cities:{"00":"天津",10:"东丽区",11:"西青区",12:"津南区",13:"北辰区",14:"武清区",15:"宝坻区",21:"宁河县",23:"静海县",25:"蓟县","08":"汉沽区","09":"大港区","04":"南开区","05":"河北区","06":"红桥区","07":"塘沽区","01":"和平区","02":"河东区","03":"河西区"},name:"天津"},13:{cities:{10:"廊坊",11:"衡水","08":"承德","09":"沧州","04":"邯郸","05":"邢台","06":"保定","07":"张家口","01":"石家庄","02":"唐山","03":"秦皇岛"},name:"河北"},14:{cities:{10:"临汾",23:"吕梁","08":"运城","09":"忻州","04":"长治","05":"晋城","06":"朔州","07":"晋中","01":"太原","02":"大同","03":"阳泉"},name:"山西"},15:{cities:{22:"兴安盟",25:"锡林郭勒盟",26:"乌兰察布盟",28:"巴彦淖尔盟",29:"阿拉善盟","04":"赤峰","05":"通辽","06":"鄂尔多斯","07":"呼伦贝尔","01":"呼和浩特","02":"包头","03":"乌海"},name:"内蒙古"},21:{cities:{10:"辽阳",11:"盘锦",12:"铁岭",13:"朝阳",14:"葫芦岛","08":"营口","09":"阜新","04":"抚顺","05":"本溪","06":"丹东","07":"锦州","01":"沈阳","02":"大连","03":"鞍山"},name:"辽宁"},22:{cities:{24:"延边朝鲜族自治州","08":"白城","04":"辽源","05":"通化","06":"白山","07":"松原","01":"长春","02":"吉林","03":"四平"},name:"吉林"},23:{cities:{10:"牡丹江",11:"黑河",12:"绥化",27:"大兴安岭","08":"佳木斯","09":"七台河","04":"鹤岗","05":"双鸭山","06":"大庆","07":"伊春","01":"哈尔滨","02":"齐齐哈尔","03":"鸡西"},name:"黑龙江"},31:{cities:{"00":"上海",10:"杨浦区",12:"闵行区",13:"宝山区",14:"嘉定区",15:"浦东新区",16:"金山区",17:"松江区",18:"青浦区",19:"南汇区",20:"奉贤区",30:"崇明县","08":"闸北区","09":"虹口区","04":"徐汇区","05":"长宁区","06":"静安区","07":"普陀区","01":"黄浦区","03":"卢湾区"},name:"上海"},32:{cities:{10:"扬州",11:"镇江",12:"泰州",13:"宿迁","08":"淮安","09":"盐城","04":"常州","05":"苏州","06":"南通","07":"连云港","01":"南京","02":"无锡","03":"徐州"},name:"江苏"},33:{cities:{10:"台州",11:"丽水","08":"衢州","09":"舟山","04":"嘉兴","05":"湖州","06":"绍兴","07":"金华","01":"杭州","02":"宁波","03":"温州"},name:"浙江"},34:{cities:{10:"黄山",11:"滁州",12:"阜阳",13:"宿州",14:"巢湖",15:"六安",16:"亳州",17:"池州",18:"宣城","08":"安庆","04":"淮南","05":"马鞍山","06":"淮北","07":"铜陵","01":"合肥","02":"芜湖","03":"蚌埠"},name:"安徽"},35:{cities:{"08":"龙岩","09":"宁德","04":"三明","05":"泉州","06":"漳州","07":"南平","01":"福州","02":"厦门","03":"莆田"},name:"福建"},36:{cities:{10:"抚州",11:"上饶","08":"吉安","09":"宜春","04":"九江","05":"新余","06":"鹰潭","07":"赣州","01":"南昌","02":"景德镇","03":"萍乡"},name:"江西"},37:{cities:{10:"威海",11:"日照",12:"莱芜",13:"临沂",14:"德州",15:"聊城",16:"滨州",17:"菏泽","08":"济宁","09":"泰安","04":"枣庄","05":"东营","06":"烟台","07":"潍坊","01":"济南","02":"青岛","03":"淄博"},name:"山东"},41:{cities:{10:"许昌",11:"漯河",12:"三门峡",13:"南阳",14:"商丘",15:"信阳",16:"周口",17:"驻马店","08":"焦作","09":"濮阳","04":"平顶山","05":"安阳","06":"鹤壁","07":"新乡","01":"郑州","02":"开封","03":"洛阳"},name:"河南"},42:{cities:{10:"荆州",11:"黄冈",12:"咸宁",13:"随州",28:"恩施土家族苗族自治州","08":"荆门","09":"孝感","05":"宜昌","06":"襄樊","07":"鄂州","01":"武汉","02":"黄石","03":"十堰"},name:"湖北"},43:{cities:{10:"郴州",11:"永州",12:"怀化",13:"娄底",31:"湘西土家族苗族自治州","08":"张家界","09":"益阳","04":"衡阳","05":"邵阳","06":"岳阳","07":"常德","01":"长沙","02":"株洲","03":"湘潭"},name:"湖南"},44:{cities:{12:"肇庆",13:"惠州",14:"梅州",15:"汕尾",16:"河源",17:"阳江",18:"清远",19:"东莞",20:"中山",51:"潮州",52:"揭阳",53:"云浮","08":"湛江","09":"茂名","04":"珠海","05":"汕头","06":"佛山","07":"江门","01":"广州","02":"韶关","03":"深圳"},name:"广东"},45:{cities:{10:"百色",11:"贺州",12:"河池",21:"南宁",22:"柳州","08":"贵港","09":"玉林","04":"梧州","05":"北海","06":"防城港","07":"钦州","01":"南宁","02":"柳州","03":"桂林"},name:"广西"},46:{cities:{90:"其他","01":"海口","02":"三亚"},name:"海南"},50:{cities:{"00":"重庆",10:"万盛区",11:"双桥区",12:"渝北区",13:"巴南区",14:"黔江区",15:"长寿区",22:"綦江县",23:"潼南县",24:"铜梁县",25:"大足县",26:"荣昌县",27:"璧山县",28:"梁平县",29:"城口县",30:"丰都县",31:"垫江县",32:"武隆县",33:"忠县",34:"开县",35:"云阳县",36:"奉节县",37:"巫山县",38:"巫溪县",40:"石柱土家族自治县",41:"秀山土家族苗族自治县",42:"酉阳土家族苗族自治县",43:"彭水苗族土家族自治县",81:"江津市",82:"合川市",83:"永川区",84:"南川市","08":"南岸区","09":"北碚区","04":"大渡口区","05":"江北区","06":"沙坪坝区","07":"九龙坡区","01":"万州区","02":"涪陵区","03":"渝中区"},name:"重庆"},51:{cities:{10:"内江",11:"乐山",13:"南充",14:"眉山",15:"宜宾",16:"广安",17:"达州",18:"雅安",19:"巴中",20:"资阳",32:"阿坝",33:"甘孜",34:"凉山","08":"广元","09":"遂宁","04":"攀枝花","05":"泸州","06":"德阳","07":"绵阳","01":"成都","03":"自贡"},name:"四川"},52:{cities:{22:"铜仁",23:"黔西南",24:"毕节",26:"黔东南",27:"黔南","04":"安顺","01":"贵阳","02":"六盘水","03":"遵义"},name:"贵州"},53:{cities:{23:"楚雄",25:"红河",26:"文山",27:"思茅",28:"西双版纳",29:"大理",31:"德宏",32:"丽江",33:"怒江",34:"迪庆",35:"临沧","04":"玉溪","05":"保山","06":"昭通","01":"昆明","03":"曲靖"},name:"云南"},54:{cities:{21:"昌都",22:"山南",23:"日喀则",24:"那曲",25:"阿里",26:"林芝","01":"拉萨"},name:"西藏"},61:{cities:{10:"商洛","08":"榆林","09":"安康","04":"咸阳","05":"渭南","06":"延安","07":"汉中","01":"西安","02":"铜川","03":"宝鸡"},name:"陕西"},62:{cities:{10:"庆阳",24:"定西",26:"陇南",29:"临夏",30:"甘南","08":"平凉","09":"酒泉","04":"白银","05":"天水","06":"武威","07":"张掖","01":"兰州","02":"嘉峪关","03":"金昌"},name:"甘肃"},63:{cities:{21:"海东",22:"海北",23:"黄南",25:"海南",26:"果洛",27:"玉树",28:"海西","01":"西宁"},name:"青海"},64:{cities:{"04":"固原","01":"银川","02":"石嘴山","03":"吴忠"},name:"宁夏"},65:{cities:{21:"吐鲁番",22:"哈密",23:"昌吉",27:"博尔塔拉",28:"巴音郭楞",29:"阿克苏",30:"克孜勒苏",31:"喀什",32:"和田",40:"伊犁",42:"塔城",43:"阿勒泰","01":"乌鲁木齐","02":"克拉玛依"},name:"新疆"},71:{cities:{90:"其他","01":"台北","02":"高雄"},name:"台湾"},81:{cities:{"01":"香港"},name:"香港"},82:{cities:{"01":"澳门"},name:"澳门"},100:{cities:{},name:"其他"},400:{cities:{10:"马来西亚",11:"新加坡",12:"菲律宾",13:"越南",14:"印度",15:"日本",16:"其他","08":"印尼","09":"泰国","04":"俄罗斯","05":"加拿大","06":"巴西","07":"澳大利亚","01":"美国","02":"英国","03":"法国"},name:"海外"}};return Highcharts.maps["countries/cn/cn-all"]={title:"China with Hong Kong, Macau, and Taiwan",version:"1.1.0",type:"FeatureCollection",copyright:"Copyright (c) 2014 Highsoft AS, Based on data from Natural Earth",copyrightShort:"Natural Earth",copyrightUrl:"http://www.naturalearthdata.com",crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG:3415"}},"hc-transform":{"default":{crs:"+proj=lcc +lat_1=18 +lat_2=24 +lat_0=21 +lon_0=114 +x_0=500000 +y_0=500000 +ellps=WGS72 +towgs84=0,0,1.9,0,0,0.814,-0.38 +units=m +no_defs",scale:.000129831107685,jsonres:15.5,jsonmarginX:-999,jsonmarginY:9851,xoffset:-3139937.49309,yoffset:4358972.7486}},features:[{type:"Feature",id:"CN.SH",ccode:31,properties:{"hc-group":"admin1","hc-middle-x":.94,"hc-middle-y":.79,"hc-key":"cn-sh","hc-a2":"SH",labelrank:"7",hasc:"CN.SH","alt-name":"Shàngh?i","woe-id":"12578012",subregion:null,fips:"CH23","postal-code":"SH",name:"Shanghai",country:"China","type-en":"Municipality",region:"East China",longitude:"121.409","woe-name":"Shanghai",latitude:"31.0909","woe-label":"Shanghai, CN, China",type:"Zhíxiáshì"},geometry:{type:"MultiPolygon",coordinates:[[[[7863,4465],[7744,4504],[7733,4546],[7875,4484],[7863,4465]]],[[[7747,4286],[7688,4315],[7672,4355],[7722,4458],[7751,4467],[7828,4423],[7881,4343],[7747,4286]]]]}},{type:"Feature",id:"CN.ZJ",ccode:33,properties:{"hc-group":"admin1","hc-middle-x":.48,"hc-middle-y":.52,"hc-key":"cn-zj","hc-a2":"ZJ",labelrank:"2",hasc:"CN.ZJ","alt-name":"Zhèji?ng","woe-id":"12577992",subregion:null,fips:"CH02","postal-code":"ZJ",name:"Zhejiang",country:"China","type-en":"Province",region:"East China",longitude:"119.97","woe-name":"Zhejiang",latitude:"29.1084","woe-label":"Zhejiang, CN, China",type:"Sh?ng"},geometry:{type:"MultiPolygon",coordinates:[[[[7927,4194],[7929,4161],[7967,4120],[7872,4153],[7927,4194]]],[[[7672,4355],[7688,4315],[7747,4286],[7690,4250],[7646,4178],[7677,4165],[7726,4202],[7771,4204],[7833,4134],[7894,4112],[7843,4037],[7884,4055],[7894,3925],[7823,3973],[7788,3930],[7831,3933],[7844,3869],[7803,3837],[7847,3760],[7795,3745],[7752,3689],[7752,3765],[7713,3675],[7643,3578],[7631,3495],[7611,3495],[7595,3533],[7480,3515],[7434,3594],[7379,3536],[7309,3545],[7272,3655],[7267,3734],[7210,3724],[7203,3816],[7116,3914],[7149,3975],[7188,3986],[7255,4050],[7287,4108],[7282,4185],[7382,4198],[7351,4238],[7390,4260],[7422,4373],[7481,4379],[7521,4333],[7566,4334],[7593,4296],[7672,4355]]]]}},{type:"Feature",id:"CN.GS",ccode:62,properties:{"hc-group":"admin1","hc-middle-x":.24,"hc-middle-y":.24,"hc-key":"cn-gs","hc-a2":"GS",labelrank:"2",hasc:"CN.GS","alt-name":"G?nsù","woe-id":"12578005",subregion:"Western",fips:"CH15","postal-code":"GS",name:"Gansu",country:"China","type-en":"Province",region:"Northwest China",longitude:"100.735","woe-name":"Gansu",latitude:"38.7393","woe-label":"Gansu, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[3196,7224],[3215,7224],[3343,7224],[3431,6932],[3391,6897],[3437,6812],[3499,6742],[3475,6670],[3550,6669],[3586,6703],[3648,6724],[3803,6724],[3832,6655],[3768,6562],[3676,6493],[3723,6488],[3810,6437],[3869,6365],[3921,6353],[3920,6303],[3977,6264],[3997,6203],[4091,6177],[4131,6219],[4096,6265],[4203,6298],[4306,6263],[4367,6300],[4453,6325],[4510,6322],[4535,6241],[4449,6129],[4387,6096],[4392,6027],[4367,6019],[4372,5958],[4416,5940],[4491,5862],[4536,5845],[4598,5844],[4583,5807],[4626,5797],[4707,5691],[4687,5671],[4723,5568],[4696,5495],[4715,5453],[4762,5433],[4800,5367],[4904,5345],[4901,5430],[4957,5422],[4993,5447],[5002,5513],[4979,5545],[4920,5561],[4926,5662],[4958,5771],[5076,5740],[5074,5704],[5185,5663],[5212,5625],[5271,5611],[5334,5565],[5327,5484],[5291,5456],[5311,5343],[5286,5316],[5131,5311],[5158,5253],[5041,5238],[4987,5286],[4920,5286],[4915,5237],[4868,5175],[4934,5126],[4910,5103],[4881,5017],[4903,4947],[4811,4956],[4740,4907],[4776,4870],[4768,4812],[4692,4800],[4645,4742],[4573,4739],[4509,4760],[4459,4800],[4485,4847],[4484,4907],[4433,4989],[4325,5006],[4334,5027],[4263,5035],[4256,5115],[4193,5144],[4110,5081],[4072,5076],[4123,4963],[3997,4894],[4015,4958],[3990,4988],[3958,4986],[3939,5032],[3874,5028],[3872,5071],[3813,5145],[3845,5196],[3970,5141],[3999,5110],[4086,5169],[4077,5203],[4006,5256],[4132,5362],[4119,5410],[4195,5429],[4203,5504],[4255,5499],[4251,5558],[4273,5586],[4233,5615],[4200,5694],[4214,5726],[4177,5765],[4197,5812],[4106,5892],[4093,5952],[4061,5905],[3934,6019],[3860,6058],[3848,6094],[3777,6155],[3774,6090],[3712,6132],[3594,6266],[3540,6314],[3505,6289],[3456,6311],[3411,6266],[3284,6359],[3223,6376],[3188,6182],[3111,6217],[3111,6235],[3033,6275],[2910,6408],[2864,6405],[2764,6458],[2626,6472],[2478,6455],[2490,6524],[2469,6612],[2505,6681],[2520,6764],[2582,6755],[2638,6776],[2731,6888],[2847,6989],[2938,7027],[3066,7022],[3118,7056],[3133,7177],[3196,7224]]]}},{type:"Feature",id:"CN.6657",properties:{"hc-group":"admin1","hc-middle-x":.47,"hc-middle-y":.22,"hc-key":"cn-6657","hc-a2":"SO",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703130",subregion:null,fips:null,"postal-code":null,name:"Southern",country:"Hong Kong S.A.R.","type-en":null,region:"Hong Kong Island",longitude:"114.204","woe-name":"Southern",latitude:"22.2402","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6378,2363],[6369,2350],[6349,2368],[6352,2368],[6360,2365],[6362,2365],[6365,2366],[6374,2365],[6378,2363]]]}},{type:"Feature",id:"CN.6663",properties:{"hc-group":"admin1","hc-middle-x":.43,"hc-middle-y":.46,"hc-key":"cn-6663","hc-a2":"SK",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703139",subregion:null,fips:null,"postal-code":null,name:"Sai Kung",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.249","woe-name":"Sai Kung",latitude:"22.3463","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6402,2407],[6390,2374],[6376,2372],[6376,2379],[6374,2382],[6372,2387],[6375,2392],[6378,2396],[6392,2401],[6402,2407]]]}},{type:"Feature",id:"CN.6665",properties:{"hc-group":"admin1","hc-middle-x":.51,"hc-middle-y":.38,"hc-key":"cn-6665","hc-a2":"KT",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703132",subregion:null,fips:null,"postal-code":null,name:"Kwai Tsing",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.14","woe-name":"Kwai Tsing",latitude:"22.351","woe-label":null,type:null},geometry:{type:"MultiPolygon",coordinates:[[[[6354,2378],[6353,2378],[6355,2378],[6354,2378]]],[[[6356,2382],[6349,2386],[6349,2387],[6355,2389],[6357,2389],[6358,2387],[6359,2384],[6357,2383],[6356,2382]]]]}},{type:"Feature",id:"CN.6666",properties:{"hc-group":"admin1","hc-middle-x":.57,"hc-middle-y":.4,"hc-key":"cn-6666","hc-a2":"TW",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703140",subregion:null,fips:null,"postal-code":null,name:"Tsuen Wan",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.12","woe-name":"Tsuen Wan",latitude:"22.3869","woe-label":null,type:null},geometry:{type:"MultiPolygon",coordinates:[[[[6357,2389],[6355,2389],[6349,2387],[6342,2389],[6330,2386],[6330,2391],[6333,2393],[6341,2396],[6354,2399],[6358,2401],[6361,2401],[6362,2396],[6357,2389]]],[[[6325,2378],[6340,2385],[6332,2378],[6325,2378]]]]}},{type:"Feature",id:"CN.6667",properties:{"hc-group":"admin1","hc-middle-x":.52,"hc-middle-y":.43,"hc-key":"cn-6667","hc-a2":"TM",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703141",subregion:null,fips:null,"postal-code":null,name:"Tuen Mun",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"113.991","woe-name":"Tuen Mun",latitude:"22.3846","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6333,2393],[6330,2391],[6330,2386],[6300,2393],[6314,2403],[6323,2398],[6333,2393]]]}},{type:"Feature",id:"CN.6669",properties:{"hc-group":"admin1","hc-middle-x":.49,"hc-middle-y":.37,"hc-key":"cn-6669","hc-a2":"NO",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703142",subregion:null,fips:null,"postal-code":null,name:"North",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.148","woe-name":"North",latitude:"22.5063","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6344,2424],[6343,2426],[6359,2433],[6373,2432],[6386,2432],[6395,2422],[6370,2419],[6355,2412],[6347,2413],[6344,2424]]]}},{type:"Feature",id:"CN.6670",properties:{"hc-group":"admin1","hc-middle-x":.43,"hc-middle-y":.35,"hc-key":"cn-6670","hc-a2":"TP",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703144",subregion:null,fips:null,"postal-code":null,name:"Tai Po",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.154","woe-name":"Tai Po",latitude:"22.4447","woe-label":null,type:null},geometry:{type:"MultiPolygon",coordinates:[[[[6402,2407],[6392,2401],[6378,2396],[6378,2400],[6378,2404],[6393,2415],[6402,2407]]],[[[6361,2401],[6358,2401],[6354,2399],[6352,2408],[6355,2412],[6370,2419],[6395,2422],[6378,2408],[6368,2402],[6364,2401],[6361,2401]]]]}},{type:"Feature",id:"CN.6671",properties:{"hc-group":"admin1","hc-middle-x":.47,"hc-middle-y":.44,"hc-key":"cn-6671","hc-a2":"IS",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703127",subregion:null,fips:null,"postal-code":null,name:"Islands",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"113.954","woe-name":"Islands",latitude:"22.2597","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6325,2378],[6332,2378],[6294,2352],[6325,2378]]]}},{type:"Feature",id:"CN.NX",ccode:64,properties:{"hc-group":"admin1","hc-middle-x":.43,"hc-middle-y":.5,"hc-key":"cn-nx","hc-a2":"NX",labelrank:"2",hasc:"CN.NX","alt-name":"Ningxia Hui|Níngxià Húizú","woe-id":"12578010",subregion:"Western",fips:"CH21","postal-code":"NX",name:"Ningxia",country:"China","type-en":"Autonomous Region",region:"Northwest China",longitude:"106.038","woe-name":"Ningxia",latitude:"37.1762","woe-label":"Ningxia, CN, China",type:"Zìzhìqu"},geometry:{type:"Polygon",coordinates:[[[5152,5919],[5087,5861],[5069,5794],[5076,5740],[4958,5771],[4926,5662],[4920,5561],[4979,5545],[5002,5513],[4993,5447],[4957,5422],[4901,5430],[4904,5345],[4800,5367],[4762,5433],[4715,5453],[4696,5495],[4723,5568],[4687,5671],[4707,5691],[4626,5797],[4583,5807],[4598,5844],[4536,5845],[4550,5867],[4647,5872],[4725,5916],[4806,5924],[4825,6103],[4881,6229],[4918,6267],[5008,6280],[5039,6202],[4937,6031],[5002,5995],[5064,5990],[5106,5937],[5152,5919]]]}},{type:"Feature",id:"CN.SA",ccode:61,properties:{"hc-group":"admin1","hc-middle-x":.57,"hc-middle-y":.69,"hc-key":"cn-sa","hc-a2":"SA",labelrank:"2",hasc:"CN.SA","alt-name":"Sh?nx?","woe-id":"12578015",subregion:"Western",fips:"CH26","postal-code":"SA",name:"Shaanxi",country:"China","type-en":"Province",region:"Northwest China",longitude:"108.363","woe-name":"Shaanxi",latitude:"33.7713","woe-label":"Shaanxi, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[5076,5740],[5069,5794],[5087,5861],[5152,5919],[5202,5902],[5221,5865],[5356,5872],[5371,5943],[5393,5928],[5402,6023],[5533,6178],[5626,6240],[5685,6260],[5711,6229],[5750,6280],[5800,6306],[5798,6260],[5818,6242],[5775,6171],[5746,6043],[5682,5985],[5681,5927],[5723,5882],[5730,5834],[5706,5770],[5649,5680],[5669,5610],[5660,5506],[5689,5380],[5634,5289],[5615,5166],[5631,5155],[5628,5124],[5682,5050],[5676,4985],[5746,4920],[5746,4844],[5703,4806],[5664,4841],[5603,4822],[5494,4849],[5454,4824],[5511,4807],[5507,4772],[5575,4750],[5588,4700],[5555,4685],[5485,4696],[5455,4643],[5488,4571],[5472,4502],[5421,4496],[5369,4551],[5267,4613],[5177,4623],[5167,4606],[5063,4695],[5015,4681],[4991,4740],[4924,4750],[4829,4721],[4808,4783],[4704,4759],[4692,4800],[4768,4812],[4776,4870],[4740,4907],[4811,4956],[4903,4947],[4881,5017],[4910,5103],[4934,5126],[4868,5175],[4915,5237],[4920,5286],[4987,5286],[5041,5238],[5158,5253],[5131,5311],[5286,5316],[5311,5343],[5291,5456],[5327,5484],[5334,5565],[5271,5611],[5212,5625],[5185,5663],[5074,5704],[5076,5740]]]}},{type:"Feature",id:"CN.3682",properties:{"hc-group":"admin1","hc-middle-x":.53,"hc-middle-y":.42,"hc-key":"cn-3682","hc-a2":"CA",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703128",subregion:null,fips:null,"postal-code":null,name:"Central and Western",country:"Hong Kong S.A.R.","type-en":null,region:"Hong Kong Island",longitude:"114.144","woe-name":"Central and Western",latitude:"22.2741","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6349,2368],[6355,2372],[6360,2370],[6360,2365],[6352,2368],[6349,2368]]]}},{type:"Feature",id:"CN.6655",properties:{"hc-group":"admin1","hc-middle-x":.5,"hc-middle-y":.5,"hc-key":"cn-6655","hc-a2":"WC",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703129",subregion:null,fips:null,"postal-code":null,name:"Wan Chai",country:"Hong Kong S.A.R.","type-en":null,region:"Hong Kong Island",longitude:"114.178","woe-name":"Wan Chai",latitude:"22.2699","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6360,2365],[6360,2370],[6363,2370],[6366,2369],[6365,2366],[6362,2365],[6360,2365]]]}},{type:"Feature",id:"CN.AH",ccode:34,properties:{"hc-group":"admin1","hc-middle-x":.47,"hc-middle-y":.58,"hc-key":"cn-ah","hc-a2":"AH",labelrank:"2",hasc:"CN.AH","alt-name":"?nhu?","woe-id":"12578022",subregion:"Central",fips:"CH01","postal-code":"AH",name:"Anhui",country:"China","type-en":"Province",region:"East China",longitude:"117.253","woe-name":"Anhui",latitude:"31.9537","woe-label":"Anhui, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6748,4053],[6707,4200],[6671,4255],[6723,4323],[6651,4374],[6628,4366],[6593,4419],[6623,4492],[6694,4505],[6687,4673],[6628,4643],[6557,4685],[6554,4746],[6496,4797],[6545,4797],[6584,4836],[6583,4893],[6639,4914],[6624,4984],[6641,5019],[6700,5008],[6743,4944],[6830,4999],[6811,5075],[6783,5072],[6734,5139],[6756,5141],[6777,5156],[6887,5100],[6904,5047],[7017,5016],[7038,4952],[7113,4963],[7124,4946],[7080,4840],[7135,4829],[7141,4771],[7173,4728],[7234,4730],[7259,4785],[7318,4752],[7328,4701],[7306,4667],[7268,4700],[7203,4693],[7224,4617],[7168,4549],[7193,4514],[7269,4480],[7250,4418],[7263,4389],[7366,4405],[7422,4373],[7390,4260],[7351,4238],[7382,4198],[7282,4185],[7287,4108],[7255,4050],[7188,3986],[7149,3975],[7111,4011],[7020,4020],[6995,4066],[6929,4067],[6932,4038],[6863,4001],[6852,4036],[6893,4084],[6846,4113],[6816,4075],[6748,4053]]]}},{type:"Feature",id:"CN.HU",ccode:42,properties:{"hc-group":"admin1","hc-middle-x":.55,"hc-middle-y":.52,"hc-key":"cn-hu","hc-a2":"HU",labelrank:"2",hasc:"CN.HU","alt-name":"Húb?i","woe-id":"12578002",subregion:"Central",fips:"CH12","postal-code":"HU",name:"Hubei",country:"China","type-en":"Province",region:"South Central China",longitude:"112.264","woe-name":"Hubei",latitude:"30.9857","woe-label":"Hubei, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6593,4419],[6628,4366],[6651,4374],[6723,4323],[6671,4255],[6707,4200],[6748,4053],[6691,4040],[6618,4068],[6576,4011],[6500,3991],[6487,3961],[6375,3928],[6307,3887],[6258,3900],[6245,3938],[6273,3970],[6245,4070],[6154,3977],[6115,3984],[6107,4051],[6060,4014],[5987,3995],[5975,4025],[5888,4082],[5818,4085],[5785,4109],[5687,4126],[5632,4108],[5656,4053],[5610,4027],[5560,4058],[5496,4048],[5426,4005],[5379,3910],[5324,3967],[5317,4032],[5267,4083],[5248,4054],[5255,4187],[5226,4207],[5284,4244],[5425,4242],[5520,4308],[5558,4294],[5581,4375],[5570,4423],[5498,4461],[5472,4502],[5488,4571],[5455,4643],[5485,4696],[5555,4685],[5588,4700],[5575,4750],[5507,4772],[5511,4807],[5454,4824],[5494,4849],[5603,4822],[5664,4841],[5703,4806],[5746,4844],[5790,4766],[5898,4671],[5995,4631],[6085,4630],[6142,4647],[6235,4617],[6274,4645],[6286,4544],[6320,4492],[6354,4515],[6434,4491],[6432,4453],[6520,4432],[6545,4459],[6593,4419]]]}},{type:"Feature",id:"CN.6656",properties:{"hc-group":"admin1","hc-middle-x":.51,"hc-middle-y":.37,"hc-key":"cn-6656","hc-a2":"EA",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703131",subregion:null,fips:null,"postal-code":null,name:"Eastern",country:"Hong Kong S.A.R.","type-en":null,region:"Hong Kong Island",longitude:"114.213","woe-name":"Eastern",latitude:"22.2706","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6365,2366],[6366,2369],[6363,2370],[6375,2370],[6378,2363],[6374,2365],[6365,2366]]]}},{type:"Feature",id:"CN.6658",properties:{"hc-group":"admin1","hc-middle-x":.84,"hc-middle-y":.42,"hc-key":"cn-6658","hc-a2":"YT",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703134",subregion:null,fips:null,"postal-code":null,name:"Yau Tsim Mong",country:"Hong Kong S.A.R.","type-en":null,region:"Kowloon",longitude:"114.169","woe-name":"Yau Tsim Mong",latitude:"22.3128","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6362,2373],[6361,2376],[6359,2380],[6362,2380],[6363,2376],[6362,2373]]]}},{type:"Feature",id:"CN.6659",properties:{"hc-group":"admin1","hc-middle-x":.52,"hc-middle-y":.48,"hc-key":"cn-6659","hc-a2":"KC",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703135",subregion:null,fips:null,"postal-code":null,name:"Kowloon City",country:"Hong Kong S.A.R.","type-en":null,region:"Kowloon",longitude:"114.19","woe-name":"Kowloon City",latitude:"22.3268","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6370,2377],[6366,2379],[6362,2373],[6363,2376],[6362,2380],[6362,2383],[6361,2385],[6364,2385],[6366,2382],[6368,2382],[6369,2380],[6370,2377]]]}},{type:"Feature",id:"CN.6660",properties:{"hc-group":"admin1","hc-middle-x":.61,"hc-middle-y":.37,"hc-key":"cn-6660","hc-a2":"SS",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703133",subregion:null,fips:null,"postal-code":null,name:"Sham Shui Po",country:"Hong Kong S.A.R.","type-en":null,region:"Kowloon",longitude:"114.164","woe-name":"Sham Shui Po",latitude:"22.3331","woe-label":null,type:null},geometry:{type:"MultiPolygon",coordinates:[[[[6355,2378],[6356,2378],[6354,2378],[6355,2378]]],[[[6362,2380],[6359,2380],[6357,2381],[6356,2382],[6357,2383],[6359,2384],[6361,2385],[6362,2383],[6362,2380]]]]}},{type:"Feature",id:"CN.6661",properties:{"hc-group":"admin1","hc-middle-x":.5,"hc-middle-y":.66,"hc-key":"cn-6661","hc-a2":"WT",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703137",subregion:null,fips:null,"postal-code":null,name:"Wong Tai Sin",country:"Hong Kong S.A.R.","type-en":null,region:"Kowloon",longitude:"114.215","woe-name":"Wong Tai Sin",latitude:"22.3432","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6368,2382],[6366,2382],[6364,2385],[6372,2387],[6374,2382],[6368,2382]]]}},{type:"Feature",id:"CN.6662",properties:{"hc-group":"admin1","hc-middle-x":.61,"hc-middle-y":.47,"hc-key":"cn-6662","hc-a2":"KT",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703136",subregion:null,fips:null,"postal-code":null,name:"Kwun Tong",country:"Hong Kong S.A.R.","type-en":null,region:"Kowloon",longitude:"114.225","woe-name":"Kwun Tong",latitude:"22.3159","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6376,2372],[6375,2371],[6370,2377],[6369,2380],[6368,2382],[6374,2382],[6376,2379],[6376,2372]]]}},{type:"Feature",id:"CN.6664",properties:{"hc-group":"admin1","hc-middle-x":.52,"hc-middle-y":.48,"hc-key":"cn-6664","hc-a2":"ST",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703138",subregion:null,fips:null,"postal-code":null,name:"Sha Tin",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.2","woe-name":"Sha Tin",latitude:"22.3807","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6378,2396],[6375,2392],[6372,2387],[6364,2385],[6361,2385],[6359,2384],[6358,2387],[6357,2389],[6362,2396],[6361,2401],[6364,2401],[6368,2402],[6371,2397],[6378,2404],[6378,2400],[6378,2396]]]}},{type:"Feature",id:"CN.6668",properties:{"hc-group":"admin1","hc-middle-x":.52,"hc-middle-y":.58,"hc-key":"cn-6668","hc-a2":"YL",labelrank:"20",hasc:"HK.","alt-name":null,"woe-id":"24703143",subregion:null,fips:null,"postal-code":null,name:"Yuen Long",country:"Hong Kong S.A.R.","type-en":null,region:"The New Territories",longitude:"114.058","woe-name":"Yuen Long",latitude:"22.4415","woe-label":null,type:null},geometry:{type:"Polygon",coordinates:[[[6354,2399],[6341,2396],[6333,2393],[6323,2398],[6314,2403],[6326,2417],[6344,2424],[6347,2413],[6355,2412],[6352,2408],[6354,2399]]]}},{type:"Feature",id:"CN.GD",ccode:44,properties:{"hc-group":"admin1","hc-middle-x":.48,"hc-middle-y":.35,"hc-key":"cn-gd","hc-a2":"GD",labelrank:"2",hasc:"CN.GD","alt-name":"Gu?ngd?ng","woe-id":"12578019",subregion:null,fips:"CH30","postal-code":"GD",name:"Guangdong",country:"China","type-en":"Province",region:"South Central China",longitude:"113.72","woe-name":"Guangdong",latitude:"23.7924","woe-label":"Guangdong, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6373,2432],[6359,2433],[6343,2426],[6303,2409],[6273,2477],[6192,2506],[6251,2454],[6222,2346],[6159,2301],[6136,2355],[6124,2300],[6082,2301],[6031,2257],[5961,2244],[5913,2267],[5833,2207],[5719,2196],[5639,2170],[5600,2082],[5546,2088],[5551,2018],[5599,1977],[5570,1938],[5468,1929],[5442,2057],[5419,2081],[5443,2176],[5481,2206],[5441,2225],[5488,2289],[5574,2295],[5566,2359],[5630,2356],[5658,2378],[5640,2423],[5711,2456],[5780,2515],[5790,2631],[5846,2721],[5896,2756],[5890,2808],[5927,2841],[5918,2920],[5948,2932],[5957,3012],[6054,3003],[6083,2964],[6120,2969],[6104,3048],[6167,3089],[6241,3049],[6311,3076],[6331,3036],[6441,3067],[6474,3005],[6410,2972],[6360,2903],[6413,2865],[6502,2885],[6615,2929],[6674,2877],[6684,2940],[6710,2960],[6809,2944],[6842,2894],[6887,2881],[6933,2800],[6949,2701],[6978,2674],[6956,2682],[6896,2613],[6844,2626],[6863,2588],[6840,2521],[6800,2526],[6703,2476],[6673,2507],[6641,2474],[6546,2486],[6508,2433],[6488,2490],[6442,2471],[6433,2409],[6408,2444],[6373,2432]]]}},{type:"Feature",id:"CN.FJ",ccode:35,properties:{"hc-group":"admin1","hc-middle-x":.53,"hc-middle-y":.44,"hc-key":"cn-fj","hc-a2":"FJ",labelrank:"2",hasc:"CN.FJ","alt-name":"Fújiàn","woe-id":"12577997",subregion:null,fips:"CH07","postal-code":"FJ",name:"Fujian",country:"China","type-en":"Province",region:null,longitude:"118.178","woe-name":"Fujian",latitude:"26.408","woe-label":"Fujian, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6978,2674],[6949,2701],[6933,2800],[6887,2881],[6842,2894],[6809,2944],[6710,2960],[6700,3022],[6727,3057],[6758,3173],[6795,3193],[6809,3267],[6853,3314],[6829,3358],[6861,3425],[6912,3433],[6957,3491],[6948,3556],[6981,3622],[7025,3648],[7073,3614],[7088,3642],[7195,3682],[7210,3724],[7267,3734],[7272,3655],[7309,3545],[7379,3536],[7434,3594],[7480,3515],[7595,3533],[7611,3495],[7577,3477],[7587,3433],[7535,3415],[7503,3367],[7490,3409],[7464,3331],[7469,3283],[7428,3214],[7477,3217],[7456,3148],[7516,3122],[7493,3088],[7438,3078],[7409,3116],[7360,3087],[7412,3052],[7337,3055],[7313,3013],[7342,2982],[7286,2955],[7274,2894],[7229,2906],[7152,2853],[7169,2822],[7123,2769],[7095,2778],[7063,2703],[7043,2733],[7022,2689],[7001,2713],[6978,2674]]]}},{type:"Feature",id:"CN.BJ",ccode:11,properties:{"hc-group":"admin1","hc-middle-x":.49,"hc-middle-y":.53,"hc-key":"cn-bj","hc-a2":"BJ",labelrank:"7",hasc:"CN.BJ","alt-name":"B?ij?ng","woe-id":"12578011",subregion:null,fips:"CH22","postal-code":"BJ",name:"Beijing",country:"China","type-en":"Municipality",region:"North China",longitude:"116.389","woe-name":"Beijing",latitude:"39.9488","woe-label":"Beijing, CN, China",type:"Zhíxiáshì"},geometry:{type:"Polygon",coordinates:[[[6915,6429],[6828,6408],[6860,6359],[6850,6331],[6841,6315],[6836,6311],[6801,6313],[6762,6272],[6729,6302],[6647,6286],[6593,6318],[6611,6357],[6586,6393],[6661,6441],[6679,6472],[6639,6530],[6809,6628],[6879,6567],[6957,6564],[6903,6524],[6935,6468],[6928,6433],[6915,6429]]]}},{type:"Feature",id:"CN.HB",ccode:13,properties:{"hc-group":"admin1","hc-middle-x":.28,"hc-middle-y":.63,"hc-key":"cn-hb","hc-a2":"HB",labelrank:"2",hasc:"CN.HB","alt-name":"Héb?i","woe-id":"12578000",subregion:null,fips:"CH10","postal-code":"HB",name:"Hebei",country:"China","type-en":"Province",region:"North China",longitude:"115.314","woe-name":"Hebei",latitude:"38.5205","woe-label":"Hebei, CN, China",type:"Sh?ng"},geometry:{type:"MultiPolygon",coordinates:[[[[6850,6331],[6860,6359],[6828,6408],[6915,6429],[6901,6316],[6850,6331]]],[[[6978,6083],[7011,6027],[7034,6002],[6959,5902],[6845,5898],[6775,5812],[6693,5775],[6629,5651],[6602,5642],[6565,5577],[6600,5504],[6533,5509],[6429,5498],[6324,5549],[6274,5548],[6239,5578],[6224,5637],[6284,5672],[6280,5724],[6336,5814],[6331,5872],[6287,5966],[6241,5990],[6240,6056],[6294,6120],[6299,6182],[6366,6181],[6398,6205],[6425,6290],[6396,6368],[6314,6404],[6341,6444],[6419,6478],[6378,6490],[6354,6577],[6294,6661],[6319,6675],[6313,6738],[6361,6780],[6372,6844],[6412,6895],[6470,6920],[6491,6862],[6486,6784],[6546,6779],[6566,6811],[6659,6862],[6691,6832],[6751,6883],[6791,6863],[6837,6886],[6841,6977],[6934,6994],[6954,7033],[7e3,7032],[7044,6978],[7065,6892],[7100,6855],[7072,6819],[7109,6729],[7177,6733],[7268,6719],[7217,6657],[7203,6609],[7285,6542],[7333,6546],[7349,6468],[7390,6417],[7334,6392],[7299,6350],[7295,6283],[7244,6224],[7155,6212],[7102,6188],[7060,6225],[7037,6306],[6986,6311],[6963,6405],[7008,6424],[6935,6468],[6903,6524],[6957,6564],[6879,6567],[6809,6628],[6639,6530],[6679,6472],[6661,6441],[6586,6393],[6611,6357],[6593,6318],[6647,6286],[6729,6302],[6762,6272],[6801,6313],[6836,6311],[6856,6194],[6823,6172],[6824,6127],[6928,6068],[6978,6083]]]]}},{type:"Feature",id:"CN.SD",ccode:37,properties:{"hc-group":"admin1","hc-middle-x":.37,"hc-middle-y":.52,"hc-key":"cn-sd","hc-a2":"SD",labelrank:"2",hasc:"CN.SD","alt-name":"Sh?nd?ng","woe-id":"12578014",subregion:null,fips:"CH25","postal-code":"SD",name:"Shandong",country:"China","type-en":"Province",region:"East China",longitude:"118.114","woe-name":"Shandong",latitude:"36.3271","woe-label":"Shandong, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6777,5156],[6756,5141],[6734,5139],[6619,5140],[6597,5186],[6548,5223],[6484,5239],[6487,5277],[6557,5332],[6688,5473],[6577,5451],[6600,5504],[6565,5577],[6602,5642],[6629,5651],[6693,5775],[6775,5812],[6845,5898],[6959,5902],[7034,6002],[7080,5973],[7165,5958],[7220,5980],[7300,5870],[7259,5880],[7250,5777],[7339,5743],[7400,5752],[7414,5801],[7495,5875],[7573,5918],[7693,5871],[7735,5830],[7832,5867],[7845,5834],[7939,5837],[7931,5786],[7878,5697],[7824,5732],[7589,5599],[7582,5525],[7518,5499],[7518,5534],[7473,5536],[7488,5476],[7438,5400],[7390,5389],[7324,5269],[7246,5258],[7228,5191],[7175,5176],[7160,5119],[7118,5108],[7094,5165],[7045,5164],[7042,5135],[6985,5122],[6959,5147],[6930,5115],[6861,5230],[6794,5216],[6777,5156]]]}},{type:"Feature",id:"TW.CH",ccode:71,properties:{"hc-group":"admin1","hc-middle-x":.37,"hc-middle-y":.37,"hc-key":"tw-ch","hc-a2":"CH",labelrank:"2",hasc:"TW.CH","alt-name":"Jiayi|Chiai","woe-id":"7153409",subregion:null,fips:null,"postal-code":"CH",name:"Chiayi",country:"Taiwan","type-en":"Province",region:"Taiwan Province",longitude:"25.4","woe-name":"Chiayi County",latitude:"22.9","woe-label":null,type:"Hsien"},geometry:{type:"MultiPolygon",coordinates:[[[[7652,2442],[7615,2480],[7598,2540],[7651,2543],[7695,2610],[7705,2625],[7756,2667],[7764,2665],[7768,2659],[7763,2643],[7776,2629],[7750,2615],[7740,2529],[7661,2521],[7652,2442]]],[[[7726,2950],[7732,2966],[7733,2974],[7760,2958],[7744,2944],[7740,2942],[7726,2950]]],[[[7744,2944],[7760,2958],[7733,2974],[7741,2986],[7744,2996],[7813,2957],[7837,2921],[7832,2904],[7819,2885],[7817,2885],[7808,2883],[7768,2897],[7744,2944]]],[[[7887,3052],[7890,3049],[7902,3046],[7905,3030],[7887,3052]]],[[[7744,2944],[7768,2897],[7808,2883],[7726,2848],[7677,2883],[7692,2917],[7726,2950],[7740,2942],[7744,2944]]],[[[7837,2921],[7813,2957],[7744,2996],[7761,3019],[7806,3038],[7822,2978],[7851,2941],[7847,2927],[7837,2921]]],[[[7606,2742],[7624,2784],[7650,2826],[7674,2805],[7691,2786],[7685,2769],[7689,2731],[7634,2742],[7606,2742]]],[[[7911,2864],[7887,2796],[7863,2663],[7823,2589],[7776,2629],[7763,2643],[7768,2659],[7808,2699],[7827,2840],[7843,2860],[7848,2872],[7879,2864],[7911,2864]]],[[[7808,2699],[7768,2659],[7764,2665],[7756,2667],[7729,2668],[7709,2697],[7688,2702],[7689,2731],[7685,2769],[7691,2786],[7791,2836],[7827,2840],[7827,2840],[7828,2835],[7808,2699]]],[[[7827,2840],[7791,2836],[7691,2786],[7674,2805],[7650,2826],[7667,2871],[7677,2883],[7726,2848],[7808,2883],[7817,2885],[7819,2885],[7823,2877],[7848,2872],[7843,2860],[7827,2840],[7827,2840]]],[[[7689,2731],[7688,2702],[7709,2697],[7638,2696],[7584,2670],[7595,2728],[7606,2742],[7634,2742],[7689,2731]]],[[[7750,2391],[7746,2317],[7717,2325],[7686,2419],[7652,2442],[7661,2521],[7740,2529],[7724,2419],[7750,2391]]],[[[7750,2391],[7724,2419],[7740,2529],[7750,2615],[7776,2629],[7823,2589],[7863,2663],[7849,2598],[7776,2484],[7750,2391]]],[[[7695,2610],[7651,2543],[7598,2540],[7574,2588],[7584,2625],[7649,2649],[7695,2610]]],[[[7911,2864],[7879,2864],[7848,2872],[7823,2877],[7819,2885],[7832,2904],[7837,2921],[7847,2927],[7851,2941],[7908,2986],[7947,3014],[7915,2972],[7925,2900],[7911,2864]]],[[[7902,3046],[7929,3041],[7947,3014],[7908,2986],[7851,2941],[7822,2978],[7806,3038],[7868,3073],[7887,3052],[7905,3030],[7902,3046]],[[7875,3008],[7882,3019],[7862,3059],[7842,3038],[7875,3008]]],[[[7756,2667],[7705,2625],[7695,2610],[7695,2610],[7649,2649],[7584,2625],[7593,2635],[7584,2670],[7638,2696],[7709,2697],[7729,2668],[7756,2667]],[[7638,2670],[7652,2656],[7663,2661],[7651,2672],[7638,2670]]]]}},{type:"Feature",id:"CN.TJ",ccode:12,properties:{"hc-group":"admin1","hc-middle-x":.81,"hc-middle-y":.62,"hc-key":"cn-tj","hc-a2":"TJ",labelrank:"7",hasc:"CN.TJ","alt-name":"Ti?nj?n","woe-id":"12578017",subregion:null,fips:"CH28","postal-code":"TJ",name:"Tianjin",country:"China","type-en":"Municipality",region:"North China",longitude:"117.347","woe-name":"Tianjin",latitude:"39.3708","woe-label":"Tianjin, CN, China",type:"Zhíxiáshì"},geometry:{type:"Polygon",coordinates:[[[6978,6083],[6928,6068],[6824,6127],[6823,6172],[6856,6194],[6836,6311],[6841,6315],[6850,6331],[6901,6316],[6915,6429],[6928,6433],[6935,6468],[7008,6424],[6963,6405],[6986,6311],[7037,6306],[7060,6225],[7007,6199],[7028,6169],[6984,6128],[6978,6083]]]}},{type:"Feature",id:"CN.JS",ccode:32,properties:{"hc-group":"admin1","hc-middle-x":.55,"hc-middle-y":.4,"hc-key":"cn-js","hc-a2":"JS",labelrank:"2",hasc:"CN.JS","alt-name":"Ji?ngs?","woe-id":"12577994",subregion:null,fips:"CH04","postal-code":"JS",name:"Jiangsu",country:"China","type-en":"Province",region:"East China",longitude:"119.942","woe-name":"Jiangsu",latitude:"32.9844","woe-label":"Jiangsu, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[7722,4458],[7672,4355],[7593,4296],[7566,4334],[7521,4333],[7481,4379],[7422,4373],[7366,4405],[7263,4389],[7250,4418],[7269,4480],[7193,4514],[7168,4549],[7224,4617],[7203,4693],[7268,4700],[7306,4667],[7328,4701],[7318,4752],[7259,4785],[7234,4730],[7173,4728],[7141,4771],[7135,4829],[7080,4840],[7124,4946],[7113,4963],[7038,4952],[7017,5016],[6904,5047],[6887,5100],[6777,5156],[6794,5216],[6861,5230],[6930,5115],[6959,5147],[6985,5122],[7042,5135],[7045,5164],[7094,5165],[7118,5108],[7160,5119],[7175,5176],[7228,5191],[7246,5258],[7324,5269],[7310,5187],[7339,5202],[7397,5151],[7516,5101],[7565,4951],[7650,4809],[7647,4731],[7751,4670],[7765,4609],[7840,4576],[7842,4517],[7737,4557],[7678,4537],[7643,4583],[7633,4533],[7711,4509],[7751,4467],[7722,4458]]]}},{type:"Feature",id:"CN.HA",ccode:46,properties:{"hc-group":"admin1","hc-middle-x":.5,"hc-middle-y":.45,"hc-key":"cn-ha","hc-a2":"HA",labelrank:"2",hasc:"CN.HA","alt-name":"H?inán","woe-id":"12578020",subregion:null,fips:"CH31","postal-code":"HA",name:"Hainan",country:"China","type-en":"Province",region:"South Central China",longitude:"109.825","woe-name":"Hainan",latitude:"19.1865","woe-label":"Hainan, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[5518,1887],[5603,1867],[5628,1906],[5681,1868],[5693,1799],[5623,1733],[5568,1578],[5535,1576],[5474,1527],[5422,1518],[5381,1468],[5356,1496],[5297,1497],[5199,1549],[5194,1642],[5191,1721],[5316,1815],[5338,1860],[5371,1839],[5426,1877],[5482,1852],[5518,1887]]]}},{type:"Feature",id:"CN.QH",ccode:63,properties:{"hc-group":"admin1","hc-middle-x":.48,"hc-middle-y":.47,"hc-key":"cn-qh","hc-a2":"QH",labelrank:"2",hasc:"CN.QH","alt-name":null,"woe-id":"12577996",subregion:"Western",fips:null,"postal-code":"QH",name:"Qinghai",country:"China","type-en":"Province",region:"Northwest China",longitude:"96.2377","woe-name":"Qinghai",latitude:"35.2652","woe-label":"Qinghai, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[2478,6455],[2626,6472],[2764,6458],[2864,6405],[2910,6408],[3033,6275],[3111,6235],[3111,6217],[3188,6182],[3223,6376],[3284,6359],[3411,6266],[3456,6311],[3505,6289],[3540,6314],[3594,6266],[3712,6132],[3774,6090],[3777,6155],[3848,6094],[3860,6058],[3934,6019],[4061,5905],[4093,5952],[4106,5892],[4197,5812],[4177,5765],[4214,5726],[4200,5694],[4233,5615],[4273,5586],[4251,5558],[4255,5499],[4203,5504],[4195,5429],[4119,5410],[4132,5362],[4006,5256],[4077,5203],[4086,5169],[3999,5110],[3970,5141],[3845,5196],[3813,5145],[3872,5071],[3874,5028],[3939,5032],[3958,4986],[3990,4988],[3957,4898],[3921,4926],[3865,4906],[3858,4806],[3763,4812],[3745,4761],[3712,4834],[3666,4843],[3614,4904],[3577,4842],[3502,4882],[3424,4955],[3396,5073],[3364,5113],[3286,5149],[3229,5133],[3223,5166],[3160,5141],[3156,5082],[3214,5029],[3167,4985],[3133,4920],[3142,4874],[3193,4833],[3124,4831],[3093,4737],[2990,4721],[2996,4665],[2937,4680],[2901,4719],[2860,4676],[2746,4699],[2725,4750],[2742,4780],[2677,4826],[2596,4930],[2500,4897],[2431,4927],[2387,4920],[2297,4982],[2147,5005],[2029,5098],[2003,5161],[1970,5166],[1890,5132],[1786,5208],[1702,5380],[1751,5437],[1741,5524],[1759,5565],[1718,5578],[1717,5668],[1766,5684],[1791,5770],[1731,5817],[1779,5832],[1955,5812],[1999,5780],[2052,5805],[2040,5891],[1987,5945],[2016,5990],[2108,6001],[2085,6116],[1978,6200],[1986,6250],[1948,6359],[2048,6401],[2167,6401],[2278,6416],[2366,6445],[2478,6455]]]}},{type:"Feature",id:"CN.JL",ccode:22,properties:{"hc-group":"admin1","hc-middle-x":.48,"hc-middle-y":.52,"hc-key":"cn-jl","hc-a2":"JL",labelrank:"2",hasc:"CN.JL","alt-name":"Jílín","woe-id":"12577995",subregion:"Northeast",fips:"CH05","postal-code":"JL",name:"Jilin",country:"China","type-en":"Province",region:"Northeast China",longitude:"126.466","woe-name":"Jilin",latitude:"43.2978","woe-label":"Jilin, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[9369,7396],[9357,7259],[9239,7204],[9226,7182],[9182,7258],[9135,7248],[9121,7121],[9057,7115],[9039,7059],[8989,7008],[8834,6986],[8891,6892],[8867,6840],[8839,6861],[8775,6845],[8708,6857],[8641,6923],[8588,6886],[8571,6830],[8494,6698],[8439,6682],[8415,6693],[8445,6749],[8384,6849],[8353,6872],[8346,6938],[8376,6987],[8349,6988],[8253,7156],[8233,7208],[8187,7143],[8146,7231],[8048,7285],[8040,7256],[7983,7276],[8005,7337],[7923,7505],[7918,7536],[7796,7453],[7732,7566],[7721,7669],[7758,7713],[7701,7810],[7651,7820],[7708,7882],[7752,7843],[7778,7878],[7834,7823],[7845,7916],[7906,7952],[8041,7978],[8061,7848],[8127,7777],[8301,7774],[8355,7806],[8385,7739],[8440,7721],[8509,7752],[8580,7730],[8605,7683],[8606,7600],[8663,7617],[8697,7601],[8688,7561],[8758,7480],[8792,7500],[8786,7552],[8838,7596],[8861,7513],[8951,7375],[9010,7393],[9010,7437],[9096,7467],[9120,7505],[9158,7466],[9186,7498],[9217,7429],[9297,7383],[9369,7396]]]}},{type:"Feature",id:"CN.XZ",ccode:54,properties:{"hc-group":"admin1","hc-middle-x":.4,"hc-middle-y":.48,"hc-key":"cn-xz","hc-a2":"XZ",labelrank:"2",hasc:"CN.XZ","alt-name":"Tibet|X?zàng","woe-id":"12578004",subregion:"Western",fips:"CH14","postal-code":"XZ",name:"Xizang",country:"China","type-en":"Autonomous Region",region:"Southwest China",longitude:"88.41370000000001","woe-name":"Xizang",latitude:"31.4515","woe-label":"Tibet, CN, China",type:"Zìzhìqu"},geometry:{type:"Polygon",coordinates:[[[3171,3837],[3067,3936],[3016,3869],[2948,3902],[2884,3994],[2845,4086],[2847,4127],[2811,4152],[2732,4154],[2634,4100],[2538,4138],[2513,4175],[2437,4134],[2450,4116],[2298,4055],[2263,4060],[2185,4001],[2090,3954],[2080,3913],[1945,3888],[1878,3905],[1887,3940],[1821,3989],[1778,3968],[1660,4008],[1687,4040],[1620,4079],[1547,4075],[1482,4049],[1363,3948],[1322,3888],[1300,3944],[1333,4006],[1294,4072],[1189,4033],[1133,4053],[1110,4034],[998,4057],[978,4086],[888,4137],[860,4100],[818,4128],[769,4110],[731,4219],[712,4204],[610,4238],[638,4293],[543,4315],[469,4397],[457,4478],[342,4488],[292,4597],[231,4617],[185,4686],[115,4734],[116,4794],[25,4832],[-16,4831],[-40,4781],[-88,4764],[-101,4821],[-211,4912],[-221,4955],[-286,5024],[-336,5030],[-380,5082],[-409,5161],[-476,5153],[-447,5209],[-467,5252],[-443,5292],[-484,5363],[-484,5432],[-416,5442],[-392,5371],[-361,5368],[-272,5412],[-283,5487],[-265,5532],[-333,5581],[-357,5643],[-340,5763],[-288,5783],[-285,5812],[-234,5824],[-125,5798],[-83,5848],[-85,5904],[24,6019],[50,5989],[136,5945],[155,5963],[269,5906],[326,5912],[422,5979],[515,5957],[533,5892],[617,5864],[739,5847],[811,5874],[927,5897],[1e3,5862],[1072,5873],[1139,5945],[1188,5960],[1398,5951],[1481,5960],[1567,5951],[1701,5886],[1779,5832],[1731,5817],[1791,5770],[1766,5684],[1717,5668],[1718,5578],[1759,5565],[1741,5524],[1751,5437],[1702,5380],[1786,5208],[1890,5132],[1970,5166],[2003,5161],[2029,5098],[2147,5005],[2297,4982],[2387,4920],[2431,4927],[2500,4897],[2596,4930],[2677,4826],[2742,4780],[2725,4750],[2746,4699],[2860,4676],[2901,4719],[2937,4680],[2996,4665],[2990,4721],[3093,4737],[3124,4831],[3193,4833],[3282,4781],[3322,4693],[3313,4655],[3391,4542],[3333,4506],[3392,4404],[3381,4386],[3394,4215],[3375,4157],[3390,4059],[3331,3974],[3297,4012],[3276,3945],[3281,3889],[3247,3853],[3212,3880],[3171,3837]]]}},{type:"Feature",id:"CN.XJ",ccode:65,properties:{"hc-group":"admin1","hc-middle-x":.54,"hc-middle-y":.55,"hc-key":"cn-xj","hc-a2":"XJ",labelrank:"2",hasc:"CN.XJ","alt-name":"Xinjiang Uygur|X?nji?ng Wéiwú?r","woe-id":"12578003",subregion:"Western",fips:"CH13","postal-code":"XJ",name:"Xinjiang",country:"China","type-en":"Autonomous Region",region:"Northwest China",longitude:"85.42529999999999","woe-name":"Xinjiang",latitude:"41.122","woe-label":"Xinjiang, CN, China",type:"Zìzhìqu"},geometry:{type:"Polygon",coordinates:[[[2478,6455],[2366,6445],[2278,6416],[2167,6401],[2048,6401],[1948,6359],[1986,6250],[1978,6200],[2085,6116],[2108,6001],[2016,5990],[1987,5945],[2040,5891],[2052,5805],[1999,5780],[1955,5812],[1779,5832],[1701,5886],[1567,5951],[1481,5960],[1398,5951],[1188,5960],[1139,5945],[1072,5873],[1e3,5862],[927,5897],[811,5874],[739,5847],[617,5864],[533,5892],[515,5957],[422,5979],[326,5912],[269,5906],[155,5963],[136,5945],[50,5989],[24,6019],[-85,5904],[-83,5848],[-125,5798],[-234,5824],[-285,5812],[-396,5911],[-415,6060],[-395,6099],[-513,6130],[-601,6179],[-652,6229],[-650,6265],[-723,6259],[-757,6337],[-722,6415],[-744,6474],[-809,6505],[-811,6545],[-888,6576],[-974,6636],[-903,6660],[-896,6639],[-817,6663],[-855,6720],[-832,6755],[-846,6834],[-824,6932],[-894,6987],[-957,6969],[-994,6997],[-999,7060],[-967,7085],[-991,7150],[-973,7197],[-913,7217],[-919,7270],[-872,7321],[-805,7314],[-699,7387],[-640,7355],[-561,7377],[-563,7300],[-455,7310],[-448,7285],[-378,7337],[-335,7404],[-288,7417],[-209,7384],[-100,7373],[-32,7440],[155,7499],[237,7503],[260,7528],[320,7520],[346,7568],[343,7663],[367,7699],[429,7713],[403,7750],[481,7758],[485,7840],[454,8006],[484,8137],[509,8153],[429,8185],[412,8216],[452,8236],[593,8233],[754,8253],[781,8199],[844,8207],[891,8185],[909,8246],[858,8281],[937,8433],[1044,8601],[1061,8662],[1084,8662],[1200,8579],[1328,8558],[1338,8513],[1422,8553],[1472,8549],[1516,8625],[1513,8763],[1580,8877],[1648,8867],[1715,8884],[1753,8923],[1762,8995],[1794,9020],[1877,8997],[1950,9009],[1933,8917],[1971,8881],[1948,8863],[2041,8782],[2038,8749],[2108,8681],[2192,8678],[2219,8621],[2271,8627],[2313,8565],[2321,8474],[2370,8384],[2392,8276],[2357,8215],[2365,8143],[2306,8084],[2286,8023],[2313,7942],[2359,7938],[2445,7892],[2505,7887],[2583,7857],[2633,7861],[2763,7822],[2824,7745],[2870,7735],[2891,7697],[3005,7620],[3066,7621],[3048,7554],[3080,7544],[3128,7351],[3189,7276],[3196,7224],[3133,7177],[3118,7056],[3066,7022],[2938,7027],[2847,6989],[2731,6888],[2638,6776],[2582,6755],[2520,6764],[2505,6681],[2469,6612],[2490,6524],[2478,6455]]]}},{type:"Feature",id:"CN.HE",ccode:41,properties:{"hc-group":"admin1","hc-middle-x":.52,"hc-middle-y":.47,"hc-key":"cn-he","hc-a2":"HE",labelrank:"2",hasc:"CN.HE","alt-name":"Hénán","woe-id":"12577999",subregion:"Central",fips:"CH09","postal-code":"HE",name:"Henan",country:"China","type-en":"Province",region:"South Central China",longitude:"113.484","woe-name":"Henan",latitude:"33.9055","woe-label":"Henan, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6593,4419],[6545,4459],[6520,4432],[6432,4453],[6434,4491],[6354,4515],[6320,4492],[6286,4544],[6274,4645],[6235,4617],[6142,4647],[6085,4630],[5995,4631],[5898,4671],[5790,4766],[5746,4844],[5746,4920],[5676,4985],[5682,5050],[5628,5124],[5631,5155],[5667,5147],[5863,5207],[5915,5257],[5955,5248],[5959,5292],[6119,5291],[6219,5348],[6252,5384],[6274,5548],[6324,5549],[6429,5498],[6533,5509],[6600,5504],[6577,5451],[6688,5473],[6557,5332],[6487,5277],[6484,5239],[6548,5223],[6597,5186],[6619,5140],[6734,5139],[6783,5072],[6811,5075],[6830,4999],[6743,4944],[6700,5008],[6641,5019],[6624,4984],[6639,4914],[6583,4893],[6584,4836],[6545,4797],[6496,4797],[6554,4746],[6557,4685],[6628,4643],[6687,4673],[6694,4505],[6623,4492],[6593,4419]]]}},{type:"Feature",id:"CN.NM",ccode:15,properties:{"hc-group":"admin1","hc-middle-x":.68,"hc-middle-y":.6,"hc-key":"cn-nm","hc-a2":"NM",labelrank:"2",hasc:"CN.NM","alt-name":"Nei Mongol|Nèim?ngg?","woe-id":"12578009",subregion:"Western",fips:"CH20","postal-code":"NM",name:"Inner Mongol",country:"China","type-en":"Autonomous Region",region:"North China",longitude:"111.623","woe-name":"Inner Mongol",latitude:"41.5938","woe-label":"Nei Mongol, CN, China",type:"Zìzhìqu"},geometry:{type:"Polygon",coordinates:[[[5152,5919],[5106,5937],[5064,5990],[5002,5995],[4937,6031],[5039,6202],[5008,6280],[4918,6267],[4881,6229],[4825,6103],[4806,5924],[4725,5916],[4647,5872],[4550,5867],[4536,5845],[4491,5862],[4416,5940],[4372,5958],[4367,6019],[4392,6027],[4387,6096],[4449,6129],[4535,6241],[4510,6322],[4453,6325],[4367,6300],[4306,6263],[4203,6298],[4096,6265],[4131,6219],[4091,6177],[3997,6203],[3977,6264],[3920,6303],[3921,6353],[3869,6365],[3810,6437],[3723,6488],[3676,6493],[3768,6562],[3832,6655],[3803,6724],[3648,6724],[3586,6703],[3550,6669],[3475,6670],[3499,6742],[3437,6812],[3391,6897],[3431,6932],[3343,7224],[3742,7130],[3841,7149],[4051,7095],[4125,7086],[4190,7001],[4372,6945],[4484,6878],[4625,6897],[4622,6848],[4713,6826],[4749,6859],[5035,6975],[5288,7005],[5398,6988],[5521,6996],[5554,7020],[5687,7069],[5783,7193],[5901,7248],[5961,7289],[5945,7348],[5869,7449],[5931,7600],[5979,7629],[6054,7620],[6079,7588],[6170,7555],[6262,7543],[6336,7591],[6399,7655],[6419,7700],[6489,7698],[6610,7716],[6702,7783],[6709,7832],[6775,7933],[6809,7952],[6895,7945],[6909,8001],[6962,7987],[7054,8040],[7137,8033],[7153,8053],[7240,8020],[7302,8017],[7340,8047],[7336,8096],[7301,8159],[7227,8220],[7191,8281],[7137,8304],[7097,8356],[7035,8370],[6952,8349],[6898,8271],[6811,8325],[6707,8321],[6641,8281],[6591,8338],[6583,8385],[6632,8424],[6630,8489],[6774,8822],[6837,8785],[6955,8746],[7022,8789],[7100,8864],[7174,8874],[7210,8903],[7214,8969],[7179,8975],[7234,9071],[7236,9115],[7273,9163],[7326,9318],[7399,9384],[7431,9442],[7404,9501],[7417,9554],[7369,9577],[7308,9565],[7303,9608],[7342,9637],[7433,9752],[7519,9766],[7586,9690],[7490,9571],[7631,9495],[7653,9548],[7755,9479],[7734,9450],[7752,9347],[7796,9266],[7900,9225],[7947,9256],[8027,9252],[8102,9280],[8148,9349],[8209,9325],[8312,9194],[8267,9131],[8280,9082],[8239,9039],[8205,8934],[8199,8844],[8211,8786],[8198,8711],[8148,8714],[8104,8557],[8102,8440],[8053,8543],[7890,8351],[7785,8274],[7761,8222],[7792,8174],[7902,8087],[7933,8123],[7974,8095],[7941,8048],[7873,8042],[7873,7997],[7906,7952],[7845,7916],[7834,7823],[7778,7878],[7752,7843],[7708,7882],[7651,7820],[7701,7810],[7758,7713],[7721,7669],[7732,7566],[7796,7453],[7918,7536],[7923,7505],[8005,7337],[7983,7276],[8040,7256],[8029,7189],[7955,7151],[7948,7122],[7877,7098],[7831,7122],[7803,7069],[7756,7087],[7688,7019],[7639,7028],[7582,6967],[7510,6940],[7409,6827],[7406,6864],[7318,6984],[7263,6939],[7285,6917],[7276,6839],[7295,6767],[7268,6719],[7177,6733],[7109,6729],[7072,6819],[7100,6855],[7065,6892],[7044,6978],[7e3,7032],[6954,7033],[6934,6994],[6841,6977],[6837,6886],[6791,6863],[6751,6883],[6691,6832],[6659,6862],[6566,6811],[6546,6779],[6486,6784],[6491,6862],[6470,6920],[6412,6895],[6372,6844],[6361,6780],[6313,6738],[6319,6675],[6294,6661],[6354,6577],[6334,6516],[6205,6476],[6186,6500],[6137,6486],[6090,6443],[6035,6470],[5980,6404],[5947,6330],[5917,6309],[5868,6322],[5840,6274],[5798,6260],[5800,6306],[5750,6280],[5711,6229],[5685,6260],[5626,6240],[5533,6178],[5402,6023],[5393,5928],[5371,5943],[5356,5872],[5221,5865],[5202,5902],[5152,5919]]]}},{type:"Feature",id:"CN.HL",ccode:23,properties:{"hc-group":"admin1","hc-middle-x":.52,"hc-middle-y":.68,"hc-key":"cn-hl","hc-a2":"HL",labelrank:"2",hasc:"CN.HL","alt-name":"H?ilóngji?ng","woe-id":"12577998",subregion:"Northeast",fips:"CH08","postal-code":"HL",name:"Heilongjiang",country:"China","type-en":"Province",region:"Northeast China",longitude:"127.97","woe-name":"Heilongjiang",latitude:"46.8451","woe-label":"Heilongjiang, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[9369,7396],[9297,7383],[9217,7429],[9186,7498],[9158,7466],[9120,7505],[9096,7467],[9010,7437],[9010,7393],[8951,7375],[8861,7513],[8838,7596],[8786,7552],[8792,7500],[8758,7480],[8688,7561],[8697,7601],[8663,7617],[8606,7600],[8605,7683],[8580,7730],[8509,7752],[8440,7721],[8385,7739],[8355,7806],[8301,7774],[8127,7777],[8061,7848],[8041,7978],[7906,7952],[7873,7997],[7873,8042],[7941,8048],[7974,8095],[7933,8123],[7902,8087],[7792,8174],[7761,8222],[7785,8274],[7890,8351],[8053,8543],[8102,8440],[8104,8557],[8148,8714],[8198,8711],[8211,8786],[8199,8844],[8205,8934],[8239,9039],[8280,9082],[8267,9131],[8312,9194],[8209,9325],[8148,9349],[8102,9280],[8027,9252],[7947,9256],[7900,9225],[7796,9266],[7752,9347],[7734,9450],[7755,9479],[7653,9548],[7631,9495],[7490,9571],[7586,9690],[7519,9766],[7666,9820],[7750,9820],[7811,9849],[7869,9851],[7972,9808],[8002,9771],[8119,9771],[8221,9718],[8281,9641],[8366,9507],[8356,9461],[8402,9361],[8443,9315],[8455,9227],[8520,9150],[8536,9041],[8579,9017],[8577,8914],[8635,8860],[8680,8850],[8797,8869],[8791,8845],[8850,8817],[8918,8838],[8996,8750],[9057,8712],[9128,8721],[9110,8659],[9167,8587],[9151,8513],[9218,8427],[9283,8449],[9312,8434],[9471,8462],[9490,8526],[9555,8573],[9618,8577],[9657,8621],[9764,8669],[9821,8646],[9806,8588],[9851,8510],[9811,8433],[9761,8383],[9753,8222],[9733,8184],[9749,8130],[9716,8097],[9688,7953],[9643,7912],[9648,7835],[9602,7813],[9576,7858],[9483,7868],[9451,7838],[9418,7860],[9359,7761],[9278,7723],[9305,7687],[9356,7538],[9347,7470],[9369,7396]]]}},{type:"Feature",id:"CN.YN",ccode:53,properties:{"hc-group":"admin1","hc-middle-x":.42,"hc-middle-y":.6,"hc-key":"cn-yn","hc-a2":"YN",labelrank:"2",hasc:"CN.YN","alt-name":"Yúnnán","woe-id":"12578018",subregion:"Western",fips:"CH29","postal-code":"YN",name:"Yunnan",country:"China","type-en":"Province",region:"Southwest China",longitude:"101.661","woe-name":"Yunnan",latitude:"24.4603","woe-label":"Yunnan, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[4581,2613],[4540,2660],[4447,2621],[4434,2568],[4331,2521],[4307,2553],[4267,2532],[4256,2490],[4190,2555],[4160,2510],[4120,2557],[4049,2484],[4022,2519],[3942,2564],[3889,2489],[3774,2506],[3742,2460],[3783,2364],[3764,2214],[3661,2247],[3651,2362],[3561,2315],[3452,2305],[3447,2355],[3408,2374],[3413,2446],[3250,2485],[3301,2557],[3296,2613],[3340,2679],[3284,2684],[3213,2718],[3222,2812],[3186,2859],[3190,2897],[3235,2932],[3176,2922],[3095,2940],[2978,2894],[2955,2914],[2998,2951],[2992,3022],[2967,3023],[2978,3092],[3028,3111],[3017,3136],[3048,3201],[3108,3223],[3119,3272],[3157,3258],[3199,3315],[3236,3321],[3212,3374],[3265,3485],[3260,3610],[3270,3699],[3219,3728],[3193,3698],[3165,3799],[3171,3837],[3212,3880],[3247,3853],[3281,3889],[3276,3945],[3297,4012],[3331,3974],[3390,4059],[3384,3882],[3422,3822],[3432,3902],[3502,3963],[3522,3907],[3576,3843],[3554,3783],[3606,3707],[3670,3730],[3750,3537],[3815,3456],[3796,3427],[3839,3374],[3827,3343],[3875,3301],[3929,3308],[4025,3367],[4043,3331],[4102,3354],[4126,3395],[4100,3484],[4104,3566],[4152,3590],[4236,3686],[4230,3747],[4316,3784],[4302,3831],[4335,3848],[4426,3848],[4392,3826],[4425,3727],[4410,3696],[4454,3668],[4513,3677],[4547,3717],[4591,3695],[4590,3632],[4566,3561],[4500,3545],[4415,3558],[4396,3580],[4360,3544],[4309,3574],[4242,3508],[4276,3479],[4273,3394],[4319,3377],[4404,3416],[4449,3339],[4365,3184],[4455,3089],[4400,2976],[4407,2899],[4439,2912],[4512,2895],[4521,2840],[4576,2808],[4645,2801],[4694,2819],[4727,2763],[4710,2691],[4652,2689],[4581,2613]]]}},{type:"Feature",id:"CN.GX",ccode:45,properties:{"hc-group":"admin1","hc-middle-x":.58,"hc-middle-y":.56,"hc-key":"cn-gx","hc-a2":"GX",labelrank:"2",hasc:"CN.GX","alt-name":"Guangxi Zhuang|Guangxi Zhuàngzú","woe-id":"12578006",subregion:"Western",fips:"CH16","postal-code":"GX",name:"Guangxi",country:"China","type-en":"Autonomous Region",region:"South Central China",longitude:"108.756","woe-name":"Guangxi",latitude:"23.7451","woe-label":"Guangxi, CN, China",type:"Zìzhìqu"},geometry:{type:"Polygon",coordinates:[[[5441,2225],[5389,2254],[5395,2208],[5313,2190],[5314,2235],[5234,2248],[5173,2298],[5185,2237],[5145,2264],[5136,2228],[5080,2213],[5025,2257],[4942,2247],[4869,2305],[4875,2323],[4801,2342],[4806,2392],[4780,2439],[4828,2507],[4777,2550],[4741,2536],[4677,2566],[4646,2552],[4581,2613],[4652,2689],[4710,2691],[4727,2763],[4694,2819],[4645,2801],[4576,2808],[4521,2840],[4512,2895],[4439,2912],[4407,2899],[4400,2976],[4437,2949],[4535,3028],[4598,2981],[4700,2937],[4731,3007],[4904,3064],[4902,3106],[4958,3130],[5006,3051],[5037,3070],[5079,3033],[5134,3058],[5170,3117],[5225,3088],[5252,3128],[5321,3113],[5305,3166],[5375,3156],[5409,3221],[5472,3190],[5505,3254],[5568,3204],[5632,3283],[5697,3267],[5711,3293],[5772,3267],[5759,3195],[5810,3187],[5782,3093],[5715,3016],[5722,2964],[5772,3014],[5803,3004],[5820,2900],[5851,2931],[5918,2920],[5927,2841],[5890,2808],[5896,2756],[5846,2721],[5790,2631],[5780,2515],[5711,2456],[5640,2423],[5658,2378],[5630,2356],[5566,2359],[5574,2295],[5488,2289],[5441,2225]]]}},{type:"Feature",id:"CN.LN",ccode:21,properties:{"hc-group":"admin1","hc-middle-x":.64,"hc-middle-y":.39,"hc-key":"cn-ln","hc-a2":"LN",labelrank:"2",hasc:"CN.LN","alt-name":"Liáoníng","woe-id":"12578008",subregion:"Northeast",fips:"CH19","postal-code":"LN",name:"Liaoning",country:"China","type-en":"Province",region:"Northeast China",longitude:"123.07","woe-name":"Liaoning",latitude:"41.386","woe-label":"Liaoning, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[7268,6719],[7295,6767],[7276,6839],[7285,6917],[7263,6939],[7318,6984],[7406,6864],[7409,6827],[7510,6940],[7582,6967],[7639,7028],[7688,7019],[7756,7087],[7803,7069],[7831,7122],[7877,7098],[7948,7122],[7955,7151],[8029,7189],[8040,7256],[8048,7285],[8146,7231],[8187,7143],[8233,7208],[8253,7156],[8349,6988],[8376,6987],[8346,6938],[8353,6872],[8384,6849],[8445,6749],[8415,6693],[8439,6682],[8390,6624],[8299,6583],[8208,6483],[8168,6420],[8036,6401],[7968,6371],[7860,6302],[7765,6188],[7640,6130],[7632,6181],[7732,6219],[7716,6243],[7748,6287],[7659,6287],[7659,6336],[7702,6356],[7698,6400],[7758,6434],[7829,6559],[7744,6633],[7621,6649],[7513,6520],[7495,6470],[7390,6417],[7349,6468],[7333,6546],[7285,6542],[7203,6609],[7217,6657],[7268,6719]]]}},{type:"Feature",id:"CN.SC",ccode:51,properties:{"hc-group":"admin1","hc-middle-x":.45,"hc-middle-y":.5,"hc-key":"cn-sc","hc-a2":"SC",labelrank:"2",hasc:"CN.SC","alt-name":"Sìchu?n","woe-id":"12578016",subregion:"Western",fips:"CH32","postal-code":"SC",name:"Sichuan",country:"China","type-en":"Province",region:"Southwest China",longitude:"102.384","woe-name":"Sichuan",latitude:"30.5431","woe-label":"Sichuan, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[3990,4988],[4015,4958],[3997,4894],[4123,4963],[4072,5076],[4110,5081],[4193,5144],[4256,5115],[4263,5035],[4334,5027],[4325,5006],[4433,4989],[4484,4907],[4485,4847],[4459,4800],[4509,4760],[4573,4739],[4645,4742],[4692,4800],[4704,4759],[4808,4783],[4829,4721],[4924,4750],[4991,4740],[5015,4681],[5063,4695],[5167,4606],[5177,4623],[5267,4613],[5217,4564],[5260,4521],[5240,4470],[5165,4395],[5142,4317],[5059,4309],[5051,4261],[4959,4140],[4897,4143],[4865,4208],[4805,4184],[4784,4213],[4720,4234],[4671,4174],[4705,4147],[4697,4110],[4612,4050],[4633,3995],[4688,3965],[4694,3913],[4794,3880],[4815,3812],[4806,3792],[4739,3856],[4677,3821],[4668,3767],[4713,3723],[4757,3725],[4800,3647],[4656,3620],[4590,3632],[4591,3695],[4547,3717],[4513,3677],[4454,3668],[4410,3696],[4425,3727],[4392,3826],[4426,3848],[4335,3848],[4302,3831],[4316,3784],[4230,3747],[4236,3686],[4152,3590],[4104,3566],[4100,3484],[4126,3395],[4102,3354],[4043,3331],[4025,3367],[3929,3308],[3875,3301],[3827,3343],[3839,3374],[3796,3427],[3815,3456],[3750,3537],[3670,3730],[3606,3707],[3554,3783],[3576,3843],[3522,3907],[3502,3963],[3432,3902],[3422,3822],[3384,3882],[3390,4059],[3375,4157],[3394,4215],[3381,4386],[3392,4404],[3333,4506],[3391,4542],[3313,4655],[3322,4693],[3282,4781],[3193,4833],[3142,4874],[3133,4920],[3167,4985],[3214,5029],[3156,5082],[3160,5141],[3223,5166],[3229,5133],[3286,5149],[3364,5113],[3396,5073],[3424,4955],[3502,4882],[3577,4842],[3614,4904],[3666,4843],[3712,4834],[3745,4761],[3763,4812],[3858,4806],[3865,4906],[3921,4926],[3957,4898],[3990,4988]]]}},{type:"Feature",id:"CN.CQ",ccode:50,properties:{"hc-group":"admin1","hc-middle-x":.24,"hc-middle-y":.66,"hc-key":"cn-cq","hc-a2":"CQ",labelrank:"2",hasc:"CN.CQ","alt-name":"Chóngqìng","woe-id":"20070171",subregion:"Western",fips:"CH33","postal-code":"CQ",name:"Chongqing",country:"China","type-en":"Municipality",region:"Southwest China",longitude:"107.73","woe-name":"Chongqing",latitude:"30.0173","woe-label":"Chongqing, CN, China",type:"Zhíxiáshì"},geometry:{type:"Polygon",coordinates:[[[5472,4502],[5498,4461],[5570,4423],[5581,4375],[5558,4294],[5520,4308],[5425,4242],[5284,4244],[5226,4207],[5255,4187],[5248,4054],[5267,4083],[5317,4032],[5324,3967],[5379,3910],[5392,3897],[5385,3775],[5351,3708],[5278,3719],[5290,3760],[5202,3822],[5197,3910],[5115,3892],[5098,3927],[5042,3954],[5027,3871],[4947,3877],[4910,3853],[4876,3789],[4834,3867],[4815,3812],[4794,3880],[4694,3913],[4688,3965],[4633,3995],[4612,4050],[4697,4110],[4705,4147],[4671,4174],[4720,4234],[4784,4213],[4805,4184],[4865,4208],[4897,4143],[4959,4140],[5051,4261],[5059,4309],[5142,4317],[5165,4395],[5240,4470],[5260,4521],[5217,4564],[5267,4613],[5369,4551],[5421,4496],[5472,4502]]]}},{type:"Feature",id:"CN.GZ",ccode:52,properties:{"hc-group":"admin1","hc-middle-x":.53,"hc-middle-y":.51,"hc-key":"cn-gz","hc-a2":"GZ",labelrank:"2",hasc:"CN.GZ","alt-name":"Gùizh?u","woe-id":"12578007",subregion:"Western",fips:"CH18","postal-code":"GZ",name:"Guizhou",country:"China","type-en":"Province",region:"Southwest China",longitude:"106.559","woe-name":"Guizhou",latitude:"26.8033","woe-label":"Guizhou, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[4400,2976],[4455,3089],[4365,3184],[4449,3339],[4404,3416],[4319,3377],[4273,3394],[4276,3479],[4242,3508],[4309,3574],[4360,3544],[4396,3580],[4415,3558],[4500,3545],[4566,3561],[4590,3632],[4656,3620],[4800,3647],[4757,3725],[4713,3723],[4668,3767],[4677,3821],[4739,3856],[4806,3792],[4815,3812],[4834,3867],[4876,3789],[4910,3853],[4947,3877],[5027,3871],[5042,3954],[5098,3927],[5115,3892],[5197,3910],[5202,3822],[5290,3760],[5278,3719],[5351,3708],[5385,3775],[5402,3720],[5390,3673],[5417,3582],[5282,3459],[5412,3466],[5427,3404],[5380,3376],[5401,3333],[5378,3283],[5409,3221],[5375,3156],[5305,3166],[5321,3113],[5252,3128],[5225,3088],[5170,3117],[5134,3058],[5079,3033],[5037,3070],[5006,3051],[4958,3130],[4902,3106],[4904,3064],[4731,3007],[4700,2937],[4598,2981],[4535,3028],[4437,2949],[4400,2976]]]}},{type:"Feature",id:"CN.HN",ccode:43,properties:{"hc-group":"admin1","hc-middle-x":.51,"hc-middle-y":.5,"hc-key":"cn-hn","hc-a2":"HN",labelrank:"2",hasc:"CN.HN","alt-name":"Húnán","woe-id":"12578001",subregion:"Central",fips:"CH11","postal-code":"HN",name:"Hunan",country:"China","type-en":"Province",region:"South Central China",longitude:"111.712","woe-name":"Hunan",latitude:"27.6667","woe-label":"Hunan, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[5409,3221],[5378,3283],[5401,3333],[5380,3376],[5427,3404],[5412,3466],[5282,3459],[5417,3582],[5390,3673],[5402,3720],[5385,3775],[5392,3897],[5379,3910],[5426,4005],[5496,4048],[5560,4058],[5610,4027],[5656,4053],[5632,4108],[5687,4126],[5785,4109],[5818,4085],[5888,4082],[5975,4025],[5987,3995],[6060,4014],[6107,4051],[6115,3984],[6154,3977],[6245,4070],[6273,3970],[6245,3938],[6258,3900],[6307,3887],[6354,3824],[6337,3774],[6371,3739],[6309,3652],[6273,3643],[6238,3556],[6246,3506],[6296,3501],[6277,3455],[6304,3411],[6299,3346],[6343,3329],[6311,3238],[6359,3249],[6307,3144],[6311,3076],[6241,3049],[6167,3089],[6104,3048],[6120,2969],[6083,2964],[6054,3003],[5957,3012],[5948,2932],[5918,2920],[5851,2931],[5820,2900],[5803,3004],[5772,3014],[5722,2964],[5715,3016],[5782,3093],[5810,3187],[5759,3195],[5772,3267],[5711,3293],[5697,3267],[5632,3283],[5568,3204],[5505,3254],[5472,3190],[5409,3221]]]}},{type:"Feature",id:"CN.SX",ccode:14,properties:{"hc-group":"admin1","hc-middle-x":.5,"hc-middle-y":.44,"hc-key":"cn-sx","hc-a2":"SX",labelrank:"2",hasc:"CN.SX","alt-name":"Sh?nx?","woe-id":"12578013",subregion:"Central",fips:"CH24","postal-code":"SX",name:"Shanxi",country:"China","type-en":"Province",region:"North China",longitude:"112.389","woe-name":"Shanxi",latitude:"37.7586","woe-label":"Shanxi, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[5631,5155],[5615,5166],[5634,5289],[5689,5380],[5660,5506],[5669,5610],[5649,5680],[5706,5770],[5730,5834],[5723,5882],[5681,5927],[5682,5985],[5746,6043],[5775,6171],[5818,6242],[5798,6260],[5840,6274],[5868,6322],[5917,6309],[5947,6330],[5980,6404],[6035,6470],[6090,6443],[6137,6486],[6186,6500],[6205,6476],[6334,6516],[6354,6577],[6378,6490],[6419,6478],[6341,6444],[6314,6404],[6396,6368],[6425,6290],[6398,6205],[6366,6181],[6299,6182],[6294,6120],[6240,6056],[6241,5990],[6287,5966],[6331,5872],[6336,5814],[6280,5724],[6284,5672],[6224,5637],[6239,5578],[6274,5548],[6252,5384],[6219,5348],[6119,5291],[5959,5292],[5955,5248],[5915,5257],[5863,5207],[5667,5147],[5631,5155]]]}},{type:"Feature",id:"CN.JX",ccode:36,properties:{"hc-group":"admin1","hc-middle-x":.5,"hc-middle-y":.36,"hc-key":"cn-jx","hc-a2":"JX",labelrank:"2",hasc:"CN.JX","alt-name":"Ji?ngx?","woe-id":"12577993",subregion:"Central",fips:"CH03","postal-code":"JX",name:"Jiangxi",country:"China","type-en":"Province",region:"East China",longitude:"116.017","woe-name":"Jiangxi",latitude:"27.6397","woe-label":"Jiangxi, CN, China",type:"Sh?ng"},geometry:{type:"Polygon",coordinates:[[[6311,3076],[6307,3144],[6359,3249],[6311,3238],[6343,3329],[6299,3346],[6304,3411],[6277,3455],[6296,3501],[6246,3506],[6238,3556],[6273,3643],[6309,3652],[6371,3739],[6337,3774],[6354,3824],[6307,3887],[6375,3928],[6487,3961],[6500,3991],[6576,4011],[6618,4068],[6691,4040],[6748,4053],[6816,4075],[6846,4113],[6893,4084],[6852,4036],[6863,4001],[6932,4038],[6929,4067],[6995,4066],[7020,4020],[7111,4011],[7149,3975],[7116,3914],[7203,3816],[7210,3724],[7195,3682],[7088,3642],[7073,3614],[7025,3648],[6981,3622],[6948,3556],[6957,3491],[6912,3433],[6861,3425],[6829,3358],[6853,3314],[6809,3267],[6795,3193],[6758,3173],[6727,3057],[6700,3022],[6710,2960],[6684,2940],[6674,2877],[6615,2929],[6502,2885],[6413,2865],[6360,2903],[6410,2972],[6474,3005],[6441,3067],[6331,3036],[6311,3076]]]}}]},e}),define("module/my/fansAnalysis",["jquery","backbone","plugin/highchart/maps/highchartData","exporting"],function(e,t,n){var r=t.View.extend({init:function(){this.bindEvents(),this.getAreaData()},bindEvents:function(){var t=e("[data-tab]");e("#region_map").on("click","[data-tab]",function(){var n=e(this),r=n.attr("data-tab");t.removeClass("active"),n.addClass("active"),e(".list-province,.list-city").addClass("hidden"),e("."+r).removeClass("hidden")})},renderGenderChart:function(t){var n=[];for(var r in t)r=="female"?n.push({name:"女",color:"rgb(255,156,176)",y:t[r]}):r=="male"&&n.push({name:"男",color:"rgb(72,173,239)",y:t[r]});e("#gender_rate .cont").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1,type:"pie"},title:{text:""},tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:"gray"}}}},credits:!1,series:[{type:"pie",name:"",data:n}]})},getAreaData:function(){var t=this,r=Highcharts.maps["countries/cn/cn-all"],i=e(".list-province"),s=e(".list-city"),o=[],u=[],a=0,f,l;this.model.fetch({url:"/center/dataAnalyze/fansDataJson",type:"get",dataType:"json",data:{realId:window.helper.getParameterByName("realId")||""},success:function(f,l){if(l.res===!1)return;l.gender=l.gender?JSON.parse(l.gender):{},l.region=JSON.parse(l.region),e.each(r.features,function(e,t){var r=t.ccode,i=n[r];i&&(t.properties["hc-key"]=i.name,t.properties.name=i.name);if(l.region){if(!i||!i.name)return;l.region.provinces[r]?(a+=l.region.provinces[r]*1,o.push({nullColor:"gray",key:i?i.name:t.properties["hc-key"],value:l.region.provinces[r]})):o.push({nullColor:"gray",key:i?i.name:t.properties["hc-key"],value:0})}}),o.sort(function(e,t){return t.value-e.value}),i.empty().addClass("hidden"),e.each(o,function(e,t){t.rank=e+1,a==0?t.pix=0:t.pix=(t.value/a*100).toFixed(2),e<10&&i.append('<p title="占比：'+t.pix+'%"><em>'+t.key+'</em><span><u style=" width:'+t.pix+'%;"></u></span></p>')}),i.removeClass("hidden");if(l.region)for(var c in l.region.cities){var h=c.substring(0,2),p=c.substring(2);n[h]&&n[h].cities[p]&&u.push({region:n[h].cities[p],value:l.region.cities[c]})}u.sort(function(e,t){return t.value-e.value}),s.empty().addClass("hidden"),e.each(u,function(e,t){a==0?t.pix=0:t.pix=(t.value/a).toFixed(2),e<10&&s.append('<p title="占比：'+t.pix*100+'%"><em>'+t.region+'</em><span><u style=" width:'+t.pix*100+'%;"></u></span></p>')}),l.region&&l.region.cites&&e.each(l.region.cites,function(e,t){if(e>=10)return!1;u.push()}),e("#region_map .data-chart .region-right").highcharts("Map",{title:{text:null},chart:{events:{afterPrint:function(){t.renderGenderChart(l.gender)}}},exporting:{buttons:{contextButton:{menuItems:[{text:"打印图表",onclick:function(){this.print()}},{text:"保存为图片",onclick:function(){this.exportChart()}},{text:"保存为PDF文档",onclick:function(){this.exportChart({type:"application/pdf"})}}]}}},mapNavigation:{enabled:!0,enableMouseWheelZoom:!1},colorAxis:{min:0,stops:[[0,"#EFEFFF"],[.5,Highcharts.getOptions().colors[0]],[1,Highcharts.Color(Highcharts.getOptions().colors[0]).brighten(-0.5).get()]]},legend:!1,tooltip:{headerFormat:" <span>{point.key}</span><br/>",pointFormat:"排名: {point.rank}<br/>占比：{point.pix:0.3f}%"},plotOptions:{map:{nullColor:"gray"}},credits:!1,series:[{data:o,borderWidth:0,mapData:r,joinBy:["hc-key","key"],name:"Random data",nullColor:"gray",states:{hover:{color:Highcharts.getOptions().colors[2],borderWidth:0}},dataLabels:!1},{type:"mapline",name:"Separators",data:Highcharts.geojson(r,"mapline"),nullColor:"gray",showInLegend:!0,enableMouseTracking:!0}]}),t.renderGenderChart(l.gender)}})}});return new r({model:new t.Model})}),define("page/center/fansAnalysis",["jquery","page/page_base","page/center/common","module/my/fansAnalysis"],function(e,t,n,r){var i=t.extend({init:function(){n.init(),r.init()},release:function(){this.callParent("release")}});return new i}),define("page/center/incomeDetail",["jquery","page/page_base","page/center/common"],function(e,t,n){var r=t.extend({init:function(){n.init(),this.bindEvents()},bindEvents:function(){e(".icon-ic_test2").on("click",function(){e(".income-pop").toggleClass("hidden")}),e(".icon-ic_x").on("click",function(){e(".income-pop").addClass("hidden")})},release:function(){this.callParent("release")}});return new r}),define("page/center/anchorGrade",["jquery","page/page_base","page/center/common"],function(e,t,n){var r=t.extend({init:function(){xmLog&&xmLog("pv.create",{item:"主播等级页"}),xmLog("pv.send","event",{item:"主播等级页",serviceId:"viewitem"}),this.callParent("init"),n.init(),this.calcuBar(),this.closeGuide()},isV0:function(){return e(".grade").hasClass("grade0")},calcuBar:function(){if(this.isV0())return;var t=e(".j-score").attr("data-rate")*100;e(".redBar").eq(0).css({width:t+"%"}),e(".redBar").eq(1).css("width",function(){return this.getAttribute("data-rate")*100+"%"}),e(".redBar").eq(2).css("width",function(){return this.getAttribute("data-rate")*100+"%"})},closeGuide:function(){var t=e(".j-step1"),n=e(".j-step2");t.length>0&&(t.find(".pointer-btn").on("click",function(e){e.preventDefault(),t.addClass("hidden"),n.removeClass("hidden")}),n.find(".pointer-btn").on("click",function(e){e.preventDefault(),n.addClass("hidden")}))},release:function(){this.callParent("release")}});return new r}),define("page/center/createAlbumHtml",[],function(){var e={fromTemplate:function(){var e={hiddInput:'<!--该INPUT用来防止在标题输入框中按回车form表单自动提交-->   <input class="" type="text" id="" name="" style="position:absolute;top:-10000px;">',title:'<div class="row"> <div class="cell-1">专辑名称<span class="c04">*</span></div> <div class="cell-2">   <input class="inputW1" type="text" id="title" name="title">   <p class="tips mgt-5" data-def=" 好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）">       好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）</p> </div></div>',image:'<div class="row"> <div class="cell-1">设置封面<span class="c04">*</span></div> <div class="cell-2">   <div id="imageWrap" class="imageWrap">            <div class="imgBox2">                <div class="imgItem">                    <img id="album_cover_url" src="'+config.STATIC_PATH+'/css/img/common/album_100.jpg">'+'                    <input type="hidden" name="image">'+'                    <div class="imgLoading"></div>'+"                </div>"+"            </div>"+"        </div>"+"        <p>"+'            <a class="btn btn-secondary btn-upload" href="javascript:;" id="uploadPicBtn"><i class="icon icon-10 icon-upload1"></i> 上传图片</a>   '+'            <span class="tips" data-def="文件大小<3M,尺寸最好<500X500" >文件大小&lt;3M,尺寸最好&gt;500X500</span>'+'            <span class="suc-tip mgl-20 hidden">上传成功！离5000曝光只差简介和标签啦～</span>'+"        </p>"+" </div>"+"</div>",categories:' <div class="row">     <div class="cell-1">类型<span class="c04">*</span></div>     <div class="cell-2">       <div id="genre" class="selecter selecter-s5 ">                    <input type="hidden" name="categoryId">                    <div class="selecter-selected">                        <span class="selecter-text">请选择</span>                        <em class="selecter-arrow">◆</em>                    </div>                    <div class="selecter-options">                        <ul>                                                                                    </ul>                    </div>                 </div>                 <div id="genre_sub" class="selecter selecter-s5 hidden">                    <input name="musicCategory" value="" type="hidden">                    <div class="selecter-selected" data-value="">                        <span class="selecter-text">                         请选择                        </span>                        <em class="selecter-arrow">◆</em>                    </div>                    <div class="selecter-options">                        <ul>                             </ul>                    </div>                </div>       <span class="tips" data-def="该信息必填">该信息必填</span>     </div>   </div>',order:'<div class="row"> <div class="cell-1">专辑排序<span class="c04">*</span></div> <div class="cell-2">   <label class="xm-radio mgr-20 ">     <input type="radio" name="isRecordsDesc" class="js-order-d" value="1" >倒序 <span class="tips">最新上传在前（娱乐/资讯等时效性较强的专辑建议使用倒序哦）</span>   </label><br>   <label class="xm-radio ">     <input type="radio" name="isRecordsDesc" class="js-order-z" value="0" >正序 <span class="tips">最新上传在后（有声书类有上下文关系的专辑建议使用正序哦）</span>   </label> </div></div>',is_pay:'    <div class="row">     <div class="cell-1">是否付费<span class="c04">*</span></div>     <div class="cell-2">       <label class="xm-radio  mgr-20">         <input type="radio" name="isPaid" value="1" data-show="js-price-paytype">是        </label>       <label class="xm-radio" >         <input type="radio" name="isPaid" value="0">否        </label><span class="tips" data-def=""></span>     </div>   </div>',payRange:'    <div class="row  js-price-paytype hidden js-payRange">     <div class="cell-1">售卖范围<span class="c04">*</span></div>     <div class="cell-2">       <label class="xm-radio  mgr-20 xm-is-checked">         <input type="radio" name="saleScope" value="0"  checked="checked">全站售卖        </label>       <label class="xm-radio" >         <input type="radio" name="saleScope" value="1">站外分销         </label><span class="c02 txt-sm">站内不可见，仅用于站外兑换码分销</span>     </div>   </div>',pay_type:'    <div class="row  js-price-paytype hidden">     <div class="cell-1">售卖类型<span class="c04">*</span></div>     <div class="cell-2">       <div id="price_type_id" class="selecter selecter-s5 " style="width:250px;">                    <input type="hidden" name="priceTypeMask">                    <div class="selecter-selected">                        <span class="selecter-text">请选择</span>                        <em class="selecter-arrow">◆</em>                    </div>                    <div class="selecter-options">                        <ul>                                                                                    </ul>                    </div>                 </div>       <span class="tips" data-def="该信息必填">该信息必填</span>     </div>   </div>',subTitle:'<div class="row js-price-paytype js-sub-title-contrain hidden"> <div class="cell-1">专辑副标题<span class="c04">*</span></div> <div class="cell-2">   <input class="inputW1 sub_title j-destory"  id="sub_title" name="customTitle" type="text">   <p class="tips mgt-5">请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">       查看展示位置       <span class="hover-detail">         <img src="'+config.STATIC_PATH+'/css/img/pic.png">'+"       </span>"+"     </span> "+"   </p>"+" </div>"+"</div>",tryting:'   <div class="row js-price-paytype hidden">       <div class="cell-1">高级试听</div>       <div class="cell-2">         <label class="xm-checkbox"  id="isSample" data-wran-tips="js-sample-warn">           <input type="checkbox" name="isSample" checked value="1">本专辑内所有声音均可试听前N秒         </label>         <span class="txt-sm c04 js-sample-warn hidden" >据说99%销量领先的主播都勾选了此项哦~</span>         <p class="tips">若声音时长≤10分钟，则试听时长为前90秒；若声音时长＞10分钟，则试听时长为前180秒</p>                <label class="xm-checkbox"  id="eavesdropping" data-wran-tips="js-sample-warn2">           <input type="checkbox" name="canShareAndStealListen" checked value="1">听众可免费听一条分享成功的声音         </label>         <span class="txt-sm c04 js-sample-warn2 hidden" >据说99%销量领先的主播都勾选了此项哦~</span>         <p class="tips">同一听众最多只能分享免费听本专辑中的一条声音</p>       </div>   </div>',soundpaster:'<div class="row js-price-paytype js-soundpaster hidden">      <div class="cell-1">试听引导语<span class="c04">*</span>      </div>      <div class="cell-2 pay-album-intro">          <p class="c02">请选择适合你节目性质的内容（试听部分结束后，将使用此语音引导用户购买哦）</p>      </div> </div>',paytypeRows:'   <div class="js-paytype-rows"></div>',freesubTitle:'<div class="row  js-free-sub-title-contrain "> <div class="cell-1">专辑副标题</div> <div class="cell-2">   <input class="inputW1 sub_title" id="sub_title" name="customTitle" type="text" data-require="false">   <p class="tips mgt-5">请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">       查看展示位置       <span class="hover-detail">         <img src="'+config.STATIC_PATH+'/css/img/pic.png">'+"       </span>"+"     </span> "+"   </p>"+" </div>"+"</div>",is_public:'   <div class="row js-is-public">     <div class="cell-1">是否公开<span class="c04">*</span></div>     <div class="cell-2">       <label class="xm-radio xm-is-checked">         <input type="radio" name="isPublic" value="1" checked="checked">公开 <span class="tips">所有人可见(公开后，无法再设置为私密)</span>       </label>       <br>       <label class="xm-radio" >         <input type="radio" name="isPublic" value="0">私密 <span class="tips">仅自己可见</span>       </label>     </div>   </div>',rich_intro:'   <div class="js-intro-row">   <div class="row"> <div class="cell-1">专辑简介</div>     <div class="cell-2 textarea-wrapper">       <input id="description" type="hidden" name="introImages" value="">       <input id="description"  data-params="{ &quot;maxSizeLimit&quot;:3000, &quot;must&quot; : false}" type="hidden" data-name="intro" name="intro" value="">       <p class="placeholder">这档节目讲了什么？简单介绍一下吧~</p>       <textarea id="" rows="10" cols="30" name="richIntro"></textarea>                      <span class="tips hidden fr js-intro-min-size-tips">加油，还差<span class="c04">100</span>个字！</span>     </div>   </div></div>',nextStep:'<div class="button">    <a class=" inl-b mgr-20 js-nextStep">下一步</a>  </div>'};return e},editor_area:'<div class="searchTagsPanel" id="searchTagsPanel"></div>                <p class="c04 tc" id="infoErr"></p>',price_type_id:{1:'<div class="row soundPrice js-price-sound " > <div class="cell-1">声音单价<span class="c04">*</span></div> <div class="cell-2">   <input type="text" class="inputW3 tc mgr-5" id="price" name="singleTrackAlbum.price" maxlength="13">喜点/集   <span class="tips tips-hover">     <i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>   </span>   <p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p> </div></div><div class="row js-price-sound " > <div class="cell-1">折扣价</div> <div class="cell-2">   <input type="text" class="inputW3 tc mgr-5" id="discountprice" name="singleTrackAlbum.discountedPrice" maxlength="13">喜点/集   <span class="tips tips-hover">     <i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>   </span>   <p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p> </div></div>',2:'<div class="row js-price-album " > <div class="cell-1">专辑总价<span class="c04">*</span></div> <div class="cell-2">   <input type="text" class="inputW3 tc mgr-5" id="albumprice" name="wholeAlbum.price2" maxlength="13">喜点   <span class="tips tips-hover">     <i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>   </span>   <p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p> </div></div><div class="row js-price-album js-price-album2 " > <div class="cell-1">折扣价</div> <div class="cell-2">   <input type="text" class="inputW3 tc mgr-5" id="discountprice2" name="wholeAlbum.discountedPrice2" maxlength="13">喜点   <span class="tips tips-hover">     <i class="icon6 icon6-tips1 mgr-5"></i><span class="tips-cont">1喜点等于1元人民币呦~</span>   </span>   <p class="tips-error tips" data-def="温馨提示：定价过低收益可能为0（计算方式见<付费内容发布协议>）"></p> </div></div><div class="row js-price-album js-price-album2 "> <div class="cell-1">更新说明<span class="c04">*</span></div> <div class="cell-2">   <input class="inputW1" type="text" id="updatedescr" name="wholeAlbum.priceDescription">   <p class="tips mgt-5" data-def="请说明节目预计更新频率以及更新时间，供买方参考">请说明节目预计更新频率以及更新时间，供买方参考</p> </div></div><div class="row js-price-album js-price-album2 " > <div class="cell-1">预估总集数<span class="c04">*</span></div> <div class="cell-2">   <input type="text" class="inputW3 tc mgr-5" id="countsound" name="wholeAlbum.priceTrackCount" maxlength="13">集   <p class="tips-error tips mgt-5" data-def="编辑时不允许减少预估集数，请确保集数准确性哦~">编辑时不允许减少预估集数，请确保集数准确性哦~</p> </div></div><div class="row js-price-album " > <div class="cell-1">退款服务</div> <div class="cell-2"><p class="c02">理解并同意为满足退款条件的用户提供7天无忧退款权利</p> <span class="view-position j-is-refund-1"> 查看详细说明<span class="hover-detail widReset">  <img src="'+config.STATIC_PATH+'/css/img/pic_2.jpg"> </span> </span>'+"  </div>"+"</div>"+'<div class="row js-price-album">'+'    <div class="cell-1">专辑简介<span class="c04">*</span></div>'+'    <div class="cell-2 pay-album-intro">'+'      <p class="c02">认真填写呦，精彩的介绍会吸引更多听众购买~</p>'+"      <!-- s: 简介配图 -->"+'      <div class="row js-album-moreintro">'+'        <lable>简介配图<span class="c04">*</span></lable>'+'        <div id="introImageWrap" class="imageWrap">'+'          <div class="imgBox2">'+'            <div class="imgItem">'+'              <img src="'+config.STATIC_PATH+'/css/img/common/default/album-intro.png">'+'              <input type="hidden" name="wholeAlbum.detailCoverPath" required>'+'              <div class="imgLoading"></div>'+"            </div>"+"          </div>"+"        </div>"+'        <p class="mgt-5">'+'          <a class="btn btn-secondary btn-upload" id="introPicBtn" href="javascript:;"><i class="icon icon-10 icon-upload1"></i> 上传图片</a>'+'          <span class="tips">请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M</span>'+"        </p>"+"      </div>"+"      <!-- e: 简介配图 -->"+"      <!-- s: 主讲人 -->"+'      <div class="row js-album-moreintro" data-name="主讲人">'+'    <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : true}"  data-name="wholeAlbum.personalDescription" value="">'+'        <lable>主讲人<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="wholeAlbum.personalDescription"></textarea>'+'          <p class="tips" data-def="演播人员介绍，最多可填写500个汉字">演播人员介绍，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 主讲人 -->"+"      <!-- s: 简介 -->"+'      <div class="row js-album-moreintro"  data-name="简介">'+'    <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500,&quot;minSizeLimit&quot;:100, &quot;must&quot; : true}" name="intro" data-name="intro" value="">'+'        <lable>简介<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="richIntro"></textarea>'+'          <p class="tips js-intro-min-size-tips" data-def="专辑内容概括性介绍，请尽量精简易懂，最多可填写500个汉字">专辑内容概括性介绍，请尽量精简易懂，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 简介 -->"+"      <!-- s: 大纲 -->"+'      <div class="row js-album-moreintro" data-name="大纲">'+'    <input  type="hidden"  data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : false}"  data-name="wholeAlbum.outline" value="">'+"        <lable>大纲</lable>"+'        <div class="">'+'          <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="wholeAlbum.outline"></textarea>'+'          <p class="tips" data-def="填写专栏更新内容大纲，最多可填写500个汉字">填写专栏更新内容大纲，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 大纲 -->"+"      <!-- s: 大咖推荐 -->"+'      <div class="row js-album-moreintro" data-name="大咖推荐">'+'    <input  type="hidden"  data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : false}"  data-name="wholeAlbum.masterRecommend" value="">'+"        <lable>大咖推荐</lable>"+'        <div class="">'+'          <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="wholeAlbum.masterRecommend"></textarea>'+'          <p class="tips" data-def="专栏大咖推荐语，最多可填写500个汉字">专栏大咖推荐语，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 大咖推荐 -->"+"      <!-- s: 购买须知 -->"+'      <div class="row js-album-moreintro" data-name="购买须知">'+'    <input  type="hidden" required data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : true}" data-name="wholeAlbum.buyNotes" value="">'+'        <lable>购买须知<span class="c04">*</span></lable>'+'        <div class="">'+'          <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="wholeAlbum.buyNotes"></textarea>'+'          <p class="tips" data-def="填写注意事项、更新频率和福利活动等，最多可填写500个汉字">填写注意事项、更新频率和福利活动等，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 购买须知 -->"+"      <!-- s: 制作团队 -->"+'      <div class="row js-album-moreintro" data-name="制作团队">'+'    <input  type="hidden"  data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : false}"  data-name="wholeAlbum.produceTeam" value="">'+"        <lable>制作团队</lable>"+'        <div class="">'+'          <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="wholeAlbum.produceTeam"></textarea>'+'          <p class="tips" data-def="专栏制作团队介绍，最多可填写500个汉字">专栏制作团队介绍，最多可填写500个汉字</p>'+"        </div>"+"      </div>"+"      <!-- e: 制作团队 -->"+'  <div class="js-album-moreintro js-otherDesc" data-name="其他说明">'+"       <!-- s: 编辑状态加 is-edit -->"+'       <div class="other-explain">'+'         <span class="unedit">'+'           <span class="js-otherDescTitle">其他说明</span><a class="btn1 mgl-10" title="编辑"><i class="iconfont icon-edit"></i></a>'+"         </span>"+'         <span class="edit">'+'           <input class="input-edit-other" type="text" name="wholeAlbum.otherTitle" id="other_title" value="其他说明"><a class="btn btn-primary btn-sm3 mgl-5 js-sure-edit">确认</a><a class="btn-sm3 js-cancel-edit">取消</a>'+'           <span class="tips hidden"></span>'+"         </span>"+"       </div>"+'    <input  type="hidden" data-params="{&quot;maxSizeLimit&quot;:500, &quot;must&quot; : false}" data-name="wholeAlbum.otherContent" value="">'+"       <!-- e: 编辑状态加 is-edit -->"+'       <div class="">'+'         <div class="textarea-shou"></div>'+'      <textarea style="display:none;" id=""  rows="10" cols="30" name="wholeAlbum.otherContent"></textarea>'+'         <p class="tips" data-def="其他说明事项（标题可自定义，不超过10个字），最多可填写500个汉字">其他说明事项（标题可自定义，不超过10个字），最多可填写500个汉字</p>'+"       </div>"+"     </div>"+"    </div>"+"  </div>"},one_intro:'<div class="row">     <div class="cell-1">专辑简介</div>     <div class="cell-2 textarea-wrapper">       <input id="description" type="hidden" name="introImages" value="">       <input id="description" data-params="{&quot;maxSizeLimit&quot;:3000 , &quot;minSizeLimit&quot;:100, &quot;must&quot; : false}" type="hidden" name="intro" data-name="intro" value="">       <p class="placeholder">这档节目讲了什么？简单介绍一下吧~</p>       <textarea id="" rows="10" cols="30" name="richIntro"></textarea>                      <span class="tips hidden fr js-intro-min-size-tips">加油，还差<span class="c04">100</span>个字！</span>     </div>   </div>'};return e}),define("page/upload/form_check",["jquery","underscore"],function(e,t){var n={checkApi:function(t,n){var r={title:1,intro:3,track:4},i=e.Deferred(),s={text:t,strType:r[n],scene:"create"};return e.ajax({type:"post",url:"/center/help/text-check",data:s,success:function(e){e.res?i.resolve(e):i.reject(e)}}),i},titleStandard:function(e){function s(t){n.addClass("is-error"),e.attr("is-lock","true"),r.text(t)}function o(){n.removeClass("is-error"),e.removeAttr("is-lock"),r.text("")}function u(e){var t=e.target.value;i.checkApi(t,"track").then(function(e){o()}).fail(function(e){s(e.msg)})}var n=e.parent(),r=e.siblings(".tips"),i=this;e.on("input",t.debounce(u,300))},introStandard:function(t){function i(n){var i=r.find("span.tips").length?r.find("span.tips"):r.find("p.tips");i.size()==0&&(i=e('<span class="tips"></span>'),r.append(i)),r.addClass("is-error"),t.attr("is-lock","true"),i.html(n)}function s(){var e=r.find("span.tips").length?r.find("span.tips"):r.find("p.tips");e.remove(),t.removeAttr("is-lock")}function o(e){var t=e.target.value;n.checkApi(t,"intro").then(function(e){s()}).fail(function(e){i(e.msg)})}var n=this,r=t.parent();t.on("check_intro_standard",o)}};return n}),define("page/center/albumValidateUtils",["jquery","underscore","plugin/pops","module/album-end","page/upload/form_check"],function(e,t,n,r,i){var s={_validateTitleIegalFn:function(){function g(t,i,s,u){if(i=="")return;var a=n.enterType,f={title:i,checkScene:a,albumId:s};e.ajax({url:"/center/help/title-check",data:f,type:"GET",success:function(e){e.res?(o.setRight(t,u),t.removeClass("is-error")):(o.setError(t,e.msg),y(t),r.init(t.find(".j-finished-album")))}})}function y(e){var t=e.find("input"),n=t.data("url"),r=t.data("apply"),i=t.data("status"),s=t.data("album-url"),o=e.find("a.j-finished-album");o.attr("data-url",n).attr("data-apply",r).attr("data-status",i).attr("data-album-url",s),i=="finished"?o.text("已完结"):""}function b(e,t){var n=e.replace(/[\u0391-\uFFE5]/g,"aa");return n.length<=t}var n=this,i=e(".js-"+this.enterType+"album-form"),s=i.find("#title"),u=i.find("#genre"),a=i.find("#genre_sub"),f=e("[name=richIntro]"),l=e("[name=intro]"),c=e("[name=albumId]").val(),h=15,p={_commonTitle:function(e,t,n,r,i){var s=e.parent();if(e.length<=0)return!0;var u=e.val();return!u&&!i?(o.setError(s,n),!1):(r=r||h,b(u,r*2)?(o.setRight(s,t),g(s,u,c,t),!0):(tip="字数过多，请保持在"+r+"个字以内",o.setError(s,tip),!1))},title:function(){return this._commonTitle(s,"好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）","请为专辑加上标题")},subTitle:function(e,t,n){var r='  请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">查看展示位置       <span class="hover-detail"><img src="'+config.STATIC_PATH+'/css/img/pic.png"></span>'+"     </span>";return n=n||i.find(".sub_title:not('.j-destory')"),this._commonTitle(n,r,"请为专辑加上副标题",20,t)}},d=t.debounce(t.bind(p.title,p),300),v=t.debounce(t.bind(p.subTitle,p),300),m=!1;return i.on("compositionstart","#title,#sub_title",function(e){m=!0}),i.on("compositionend","#title,#sub_title",function(t){m=!1,e(this).trigger("input")}),i.on("input blur","#title",function(e){m||(e.type==="input"?d():p.title())}),i.on("input blur","#sub_title",function(t){if(!m){var n=!1;e(this).attr("data-require")==="false"&&(n=!0),t.type==="input"?v(!0,n,e(this)):p.subTitle(!0,n,e(this))}}),p},initPageToCheckTitle:function(){e("#title").trigger("input"),e("#sub_title").trigger("input")},_checkRichTextStandard:function(t){function r(t){var r=n.children(".js-richtext-tips");r.size()==0&&(r=e('<span class="c01 txt-sm fl mgr-20 js-richtext-tips"></span>'),n.append(r)),n.addClass("is-error"),r.html(t)}function s(){var e=n.children(".js-richtext-tips");e.remove()}var n=t.parent();i.checkApi(t.val(),"richtext").then(function(e){s()}).fail(function(e){r(e.msg)})}},o={setRight:function(e,t){e.find(".tips").end().removeClass("is-error");var n=e.find(".tips").attr("data-def");t=t||n,t=t||"",e.find(".tips").html(t)},setError:function(t,n){var r=t.find(".tips");r.html(n),t.addClass("is-error");var i=r.offset().top-200;e(document).scrollTop(i)}};return s}),define("module/album/integrity",["jquery","underscore","plugin/pops"],function(e,t,n){function r(e){xmLog("pv.send","event",{item:"button",serviceId:"pageClick",srcPage:"主播工作台",srcModule:"错失曝光量弹窗",itemId:"编辑"})}function u(e){this._ajaxData=e,this._baseData=this.baseData(e),this.dialog=null,this.init()}xmLog&&xmLog("pv.create",{item:"button"}),e("#edit_step3").on("click",".full-state .js-xmlog-a",function(t){var n=e(t.currentTarget);xmLog("pv.send","event",{item:"button",serviceId:"pageClick",srcPage:"主播工作台",srcModule:"专辑完整度",itemId:n.attr("xmlog-itemid")})}),e(".j-redirectBtn").on("click",function(e){xmLog("pv.send","event",{item:"button",serviceId:"pageClick",srcPage:"主播工作台",srcModule:"专辑完整度",itemId:"提升完整度"})});var i=window.top!=window.self?"&isPlug=true":"",s=t.template('<div class="full-state">  <span class="inl-b mgr-20">专辑完整度</span>  <div class="circle-bar inl-b">    <svg xmlns="http://www.w3.org/200/svg" height="90" width="90">      <circle cx="45" cy="45" r="35" fill="none" stroke="#F2F2F2" stroke-width="10" stroke-linecap="round"></circle>      <circle class="circle-bar_outer" cx="45" cy="45" r="35" fill="none" stroke="#42D087" stroke-width="10" stroke-dasharray="1, 10000"></circle>    </svg>    <div class="txtNum"> <%= integrity %> </div>  </div>  <div class="tree inl-b"></div>  <div class="tree-item inl-b">    <div class="item1">      <span class="item-name inl-b">专辑封面：</span>      <span class="item-tag inl-b <%= cover.color %> "> <%= cover.text %> </span>      <a href="<%= editLink %>" class="link1 <%= cover.showLink %> js-xmlog-a" xmlog-itemid="更换封面">继续完善</a>    </div>    <div class="item2">      <span class="item-name inl-b">专辑简介：</span>      <span class="item-tag inl-b <%= intro.color %>"><%= intro.text %></span>      <a href="<%= editLink %>" class="link1 <%= intro.showLink %> js-xmlog-a" xmlog-itemid="继续完善">继续完善</a>    </div>    <div class="item3">      <span class="item-name inl-b">专辑标签：</span>      <span class="item-tag inl-b <%= tag.color %> "><%= tag.text %> </span>      <a href="<%= editLink %>&stepId=2" class="link1 <%= tag.showLink %> js-xmlog-a" xmlog-itemid="继续完善">继续完善</a>    </div>  </div></div>'),o=t.template('<i class="iconfont icon-ic_x fr"></i><h3>即将错失5000曝光量</h3><p class="identy-txt">专辑完整度仅<%= integrity %>，离开将失去5000曝光量哦，继续编辑吗？</p><div class="button">  <a class=" pre inl-b " href="<%= albumLink %>" target="_parent">放弃</a>  <a class="inl-b mgr-20 " href="<%= editLink %>">编辑</a></div>');return u.prototype={constructor:u,init:function(e){this.generatorTem(this._ajaxData),this.dialog=new n.Modal({containerClass:"maskers hidden",dialogClass:"identy-pop hidden",closeBtn:"iconfont icon-ic_x fr",template:o(this._baseData)}),this.bindEvents()},baseData:function(){var e=this._ajaxData,t={cover:{color:e.isCoverUpload?"":"orange",text:e.isCoverUpload?"已上传":"未上传",showLink:e.coverScore==100?"hidden":""},intro:{color:e.introScore==100?"":"orange",text:e.introLength+"字",showLink:e.introScore==100?"hidden":""},tag:{color:e.tagScore==100?"":"orange",text:e.tagIntegrity+"%",showLink:e.tagScore==100?"hidden":""},integrity:e.integrity+"%",editLink:"/center/myAlbum/edit/?albumId="+e.id+i,albumLink:e.albumLink};return t},generatorTem:function(){var t=s(this.baseData());return this._baseData.integrity=="100%"?e(".j-redirectBtn").hide():"",e(".set-suc").after(t),this.rotateCircle(this._baseData.integrity),t},rotateCircle:function(e){var t=document.querySelector(".circle-bar_outer"),n=(2*Math.PI*t.getAttribute("r")).toFixed(2),e=parseFloat(e).toFixed(2);t.setAttribute("stroke-dasharray",n*e/100+", 10000")},bindEvents:function(t){function a(){return window.location.pathname.indexOf("create")!==-1}var n=this,i=e(".j-checkBtn"),s=e(".j-redirectBtn"),o=this._baseData.editLink,u=this._baseData.albumLink;s.attr("href",o),i.attr("href",u),i.off().on("click",function(){if(!a()||e(this).attr("data-albumclick")=="true"||n._baseData.integrity=="100%")return;return n.dialog.open(r),a()&&e(this).attr("data-albumclick","true"),!1})}},u}),define("page/center/albumHelper",["jquery","page/center/createAlbumHtml","page/center/albumValidateUtils","module/album/integrity","module/album/tags","module/common/form_editor","module/common/form_uploadimg","module/dialogs/albumPreview","module/player/player","plugin/dialog","plugin/jquery.selecter","plugin/jquery.input"],function(e,t,n,r,i,s,o,u,a,f){function x(e,t){var n=e.replace(/[\u0391-\uFFE5]/g,"aa");return n.length<=t}function N(e){if(e===undefined||e===null)throw new TypeError("cannot covert undefined or null to object");var t=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==undefined&&r!==null)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}var l=l||{},c=l&&l.categories||{},h=l&&l.music_categories||{},p=l&&l.positive_sort_categories||{},d=l&&l.priceTypes||[],v=null,m="/operation_tagging/get_tags_by_category_id",g,y,b,w={renderTagsForEdit:function(){var t=/[\?\&]albumId=(\d+)/g.exec(window.location.search)[1],n="/operation_tagging/get_tags_by_album_id?album_id=";this.formEditor=new s(e("#mainbox form"),{allowEditorLink:b}),this.formUploadimg=new o(e("#mainbox form")),this.albumTags=new i("#searchTagsPanel",{requestUrl:n+t}),this.checkInfo=this._validateTitleIegalFn(),this.formUploadimg.uploadImgInit()},bindStep1RichEditForEdit:function(){var t=this,n=15;e(".js-album-moreintro").length?t.formUploadimg.uploadImgInit({picBtn:e("#introPicBtn"),imgWrap:e("#introImageWrap"),limitWidth:1250,limitHeight:1e3,tips:'请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M'}):(e('input[name="intro"]').attr("data-name","intro"),t.formEditor.initRichEditor({name:"intro",richName:"richIntro",isShowText:!0,syncSize:!0,onblur:function(t){}}),t.formEditor.flushIntoSize(e('input[name="intro"]'),n,3e3,!1)),e(".js-album-moreintro").each(function(){var n=e(this).find("input[data-params]").attr("data-name");if(!n)return;var r=e(this).find("textarea[name]").attr("name"),i=e(this),s=e(this).find("textarea[name]").val();s=s.replace(/(\s|\r|\n)*(<(br|\/?span)\s*\/?>)(\s|\r|\n)/g,function(e,t,n,r){return n}),e(this).find("textarea[name]").text(s),t.formEditor.initRichEditor({name:n,richName:r,isHidden:!0,isShowText:!1,syncSize:!0,items:["b","customimage","blockquote","customlink"],onblur:function(){if(this.xmDialogShow)return;this.sync();var e=this.text(),t=i.find("input[data-params]").attr("name");t!=n&&i.find("input[data-params]").val(e),setTimeout(function(){e||(i.find(".ke-container").hide(),i.find(".textarea-shou").show())},100)},onchange:function(){var e=i.find(".tips");e.length>0&&e[0].style.color=="red"&&e.removeAttr("style")}})})}},E={removePaidDomForCreate:function(){d.length||(e("[name='isPaid']").parents(".row").remove(),e(".js-price-paytype").remove(),e(".js-price-album").remove(),e(".soundPrice").remove()),d.length==1&&d[0][0]==1&&e(".soundPrice").remove(),d.length==1&&d[0][0]==2&&e(".js-price-album2").remove()},getCreateAlbumDataForCreate:function(){var t=this;e.ajax({type:"GET",url:"/center/myAlbum/getNewAlbumFormData"+(t.isVip?"?entrance=membership":""),success:function(e){e.res?t.renderStep1ForCreate(e):f.alert("数据加载失败！")},error:function(){f.alert("数据加载失败！")}})},renderStep1ForCreate:function(n){var r=this;d=n.priceTypes||[],c=n.categories,recommend_tags=n.recommend_tags,h=n.music_categories,p=n.positive_sort_categories,g=n["default"].album_cover_url,b=n.allowEditorLink,v=n.isMusician;var i=e(".js-step1-tb"),u=t.editor_area;html=this._parseTemplate(),i.html(html),this.$cform=e(".js-createalbum-form");var a=e("#sub-main-box");this.$el=a,this._initSoundPaster(),this._initCategories(),this._bindEvents(a),this.formEditor=new s(this.$cform,{allowEditorLink:b}),this.formUploadimg=new o(this.$cform),this.checkInfo=this._validateTitleIegalFn(),this.formUploadimg.uploadImgInit(),a.find("#album_cover_url").attr("src",g),this.rich_editor_intro=this.formEditor.initRichEditor({name:"intro",richName:"richIntro",isShowText:!0,syncSize:!0,onblur:function(t){}}),this.isVip&&this._initVip()},_initSoundPaster:function(){var t=this;e.ajax({url:"/center/myAlbum/queryVoiceTemplates",dataType:"json",success:function(e){if(e.res){var n=e.templates,r=[];for(var i=0;i<n.length;i++){var s=n[i];r.push('<div><label class="xm-radio mgb-10"> <input type="radio" name="templateTrack" value="'+s.id+'">'+'    <div class="smallPlayer" sound_extension="true" sound_id="upload_'+(i+11)+'" sound_url="'+s.url+'">'+'        <a href="javascript:;" class="playBtn"></a>'+"    </div>"+'    <span class="tips">'+s.name+"</span>"+"</label></div>")}r.push('<p class="tips mgt-5"></p>');var o=t.$cform.find(".pay-album-intro");o.append(r.join("")),o.find("input").beautify().on("change",function(){o.find("p.tips").html("").end().removeClass("is-error")}),a.render({$container:t.$cform.find(".smallPlayer")})}}})},_initCategories:function(){var e='<li class="selecter-item" data-value="${id}">${title}</li>',t="";for(var n=0,r=c.length;n<r;n++){var i=c[n];t+=e.replace(/\$\{([^\}]*)\}/g,function(e,t){var n="";for(var r in i)r==t&&(n=i[r]);return n})}this.$cform.find("#genre ul").empty().append(t),e='<li class="selecter-item" data-value="${title}">${title}</li>';var s="";for(var n=0,r=h.length;n<r;n++){var o=h[n];s+=e.replace(/\$\{([^\}]*)\}/g,o)}this.$cform.find("#genre_sub ul").empty().append(s),e='<li class="selecter-item ${selected}" data-value="${id}" >${title}</li>';var u="";for(var n=0,r=d.length;n<r;n++){var a=d[n],f={id:a.typeId,title:a.typeName,selected:""};this.isVip&&f.id==3&&(f.selected="selected"),u+=e.replace(/\$\{([^\}]*)\}/g,function(e,t){var n="";for(var r in f)r==t&&(n=f[r]);return n})}this.$cform.find("#price_type_id ul").empty().append(u)},_parseTemplate:function(e){var t=this._getTemplate();for(var n in e){var r=new RegExp("\\$\\{("+n+")\\}");t=t.replace(r,function(t,r){if(n==r)return e[n]})}return this.template=t,this.template},_getTemplate:function(){var e=t.fromTemplate();this.template="";for(var n in e)this.template+=e[n];return'<div class="tb-1">'+this.template+"</div>"},_initVip:function(){this.$cform.find('[name="isPublic"][value="0"]').parent().click().parents(".row").addClass("hidden"),this.$cform.find('[name="isPaid"][value="1"]').parent().click().siblings().addClass("hidden")},_calcuComleteForSetp3:function(t,n){var r=/&image=([^&]+)/gi.exec(t)?!0:!1,i=this.formEditor.getCount(this.formEditor.richEditor.intro),s=e("#create_step2").find(".js-competePer").text(),o=e(".j-imagePre"),u=e(".j-introPre"),a=e(".j-tagPre"),f=n.redirect_to.split("/").pop(),l="/center/myAlbum/edit/?albumId="+f;r?o.find(".item-tag").text("已上传").removeClass("orange").siblings("a").addClass("hidden"):o.find(".item-tag").text("未上传").addClass("orange").siblings("a").attr("href",l).removeClass("hidden"),u.find(".item-tag").text(i+"字").addClass("orange").siblings("a").attr("href",l).removeClass("hidden"),s==="100%"?a.find(".item-tag").text(s).removeClass("orange").siblings("a").addClass("hidden"):a.find(".item-tag").text(s).addClass("orange").siblings("a").attr("href",l+"&stepId=2").removeClass("hidden"),e(".j-redirectBtn").attr("href",n.redirect_to)}},S=function(e){this.enterType=e.enterType,b=e.allowEditorLink;if(window.opener&&window.opener.$openParams){var t=JSON.parse(window.opener.$openParams);t.isVip&&(this.isVip=t.isVip)}};S.prototype={constructor:S,isCreateEnter:function(){return this.enterType==="create"},isEditEnter:function(){return this.enterType==="edit"},initPage:function(){this._renderPageDom()},_renderPageDom:function(){var n=this,r=e(".js-step1-tb"),i=e(".js-step2-tb"),s=t.editor_area;this.isCreateEnter()&&this.getCreateAlbumDataForCreate(),i.html(s),this.isEditEnter()&&(this.renderTagsForEdit(),this._bindEvents(e("#sub-main-box")))},_bindEvents:function(n){function a(n){var i=n,o={1:"1",2:"2",4:"1",5:"2"};e(".js-paytype-rows").html(t.price_type_id[o[i]]||""),i==="2"?e(".js-payRange").removeClass("hidden"):e(".js-payRange").addClass("hidden");if(i==="1"||i==="4")r.formEditor.richEditor.intro&&r.formEditor.richEditor.intro.remove(),e(".js-intro-row").html(t.one_intro),r.formEditor.initRichEditor({name:"intro",richName:"richIntro",isShowText:!0,syncSize:!0,onblur:function(e){}}),r.albumPreview.btnHide(s);else if(i==="2"||i==="5")r.albumPreview.btnShow(s),r.formEditor.richEditor.intro&&r.formEditor.richEditor.intro.remove(),e(".js-intro-row").empty(),r.formUploadimg.uploadImgInit({picBtn:e("#introPicBtn"),imgWrap:e("#introImageWrap"),limitWidth:1250,limitHeight:1e3,tips:'请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M'}),e(".js-album-moreintro").each(function(){var t=e(this).find("input[data-params]").attr("data-name");if(!t)return;var n=e(this).find("textarea").attr("name"),i=e(this);r.formEditor.initRichEditor({name:t,richName:n,isHidden:!0,isShowText:!1,syncSize:!0,items:["b","customimage","blockquote","customlink"],onblur:function(){if(this.xmDialogShow)return;this.sync();var e=this.text(),n=i.find("input[data-params]").attr("name");n!=t&&i.find("input[data-params]").val(e);var r=i.attr("data-showedit");setTimeout(function(){!e&&r!="true"?(i.find(".ke-container").hide(),i.find(".textarea-shou").show()):(i.find(".ke-container").show(),i.find(".textarea-shou").hide())},100)},onchange:function(){var n=t,r=e('[name$="'+n+'"]').siblings(".tips");r.length>0&&r[0].style.color=="red"&&r.removeAttr("style")}})});e(this).parents(".is-error").removeClass("is-error").find(".tips").html("")}function l(t){var n=t.value,r=/^\d{1,10}(\.\d{1,2})?$/,i=parseFloat(n);if(!r.test(n)||i<=0)return e(t).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("请输入十位以内的数字,可保留两位小数,最小值0.01"),!1;n&&e(t).val(parseFloat(n));var s="";return parseFloat(n)<.1&&parseFloat(n)>=.01&&(s=e(t).parent().removeClass("is-error").find(".tips-error").attr("data-def")||""),e(t).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html(s),!0}var r=this,s=n.find("#albumPreview");this.$el=n,this.$cform=e(".js-"+this.enterType+"album-form"),this.isEditEnter()&&this.bindStep1RichEditForEdit(),this.isCreateEnter()&&this.removePaidDomForCreate(),n.find("#genre").selecter({onChange:function(t){var s=n.find("#genre_sub").parent(".cell-2");if(t==2){n.find("#genre_sub").removeClass("hidden");if(v!==null&&!v){var o='<p class="" id="musician-tips"><a href="http://form.mikecrm.com/0u7Pb7" class="link-red" target="_blank">认证音乐人，享受更多权利>></a></p>';s.append(o)}}else n.find("#genre_sub").addClass("hidden"),s.find("#musician-tips").remove();n.find("#genre_sub").parent().removeClass("is-error"),r.albumTags=null,r.albumTags=new i("#searchTagsPanel",{requestUrl:m+"?category_id="+t});if(p&&p.length){var u;for(u=0;u<p.length;u++)if(t==p[u]){e(".js-order-z").parent().click();break}u==p.length&&e(".js-order-d").parent().click()}}}),n.find("#genre_sub").selecter();if(this.isCreateEnter())n.find("#price_type_id").selecter({onChange:a}),n.find("#genre_sub").selecter("val",h[0]||"音乐类型"),this.isVip&&n.find("#price_type_id").selecter("val","3");else if(this.isEditEnter()){var o=n.find("#price_type_id");o.selecter();var u=o.selecter("val");o.on("change",function(){var e=o.selecter("val");if(e==4&&u==1||e==1&&u==4||e==5&&u==2||e==2&&u==5){u=e;return}u=e,a(e)})}n.find("input").beautify(),n.find('input[name="isPaid"]').on("change",function(){var i=this.value,s=0,o=n.find('input[name="isPaid"]:checked').attr("data-show");i!=="1"?(n.find(".js-copyright").find(".payment-agreement").remove(),n.find('[class*="js-price-paytype"]').addClass("hidden").find(".is-error").removeClass("is-error"),e(".js-paytype-rows").html(""),n.find('input[name="price_type_id"]:checked').removeAttr("checked").parent("label").removeClass("xm-is-checked"),n.find("#price_type_id").selecter("val",""),n.find("#price_type_id .selecter-text").text("请选择"),n.find("#albumPreview").addClass("hidden"),s=15,r.formEditor.richEditor.intro&&r.formEditor.richEditor.intro.remove(),e(".js-intro-row").html(t.one_intro),r.formEditor.initRichEditor({name:"intro",richName:"richIntro",isShowText:!0,syncSize:!0,onblur:function(t){}}),n.find(".js-is-public").removeClass("hidden"),n.find(".sub_title").addClass("j-destory"),n.find(".js-free-sub-title-contrain").removeClass("hidden").find(".sub_title").removeClass("j-destory")):(n.find(".js-copyright").append(e('<a class="a_tdu apply_deal  payment-agreement" target="_blank" href="/upload/paid_content_distribution_rule"><span class="c06"> 和 </span>付费内容发布协议</a>')),n.find(".sub_title").removeClass("j-destory"),n.find(".js-free-sub-title-contrain").addClass("hidden").find(".sub_title").addClass("j-destory"),n.find("."+o).removeClass("hidden"),n.find(".js-is-public").addClass("hidden").find("label:eq(0)").click(),s=100),T.setRight(e(this).parents(".cell-2")),r.formEditor.flushIntoSize(e('input[name="intro"]'),s,3e3,!1)}),n.on("click",".textarea-shou",function(){var t=e(this).hide().parents(".js-album-moreintro");t.find(".ke-container").show(),r.formEditor.richEditor[t.find("input[data-params]").attr("data-name")].focus()}),n.on("change","#isSample,#eavesdropping",function(){var t=e(this).find("input:checked").val(),r=e(this).attr("data-wran-tips");if(e(this).find('input[name="isSample"]').length){var i=t?"removeClass":"addClass";n.find(".js-soundpaster")[i]("hidden")}t?n.find("."+r).addClass("hidden"):n.find("."+r).removeClass("hidden")}),n.on("click",".js-otherDesc .icon-edit",function(){e(".js-otherDesc .unedit").hide(),e(".js-otherDesc .edit").show()}),n.on("click",".js-otherDesc .js-sure-edit",function(){var t=e("#other_title").val(),n=e(this).siblings(".tips"),r=e(this).parents(".js-album-moreintro"),i=!1;e.trim(t)||(r.addClass("is-error"),n.html("标题可自定义，不能为空").show(),i=!0),x(t,20)||(r.addClass("is-error"),n.html("标题可自定义，不能超过10个汉字").show(),i=!0);if(!!i)return!1;n.html("标题可自定义，不能超过10个汉字").hide(),e(".js-otherDesc .unedit").show(),e(".js-otherDesc .edit").hide(),e(".js-otherDesc").attr("data-name",e("#other_title").val()),e(".js-otherDescTitle").text(e("#other_title").val())}),n.on("click",".js-otherDesc .js-cancel-edit",function(){var t=e(this).siblings(".tips");e(".js-otherDesc .unedit").show(),e(".js-otherDesc .edit").hide();var n=e(".js-otherDesc").attr("data-name");e("#other_title").val(n),t.hide()});var f=function(t){var n=e.trim(this.value);if(n==="")n=0;else if(!l(this))return!1;parseFloat(n)>=parseFloat(t)?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("折扣价不能大于或等于原价哦"):e(this).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html("")};n.on("blur focus","#price",function(){l(this),f.call(n.find("#discountprice")[0],e(this).val())}).on("blur focus","#albumprice",function(){l(this),f.call(n.find("#discountprice2")[0],e(this).val())}).on("blur focus","#discountprice2",function(){f.call(this,n.find("#albumprice").val())}).on("blur focus","#discountprice",function(){f.call(this,n.find("#price").val())}),n.on("keyup","#updatedescr",function(){var t=this.value;defTip=e(this).parent().removeClass("is-error").find(".tips").attr("data-def")||"",x(t,20)?e(this).parent().removeClass("is-error").find(".tips").addClass("c02").removeClass("c01").html(defTip):T.setError(e(this).parent(),"字数不能超过10字",!0)}),n.find("#countsound").attr("data-origin",n.find("#countsound").val()),n.on("keyup","#countsound",function(){var t=e(this).attr("data-origin");t!==""&&(t=parseInt(t));var n=this.value,i=parseFloat(n),s=/^\d{1,10}?$/,i=parseInt(n);defTip=e(this).parent().removeClass("is-error").find(".tips").attr("data-def")||"",r.isEditEnter()&&i<t?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("所填数字须大于或等于当前预估总集数哦~"):!s.test(n)||i<=0?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("请输入十位以内的正整数"):(n&&e(r).val(parseFloat(n)),e(this).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html(defTip))}),s.on("click",function(){r.albumPreview.preview(n)}),e(".js-nextStep").on("click",function(t){t.preventDefault();var n=r._validateStepOne.call(r);r.isEditEnter()&&e(".js-tags-selecter-chosen_area").trigger("change")}),e(".j-backStep").on("click",function(t){t.preventDefault();if(r.isCreateEnter()){var n='<input class="inputW1 sub_title "  id="sub_title" name="customTitle" type="text">',i=[e(".js-sub-title-contrain"),e(".js-free-sub-title-contrain")];e.each(i,function(e,t){var r=t.find(".cell-2");t.hasClass("hidden")&&r.children(":first").is("p")?r.prepend(n):""})}r.showStepDom("step1")}),e("#searchTagsPanel").on("change",".js-tags-selecter-chosen_area",function(t){var n=e("#searchTagsPanel .more-cont .row"),i=r.albumTags.getData(),s=0,o=0;n.each(function(t){e(this).hasClass("hidden")?"":s++}),e.each(i,function(e,t){o++});if(s!==0){var u=(o/s*100).toFixed(0);e(".set-panel").find(".redBar").css("width",u+"%"),e(".js-competePer").text(u+"%"),e(".js-lackPer").text("还差"+(100-u)+"%")}}),e(".j-protocol").on("click",function(){e(this).toggleClass("xm-is-checked");var t=!e(this).find("#agreeDeal:checked").length;e(".album-"+r.enterType+"Btn").toggleClass("disabled-white",t)}),e(".album-"+this.enterType+"Btn").on("click",function(t){t.preventDefault();if(e(this).hasClass("disabled-white"))return;var n=r.albumTags.pass();tagsData=r.albumTags.getData();var i=e.isEmptyObject(tagsData);if(n)return r.$cform.find("#infoErr").text(n),!1;if(i)return r.$cform.find("#infoErr").text("标签不能为空~"),!1;r._doSubmit()})},_doSubmit:function(){if(this.$cform.find(".is-error").length>0){var t=this.$cform.find(".is-error").first();return this.showStepDom("step1"),T.setError(t),!1}var n=this,r=this.$cform,i=this.isCreateEnter()?"/center/myAlbum/createAlbum":"/center/myAlbum/updateAlbum";if(this.ajax_loading)return;this.ajax_loading=!0;var s=this.$cform.serialize(),o=e(".album-"+this.enterType+"Btn");o.addClass("is-loading").text("保存中..."),this.isVip&&(s+="&entrance=membership"),e.ajax({url:i,data:s,type:"POST",success:function(t){t.res?(e(".j-redirectBtn").attr("href",t.redirect_to),n.showStepDom("step3"),n.handleIntegrity(t),window.opener&&window.opener.$emit&&(window.opener.$emit("albumResult",t),self.close()),n.destroy()):(o.removeClass("is-loading").text("保存修改"),n._locationSubmitMsgInput(t)),n.ajax_loading=!1},error:function(){n.ajax_loading=!1,n.$cform.find("#infoErr").css({color:"red"}).html("服务器未知错误"),o.removeClass("is-loading").text("保存中...")}})},_validateStepOne:function(){var t=this,n=t.$cform.find('input[name="title"]'),r=t.$cform.find('input[name="image"]'),i=t.$cform.find('input[name="isPaid"]:checked'),s=t.$cform.find('input[name$="priceTypeMask"]'),o=t.$cform.find("#albumprice"),u=t.$cform.find("#price"),a=t.$cform.find("#updatedescr"),f=t.$cform.find("#countsound"),l=t.$cform.find('input[name="intro"]');n.val(e.trim(n.val()));if(n.val()=="")return T.setError(n.parent(),"请为专辑加上标题",!0),!1;if(n.parent().hasClass("is-error"))return T.setError(n.parent()),!1;if(!r.val()&&e("#album_cover_url").attr("src").indexOf("album_100.jpg")>-1)return T.setError(r.parents(".cell-2"),"请上传图片",!0),!1;var c=t.$cform.find("#genre").selecter("val");if(c==""){var h=t.$cform.find('input[name="categoryId"]');return T.setError(t.$cform.find("#genre").parent()),!1}var p=function(t,n){if(e.trim(t.val())===""){t.parent().addClass("is-error");var r=t.parents(".cell-2"),i=r.find(".tips-error").length?r.find(".tips-error"):r.find(".tips");i.html(n+"不能为空")}t.parent(".is-error").length>0&&t.focus()};if(this.isCreateEnter()){if(d.length&&i.length===0)return T.setError(t.$cform.find('input[name="isPaid"]').parents(".cell-2"),"请选择是否付费",!0),!1;var v=t.$cform.find("#price_type_id").selecter("val");if(d.length&&i.val()==="1"&&v=="")return T.setError(t.$cform.find('input[name="priceTypeMask"]').parents(".cell-2"),"请选择售卖类型",!0),e(document).scrollTop(t.$cform.find("#price_type_id").offset().top-50),!1}if(this.isEditEnter()){var m=e('[name="customTitle"]');if(m.length&&e.trim(m.val())===""&&m.attr("data-require")!=="false")return T.setError(m.parent(),"请为专辑副标题加上标题",!0),!1}e(".js-sub-title-contrain").length&&!e(".js-sub-title-contrain").hasClass("hidden")&&t.checkInfo.subTitle(!0);var g=t.$cform.find('input[name="templateTrack"]:checked'),y=!!t.$cform.find('input[name="isSample"]:checked').length;if(i.val()==="1"&&y&&!g.length){var b=t.$cform.find('input[name="templateTrack"]').parents(".cell-2");return b.find("p.tips").html("请选择试听引导语").end().addClass("is-error"),b.find("input").focus(),!1}(s.val()=="1"||s.val()=="4")&&p(u,"声音单价");if(s.val()=="2"||s.val()=="5")p(o,"专辑总价"),p(a,"更新说明"),p(f,"预估总集数");var w=!1;e(".js-album-moreintro").each(function(){if(e(this).find("input[required]").length){var t=e(this).find("input[required]").val(),n=e(this).find("lable").text(),r="请填写"+n.replace("*","");n.indexOf("简介配图")!==-1&&(r="请上传简介配图");if(!e.trim(t))return e(this).addClass("is-error").find(".tips").html(r),e(document).scrollTop(e(this).offset().top-50),!1}});if(e.trim(l.val())!==""&&l.hasClass("is-error"))return l.focus(),!1;l.removeClass("is-error");if(t.$cform.find(".is-error").length>0){var E=t.$cform.find(".is-error").first();return T.setError(E),!1}return t.isCreateEnter()&&e(".j-destory").remove(),t.showStepDom("step2"),!1},_locationSubmitMsgInput:function(t){function u(){var t=i.siblings(".tips"),n=t.offset().top-200;t.html(o).css({color:"red"}),e(document).scrollTop(n)}var n=this.$cform,r=t.title;if(r==""&&t.msg!=""){f.alert(t.msg);return}var i=n.find('[name="'+r+'"]'),s=i[0].type=="textarea",o="文中含有敏感词，请修改";this.showStepDom("step1"),s?u():T.setError(i.parent(),o,!0)},destroy:function(){for(var e in y)y[e]=null},albumPreview:{btnShow:function(e){e.removeClass("hidden")},btnHide:function(e){e.addClass("hidden")},preview:function(e){var t={title:e.find("#title").val(),soundFace:e.find("#introImageWrap img").attr("src"),albumPrice:e.find("#albumprice").val()||0,discountPrice:e.find("#discountprice2").val()||0,countSound:e.find("#countsound").val()||0,otherTitle:e.find(".js-otherDescTitle").text()||""};u.pop(t)}},showStepDom:function(t){if(typeof t!="string")return;var n=new RegExp(t),r=this.enterType,i=[e("#"+r+"_step1"),e("#"+r+"_step2"),e("#"+r+"_step3")];for(var s=0;s<i.length;s++){var o=i[s],u=o.attr("id");n.test(u)?o.removeClass("hidden"):o.addClass("hidden")}e(document).scrollTop(0)},handleIntegrity:function(e){var t={};t=e.integrity,t.albumLink=e.redirect_to,new r(t)}};var T={setRight:function(e,t){e.find(".tips").end().removeClass("is-error");var n=e.find(".tips").attr("data-def");t=t||n,t=t||"",e.find(".tips").html(t)},setError:function(t,n){var r=t.find(".tips").last();r.html(n),t.addClass("is-error");var i=r.offset().top-200;e(window.top.document).scrollTop(i)}};return N(S.prototype,w,E,n),S}),define("page/center/createAlbum",["jquery","page/page_base","page/center/common","page/center/createAlbumHtml","page/center/albumHelper"],function(e,t,n,r,i){var s=t.extend({init:function(){xmLog&&xmLog("pv.create",{item:"专辑创建页"}),xmLog("pv.send","event",{serviceId:"viewitem",item:"专辑创建页"}),this.bindEvents(),n.init(),this.callParent("init");var e=new i({enterType:"create"});e.initPage()},bindEvents:function(){var t=e(".js-createalbum-form");t.on("click",".js-nextStep",function(){var t=e(this);xmLog("pv.send","event",{srcPage:"专辑创建页",item:"专辑标签页","function":"createAlbum",serviceId:"pageview"})}),t.on("click",".album-createBtn",function(){var t=e(this);xmLog("pv.send","event",{srcModule:"专辑创建页","function":"createAlbum",serviceId:"click"})})},release:function(){this.callParent("release")}}),o=new s;return o}),define("page/center/editAlbum",["jquery","page/page_base","page/center/common","page/center/createAlbumHtml","page/center/albumHelper","page/center/albumValidateUtils"],function(e,t,n,r,i,s){var o=e(".js-editalbum-form").find('[name="albumId"]').val(),u=t.extend({init:function(e){xmLog&&xmLog("pv.create",{item:"专辑编辑页"}),xmLog("pv.send","event",{serviceId:"viewitem",item:"专辑创建页",itemId:o,"function":"editAlbum"}),n.init(),this.bindEvents(),this.callParent("init");var t=e.allowEditorLink,r=new i({enterType:"edit",allowEditorLink:t});r.initPage(),s.initPageToCheckTitle()},bindEvents:function(){var t=e(".js-editalbum-form");t.on("click",".js-nextStep",function(){var t=e(this);xmLog("pv.send","event",{srcPage:"专辑编辑页",item:"专辑标签页","function":"editAlbum",serviceId:"pageview",srcPageId:o,itemId:o})}),t.on("click",".album-editBtn",function(){var t=e(this);xmLog("pv.send","event",{srcPage:"专辑标签页",srcModule:"保存","function":"eidtAlbum",serviceId:"click",srcPageId:o})})},release:function(){this.callParent("release")}}),a=new u;return a}),define("page/center/timePublish",["jquery","underscore","router","page/page_base","page/center/common","plugin/pops"],function(e,t,n,r,i,s){var o=t.template('<i class="icon9 icon-closed fr"></i><h3>确定删除定时任务?</h3><p class="mgt-20 txt-mid2">删除后不能恢复哦，需要您重新上传</p><div class="button wid-90"><a class="inl-b mgr-20 btn-com">删除</a><a class=" pre inl-b btn-cancel">取消</a></div>'),u=r.extend({init:function(){this.callParent("init"),i.init(),this.pageUrl=e("#taskList .input-search").data("url")||"",this.delTipModal=new s.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden",closeBtn:"icon-closed",template:o()}),this.bindEvents()},bindPageEvent:function(t){var n=e(".paging-bar"),r=n.find(".paging-num"),i=n.find(".page-num"),s=n.find(".page-btn"),o=parseInt(s.attr("max-size"));i.on("keyup",function(n){var r=e(this),i=parseInt(r.val());if(isNaN(i))return r.val(""),!1;console.log(o);if(i<1||i>o)return s.addClass("off"),!1;s.removeClass("off"),n.keyCode===13&&t(i)}),s.on("click",function(){var n=e(this),r=parseInt(i.val());if(n.hasClass("off"))return!1;t(r)}),r.on("click",function(){var n=e(this),r=n.data("index");return r?(t(r),!1):(console.error("paging-num has no attribute of data-index"),!1)})},bindEvents:function(){function l(e){var t=u.val(),r=i.pageUrl+"?toSub=true&page="+e;r=t?r+"&keyword="+t:r,t=encodeURIComponent(t);if(!i.pageUrl)return console.warn("serch input has no attribute of data-url"),!1;n.toPage(r,!0,"#sub-main-box")}var t=e("#taskList"),r=e(this.delTipModal.getEl()),i=this,s=r.find(".btn-cancel"),o=r.find(".btn-com"),u=t.find(".input-search"),a=t.find(".search-btn"),f=null;this.bindPageEvent(l),a.on("click",function(){l(1)}),u.on("keyup",function(t){var n=e(this);t.keyCode===13&&l(1)}),s.on("click",function(){i.delTipModal.close()}),t.on("click",".list-manager a[category=deleteTask]",function(){var t=e(this);f=t.data("task-id"),i.delTipModal.open()}),o.on("click",function(){e.ajax({url:"/center/timePublish/delete",method:"post",data:{task_id:f},success:function(e){e.res&&(i.delTipModal.close(),n.toPage(location.pathname,!0,"#sub-main-box"))}})})}});return new u}),define("page/center/albumIntegrity",["jquery","page/page_base","module/album/integrity"],function(e,t,n){var r=t.extend({init:function(){this.callParent("init"),this.bindEvents()},bindEvents:function(){var t=this,n=/albumId=(\d+)/g.exec(window.location.search)[1];this.getTagsByAlbumId(n).then(function(n){var r=t.filterData(n.metadataSummaryList),i=t.generateTemplate(r);e(".attr-tags-wrapper").html(i)}),e(".xm-progress-bar_inner").css({width:e(".xm-progress-bar").attr("data-rate")+"%"})},getTagsByAlbumId:function(t){var n=e.Deferred(),r="/operation_tagging/get_tags_by_album_id?album_id=",i=this;return e.ajax({url:r+t,type:"GET",dataType:"json",success:function(e){e?n.resolve(e.data):n.reject("Error")},error:function(){n.reject("Error")}}),n},filterData:function(e){function s(e){var t=[];for(var n=0;n<e.length;n++)(e[n].isSeclected||e[n].isSelected)&&t.push(e[n].displayValue||e[n].optionalValue);return t}var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r.isShow){var i={label:"",value:[]};i.label=r.metadataName,i.value=r.inputType!="4"?s(r.displayMetadataValues):s(r.optionalValues),r.textValue?i.value=i.value.concat(r.textValue):"",t.push(i)}}return t},generateTemplate:function(e){var t='<a class="tagBtn3"><span>${value}</span></a>',n='<span class="empty">${value}</span>',r='<div class="row">  <div class="cell-1">${label}</div>  <div class="cell-2">${inner}</div></div>',i="";for(var s=0;s<e.length;s++){var o=e[s];i+=this.parseTpl(r,"label",o.label);var u="";for(var a=0;a<o.value.length;a++){var f=e[s].value[a];u+=this.parseTpl(t,"value",f)}o.value.length===0?u+=this.parseTpl(n,"value","未填"):"",i=this.parseTpl(i,"inner",u)}return i},parseTpl:function(e,t,n){var r=e,i=new RegExp("(\\$\\{"+t+"\\})","g");return r=e.replace(i,n),r},release:function(){this.callParent("release"),follow.release()}});return new r}),define("plugin/jquery.menu-aim",["jquery"],function(e){function t(t){var n=e(this),r=null,i=[],s=null,o=null,u=e.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:e.noop,exit:e.noop,activate:e.noop,deactivate:e.noop,exitMenu:e.noop},t),a=3,f=30,l=function(e){i.push({x:e.pageX,y:e.pageY}),i.length>a&&i.shift()},c=function(){o&&clearTimeout(o),u.exitMenu(this)&&(r&&u.deactivate(r),r=null)},h=function(){o&&clearTimeout(o),u.enter(this),m(this)},p=function(){u.exit(this)},d=function(){v(this)},v=function(e){if(e==r)return;r&&u.deactivate(r),u.activate(e),r=e},m=function(e){var t=g();t?o=setTimeout(function(){m(e)},t):v(e)},g=function(){function d(e,t){return(t.y-e.y)/(t.x-e.x)}if(!r||!e(r).is(u.submenuSelector))return 0;var t=n.offset(),o={x:t.left,y:t.top-u.tolerance},a={x:t.left+n.outerWidth(),y:o.y},l={x:t.left,y:t.top+n.outerHeight()+u.tolerance},c={x:t.left+n.outerWidth(),y:l.y},h=i[i.length-1],p=i[0];if(!h)return 0;p||(p=h);if(p.x<t.left||p.x>c.x||p.y<t.top||p.y>c.y)return 0;if(s&&h.x==s.x&&h.y==s.y)return 0;var v=a,m=c;u.submenuDirection=="left"?(v=l,m=o):u.submenuDirection=="below"?(v=c,m=l):u.submenuDirection=="above"&&(v=o,m=a);var g=d(h,v),y=d(h,m),b=d(p,v),w=d(p,m);return g<b&&y>w?(s=h,f):(s=null,0)};n.mouseleave(c).find(u.rowSelector).mouseenter(h).mouseleave(p).click(d),e(this).mousemove(l)}e.fn.menuAim=function(e){return this.each(function(){t.call(this,e)}),this}}),define("page/discovery/album_sound",["jquery","page/page_base","underscore","plugin/jquery.menu-aim"],function(e,t,n){var r=t.extend({url_tag:"/explore/tag_list",container:"#discoverSound",initCommon:function(t){this.callParent("init",[t]),this.$container=e(this.container),this.$tagWrap=e(".tag_wrap"),this.category_text="",this.bindEvents()},initBg:function(){this.$el.parent().attr("class","bodyBgColor2")},createTags:function(t,n){var r=this,i=this.data.category,s=this.$tagWrap.find("[data-cache="+i+"]");if(s.size()>0){this.$tagWrap.children().hide(),s.show(),r.resetTagsTop(t,n);return}return},resetTagsTop:function(t,n){var r=this.$tagWrap,i=r.parent();if(t>=3){var s=t*n,o=i.closest("ul").position().top,u=i.height(),a=e(window).height(),f=e(document).scrollTop();s+o+u>f+a&&(s=f+a-u-o),i.css("top",s)}else i.css("top",0)},release:function(){this.unbindEvents(),this.index_load=null},render:function(){},afterRender:function(){},bindEvents:function(){var t=this.$container,n=t.find(".sort_list"),r=this;t.on("click","#nav_condition li",function(){var t=e(this);if(t.hasClass("on"))return;t.parent().find("li.on").removeClass("on"),t.addClass("on"),r.data.condition=t.attr("condition"),r.onTagSelectBefore(),r.onTagSelect()});var i=t.find(".dis_sound_sort");i.on("mouseleave",".sort_list",function(){if(n.attr("data-show-tags"))return;n.removeClass("is-show-tags")}),i.find(".sort_list").menuAim({rowSelector:"> li",tolerance:5,activate:function(t){var i=e(t);if(n.attr("is-tags-enter"))return;var s=r.$tagWrap.find("[data-cache="+i.attr("cid")+"]");s.size()&&s.children().size()?n.addClass("is-show-tags"):n.removeClass("is-show-tags"),i.parent().find("li.hover").removeClass("hover"),i.addClass("hover");var o=r.data.category,u=r.category_text;r.data.category=i.attr("cid"),r.createTags(i.index(),i.outerHeight()),r.data.category=o},enter:function(t){var r=e(t);r.hasClass("hover")&&n.addClass("is-show-tags")},deactivate:function(e){}}),i.on("mouseenter",".sort_list .tags_panel",function(){n.attr("is-tags-enter",!0)}),i.on("mouseleave",".sort_list .tags_panel",function(){n.removeAttr("is-tags-enter")}),i.on("click",".sort_list li",function(){var n=e(this);if(n.hasClass("on")&&parseInt(n.attr("is-data-all"))!==0)return;n.attr("data-all",1),n.parent().find("li.on").removeClass("on"),n.addClass("on");var i=n.attr("cid");r.data.category=i,r.category_text=e.trim(n.text()),r.category_link=n.find("a").attr("href"),t.find(".tags_panel .tagBtn.on").removeClass("on"),r.data.tag="",r.onTagSelectBefore(),r.onTagSelect()}),i.on("click",".tags_panel .tagBtn",function(){var n=e(this);if(n.hasClass("on"))return;var i=n.closest(".tag_wrap");i.find(".on").removeClass("on"),n.addClass("on");var s=t.find(".sort_list"),o=n.parent().attr("data-cache"),u=s.find("li[cid="+o+"]");r.data.tag=n.attr("tid"),r.data.category=o,r.category_text=e.trim(u.text()),r.category_link=u.find("a").attr("href"),r.onTagSelectBefore(),r.onTagSelect(),s.find("li.on").removeClass("on"),u.addClass("on").attr("is-data-all",0)});var s=e("#crumb_sub"),o=e("#crumb_all");o.on("click","a",function(){t.find(".sort_list li").eq(0).trigger("click"),n.removeClass("is-show-tags")}),s.on("click","a",function(){var r=e(this),i=r.attr("cid");t.find(".sort_list li[cid="+i+"]").trigger("click"),n.removeClass("is-show-tags")})},onTagSelect:function(){},onTagSelectBefore:function(){this.createCrumbs()},createCrumbs:function(){var t=this.data,n=t.category,r=this.category_text,i=t.tag,s=e("#crumb_sub"),o=s.find("a"),u=e("#crumb_tag"),a=u.find("span");n&&r&&o.text(r).attr("cid",n).attr("href",this.category_link),i?(u.show(),a.text(i)):u.hide()},unbindEvents:function(){this.$container.off()}});return r}),define("page/discovery/dis_album",["jquery","page/discovery/album_sound","underscore","module/player/player","router","plugin/jquery.selecter"],function(e,t,n,r,i){var s=t.extend({_isChangePage:!1,container:"#discoverAlbum",url_album:"/explore/album_detail",data:{category:0,condition:"",tag:"",per_page:12},init:function(){this.initCommon(),this.$container=e("#discoverAlbum"),this.$layoutRight=this.$container.find(".layout_right"),r.render({$container:this.$layoutRight}),this.initStatus()},initData:function(){var e=this.$container,t=e.find(".sort_list li.on"),n=e.find("#nav_condition li.on");this.data.category=t.attr("cid"),this.data.condition=n.attr("condition"),this.data_tag="",this.data.tag=""},initStatus:function(){var e=this.$container,t=this,n=e.find("#nav_status");n.selecter(),n.on("change",function(){t.onTagSelect();var e=t.getData(),n=e.status,r=decodeURIComponent(window.location.href.replace(/\?.*$/,""));n&&n!=="0"&&(r=r.replace(/\/$/,""),r+="?status="+n),i.toPage(r)})},onTagSelect:function(){var t=this.$container.find("#nav_status"),n=["3","9"],r=this.getData(),i=r.category;return e.inArray(i,n)>=0?t.removeClass("hidden"):(t.selecter("val",0),t.addClass("hidden")),!1},release:function(){this.callParent("release"),this.unbindEvents()},releaseSub:function(){this.callParent("releaseSub"),helper.scrollTop()},bindEvents:function(){this.callParent("bindEvents");var t=this.$container,n=this;t.on("click",".discoverAlbum_wrapper .playBtn",function(){var t=e(this),r=t.closest(".miniPlayer3");if(r.attr("sound_id"))return;var i=t.closest(".discoverAlbum_item"),s=i.attr("album_id");n.initSoundId(r,t,s)}),t.on("click",".pagingBar_page",function(){var t=e(this),r=t.parent(),i=t.attr("data-page");t.parent().find(".on").removeClass("on"),r.find("[data-page="+i+"]:not([rel])").addClass("on"),n._isChangePage=!0})},initSoundId:function(t,n,i){e.get("/album/"+i+"/sound_ids",function(e){var i=e[0];t.attr("sound_id",i),r.render({$container:t}),n.trigger("click")})},unbindEvents:function(){this.callParent("unbindEvents")},getData:function(){var e=this.$container,t=e.find(".sort_list li.on"),n=e.find("#nav_condition li.on"),r=e.find(".tags_panel .tagBtn.on"),i=this.$container.find("#nav_status"),s=t.attr("cname")||"all",o=t.attr("cid")||"0",u=n.attr("condition"),a=r.attr("tid"),f=this._isChangePage?e.find(".pagingBar_wrapper a.on").text():1,l=i.selecter("val")||0;return{category:o,categoryName:s,condition:u,tag:a,page:f,status:l}},initSub:function(){r.init(),this._isChangePage=!1}});return new s}),define("page/discovery/dis_index",["jquery","page/page_base","module/player/player","router"],function(e,t,n,r){var i=t.extend({init:function(){this.callParent("init"),this.$el=e("#discoverPage"),this.$picWrapper=this.$el.find(".picWrapper"),this.initSlide(),this.initADBanner(),e(".disRankUserPanel").on("click",function(t){var n=e(t.target);if(n.attr("href"))return;if(n.closest("a").size()!=0)return;if(!n.size()||!n.closest("[sound_id]").size()){var i=e(this).find(".rankUserPanel2 .userface60").attr("href");return i&&r.toPage(i),!1}}),n.render({$container:this.$el,waveRenderDelay:!0})},initBg:function(){this.$el.parent().attr("class","bodyBgColor2")},initSlide:function(){var t=this.$picWrapper,n=t.find(".border-wrap"),r=0,i=-1,s=this;this._slideStop=!1;var o=function(t,r){r=r||e.noop;var o=t.index(),a=t.height(),f=t.parent().find(".on"),l=320;helper.browser.msie&&parseInt(helper.browser.version)<=8&&(l=0),f.removeClass("on"),n.stop().animate({top:o*a},l,"linear",function(){t.addClass("on"),n.attr("href",t.attr("href"));if(o==i)return;s.showSlideImg(o,i,u),i=t.index(),r(i)})};t.on("mouseenter",".nav",function(){var t=e(this);o(t)}),t.on({mouseenter:function(){s.stopSlide()},mouseleave:function(){s.startSlide()}});var u=t.find(".nav"),a=u.size()-1;this._slideTimer=setInterval(function(){if(s._slideStop)return;if(u.eq(i).attr("data-playing"))return;r!=i&&(r=i),r++,r>a&&(r=0),o(u.eq(r))},4e3),o(u.eq(0))},initADBanner:function(){function t(){var t=[];t.push('<div class="ad-main hidden">'),t.push('<iframe src="'+config.AD_PATH+'/iframe/web?device=web&amp;version=1.4.1&amp;name=top_banner_web" '+'width="950px" height="322px" scrolling="no" frameborder="0" style="display:block;margin:0"></iframe>'),t.push('<div class="ad-close-wrapper">'),t.push('<span class="ad-close-txt">广告 <span class="num">5</span> 秒</span>'),t.push('<button class="ad-close">×</button>'),t.push("</div></div>");var n=t.join(""),r=e(n).insertBefore("#discoverPage").hide();r.on("click",".ad-close",function(){r.fadeOut()});var i=5;r.find("iframe").on("load",function(){r.fadeIn();var e=setInterval(function(){i==0&&(clearInterval(e),r.fadeOut()),r.find(".num").text(i--)},1e3)})}function n(e){e.ret==0&&e.data[0]?t():window.console&&console.log(e.msg)}if(!jQuery.support.cors&&window.XDomainRequest){var r=/^https?:\/\//i,i=/^get|post$/i,s=new RegExp("^"+location.protocol,"i"),o=/\/xml/i;jQuery.ajaxTransport("text html xml json",function(e,t,n){if(e.crossDomain&&e.async&&i.test(e.type)&&r.test(t.url)&&s.test(t.url)){var u=null,a=(t.dataType||"").toLowerCase();return{send:function(n,r){u=new XDomainRequest,/^\d+$/.test(t.timeout)&&(u.timeout=t.timeout),u.ontimeout=function(){r(500,"timeout")},u.onload=function(){var e="Content-Length: "+u.responseText.length+"\r\nContent-Type: "+u.contentType,t={code:200,message:"success"},n={text:u.responseText};try{if(a==="json")try{n.json=JSON.parse(u.responseText)}catch(i){t.code=500,t.message="parseerror"}else if(a==="xml"||a!=="text"&&o.test(u.contentType)){var s=new ActiveXObject("Microsoft.XMLDOM");s.async=!1;try{s.loadXML(u.responseText)}catch(i){s=undefined}if(!s||!s.documentElement||s.getElementsByTagName("parsererror").length)throw t.code=500,t.message="parseerror","Invalid XML: "+u.responseText;n.xml=s}}catch(f){throw f}finally{r(t.code,t.message,n,e)}},u.onerror=function(){r(500,"error",{text:u.responseText})},u.open(e.type,e.url),u.send()},abort:function(){u&&u.abort()}}}})}jQuery.support.cors=!0,e.ajax({crossDomain:!0,url:(config.AD_PATH||"http://ad.ximalaya.com")+"/web?name=top_banner_web&device=web&version=1.4.1",type:"GET",dataType:"json"}).done(n).fail(function(){window.console&&console.log("error")})},showSlideImg:function(t,r,i){var s=this.$picWrapper.find(".picShow"),o=300;helper.browser.msie&&parseInt(helper.browser.version)<=8&&(o=0),s.eq(r).fadeOut(o,function(){n.render({$container:s})}),s.on("onSoundPlay",function(){var t=e(this),n=t.index();i.eq(n).attr("data-playing",!0)}),s.on("onSoundStop onSoundPause onSoundFinish",function(){var t=e(this),n=t.index();i.eq(n).removeAttr("data-playing")}),s.eq(t).fadeIn(o)},stopSlide:function(){this._slideStop=!0},startSlide:function(){this._slideStop=!1},release:function(){this.callParent("release"),clearInterval(this._slideTimer)},render:function(){},afterRender:function(){},bindEvents:function(){}});return new i}),define("module/waterfall",["jquery"],function(e){function n(t){var n=r(t).sort(),i={};return e.each(n,function(e,n){i[n]=t[n]}),i}function r(e){var t=[];for(key in e)e.hasOwnProperty(key)&&t.push(key);return t}function i(e){var t=e[0];for(var n=1,r=e.length;n<r;n++){var i=e[n];i>t&&(t=i)}return t}function s(e){var t=e[0];for(var n=1,r=e.length;n<r;n++){var i=e[n];i<t&&(t=i)}return t}function o(t){var n=t.$el;this.$el=n,this.col_num=t.col_num||4,this.pin_width=t.pin_width||200,this.pin_gap_right=t.pin_gap_right||10,this.pin_gap_bottom=t.pin_gap_bottom||10,this.page_selector=t.page_selector||".waterfall-pinsbox",this.pin_selector=t.pin_selector||".waterfall_item",this.url=t.url||"",this.onMoreBefore=t.onMoreBefore||e.noop,this.onRenderPage=t.onRenderPage||e.noop,this.onMoreEnd=t.onMoreEnd||e.noop,this.bindEvents()}var t=e(window);return o.prototype.init=function(e){this.page_size=e.page_size||20,this.page_num=e.page_num||0,this.page_index=e.page_index||0,this.col_lefts=[],this.col_tops=[],this.data=e.data||{},this.url=e.url||this.url,this.onMoreBefore=e.onMoreBefore||this.onMoreBefore,this.onRenderPage=e.onRenderPage||this.onRenderPage,this.onMoreEnd=e.onMoreEnd||this.onMoreEnd,this.init_cols()},o.prototype.render=function(){var e=this.$el.find(this.page_selector);this.renderPages(e)},o.prototype.init_cols=function(){for(var e=0;e<this.col_num;e++){var t=e*this.pin_width+e*this.pin_gap_right;this.col_lefts.push(t),this.col_tops.push(0)}},o.prototype.renderPages=function(e){for(var t=0;t<e.size();t++){var n=e.eq(t);this.renderPage(n)}},o.prototype.renderPage=function(t){var n=t.find(this.pin_selector);this.page_index++;for(var r=0;r<n.length;r++){var o=n.eq(r),u=s(this.col_tops),a=e.inArray(u,this.col_tops),f=this.col_lefts[a];o.css({left:f+"px",top:u+"px",opacity:1});var l=o.height();this.col_tops[a]=u+l+this.pin_gap_bottom,this.$el.height(i(this.col_tops))}this.onRenderPage(t)},o.prototype.getMore=function(t){var r=this;this.data.page=this.page_index+1,this.data.per_page=this.page_size,n(this.data),e.ajax({type:"GET",url:this.url,dataType:"json",data:this.data,success:function(n){if(!n.res){t(n);return}var i=e(n.html.replace(/\s+/g," "));r.page_num=n.maxPageId,r.$el.append(i),r.renderPage(i),r.onMoreEnd(i),t()}})},o.prototype.controlWindowScroll=function(e){var n=s(this.col_tops),r=this.model,i=this.$el,o=this;if(this.windowScrollLocked)return;if(this.page_index>=this.page_num){t.off("scroll",this.onWindowScroll);return}if(e||t.scrollTop()+t.height()>i.offset().top+n)this.windowScrollLocked=!0,this.onMoreBefore(),this.getMore(function(){o.windowScrollLocked=!1,o.controlWindowScroll()})},o.prototype.onWindowScroll=function(e){var t=e.data.context;t.waterfall_scroll_timeoutId&&clearTimeout(t.waterfall_scroll_timeoutId),t.waterfall_scroll_timeoutId=setTimeout(function(){t.controlWindowScroll()},50)},o.prototype.bindEvents=function(){t.on("scroll",{context:this},this.onWindowScroll)},o.prototype.release=function(){t.off("scroll",this.onWindowScroll)},o}),define("module/sound",["jquery","underscore","backbone","helper","json2","model/sound","model/cache_part"],function(e,t,n,r,i,s,o){function u(){var e="/main/get_relation_with_sounds";this.sounds={},this.cachePart=new o(e,s,this.parseModelFn)}return u.prototype.parseModelFn=function(e){var t=e.toJSON(),n={id:t.id};return t.hasOwnProperty("isFavorited")&&(n.is_like=t.isFavorited),n},u.prototype.render=function(n){if(!r.isLogin())return;var i=this,s=n||{},o=s.$container,u=s.fields||["is_like"],a,f=s.ids||[];this.clear(f),o?a=o.find("[sound_id]"):a=e("[sound_id]");for(var l=0,c=a.size();l<c;l++){var h=a.eq(l);if(!h.data("is_sound_already_render")){var p=h.attr("sound_id");f.push(p)}}f=t.uniq(f),this.cachePart.query(f,u,function(e){i._render(e)})},u.prototype.clear=function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=e("[sound_id="+i+"]");s.data("is_sound_already_render",!1)}},u.prototype._render=function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=e("[sound_id="+i.id+"]");this._renderSounds(s)}},u.prototype._renderSounds=function(e){var t=this;e.each(function(n){var r=e.eq(n);r.data("is_sound_already_render")||(r.data("is_sound_already_render",!0),t._renderSound(r))})},u.prototype._renderSound=function(e){this.renderFollow(e)},u.prototype.renderFollow=function(e){var t=e.find(".imgLikeBtn,.likeBtn");if(t.size()){var n=e.attr("sound_id"),r=this.cachePart.get(n);r.is_like?t.is(".imgLikeBtn")?t.addClass("liked").attr("取消赞"):t.is(".likeBtn")&&t.addClass("is-sound-liked").attr("取消赞"):t.is(".imgLikeBtn")?t.removeClass("liked").attr("赞"):t.is(".likeBtn")&&t.removeClass("is-sound-liked").attr("赞")}},u.prototype.cacheSound=function(e){this.cachePart.set(e)},new u}),define("page/discovery/dis_sound",["jquery","page/discovery/album_sound","underscore","helper","module/waterfall","model/sound","module/dialogs/forward","module/player/player","module/wave","module/sound","router","plugin/jquery.menu-aim"],function(e,t,n,r,i,s,o,u,a,f,l){var c=t.extend({url_track:"/explore/sound_detail2",container:"#discoverSound",data:{category:0,condition:"",tag:""},init:function(t){t=t||{},this.$container=e("#discoverSound"),this.initCommon(t)},initData:function(e){var t=this.$container,n=t.find(".sort_list li.on"),r=t.find("#nav_condition li.on");this.data.category=n.attr("cid"),this.data.condition=r.attr("condition"),this.data.tag=e.tag||""},initWaterfall:function(t){var n=this,r=e(".waterfall_container"),s=r.next(".loadingMore"),o=new i({$el:r,url:this.url_track,onMoreBefore:function(){s.show()},onRenderPage:function(t){var n=r.attr("sound_ids");n=n?n.split(","):[],t.find(".waterfall_item").each(function(){var t=e(this),r=t.attr("sound_id");n.push(r)}),r.attr("sound_ids",n),r.is(".j-player-soundIdsWorking")&&mainPlayer.soundIds(n),f.render({$container:t})},onMoreEnd:function(t){var n=document.createElement("canvas");n.getContext?u.render({$container:t,color:"transparent"}):(t.find(".waterfall_item").each(function(){var n=e(this);n.hasClass("lack_img")?u.render({$container:t,color:"transparent"}):(u.render({$container:t,color:"transparent",waveRenderDelay:!0}),n.find(".playBtn").attr("data-wavedelay",!0))}),t.on("click","[data-wavedelay]",function(){var t=e(this),n=t.closest(".waterfall_item");a.render({$container:n,color:"transparent"})})),n=null,s.hide()}});o.init({page_num:t,data:this.getData()}),o.render(),this.waterfall=o},onTagSelect:function(){return!1},release:function(){this.callParent("release"),this.releaseSub(),this.unbindEvents()},releaseWaterfall:function(){this.waterfall&&this.waterfall.release()},bindEvents:function(){this.callParent("bindEvents");var t=this.$container,n=t.find(".sort_list"),r=this;t.on("click",".waterfall_item .item_wrap",function(t){if(e(t.target).hasClass("play_btn"))return;var n=e(this).find(".title").attr("href");n&&l.toPage(n),t.stopPropagation()}),t.on("click",".waterfall_item .title",function(e){e.preventDefault()}),t.on("click",".waterfall_item .imgForwardBtn ",function(t){r.forwardSound(e(this))}),t.on("click",".waterfall_item .imgLikeBtn ",function(t){r.likeSound(e(this))}),t.on("onSoundIdSelect",".waterfall_item",function(n){var i=e(this),s=t.find(".waterfall_item"),o=s.last(),u=i.next();window.console&&console.log(o,u),o&&u&&o[0]==u[0]&&(window.console&&console.log(this),r.waterfall.controlWindowScroll(!0))})},unbindEvents:function(){this.callParent("unbindEvents"),e(window).off("scroll",this.onWindowScroll)},onWindowScroll:function(e){var t=e.data.self;t.controlWindowScroll()},controlWindowScroll:function(){var t=this.$container,n=t.find(".layout_right"),r=t.find(".tags_panel"),i=t.find(".sort_list");e(document).scrollTop()>n.offset().top-60?(r.attr("data-fixed")&&r.addClass("fixed"),i.addClass("fixed")):(r.removeClass("fixed"),i.removeClass("fixed"))},forwardSound:function(t){if(!r.isLogin())return;var n=t.closest(".waterfall_item"),i=n.attr("sound_id");o.open(i,!1,function(n){var r=t.find(".info");r.size()==0&&(r=e("<span class='info'></span>"),t.find(".content").append(r));var i=parseInt(e.trim(r.text()))||0;r.text(n.track_shares_count||i+1)})},likeSound:function(e){if(!r.isLogin())return;var t=e.closest(".waterfall_item"),n=t.attr("sound_id"),i=new s({id:n,isFavorited:!1});if(e.attr("data-in-operation"))return;e.attr("data-in-operation",!0),e.hasClass("liked")?this.unlike(n,function(){e.removeClass("liked"),e.removeAttr("data-in-operation")}):this.unlike(n,function(){e.addClass("liked");var t=e.find(".content"),n=t.clone();n.css({position:"absolute",left:0,top:0}),n.insertAfter(t),n.find(".icon").animate({marginTop:-t.height(),opacity:.3},500,function(){n.remove(),e.removeAttr("data-in-operation")})})},like:function(e,t){var e=this._soundId,n=parseInt(this._$likeCount.text(),10)+1,r=new s({id:e,isFavorited:!0});r.like(t)},unlike:function(e,t){var n=new s({id:e,isFavorited:!1});n.unlike(t)},getData:function(){var e=this.$container,t=e.find(".sort_list li.on"),n=e.find("#nav_condition li.on"),r=e.find(".tags_panel .tagBtn.on"),i=t.attr("cname"),s=n.attr("condition"),o=r.attr("tid");return{category:i,condition:s,tag:o}},initSub:function(t){var n=t.maxPageId;e(".waterfall_container").attr("sound_ids",""),u.init(),this.initWaterfall(n)},releaseSub:function(){this.callParent("releaseSub"),this.releaseWaterfall()}});return new c}),define("module/common/picshow",["jquery","underscore","backbone","module/common/ifollow","router","plugin/jquery.parser"],function(e,t,n,r,i){var s=['<div class="leftShow">','    <div class="popUserPanel left">','       <div class="userfacebase"> ','            <div class="userbaseface<%=width%>"><img src="<%=src%>" alt="" /></div>','            <i class="light">&nbsp;</i>',"		</div>","    </div>",'    <div class="popUserPanel right">','        <span class="intro title "><%=nickname%><span class="VIcon ">&nbsp;</span></span>','        <span class="intro "><%=personDescribe?personDescribe:"无定位"%></span>',"    </div>","</div>"].join(""),o=0,u=n.Model.extend({defaults:{nickname:"dagaegaeg",personDescribe:"aegaeg",src:"",href:"",uid:0,is_follow:!1,be_followed:!1}}),a=n.View.extend({template:t.template(s),tagName:"div",className:"bud-4",events:{"mouseenter .userfacebase":"doShowLight",click:"doDirect"},doDirect:function(){i.toPage(this.model.get("href"))},doShowLight:function(){var e=this,t=e.$el.find("i");t.animate({left:e.model.get("width")/2*3+10},400,function(){t.css("left",e.model.get("width")/2*3*-1+10+"px")})},init:function(t,n){var r=this;e(".picCon,.userFaceList .listItem .userbaseface60").on({mouseenter:function(){var i=e(this),s=i.find("img").clone(),u=e.extend({},e.parser.parseOptions(this,[{nickname:"string",personDescribe:"string",href:"string"}]));return clearTimeout(o),o=setTimeout(function(){u.src=s.attr("src"),u.width=n,r.model.set(u),r.show(),i.append(r.$el.show());var e=r.$el.find(".popUserPanel:eq(1)"),o=r.$el.find(".popUserPanel:eq(0)"),a=e.width();u.position=="right"?(o.removeAttr("style").css({left:"auto",right:t}),r.$el.removeAttr("style").css({left:"auto",right:-1}),e.stop().css("width",a).animate({width:a+(t+1)},150,function(){r.$el.css("z-index",9999)})):(o.removeAttr("style").css({left:0,right:"auto"}),r.$el.removeAttr("style").css({left:0,right:"auto"}),e.stop().css("width",a).animate({"margin-left":t+1+2},150,function(){r.$el.css("z-index",9999)}))},200),!1},mouseleave:function(){clearTimeout(o),o=setTimeout(function(){r.$el.hide()},200)}})},show:function(){this.render(),this.undelegateEvents(),this.delegateEvents(this.events)},render:function(e){var t=this;return t.$el.html(t.template(this.model.toJSON())).css({width:"auto"}),t.$el},release:function(){}});return new a({model:new u})}),define("page/discovery/dis_user",["jquery","page/page_base","module/common/ifollow","module/common/iletter","module/common/picshow","module/user","router"],function(e,t,n,r,i,s,o){var u=t.extend({_isChangePage:!1,init:function(){this.callParent("init"),this.$el=e("#discoverRadioPage"),this.$personalMain=this.$el.find(".personalMain"),this.bindEvents(),i.init(49,50),e(".bud-1 .userfacebase,.bud-2 .userfacebase,.bud-3 .userfacebase").on({mouseenter:function(t){var n=e(t.currentTarget),r=n.find("i");r.stop().animate({left:385},800,function(){r.css("left","-385px")})}}),e(".radioUserListItem").on("click",function(t){var n=e(t.target);if(n.attr("href"))return;if(n.closest("a").size()!=0)return;var r=e(this).find(".radioUserPanel .userface110").attr("href");return r&&o.toPage(r),!1})},initBg:function(){this.$el.parent().attr("class","bodyBgColor2")},release:function(){this.callParent("release"),this.unbindEvents(),i.release()},releaseSub:function(){this.callParent("releaseSub"),this.$personalMain.offset().top<window.scrollY&&helper.scrollTo(this.$personalMain,-10)},bindEvents:function(){var t=this;this.$personalMain.on("click",".category .nav_item",function(){var n=e(this);n.parent().find(".on").removeClass("on"),n.addClass("on"),t._isChangePage=!1}),this.$personalMain.on("click",".circle .nav_item",function(){var n=e(this);n.parent().find(".on").removeClass("on"),n.addClass("on"),t._isChangePage=!1}),this.$personalMain.on("click",".titleCon  a[data-condition]",function(n){var r=e(this).parent();r.parent().find(".on").removeClass("on"),r.addClass("on"),t._isChangePage=!1}),this.$personalMain.on("click",".pagingBar_page",function(){var n=e(this),r=n.parent(),i=n.attr("data-page");n.parent().find(".on").removeClass("on"),r.find("[data-page="+i+"]:not([rel])").addClass("on"),t._isChangePage=!0}),r.bind(e(".radioLetterIcon"))},unbindEvents:function(){this.callParent("unbindEvents"),this.$personalMain.off()},initSub:function(){this.callParent("initSub"),r.bind(e(".radioLetterIcon")),n.init(),helper.isLogin()&&this.renderOnIsLogin()},renderOnIsLogin:function(){s.render()}});return new u}),define("page/final/final_album",["jquery","page/page_base","module/player/player","module/comment_box","module/dialogs/share2friend","module/common/ireport","helper","module/common/ifollow","plugin/dialog","module/sound","router","module/album-end"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=t.extend({init:function(){this.callParent("init"),this.$el=e(".mainbox_wrapper"),this.$el.find("li.pay_sound").each(function(){e(this).find(".destroyBtn").attr("destroy_id","")}),this.$el.find(".mid_intro"),c.init(e(".j-finished-album")),this.initPlayer(),this.bindEvents(),u.init(),s.init(),o.isLogin()&&this.initAjaxContent()},initPlayer:function(){var e=this;n.render({$container:e.$el.find(".personal_container")})},initAutoPlay:function(){var t=o.getHrefRefs();if(t.trackid){var n=e(".album_soundlist [sound_id="+t.trackid+"]");n.find(".playBtn").mousedown()}},initAjaxContent:function(){var e="/album/"+this.getAlbumId()+"/show_right",t=this.$el.find(".mainbox_right"),n=this;t.addClass("loadingMore").load(e,function(){t.removeClass("loadingMore"),n.afterRender(),f.render()})},getAlbumId:function(){var e=window.location.href,t=e.replace(/.*album\//i,"").replace(/\?.*/,"");return t=t.replace(/\D+/,""),t},bindEvents:function(){var t=this,n=this.$el;n.on("click",".album_soundlist .more",function(){n.find(".album_soundlist").addClass("is-more")});var r=n.find(".mid_intro"),s=n.find(".rich_intro");n.on("click",".mid_intro .arrow",function(){r.stop().slideUp(),s.stop().slideDown()}),n.on("click",".rich_intro .arrow",function(){r.stop().slideDown(),s.stop().slideUp()}),r.find("img").css("cursor","zoom-in"),r.on("click","img",function(){var t=e(this).css("max-width");t==="100%"?(e(this).removeAttr("style"),e(this).css({cursor:"zoom-in"})):e(this).css({"max-width":"100%",cursor:"zoom-out"})}),n.on("click",".rich_intro a",function(){var e=this.host,t=this.href;if(e){var n=window.location.host;e==n?l.toPage(t):window.open(t)}return!1}),n.find(".detail_soundBox").on("onSoundPlay",function(e,t){var r=t.id,i=n.find(".album_soundlist"),s=i.find("[sound_id="+r+"]");s.index()>=10&&i.addClass("is-more"),i.find(".focus").removeClass("focus"),s.addClass("focus")}),n.on("click",".album_soundlist .shareBtn",function(){var t=e(this),n=t.attr("track_id"),r=t.attr("track_uid");i.open("sound",n,r)}),n.on("click",".shareLink[album_id]",function(){var t=e(this),n=t.attr("album_id"),r=t.attr("album_uid");i.open("album",n,r)}),n.on("click",".comlateText",function(){e(this).addClass("disabled");var t=e(this).attr("data-url");e.ajax({url:t,type:"GET",success:function(e){}})}),e(".apply-end").on("click","a",function(){var t=this,n=e(this).attr("data-url"),r=a.confirm("亲,确定申请完本吗？",function(){e.ajax({url:n,type:"POST",success:function(t){t.res?e(".apply-end").html("<span>完本申请中</span>"):a.alert(t.msg)},error:function(){a.alert("系统出错了哦！")}})})}),e(".tips-cont").on("click","a",function(){var t=e(this).attr("data-action-url"),n=e(this).attr("data-type");e(".tips-sort").addClass("hidden"),e.ajax({url:"/center/confirm_guide",type:"POST",data:{type:n},success:function(t){t.res==1&&e(".tips-cont,.popup-overlayer").hide()},error:function(){a.alert("系统出错了哦！")}})})},unbindEvents:function(){this.$el.off(),s.release(),u.release()}});return new h}),define("page/final/final_sound",["jquery","page/page_base","helper","module/player/player","module/comment_box","module/common/ireport","model/comment","plugin/dialog","module/dialogs/share2friend","module/common/ifollow","plugin/twemoji/twemoji","router","module/dialogs/paysound"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p="",d=t.extend({init:function(){this.callParent("init"),this.$el=e(".mainbox_wrapper"),this.$soundBox=this.$el.find(".detail_soundBox2"),this.track_id=this.$soundBox.attr("sound_id"),this.relayBoxHtml=e("#reply_box_template").html(),this.initPlayer(),this.initCommentBox(),this.initForwardBox(),this.bindEvents(),window.location.href.indexOf("relay=true")>0?this.getForwardList():this.getCommentList(),s.init(),f.init(),p="/sounds/"+this.track_id+"/rich_intro",n.isLogin()&&this.initAjaxContent()},initAjaxContent:function(){var e=this.track_id,t=this.$el,n="/sounds/"+e+"/",r=n+"maybe_like_list",i=n+"right",s=t.find(".recommendSound_body"),o=t.find(".rich_intro"),u=t.find(".mainbox_right"),a=this;p=n+"rich_intro",s.addClass("loadingMore").load(r,function(){s.removeClass("loadingMore")}),u.addClass("loadingMore").load(i,function(){u.removeClass("loadingMore"),a.afterRender()})},initPlayer:function(){var e=this;r.render({$container:e.$soundBox})},initBox:function(e,t,n){var r=this,s=e.find(".commentBox_inputBox"),o=e.find(".comment_input textarea"),u=this.track_id;o.on({blur:function(){s.removeClass("focus")},focus:function(){s.addClass("focus")}}),new i({$el:e,trackId:u,$input:o,isForward:t,success:function(e){n(e)}})},initCommentBox:function(){var e=this,t=e.$el.find(".commentSection_body  .commentSend .commentBox");this.initBox(t,!1,function(t){e.getCommentList(),e.$el.find(".commentBtn").html("评论("+(t.track_comments_count||0)+")")})},initForwardBox:function(){var e=this,t=e.$el.find(".relaySection_body .commentSend .commentBox");this.initBox(t,!0,function(t){e.getForwardList(),e.$el.find(".forwordBtn").html("转采("+(t.track_shares_count||0)+")")})},getForwardList:function(t){t=t||1;var n={id:this.track_id,page:t},r="/sounds/"+n.id+"/relay_list",i=this,s=e("#relay_list_wrap");s.empty().addClass("loadingMore"),e.get(r,n,function(e){s.removeClass("loadingMore"),s.html(l.parse(e))})},getCommentList:function(t){t=t||1;var n={id:this.track_id,page:t},r="/sounds/"+n.id+"/comment_list",i=this,o=e("#comment_list_wrap");o.empty().addClass("loadingMore"),e.get(r,n,function(e){o.removeClass("loadingMore"),o.html(l.parse(e)),s.init()})},getListAfter:function(){n.scrollTo(this.$el.find(".commentSection"),0)},release:function(){this.callParent("release"),this.unbindEvents(),s.release(),f.release()},bindEvents:function(){var t=this,r=this.$el;r.on("click",".commentSection_body .pagingBar_wrapper [data-page]",function(){var n=e(this).attr("data-page");t.getCommentList(n),t.getListAfter()}),r.on("click",".relaySection_body .pagingBar_wrapper [data-page]",function(){var n=e(this).attr("data-page");t.getForwardList(n),t.getListAfter()});var i=r.find(".commentSection_body"),s=r.find(".relaySection_body");r.on("click",".commentSection .tagTab .tab_item",function(){var n=e(this),r=n.index();if(n.hasClass("on"))return;n.parent().find(".on").removeClass("on"),n.addClass("on"),r==0?(i.show(),s.hide(),t.getCommentList()):(i.hide(),s.show(),t.getForwardList())}),r.on("click",".commentSection .delBtn",function(){var n=e(this),r=n.closest(".comment"),i=e.parseJSON(n.attr("data-options"));r.size()==0&&(r=n.closest(".listItem")),t.delComment(i,function(e,t){r.slideUp()},function(e,t){u.alert(t.msg)})}),r.on("click",".commentSection .replyBtn",function(){if(!n.isLogin())return;var r=e(this),i=r.closest(".comment"),s;i.size()>0?s=i.children(".reply_box_entry"):(i=r.closest(".comment2"),i.size()>0&&(s=i.children(".right").children(".reply_box_entry"))),t.createRelayBox(s,e.parseJSON(r.attr("data-options")))}),r.on("click",".recommendSound_head a",function(){t.changeRecommend()});var o=r.find(".mid_intro"),f=r.find(".rich_intro");r.on("click",".mid_intro .arrow",function(){var n=e(this).attr("data-uid");if(e(this).attr("data-need-buy")==="true"){h.pop({id:t.track_id,uid:n},"查看全文");return}f.data("doload")?(o.stop().slideUp(),f.stop().slideDown()):(f.data("doload",!0),o.stop().slideUp(),f.load(p,function(){f.stop().slideDown()}))}),r.on("click",".rich_intro .arrow",function(){o.stop().slideDown(),f.stop().slideUp()}),r.on("click",".rich_intro a",function(){var e=this.host,t=this.href;if(e){var n=window.location.host;e==n?c.toPage(t):window.open(t)}return!1}),r.on("click",".shareLink[track_id]",function(){var t=e(this),n=t.attr("track_id"),r=t.attr("track_uid");a.open("sound",n,r)})},delComment:function(e,t,n){var r=new o({id:e.comment_id});r.set({trackId:e.track_id}),r.del(t,n)},changeRecommend:function(){var e=this.$el.find(".recommendSound_body"),t=e.children();t.hide();var n=t.length;if(n<=5){t.show();return}var r=this.getRandomArr(n,5);for(var i=0;i<r.length;i++)t.eq(r[i]).show()},getRandomArr:function(e,t){var n=[];while(e--)n[e]=e;var r=[];while(t--){var i=this.getRandom(n.length);r.push(n[i]),n.splice(i,1)}return r},getRandom:function(e){return parseInt(Math.random()*e)},createRelayBox:function(t,n){if(t.size()<1)return;if(t.attr("data-inited")){t.find(".commentBox").stop().slideToggle();return}t.html(_.template(this.relayBoxHtml,{logoPic60:config.CURRENT_USER.logoPic60}));var r=this,s=t.find(".commentBox"),o=s.find("textarea");s.hide().stop().slideToggle();var u=s.find(".commentBox_inputBox"),a=u.find("input");a.on("focus",function(){return u.addClass("is-onEdit focus"),o.focus(),!1}),o.on({blur:function(){u.removeClass("focus"),e.trim(o.val())||u.removeClass("is-onEdit")},focus:function(){u.addClass("is-onEdit focus"),s.height("auto"),o.val()||o.val("回复@"+n.c_nickname+":")}}),new i({$el:s,trackId:r.track_id,parentId:n.c_id,second:n.c_second,$input:o,isForward:!1,success:function(e){r.$el.find(".commentBtn").html("评论("+(e.track_comments_count||0)+")"),s.stop().slideToggle()}}),t.attr("data-inited",!0)},unbindEvents:function(){this.$el.off()}});return new d}),define("page/final/final_tag",["jquery","page/page_base","module/player/player","model/tag","plugin/dialog","module/common/iletter","module/common/ifollow","helper"],function(e,t,n,r,i,s,o,u){var a=t.extend({init:function(){this.callParent("init"),this.$el=e(".mainbox_wrapper"),this.initData(),this.initPlayer(),this.bindEvents(),o.init(),u.isLogin()&&this.initAjaxContent()},data:{pre:"",scope:"hot"},initData:function(){var e=this;this.data={pre:e.$el.find(".soundTab .selecter-selected").attr("data-value"),scope:e.$el.find(".soundTab [data-scope][data-selected]").attr("data-scope")}},initAjaxContent:function(){var e=this.getTagId();if(!e)return;var t="/tag/"+e+"/show_right",n=this.$el.find(".mainbox_right"),r=this;n.addClass("loadingMore").load(t,function(){n.removeClass("loadingMore"),o.init(),r.afterRender()})},getTagId:function(){var e=window.location.href,t=e.replace(/.*tag\//i,"");return e.indexOf("follower")>0?!1:(t=t.replace(/\/.*/,""),t=t.replace(/\?.*/,""),t=encodeURIComponent(decodeURIComponent(t)),window.console&&console.log(t),t)},initPlayer:function(){var e=this;n.render({$container:e.$el})},release:function(){this.callParent("release"),this.unbindEvents(),o.release()},bindEvents:function(){var t=this,n=this.$el;n.find(".soundTab .selecter").selecter({onChange:function(e){t.data.pre=e||"",t.openWindow()}}),n.on("click",".soundTab a[data-scope]",function(){var n=e(this);t.data.scope=n.attr("data-scope"),t.openWindow(),n.parent().find("[data-selected]").removeAttr("data-selected"),n.attr("data-selected",!0)});var i=n.find(".interestBtn"),o=n.find(".tagCount"),u=i.attr("data-tag")||e(".tagName").text(),a=new r({tagName:u});n.on("click",".interestBtn",function(){var t=e(this);a.switchFollowedTag(function(n,r,i){r.response=="create"&&(o.each(function(){var t=e(this);t.text((t.text()||0)*1+1)}),t.addClass("already")),r.response=="destroy"&&(o.each(function(){var t=e(this);t.text((t.text()||0)*1-1)}),t.removeClass("already"))})}),s.bind(e(".sendLetterBtn"))},openWindow:function(){var e=window.location.href;e.indexOf("?")&&(e=e.replace(/\?.*/,"")),window.location.href=e+"?"+"scope="+this.data.pre+this.data.scope},unbindEvents:function(){this.$el.off()}});return new a}),define("page/final/sound_liker",["jquery","page/page_base","module/common/ireport","module/common/iletter","module/common/ifollow"],function(e,t,n,r,i){var s=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),n.init(),i.init(),r.bind(e(".sendLetterBtn"))},release:function(){this.callParent("release"),i.release()}});return new s}),define("model/feed_new",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{albumCover:"",albumId:0,albumTitle:"",avatar:"",dynamicType:0,isTop:!1,lastUpdateAt:0,nickname:"",playPath32:"",playPath64:"",timeline:0,trackId:0,trackTitle:"",trackType:0,uid:0,unreadNum:0}});return r}),define("collection/feed_new",["jquery","underscore","backbone","model/feed_new"],function(e,t,n,r){var i=n.Collection.extend({model:r});return i}),define("plugin/jquery.pagination",["jquery"],function(e){function t(e){if(!(e.pageSize>0))throw"Zero";e.totalPage=Math.ceil(e.total/e.pageSize)}function n(t){t=t||e.data(el,"pagination").options;if(t.total<=0)return;t.currentPage<=0?t.currentPage=1:t.currentPage>t.totalPage&&(t.currentPage=t.totalPage);if(t.totalPage<=1)return;return t.html=[],t.currentPage<t.innerCount*2-1?(s(t),t.$el.html(t.html.join(""))):t.currentPage>t.totalPage-t.innerCount*2+1+t.outerCount?(r(t),t.$el.html(t.html.join(""))):(i(t),t.$el.html(t.html.join("")))}function r(e){var t=e.currentPage-e.innerCount+1,n=e.currentPage+e.innerCount-1;n>e.totalPage&&(t-=n-e.totalPage),n=e.totalPage+1,l(e),t>e.outerCount+2?(o(e),a(e)):t=1;for(;t<n;t++)f(e,t);c(e)}function i(e){var t=e.currentPage-e.innerCount+1,n=e.currentPage+e.innerCount;l(e),o(e),a(e);for(;t<n;t++)f(e,t);a(e),u(e),c(e)}function s(e){var t=e.currentPage-e.innerCount,n=e.currentPage+e.innerCount;t<0&&(n-=t),t=1,l(e);for(;t<n;t++){if(t>e.totalPage){c(e);return}f(e,t)}if(e.totalPage-n>e.outerCount)a(e),u(e);else for(;n<=e.totalPage;n++)f(e,n);c(e)}function o(e){var t=e.outerCount+1>e.totalPage?e.totalPage:e.outerCount+1;for(var n=0;n<t;n++)f(e,n+1)}function u(e){var t=e.totalPage-e.outerCount;for(var n=t;n<=e.totalPage;n++)f(e,n)}function a(e){e.html.push("<span>......</span>")}function f(e,t){e.html.push("<a data-page='"+t+"' class='pagingBar_page "+(e.currentPage==t?"on":"")+"'>"+t+"</a>")}function l(e){e.currentPage>1&&e.html.push("<a class='pagingBar_btn' data-page='"+(e.currentPage-1)+"'>上一页</a>")}function c(e){e.currentPage<e.totalPage&&e.html.push("<a class='pagingBar_btn' data-page='"+(e.currentPage+1)+"'>下一页</a>")}function h(r){var i=e(r),s=e.data(r,"pagination").options;i.on("click","a[data-page]",function(){var t=Number(e(this).attr("data-page"));i.pagination("setValue",{value:t,property:"currentPage"})}),s.$el=i,t(s),n(s)}e.fn.pagination=function(t,n){return typeof t=="string"?e.fn.pagination.methods[t](this[0],n):(t=t||{},this.each(function(){var n=e.data(this,"pagination");n?e.extend(n.options,t):n=e.data(this,"pagination",{options:e.extend(e.fn.pagination.defaults,t)}),h(this)}))},e.fn.pagination.methods={setValue:function(t,r){if(r.value&&r.property){var i=e.data(t,"pagination").options;i.$el=e(t);if(i[r.property]&&i[r.property]!=r.value){i[r.property]=r.value;switch(r.property){case"currentPage":case"total":case"pageSize":n(i),i.onPageChaned&&i.onPageChaned(i.currentPage);break;default:}}}}},e.fn.pagination.defaults={html:[],onPageChaned:function(e){console.log(e)},currentPage:1,total:0,pageSize:30,innerCount:4,outerCount:1,totalPage:0}}),define("module/feed/feed_sound_view",["jquery","underscore","backbone","model/feed_new","collection/feed_new","module/player/player","module/card","module/common","plugin/dialog","plugin/jquery.pagination"],function(e,t,n,r,i,s,o,u,a){var f=['<div class="content_wrap">','	<div class="album">','		<div class="left">','			<a class="albumface" hashlink href="<%if(albumId>0){%>/<%=uid%>/album/<%=albumId%>?feed=reset<%}else{%>/<%=uid%>/sound?feed=reset<%}%>"><span>           <div class="tag-panel-r <%=isPaid%>">               <!--s: 付费标签 -->               <i class="iconpay iconpay-pay3"></i>               <!--e: 付费标签 -->           </div><img alt="" src="<%= albumId>0? helper.getFDFSPath(albumCover,\'album\',180,180):helper.getFDFSPath(albumCover,\'header\',180,180)%>" /></span></a>',"		</div>",'		<div class="right">','			<div class="title"><a hashlink href="<%if(albumId>0){%>/<%=uid%>/album/<%=albumId%>?feed=reset<%}else{%>/<%=uid%>/sound?feed=reset<%}%>"><%=(albumId>0?"《":"")%><%-albumTitle%><%=(albumId>0?"》":"")%></a></div>','			<div class="bottom" sound_ids="<%=trackId%>">','				<span class="miniPlayer5" sound_id="<%=trackId%>">','					<a href="javascript:;" class="play_btn playBtn"></a>','					<a href="/<%=uid%>/sound/<%=trackId%>" hashlink class="title">',"						<%= helper.escapeHTML(trackTitle)%><%if(trackType==2){%>【转采】<%}%>","					</a>","				</span>",'				<div class="user">by <a card="<%=uid%>" hashlink href="/zhubo/<%=uid%>"><%-nickname%><%if(isVerified){%><i class="VIcon <%if(verifyType==2){%>blue<%}%>">&nbsp;</i><%}%></a></div>',"			</div>","		</div>",'		<div class="time"><%=helper.getDateNiceTime(lastUptrackAt)%></div>','		<div class="personal_operate">','			<a class="untopBtn"><%if(isTop){%>取消<%}%>置顶</a>',"		</div>",'		<%if(isTop){%><span class="topIcon"></span><%}%>','		<%if(count){%><a hashlink href="<%if(albumId>0){%>/<%=uid%>/album/<%=albumId%>?feed=reset<%}else{%>/<%=uid%>/sound?feed=reset<%}%>" class="numBtn"><%=count%></a><%}%>',"	</div>","</div>"],l=['<span style="display:none;" class="miniPlayer5 hidden" sound_id="<%=id%>">','  <a class="play_btn playBtn"></a>',"</span>"],c=n.View.extend({className:"item",tagName:"li",$topCon:null,template:t.template(f.join("")),locked:!1,events:{"click .untopBtn":"doTopItem","click .hiddenBtn":"doHideItem"},initialize:function(e){this.$topCon=e.$topCon},getAlbumSounds:function(){var n=this,r=n.model.get("albumId"),i=e(document.createDocumentFragment()).hide(),o=[];r&&n.model.fetch({url:"/"+n.model.get("uid")+"/sound_list",data:{album_id:r,per_page:200},dataType:"JSON",type:"get",success:function(e,r){if(r.count){for(var u in r.list)o.push(r.list[u].id+""),n.model.get("trackId")!=r.list[u].id&&i.append(t.template(l.join(""))(r.list[u]));n.$el.find(".bottom").append(i).attr("sound_ids",o.join(",")),s.appendSoundIds(o),s.init(),n.$el.find("[sound_id] .playBtn").eq(1).trigger(helper.START_EV)}else a.alert(r.msg)},error:function(){a.alert("服务器错误！")},complete:function(){}})},doTopItem:function(){var t=this,n=t.model.get("isTop")?"/feed2/cancel_sfeed_top":"/feed2/set_sfeed_top";if(t.locked)return;t.locked=!0,e.ajax({url:n,dataType:"json",data:{albumId:t.model.get("albumId"),albumUid:t.model.get("uid")},success:function(e){e.res?(t.model.set("isTop",!t.model.get("isTop")),t.render(),t.model.get("isTop")?t.$topCon.prepend(t.$el):t.$topCon.after(t.$el)):a.alert(e.msg)},complete:function(){t.locked=!1}})},doHideItem:function(){var t=this;if(t.locked)return;t.locked=!0,e.ajax({url:"/feed2/set_sfeed_shield",dataType:"json",data:{albumId:t.model.get("albumId"),albumUid:t.model.get("uid")},success:function(n){n.res?(t.remove(),e.cookie("feed_tip")||a.confirm("隐藏的内容，可在“个人设置→动态设置”中恢复",function(){},{cancelText:"不再提醒",onCancel:function(){e.cookie("feed_tip",!0)}})):a.alert(n.msg)},complete:function(){t.locked=!1}})},render:function(){var t=this,n=!1;return t.$el.html(t.template(t.model.toJSON())),t.$el.find(".miniPlayer5").on("onSoundFinish",function(e){n||(n=!0,t.getAlbumSounds())}),s.init(),o.render({$container:e("#mainbox")}),this.$el}});return c}),define("module/feed/feed_arg",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{page:1,pageSize:10,timeline:0,feedType:"sound",uid:config.CURRENT_USER.uid},initialize:function(){this.on("change:page",function(){},this)}});return r}),define("module/feed/feed_sound_new",["jquery","underscore","backbone","model/feed_new","collection/feed_new","module/player/player","module/card","module/common","module/common/ifollow","module/feed/feed_sound_view","module/feed/feed_arg","plugin/dialog","plugin/jquery.pagination"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=e("<div></div>"),p=0,d=0,v=n.View.extend({feedCol:null,$con:null,locked:!1,soundIDS:[],count:0,page:1,initialize:function(){var t=this;a.init(),t.feedCol=new i,t.feedCol.on("add",function(n){if(n.get("type")=="2")return;e.inArray(n.get("trackId"),t.soundIDS)==-1&&t.soundIDS.push(n.get("trackId")),n.get("isTop")?($el=(new f({model:n,$topCon:h})).render(),h.append($el),!t.$lastEl&&(t.$lastEl=$el),t.$lastEl.position().top<$el.position().top&&(t.$lastEl=$el)):(t.$lastEl=(new f({model:n,$topCon:h})).render(),t.$con.append(t.$lastEl))})},init:function(){this.doReset(),this.render(),this.doBindEvents(),e(".tab_title").text("动态")},doReset:function(){this.model.set({page:1,timeline:0}),this.page=1,this.count=0,this.locked=!1,this.soundIDS=[],this.feedCol.reset(),this.$el.empty().append(h.empty()),this.$noMoreContent&&this.$noMoreContent.hide(),this.$loadingMoreBtn&&this.$loadingMoreBtn.hide()},render:function(){var t=this,n;t.$el=e(".feedList").addClass("album_list").empty().append(h),t.$loadingMoreBtn=e("<a class='loadingBtn'>加载更多</a>").hide(),t.$noMoreContent=e("<span class='noMoreContent'>没有更多内容了哦</span>").hide(),t.$noContent=e('<div class="noItem"><span class="noItemTit">暂无内容</span><br><span><a hashlink href="/'+config.CURRENT_USER.uid+'/follow">关注</a> 更多人</span></div>').hide(),t.$pagingBar=e(".operationBar").empty().append(t.$loadingMoreBtn).append(t.$noMoreContent).append(t.$noContent),t.$loadingBar=e(".loadingMore"),t.getData()},doBindEvents:function(){var t=this,n=e(".feedMoreMessageBox");e(window).on("scroll",[t],t.onScroll),n.on("click",function(){n.hide(),t.doReset(),t.getData()}).hide(),p=setInterval(function(){e.ajax({url:"/feed2/no_read",dataType:"json",data:{feedType:"sound"},success:function(e){e.res&&e.sum?n.show().find("em").text(e.sum):n.hide()}})},3e4),t.$loadingMoreBtn.on("click",function(){t.$loadingMoreBtn.hide(),t.doChangePage(++t.page)})},onScroll:function(t){var n=t.data[0];if(n.locked||!n.$lastEl)return;clearTimeout(d),d=setTimeout(function(){var t=e(window).height(),r=e(window).scrollTop()+t;n.$lastEl.position().top<=r&&n.getData()},200)},doChangePage:function(e){this.model.set("page",(e-1)*3+1),this.locked=!1,this.count=0,this.getData()},doSetPaging:function(e){var t=this,n=Math.ceil(e.totalSize/t.model.get("pageSize")),r=0;t.count++,r=(t.page-1)*3+t.count,t.locked=t.count>=3||r>=n;if(t.locked){if(r>=n){if(e.totalSize==1&&t.count*t.page==1&&e.feeds[0].type==2){t.$noContent.show();return}t.$noMoreContent.show();return}t.$loadingMoreBtn.show()}},getData:function(){var t=new n.Model,r=this;if(r.locked)return;r.locked=!0,r.$loadingBar.show(),r.$noContent.hide(),e.ajax({url:"/feed2",dataType:"json",data:r.model.toJSON(),success:function(t){if(t.res){var n=t.feeds,i=t.albums;n.feeds.length&&(r.$con=e(document.createDocumentFragment()),e(n.feeds).each(function(){var e=t.users[this.uid];e&&(this.nickname=e.nickname,this.isVerified=e.isVerified,this.verifyType=e.verifyType),this.isPaid=i[this.albumId]&&i[this.albumId].isPaid?"":"hidden"}),r.feedCol.add(n.feeds),r.$el.append(r.$con),a.release(),a.init(),s.init(),window._bd_share_main&&_bd_share_main.init(),o.render({$container:e("#mainbox")}),r.model.set("timeline",n.feeds[n.feeds.length-1].timeline)),r.doSetPaging(n)}else alert(t.msg)},error:function(){c.alert("服务器错误！")},complete:function(){r.$loadingBar.hide()}})},release:function(){this.locked=!0,clearInterval(p),e(".feedMoreMessageBox").off("click"),e(window).off("scroll",this.onScroll),this.$loadingMoreBtn=null,this.$noMoreContent=null}});return new v({model:new l({feedType:"sound"})})}),define("module/feed/feed_event_view",["jquery","underscore","backbone","model/feed_new","collection/feed_new","module/player/player","module/card","module/common","plugin/dialog","plugin/jquery.pagination"],function(e,t,n,r,i,s,o,u,a){var f=['<div class="feed">','	<div class="left">','		<a class="userface" card="<%=uid%>" hashlink href="/<%=uid%>"> <img src="<%=helper.getFDFSPath(avatar,\'header\',60,60)%>" alt="<%-nickname%>" /></a>',"	</div>",'	<div class="right">','		<div class="feed_operate">','			<a href="javascript:;" class="closeBtn" title="删除"></a>',"		</div>",'		<div class="feed_title">','			<a card="<%=uid%>" hashlink href="/zhubo/<%=uid%>"><%-nickname%></a><%if(isVerified){%><i class="VIcon <%if(verifyType==2){%>blue<%}%>">&nbsp;</i><%}%>',"			<span>赞了<%=events.length%>个声音</span>","		</div>",'		<div class="feed_content">','			<ul class="like_sound_list">',"                                      ","			</ul>","		</div>",'		<div class="feed_bottom">','			<span class="feed_createtime"><%=helper.getDateNiceTime(timeline)%></span>',"		</div>","	</div>","</div>","<div class=\"moreBtn <%=!isShowMore?'hidden':''%>\">",'	<div class="bg"></div>','	<a href="#">展开更多赞的声音&nbsp;&nbsp;&nbsp;</a>',"</div>"],l=['	<div class="miniPlayer" sound_id="<%=trackId%>">','		<a class="playBtn play_btn"></a>','		<a class="title" hashlink href="/sound/<%=trackId%>"><%-trackTitle%><%=is_paid_html%></a>','		<span class="fr">','			来自 <span class="author1" href="javascript:;"><%-trackNickname%></span>',"		</span>","	</div>"],c=['    <div class="feed">','	    <div class="left">','		    <a class="userface" card="<%=uid%>" hashlink href="/zhubo/<%=uid%>"> <img src="<%=helper.getFDFSPath(avatar,\'header\',60,60)%>" alt="">',"		    </a>","	    </div>",'	    <div class="right">','		    <div class="feed_operate">','			    <a href="javascript:;" class="closeBtn" title="删除"></a>',"		    </div>",'		    <div class="feed_title">','			    <a card="<%=uid%>" hashlink href="/zhubo/<%=uid%>"><%-nickname%><%if(isVerified){%><i class="VIcon <%if(verifyType==2){%>blue<%}%>">&nbsp;</i><%}%></a><span>关注了<%=events.length%>个人</span>',"		    </div>",'		    <div class="feed_content">','			    <div class="personPanelBar2List">',"			    </div>	","            </div>	","    </div>","    <div class=\"moreBtn <%=isShowMore?'':'hidden'%>\">",'	    <div class="bg"></div>','	    <a href="#">展开更多他关注的人&nbsp;&nbsp;&nbsp;</a>',"    </div>"],h=['<div class="left">','	<a class="userface" hashlink href="/zhubo/<%=followUid%>" card="<%=followUid%>"><img src="<%=helper.getFDFSPath(followAvatar,\'header\',60,60)%>" alt=""></a>',"</div>",'<div class="right">',"	<div>",'		<a class="title" card="<%=followUid%>" hashlink href="/zhubo/<%=followUid%>" title="<%-followNickname%>"><%-followNickname%><%if(followIsV){%><i class="VIcon <%if(followVerifyType==2){%>blue<%}%>">&nbsp;</i><%}%></a>',"	</div>","	<div>",'		<a class="soundCount"><%=(followUsers.hasOwnProperty(followUid)?followUsers[followUid].tracks_count:0)%></a>','		<a class="followerCount"><%=(followUsers.hasOwnProperty(followUid)?followUsers[followUid].followers_count:0)%></a>',"	</div>","	<div>","       <a class=\"addBtn2 small <%if(followUsers.hasOwnProperty(followUid) && followUsers[followUid].is_follow){%>already<%}%>\" data-options=\"'uid':<%=followUid%>,'is_follow':<%=!!(followUsers.hasOwnProperty(followUid) && followUsers[followUid].is_follow)%>,'be_followed':false\">",'           <span class="default"><%=(followUsers.hasOwnProperty(followUid) && followUsers[followUid].is_follow)?"已":""%>关注</span><span class="hover">取消</span>',"       </a>","	</div>","</div>"],p=['    <div class="feed">','	    <div class="left">','		    <a class="userface" card="<%=uid%>" hashlink href="/zhubo/<%=uid%>"> <img src="<%=helper.getFDFSPath(avatar,\'header\',60,60)%>" alt=""></a>',"	    </div>",'	    <div class="right">','		    <div class="feed_operate">','			    <a href="javascript:;" class="closeBtn" title="删除"></a>',"		    </div>",'		    <div class="feed_title">','			    <a card="<%=uid%>" hashlink href="/zhubo/<%=uid%>"><%-nickname%><%if(isVerified){%><i class="VIcon <%if(verifyType==2){%>blue<%}%>">&nbsp;</i><%}%></a><span>收藏了<%=events.length%>个专辑</span>',"		    </div>",'		    <div class="feed_content">','			    <div class="personPanelBar2List">',"			    </div>	","            </div>	","    </div>","    <div class=\"moreBtn <%=isShowMore?'':'hidden'%>\">",'	    <div class="bg"></div>','	    <a href="#">展开更多他收藏的专辑&nbsp;&nbsp;&nbsp;</a>',"    </div>"],d=['<div class="left">','	<a hashlink href="/album/<%=albumId%>" class="userface"><span>   <%=(likedAlbums[albumId].is_paid ? \'<div class="tag-panel-r"><i class="iconpay iconpay-pay4"></i></div>\' : \'\')%> <img src="<%=helper.getFDFSPath(albumCover,\'album\',180,180)%>" alt=""></span></a>',"</div>",'<div class="right">',"	<div>",'		<a class="title" hashlink href="/album/<%=albumId%>" title="<%=albumTitle%>"><%-albumTitle%></a>',"	</div>","	<div>",'		<a class="soundCount"><%=(likedAlbums.hasOwnProperty(albumId)?likedAlbums[albumId].tracks_count:0)%></a>',"	</div>","</div>"],v=n.View.extend({className:"gapB",tagName:"li",template:t.template(l.join("")),render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("index")>2&&this.$el.addClass("hidden"),this.$el}}),m=n.View.extend({className:"listItem",tagName:"li",template:t.template(f.join("")),events:{"click .moreBtn ":"doExpandMore","click .closeBtn":"doHideItem"},doHideItem:function(){var t=this;if(t.locked)return;t.locked=!0,e.ajax({url:"/feed2/destroy_event_sfeed",dataType:"json",data:{key:t.model.get("key")},success:function(e){e.res?t.remove():a.alert(e.msg)},complete:function(){t.locked=!1}})},doExpandMore:function(t){var n=e(t.currentTarget),r=this.$el.find(".like_sound_list");return n.toggleClass("expand"),r.find(".hidden").slideToggle(),n.hasClass("expand")?r.attr("sound_ids",this.soundIDS.join(",")):r.attr("sound_ids",this.soundIDS.slice(0,3).join(",")),s.render(),!1},render:function(){var t=new n.Collection,r=e("<div></div>");return this.soundIDS=[],t.add(this.model.get("events")),t.each(function(e,t){e.set("index",t),this.soundIDS.push(e.get("trackId")),r.append((new v({model:e})).render())},this),this.model.set("isShowMore",this.model.get("events").length>3),this.$el.html(this.template(this.model.toJSON())),this.$el.find(".like_sound_list").append(r).attr("sound_ids",this.soundIDS.slice(0,3).join(",")),this.$el}}),g=n.View.extend({className:"personPanelBar2",tagName:"div",template:t.template(h.join("")),render:function(){return this.$el.html(this.template(t.extend({followAvatar:"",isVerified:!1,followVerifyType:0},this.model.toJSON()))),this.model.get("index")>2&&this.$el.addClass("hidden"),this.$el}}),y=n.View.extend({className:"listItem",tagName:"li",template:t.template(c.join("")),events:{"click .moreBtn ":"doExpandMore","click .closeBtn":"doHideItem"},doHideItem:function(){var t=this;if(t.locked)return;t.locked=!0,e.ajax({url:"/feed2/destroy_event_sfeed",dataType:"json",data:{key:t.model.get("key")},success:function(e){e.res?t.remove():a.alert(e.msg)},complete:function(){t.locked=!1}})},doExpandMore:function(t){var n=e(t.currentTarget),r=this.$el.find(".personPanelBar2List");return n.toggleClass("expand"),r.find(".hidden").slideToggle(),!1},render:function(){var t=new n.Collection,r=e("<div></div>");return t.add(this.model.get("events")),t.each(function(e,t){e.set("index",t),r.append((new g({model:e})).render())},this),this.model.set("isShowMore",this.model.get("events").length>3),this.$el.html(this.template(this.model.toJSON())),this.$el.find(".personPanelBar2List").append(r),this.$el}}),b=n.View.extend({className:"personPanelBar2",tagName:"div",template:t.template(d.join("")),render:function(){return this.$el.html(this.template(t.extend({albumCover:""},this.model.toJSON()))),this.model.get("index")>5&&this.$el.addClass("hidden"),this.$el}}),w=n.View.extend({className:"listItem",tagName:"li",template:t.template(p.join("")),events:{"click .closeBtn":"doHideItem","click .moreBtn ":"doExpandMore"},doExpandMore:function(t){var n=e(t.currentTarget),r=this.$el.find(".personPanelBar2List");return n.toggleClass("expand"),r.find(".hidden").slideToggle(),!1},doHideItem:function(){var t=this;if(t.locked)return;t.locked=!0,e.ajax({url:"/feed2/destroy_event_sfeed",dataType:"json",data:{key:t.model.get("key")},success:function(e){e.res?t.remove():a.alert(e.msg)},complete:function(){t.locked=!1}})},render:function(){var t=new n.Collection,r=e("<div></div>");return t.add(this.model.get("events")),t.each(function(e,t){e.set("index",t),r.append((new b({model:e})).render())},this),this.model.set("isShowMore",this.model.get("events").length>6),this.$el.html(this.template(this.model.toJSON())),this.$el.find(".personPanelBar2List").append(r),this.$el}}),E=n.View.extend({render:function(){switch(this.model.get("type")){case 1:return(new m({model:this.model})).render();case 2:return(new y({model:this.model})).render();case 3:return(new w({model:this.model})).render()}}});return E}),define("module/feed/feed_event_new",["jquery","underscore","backbone","model/feed_new","collection/feed_new","module/player/player","module/card","module/common","module/common/ifollow","module/feed/feed_event_view","module/feed/feed_arg","plugin/dialog","plugin/jquery.pagination"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=0,p=0,d=n.View.extend({feedCol:null,$con:null,locked:!1,count:0,page:1,initialize:function(){var e=this;a.init(),e.feedCol=new i,e.feedCol.on("add",function(t){e.$lastEl=(new f({model:t})).render(),e.$con.append(e.$lastEl)})},init:function(){this.doReset(),this.render(),this.doBindEvents(),e(".tab_title").text("新鲜事")},doReset:function(){this.model.set({page:1,timeline:0}),this.count=0,this.locked=!1,this.page=1,this.feedCol.reset(),this.$el.empty(),this.$noMoreContent&&this.$noMoreContent.hide(),this.$loadingMoreBtn&&this.$loadingMoreBtn.hide()},render:function(){var t=this,n;t.$el=e(".feedList").addClass("album_list").empty(),t.$loadingMoreBtn=e("<a class='loadingBtn'>加载更多</a>").hide(),t.$noMoreContent=e("<span class='noMoreContent'>没有更多内容了哦</span>").hide(),t.$noContent=e('<div class="noItem"><span class="noItemTit">没有更多内容了哦</span><br><span><a hashlink href="/'+config.CURRENT_USER.uid+'/follow">关注</a> 更多人</span></div>').hide(),t.$pagingBar=e(".operationBar").empty().append(t.$loadingMoreBtn).append(t.$noMoreContent).append(t.$noContent),t.$loadingBar=e(".loadingMore"),t.getData()},doBindEvents:function(){var t=this,n=e(".feedMoreMessageBox");e(window).on("scroll",[t],t.onScroll),n.on("click",function(){n.hide(),t.doReset(),t.getData()}).hide(),h=setInterval(function(){e.ajax({url:"/feed2/no_read",dataType:"json",data:{feedType:"event"},success:function(e){e.res&&e.sum?n.show().find("em").text(e.sum):n.hide()}})},3e4),t.$loadingMoreBtn.on("click",function(){t.$loadingMoreBtn.hide(),t.doChangePage(++t.page)})},onScroll:function(t){var n=t.data[0];if(n.locked||!n.$lastEl)return;clearTimeout(p),p=setTimeout(function(){var t=e(window).height(),r=e(window).scrollTop()+t;n.$lastEl.position().top<=r&&n.getData()},200)},doChangePage:function(e){this.model.set("page",(e-1)*3+1),this.locked=!1,this.count=0,this.getData()},doSetPaging:function(e){var t=this,n=Math.ceil(e.totalSize/t.model.get("pageSize")),r=0;t.count++,r=(t.page-1)*3+t.count,t.locked=t.count>=3||r>=n;if(t.locked){if(r>=n){if(e.totalSize==0){t.$noContent.show();return}t.$noMoreContent.show();return}t.$loadingMoreBtn.show()}},getData:function(){var t=new n.Model,r=this;if(r.locked)return;r.locked=!0,r.$loadingBar.show(),e.ajax({url:"/feed2",dataType:"json",data:r.model.toJSON(),success:function(t){if(t.res){var n=t.feeds,i=t.favorite_tracks;n.events.length&&(r.$con=e(document.createDocumentFragment()),e(n.events).each(function(){var n=t.users[this.uid];this.isVerified=!1,n&&(this.nickname=n.nickname,this.isVerified=n.isVerified,this.verifyType=n.verifyType),e(this.events).each(function(){this.followUsers=t.follow_users,this.likedAlbums=t.liked_albums,this.is_paid_html="",i[this.albumId]&&i[this.albumId].isPaid?i[this.albumId].discountedPrice?this.is_paid_html='<i class="iconpay iconpay-coin2 mgl-5">'+i[this.albumId].discountedPrice+"喜点</i>":i[this.albumId].isFree&&(this.is_paid_html='<span class="iconpay iconpay-free2 mgl-5"></span>'):this.is_paid_html=""})}),r.feedCol.add(n.events),r.$el.append(r.$con),a.release(),a.init(),s.init(),window._bd_share_main&&_bd_share_main.init(),o.render({$container:e("#mainbox")}),r.model.set("timeline",n.events[n.events.length-1].timeline)),r.doSetPaging(n)}else alert(t.msg)},error:function(){c.alert("服务器错误！")},complete:function(){r.$loadingBar.hide()}})},release:function(){this.locked=!0,clearInterval(h),e(".feedMoreMessageBox").off("click"),e(window).off("scroll",this.onScroll)}});return new d({model:new l({feedType:"event"})})}),define("page/home/feed",["jquery","underscore","backbone","module/feed/feed_sound_new","module/feed/feed_event_new","page/page_base"],function(e,t,n,r,i,s){var o=s.extend({init:function(){this.callParent("init"),this.bindEvents(),r.init()},release:function(){this.callParent("release"),r.release(),i.release()},bindEvents:function(){var t=e(".feedTab .tab_item");t.on("click",function(){var n=e(this);if(n.hasClass("on"))return!1;t.removeClass("on"),n.addClass("on");switch(n.attr("feedtype")){case"sound":i.release(),r.init();break;case"event":r.release(),i.init();break;default:return!1}return!1}),xmLog&&xmLog("pv.create",{item:"Web我的动态-上传入口",itemId:""}),e(".uploadBtn").off().on("click",function(){xmLog&&xmLog("pv.send","pageview",{serviceId:"pageview",item:e(this).attr("xmlog-item"),srcModule:e(this).attr("xmlog-mod"),srcPage:e(this).attr("xmlog-spg"),"function":e(this).attr("xmlog-fun")||""})})}});return new o}),define("page/home/mytracks",["jquery","page/page_base"],function(e,t){var n=t.extend({init:function(){this.callParent("init")},release:function(){this.callParent("release")}});return new n}),define("model/timeline",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{year:0,month:0,page:1,per_page:30},getTimeLineInfo:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/center/timeline_list",type:"get",dataType:"html",data:r.toJSON(),success:function(e,r,i){e.set(e.get("page")+1),r?t(e,r,i):n(e,r,i)}})}});return r}),define("module/common/ifeed",["jquery","underscore","backbone"],function(e,t,n){var r=n.View.extend({feedModel:null,init:function(){this.release(),e(".feed .feed_operate .closeBtn[feed_id]").on("click",[this],this.doDelFeed)},doDelFeed:function(t){var n=e(this),r=n.attr("feed_id"),i=t.data[0];i&&r&&(i.model.set("feedID",r),i.model.deleteFeed(function(e,t,r){n.closest(".listItem").fadeOut(200)},function(e,t,n){}))},release:function(){e(".feed .feed_operate .closeBtn[feed_id]").off("click")}});return new r({model:null})}),define("module/blacklist",["jquery","plugin/dialog","model/setting","module/user"],function(e,t,n,r){var i=new n,s={add:function(n,s,o){o=o||e.noop;var u="确认将"+n+"加入到我的黑名单中么？<br/>(你和他将自动解除关注关系，并且他不能再关注你，他不能再给你发评论、私信、@通知。)";t.confirm(u,function(){i.addBackList(s,function(e){r.cacheUser({id:s,is_follow:!1,be_followed:!1,is_black:!0}),r.render({ids:[s]}),t.success("拉黑成功"),o(e)},function(e){t.alert(e.message||"添加失败")})})},remove:function(n,s,o){o=o||e.noop,t.confirm("你确定要将"+n+"从你的黑名单中解除么？",function(){i.removeBackList(s,function(e){r.cacheUser({id:s,is_black:!1}),r.render({ids:[s]}),t.success("移除成功"),o(e)},function(e){t.alert(e.message||"移除黑名单失败")})})}};return s}),define("plugin/jquery.timeline",["jquery","plugin/jquery.parser"],function(e){function n(e,t){if(isNaN(t)||t>e.length)return!1;for(var n=0,r=0;n<e.length;n++)e[n]!=e[t]&&(e[r++]=e[n]);e.length-=1}function r(e,t,n){e.splice(t,0,n)}function i(){var t,n;return n=document.documentElement.scrollHeight,t=e(document).scrollTop(),{top:t,height:n}}function o(e,t,n){var r=i();if(e.size){var o=e.offset();if(o){var u=o.top,a=0;u<r.top?(u+=t,n===!0&&(u-=8),a=20):(u+=t,n===!0&&(u+=8),a=-20);var f=Math.abs(u-r.top),l=f/250*45+f%30;l<800?l=800:l>2e3&&(l=2e3),s.stop().animate({scrollTop:u},l)}}}function u(e){e&&e.sort(function(e,t){return t-e})}function a(e,t,n,r){var i=t.length-1,s=0,o=i,u=0,a;e=e[n];while(s<=o){u=parseInt((s+o)/2),a=t[u][n];if(a>=e){if(a==e&&r!==!0)return u;if(u==0)return-1;a=t[u-1][n];if(a<=e)return u-1;o=u-1,o<0&&(o=0)}else{if(!(a<e))return u;if(u==i)return u;a=t[u+1][n];if(a==e&&r!==!0)return++u;if(a>e)return u;s=u+1,s>i&&(s=i)}}return i}function f(e,t,n){var r=0,i=t.length-1,s=0,o;n=n||"z";if(r==i)return t[s][n]==e[n]?0:-1;while(r<=i){s=parseInt((r+i)/2),o=t[s];if(o[n]>e[n])i=s-1;else{if(!(o[n]<e[n]))return s;r=s+1}}return-1}function l(e,t){if(typeof t=="object"){var n=0,r=t.length-1,i=0,s;if(n==r)return t[i]==e?0:-1;while(n<=r){i=parseInt((n+r)/2),s=t[i];if(s>e)n=i+1;else{if(!(s<e))return i;r=i-1}}}return-1}function c(t){var n=e.data(t,"timeline"),r=n.options,i=n.lineobjs.timeLineBar.find("[data-rel='timeLineBarList']"),s=[];r.markers.length=0,r.years.length=0,r.combineYears.length=0,r.yearInfo={},e(i).find("li > a.timelineYear").each(function(){var n=e(this),i=n.attr("data-time");i&&(r.yearInfo[i]={loaded:[],months:[],isLoadMonth:!1,closed:i==r.birthYear+"",overed:i==r.birthYear+"",dom:null,combine:[],currentMonth:0,value:n.attr("data-time")},r.years.push(i),n.off("click").on("click",null,[t],h))})}function h(t){var n=t.data[0],r=e.data(n,"timeline").options,i=e(t.currentTarget),s=i.attr("data-time"),o=r.yearInfo[s];return o&&(o.isLoadMonth?v(n,s):r.onYearSelect.call(n,i,s)),!1}function p(e,t){var n=e.timeline("options"),r=a(t,n.markers,"top");r<0&&(r=0);if(n.markers[r].year!=t.year||n.markers[r].month!=t.month)n.markers[r].year<t.year||(n.markers[r].year>t.year?r++:n.markers[r].month>t.month?r++:r++);if(r!=-1)for(var i=r+1,s=n.markers.length;i<s;i++){var t=n.markers[i];t.top=t.marker.offset().top}}function d(t,r){var i=e.data(t,"timeline"),s=i.options,o=s.yearInfo[r.year];if(o){u(r.months);while(o.months.length){var a=o.months[0];l(a,r.months)==-1&&r.months.push(a),n(o.months,0)}u(r.months),o.pages=[],o.months=r.months,o.dom=r.dom,o.isLoadMonth=!0,r.dom.find("[data-time]").off("monthclick").on("monthclick",function(){var n=e(this).attr("data-time");return v(t,r.year,n),!1}).off("click").on("click",function(){s.isClick=!0,e(this).trigger("monthclick")}),r.doClick!==!1&&v(t,r.year)}}function v(t,n,r){var i=e.data(t,"timeline"),s=i.options,u=e(i.lineobjs.timeLineBar),a=e(i.lineobjs.container),f=s.yearInfo[n];!r&&f.months.length>0&&(r=f.months[0]);if(r){var c=l(r,s.yearInfo[n].loaded);if(c==-1&&!s.locked){if(s.currentYear&&s.currentYear!=n){lastYearInfo=s.yearInfo[s.currentYear];var h={newYear:{yearInfo:s.yearInfo[n],index:l(n,s.years),value:n},oldYear:{yearInfo:s.yearInfo[s.currentYear],index:l(s.currentYear,s.years),value:s.currentYear}};h.oldYear.index<h.newYear.index&&s.canScroll&&m(t,h),s.onYearChange.call(t,h)}f.months.length<=1&&s.years[0]==n&&f.dom.hide(),f.pages[""+r]=1,s.onMonthSelect.call(t,parseInt(n),parseInt(r))}else s.canScroll&&o(a.find("#marker"+n+""+r),-30)}}function m(t,n){var r=e.data(t,"timeline"),i=r.options,s=e(r.lineobjs.container),o=[];for(var u=n.oldYear.index;u<n.newYear.index;u++){var a=i.yearInfo[i.years[u]];if(a){a.closed||o.push(a.value);if(l(0,a.months)==-1){a.months.push(0),a.loaded.push(0),a.overed=!0;if(a.closed){var f=l(0,a.loaded);f>0&&(a.currentMonth=a.loaded[f-1]),E(t,{year:a.value,month:a.currentMonth>=0?a.currentMonth:a.months[0],isAppend:!1})}a.closed=!0}}}s.append(T(t,i,o))}function g(t){var n=e(t);return{timeLineBar:n.find("[data-rel='timeLineBar']"),container:n.find("[data-rel='timeLineContainer']")}}function y(t){var n=e.data(t,"timeline"),r=n.options,i=e(n.lineobjs.timeLineBar),s=e(n.lineobjs.container);r.offset=s.offset().top,r.onInit.call(t,r)&&r.currentYear&&i.find("[data-time='"+r.currentYear+"']").click()}function b(t,n){var r=e.data(t,"timeline");if(!r)return;var s=r.options,o=e(r.lineobjs.container),u=i(),f=n.dom.height(),l=!1;n.year<s.currentYear?l=!0:n.year==s.currentYear&&n.month<=s.currentMonth&&(l=!0);var c=n.dom.offset(),h=a(c,s.markers,"top");h<0&&(h=0);if(s.markers[h].year!=n.year||s.markers[h].month!=n.month)s.markers[h].year<n.year||(s.markers[h].year>n.year?h++:s.markers[h].month>n.month?h++:h++);s.markers[h].isLoad||(s.markers[h].dom=n.dom),s.markers[h].isAppend=n.isAppend,s.markers[h].isLoad=!1,s.markers[h].htm=n.htm,l&&w(s.markers[h],h,s),s.locked=!1,s.canScroll=!0,C(t,n,u)}function w(e,t,n){var r=!1;if(!e.isLoad&&e.dom){e.year<n.currentYear?r=!0:e.year==n.currentYear&&e.month<=n.currentMonth&&(r=!0);if(r||!0){e.isLoad=!0,e.isAppend===!0?e.dom.append(e.htm):e.dom[0].innerHTML=e.htm?e.htm:"&nbsp;",e.htm="";if(t>=0){var i=0;for(var s=t,o=n.markers.length;s<o;s++)i=parseInt(n.markers[s].marker.offset().top),n.markers[s].top=i}n.onAppendData.call(e,t)}}return r}function E(t,r){var s=e.data(t,"timeline"),a=s.options,f=e(s.lineobjs.container),c=i(),h=a.yearInfo[r.year],p=e(a.setLoading(r.year,r.month)),d=null,v=[],m=[],g=[],y=[],b=-1,w;r.month=parseInt(r.month),r.year=parseInt(r.year);if(h){b=l(r.month,h.loaded),b==-1&&(h.loaded.push(r.month),u(h.loaded),h.currentMonth=r.month),h.closed=!0;var E=l(r.month,h.loaded);if(E>=0){var N=h.loaded[E-1],C=E<h.loaded.length-1?h.loaded[E+1]:-1;for(var k=r.month*1+1;k<N;k++)l(k,h.months)>-1&&v.push(k);if(C>=0)for(var k=C*1+1;k<r.month*1;k++)l(k,h.months)>-1&&m.push(k)}for(var k=0;k<h.combine.length;k++){var L=h.combine[k];if(r.month>=L.start&&r.month<=L.end){d=L.dom,n(h.combine,k),r.isConbineYear=!0;break}}if(!d)for(var k=0;k<a.combineYears.length;k++){var L=a.combineYears[k];if(r.year>=L.start&&r.year<=L.end){d=L.dom,r.isConbineMonth=!0;var A=l(r.year,a.years),O=l(L.start,a.years),M=l(L.end,a.years);for(var _=A+1;_<=O;_++)y.push(parseInt(a.years[_]));for(var _=M;_<A;_++)g.push(parseInt(a.years[_]));n(a.combineYears,k);break}}d?(r.isReloadTop=!0,d.before(T(t,a,g)),d.before(x(t,a,v,h)),b==-1&&r.isAppend&&(w=e(a.setMarker(r.year,r.month)),d.before(w).before(p)),d.before(x(t,a,m,h)),d.before(T(t,a,y)),d.remove()):(r.isReloadTop=!1,f.append(T(t,a,g)),f.append(x(t,a,v,h)),b==-1&&r.isAppend&&(w=e(a.setMarker(r.year,r.month)),f.append(w).append(p)),f.append(x(t,a,m,h)),f.append(T(t,a,y))),w&&w.size()&&S(a.markers,{marker:p,year:r.year,month:r.month,isReloadTop:r.isReloadTop},!1),h.loaded.length==h.months.length&&(h.overed=!0)}return r.isAppend&&a.canScroll&&o(f.find("#marker"+r.year+""+r.month),-30,!0),a.locked=a.isSingle,a.canScroll=!0,p}function S(e,t,n){var i={year:t.year,month:t.month,top:parseInt(t.marker.offset().top),height:t.marker.height(),marker:t.marker,dom:null,isLoad:!1,htm:""};t.closeMonth===!0&&n&&n.size()&&E(n[0],{month:t.month,year:t.year,isAppend:!1});if(!e.length)e.push(i);else{var s=a(i,e,"top"),o=0,u=0,f=0,l=s;s<0&&(s=0);for(var c=s,h=e.length;c<h;c++)l==c?(u=parseInt(e[c].marker.offset().top),o=parseInt(u-e[c].top),!o||o<0?l++:e[c].top=u):e[c].top+=o;e[s].year<t.year?r(e,s,i):e[s].year>t.year?r(e,s+1,i):e[s].month>t.month?r(e,s+1,i):r(e,s,i)}}function x(t,n,r,i){var s=null;return r.length>0&&(r.length==1?(s=e(n.setCombineMarker(!0,i.value,r[0])),i.combine.push({start:r[0],end:r[0],dom:s})):(s=e(n.setCombineMarker(!0,i.value,r[0],r[r.length-1])),i.combine.push({start:r[0],end:r[r.length-1],dom:s})),i.currentMonth=r[0],s.off().on("click",function(){return v(t,i.value,r[r.length-1]),!1})),s}function T(t,n,r){var i=null,s=e.data(t,"timeline"),o=e(s.lineobjs.timeLineBar);return r.length>0&&(r.length==1?(i=e(n.setCombineMarker(!1,0,r[0])),n.combineYears.push({start:parseInt(r[0]),end:parseInt(r[0]),dom:i})):(i=e(n.setCombineMarker(!1,0,r[0],r[r.length-1])),n.combineYears.push({end:parseInt(r[0]),start:parseInt(r[r.length-1]),dom:i})),i.off().on("click",function(){return o.find("[data-time='"+r[0]+"']").click(),!1})),i}function N(t,n){var r=e.data(t,"timeline"),s=r.options,o=new Date;if(s.locked&&n!=1)return;var u=i(),f=-1,l=e(r.lineobjs.timeLineBar),f=a(u,s.markers,"top"),c=s.markers[f]||{top:-1e4},h=s.markers[f-1]||{top:-1e4},p=s.markers[f+1]||{top:-1e4},d=e.extend({},h);d.top!=-1e4?c.top<=u.top&&(p.top+s.offsetTop>=0&&p.top+s.offsetTop<=u.top?d=p:d=c):(d=c,d.top!=-1e4&&p.top<=u.top&&p.top!=-1e4&&(d=p));if(d.top!=-1e4){var v=s.yearInfo[d.year];if(!v)return;s.currentYear!=d.year&&(s.currentYear=d.year,l.find("."+s.currentCls).removeClass(s.currentCls),l.find("[data-time='"+d.year+"']").parent().addClass(s.currentCls)),v.dom&&(v.dom.find("[data-time]").parent().removeClass(s.currentCls),v.dom.find("[data-time='"+d.month+"']").parent().addClass(s.currentCls)),s.currentMonth=d.month,w(d,f,s)}C(t,e.extend({},s.markers[s.markers.length-1]),u)}function C(n,r,s){s=s||i(),clearTimeout(t),t=setTimeout(function(){var t=e.data(n,"timeline"),i=t.options,o=e(t.lineobjs.timeLineBar),u;u=i.yearInfo[r.year];if(u&&s.height-s.top-i.scrollBottom<i.viewHeight){var a=l(r.month,u.months);if(a>=0&&a<u.months.length-1)r.month=u.months[a+1];else{var f=l(r.year,i.years);if(f>=0&&f<i.years.length-1){r.year=i.years[f+1];var u=i.yearInfo[r.year];u?(r.month=u.currentMonth,r.month||(r.month=u.months[0])):r=null}else r=null}r&&(i.canScroll=!1,u.isLoadMonth?r.month>0&&(v(n,r.year,r.month),i.canScroll=!0):o.find("[data-time='"+r.year+"']").trigger("click"))}},200)}var t=0,s=e("html, body");e.fn.timeline=function(t,n){return typeof t=="string"?e.fn.timeline.methods[t](this,n):(t=t||{},this.each(function(){var n=e.data(this,"timeline");n?e.extend(n.options,t):n=e.data(this,"timeline",{options:e.extend({},e.fn.timeline.defaults,e.fn.timeline.parseOptions(this),t),lineobjs:g(this)}),c(this),y(this)}))},e.fn.timeline.methods={options:function(t,n){return n=n||"options",e.data(t[0],"timeline")[n]},setMonths:function(e,t){d(e[0],t)},setData:function(e,t){b(e[0],t)},closeMonth:function(e,t){return E(e[0],t)},destroy:function(n,r){clearTimeout(t),e.data(n[0],"timeline",null)},scroll:function(e,t){N(e[0],t)},resetHeight:function(e,t){p(e,t)},resize:function(t){var n=t.timeline("options");n.viewHeight=e(window).height(),N(t[0])},addMarker:function(t,n){var r=e(t).timeline("options");S(r.markers,n,t),r.locked=!1,n.closeMonth===!0&&r.onAppendData.call(n,0)}},e.fn.timeline.parseOptions=function(t){var n=e(t);return e.extend({},e.parser.parseOptions(t,[{showBar:"boolean",fixed:"boolean"}]))},e.fn.timeline.defaults=e.extend({},{canScroll:!1,locked:!1,diffHeight:0,scrollBottom:200,showBar:!0,fixed:!0,viewHeight:500,markers:[],years:[],combineYears:[],offsetTop:-340,model:null,isSingle:!0,currentCls:"current",birthYear:2007,birthMonth:12,yearInfo:{},setLoading:function(){},setMarker:function(){},setCombineMarker:function(){},onYearSelect:function(){},onMonthSelect:function(){},onYearChange:function(){},onAppendData:function(){},onInit:function(){return!0},currentYear:0,currentMonth:0})}),define("module/my/timeline",["jquery","underscore","backbone","model/user","model/timeline","module/common/ifeed","module/common/ifollow","module/common/iletter","module/player/player","module/card","module/feed_group/followmanager","module/common/ireport","module/blacklist","plugin/dialog","module/dialogs/city","module/dialogs/share2friend","plugin/jquery.selecter","plugin/jquery.timeline"],function(e,t,n,r,i,s,s,o,u,a,f,l,c,h,p,d){var v=n.View.extend({init:function(){var n=e(".timeline"),i=e(".user_detail_left"),a=i.find(".userIntro"),f=a.find("span"),d=i.find(".userIntroEdit textarea"),v=this;e(".user_detail_left .area.own").on("click",function(){var n=e(this);p.open(function(e,i){var s=new r;s.set("province",e),s.set("city",i),s.doChangeArea(function(){var r=["<span>",'<a href="javascript:;"><%=pro%></a>','&nbsp;•&nbsp;<a href="javascript:;"><%=city%></a>',"</span>"];n.html(t.template(r.join(""))({pro:e,city:i}))},function(e,t){h.alert(t.msg)})})}),i.find(".editDescription").on("click",function(){a.toggle(),i.toggleClass("is-intro-edit"),d.data("val",d.val())}),i.find(".cancel").on("click",function(){a.toggle(),i.toggleClass("is-intro-edit"),d.val(d.data("val"))}),i.find(".editConfirm").on("click",function(){var t=e.extend({},e.parser.parseOptions(this,[{locked:"boolean"}])),n=d.val(),s=e(this);if(t.locked!==!0){t.locked=!0,helper.doChangeOptions(s,t);var o=new r({personalSignature:n});o.doChangeDes(function(){h.success("更改成功"),a.toggle(),i.toggleClass("is-intro-edit"),t.locked=!1,helper.doChangeOptions(s,t),f.text(n.length>70?n.substring(0,70)+"...":n)},function(e,n){h.alert(n.msg),t.locked=!1,helper.doChangeOptions(s,t)})}}),e(".more_operate").selecter({disabled:!0,onChange:function(t){if(t==1)l.doReport1(this,l);else if(t==2){var n=e.extend({},e.parser.parseOptions(this,[{uid:"number",nickname:"string",isBlack:"boolean"}])),r=e(this);n.nickname&&n.uid&&(n.isBlack?c.remove(n.nickname,n.uid):c.add(n.nickname,n.uid))}else if(t==3){var n=e.extend({},e.parser.parseOptions(this,[{uid:"number"}]));v.copyLocation(n)}return!1}}),e(".copy_link").on("click",function(){v.copyLocation({uid:config.CURRENT_USER.uid})}),u.init(),o.bind(e(".letterBtn")),s.init(),v.$soundList=e("#index_sounds_wrap"),v.doBindSounds()},doBindSounds:function(){var t=this;t.$soundList.on("click","a[data-page]",function(){var n=e(".pagingBar_wrapper"),r=e(this),i=n.attr("url"),s=r.attr("data-page");e.ajax({url:i,data:{page:s},success:function(e){e.res?(t.$soundList.empty().append(e.html),helper.scrollTo(t.$soundList,-20),u.init(),window._bd_share_main&&_bd_share_main.init()):h.alert(e.msg)}})})},copyLocation:function(e){var t=d.createPop2(e.uid);t.open()},release:function(){u.release(),a.release(),s.release()}});return new v({model:new i})}),define("page/home/timeline",["jquery","underscore","backbone","page/page_base","module/my/timeline","module/my/soundwallbg"],function(e,t,n,r,i,s){var o=r.extend({init:function(){this.callParent("init"),i.init(),s.init(),this.bindEvents()},bindEvents:function(){},unbindEvents:function(){e(".picWall .next-page").off()},release:function(){this.unbindEvents(),i.release(),s.release(),this.callParent("release")}}),u=new o;return u}),define("page/home/index_user_new",["jquery","underscore","backbone","page/page_base","module/user","page/home/timeline"],function(e,t,n,r,i,s){var o=r.extend({init:function(){this.callParent("init"),i.render({fields:["uid","is_follow","be_followed","is_black"]}),s.init(),this.bindEvents()},bindEvents:function(){e("#share_btn").on("click",function(){e("#share_div").toggle()}),e("#share_btn").blur(function(){e("#share_div").hide()})},unbindEvents:function(){e(".picWall .next-page").off()},release:function(){this.unbindEvents(),this.callParent("release")}}),u=new o;return u}),define("page/message/referme",["jquery","page/page_base","module/comment_box","plugin/dialog"],function(e,t,n,r){var i=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),this.bindEvents()},bindEvents:function(){var t=this;this.$el.on("click",".msg_notice_list .replyBtn",function(){var n=e(this);t.replyBox(n)})},replyBox:function(t){var i=e.parseJSON(t.attr("data-options")),s=t.closest(".msg_notice_item"),o=s.find(".reply_box_entry");if(o.children().size()==0){o.html(this.getReplyBoxHtml());var u=o.find(".commentBox"),a=u.find("textarea"),f=u.find(".commentBox_inputBox");u.hide().slideDown();var l=f.find("input");l.on("focus",function(){return f.addClass("is-onEdit focus"),a.focus(),!1}),a.on({blur:function(){f.removeClass("focus"),e.trim(a.val())||f.removeClass("is-onEdit")},focus:function(){f.addClass("is-onEdit focus"),u.height("auto"),a.val()||a.val("回复@"+i.c_nickname+":")}}),new n({$el:u,parentId:i.c_id,trackId:i.t_id,second:i.c_second,$input:a,isForward:!1,success:function(e){r.success("回复成功")}})}else o.find(".commentBox").slideToggle()},getReplyBoxHtml:function(){return this.replyBoxHtml||(this.replyBoxHtml=e("#reply_box_template").html()),_.template(this.replyBoxHtml,{logoPic60:config.CURRENT_USER.logoPic60})},release:function(){this.callParent("release")}});return new i}),define("page/message/comment",["jquery","page/page_base","page/message/referme","plugin/dialog","model/comment"],function(e,t,n,r,i){var s=t.extend({model:new i,init:function(){this.callParent("init"),n.init(),this.$el=e("#mainbox"),this.bindEvents()},bindEvents:function(){var t=this;this.$el.on("click",".destroyBtn",function(){t.destroyComment(e(this))})},destroyComment:function(t){var n=e.parseJSON(t.attr("data-options")),i=t.closest(".msg_notice_item"),s=this;r.confirm("确定删除？",function(){s.model.set({track_id:n.t_id,comment_id:n.c_id,message_id:n.message_id,type:n.type}),s.model.delMycenter(function(){i.slideUp(),r.success("删除成功")},function(e,t){r.alert(t.msg||"服务器繁忙,请稍后再试!")})})},release:function(){this.callParent("release"),n.release()}});return new s}),define("module/message/letter",["jquery","underscore","backbone","module/common/iletter"],function(e,t,n,r){var i=n.View.extend({init:function(){r.init(),r.bind(e(".msg_notice_item .detail_bottom .right a")),r.bindDel(e(".msg_notice_item .close"))},release:function(){r.release()}});return new i}),define("module/message/reported",["jquery","underscore","plugin/pops","plugin/jquery.input"],function(e,t,n){function s(e){this.btnCls=e.btnCls||".js-report",this.reportsArr=e.reports,console.log(this.reportsArr),this.reportsParams={},this.init()}var r=t.template('<i class="icon9 icon-closed fr"></i><h3>举报原因</h3><form class="cl radio-content"><% _.each(reports, function(item) {%><label class="xm-radio"><input type="radio" name="report_conf_id" value="<%= item.id %>"><%= item.title %></label><% }) %><textarea class="hidden" name="remark"></textarea></form><div class="button wid-90"><a class="inl-b btn-com">提交</a></div>'),i=t.template('<i class="icon9 icon-closed fr"></i><div class="icon-success"></div><p class="mgt-10 txt-mid2">举报成功</p><p class="mgt-10 mgb-20 txt-sm">感谢您对我们工作的支持</p>');return s.prototype={constructor:s,init:function(t){this.reportModal=new n.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden reported-dialog",closeBtn:"icon-closed",template:r({reports:this.reportsArr})}),this.successModal=new n.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden reported-success-dialog",closeBtn:"icon-closed",template:i()}),e("input").beautify(),this.bindEvents(),this.bindReportEvents()},bindEvents:function(){var t=this;e(document).off().on("click",".js-report",function(n){var r=e(this);t.reportsParams=JSON.parse(r.attr("data-options")),t.resetParams(),t.reportModal.open()})},bindReportEvents:function(){var t=this,n=e(this.reportModal.getEl()),r=n.find(".radio-content"),i=n.find(".btn-com");r.on("click",".xm-radio",function(t){e(this).text()=="其他"?e('[name="remark"]').removeClass("hidden"):e('[name="remark"]').addClass("hidden")}),i.on("click",function(n){if(!r.find(".xm-is-checked").length)return!1;t.successModal.open();var i=r.serialize()+"&"+e.param(t.reportsParams);t.submit(i).then(function(e){t.reportModal.close()}),setTimeout(function(){t.successModal.close()},1500)})},submit:function(t){var n=e.Deferred();return e.ajax({url:"/msgcenter/report_letter",type:"post",data:t,success:function(e){e.res?n.resolve(e):n.reject()},error:function(e){n.reject(e)}}),n},resetParams:function(t){e('[name="remark"]').val("").addClass("hidden"),e(".radio-content .xm-radio").each(function(){e(this).removeClass("xm-is-checked"),e(this).find('[type="radio"]')[0].checked=!1})}},s}),define("page/message/letter",["jquery","page/page_base","module/message/letter","module/xchat/common","module/message/reported"],function(e,t,n,r,i){var s=r.xchatLetter,o=function(e){},u=t.extend({init:function(t){var o=t.reports,u=location.pathname,a=location.search.replace(/^\?/,"");(!s||!r.isActived())&&e(".mainbox_wrapper").removeClass("hidden"),this.callParent("init"),n.init(),new i({reports:o,btnCls:".js-report"})},release:function(){this.callParent("release"),n.release()}});return new u}),define("module/message/letterdetail",["jquery","underscore","backbone","model/letter","plugin/count_char","plugin/face","module/common/iletter","plugin/dialog","plugin/twemoji/twemoji","module/xchat/common","module/xchat/parseface"],function(e,t,n,r,i,s,o,u,a,f,l){var c=['    <div class="content_wrap_left">','        <div class="picture">','            <img alt="<%=nickname%>" src="<%=avatar_path%>">',"        </div>",'        <div class="detail">','            <div class="detail_letter">','                <div class="others_letter">','                    <div class="letter_content">',"                        <div>","                            <%=content%>","                        </div>",'                        <div class="pubdate">刚刚</div>','                        <span class="arrow_left"></span>',"                    </div>","                </div>","            </div>","        </div>","    </div>"].join(""),h=n.View.extend({template:t.template(c),tagName:"li",className:"letter_detail_item",render:function(){return this.$el.html(a.parse(l(this.template(this.model.toJSON())))),this.$el}}),p=n.View.extend({initialize:function(){this.model.on("invalid",function(e,t){u.alert(t)})},init:function(){this.initBindSend(),this.initDelALl()},initDelALl:function(){var t=this,n=e(".letter_del_all"),r=n.find(".btn_wrap"),i=n.find(".btn_wrap.cancel"),s=n.find(".btn_wrap.confirm"),o=e("#message_count");r.on("click",function(){e(".msg_body").addClass("is-del")}),i.off("click").on("click",function(){e(".msg_body").removeClass("is-del")}),s.off("click").on("click",function(){var n=this,r=e.parser.parseOptions(n,[{lock:"boolean"}]),i=e(".letter_detail_list").find("input[type='checkbox']:checked"),s=e.makeArray(i),a=e.map(s,function(e){return e.value});r.lock!==!0&&(a.length?(r.lock=!0,helper.doChangeOptions(e(n),r),t.model.set({ids:a},{silent:!0}),t.model.delArray(function(){u.success("删除成功"),o.text(o.text()*1-a.length),i.closest("li.letter_detail_item").remove(),e(".msg_body").removeClass("is-del"),r.lock=undefined,helper.doChangeOptions(e(n),r)},function(t,i){r.lock=undefined,helper.doChangeOptions(e(n),r),u.alert(i.msg)})):u.alert("请至少选择一封私信。"))})},initBindSend:function(){var t=this,r=e(".letter_send"),o=r.find(".submitBtn"),a=r.find(".faceBtn"),l=r.find(".charCount"),c=r.find(".letter_input"),p=e(".letter_detail_list"),d=e("#message_count");i(c,l,300,{text:"还剩<em>{count}</em>字",passText:"超出<em>{count}</em>字"}),s.init(a,c),o.off("click"),o.on("click",function(){var r=this,i=e.extend({},e.parser.parseOptions(r,[{nickname:"string",lock:"boolean"}]));e(this).attr("id","wsSendMsg");if(!i.lock==1){i.lock=!0,helper.doChangeOptions(e(r),i);var s=c.attr("pass");t.model.set({id:i.id,nickname:"000",content:"000"},{silent:!0}),s||(s=0),t.model.set({nickname:i.nickname,content:c.val(),pass:s});if(t.model.isValid()){var o=function(t){e(".letter_send .letter_input").val(""),u.success("发送成功"),i.lock=undefined,helper.doChangeOptions(e("#wsSendMsg"),i),e("#message_count").text(e("#message_count").text()*1+1),t.avatar_path=e(r).closest(".content_wrap_left").find(".picture img").attr("src");var s=(new h({model:new n.Model(t)})).render();e(".letter_detail_list").prepend(s)},a=function(t,n){i.lock=undefined,helper.doChangeOptions(e(r),i),u.alert(n.msg)};f.isActived()?f.sendLetter(t.model,function(e){var n=e.data,r={content:n.msg_content,uid:n.send_id,nickname:t.model.get("nickname")};o(r)},a):t.model.add(function(e,t){o(t.res)},a)}else i.lock=!1,helper.doChangeOptions(e(r),i)}})},release:function(){}});return new p({model:new r})}),define("page/message/letterdetail",["jquery","page/page_base","module/message/letterdetail","module/xchat/common","module/message/reported"],function(e,t,n,r,i){var s=r.xchatLetter,o=location.pathname,u=function(e){s.singMsgReadACK({sendId:e.send_id,msgId:e.msg_id}),r.loadPage(o)},a=t.extend({init:function(t){var o=t.reports;s&&s.remove("receiveSinMsg",u),s&&s.on("receiveSinMsg",u),(!s||!r.isActived())&&e(".mainbox_wrapper").removeClass("hidden"),this.callParent("init"),n.init(),new i({reports:o,btnCls:".js-report"})},release:function(){s&&s.remove("receiveSinMsg",u),this.callParent("release"),n.release()}});return new a}),define("model/notice",["jquery","underscore","backbone","json2"],function(e,t,n,r){var i=n.Model.extend({defaults:{id:0},deleteNotice:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/destroy_notice",type:"post",dataType:"json",data:{id:this.get("id")},success:function(e,r,i){r.result&&r.result=="success"?t(e,r,i):n(e,r,i)}})},deleteLike:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/destroy_like",type:"post",dataType:"json",data:{id:this.get("id")},success:function(e,r,i){r.result&&r.result=="success"?t(e,r,i):n(e,r,i)}})}});return i}),define("module/message/like",["jquery","underscore","backbone","model/notice","module/common/ireport","plugin/jquery.parser"],function(e,t,n,r,i){var s=n.View.extend({init:function(){var t=this;e(".close").on("click",function(){var n=this,r=e.extend({},e.parser.parseOptions(n,[{id:"number"}]));r.id&&(t.model.set("id",r.id),t.model.deleteLike(function(){e(n).closest(".msg_notice_item").slideUp()},function(e,t){alert(t.msg)}))}),i.init()},release:function(){i.release()}});return new s({model:new r})}),define("page/message/like",["jquery","page/page_base","module/message/like"],function(e,t,n){var r=t.extend({init:function(){this.callParent("init"),n.init()},release:function(){this.callParent("release"),n.release()}});return new r}),define("module/message/notice",["jquery","underscore","backbone","model/notice","plugin/jquery.parser"],function(e,t,n,r){var i=n.View.extend({init:function(){var t=this;e(".close").on("click",function(){var n=this,r=e.extend({},e.parser.parseOptions(n,[{id:"number"}]));r.id&&(t.model.set("id",r.id),t.model.deleteNotice(function(){e(n).closest(".msg_notice_item").slideUp()},function(e,t){alert(t.msg)}))})},release:function(){}});return new i({model:new r})}),define("page/message/notice",["jquery","page/page_base","module/message/notice"],function(e,t,n){var r=t.extend({init:function(){this.callParent("init"),n.init()},release:function(){this.callParent("release"),n.release()}});return new r}),define("page/message/group_send",["jquery","page/center/common","page/page_base","plugin/face","plugin/dialog","plugin/twemoji/twemoji","plugin/pops"],function(e,t,n,r,i,s,o){var u=n.extend({init:function(){this.callParent("init"),t.init(),e(".selecter").selecter();var n=this,s=!0,o=0,u=e(".j-sendBox"),a=e(".j-recNum"),f=e(".j-seLv2"),l=e(".j-text"),c=e(".j-sendBtn"),h=e(".j-msgBox"),p=e(".j-warnTip");r.init(e(".j-face"),l),n.checkCount(l,c,300),e(".j-addBtn").click(function(){e(this).addClass("hidden"),u.removeClass("hidden")}),e(".j-clsBtn").click(function(){u.addClass("hidden"),e(".j-addBtn").removeClass("hidden")}),e(".selecter").find("li").click(function(){var t=e(this);a.text(t.attr("data-count")),o=t.attr("data-value")}),e(".j-seLv1").find("li").click(function(){e(this).attr("data-value")==="0"?f.addClass("hidden"):f.find("li:first").click().end().removeClass("hidden")}),h.on("click",".j-reason",function(t){t.preventDefault();var r=n.checkReason(e(this).attr("date-value"));r.open()});var d=c.attr("data-url");c.click(function(){var t=n.sendConfirm(),r=l.val();t.open(),p.empty(),e(document).off().on("click",".sendConfirm .j-submit",function(){s&&e.ajax({url:d,dataType:"json",type:"post",data:{content:r,countType:o},beforeSend:function(){s=!1},success:function(e){if(e.res===!0){t.close(),i.success("发送成功"),setTimeout(function(){location.reload()},1e3);return}if(e.res===!1&&e.displayType==="warning"){t.close(),p.html(e.msg);return}if(e.res===!1&&e.displayType!=="warning"){i.alert(e.msg);return}},complete:function(){s=!0}})})});var v=h.attr("data-url");h.on("click",".paging-num",function(t){t.preventDefault();var n=e(this).attr("data-index");s&&!e(this).hasClass("active")&&e.ajax({url:v,dataType:"json",type:"get",data:{pageNum:n},beforeSend:function(){s=!1},success:function(e){e.res?h.html(e.Html):""},complete:function(){s=!0}})})},checkCount:function(t,n,r){var i=e(".j-reNum"),s=0;t.on("keydown keyup focus change input blur",function(){var t=e(this).val().length;s&&clearTimeout(s),s=setTimeout(function(){i.text(t+"/"+r),t===0&&(n.addClass("disabled-white"),i.removeClass("text-red")),t>0&&t<r&&(n.removeClass("disabled-white"),i.removeClass("text-red")),t>r&&(n.addClass("disabled-white"),i.addClass("text-red"))},100)})},sendConfirm:function(){var e='<div class="identy-pop sendConfirm">    <h3>确认群发该私信?</h3>    <div class="button">        <a class="inl-b mgr-20 j-submit">确认</a>        <a class="inl-b pre qa-cancel" dialog-role="close">取消</a>    </div></div>',t={dialogClass:"",header:"",close:!0,width:400,content:e},n=new o.Modal({containerClass:"maskers hidden",dialogClass:"identy-pop sendConfirm",closeBtn:"inl-b pre qa-cancel",template:e});return n},checkReason:function(e){var t='<div class="identy-pop">    <h3>查看原因</h3>    <p>'+e+"</p>"+'    <p class="mgt-10">'+'        <a href="javascript: void(0);" class="link5 j-CustomUniqueTag">联系在线客服</a>'+"    </p>"+'    <div class="button">'+'        <a class="inl-b j-submit"  dialog-role="close">确认</a>'+"    </div>"+"</div>",n={dialogClass:"",header:"",close:!0,width:400,content:t},r=new o.Modal({containerClass:"maskers hidden",dialogClass:"identy-pop",closeBtn:"inl-b j-submit",template:t});return r},release:function(){this.callParent("release")}});return new u}),define("page/my/fans",["jquery","underscore","backbone","module/my/fans","page/page_base"],function(e,t,n,r,i){var s=i.extend({init:function(){this.callParent("init"),r.init()},release:function(){this.callParent("release"),r.release()}});return new s}),define("page/my/follow",["jquery","underscore","backbone","page/page_base","module/my/follow"],function(e,t,n,r,i){var s=r.extend({init:function(){this.callParent("init"),i.init()},release:function(){this.callParent("release"),i.release()}});return new s}),define("page/my/income",["jquery","underscore","backbone","page/page_base","page/center/common","plugin/jquery.input","moment","plugin/dialog","datepicker"],function(e,t,n,r,i,s,o,u){var a=r.extend({period:1,today:o(),init:function(){var e=this;i.init(),e.bindEvents()},bindEvents:function(){function v(t,n){v.HEIGHT?"":v.HEIGHT=e(".selecter-number.inl-b").height(),t==="true"&&n.length>0?(n.removeClass("hidden"),l.css({height:n.height(),width:"240px"})):l.css({height:v.HEIGHT,width:"120px"})}var t=this;e("input").beautify();var n=new t.dataModel({startTime:o().subtract(t.period,"d").format("YYYY-MM-DD"),endTime:o().format("YYYY-MM-DD"),paymentType:0,pageNum:1,orderIds:""},function(){e.ajax({url:"/center/getTradeRecordList",dataType:"json",type:"get",data:{startTime:n.getPara("startTime"),endTime:n.getPara("endTime"),paymentType:n.getPara("paymentType"),pageNum:n.getPara("pageNum"),orderIds:n.getPara("orderIds")},beforeSend:function(){e(".toast").fadeIn(100).prev().removeClass("hidden")},success:function(t){e(".toast").fadeOut(500).prev().addClass("hidden"),t.res===!0?e("#trade-box").empty().html(t.Html):""},error:function(t,n){e(".toast").fadeOut(500).prev().addClass("hidden")}})}),r=e("[data-period]"),i=e("#startDate"),s=e("#endDate");e(document).on("focus","#startDate",function(){var i=s.val(),a=o(t.today).subtract(90,"d").format("YYYY-MM-DD");e(this).datepicker("destroy").datepicker({startDate:a,endDate:i,pick:function(e){var i=o(e.date).format("YYYY-MM-DD"),a=o(e.date).add(90,"d"),f=o(s.val()),l=o.min(a,t.today,f).format("YYYY-MM-DD");s.val(l),e.view==="day"&&(+o(e.date)<+o(l)?(n.setPara({startTime:i,endTime:l,pageNum:1}),r.removeClass("primary")):u.warn("请选择合理的时间哦"))}})}).on("focus","#endDate",function(){var u=i.val(),a=o(u).add(90,"d"),f=o.min(t.today,a).format("YYYY-MM-DD");e(this).datepicker("destroy").datepicker({startDate:u,endDate:f,pick:function(e){var t=o(e.date).format("YYYY-MM-DD");s.val(t),e.view==="day"&&(n.setPara({endTime:t,pageNum:1}),r.removeClass("primary"))}})}).on("click","[data-period]",function(){var t=e(this),u=parseInt(t.attr("data-period")),a=o().subtract(u,"d").format("YYYY-MM-DD"),f=o().format("YYYY-MM-DD");n.setPara({startTime:a,endTime:f,pageNum:1}),i.val(a),s.val(f),r.removeClass("primary"),t.addClass("primary")});var a=e("#j-typeBox").find("a");a.on("click",function(){var t=e(this),r=t.attr("data-type");n.setPara({paymentType:r,pageNum:1}),a.removeClass("primary"),c.removeClass("on"),t.addClass("primary")});var f=e(".selecter-selected"),l=e(".multi-options"),c=e(".selecter-multi"),h=c.find(".selecter-text");$selecterItemLi=e(".selecter-number.inl-b").children();var p=h.text()+"：",d=h.attr("data-type");f.on("click",function(){c.toggleClass("open")}),l.on("click",function(t){var r=e(t.target),i=r.attr("data-subtypes"),s=r.attr("data-orderids")||"";if(i==="true")return;f.find(".selecter-text").text(p+r.text()),a.removeClass("primary"),c.toggleClass("open").addClass("on"),n.setPara({orderIds:s,paymentType:d})}),$selecterItemLi.on("mouseenter mouseleave",function(t){t.stopPropagation();var n=e(t.target),r=n.siblings("ul"),i=n.attr("data-subtypes");v(i,r),t.type==="mouseleave"&&i==="true"&&r.length>0&&r.addClass("hidden")}),e(document).on("click","#j-searchBtn",function(t){t.preventDefault(),e.ajax({url:"/center/tradeRecordDownload",dataType:"json",type:"get",data:{startTime:n.getPara("startTime"),endTime:n.getPara("endTime"),paymentType:n.getPara("paymentType")},success:function(e){e.res?window.open(e.url):!e.res&&e.displayType==="toast"&&u.warn(e.title)}})}),e(document).on("click",".paging-bar a",function(t){t.preventDefault();var r=e(this);if(!r.hasClass("active")){var i=r.attr("data-index");n.setPara("pageNum",i)}})},dataModel:function(t,n){var r={startTime:"",endTime:"",paymentType:0,pageNum:1,orderIds:""},i=function(e){return r[e]},s=function(t,i){var s=!1;if(e.type(arguments[0])==="object"){var o=arguments[0];for(var u in o)r[u]!==o[u]&&(r[u]=o[u],s=!0)}if(arguments.length===2){var a=arguments[0],f=arguments[1];r[a]!==f&&(r[a]=f,s=!0)}s?n():""};return e.extend(r,t),{getPara:i,setPara:s}},release:function(){this.callParent("release")}});return new a}),define("module/verify/password",[],function(){var e={isValidPassword:function(t){var n={success:!0,msg:""};return t=t||"",t===""?(n={success:!1,msg:"密码不能为空"},n):e.checkPwdFormat(t)?t.length<6||t.length>20?(n={success:!1,msg:"密码必须在6-20位之间"},n):e.onlyNumber(t)?(n={success:!1,msg:"密码不能纯数字"},n):e.onlyCharacther(t)?(n={success:!1,msg:"密码不能为纯字母"},n):e.onlySpecialChar(t)?(n={success:!1,msg:"密码不能为纯符号"},n):n:(n={success:!1,msg:"密码格式不正确"},n)},checkPwdFormat:function(e){var t=new RegExp("^[A-Za-z0-9`~!@#$%^&*()_\\-=+{}\\[\\]|\\;:'\"<>?\\.,/]*$");return t.test(e)},onlyNumber:function(e){var t=new RegExp("^[0-9]*$");return t.test(e)},onlyCharacther:function(e){var t=new RegExp("^[A-Za-z]*$");return t.test(e)},onlySpecialChar:function(e){var t=new RegExp("^[`~!@#$%^&*()_\\-=+{}\\[\\]|\\;:'\"<>?\\.,/]*$");return t.test(e)}};return e}),define("page/passport/forget",["jquery","plugin/validator","plugin/placeholder","module/common/iverify_code","plugin/dialog","model/account","module/verify/password","module/select/coutryselect","module/foot","module/common/backtotop"],function(e,t,n,r,i,s,o,u){function h(e,t){var n=e.parent().children(".j-error");n=n.length===0?e.parent().children(".regErrTex"):n,n.html(t)}function p(e){var t=e.parent().children(".j-error");t=t.length===0?e.parent().children(".regErrTex"):t,t.html("")}n(".ph_input");var a="/passport/sendResetMail",f="/passport/user_info/send",l=new u,c={};return c.account=function(){function g(){i.addClass("disabled");var e=n.val();if(!e){r.html("请输入手机号或邮箱").show();return}v=0,t.validator(e,"email")&&(s.attr("action",a),n.attr("name",u),o.val(h),v=h);var m=l.getSelected(),g=m.code;g==="+86"?t.validator(e,"mobile")&&(s.attr("action",f),n.attr("name",c),o.val(p),v=p):v=1;if(!v){r.html("帐号格式不正确").show();return}d=!0,i.removeClass("disabled"),r.hide()}var n=e("#userAccount"),r=e(".sp_tip"),i=e("#submit_btn"),s=e("#forget_form"),o=e("#serial"),u="email",c="phone_num",h="1",p="2",d=!1,v=0,m=e("#img_validcode").attr("src");e("#img_validcode").on("click",function(){e("#img_validcode").attr("src",m+"&_"+(new Date).getTime())}),l.on("change",function(){g()}),n.bind({keyup:function(e){g();if(e.keyCode===13)return d&&s.submit(),!1},blur:function(){g()}}),i.click(function(){if(d)if(!e("#checkCode").val())window.alert("请输入验证码!");else{var t=l.getSelected(),r=t.code,i=n.val();r&&r!=="+86"&&(i=r.replace(/\+/,"")+"-"+i),n.val(i),s.submit()}else g()})},c.password=function(t,n,r){var i=e("#password"),u=e("#re_password"),a=e("#submit_btn"),f=a.parents("form"),l=!1,c=!1;i.bind({blur:function(){l=!1;var t=e(this),n=t.val(),r=o.isValidPassword(n);if(!r.success){h(t,r.msg);return}p(t),l=!0}}),u.bind({blur:function(){c=!1;var t=e(this),n=t.val();if(n.length<6||n.length>20){h(t,"密码必须在6-20位之间");return}if(n!==i.val()){h(t,"两次输入的密码不一致");return}p(t),c=!0}}),a.click(function(){if(t&&n&&r&&!n.val()){r.html("请输入验证码").show();return}if(l&&c){var o=new s;e("#password").val(o.encryption(e("#password").val())),e("#re_password").val(o.encryption(e("#re_password").val())),f.submit()}else i.blur(),u.blur()})},c.phone=function(){function h(){if(l<=0)return;t=!0,u.html("点击重发("+l+")"),i=setInterval(function(){if(l<=0){u.html("点击重发"),u.removeClass("disabled"),t=!1,clearInterval(i);return}l--,u.html("点击重发("+l+")")},1e3)}var t=!1,n=Number(e("#time").val()),i=0,s=180,o=e("#codeInput"),u=e("#re_send"),a=e("#infoErr"),f=e("#phoneNum").val(),l=0;isNaN(n)||(l=s-parseInt(n/1e3)),u.on("click",function(){if(t||!f)return;var n=100;r.open(function(){},e.trim(f),"/check/getcode?codeId="+e('input[name="token"]').val(),u,n)}),h(),o.focus(function(){a.html("").hide()}),c.password(!0,o,a)},c}),define("plugin/jquery.mailcomplete",["jquery","plugin/jquery.parser"],function(e){(function(e){function u(t){var n=e(t),i=n.outerHeight(),s=n.mailcomplete("options");offset=n.offset(),r.css({left:offset.left,top:offset.top+i,width:n.outerWidth()-5,height:s.height})}function a(t,n){clearTimeout(s),s=setTimeout(function(){var r=e(t).val();n=n||0,f(t,r,n)},100)}function f(n,s,u){var a=e(n),f=s.lastIndexOf("@"),l=s.substr(f+1),c="",h,p,d=a.mailcomplete("options");u==0&&d.onInitialize(),d.lastindex+=u,clearTimeout(i),r.empty(),s=s||"";if(t.length>0){t[0]=s,r.append("<p class='tit'>请选择邮箱类型</p></p>"),d.nowcount=0;for(var v=0;v<t.length;v++){if(l!=""&&f>=0&&v>0){if(t[v].substring(0,l.length)!=l.replace(/\s/g,""))continue;c=s.substr(0,f)+(v==0?"":"@"+t[v]);if(c==t[0])continue;s=s.substr(0,f)}s=s.replace(/\s/g,""),s.substr(s.length-1)=="@"&&(s=s.substr(0,s.length-1)),select=v==d.lastindex,c=v==0?t[v]:s+"@"+t[v],h=e("<dl class='clearfix_after' style='height:20px;margin:0;padding:0;white-space: nowrap;word-break:break-all;'></dl>"),p=e("<a idx='"+d.nowcount+"' class='autodata' href='javascript:;'><span style='display:block;height:25px;line-height:25px;'></span></a>"),p.find("span").text(c).attr("title",c),h.append(p),r.append(h),d.nowcount++}}r.show(),o=!0,d.lastindex>=d.nowcount?d.lastindex=0:d.lastindex<0&&(d.lastindex=d.nowcount-1);var m=r.find("[idx="+d.lastindex+"]");m.addClass("selectReg"),d.nowText=m.text()}function l(t){var n=e(t);e.fn.mailcompleteinit(),n.on("keypress",p),n.on("keyup",d),n.on("blur",v),n.on("focus",c)}function c(e){var t=e.currentTarget;r.off("click").on("click",".autodata",[t],h),u(t),a(t,0)}function h(t){var n=e(t.currentTarget),r=e(t.data[0]),i=r.mailcomplete("options");return i.nowText="",r.val(n.text()),i.complete=!0,!1}function p(t){if(t.keyCode==13){var n=e(t.currentTarget).mailcomplete("options");e(t.currentTarget).val(n.nowText),n.nowText="",n.complete=!0,n.onComplete.call(e(t.currentTarget),n.complete),n.complete=!1,o=!1}}function d(e){var t=e.currentTarget;u(t);switch(e.keyCode){case 13:break;case 38:a(t,-1);break;case 40:a(t,1);break;default:a(t,0)}}function v(t){var n=e(t.currentTarget),s=n.mailcomplete("options");o&&(i=setTimeout(function(){s.onComplete.call(n,s.complete),s.complete=!1,r.hide(),o=!1},200))}function m(t,n){var r=e(t);return r.off("keypress",p),r.off("keyup",d),r.off("blur",v),r.off("focus",c),e.data(t,"mailcomplete",null),n===!0&&e.fn.mailcompletedestroy(),r}var t=["","163.com","126.com","qq.com","sina.com","vip.sina.com","hotmail.com","gmail.com","sina.cn","sohu.com","yahoo.cn","139.com","wo.com.cn","189.cn"],n="<div id='mainautocomplete_panel' style='position:absolute;z-index:100000;margin:0;background:white;padding:5px;overflow:hidden;border:1px solid #e3e3e3;'></div>",r=null,i=0,s=0,o=!1;e.fn.mailcompleteinit=function(){var t=e("#mainautocomplete_panel");t.size()?r=t:(r=e(n),e(document.body).append(r))},e.fn.mailcompletedestroy=function(){var t=e("#mainautocomplete_panel");t.size()&&(t.off("click"),t.remove())},e.fn.mailcomplete=function(t,n){return typeof t=="string"?e.fn.mailcomplete.methods[t](this,n):(t=t||{},this.each(function(){var n=e.data(this,"mailcomplete");n?e.extend(n.options,t):(n=e.data(this,"mailcomplete",{options:e.extend({},e.fn.mailcomplete.defaults,e.fn.mailcomplete.parseOptions(this),t)}),l(this))}))},e.fn.mailcomplete.methods={options:function(t,n){return n=n||"options",e.data(t[0],"mailcomplete")[n]},destroy:function(e,t){m(e,t)}},e.fn.mailcomplete.parseOptions=function(t){return e.extend({},e.parser.parseOptions(t,[{showBar:"boolean",fixed:"boolean"}]))},e.fn.mailcomplete.defaults=e.extend({},{complete:!1,nowcount:0,lastindex:0,nowText:"",onInitialize:function(){},onComplete:function(){}})})(e)}),define("page/passport/passport",["jquery","plugin/jquery.mailcomplete","plugin/jquery.placeholder","module/dialogs/copyright","module/common/iverify_code","plugin/validator","router","model/account","module/foot","module/common/backtotop"],function(e,t,n,r,i,s,o,u){function N(e){return e||(e=config.STATIC_ROOT+"/css/img/common/person_60.jpg"),e.indexOf("http://")<0&&window.config&&(e=(config.FDFS_PATH||"")+"/"+e),e}function C(){var e=helper.cookie.getCookie("j_follow_id");return helper.cookie.delCookie("j_follow_id"),e}function k(){var e=helper.cookie.getCookie("j_like_sound_id");return helper.cookie.delCookie("j_like_sound_id"),e}function L(t){e(t).addClass("on"),O(e(t))}function A(t){e(t).removeClass("on"),O(e(t))}function O(t){e.browser.msie&&e.browser.version=="6.0"&&!e.support.style&&DD_belatedPNG&&t.find("span u").each(function(){var t=e(this);t.attr("ddpng")||(DD_belatedPNG.fixPng(this),e(this).attr("ddpng",!0))})}function M(e,t,n){e.status==401}config.NO_NOTICE=!0;var a=window.domain_passport||"http://local.ximalaya.com/passport",f=a+"/guider/friends",l=a+"/guider/recommend/user",c=a+"/guider/profile/checkEmail",h=a+"/guider/profile/checkNickname",p=a+"/login/checkAccount",d=a+"/register/checkAccount",v=a+"/guider/friends/paged",m=a+"/mobile/getVerifyCode",g=a+"/mobile/register/checkinfo",y=a+"/guider/skip",b="";window._hmt||(window._hmt=[]);var w=e("#userAccount"),E=e("#userPwd");w.mailcomplete({onInitialize:function(){w.attr("cancel_blur",!0)},onComplete:function(e){w.removeAttr("cancel_blur");if(e===!1||e&&!e.complete)w.blur(),E.focus()}});var S={},x={intege:/^-?[1-9]\d*$/,intege1:/^[1-9]\d*$/,intege2:/^-[1-9]\d*$/,num:/^([+-]?)\d*\.?\d+$/,num1:/^[1-9]\d*|0$/,num2:/^-[1-9]\d*|0$/,decmal:/^([+-]?)\d*\.\d+$/,decmal1:/^[1-9]\d*.\d*|0.\d*[1-9]\d*$/,decmal2:/^-([1-9]\d*.\d*|0.\d*[1-9]\d*)$/,decmal3:/^-?([1-9]\d*.\d*|0.\d*[1-9]\d*|0?.0+|0)$/,decmal4:/^[1-9]\d*.\d*|0.\d*[1-9]\d*|0?.0+|0$/,decmal5:/^(-([1-9]\d*.\d*|0.\d*[1-9]\d*))|0?.0+|0$/,email:/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,color:/^[a-fA-F0-9]{6}$/,url:/^http[s]?:\/\/([\w-]+\.)+[\w-]+([\w\-.\/\?\%\&\=\#]*)?$/,chinese:/^[\u4E00-\u9FA5\uF900-\uFA2D]+$/,include_chinese:/[\u4E00-\u9FA5\uF900-\uFA2D]/g,ascii:/^[\x00-\xFF]+$/,zipcode:/^\d{6}$/,mobile:/^1(([3578][0-9])|(4[57]))[0-9]{8}$/,ip4:/^(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)$/,notempty:/^\S+$/,picture:/(.*)\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$/,rar:/(.*)\.(rar|zip|7zip|tgz)$/,date:/^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$/,qq:/^[1-9]*[1-9][0-9]*$/,tel:/^(([0\+]\d{2,3}-)?(0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/,username:/^\w+$/,letter:/^[A-Za-z]+$/,letter_u:/^[A-Z]+$/,letter_l:/^[a-z]+$/,idcard:/^[1-9]([0-9]{14}|[0-9]{17})$/,illchar:/[\~\`\!\@\#\$\%\^\&\*\(\)\-\=\+\\\|\'\"\;\:\.\>\,\<\/\?\~\·\！\@\#\￥\%\…\…\&\*\（\）\—\—\-\+\=\|\\\}\]\{\[\"\'\:\;\?\/\>\.\<\,]/,pwdStrong:/^(?![\d]+$)(?![a-zA-Z]+$)(?![\`\~\!\@\#\$\%\^\&\*\(\)\_\-\=\+\{\}\[\]\|\\\;\:\'\"\<\>\?\.\,\/]+$)[\da-zA-Z\`\~\!\@\#\$\%\^\&\*\(\)\_\-\=\+\{\}\[\]\|\\\;\:\'\"\<\>\?\.\,\/]{6,20}$/};S.validator=function(e,t){var n=!1;return s[t]&&s[t].test(e)&&(n=!0),n},S.validatorLength=function(e,t,n){var r=!1,i=e.length;n=n||t;if(t>n){var s=t;t=n,n=s}return i>=t&&i<=n&&(r=!0),r},S.login=function(){e(".ph_input").placeholder();var t={userError:"账号格式不正确!",noUser:"该账号尚未注册!",pwdError:"该账号密码不正确!",userEmpty:"请输入账号!",pwdEmpty:"请输入密码!",pwdTooShort:"密码不能短于6位",pwdTooLong:"密码不能长于20位"},n=e("#userAccount"),r=e("#userPwd"),i=e("#login_btn");n.blur(function(){return e(this).attr("cancel_blur")?!1:(s.account(e(this)),!1)}),r.bind({blur:function(){s.accountSuccess&&s.password(e(this))},focus:function(){s.accountSuccess||s.account(n)}});var s={accountSuccess:!1,passwordSuccess:!1,account:function(e,t){var n=this;this.checkAccountTimer&&clearTimeout(this.checkAccountTimer),this.checkAccountTimer=setTimeout(function(){n.accountFn(e,t)},20)},accountFn:function(n,r){this.accountSuccess=!1;var i=e.trim(n.val());if(!i){this.error(n,t.userEmpty);return}if(!S.validator(i,"email")&&!S.validator(i,"mobile")){this.error(n,t.userError);return}var s=this;e.ajax({url:p,type:"post",dataType:"json",data:{email:i},success:function(e){if(e.success)s.accountSuccess=!0,r&&r(),s.success();else{var t="";e.msg&&(t=e.msg),s.error(n,t)}},error:function(){s.error(n,t.userError)}})},password:function(n){var r=e.trim(n.val());if(!r){this.error(n,t.pwdEmpty);return}var i=r.length;if(i<6){this.error(n,t.pwdTooShort);return}if(i>20){this.error(n,t.pwdTooLong);return}this.passwordSuccess=!0,this.success()},error:function(t,n){var r=e(".error");r.html(n).show()},success:function(){var t=e(".error");t.html("&nbsp;").hide()}};setTimeout(function(){s.accountSuccess=!!n.val(),s.passwordSuccess=!!r.val()},50),e(".formList input[type='password']").on({keydown:function(t){if(t.keyCode==13)return e(this).triggerHandler("blur"),i.trigger("click"),!1}}),e("#img_validcode_1").on("click",function(){var t=e(this).attr("src");/v=(\d*)/.test(t)?t.replace(/v=(\d*)/,"v="+Date.now()):t+="&v="+Date.now(),e(this).attr("src",t)});var o=e("input.verifycode").parent(".formCodeItem").find("div");o.attr("data-deftext",o.text());var a=function(t){if(!t.length)return!0;var n=t.val();return e.trim(n)==""?(o.text("请输入右边图片内容").addClass("error").css("display","block"),t.focus(),!1):(o.text(o.data("deftext")).removeClass("error").css("display","none"),!0)};e("input.verifycode").on("keyup",function(){a(e(this))}),i.off().on("click",function(){return setTimeout(function(){if(s.accountSuccess&&s.passwordSuccess&&a(e("input.verifycode"))){var t=new u;t.getLoginToken(function(n){e("#userPwd").val(t.encryption(e("#userPwd").val(),n)),i[0].form.submit()})}else{if(!s.accountSuccess)return s.account(n,function(){i.click()}),!1;s.passwordSuccess||(r.blur(),s.passwordSuccess&&i.click())}},20),!1})},S.newRegister=function(){};var T=0;return S.register=function(t){function q(e){e=e||F,A.html("点击重发("+e+")"),I=setInterval(function(){if(e<=0){A.html("免费获取验证码"),A.removeAttr("disabled"),clearInterval(I);return}e--,A.html("点击重发("+e+")")},1e3)}e(".ph_input").placeholder();var n={emailExist:"该邮箱已被注册",emailFormatError:"账号格式错误，请输入邮箱",emailLengthError:"账号长度不能超过30个字符",nameIll:"昵称包含非法字符",nameTooShort:"昵称过短",nameTooLong:"昵称过长",nameExist:"该昵称已有人使用",pwdTooShort:"密码不能短于6位",pwdTooLong:"密码不能长于20位",pwdNumber:"密码不能为纯数字",pwdChar:"密码不能为纯字母",pwdCode:"密码不能为纯符号",pwdIll:"密码请勿使用特殊字符",emailEmpty:"注册邮箱必填",pwdEmpty:"密码必填",nameEmpty:"昵称必填",dealEmpty:"请先同意用户协议",phoneErr:"请输入正确的手机号码"},r=e("#nickName"),o=e("#nickNamePhone"),a=e("#userAccount"),f=e("#userAccountPhone"),l=e("#userPwd"),p=e("#userPwdPhone"),v=e("#send_code"),g=e("#agreeDeal"),y=e("#agreeDealPhone"),w=e("#infoErr"),E=e("#infoErrPhone"),T=e("#login_btn"),N=e("#login_btn_phone"),C=e("#reg_email_tab"),k=e("#reg_phone_tab"),L=e(".register"),A=e("#resend_code_btn"),O=e("#checkCode"),_=e("#area_num"),D=e("#userInfoErr");E.removeClass("error").css("color","#F73226"),v.addClass("disabled"),e("#changeCity").click(function(){requirejs(["module/dialogs/city"],function(t){if(!t)return;t.open(function(t,n){e("#city_info").html(t+n),e(".register_province").val(t),e(".register_city").val(n)})})}),e("#deal_info, #deal_info_phone").click(function(){}),C.click(function(){P.init(),L.removeClass("phone").addClass("email")}),k.click(function(){P.init(),L.removeClass("email").addClass("phone")}),r.blur(function(){P.name(e(this))}),o.blur(function(){P.name(e(this))}),a.blur(function(){if(e(this).attr("cancel_blur"))return;P.account(e(this))}),f.blur(function(){P.phone(e(this))}),l.blur(function(){P.password(e(this))}),p.blur(function(){P.password(e(this))}),O.blur(function(){P.codeEmail(e(this))}),v.blur(function(){P.code(e(this))}),g.click(function(){P.deal()});var P={nameSuccess:!1,accountSuccess:!1,passwordSuccess:!1,phoneSuccess:!1,codeEmailSuccess:!1,codeSuccess:!1,init:function(){this.nameSuccess=!1,this.accountSuccess=!1,this.passwordSuccess=!1,this.phoneSuccess=!1,this.codeSuccess=!1},name:function(t){this.nameSuccess=!1;var r=e.trim(t.val());if(!r){this.error(t,n.nameEmpty);return}var i=S.validator(r,"illchar");if(i){this.error(t,n.nameIll);return}var o=r;o=o.replace(s.include_chinese,"aa");var u=o.length;if(u<4){this.error(t,n.nameTooShort);return}if(u>20){this.error(t,n.nameTooLong);return}var a=this;e.ajax({url:h,type:"post",dataType:"json",data:{nickname:r},success:function(e){e.success?(a.nameSuccess=!0,a.success(t)):a.error(t,e.msg)},error:function(e,t,n){M(e,t,n)}})},account:function(t){this.accountSuccess=!1;var r=e.trim(t.val());if(!r){this.error(t,n.emailEmpty);return}if(!S.validator(r,"email")){this.error(t,n.emailFormatError);return}if(r.length>30){this.error(t,n.emailLengthError);return}var i=this;e.ajax({url:c,type:"post",dataType:"json",data:{email:r},success:function(e){e.success?(i.accountSuccess=!0,i.success(t)):i.error(t,e.msg)},error:function(e,t,n){M(e,t,n)}})},phone:function(t){this.phoneSuccess=!1;var n=e.trim(t.val());t.val(n);var r=_.text();r==="+86"&&(r=""),r=r.replace(/\+/,"");var i=r?r+"-"+n:n,s=this;b=i,e.ajax({url:d,type:"get",data:{account:i},dataType:"json",success:function(n){n.success?(s.phoneSuccess=!0,s.success(t),b=i,e(document).trigger("phone-check")):s.error(t,n.msg)},error:function(e,t,n){M(e,t,n)}})},password:function(t){this.passwordSuccess=!1;var r=e.trim(t.val());if(S.validator(r,"include_chinese")){this.error(t,n.pwdIll);return}if(!r){this.error(t,n.pwdEmpty);return}var i=r.length;if(i<6){this.error(t,n.pwdTooShort);return}if(i>20){this.error(t,n.pwdTooLong);return}if(!x.pwdStrong.test(r)){/^\d+$/.test(r)?this.error(t,n.pwdNumber):/^[a-zA-Z]+$/.test(r)?this.error(t,n.pwdChar):/^[\~\`\!\@\#\$\%\^\&\*\(\)\-\=\+\\\|\'\"\;\:\.\>\,\<\/\?\~\·\！\@\#\￥\%\…\…\&\*\（\）\—\—\-\+\=\|\\\}\]\{\[\"\'\:\;\?\/\>\.\<\,]+$/.test(r)?this.error(t,n.pwdCode):this.error(t,n.pwdIll);return}this.passwordSuccess=!0,this.success(t)},error:function(e,t){var n=e.parents(".formItem").children(".sp_tip"),r=e.parents(".formItem");n.removeClass("sp_right").addClass("sp_error").html(t),n.get(0)||(console.log(t),r.children(".regTip").removeClass("hidden"),r.children(".regErrTex").html(t),r.children(".regIcTrue").addClass("hidden")),e.removeAttr("timer")},success:function(e){var t=e.parents(".formItem").children(".sp_tip"),n=e.parents(".formItem");t.addClass("sp_right").removeClass("sp_error").html(""),t.get(0)||(n.children(".regTip").removeClass("hidden"),n.children(".regErrTex").addClass("hidden")),H&&(H=!1,T.click()),B&&(B=!1,N.click())},deal:function(){return t?!0:g[0].checked?(w.html(""),!0):(w.html(n.dealEmpty),!1)},dealPhone:function(){return y[0].checked?(E.html("").hide(),D.html("").hide(),!0):(E.html(n.dealEmpty).show(),D.html(n.dealEmpty).show().css("color","#f73226"),!1)},codeEmail:function(t){this.codeEmailSuccess=!1;var n=e.trim(t.val());if(!n||n.length<4){this.error(t,"请输入正确的验证码");return}this.codeEmailSuccess=!0,this.error(t,"")},code:function(t){this.codeSuccess=!1;var n=e.trim(t.val());if(!n){this.error(t,"请输入正确的验证码");return}this.codeSuccess=!0,E.html("").hide()}};e(".formList input[type='password']").bind({keydown:function(t){t.keyCode==13&&(e(this).triggerHandler("blur"),T.click())}});var H=!1;T.click(function(){return H=!0,P.nameSuccess&&P.accountSuccess&&P.passwordSuccess&&P.codeEmailSuccess&&P.deal()?T[0].form.submit():(P.nameSuccess||r.blur(),P.accountSuccess||a.blur(),P.passwordSuccess||l.blur(),P.codeEmailSuccess||O.blur()),!1});var B=!1;N.click(function(){B=!0;if(P.nameSuccess&&P.phoneSuccess&&P.passwordSuccess&&P.codeSuccess&&P.dealPhone()){var t=new u;e("#userPwdPhone").val(t.encryption(e("#userPwdPhone").val()));var n=e("#area_num").text(),r=n?n+"-":"";r=r.replace(/\+(86-)?/,""),e("#userAccountPhone").val(r+e("#userAccountPhone").val()),e("#regForm").submit()||N[0].form.submit()}else P.nameSuccess||o.blur(),P.phoneSuccess||f.blur(),P.passwordSuccess||p.blur(),P.codeSuccess||v.blur(),P.codeSuccess&&P.dealPhone();return!1});var j=60,F=180,I=0;A.click(function(){var t=e(this);if(t.attr("lock"))return;v.removeClass("disabled"),t.attr("lock",!0),f.blur(),e(document).one("phone-check",function(){t.removeAttr("lock");if(!P.phoneSuccess||t.hasClass("already")){f.blur();return}var n=_.val()?_.val()+"-":"";n=n.replace(/\+(86-)?/,""),i.open(function(e){},e.trim(n+f.val()),e("#img_validcode").attr("src"),A,4)});return;var n})},S.friends=function(){function u(r){if(r>i||r<=0)return;if(n[r]){a(r);return}e.ajax({url:v,type:"get",dataType:"json",data:{pageId:r,__t:(new Date).valueOf()},cache:!1,success:function(e){e.success&&e.msg?(t&&(l(e.msg),t=!1),h(e.msg)):window.console&&console.info("获取微博好友失败！！")},error:function(){window.console&&console.info("获取微博好友失败！！ajax错误")}})}function a(t){r=parseInt(t),s.children(".page.current").removeClass("current"),s.children(".page[page='"+t+"']").addClass("current"),e(".friend_list_page").hide(),e(".friend_list_page[page='"+t+"']").show()}function l(t){function h(e){e>=o?l.hide():l.show(),e<=1?c.hide():c.show()}var n=e("#totalNum");n.html(t.totalCount);var i="",o=t.maxPageId;if(o<=1)return;i+='<a class="prevPage" href="javascript:;" style="display:none;">上一页</a>';for(var a=0;a<o;a++){var f=a+1;i+='<a class="page" href="javascript:;" page="'+f+'">'+f+"</a>"}i+='<a class="nextPage" href="javascript:;">下一页</a>',s.html(i);var l=s.find(".nextPage"),c=s.find(".prevPage");l.click(function(){h(r+1),u(r+1)}),c.click(function(){h(r-1),u(r-1)}),s.click(function(t){var n=e(t.target);if(n.hasClass("page")){var r=n.text();h(r),u(r)}})}function h(t){var r=t.pageId;i=t.maxPageId;if(r>i)return;n[r]=!0;var s=t.list;if(!r||!s)return;var o='<div class="friend_list_page" page="'+r+'"><div class="attention attention_on toggle_all">'+'<span class="tag-default"><u></u></span>'+'<span class="tag-select"><u></u></span>'+"关注本页"+"</div>",u='<ul class="ul_list">',f="end";for(var l=0,h=s.length;l<h;l++){var d=s[l],v=d.uid;c[v]=!0,u+='<li class="'+((l+1)%9==0?f:"")+'" uid="'+v+'">'+'<div class="fd_head hover on"><img alt="'+d.nickname+'" src="'+N(d.middleLogo)+'">',u+='<span class="tag-default"><u></u></span><span class="tag-select"><u></u></span></div><div class="fd_name">'+d.nickname+"</div></li>"}u+="</ul>",o+=u+"</div>",e(".friendList").append(o),p(r),a(r)}function p(t){var n=e(".friend_list_page[page='"+t+"']"),r=n.find(".toggle_all"),i=n.find(".fd_head");r.addClass("attention_on").attr("select",!0),r.click(function(){var t=n.find(".fd_head"),r=e(this);r.attr("select")?(A(t),m(t),r.removeAttr("select"),r.removeClass("attention_on")):(L(t),d(t),r.attr("select",!0),r.addClass("attention_on"))}),i.click(function(){var t=e(this);t.hasClass("on")?(A(t),m(t)):(L(t),d(t))})}function d(t){t.each(function(){var t=e(this),n=t.parents("li[uid]").attr("uid");c[n]=!0})}function m(t){t.each(function(){var t=e(this),n=t.parents("li[uid]").attr("uid");c[n]=!1,delete c[n]})}function w(e){e=e||y,o.toPage(e)}function E(){var e=[];for(var t in c)e.push(t);return e.join(",")}function S(){var t=E();e.ajax({url:f,data:{followUids:t},type:"post",success:function(){w()},error:function(){w()}})}var t=!0,n={},r=0,i=999,s=e("#paging");u(1);var c={},g=e("#skipRecommend"),b=e("#nextStep");g.click(function(){S()}),b.click(function(){var t=E();return e("#followed_friends").val(t),e(this)[0].form.submit(),!1})},S.userInfo=function(){S.register(!0)},S.found=function(){function c(){var n=e(".sortList").find(".sort_item");n.each(function(n){var r=e(this);t[r.attr("sortId")]={index:n,sortTitle:r.attr("sortTitle")}}),n.bind({mouseenter:function(){var t=e(this);t.addClass("hover"),O(t)},mouseleave:function(){var t=e(this);t.removeClass("hover"),O(t)},click:function(){var t=e(this);t.attr("select")?(t.removeAttr("select"),p(t)):(t.attr("select",!0),h(t))}}),n.each(function(){var t=e(this);t.attr("select")&&h(t)})}function h(t){p(t),t.addClass("on"),O(t);var n=t.attr("sortId");g(n),e.browser.msie&&e.browser.version=="6.0"&&!e.support.style&&DD_belatedPNG&&t.find("span u").each(function(){DD_belatedPNG.fixPng(this)})}function p(t){t.removeClass("on"),O(e(t));var n=t.attr("sortId");o[n]=!1,delete o[n];var r=v(n);r.hide(),f(),y()}function d(){}function v(e){return n.children(".figureItem[sortId='"+e+"']")}function m(e,t){var r=n.children(".figureItem[sortId='"+e+"'][page='"+t+"']:hidden");r.show(),y()}function g(t){o[t]?(o[t].page=o[t].page+1,o[t].page>o[t].maxPage&&(o[t].page=1)):(o[t]={},o[t].page=1,o[t].maxPage=999),o[t].uuid||(o[t].uuid={});var r=o[t].page;if(s[t+"_"+r]){o[t].maxPage=s[t+"_"+r].maxPageId;var i=s[t+"_"+r];for(var u=0,a=i.list.length;u<a;u++){var c=i.list[u].uid;n.find(".figureItem[sortId='"+t+"'][page='"+r+"'] li[uuid="+c+"] .hd").hasClass("on")&&(o[t].uuid[c]=!0)}var h=v(t);h.hide(),m(t,r),f();return}e.ajax({url:l,data:{categoryId:t,pageId:r},dataType:"json",success:function(e){if(!e)return;s[t+"_"+r]=e,b(e,t),f()}})}function y(){var e=n.children(".figureItem:visible");e.length>0?i.parents(".tit").show():i.parents(".tit").hide()}function b(r,i){var s=r.list;o[i].maxPage=r.maxPageId;var u=t[i].index;u>=18&&(u-=18);var a='<div class="figureItem" sortId="'+i+'" page="'+r.pageId+'">'+'<div class="sortName c'+u+'"><h3>'+t[i].sortTitle+'</h3></div><div class="sortWarp"><ul>';for(var f=0;f<s.length;f++){var l=s[f],c=l.categoryId;o[c].uuid[l.uid]=!0,a+='<li  uuid="'+l.uid+'">'+'<div class="hd hover on" card="'+l.uid+'" card_type="passport">'+'<img alt="" src="'+N(l.avatarPathLarge)+'">'+'<span class="tag-default"><u></u></span>'+'<span class="tag-select"><u></u></span>'+"</div>"+'<div class="bd">'+l.nickname+" </div></li>"}a+="</li></ul></div></div>";var h=v(i);h.hide();var p=e(a);h.length==0?n.children().length==0?n.append(p):p.insertBefore(n.children().eq(0)):h.last().after(p),O(p),y()}function w(){var t=e("#choose_all");t.addClass("attention_on").attr("select",!0),t.click(function(){var t=n.find(".figureItem:visible .hd"),r=e(this);r.attr("select")?(A(t),S(t),r.removeAttr("select"),r.removeClass("attention_on")):(L(t),E(t),r.attr("select",!0),r.addClass("attention_on"))}),n.on("click",".hd",function(){var t=e(this);t.hasClass("on")?(A(t),S(t)):(L(t),E(t))})}function E(t,n){t.each(function(){var t=e(this),r=t.parents(".figureItem").attr("sortId"),i=t.parents("li[uuid]").attr("uuid");if(!i)return;var s=o[r].uuid;n?s[i]=!1:s[i]=!0})}function S(e){E(e,!0)}var t={},n=e(".figure"),r=e("#startTrip"),i=e("#changeGroup"),s={},o={},u=e(".foundBot"),a=e(".found-cover"),f=function(){var t=e(document).scrollTop();u.offset().top<=t+e(window).height()?a.removeClass("fixed-cover"):a.addClass("fixed-cover")};e(window).bind("scroll",f),f(),c(),y(),w(),i.click(function(){for(var e in o)g(e)}),r.click(function(){var t=[],n=[],i="{";for(var s in o){var u=o[s].uuid;t.push(s);var a=[];for(var f in u)u[f]&&(n.push(f),a.push(f));i!="{"&&(i+=","),i+='"'+s+'"'+':"'+a.join(",")+'"'}if(t.length==0){e("#error_tip").length>0&&(clearTimeout(e("#error_tip").attr("timer")),e("#error_tip").remove());var l=e('<div id="error_tip" style="color:red;position:relative;z-index: 2;">请至少选择一个分类哟</div>');r.parent().append(l);var c=setTimeout(function(){e("#error_tip").fadeOut(300,function(){e(this).remove()})},2e3);return l.attr("timer",c),!1}var h=n.join(","),p=C();p&&(h.indexOf(p)==-1&&(h&&(h+=","),h+=p),i.indexOf(p==-1)&&(i+=', "-1":"'+p+'"')),i+="}",e("#followed_user").val(h),e("#followed_user").val(i),e("#followCategoryIds").val(t.join(",")),window.console&&console.info(h);var d=k(),v=this;return d?sound.like(d,!0,function(){e(v)[0].form.submit()}):e(v)[0].form.submit(),!1})},S}),define("page/passport/login",["jquery","plugin/jquery.mailcomplete","plugin/jquery.placeholder","module/dialogs/copyright","module/common/iverify_code","plugin/validator","router","model/account","module/select/coutryselect","module/login/verify","module/foot","module/common/backtotop"],function(e,t,n,r,i,s,o,u,a,f){config.NO_NOTICE=!0;var l=f.verify;window._hmt||(window._hmt=[]);var c=new a,h=e("#userAccount"),p=e("#userPwd");h.mailcomplete({onInitialize:function(){h.attr("cancel_blur",!0)},onComplete:function(e){h.removeAttr("cancel_blur");if(e===!1||e&&!e.complete)h.blur(),p.focus()}}),c.on("change",function(t){e.trim(h.val())!==""&&l.account(h,t.code)});var d={};return d.validator=function(e,t){var n=!1;return s[t]&&s[t].test(e)&&(n=!0),n},d.validatorLength=function(e,t,n){var r=!1,i=e.length;n=n||t;if(t>n){var s=t;t=n,n=s}return i>=t&&i<=n&&(r=!0),r},d.login=function(){function a(){l.accountSuccess&&l.passwordSuccess&&o(e("input.verifycode"))&&r.removeClass("disabled")}e(".ph_input").placeholder();var t=e("#userAccount"),n=e("#userPwd"),r=e("#login_btn");t.blur(function(){return e(this).attr("cancel_blur")?!1:(e(this).val(e.trim(this.value)),l.account(e(this),c.getSelected().code,function(){a()}),!1)}).keyup(function(){a()}),n.bind({blur:function(){l.accountSuccess&&l.password(e(this)),a()},focus:function(){l.accountSuccess||l.account(t,c.getSelected().code),a()},keyup:function(){a()}}),setTimeout(function(){l.accountSuccess=!!t.val(),l.passwordSuccess=!!n.val()},50),e(".j-loginform input[type='password']").bind({keydown:function(t){t.keyCode===13&&(e(this).triggerHandler("blur"),r.click())}});var i=e(".j-loginform");e("#img_validcode_1").on("click",function(){var t=e(this).attr("src");/v=(\d*)/.test(t)?t.replace(/v=(\d*)/,"v="+Date.now()):t+="&v="+Date.now(),e(this).attr("src",t)});var s=e("input.verifycode").parent(".regIcLt").find("j-error"),o=function(t){if(!t.length)return!0;var n=t.val();return e.trim(n)===""?(s.text("请输入右边图片内容"),t.focus(),!1):(s.text("").removeClass("error"),!0)};e("input.verifycode").on("keyup",function(){o(e(this)),a()}),t.val()&&!e("input.verifycode").length&&r.removeClass("disabled"),r.click(function(){return setTimeout(function(){if(l.accountSuccess&&l.passwordSuccess&&o(e("input.verifycode"))){var s=new u;s.getLoginToken(function(t){var n=e("#userAccount").val(),r=c.getSelected(),o=r.code;n=l.getPhoneByCode(o,n),e("#userAccount").val(n),e("#userPwd").val(s.encryption(e("#userPwd").val(),t)),i.submit()})}else{if(!l.accountSuccess)return l.account(t,c.getSelected().code,function(){r.click()}),!1;l.passwordSuccess||(n.blur(),l.passwordSuccess&&r.click())}},20),!1})},d}),define("plugin/jquery.jcrop",["jquery"],function(){$.Jcrop=function(e,t){function o(e){return e+"px"}function u(e){return n.baseClass+"-"+e}function a(){return $.fx.step.hasOwnProperty("backgroundColor")}function f(e){var t=$(e).offset();return[t.left,t.top]}function l(e){return[e.pageX-r[0],e.pageY-r[1]]}function c(e){typeof e!="object"&&(e={}),n=$.extend(n,e),$.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){typeof n[t]!="function"&&(n[t]=function(){})})}function h(e,t){r=f(A),nt.setCursor(e==="move"?e:e+"-resize");if(e==="move")return nt.activateHandlers(d(t),w);var n=Z.getFixed(),i=v(e),s=Z.getCorner(v(i));Z.setPressed(Z.getCorner(i)),Z.setCurrent(s),nt.activateHandlers(p(e,n),w)}function p(e,t){return function(r){if(!n.aspectRatio)switch(e){case"e":r[1]=t.y2;break;case"w":r[1]=t.y2;break;case"n":r[0]=t.x2;break;case"s":r[0]=t.x2}else switch(e){case"e":r[1]=t.y+1;break;case"w":r[1]=t.y+1;break;case"n":r[0]=t.x+1;break;case"s":r[0]=t.x+1}Z.setCurrent(r),tt.update()}}function d(e){var t=e;return rt.watchKeys(),function(e){Z.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,tt.update()}}function v(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function m(e){return function(t){return n.disabled?!1:e==="move"&&!n.allowMove?!1:(r=f(A),K=!0,h(e,l(t)),t.stopPropagation(),t.preventDefault(),!1)}}function g(e,t,n){var r=e.width(),i=e.height();r>t&&t>0&&(r=t,i=t/e.width()*e.height()),i>n&&n>0&&(i=n,r=n/e.height()*e.width()),X=e.width()/r,V=e.height()/i,e.width(r).height(i)}function b(e){return{x:e.x*X,y:e.y*V,x2:e.x2*X,y2:e.y2*V,w:e.w*X,h:e.h*V}}function w(e){var t=Z.getFixed();t.w>n.minSelect[0]&&t.h>n.minSelect[1]?(tt.enableHandles(),tt.done()):tt.release(),nt.setCursor(n.allowSelect?"crosshair":"default")}function E(e){if(n.disabled)return!1;if(!n.allowSelect)return!1;K=!0,r=f(A),tt.disableHandles(),nt.setCursor("crosshair");var t=l(e);return Z.setPressed(t),tt.update(),nt.activateHandlers(S,w),rt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function S(e){Z.setCurrent(e),tt.update()}function T(){var e=$("<div></div>").addClass(u("tracker"));return $.browser.msie&&e.css({opacity:0,backgroundColor:"white"}),e}function it(e){_.removeClass().addClass(u("holder")).addClass(e)}function st(e,t){function w(){window.setTimeout(E,c)}var r=e[0]/X,i=e[1]/V,s=e[2]/X,o=e[3]/V;if(Q)return;var u=Z.flipCoords(r,i,s,o),a=Z.getFixed(),f=[a.x,a.y,a.x2,a.y2],l=f,c=n.animationDelay,h=u[0]-f[0],p=u[1]-f[1],d=u[2]-f[2],v=u[3]-f[3],m=0,g=n.swingSpeed;x=l[0],y=l[1],s=l[2],o=l[3],tt.animMode(!0);var b,E=function(){return function(){m+=(100-m)/g,l[0]=x+m/100*h,l[1]=y+m/100*p,l[2]=s+m/100*d,l[3]=o+m/100*v,m>=99.8&&(m=100),m<100?(ut(l),w()):(tt.done(),typeof t=="function"&&t.call(yt))}}();w()}function ot(e){ut([e[0]/X,e[1]/V,e[2]/X,e[3]/V]),n.onSelect.call(yt,b(Z.getFixed())),tt.enableHandles()}function ut(e){Z.setPressed([e[0],e[1]]),Z.setCurrent([e[2],e[3]]),tt.update()}function at(){return b(Z.getFixed())}function ft(){return Z.getFixed()}function lt(e){c(e),gt()}function ct(){n.disabled=!0,tt.disableHandles(),tt.setCursor("default"),nt.setCursor("default")}function ht(){n.disabled=!1,gt()}function pt(){tt.done(),nt.activateHandlers(null,null)}function dt(){_.remove(),C.show(),$(e).removeData("Jcrop")}function vt(e,t){tt.release(),ct();var r=new Image;r.onload=function(){var i=r.width,s=r.height,o=n.boxWidth,u=n.boxHeight;A.width(i).height(s),A.attr("src",e),D.attr("src",e),g(A,o,u),O=A.width(),M=A.height(),D.width(O).height(M),F.width(O+j*2).height(M+j*2),_.width(O).height(M),et.resize(O,M),ht(),typeof t=="function"&&t.call(yt)},r.src=e}function mt(e,t,r){var i=t||n.bgColor;n.bgFade&&a()&&n.fadeTime&&!r?e.animate({backgroundColor:i},{queue:!1,duration:n.fadeTime}):e.css("backgroundColor",i)}function gt(e){n.allowResize?e?tt.enableOnly():tt.enableHandles():tt.disableHandles(),nt.setCursor(n.allowSelect?"crosshair":"default"),tt.setCursor(n.allowMove?"move":"default"),n.hasOwnProperty("trueSize")&&(X=n.trueSize[0]/O,V=n.trueSize[1]/M),n.hasOwnProperty("setSelect")&&(ot(n.setSelect),tt.done(),delete n.setSelect),et.refresh(),n.bgColor!=I&&(mt(n.shade?et.getShades():_,n.shade?n.shadeColor||n.bgColor:n.bgColor),I=n.bgColor),q!=n.bgOpacity&&(q=n.bgOpacity,n.shade?et.refresh():tt.setBgOpacity(q)),R=n.maxSize[0]||0,U=n.maxSize[1]||0,z=n.minSize[0]||0,W=n.minSize[1]||0,n.hasOwnProperty("outerImage")&&(A.attr("src",n.outerImage),delete n.outerImage),tt.refresh()}var n=$.extend({},$.Jcrop.defaults),r,i,s=!1;$.browser.msie&&$.browser.version.split(".")[0]==="6"&&(s=!0),typeof e!="object"&&(e=$(e)[0]),typeof t!="object"&&(t={}),c(t);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},C=$(e),k=!0;if(e.tagName=="IMG"){if(C[0].width!=0&&C[0].height!=0)C.width(C[0].width),C.height(C[0].height);else{var L=new Image;L.src=C[0].src,C.width(L.width),C.height(L.height)}var A=C.clone().removeAttr("id").css(N).show();A.width(C.width()),A.height(C.height()),C.after(A).hide()}else A=C.css(N).show(),k=!1,n.shade===null&&(n.shade=!0);g(A,n.boxWidth,n.boxHeight);var O=A.width(),M=A.height(),_=$("<div />").width(O).height(M).addClass(u("holder")).css({position:"relative",backgroundColor:n.bgColor}).insertAfter(C).append(A);n.addClass&&_.addClass(n.addClass);var D=$("<div />"),P=$("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),H=$("<div />").width("100%").height("100%").css("zIndex",320),B=$("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=Z.getFixed();n.onDblClick.call(yt,e)}).insertBefore(A).append(P,H);k&&(D=$("<img />").attr("src",A.attr("src")).css(N).width(O).height(M),P.append(D)),s&&B.css({overflowY:"hidden"});var j=n.boundary,F=T().width(O+j*2).height(M+j*2).css({position:"absolute",top:o(-j),left:o(-j),zIndex:290}).mousedown(E),I=n.bgColor,q=n.bgOpacity,R,U,z,W,X,V,J=!0,K,Q,G;r=f(A);var Y=function(){function e(){var e={},t=["touchstart","touchmove","touchend"],n=document.createElement("div"),r;try{for(r=0;r<t.length;r++){var i=t[r];i="on"+i;var s=i in n;s||(n.setAttribute(i,"return;"),s=typeof n[i]=="function"),e[t[r]]=s}return e.touchstart&&e.touchend&&e.touchmove}catch(o){return!1}}function t(){return n.touchSupport===!0||n.touchSupport===!1?n.touchSupport:e()}return{createDragger:function(e){return function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,n.disabled?!1:e==="move"&&!n.allowMove?!1:(K=!0,h(e,l(t)),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,E(e)},isSupported:e,support:t()}}(),Z=function(){function u(n){n=p(n),r=e=n[0],i=t=n[1]}function a(e){e=p(e),s=e[0]-r,o=e[1]-i,r=e[0],i=e[1]}function f(){return[s,o]}function l(n){var s=n[0],o=n[1];0>e+s&&(s-=s+e),0>t+o&&(o-=o+t),M<i+o&&(o+=M-(i+o)),O<r+s&&(s+=O-(r+s)),e+=s,r+=s,t+=o,i+=o}function c(e){var t=h();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function h(){if(!n.aspectRatio)return v();var s=n.aspectRatio,o=n.minSize[0]/X,u=n.maxSize[0]/X,a=n.maxSize[1]/V,f=r-e,l=i-t,c=Math.abs(f),h=Math.abs(l),p=c/h,g,y,b,w;return u===0&&(u=O*10),a===0&&(a=M*10),p<s?(y=i,b=h*s,g=f<0?e-b:b+e,g<0?(g=0,w=Math.abs((g-e)/s),y=l<0?t-w:w+t):g>O&&(g=O,w=Math.abs((g-e)/s),y=l<0?t-w:w+t)):(g=r,w=c/s,y=l<0?t-w:t+w,y<0?(y=0,b=Math.abs((y-t)*s),g=f<0?e-b:b+e):y>M&&(y=M,b=Math.abs(y-t)*s,g=f<0?e-b:b+e)),g>e?(g-e<o?g=e+o:g-e>u&&(g=e+u),y>t?y=t+(g-e)/s:y=t-(g-e)/s):g<e&&(e-g<o?g=e-o:e-g>u&&(g=e-u),y>t?y=t+(e-g)/s:y=t-(e-g)/s),g<0?(e-=g,g=0):g>O&&(e-=g-O,g=O),y<0?(t-=y,y=0):y>M&&(t-=y-M,y=M),m(d(e,t,g,y))}function p(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>O&&(e[0]=O),e[1]>M&&(e[1]=M),[e[0],e[1]]}function d(e,t,n,r){var i=e,s=n,o=t,u=r;return n<e&&(i=n,s=e),r<t&&(o=r,u=t),[i,o,s,u]}function v(){var n=r-e,s=i-t,o;return R&&Math.abs(n)>R&&(r=n>0?e+R:e-R),U&&Math.abs(s)>U&&(i=s>0?t+U:t-U),W/V&&Math.abs(s)<W/V&&(i=s>0?t+W/V:t-W/V),z/X&&Math.abs(n)<z/X&&(r=n>0?e+z/X:e-z/X),e<0&&(r-=e,e-=e),t<0&&(i-=t,t-=t),r<0&&(e-=r,r-=r),i<0&&(t-=i,i-=i),r>O&&(o=r-O,e-=o,r-=o),i>M&&(o=i-M,t-=o,i-=o),e>O&&(o=e-M,i-=o,t-=o),t>M&&(o=t-M,i-=o,t-=o),m(d(e,t,r,i))}function m(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var e=0,t=0,r=0,i=0,s,o;return{flipCoords:d,setPressed:u,setCurrent:a,getOffset:f,moveOffset:l,getCorner:c,getFixed:h}}(),et=function(){function i(e,t){r.left.css({height:o(t)}),r.right.css({height:o(t)})}function s(){return u(Z.getFixed())}function u(e){r.top.css({left:o(e.x),width:o(e.w),height:o(e.y)}),r.bottom.css({top:o(e.y2),left:o(e.x),width:o(e.w),height:o(M-e.y2)}),r.right.css({left:o(e.x2),width:o(O-e.x2)}),r.left.css({width:o(e.x)})}function a(){return $("<div />").css({position:"absolute",backgroundColor:n.shadeColor||n.bgColor}).appendTo(t)}function f(){e||(e=!0,t.insertBefore(A),s(),tt.setBgOpacity(1,0,1),D.hide(),l(n.shadeColor||n.bgColor,1),tt.isAwake()?h(n.bgOpacity,1):h(1,1))}function l(e,t){mt(d(),e,t)}function c(){e&&(t.remove(),D.show(),e=!1,tt.isAwake()?tt.setBgOpacity(n.bgOpacity,1,1):(tt.setBgOpacity(1,1,1),tt.disableHandles()),mt(_,0,1))}function h(r,i){e&&(n.bgFade&&!i?t.animate({opacity:1-r},{queue:!1,duration:n.fadeTime}):t.css({opacity:1-r}))}function p(){n.shade?f():c(),tt.isAwake()&&h(n.bgOpacity)}function d(){return t.children()}var e=!1,t=$("<div />").css({position:"absolute",zIndex:240,opacity:0}),r={top:a(),left:a().height(M),right:a().height(M),bottom:a()};return{update:s,updateRaw:u,getShades:d,setBgColor:l,enable:f,disable:c,resize:i,refresh:p,opacity:h}}(),tt=function(){function f(e){var t=$("<div />").css({position:"absolute",opacity:n.borderOpacity}).addClass(u(e));return P.append(t),t}function l(e,t){var n=$("<div />").mousedown(m(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return Y.support&&n.bind("touchstart.jcrop",Y.createDragger(e)),H.append(n),n}function c(e){var r=n.handleSize;return l(e,t++).css({opacity:n.handleOpacity}).width(r).height(r).addClass(u("handle"))}function h(e){return l(e,t++).addClass("jcrop-dragbar")}function p(e){var t;for(t=0;t<e.length;t++)s[e[t]]=h(e[t])}function d(e){var t,n;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}r[e[n]]=f(t)}}function v(e){var t;for(t=0;t<e.length;t++)i[e[t]]=c(e[t])}function g(e,t){n.shade||D.css({top:o(-t),left:o(-e)}),B.css({top:o(t),left:o(e)})}function y(e,t){B.width(e).height(t)}function w(){var e=Z.getFixed();Z.setPressed([e.x,e.y]),Z.setCurrent([e.x2,e.y2]),E()}function E(t){if(e)return S(t)}function S(t){var r=Z.getFixed();y(r.w,r.h),g(r.x,r.y),n.shade&&et.updateRaw(r),e||N(),t?n.onSelect.call(yt,b(r)):n.onChange.call(yt,b(r))}function x(t,r,i){if(!e&&!r)return;n.bgFade&&!i?A.animate({opacity:t},{queue:!1,duration:n.fadeTime}):A.css("opacity",t)}function N(){B.show(),n.shade?et.opacity(q):x(q,!0),e=!0}function C(){O(),B.hide(),n.shade?et.opacity(1):x(1),e=!1,n.onRelease.call(yt)}function k(){a&&H.show()}function L(){a=!0;if(n.allowResize)return H.show(),!0}function O(){a=!1,H.hide()}function M(e){Q===e?O():L()}function _(){M(!1),w()}var e,t=370,r={},i={},s={},a=!1;n.dragEdges&&$.isArray(n.createDragbars)&&p(n.createDragbars),$.isArray(n.createHandles)&&v(n.createHandles),n.drawBorders&&$.isArray(n.createBorders)&&d(n.createBorders),$(document).bind("touchstart.jcrop-ios",function(e){$(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var j=T().mousedown(m("move")).css({cursor:"move",position:"absolute",zIndex:360});return Y.support&&j.bind("touchstart.jcrop",Y.createDragger("move")),P.append(j),O(),{updateVisible:E,update:S,release:C,refresh:w,isAwake:function(){return e},setCursor:function(e){j.css("cursor",e)},enableHandles:L,enableOnly:function(){a=!0},showHandles:k,disableHandles:O,animMode:M,setBgOpacity:x,done:_}}(),nt=function(){function i(){F.css({zIndex:450}),Y.support&&$(document).bind("touchmove.jcrop",f).bind("touchend.jcrop",c),r&&$(document).bind("mousemove.jcrop",o).bind("mouseup.jcrop",u)}function s(){F.css({zIndex:290}),$(document).unbind(".jcrop")}function o(t){return e(l(t)),!1}function u(r){return r.preventDefault(),r.stopPropagation(),K&&(K=!1,t(l(r)),tt.isAwake()&&n.onSelect.call(yt,b(Z.getFixed())),s(),e=function(){},t=function(){}),!1}function a(n,r){return K=!0,e=n,t=r,i(),!1}function f(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,o(e)}function c(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,u(e)}function h(e){F.css("cursor",e)}var e=function(){},t=function(){},r=n.trackDocument;return r||F.mousemove(o).mouseup(u).mouseout(u),A.before(F),{activateHandlers:a,setCursor:h}}(),rt=function(){function r(){n.keySupport&&(e.show(),e.focus())}function i(t){e.hide()}function o(e,t,r){n.allowMove&&(Z.moveOffset([t,r]),tt.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function u(e){if(e.ctrlKey||e.metaKey)return!0;G=e.shiftKey?!0:!1;var t=G?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:n.allowSelect&&tt.release();break;case 9:return!0}return!1}var e=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),t=$("<div />").css({position:"absolute",overflow:"hidden"}).append(e);return n.keySupport&&(e.keydown(u).blur(i),s||!n.fixedSupport?(e.css({position:"absolute",left:"-20px"}),t.append(e).insertBefore(A)):e.insertBefore(A)),{watchKeys:r}}();Y.support&&F.bind("touchstart.jcrop",Y.newSelection),H.hide(),gt(!0);var yt={setImage:vt,animateTo:st,setSelect:ot,setOptions:lt,tellSelect:at,tellScaled:ft,setClass:it,disable:ct,enable:ht,cancel:pt,release:tt.release,destroy:dt,focus:rt.watchKeys,getBounds:function(){return[O*X,M*V]},getWidgetSize:function(){return[O,M]},getScaleFactor:function(){return[X,V]},getOptions:function(){return n},ui:{holder:_,selection:B}};return $.browser.msie&&_.bind("selectstart",function(){return!1}),C.data("Jcrop",yt),yt},$.fn.Jcrop=function(e,t){var n;return this.each(function(){if($(this).data("Jcrop")){if(e==="api")return $(this).data("Jcrop");$(this).data("Jcrop").setOptions(e)}else this.tagName=="IMG"?$.Jcrop.Loader(this,function(){$(this).css({display:"block",visibility:"hidden"}),n=$.Jcrop(this,e),$.isFunction(t)&&t.call(n)}):($(this).css({display:"block",visibility:"hidden"}),n=$.Jcrop(this,e),$.isFunction(t)&&t.call(n))}),this},$.Jcrop.Loader=function(e,t,n){function s(){i.complete?(r.unbind(".jcloader"),$.isFunction(t)&&t.call(i)):window.setTimeout(s,50)}var r=$(e),i=r[0];r.bind("load.jcloader",s).bind("error.jcloader",function(e){r.unbind(".jcloader"),$.isFunction(n)&&n.call(i)}),i.complete&&$.isFunction(t)&&(r.unbind(".jcloader"),t.call(i))},$.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}),window.webcam={version:"1.0.9",ie:!!navigator.userAgent.match(/MSIE/),protocol:location.protocol.match(/https/i)?"https":"http",callback:null,swf_url:"webcam.swf",shutter_url:"shutter.mp3",api_url:"",loaded:!1,quality:90,shutter_sound:!0,stealth:!1,hooks:{onLoad:null,onComplete:null,onError:null},set_hook:function(e,t){if(typeof this.hooks[e]=="undefined")return alert("Hook type not supported: "+e);this.hooks[e]=t},fire_hook:function(e,t){return this.hooks[e]?(typeof this.hooks[e]=="function"?this.hooks[e](t):typeof this.hooks[e]=="array"?this.hooks[e][0][this.hooks[e][1]](t):window[this.hooks[e]]&&window[this.hooks[e]](t),!0):!1},set_api_url:function(e){this.api_url=e},set_swf_url:function(e){this.swf_url=e},get_html:function(e,t,n,r,i){n||(n=e),r||(r=t);var s="",o="shutter_enabled="+(this.shutter_sound?1:0)+"&shutter_url="+escape(this.shutter_url)+"&width="+e+"&height="+t+"&server_width="+n+"&server_height="+r;return this.ie?s+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"'+' width="'+e+'" height="'+t+'" id="webcam_movie" align="middle">'+'<param name="allowScriptAccess" value="always" />'+'<param name="allowFullScreen" value="false" />'+'<param name="movie" value="'+this.swf_url+'" />'+'<param name="loop" value="false" />'+'<param name="menu" value="false" />'+'<param name="quality" value="best" />'+'<param name="bgcolor" value="#ffffff" />'+'<param value="'+i+'" name="wmode">'+'<param name="flashvars" value="'+o+'"/></object>':s+='<embed id="webcam_movie" src="'+this.swf_url+'" loop="false" menu="false" '+'quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" '+'name="webcam_movie" align="middle" allowScriptAccess="always" '+'allowFullScreen="false" type="application/x-shockwave-flash" wmode="'+i+'"'+'pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+o+'" />',this.loaded=!1,s},get_movie:function(){if(!this.loaded)return alert("ERROR: Movie is not loaded yet");var e=document.getElementById("webcam_movie");return e||alert("ERROR: Cannot locate movie 'webcam_movie' in DOM"),e},set_stealth:function(e){this.stealth=e},snap:function(e,t,n){t&&this.set_hook("onComplete",t),e&&this.set_api_url(e),typeof n!="undefined"&&this.set_stealth(n),this.get_movie()._snap(this.api_url,this.quality,this.shutter_sound?1:0,this.stealth?1:0)},freeze:function(){this.get_movie()._snap("",this.quality,this.shutter_sound?1:0,0)},upload:function(e,t){t&&this.set_hook("onComplete",t),e&&this.set_api_url(e),this.get_movie()._upload(this.api_url)},reset:function(){this.get_movie()._reset()},configure:function(e){e||(e="camera"),this.get_movie()._configure(e)},set_quality:function(e){this.quality=e},set_shutter_sound:function(e,t){this.shutter_sound=e,this.shutter_url=t?t:"shutter.mp3"},flash_notify:function(e,t){switch(e){case"flashLoadComplete":this.loaded=!0,this.fire_hook("onLoad");break;case"error":this.fire_hook("onError",t)||alert("JPEGCam Flash Error: "+t);break;case"success":this.fire_hook("onComplete",t.toString());break;default:alert("jpegcam flash_notify: "+e+": "+t)}}},define("plugin/webcam",function(){}),define("page/setting/avatar",["jquery","model/setting","plugin/dialog","page/page_base","module/uploadimg","plugin/jquery.jcrop","plugin/webcam"],function(e,t,n,r,i){function w(){var t=e("#local_photo");t.css("position","relative");var r=t.text();albumUploadImg=new i({url:o,$el:t,maxSize:5,file_upload_limit:1,repeat:!0,swfupload_loaded_handler:function(){},beforeUpload:function(){f.attr({src:a}),E.prepare()},success:function(e,t,r){if(!e.status){n&&n.alert(e.msg);return}var i=e.data[0],o=i.uploadTrack.id,u=s+"/"+i.processResult[260],a=new Image;a.onload=function(){E.init(u,a.width,a.height,o)},a.src=u}});return}function T(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}var s=config.FDFS_PATH,o=config.DIRECT_DTRES_ROOT+"/headerThumb/upload",u=config.DIRECT_DTRES_ROOT+"/header/cut",a=config.STATIC_ROOT+"/css/img/record/loading.gif",f=e("#img_photo"),l=e("#img_photo_container"),c=e("#photo_handle"),h=e("#photo_shoot"),p=e("#preview_100"),d=e("#preview_60"),v=e("#preview_30"),m=e("#trackUploadInfo"),g=e("#trackUploadId"),y=260,b=260,E={width:300,height:300,init:function(e,t,n,r){if(!e||!t||!n)return;g.val(r),this.width=t,this.height=n,l.css({left:(y-t)/2,top:(b-n)/2,width:t,height:n}),f.attr("src",e);if(!r)return;p.attr("src",e),d.attr("src",e),v.attr("src",e);var i=this,s=[t/2-50,n/2-50,t/2+50,n/2+50];f.Jcrop({onChange:function(e){i.onChange(e)},onSelect:function(e){i.onChange(e)},setSelect:s,minSize:[30,30],aspectRatio:1,bgOpacity:.5},function(){i.jcrop_api=this})},prepare:function(){c.show(),h.hide(),E.destroy(),l.css({left:0,top:0,width:y,height:b}),f.css({visibility:"visible"})},destroy:function(){this.jcrop_api&&this.jcrop_api.destroy()},release:function(){this.jcrop_api&&this.jcrop_api.release()},onChange:function(t){parseInt(t.w)>0&&(this.showPreview(p,100,100,t),this.showPreview(d,60,60,t),this.showPreview(v,30,30,t),e("#upload_w").val(parseInt(t.w)),e("#upload_h").val(parseInt(t.h)),e("#upload_x").val(parseInt(t.x)),e("#upload_y").val(parseInt(t.y)),e("#upload_ow").val(this.width),e("#upload_oh").val(this.height))},showPreview:function(e,t,n,r){var i=this.width,s=this.height,o=t/r.w,u=n/r.h;e.css({width:Math.round(o*i)+"px",height:Math.round(u*s)+"px",marginLeft:"-"+Math.round(o*r.x)+"px",marginTop:"-"+Math.round(u*r.y)+"px"})}};e("#photo_upload").click(function(){c.hide(),h.show(),x.init()});var S=!0;e("#take_snapshot").click(function(){if(S)return;x.snap(),S=!0});var x={inited:!1,init:function(){this.inited?webcam.reset():(webcam.set_swf_url(config.STATIC_PATH+"/cdnswf/webcam.swf?_t="+(new Date).getTime()),webcam.set_api_url(o+"?"+"token="+T(config.TOKEN_LABEL)+"&rememberMe="+T(config.REMEMBERME_LABEL)),webcam.set_quality(90),webcam.set_shutter_sound(!1),e("#snapshot_warp").html(webcam.get_html(y,b,y,b,"transparent")),webcam.set_hook("onLoad",this.onLoad),webcam.set_hook("onComplete",this.onComplete),webcam.set_hook("onError",this.onError)),this.inited=!0},onComplete:function(t){t=e.parseJSON(t),t.status&&(E.prepare(),E.init(s+"/"+t.data[0].processResult[260],260,260,t.data[0].uploadTrack.id)),S=!1},onLoad:function(){S=!1},onError:function(e){n.alert("摄像头未找到:"+e)},snap:function(){webcam.snap()}};e("#submit_btn").click(function(){var t=e("#trackUploadId").val();t&&e(this).parent().submit()});if(f.attr("src")){E.prepare();var N=f.attr("src");E.init(N,260,260)}var C=r.extend({init:function(){this.callParent("init"),w()}});return new C}),define("page/setting/blacklist",["jquery","page/page_base","module/blacklist","plugin/dialog"],function(e,t,n,r){var i=t.extend({init:function(){this.callParent("init"),this.bindEvents()},bindEvents:function(){var t=this;e(".set_blacklist").on("click",".removeBtn",function(){var t=e(this),r=t.attr("remove_from_blacklist"),i=t.closest("li"),s=i.find(".set_blacklist_name a").html();n.remove(s,r,function(){i.slideUp()})})},release:function(){this.callParent("release")}});return new i}),define("page/setting/message",["jquery","page/page_base","model/setting","plugin/dialog"],function(e,t,n,r){var i=t.extend({model:new n,init:function(){this.callParent("init"),this.bindEvents()},bindEvents:function(){var t=this;e(".confirmBtn").on("click",function(){t.submit()})},submit:function(){this.model.set("postData",e("form").serialize()),this.model.message(function(e){r.success("保存成功")},function(e){r.alert("保存失败")})},release:function(){this.callParent("release")}});return new i}),define("module/dialogs/bindemail",["jquery","plugin/dialog","../../model/setting"],function(e,t,n){var r=new n,i={open:function(t){this.callback=t||e.noop,this.createPop()},createPop:function(){var e='<div>填写自己常用邮箱地址，方便大家联系你！</div><dl class="popup_dl"><dt>邮箱地址</dt><dd><input type="text" value=""><div class="error" tabindex="1"  onkeydown="helper.enterToTab(event,this);">请输入正确的邮箱</div></dd></dl><div class="operate"><button class="confirmBtn" tabindex="2">立即绑定</button></div>',n={dialogClass:"bindemail js-tabindex",header:"常用邮箱绑定",content:e},r=new t.Dialog(n);r.open(),this.pop=r,this.$el=r.getEl(),this.$input=this.$el.find("input"),this.$popup_dl=this.$el.find(".popup_dl"),this.bindEvents()},bindEvents:function(){var e=this,t=this.$el;t.on("click",".confirmBtn",function(){e.bindEmail()})},bindEmail:function(){var t=e.trim(this.$input.val()),n=this;if(!this.checkEmail(t)){this.emailError();return}r.bindEmail(t,function(e){e.email=t,n.callback(e),n.pop.close()},function(e){n.emailError(e.msg)})},checkEmail:function(e){var t=/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return t.test(e)},emailError:function(e){var t=this.$popup_dl,n=t.find(".error");t.addClass("is-error"),n.html(e||"请输入正确的邮箱")}};return i}),define("module/dialogs/rebindemail",["jquery","plugin/dialog","../../model/setting","module/select/coutryselect","module/login/verify"],function(e,t,n,r,i){var s=new n,o=i.verify,u={open:function(t,n){this.callback=n||e.noop,this.createPop(t)},createPop:function(e){var n='<dl class="popup_dl js-oldemail"><dt>原邮箱地址</dt><dd><input type="text" class="mgl-20" value=""  tabindex="1"  onkeydown="helper.enterToTab(event,this);"><div class="error">请输入正确的邮箱</div></dd></dl><dl class="popup_dl js-oldphone hidden"><dt style="text-indent: 2em;">手机号</dt><dd><div class="j-new-mobile-conutry" style="display: inline-block;"></div><input style="width: 126px;" type="text" value=""  tabindex="2"  onkeydown="helper.enterToTab(event,this);"><div class="error">请输入正确的手机号码</div></dd></dl><dl class="popup_dl js-email"><dt style="text-indent: 1em;">邮箱地址</dt><dd></div><input class="mgl-20" type="text" value=""  tabindex="3"  onkeydown="helper.enterToTab(event,this);"><div class="error">请输入正确的邮箱</div></dd></dl><div class="operate"><button class="confirmBtn" tabindex="4" >立即更改</button></div>',i={dialogClass:"bindemail js-tabindex",header:e?'<a class="on js-by-oldemail">邮箱验证</a><a class="js-by-oldphone">手机验证</a>':'<a class="on">邮箱验证</a>',content:n,template:{dialog_header:'<div class="hd2"></div>'}},s=new t.Dialog(i);s.open(),this.pop=s,this.$el=s.getEl(),this.$oldemailBox=this.$el.find(".js-oldemail"),this.$oldemail=this.$oldemailBox.find("input"),this.$oldemail_error=this.$oldemailBox.find(".error"),this.$oldphoneBox=this.$el.find(".js-oldphone"),this.$oldphone=this.$oldphoneBox.find("input"),this.$oldphone_error=this.$oldphoneBox.find(".error"),this.oldemail_right=!1,this.oldphone_right=!1,this.$emailBox=this.$el.find(".js-email"),this.$email=this.$emailBox.find("input"),this.$email_error=this.$emailBox.find(".error"),this.bindEvents(),this.onblurSetTimeoutId,this.coutryview=new r({type:"old",el:".j-new-mobile-conutry"}),this.coutryview.$el.find(".selecter-m1").removeClass("wid-110").addClass("wid-80")},bindEvents:function(){var t=this,n=this.$el;n.on("click",".confirmBtn",function(){t.$el.find(".js-by-oldphone").is(".on")?t.bindEmailByOldphone():t.bindEmailByOldEmail()}),this.$el.find(".hd2").find("a").on("click",function(){if(this.onblurSetTimeoutId){clearTimeout(this.onblurSetTimeoutId);return}t.$el.find(".hd2").find("a").removeClass("on");var n=e(this);n.addClass("on"),n.is(".js-by-oldphone")?(t.$oldphone.val(""),t.oldPhoneError(!1),t.$oldphoneBox.show(),t.$oldemailBox.hide(),t.oldphone_right=!1):(t.$oldemail.val(""),t.oldemailError(!1),t.$oldemailBox.show(),t.$oldphoneBox.hide(),t.oldemail_right=!1)}),this.$oldphone.on("blur",function(){this.onblurSetTimeoutId=setTimeout(function(){var e=t.$oldphone.val(),n=t.coutryview.getSelected(),r=n.code;if(!e){t.oldPhoneError("请输入已绑定的手机号");return}if(t.coutryview.isCN()&&!t.checkPhone(e)){t.oldPhoneError();return}e=o.getPhoneByCode(r,e),s.checkOldPhone(e,function(e){t.oldphone_right=!0,t.oldPhoneError(!1)},function(e){t.oldPhoneError(e.msg)})},500)}),this.$oldemail.on("blur",function(){this.onblurSetTimeoutId=setTimeout(function(){var e=t.$oldemail.val();if(!e){t.oldemailError("请输入原邮箱地址");return}if(!t.checkEmail(e)){t.oldemailError();return}s.checkOldEmail(e,function(e){t.oldemail_right=!0,t.oldemailError(!1)},function(e){t.oldemailError(e.msg)})},500)})},bindEmailByOldphone:function(){var t=e.trim(this.$email.val()),n=e.trim(this.$oldphone.val()),r=this,i=r.coutryview.getSelected(),u=i.code;if(!n){this.oldPhoneError("请输入已绑定的手机号码");return}if(r.coutryview.isCN()&&!this.checkPhone(n)){this.oldPhoneError();return}if(!this.oldphone_right)return;if(!this.checkEmail(t)){this.emailError();return}n=o.getPhoneByCode(u,n),s.rebindEmail(null,n,t,function(e){e.email=t,r.callback(e),r.pop.close()},function(e){r.emailError(e.msg)})},bindEmailByOldEmail:function(){var t=e.trim(this.$email.val()),n=e.trim(this.$oldemail.val()),r=this;if(!n){this.oldemailError("请输入原邮箱地址");return}if(!this.checkEmail(n)){this.oldemailError();return}if(!this.oldemail_right)return;if(!this.checkEmail(t)){this.emailError();return}s.rebindEmail(n,null,t,function(e){e.email=t,r.callback(e),r.pop.close()},function(e){r.emailError(e.msg)})},checkPhone:function(t){return t=e.trim(t),!0},checkEmail:function(e){var t=/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return t.test(e)},emailError:function(e){this.$emailBox.addClass("is-error"),this.$email_error.html(e||"请输入正确的邮箱")},oldemailError:function(e){e===!1?this.$oldemailBox.removeClass("is-error"):(this.$oldemailBox.addClass("is-error"),this.$oldemail_error.html(e||"请输入正确的邮箱"))},oldPhoneError:function(e){e===!1?this.$oldphoneBox.removeClass("is-error"):(this.$oldphoneBox.addClass("is-error"),this.$oldphone_error.html(e||"请输入正确的手机号码"))}};return u}),define("page/setting/personal",["jquery","helper","page/page_base","model/setting","module/dialogs/city","plugin/dialog","module/dialogs/bindemail","module/dialogs/rebindemail","module/dialogs/bindmobile","plugin/pops"],function(e,t,n,r,i,s,o,u,a,f){var l=n.extend({model:new r,init:function(){this.callParent("init"),this.initConstellation(),this.initBirthday(),this.bindEvents(),this._error={nickname:!1,realname:!1,signature:!1}},bindEvents:function(){var t=this,n=e("#changeCity"),r=e("#province"),f=e("#city");n.on("click",function(){i.open(function(e,t){n.html(e+" • "+t),r.val(e),f.val(t)})});var l=e("#resendMail");l.on("click",function(){t.resendMail()});var c=e("#resendMail2");c.on("click",function(){var n=e(this),r=n.attr("email")||"";t.resendMail(r,"old")});var h=e("#phone_bind"),p=e("#phone_bind2");h.on("click",function(){t.model.mobileFrequency(function(t){t.success?a.open(!0,function(t){e(".verify_mobile").show(),e(".unverify_mobile").hide(),e(".personal_verify_mobile").text(t.phone)},{oldMobile:e(".personal_verify_mobile:eq(0)").text()}):s.alert(t.msg)},function(e){s.warn(e.msg||"服务器繁忙,请稍后再试!")})}),p.on("click",function(){t.bindMobile()});var d=e("#email_bind"),v=e("#email_show"),m=e("#email_activate"),g=e("#email_activate2");d.on("click",function(){t.model.emailBindRetry(function(e){e.success?o.open(function(e){var n=e.email;m.attr("href",e.domain),g.attr("href",e.domain),t.popResendEmail(n,"new")}):s.alert(e.msg)},function(e){s.warn(e.msg||"服务器繁忙,请稍后再试!")})}),e("#email_bind2").on("click",function(){var n=!!e(this).attr("phoneBinded");t.model.emailFrequency(function(e){e.success?u.open(n,function(e){var n=e.email;m.attr("href",e.domain),g.attr("href",e.domain),t.popResendEmail(n,"new")}):s.alert(e.msg)},function(e){s.warn(e.msg||"服务器繁忙,请稍后再试!")})});var y=e("#nickname_show"),b=e("#nickname");e("#changeNickname").on("click",function(){y.hide(),b.val(y.html()).show(),e(this).hide()}),b.on({blur:function(){t.checkNickname(b)},focus:function(){t.infoClear(b)}});var w=e("#personalSignature");w.on({blur:function(){t.checkSignature(w)},focus:function(){t.infoClear(w)}});var E=e("#realName");E.on({blur:function(){t.checkRealName(E)},focus:function(){t.infoClear(E)}}),e("#confirmBtn").on("click",function(){for(var e in t._error)if(t._error[e])return;t.submit()})},bindMobile:function(){a.open(!1,function(){e(".verify_mobile").show(),e(".unverify_mobile").hide()})},popResendEmail:function(e,t){var n=this,r=['<div class="bd">',"<div>","我们已经发送一封验证邮件到您的账户<br><br>","请访问您的邮箱：<em>"+e+"</em>，点击邮件中的链接就可以验证您的邮箱。","</div>",'<div class="confirmemailTxt">如果没有收到激活邮件：<br>',"· 也许邮件被您的邮箱误认为是垃圾邮件而放到垃圾箱中，请检查一下<br>",'· 或者，您可以<a class="js-resendEmail">点此重新发送验证邮件</a>',"</div>","</div>",'<a class="close3Btn" dialog-role="close"></a>'].join(""),i={dialogClass:"confirmemail",header:"",content:r},o=new s.Dialog(i),u=o.getEl();o.open(),u.find(".js-resendEmail").off("click").on("click",function(){n.model.reSendActive(t,function(e){e.success?s.success(e.msg):s.alert(e.msg)},function(e){s.warn(e.msg||"服务器繁忙,请稍后再试!")})})},checkRealName:function(n){var r=e.trim(n.val()),i=t.gblen(r),s="",o=this;return this._error.realname=!1,r?i>20||i<=2?(s="请填写真实姓名",o.infoError(n,s),o._error.realname=!0,!1):!0:!0},checkSignature:function(n){this._error.signature=!1;var r=e.trim(n.val()),i=t.gblen(r),s="",o=300,u=this;return i>o*2?(s="请不要超过"+o+"个字",u.infoError(n,s),u._error.signature=!0,!1):!0},checkNickname:function(n,r){this._error.nickname=!1,r=r||e.noop;var i=e.trim(n.val()),s=t.gblen(i),o="",u=this;if(s<4||s>20)return o="长度有误，请输入4-20位字符",u.infoError(n,o),u._error.nickname=!0,!1;if(i==current_user.nickname)return!0;this.model.checkNickname(i,function(e){u.infoCorrect(n),r(e)},function(e){u.infoError(n,e.msg||"服务器繁忙,请稍后再试!"),u._error.nickname=!0})},resendMail:function(e,t){var n=this;this.model.reSendActive(t,function(r){r.success?n.popResendEmail(e,t):s.alert(r.msg)},function(e){s.warn(e.msg||"服务器繁忙,请稍后再试!")})},submit:function(){this.model.set("postData",e("form").serialize()),this.model.personal(function(t){e("#nickname").val()!==current_user.nickname?f.Toast("新昵称审核中，审核通过将自动生效",1200):s.success("保存成功"),setTimeout(function(){window.history.go(0)},800)},function(e){s.alert(e.msg)})},getConstellation:function(){return{"白羊座":[321,420],"金牛座":[421,521],"双子座":[522,621],"巨蟹座":[622,722],"狮子座":[723,823],"处女座":[824,923],"天秤座":[924,1023],"天蝎座":[1024,1122],"射手座":[1123,1221],"魔羯座":[1222,120],"水瓶座":[121,219],"双鱼座":[220,320]}},initConstellation:function(){var t=e("#constellation"),n=t.val(),r=this.getConstellation(),i='<option value="-1">----</option>';for(var s in r)i+='<option value="'+s+'">'+s+"</option>";t.html(i),t.val(n)},setConstellation:function(t,n){t*=1,n*=1;var r=e("#constellation");if(t<=0||n<=0){r.val(-1);return}var i=this.getConstellation(),s=t*100+n,o="";for(var u in i){var a=i[u];if(s>=a[0]&&s<=a[1]){o=u;break}if(a[0]>a[1]&&(s>=a[0]||s<=a[1])){o=u;break}}r.val(o)},initBirthday:function(){var t=e("#birth_year"),n=e("#birth_month"),r=e("#birth_day"),i=t.val(),s=n.val(),o=r.val(),u=new Date,a=u.getFullYear(),f=0,l="",c=this;l='<option value="-1">----</option>';for(f=0;f<100;f++){var h=a-f;l+='<option value="'+h+'">'+h+"</option>"}t.html(l),t.val(i),l='<option value="-1">--</option>';for(f=1;f<13;f++)l+='<option value="'+f+'">'+(f<10?"0"+f:f)+"</option>";n.html(l),n.val(s),n.on({change:function(){var i=e(this).val(),s=t.val(),o=31;switch(parseInt(i)){case 4:case 6:case 9:case 11:o=30;break;case 2:o=s%400==0||s%4==0&&s%100!=0?29:28}l='<option value="-1">--</option>';for(var u=1;u<=o;u++)l+='<option value="'+u+'">'+(u<10?"0"+u:u)+"</option>";var a=r.val();r.html(l),a>o&&(a=o),r.val(a),c.setConstellation(n.val(),r.val())}}),r.on("change",function(){c.setConstellation(n.val(),r.val())}),n.change()},infoCorrect:function(e){var t=e.closest(".set_dl"),n=t.find(".correct");t.addClass("is-correct").removeClass("is-error")},infoError:function(e,t){var n=e.closest(".set_dl"),r=n.find(".error");n.removeClass("is-correct").addClass("is-error"),r.html(t||"")},infoClear:function(e){var t=e.closest(".set_dl");t.removeClass("is-correct").removeClass("is-error")},release:function(){this.callParent("release")}});return new l}),define("page/setting/privacy",["jquery","page/page_base","model/setting","plugin/dialog"],function(e,t,n,r){var i=t.extend({model:new n,init:function(){this.callParent("init"),this.bindEvents()},bindEvents:function(){var t=this;e(".confirmBtn").on("click",function(){t.submit()})},submit:function(){this.model.set("postData",e("form").serialize()),this.model.privacy(function(e){r.success("保存成功")},function(e){r.alert("保存失败")})},release:function(){this.callParent("release")}});return new i}),define("page/setting/sync",["jquery","page/page_base","model/thirdpart","plugin/dialog"],function(e,t,n,r){var i=new n,s=t.extend({init:function(){this.callParent("init"),this.$el=e(".set_container"),this.bindEvents(),this.$el.find("form").attr("autocomplete","off")},bindEvents:function(){var t=this.$el,n=this;t.on("click",".set_syncInner [data-bind]",function(){var t=e(this).attr("data-bind");n.addBind(t)}),t.on("click",".set_syncInner [data-unbind]",function(){var t=e(this).attr("data-unbind");n.unBind(t)}),t.on("click",".confirmBtn",function(){return n.submit(),!1})},submit:function(){var t=this.$el.find("form").serialize(),n=this;e.post("/passport/sync_set_save",t,function(){r.success("保存成功"),n.success()})},success:function(){e.get("/passport/sync_set_part",function(t){e(".set_container .set_right").html(t)})},addBind:function(e){var t=this;i.addBind(e,function(){t.success()})},unBind:function(e){var t={tSina:"新浪微博",qzone:"QQ",renren:"人人网",weixin:"微信"},n=this;r.confirm("是否要解除绑定,解绑后不能再用该"+t[e]+"帐号登录？",function(){i.unBind(e,function(e){n.success()},function(e){r.alert(e.msg)})})},release:function(){this.callParent("release")}});return new s}),define("page/setting/password",["jquery","page/page_base","model/setting","plugin/dialog","plugin/validator","model/account"],function(e,t,n,r,i,s){var o=t.extend({model:new n,init:function(){this.callParent("init"),window.msg&&r.alert(msg),this.bindEvents()},bindEvents:function(){function c(t){var n=e(t),r=n.val(),s=r.length;return s<6||s>16?(p(n,"密码长度不正确"),!1):i.validator(r,"include_chinese")?(p(n,"密码请勿使用特殊字符"),!1):(m(n),!0)}function h(){return t.size()!=0&&t.triggerHandler("blur"),n.triggerHandler("blur"),r.triggerHandler("blur"),a&&f&&l?!0:!1}function p(e,t){var n=e.parents(".set_dl");n.removeClass("is-correct").addClass("is-error"),n.find(".error").html(t),m(e)}function d(e){var t=e.parents(".set_dl");t.addClass("is-correct").removeClass("is-error"),m(e)}function v(e){e.parents(".set_dl").removeClass("is-error is-correct"),e.parents(".set_dl").find(".set_hint").show()}function m(e){e.parents(".set_dl").find(".set_hint").hide()}var t=e("#old_pwd"),n=e("#new_pwd"),r=e("#confirm_pwd"),o=e("#confirmBtn"),u="",a=!1,f=!1,l=!1;t.size()==0?a=!0:t.bind({blur:function(){c(this)?(a=!0,d(e(this))):a=!1},focus:function(){v(t)}}),n.bind({blur:function(){var t=e(this);c(this)?(u=t.val(),f=!0,d(t)):f=!1},focus:function(){v(n)}}),r.bind({blur:function(){var t=e(this);c(this)?u!=t.val()?(p(t,"两次输入的密码不一致"),l=!1):(l=!0,d(t)):l=!1},focus:function(){v(r)}}),o.click(function(){if(h()){var t=e("#old_pwd").val(),n=e("#new_pwd").val(),r=e("#confirm_pwd").val(),i=new s;e("#old_pwd").val(i.encryption(t)),e("#new_pwd").val(i.encryption(n)),e("#confirm_pwd").val(i.encryption(r)),o.closest("form").submit()}})},release:function(){this.callParent("release")}}),u=new o;return u}),define("page/setting/feed",["jquery","page/page_base","model/setting","plugin/dialog"],function(e,t,n,r){var i=t.extend({model:new n,init:function(){this.callParent("init"),this.bindEvents()},bindEvents:function(){var t=this;e(".confirmBtn").on("click",function(){t.submit()}),e(".album_list ").on("click",".recoverBtn",function(){var t=e(this),n=t.attr("data-albumid"),i=t.attr("data-albumuid");e.ajax({url:"/feed2/cancel_sfeed_shield",dataType:"json",data:{albumId:n,albumUid:i},success:function(e){e.res?t.closest(".item").remove():r.alert(e.msg)},complete:function(){}})})},submit:function(){this.model.set("postData",e("form").serialize()),this.model.feed(function(e){r.success("保存成功")},function(e){r.alert("保存失败")})},release:function(){this.callParent("release")}});return new i}),define("page/upload/information",["jquery","json2","page/page_base","plugin/dialog","plugin/count_char","plugin/swfupload/swfupload.queue","module/uploadimg","module/share","module/header_search","module/dialogs/bindmobile","router","plugin/pops","plugin/jquery.selecter","plugin/kindeditor/kindeditor","plugin/datepicker"],function(e,t,n,r,i,s,o,u,a,f,l,c){function tt(){return"localStorage"in window&&window.localStorage!==null}function it(t,n){rt=t,vt(D),vt(M),vt(_),n,Qt(),rt?(e(".conMain").removeClass("conMain_add_img"),e(".conMain").addClass("upload-for-album")):e(".conMain").addClass("conMain_add_img")}function st(){N=e("#infoErr"),k=e("#title"),L=e("#origin"),A=e("#genre"),O=e("#genre_sub"),M=e(".music"),_=e(".lyric"),D=e(".non_music"),P=e("#advanced_settings"),H=e("#agreeDeal"),B=e("#createNewAlbum"),j=e("#submit_save"),F=e("#album_list"),I=e("#description"),q=e("#sound_title"),R=e("#sound_origin"),U=e("#sound_genre"),z=e("#sound_genre_sub"),W=e("[name=intro]"),X=e("[name=rich_intro]"),V=e("[name=sound_intro]"),$=e("[name=sound_rich_intro]"),J=e("[name=sound_lyric]"),K=e("[name=sound_music_lyric]"),Q=e("#next_step_btn"),G=e("#step1"),Y=e("#step2"),Z=e("#step3"),et=e("input[name=is_public]")}function ut(){function k(){p.removeClass("on"),h.removeClass("on"),G.hide(),Y.show(),Z.show(),y.addClass("on"),b.show(),Tt(e("#sound_imageWrap"),e("#sound_uploadPicBtn")),setTimeout(function(){helper.scrollTo(p,-100)},250);var t=e("[public=true]");w?t.show():t.hide(),ot.sound_genre()}function L(t,n){n=n||e.noop,d.addClass("loadingMore").css({height:"auto",margin:0}),t=t||1,e.get("/upload2/choose_album",{page:t},function(e){var t=g.val(),n;v.html(e),n=v.find("li[album_id="+t+"]"),n.size()&&n.trigger("click"),d.removeClass("loadingMore")})}var t=e("#title"),n=e("#origin"),i=e("#genre"),s=e("#genre_sub"),o=e(".music"),u=e(".lyric"),a=e("#description"),f=e(".non_music"),c=e("input[name=is_public]");ot.titleSuccess=!1,ot.originSuccess=!1,ot.genreSuccess=!1;var h=e("#createNewAlbum"),p=e("#addToAlbum"),d=e("#chooseAlbum"),v=e("#choose_album_entry"),m=e("#info_table_warp"),g=d.find("input[name=choose_album]"),y=Y.find("h2").eq(0),b=Y.find(".tbInfo"),S=e("#sound_origin"),x=e("#sound_genre"),T=e("#sound_genre_sub"),N=e("#album_id"),C=e("#sound_title");e(".selecter").selecter(),t.bind("blur",function(){ot.album_title(),at()}),C.bind("blur",function(){ot.sound_title()}),x.bind("change",function(){ct()}),n.bind("change",function(){ot.album_origin(),at();var e=n.selecter("val")||n.val();S.selecter("val",e)}),i.bind("change",function(){ot.album_genre(),lt(),at();var e=i.selecter("val")||i.val();x.selecter("val",e),x.trigger("change")}),s.bind("change",function(){ot.album_genre()}),T.bind("change",function(){ot.sound_genre(),ht()}),E&&N.bind("change",function(){var t=e(this),n=t.closest("[data-default-is-public]").attr("data-default-is-public"),i=t.find(".selecter-selected i"),s=N.selecter("val"),o=N.find("[data-value="+s+"]").is("[data-is-public=true]");n=n!=="false",n?o||(t.selecter("reset"),r.alert("公开节目只能添加至公开专辑")):o?(r.alert("加入此专辑以后，节目将会被公开",{yesText:"知道了"}),i.hide()):i.show()}),i.trigger("change"),setTimeout(function(){x.trigger("change")},0),T.size()&&T.selecter("val")&&T.trigger("change"),a.bind({blur:function(){ft(e(this))},focus:function(){on.setRight(a)}}),c.bind("click",function(){var t=e(this).attr("value"),n=e("[public=true]");t=="1"?(w=!0,n.show()):(w=!1,n.hide())}),Q.on("click",function(){var t=e(this),n=t.parent().find(".infoErr");if(t.is(".disabled"))return!1;var r=e(".progressBarContainer li");r.each(function(){e(this).find(".editConfirm").trigger("click")});var i=e(".progressBarContainer li.is-error:eq(0)");if(i.length>0){e(".progressBarContainer li.is-error:eq(0)").find("input[name='files[]']").trigger("focus");return}if(ot.is_addto_selected)k();else{nn();var s={title:e("#title").val(),intro:e("[name=intro]").val(),tags:e("#chosen_area").val(),category_id:e("[name=category_id]").val(),user_source:e("[name=user_source]").val()};e.ajax({url:"/upload2/verify_new_album_info",data:s,dataType:"json",method:"post",success:function(e){if(e.res)k(),x.trigger("change"),n.hide();else{var t=e.errors;n.show(),Pt(t,n)}},error:function(){}})}}),p.on("click",function(){if(p.hasClass("forbid"))return;var t=e(this);ot.is_addto_selected=!0,t.is(".on")?(t.removeClass("on"),d.hide()):(G.show(),Y.hide(),Z.hide(),t.addClass("on"),h.removeClass("on"),d.show(),m.hide(),v.find(".ablum-item li.selected").trigger("click"),v.children().size()==0&&L(),at())}),h.on("click",function(){var n=e(this);ot.is_addto_selected=!1,n.is(".on")?(n.removeClass("on"),m.hide()):(G.show(),Y.hide(),Z.hide(),p.removeClass("on"),n.addClass("on"),d.hide(),m.show(),g.val(""),at(),t.focus())}),y.on("click",function(){var t=e(this);t.is(".on")?(t.removeClass("on"),b.hide()):(t.addClass("on"),b.show())}),v.find(".ablum-item li").size()||h.click(),d.on("click",".ablum-item li",function(){var t=e(this),n=t.parent(),i=parseInt(t.attr("data-track_limit")),s=parseInt(t.attr("data-track_count")),o=parseInt(e("#upload_file_sum").text()),u=parseInt(t.attr("data-user_source")),a=parseInt(t.attr("data-category_id")),f=parseInt(t.attr("data-music_category"));w=t.attr("data-is_public")!=="false";if(o+s>i)return r.alert("该专辑节目总数不能超过"+i+"!"),!1;n.children().removeClass("selected"),t.addClass("selected"),g.val(t.attr("album_id")),at(),wt=t.attr("data-cover_path"),S.selecter("val",u),S.trigger("change"),f&&T.selecter("val",f),x.selecter("val",a),x.trigger("change");var l=e("[public=true]");w?l.show():l.hide()}),d.on("click",".pagingBar [data-page]",function(){var t=e(this),n=t.attr("data-page");return L(n),!1});var A=e("#cancel_save");A.click(function(){var t=e(this),n=r.confirm("是否要放弃本次操作？",function(){e(".progress-bar-cont li").each(function(){e(this).addClass("is-quiesce-del").find(".del-btn").click()}),l.toPage(t.attr("href")||window.location.href)});return!1})}function at(){if(S)return;var t=e("#chooseAlbum").find("input[name=choose_album]");return ot.is_addto_selected?t.val()?(Q.removeClass("disabled"),!0):(Q.addClass("disabled"),!1):(N.html("").css({color:"red"}),!ot.album_title()||!ot.album_origin()||!ot.album_genre()||!ot.album_intro()?(Q.addClass("disabled"),Y.hide(),Z.hide(),!1):(Q.removeClass("disabled"),!0))}function ft(e){var t=e.val(),n=e.attr("required");if(n&&!t.length)return N.html("请填写节目简介哦~"),!1;if(t&&t.length>y){var r=Math.ceil(t.length-y),i="已超出"+r+"个字";return on.setError(e.parent(),i,!0),!1}return!0}function lt(){var t=A.parent(".cell-2"),n=A.selecter("text");if(n=="音乐"){mt(O),mt(_),O.trigger("change"),vt(D);if(current_user.isVerified){var r='<p class="" id="musician-tips"><a href="http://form.mikecrm.com/0u7Pb7" class="link-red" target="_blank">认证音乐人，享受更多权利>></a></p>';t.length&&t.append(r)}}else mt(D),vt(O),vt(M),vt(_),t.length&&t.find("#musician-tips").remove();var i=e("#is_finished"),s=["有声小说","历史人文"];e.inArray(n,s)>=0?mt(i):vt(i);if(rt){var o=e(".copy_writer");mt(o),vt(D),vt(M),vt(_)}dt();var u=A.selecter("val")||A.val(),a=A.attr("extra");a||At.recommend_tags(u)}function ct(){var t=U,n=e("#sound_genre_sub"),r=t.selecter("text");r=="音乐"?(mt(n),mt(_),n.trigger("change"),vt(D)):(mt(D),vt(n),vt(M),vt(_));var i=e("#is_finished"),s=["有声小说","历史人文"];e.inArray(r,s)>=0?mt(i):vt(i);if(rt){var o=e(".copy_writer");mt(o),vt(D),vt(M),vt(_)}dt();var u=t.selecter("val")||t.val(),a=t.attr("extra");a||Ot.recommend_tags(u),r!="音乐"&&pt({category_id:u})}function ht(){var t=e("#sound_genre_sub"),n=t.parents(".tbInfo");vt(n.find(".music")),mt(_);var r=t.selecter("val")||t.val();switch(r){case"原唱":mt(n.find(".music.original"));break;case"翻唱":mt(n.find(".music.cover"));break;case"伴奏":mt(n.find(".music.sideman"));break;default:}pt({category_id:2,music_category:r})}function pt(t){var n=e("<div></div>").append(e.trim(e("#category_related").html())),r=t.category_id,i=t.music_category,s;r!=2?s=n.find("#default_category_related").html():(i!="原唱"&&i!="翻唱"&&i!="伴奏"&&(i="默认"),i=i||"默认",s=n.find('#music_category_related div[data-title="'+i+'"]').html()),e(".js-category-related").empty().html(s),e(".js-category-related").find(".selecter").selecter();var o=i,u=T&&T.track||null;if(u){o=T.old_music_category||o,o=r!=2?"":o;switch(o){case"原唱":e(".js-category-related").find('[name="sound_singer"]').val(u.singer||""),e(".js-category-related").find('[name="sound_composer"]').val(u.composer||""),e(".js-category-related").find('[name="sound_arrangement"]').val(u.arrangement||""),e(".js-category-related").find('[name="sound_music_author"]').val(u.author||""),e(".js-category-related").find('[name="sound_music_lyric"]').text(u.lyric||""),e(".js-category-related").find('[name="sound_post_production"]').val(u.post_production||""),e(".js-category-related").find('[name="sound_singer_category"]').val(u.singer_category||""),u.singer_category&&e("#origin").selecter("val",u.singer_category);break;case"翻唱":e(".js-category-related").find('[name="sound_singer2"]').val(u.singer||""),e(".js-category-related").find('[name="sound_resinger"]').val(u.resinger||""),e(".js-category-related").find('[name="sound_music_lyric"]').text(u.lyric||"");break;case"伴奏":e(".js-category-related").find('[name="sound_singer3"]').val(u.singer||""),e(".js-category-related").find('[name="sound_music_lyric"]').text(u.lyric||"");break;case"默认":e(".js-category-related").find('[name="sound_music_lyric"]').text(u.lyric||"");break;default:e(".js-category-related").find('[name="sound_author"]').val(u.author||""),e(".js-category-related").find('[name="sound_announcer"]').val(u.announcer||""),e(".js-category-related").find('[name="sound_lyric"]').text(u.lyric||"")}}T.old_music_category=i,Qt()}function dt(){var t=e("[hide_name]");t.each(function(){var t=e(this);t.attr("name",t.attr("hide_name")),t.removeAttr("hide_name")})}function vt(e){e.addClass("hidden")}function mt(e){e.removeClass("hidden")}function Et(){var t,n,r=e("#uploadPicBtn"),i=e("#imageWrap");n=new o({url:d,$el:r,maxSize:3,file_queue_limit:1,file_upload_limit:1,repeat:!0,swfupload_loaded_handler:function(){},file_queued_handler:function(e){t.addImg(e)},error:function(e,n){t.setError(e,n)},success:function(e,n,r){t.fillImg(e,n,r),gt=e,yt=n,bt=r}}),t=new Nt("album",i,1,n),t.init()}function Tt(t,n){var r=4,i=t.find(".soundImgBox"),s=i.find(".imgBox:not(.def)").size();if(St){var t=e("#sound_imageWrap");t.find(".del").trigger("click")}else r-=s,(gt||wt)&&r--,St=new o({url:p,$el:n,maxSize:3,file_queue_limit:4,file_upload_limit:r,swfupload_loaded_handler:function(){xt.alreadyBoxSize()>=4&&this.setButtonDisabled(!0)},file_dialog_complete_handler:function(){this.setFileUploadLimit(r-xt.alreadyBoxSize())},file_queued_handler:function(e){xt.addImg(e)},error:function(e,t){xt.setError(e,t)},success:function(e,t,n){xt.fillImg(e,t,n)}}),xt=new Nt("sound",t,4,St),xt.init();if(gt){var u=gt.data[0].processResult,a=h+"/"+u[100];wt=a}wt&&xt.fillExistImg(wt)}function Nt(e,t,n,r){this.key=e,this.$container=t,this.$soundImgBox=t.find(".soundImgBox"),this.$imgBox2=this.$container.find(".imgBox2"),this.$destroyImg=this.$container.find("input[name=destroy_images]"),this.$upload_img=t.find("img"),this.imgLimit=n||1,this.isSingle=this.imgLimit===1,this.uploadImg=r}function Ct(e,t){var n=e.replace(/[\u0391-\uFFE5]/g,"aa");return n.length<=t}function kt(){if(e("#shareSound .selected").length>0){var t=e("#share_content"),n=t.val();if(rt&&n!=t.attr("default_album_text")||n!=t.attr("default_sound_text")){t.attr("name","share_content");if(t.attr("pass"))return N.html("分享内容长度超过最大长度"),on.setError(t),!1}else t.removeAttr("name")}var i=e("#tr_validcode");if(i.size()>=1){var s=i.find("input"),n=e.trim(s.val());if(!n)return on.setError(i,"验证码错误，请重新输入"),!1}nn();if(!ot.sound_intro(!0)||!ot.sound_lyric(!0)||!ot.sound_music_lyric(!0))return!1;var o=e("#chooseAlbum").find("input[name=choose_album]");if(o.val())return!0;N.html("").css({color:"red"});if(!ot.album_title(!0)||!ot.album_origin(!0)||!ot.album_genre(!0))return!1;if(ot.is_addto_selected&&e("#choose_album_entry").size()&&!e("#choose_album_entry").find(".selected").size())return r.alert("请选择节目所属专辑"),!1;if(E&&!ot.sound_title(!0))return!1;if(!ft(I))return!1;var u=e("#imageWrap"),a=u.find("input[name='image[]']"),f=!0;return a.each(function(){if(!e(this).val())return f=!1,!1}),f?e("input[name=free_type]").length&&!e("input[name=free_type]:checked").length?(N.html("请选择免费试听"),!1):!0:(N.html("图片正在上传中，请稍等"),!1)}function Lt(e){this.$inputArea=e.find(".inputArea"),this.$inputAreaTag=this.$inputArea.find(".inputArea-tag .tagsBox"),this.$tagPanel=e.find(".tags-selecter-tagPanel"),this.$tagPanelCss=e.find(".tagBtnList"),this.$input_editor_area=e.find(".tags-selecter-editor_area"),this.$chosen_area=e.find(".tags-selecter-chosen_area"),this.$results_wrap=e.find(".results_wrap")}function Mt(){var t=e(".share_content_tr"),n=e("#share_content"),r=e("#shareSound .selected[data-share]"),i=e("#shareSound"),s=_t.getShareData(function(e){var t="sharing_to[]",n=e.sharing_to;i.find("[name='"+t+"']").remove();for(var r=0;r<n.length;r++){var s=n[r];i.append('<input name="'+t+'" value="'+s+'" type="hidden"/>')}});if(r.length==0){t.hide();return}t.show(),n.val()||(rt?n.val(n.attr("default_album_text")):n.val(n.attr("default_sound_text"))),n.blur()}function Dt(){var t=e("#shareSound");if(!t.size())return;_t=new u({$el:t,bindedClass:"already",checkedClass:"selected",checkedSuccess:function(){Mt()}}),Mt();var n=e("#share_content"),r=e(".share_content_tr");i(n,r.find(".count-char"),100);return}function Pt(t,n){var i={dirty_words:'信息包含敏感词,请修改，如需帮助请 <a class="j-CustomUniqueTag" href="javascript:void(0);">联系在线客服。</a>',files_dirty_words:"包含敏感词"},s="";for(var o=0,u=t.length;o<u;o++){var a=t[o][0],l=t[o][1];if(a=="page"){var c=e("#tr_validcode"),h=e("#btn_validcode"),p=c.find("input"),d=e('[name="'+l+'"]');if(d.length){var v=d.closest(".row").find(".cell-1")[0].firstChild.textContent;v&&(s=v+i.files_dirty_words,l="")}else n.html(l);h.trigger("click")}if(a=="publish"){on.setError("",l||" 待发布任务数已达上限",!1),n.html("");return}if(a=="mobile"){f.open(function(){r.success("绑定成功,将自动提交",{onClose:function(){e("#submit_save").trigger("click")},autoClose:2e3})});return}if(i[a]){s=i[a];for(var m in l){if(m<0&&m>=-4){r.alert("上传频繁，请在专辑中批量上传或休息2小时再试");return}if(m==-17){n.html("请输入验证码"),on.resetValidCode();return}on.removeValidCdoe();var g,y=l[m];if(y){var b='信息包含敏感词,请修改,如需帮助请 <a class="j-CustomUniqueTag" href="javascript:void(0);">联系在线客服。</a>';m==-19&&(b="信息包含不支持的字符,请修改"),m==-11&&(e('li[sound_id="upload_'+y+'"]').find(".edit-btn").click(),e('li[sound_id="upload_'+y+'"]').addClass("is-error").find(".tips").css("display","block").text(s)),a=="dirty_words"&&(g=e("[name="+y+"]"),on.setError(g.parent(),b)),a=="files_dirty_words"&&(g=e("input[value="+y+"]"),on.setError(g.closest("li").find(".albumList_r1"),b),y=="title"?s="节目标题"+s:y=="intro"&&(s="节目简介"+s)),e("#btn_validcode").click()}}}else s+=l}n.html(s).css({color:"red"})}function Bt(t,n){clearInterval(Rt);if(Ht)return!1;var r=e(t);j.addClass("load").text("保存中"),Ht=!0;var i=r.parents("form"),s=i.serialize(),o=i.attr("action")||"/upload2/create",u="POST";N.html("正在保存中").css({color:"#000000"}),e.ajax({url:o,type:u,data:s,timeout:18e5,dataType:"json",success:function(t){clearInterval(Rt),Ht=!1;var n=e('input[name="isVideo"]').length&&e('input[name="isVideo"]').val()=="true";t.res?(window.location.href=config.STUDIO_ROOT+"myVoice",r.unbind("click")):(Pt(t.errors,N),zt(!0),j.removeClass("load").text("保存"),Ht=!1)},error:function(){clearInterval(Rt),zt(),Ht=!1,N.css({color:"red"}).html("服务器未知错误"),j.removeClass("load").text("保存")}})}function Ut(t,n){zt(),j.addClass("load").text("保存中"),Ft.show(),It.animate({height:0},200,function(){It.css({visibility:"hidden"}),e(".ke-edit").hide()}),t()?n():Rt=setInterval(function(){t()&&(n(),clearInterval(Rt))},3e3)}function zt(t){Rt&&(window.console&&console.log("clearInterval information 1110"),clearInterval(Rt)),t&&(Ft.hide(),It.animate({height:It.find("table").height()},200,function(){It.css({visibility:"visible",height:"auto"}),e(".ke-edit").show()})),j.removeClass("load").text("保存")}function Wt(){N.css({color:"#000000"}),N.html("上传完成后会自动提交噢")}function Xt(){var t=e("#timing_publish"),n=t.find("input[name=date]"),r=t.find(".calendarBtn"),i=t.find("input[name=is_publish]"),s=e("#publish_date"),o=s.find("input[name=hour]").closest(".selecter"),u=s.find("input[name=minutes]").closest(".selecter"),a=e("#appendToActivity");if(t.size()==0)return;r.on("click",function(){n.click()}),i.on("click",function(){l()});var f=e(".timingPublish .tips").text(),l=function(){i[0].checked?(s.removeClass("disabled"),o.removeClass("disabled"),u.removeClass("disabled"),a.hide(),e("#publish_date").removeClass("hidden"),e("input[name='is_publish']").attr("value","on")):(on.setRight(t,f),s.addClass("disabled"),o.addClass("disabled"),u.addClass("disabled"),a.show(),e("#publish_date").addClass("hidden"),e("input[name='is_publish']").removeAttr("value"))};l();var c=function(e){return e<10?"0"+e:e},h=new Date,p=h.getFullYear(),d=h.getMonth()+1,v=h.getDate(),m=h.getHours(),g=h.getMinutes();n.val(p+"-"+c(d)+"-"+c(v)),o.selecter("val",m),u.selecter("val",g);var y=30;n.DatePicker({date:h,current:h,starts:1,position:"bottom",onBeforeShow:function(){if(s.hasClass("disabled"))return!1;n.DatePickerSetDate(n.val()||h,!0)},onChange:function(e,t){n.val(e);var r=new Date;r.addDays(y)},onRender:function(e){var t=new Date;t.addDays(y);var n=new Date;return n.addDays(-1),{disabled:e.valueOf()<n.valueOf()||e.valueOf()>t.valueOf()}}})}function Qt(){var t=config.STATIC_ROOT+"/js/plugin/kindeditor/",n=config.STATIC_ROOT+"/css/plugin/kindeditor/themes/",r=["customformat","b","customstrong","customimage","tag","blockquote","hr","customlink"];if(!C){var i=r.indexOf("customlink");i!==-1&&r.splice(i,1)}var s=2;Vt&&Vt.remove(),$t&&$t.remove(),Jt=Gt("sound_lyric",t,n,function(){tn("sound_lyric",Jt),ot.sound_lyric()}),Kt=Gt("sound_music_lyric",t,n,function(){tn("sound_music_lyric",Kt),ot.sound_music_lyric()});var o=function(t){if(Vt){Vt.sync();var n=Vt.text();t?e(".placeholder").addClass("hidden"):!t&&n===""&&e(".placeholder").removeClass("hidden")}};$t=Yt("sound_rich_intro",t,n,r,{onblur:function(){en("sound_intro","sound_rich_intro",$t),V.trigger("check_intro_standard"),ot.sound_intro()},onChanges:function(){var t=this.html();e('textarea[name="sound_rich_intro"]').text(t)}})}function Gt(t,n,r,i){return KindEditor.create('textarea[name="'+t+'"]',{basePath:n,themesPath:r,items:[],width:"auto",newlineTag:"p",height:600,pasteType:1,themeType:"noheader",afterBlur:function(){this.sync(),i()},afterFocus:function(){on.setRight(e('textarea[name="'+t+'"]').parent())}})}function Yt(e,t,n,i,s){return KindEditor.create('textarea[name="'+e+'"]',{basePath:t,themesPath:n,resizeType:1,themeType:"simple",pasteType:2,width:"auto",height:350,newlineTag:"p",allowPreviewEmoticons:!1,fontSizeTable:["12px","14px","16px","18px","24px"],uploadJson:"/dtres/picture/upload/crossdomain",cssData:"body {margin : 25px 25px 25px 25px;font-size:16px;color:#333;} img[data-key],img[data-origin] {width:100%;margin-top:10px;margin-bottom:10px;} ",fillDescAfterUploadImage:!0,imageData:{},uploadImageBefore:function(e){return this.focus(),Zt(e)?!0:(r.alert("请上传正确的图片"),this.hideDialog(),!1)},uploadImageSuccess:function(e){var t={};if(e.status){var n=e.data[0].processResult,r=/gif$/.test(n.origin);r||(h=/test\./.test(window.location.href)?"http://fdfs.test.ximalaya.com":"http://image.xmcdn.com");var i=n.id,s=h+"/"+n.origin,o=n.origin_width,u=n.origin_height;this.imageData[s]=i;if(!C&&r)return t.msg="目前不支持gif格式的图片哦～",t.ret=-1,t;if(r&&(o!=375||u>667))return t.msg="请上传宽度为375px，高度≤667px的gif",t.ret=-1,t;var a=s+(r?"":"?op_type=4&device_type=ios&upload_type=attachment&name=mobile_large"),f=s+(r?"":"?op_type=4&device_type=ios&upload_type=attachment&name=mobile_small"),l=r?o:750,c=parseInt(parseInt(u)/parseInt(o)*l),p=r?o:140,d=parseInt(parseInt(u)/parseInt(o)*p),v=[];v.push({name:"data-origin",value:s+"?op_type=0"}),v.push({name:"data-large",value:a}),v.push({name:"data-large-width",value:l}),v.push({name:"data-large-height",value:c}),v.push({name:"data-preview",value:f}),v.push({name:"data-preview-width",value:p}),v.push({name:"data-preview-height",value:d}),url=a,t={error:0,url:url,attr:v}}else t=e,t.error=e.ret;return t},uploadImageError:function(e){this.hideDialog(),r.alert(e.msg)},afterFocus:function(){on.setRight(I.parent()),s.onfocus&&s.onfocus()},afterBlur:function(){this.sync(),s.onblur();var e=this.html(),t=this.text()},afterChange:function(){s.onChanges&&s.onChanges.call(this)},allowImageUpload:!0,items:i,htmlTags:{span:["style","data-flag"],div:[],p:["style","data-flag","lang"],blockquote:["style"],strong:["style"],hr:["style"],a:["href","target","title","alt",".text-decoration"],img:["src","alt","title","align","data-origin","data-large","data-large-width","data-large-height","data-preview","data-preview-height","data-preview-width","data-key"],"li,br":[],"br,tbody,tr,b,sub,sup,em,i,u,strike,s,del":[],"h1,h2,h3,h4,h5,h6":[]}})}function Zt(t){var n=["gif","jpg","jpeg","png","bmp"],r=t,i=r.split(/\//);e.inArray("jpg",n)&&!e.inArray("jpeg",n)&&n.push("jpeg"),e.inArray("jpeg",n)&&!e.inArray("jpg",n)&&n.push("jpg");var s=n.join("|").toLowerCase(),o=new RegExp(""+s+"$");return o.test(r.toLowerCase())}function en(t,n,r){if(r){r.sync();var i=r.html(),s=i.replace(/<(?!br|img)[^>]+>/g,"");s=s.replace(/([ \f\r\t\v])/g,"&nbsp;"),s=s.replace(/(&nbsp;)+/ig," "),s=s.replace(/^<br[^>]+>$/,""),s=s.replace(/(<[^>]+>)+/g," "),s=s.replace(/^\s+$/g,""),s=="<br>"&&(s=""),e("[name="+t+"]").val(s);var o=e("[name="+t+"_images]"),u=[];for(var a in r.imageData)s.indexOf(a)!=-1&&u.push(r.imageData[a]);o.val(u.join(","))}else e("[name="+t+"]").val(e("[name="+n+"]").val())}function tn(t,n){n&&(n.sync(),e("[name="+t+"]").each(function(){var t=e(this),n=t.val(),r=n.replace(/<(?!br)[^>]+>/g,"");r=r.replace(/(\n|\s)/g,"&nbsp;"),r=r.replace(/(&nbsp;)+/ig," "),r=r.replace(/^\s+$/g,""),r=="<br>"&&(r=""),t.val(r)}))}function nn(){en("sound_intro","sound_rich_intro",$t),tn("sound_lyric",Jt),tn("sound_music_lyric",Kt)}function rn(){return xt}function sn(){if(Vt){Vt.sync();var t=Vt.text(),n=parseInt(e(".js-intro-min-size-tips").attr("data-limit"))||100,r=t.length,i=n-r;i>0?(e(".js-intro-min-size-tips").html('加油，还差<span class="c04">'+i+"</span>个字！"),e('input[name="intro"]').parent().addClass("is-error")):r>3e3?(e(".js-intro-min-size-tips").html("专辑简介不能超过3000字"),e('input[name="intro"]').parent().addClass("is-error")):(e(".js-intro-min-size-tips").html("棒棒哒！精彩的介绍会吸引更多听众哟~"),e('input[name="intro"]').parent().removeClass("is-error")),r===0&&e('input[name="intro"]').parent().removeClass("is-error")}}var h=config.FDFS_PATH||"http://fdfs.x.com/",p=config.DIRECT_DTRES_ROOT+"/cover/upload",d=config.DIRECT_DTRES_ROOT+"/album/upload",v=config.STATIC_ROOT+"/css/img/record/image.gif",m="/handle_album/recommend_tags",g="/s/search/tag_suggest",y=15e6,b=40,w=!0,E=!1,S=!1,x=null,T,N,C,N,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,nt=n.extend({init:function(t){St=null,xt=null,st(),T=T||t.pageConfig,this.callParent("init"),this._isAlbum=t.album||!1,this.numFilesSelected=t.numFilesSelected,E=t.is_sound_edit||!1,S=t.is_info||!1,x=t.captcha||null,this.validCodeTemplate=t.validTemp||null,this.allowEditorLink=t.allowEditorLink,C=t.allowEditorLink,this._isAlbum&&e("#shareSound [data-type]").attr("data-type","album"),this.initValidCode(),this.initAlbum(),ut(),e("#sound_imageWrap_for_edit").size()?Tt(e("#sound_imageWrap_for_edit"),e("#uploadPicBtn_for_edit")):Et();if(current_user&&current_user.isVerified){Dt();if(e("#shareSound").size()){var n=e("#shareSound .shareWeixin"),r=e("#shareSound [name=share_to_weixin]");this.storageWeixinSelected()?(n.addClass("selected"),r.val("on")):(n.removeClass("selected"),r.val(""))}}else e("#user_share").remove(),e("#timing_publish").remove();At.addTagEvent(),Ot=new Lt(e(".sound_tags_selecter")),Ot.addTagEvent(),t.timingPublish?Xt():e("#timing_publish").remove(),this.bindEvents(),t.isCheck&&(ot.is_addto_selected=!1)},initAlbum:function(){it(this._isAlbum,!0)},initValidCode:function(){var t=e("#tr_validcode"),n=e("#btn_validcode"),r=e("#img_validcode");x&&x.display?(t.find('input[name="codeid"]').val(x.codeid),t.find("img#img_validcode").attr("src",x.cover_path)):!this.validCodeTemplate&&t.remove();if(t.size()==0)return;var i=r.attr("src");n.on("click",function(){r.attr("src",i+"&_t"+(new Date).getTime())})},removeValidCdoe:function(){var t=e("#tr_validcode");t.remove()},resetValidCode:function(){var t=this,n=e("#tr_validcode");if(n.size()!=0){var r=e("#btn_validcode");r.trigger("click");return}this.getValidCodeHtml(function(n){var r=t.validCodeTemplate||'<div class="row" id="tr_validcode"> <div class="cell-1">    验证码<span class="c04">*</span> </div> <div class="cell-2">    <input type="text" name="validcode">   <input type="hidden" name="codeid" value="${codeid}">   <img id="img_validcode" class="mglr-10" src="${img_src}" style="width:97px;height:35px; ">   <a href="javascript:;" id="btn_validcode">看不清，换一张</a> </div></div>';r=r.replace(/\$\{([^}]*)\}/,function(e,t){for(var r in n)if(r==t)return n[r]}),e("#infoErr").before(r),x={display:!0,codeid:n.codeid,cover_path:n.img_src},t.initValidCode()})},getValidCodeHtml:function(t){e.get("/upload/valid_code_json",function(e){t(e)})},bindEvents:function(){var t=this,n=e("#appendToActivity"),i=n.find(".selecter"),s=n.find("[data-activity-url]"),o=e("#timing_publish");i.size()&&i.bind("change",function(){var t=i.selecter("val");if(!t){s.hide(),o.show();return}var n=s.attr("data-activity-url").replace(/\%activity_id\%/g,t);o.hide(),s.show(),s.attr("href",n),e.ajax({url:"/upload/activity_confirm_info",data:{activity_id:t},success:function(t){var n=t.activity_info,s=n.book_time.replace(/\s.+/,"").replace(/\-/g,"/")+"-"+n.end_time.replace(/\s.+/,"").replace(/\-/g,"/"),o=['<div class="activity_confirm_wrapper">','<div class="activity_confirm_title">'+n.name+"</div>",'<div class="activity_confirm_time">',"活动时间："+s,"</div>",'<div class="activity_confirm_banner">','<img src="'+n.picture+'">',"</div>",'<div class="activity_confirm_h">',"活动规则","</div>",'<div class="activity_confirm_detail">',n.detail,"</div>",'<div class="activity_confirm_warning">',"参与活动需要进行审核，请耐心等待审核","</div>","<div>",'<input name="activity_confirm_checkbox" type="checkbox" id="activity_confirm_checkbox" value="ASP"><label for="activity_confirm_checkbox">确认上传声音满足活动条件</label>',"</div>",'<div class="operate">','<a href="javascript:;" class="confirmBtn disabled" >确认</a>','<a href="javascript:;" class="removeBtn" dialog-role="cancel">取消</a>',"</div>","</div>"].join(""),u=new r.Dialog({content:o,dialogClass:"activity_confirm",width:402,fixed:!1,overlayer:{clickClose:!1},template:{dialog_close:'<div class="close3Btn" dialog-role="cancel"></div>'},onCancel:function(){i.selecter("val","")}});u.open(),e("#activity_confirm_checkbox").off().on("change",function(){var t=e(this),n=u.getEl().find(".confirmBtn");t.is(":checked")?(n.removeClass("disabled"),n.attr("dialog-role","yes")):(n.addClass("disabled"),n.removeAttr("dialog-role"))})}})}),e("#shareSound .shareWeixin").on("click",function(){var n=e(this),r=e("#shareSound [name=share_to_weixin]");n.is(".selected")?(n.removeClass("selected"),r.val(""),t.storageWeixinSelected(!1)):(n.addClass("selected"),r.val("on"),t.storageWeixinSelected(!0))})},storageWeixinSelected:function(e){if(e===undefined)return tt()?localStorage.weixinSelected===undefined||localStorage.weixinSelected==="true"?!0:!1:!0;tt()&&(localStorage.weixinSelected=e)},setError:function(t,n,r){if(!t||!t.size()){N.html(n);return}r||setTimeout(function(){helper.scrollTo(t,-100)},250);if(n){var i=t.find("span.tips").length?t.find("span.tips"):t.find("p.tips");i.size()==0&&(i=e('<span class="tips"></span>'),t.append(i)),t.addClass("is-error"),i.html(n)}},setRight:function(e,t){var n=e.find("span.tips").length?e.find("span.tips"):e.find("p.tips");if(n.hasClass("js-intro-min-size-tips"))return!1;e.removeClass("is-error");var r=n.attr("data-def");t=t||r,n.html(t||"")},release:function(){e("#record_info .pauseBtn").each(function(){e(this).click()}),e("#shareSound .shareWeixin").off(),e(".drag-icon").remove(),this.callParent("release")}}),rt=!1,ot={titleSuccess:!1,originSuccess:!1,genreSuccess:!1,soundNoCheck:!1,soundTitleSuccess:!1,soundOriginSuccess:!1,soundGenreSuccess:!1,is_addto_selected:!0,title:function(e,t,n,r){if(e.attr("is-lock")=="true")return!1;if(e.length===0)return!0;var i=e.parent();if(e.length<=0)return!0;var s=e.val();return s?(on.setRight(i,r),i.removeClass("is-error"),Ct(s,b*2)?!0:(n="标题太长，必须小于"+b+"个汉字或者"+b*2+"个字母",on.setError(i,n,!t),!1)):(on.setError(i,n,!t),!1)},album_title:function(e){if(this.is_addto_selected)return this.titleSuccess=!0,!0;e=e||!1,this.titleSuccess=!1;var t="好的专辑标题至关重要，要用简短文字概括出最有吸引力的卖点哦~例如：青雪讲故事（结合人名）；科技相对论（结合行业）";return this.titleSuccess=this.title(k,e,"请为专辑加上标题",t),this.titleSuccess},sound_title:function(e){return this.soundNoCheck?(this.soundTitleSuccess=!0,!0):(e=e||!1,this.soundTitleSuccess=!1,this.soundTitleSuccess=this.title(q,e,"请为节目加上标题"),this.soundTitleSuccess)},origin:function(e,t,n){if(e.length===0)return!0;var r=e.parent(),i=e.selecter("val")||e.val();return i?(on.setRight(r,"该信息必填"),!0):(on.setError(r,n,!t),!1)},album_origin:function(e){return this.is_addto_selected?(this.originSuccess=!0,!0):(e=e||!1,this.originSuccess=!1,this.originSuccess=this.origin(L,e,"请为专辑标注来源"),this.originSuccess)},sound_origin:function(e){return this.soundNoCheck?(this.soundOriginSuccess=!0,!0):(e=e||!1,this.soundOriginSuccess=!1,this.soundOriginSuccess=this.origin(R,e,"请为节目标注来源"),this.soundOriginSuccess)},genre:function(e,t,n,r){if(e.length===0)return!0;var i=e.parent(),s=e.selecter("val")||e.val(),o=e.selecter("text"),u=t.selecter("val")||t.val();return!s||o=="音乐"&&!u&&!rt?(on.setError(i,r,!n),!1):(on.setRight(i,"该信息必填"),!0)},album_genre:function(e){return this.is_addto_selected?(this.genreSuccess=!0,!0):(e=e||!1,this.genreSuccess=!1,this.genreSuccess=this.genre(A,O,e,"请为专辑加上类型"),this.genreSuccess)},sound_genre:function(e){return this.soundNoCheck?(this.soundGenreSuccess=!0,!0):(e=e||!1,this.soundGenreSuccess=!1,this.soundGenreSuccess=this.genre(U,z,e,"请为节目加上类型"),this.soundGenreSuccess)},album_intro:function(e){var t=X.parent(),n=W.val();return n&&n.length>3e3?(on.setError(t,"专辑简介不能超过3000字",!e),!1):(on.setRight(t),t.removeClass("is-error"),!0)},sound_intro:function(e){if(V.attr("is-lock")=="true")return!1;var t=$.parent(),n=V.val();return n&&n.length>y?(on.setError(t,"节目简介不能超过"+y+"字",!e),!1):(on.setRight(t),t.removeClass("is-error"),!0)},sound_lyric:function(e){var t=J.parent(),n=J.val();return J.is(":hidden")?!0:n&&n.length>5e3?(on.setError(t,"文案不能超过5000字",!e),!1):(on.setRight(t),t.removeClass("is-error"),!0)},sound_music_lyric:function(e){var t=K.parent(),n=K.val();return K.is(":hidden")?!0:n&&n.length>5e3?(on.setError(t,"歌词不能超过5000字",!e),!1):(on.setRight(t),t.removeClass("is-error"),!0)}},gt,yt,bt,wt,St,xt;Nt.html='<div class="imgBox"><a class="del"></a><div class="imgItem"><img src=""><input type="hidden" name="sound_image[]" /><div class="imgLoading"></div></div><div class="setfenmian">设为封面</div><div class="isfenmian"></div></div>',Nt.prototype.init=function(){var e=this.$container.parent();this.isSingle?this.setCover(this.$imgBox2):(this.$imgBox2.find("input").remove(),this.alreadyBoxSize()&&this.$imgBox2.hide()),this.bindEvents()},Nt.prototype.alreadyBoxSize=function(){return this.$soundImgBox.find(".imgBox:not(.def)").size()},Nt.prototype.bindEvents=function(){if(this.isSingle)return;var t=this,n=!1;this.$destroyImg.size()>0&&(n=!0),this.$soundImgBox.on("click",".imgBox .del",function(){var r=e(this),i=r.closest(".imgBox"),s=i.attr("image_id");if(i.hasClass("image_inherit"))t.uploadImg.increaseUploadLimit();else{var o=i.attr("id")&&i.attr("id").replace("sound","");t.uploadImg.increaseUploadLimit(o)}return i.remove(),t.uploadImg.setButtonDisabled(!1),t.onBoxRemove(),s&&n&&t.destroyImage(s),!1}),this.$soundImgBox.on("click",".imgBox",function(){var n=e(this),r=n.index();if(r==0)return;var i=t.$soundImgBox.find(".imgBox").eq(0);i.removeClass("is-fenmian"),t.setCover(n),i.insertBefore(n),n.index()!=0&&n.insertBefore(t.$soundImgBox.find(".imgBox").eq(0))})},Nt.prototype.destroyImage=function(e){var t=this.$destroyImg,n=t.val();n?n+=","+e:n=e,t.val(n)},Nt.prototype.addImg=function(t){if(this.isSingle){this.$imgBox2.addClass("is-loading");return}this.$imgBox2.hide(),e(".image_inherit").hasClass("def")&&e(".image_inherit").remove();var n=e(Nt.html).addClass("is-loading").attr("id",this.key+t.id);this.$soundImgBox.append(n),n.index()==0&&this.setCover(n),this.$soundImgBox.find(".imgBox").size()>=this.imgLimit&&this.uploadImg.setButtonDisabled(!0)},Nt.prototype.setCover=function(e){e.addClass("is-fenmian")},Nt.prototype.setError=function(t,n){this.$upload_img.attr("src",v),this.isSingle?this.$imgBox2.removeClass("is-loading"):e("#"+this.key+n.id).removeClass("is-loading")},Nt.prototype.fillImg=function(t,n,r){var i=t.data[0].processResult,s=h+"/"+i[100],o=e("#"+this.key+n.id);this.isSingle&&(o=this.$imgBox2),o.attr("src",s),o.find("img").attr("src",s);var u=this.getPostData(t);o.find("input").val(u),o.removeClass("is-loading"),(this.isSingle||o.index()==0)&&this.setCover(o)},Nt.prototype.fillExistImg=function(t){this.$imgBox2.hide();var n=e(Nt.html).addClass("is-loading").attr("id",this.key+"ExistImg");this.$soundImgBox.append(n),n.index()==0&&this.setCover(n),this.$soundImgBox.find(".imgBox").size()>=this.imgLimit&&this.uploadImg.setButtonDisabled(!0),n.find("img").attr("src",t);var r=n.find("input");r.val("image_inherit"),n.removeClass("is-loading")},Nt.prototype.getPostData=function(e){var n={};return n.status=e.status,n.data=[{processResult:e.data[0].processResult,uploadTrack:e.data[0].uploadTrack}],t.stringify(n)},Nt.prototype.onBoxRemove=function(){var e=this.$soundImgBox.find(".imgBox");if(e.size()==0)this.$imgBox2.show();else{var t=e.eq(0);t.addClass("is-fenmian")}},Lt.prototype.addTagEvent=function(){var t=this,n=this.$inputAreaTag,r=this.$input_editor_area,i={enter:13,space:32,backspace:8},s={url:g,$el:this.$inputArea,$listResult:this.$results_wrap,resultKeyCode:[i.space],maxKeywords:16,isHistory:!1,createResultHtml:function(e,t){var n="<ul class='results'>";n+='<li  data-title="'+e.key+'"><div class="searchPanel_sound"> '+'<a class="title" href="javascript:;" title="'+e.key+'">添加"'+e.key+'"的标签</a>'+"</div></li>";for(var r=0;r<e.list.length;r++){var i=e.list[r];n+='<li data-id="'+i.id+'" data-title="'+i.title+'"><div class="searchPanel_sound"> '+'<a class="title" href="javascript:;" title="'+i.title+'">'+i.text+"</a>"+"</div></li>"}return n+="</ul>",n},callback:function(e){t.addTag(e.title)}};a(s),this.$inputArea.bind({click:function(){r.focus()}}),this.$inputAreaTag.off().on({click:function(){var n=e(this).parent();return n.fadeOut(200,function(){n.remove(),t.changeArea(),r.focus()}),!1}},".tagBtn .del"),this.$input_editor_area.bind({keypress:function(n){var s=r.val();s=e.trim(s);var o=n.keyCode;if(o==i.enter)return t.addTag(s),!1},keydown:function(e){var s=r.val(),o=e.keyCode;if(o==i.backspace&&s=="")return n.children().last().remove(),t.changeArea(),!1;if(o==i.space)return t.addTag(s),!1}}),this.$tagPanelCss.on("click",".tagBtn2",function(n){var r=e(this);t.addTag(r.text())})},Lt.prototype.addTag=function(t){var n=this.$inputAreaTag,i=this.$input_editor_area;t=e.trim(t).replace(/\s+/,"");var s=function(e){i.blur(),r&&r.alert(e,{onClose:function(){i.focus()}})},o=/[\~\`\!\@\#\$\%\^\&\*\(\)\-\=\+\\\|\'\"\;\:\.\>\,\<\/\?\~\·\！\@\#\￥\%\…\…\&\*\（\）\—\—\-\+\=\|\\\}\]\{\[\"\'\:\;\?\/\>\.\<\，]/;if(o.test(t)){s("不能包含特殊字符");return}if(!Ct(t,16)){s("内容超出范围");return}if(t=="")return!1;var u=n.children().size();if(u>=5)return s("最多只能选择5个标签"),i.val(""),!1;var a=!1;n.find(".tagBtn span").each(function(){if(e(this).text()==t)return a=!0,!1});if(a)return i.val(""),!1;var f='<a class="tagBtn" href="javascript:;"><span>'+t+'</span><div class="del"></div></a>';return n.append(f),i.val(""),this.changeArea(),!0},Lt.prototype.changeArea=function(){var t=[],n=this.$inputAreaTag.find(".tagBtn span");n.each(function(){t.push(e(this).text())}),this.$chosen_area.val(t.join(","))},Lt.prototype.recommend_tags=function(t){var n=this;e.ajax({type:"POST",url:m,dataType:"html",data:{category_id:t},success:function(e){n.$tagPanel.html(e)}})};var At=new Lt(e(".tags-selecter").eq(0)),Ot=new Lt(e(".tags-selecter").eq(1));!e(".tags-selecter").eq(1).length&&(Ot=new Lt(e(".sound_tags_selecter")));var _t,Ht=!1,jt=e("#info_table_warp"),Ft=e("#info_table_show"),It=jt.find(".tbInfo"),qt=0;Ft.click(function(){zt(!0),N.html("")});var Rt,Vt,$t,Jt,Kt,on=new nt;return on.check=kt,on.setIsAlbum=it,on.parseSubmitError=Pt,on.submitForm=Bt,on.holdSubmit=Ut,on.unHoldSubmit=zt,on.setHoldTip=Wt,on.setBindShare=Dt,on.checkInfo=ot,on.Tags_selecter=Lt,on.setKindEditor=Qt,on.getSoundImage=rn,on.flushSizeLimit=sn,on.checkMaxLength=Ct,on.rich_editor_intro=Vt,on}),define("module/dialogs/soundpreview",["jquery","plugin/dialog","plugin/perfect-scrollbar/perfect-scrollbar.jquery"],function(e,t){var n={pop:function(e,n,r,i,s){var o=this._template(e,n,r,i,s),u={template:{dialog_close:"",dialog_header:"",dialog_body:'<div class="bd " dialog-role="body"></div>'},dialogClass:"pop-sound-preview "+(s==="video"?"preview-video":""),header:"",fixed:!1,content:o,noheadDrop:!0,overlayer:{clickClose:!1}},a=new t.Dialog(u);this._pop=a,a.open();var f=a.getEl();f.find(".sound-content").perfectScrollbar({suppressScrollX:!0})},_template:function(e,t,n,r,i){r=r.replace(/href="[^"]*"/g,'href="javascript:;"');var t=t.replace("_web_meduim","_mobile_large"),s="";t.indexOf(config.STATIC_PATH)==-1&&(s='<div class="sound-face"> <img src="'+t+'" alt=""> </div>');var o=!1;r=r.replace(/img/g,'img style="width:100%;"'),r=r.replace(/<href="([^"]*)"/g,'href="javascript:;"');if(i==="video")return this._templateVideo(e,t,n,r);var u='<div class="sound-preview-close"> <a href="javascript:;" dialog-role="close"> <i></i> <span>关闭预览</span></a> </div>  <div class="sound-preview-phone">  	<div class="sound-content"  id="js-sound-preview-content">		<div class="sound-cover" style="width:261px;">  			<div class="sound-title">'+e+"</div>"+'      		<div class="album-cover"> </div>'+'      		<div class="album-title">'+n+"</div>"+'			<img src="'+config.STATIC_PATH+'/css/img/soundpreview/img_content.png" alt="">'+s+"		</div>"+'      	<div class="sound-intro">'+r+"</div>  "+"   </div>"+"  </div>";return u},_templateVideo:function(e,t,n,r){var i='<div class="sound-preview-close"> <a href="javascript:;" dialog-role="close"> <i></i> <span>关闭预览</span></a> </div>  <div class="sound-preview-phone">  	<div class="sound-content"  id="js-sound-preview-content">			<div class="sound-cover" style="width:261px;">				<img src="'+config.STATIC_PATH+'/css/img/soundpreview/img_content_video.png" alt="">'+"			</div>"+'			<div class="sound-title2">'+e+"</div>"+'			<div class="sound-desc">2017-11-16发布 | 3.5万次播放</div>'+'   	<div class="sound-intro">'+r+"</div>  "+"   </div>"+"  </div>";return i}};return n}),function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define("cropper",t):e.Cropper=t()}(this,function(){function Q(e){return typeof e=="number"&&!K(e)}function G(e){return typeof e=="undefined"}function Y(e){return(typeof e=="undefined"?"undefined":X(e))==="object"&&e!==null}function et(e){if(!Y(e))return!1;try{var t=e.constructor,n=t.prototype;return t&&n&&Z.call(n,"isPrototypeOf")}catch(r){return!1}}function tt(e){return typeof e=="function"}function nt(e,t){if(e&&tt(t))if(Array.isArray(e)||Q(e.length)){var n=e.length,r=void 0;for(r=0;r<n;r+=1)if(t.call(e,e[r],r,e)===!1)break}else Y(e)&&Object.keys(e).forEach(function(n){t.call(e,e[n],n,e)});return e}function st(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e11;return it.test(e)?Math.round(e*t)/t:e}function ut(e,t){var n=e.style;nt(t,function(e,t){ot.test(t)&&Q(e)&&(e+="px"),n[t]=e})}function at(e,t){return e.classList?e.classList.contains(t):e.className.indexOf(t)>-1}function ft(e,t){if(!t)return;if(Q(e.length)){nt(e,function(e){ft(e,t)});return}if(e.classList){e.classList.add(t);return}var n=e.className.trim();n?n.indexOf(t)<0&&(e.className=n+" "+t):e.className=t}function lt(e,t){if(!t)return;if(Q(e.length)){nt(e,function(e){lt(e,t)});return}if(e.classList){e.classList.remove(t);return}e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,""))}function ct(e,t,n){if(!t)return;if(Q(e.length)){nt(e,function(e){ct(e,t,n)});return}n?ft(e,t):lt(e,t)}function pt(e){return e.replace(ht,"$1-$2").toLowerCase()}function dt(e,t){return Y(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-"+pt(t))}function vt(e,t,n){Y(n)?e[t]=n:e.dataset?e.dataset[t]=n:e.setAttribute("data-"+pt(t),n)}function mt(e,t){if(Y(e[t]))try{delete e[t]}catch(n){e[t]=undefined}else if(e.dataset)try{delete e.dataset[t]}catch(n){e.dataset[t]=undefined}else e.removeAttribute("data-"+pt(t))}function bt(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},i=n;t.trim().split(gt).forEach(function(t){if(!yt){var s=e.listeners;s&&s[t]&&s[t][n]&&(i=s[t][n],delete s[t][n],Object.keys(s[t]).length===0&&delete s[t],Object.keys(s).length===0&&delete e.listeners)}e.removeEventListener(t,i,r)})}function wt(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},i=n;t.trim().split(gt).forEach(function(t){if(r.once&&!yt){var s=e.listeners,o=s===undefined?{}:s;i=function(){for(var u=arguments.length,a=Array(u),f=0;f<u;f++)a[f]=arguments[f];delete o[t][n],e.removeEventListener(t,i,r),n.apply(e,a)},o[t]||(o[t]={}),o[t][n]&&e.removeEventListener(t,o[t][n],r),o[t][n]=i,e.listeners=o}e.addEventListener(t,i,r)})}function Et(e,t,n){var r=void 0;return tt(Event)&&tt(CustomEvent)?r=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0}):(r=document.createEvent("CustomEvent"),r.initCustomEvent(t,!0,!0,n)),e.dispatchEvent(r)}function St(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}function Nt(e){var t=e.match(Tt);return t&&(t[1]!==xt.protocol||t[2]!==xt.hostname||t[3]!==xt.port)}function Ct(e){var t="timestamp="+(new Date).getTime();return e+(e.indexOf("?")===-1?"?":"&")+t}function kt(e){var t=e.rotate,n=e.scaleX,r=e.scaleY,i=e.translateX,s=e.translateY,o=[];Q(i)&&i!==0&&o.push("translateX("+i+"px)"),Q(s)&&s!==0&&o.push("translateY("+s+"px)"),Q(t)&&t!==0&&o.push("rotate("+t+"deg)"),Q(n)&&n!==1&&o.push("scaleX("+n+")"),Q(r)&&r!==1&&o.push("scaleY("+r+")");var u=o.length?o.join(" "):"none";return{WebkitTransform:u,msTransform:u,transform:u}}function Lt(e){var t=rt({},e),n=[];return nt(e,function(e,r){delete t[r],nt(t,function(t){var r=Math.abs(e.startX-t.startX),i=Math.abs(e.startY-t.startY),s=Math.abs(e.endX-t.endX),o=Math.abs(e.endY-t.endY),u=Math.sqrt(r*r+i*i),a=Math.sqrt(s*s+o*o),f=(a-u)/u;n.push(f)})}),n.sort(function(e,t){return Math.abs(e)<Math.abs(t)}),n[0]}function At(e,t){var n=e.pageX,r=e.pageY,i={endX:n,endY:r};return t?i:rt({startX:n,startY:r},i)}function Ot(e){var t=0,n=0,r=0;return nt(e,function(e){var i=e.startX,s=e.startY;t+=i,n+=s,r+=1}),t/=r,n/=r,{pageX:t,pageY:n}}function _t(e){var t=e.aspectRatio,n=e.height,r=e.width,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"contain",s=function(t){return Mt(t)&&t>0};if(s(r)&&s(n)){var o=n*t;i==="contain"&&o>r||i==="cover"&&o<r?n=r/t:r=n*t}else s(r)?n=r/t:s(n)&&(r=n*t);return{width:r,height:n}}function Dt(e){var t=e.width,n=e.height,r=e.degree;r=Math.abs(r)%180;if(r===90)return{width:n,height:t};var i=r%90*Math.PI/180,s=Math.sin(i),o=Math.cos(i),u=t*o+n*s,a=t*s+n*o;return r>90?{width:a,height:u}:{width:u,height:a}}function Pt(e,t,n,r){var i=t.aspectRatio,s=t.naturalWidth,o=t.naturalHeight,u=t.rotate,a=u===undefined?0:u,f=t.scaleX,l=f===undefined?1:f,c=t.scaleY,h=c===undefined?1:c,p=n.aspectRatio,d=n.naturalWidth,v=n.naturalHeight,m=r.fillColor,g=m===undefined?"transparent":m,y=r.imageSmoothingEnabled,b=y===undefined?!0:y,w=r.imageSmoothingQuality,E=w===undefined?"low":w,S=r.maxWidth,x=S===undefined?Infinity:S,T=r.maxHeight,N=T===undefined?Infinity:T,C=r.minWidth,k=C===undefined?0:C,L=r.minHeight,A=L===undefined?0:L,O=document.createElement("canvas"),M=O.getContext("2d"),_=_t({aspectRatio:p,width:x,height:N}),D=_t({aspectRatio:p,width:k,height:A},"cover"),P=Math.min(_.width,Math.max(D.width,d)),H=Math.min(_.height,Math.max(D.height,v)),B=_t({aspectRatio:i,width:x,height:N}),j=_t({aspectRatio:i,width:k,height:A},"cover"),F=Math.min(B.width,Math.max(j.width,s)),I=Math.min(B.height,Math.max(j.height,o)),q=[-F/2,-I/2,F,I];return O.width=st(P),O.height=st(H),M.fillStyle=g,M.fillRect(0,0,P,H),M.save(),M.translate(P/2,H/2),M.rotate(a*Math.PI/180),M.scale(l,h),M.imageSmoothingEnabled=b,M.imageSmoothingQuality=E,M.drawImage.apply(M,[e].concat(J(q.map(function(e){return Math.floor(st(e))})))),M.restore(),O}function Bt(e,t,n){var r="",i=void 0;n+=t;for(i=t;i<n;i+=1)r+=Ht(e.getUint8(i));return r}function Ft(e){var t=e.replace(jt,""),n=atob(t),r=new ArrayBuffer(n.length),i=new Uint8Array(r);return nt(i,function(e,t){i[t]=n.charCodeAt(t)}),r}function It(e,t){var n=new Uint8Array(e),r="";return nt(n,function(e){r+=Ht(e)}),"data:"+t+";base64,"+btoa(r)}function qt(e){var t=new DataView(e),n=void 0,r=void 0,i=void 0,s=void 0;if(t.getUint8(0)===255&&t.getUint8(1)===216){var o=t.byteLength,u=2;while(u<o){if(t.getUint8(u)===255&&t.getUint8(u+1)===225){i=u;break}u+=1}}if(i){var a=i+4,f=i+10;if(Bt(t,a,4)==="Exif"){var l=t.getUint16(f);r=l===18761;if(r||l===19789)if(t.getUint16(f+2,r)===42){var c=t.getUint32(f+4,r);c>=8&&(s=f+c)}}}if(s){var h=t.getUint16(s,r),p=void 0,d=void 0;for(d=0;d<h;d+=1){p=s+d*12+2;if(t.getUint16(p,r)===274){p+=8,n=t.getUint16(p,r),t.setUint16(p,1,r);break}}}return n}function Rt(e){var t=0,n=1,r=1;switch(e){case 2:n=-1;break;case 3:t=-180;break;case 4:r=-1;break;case 5:t=90,r=-1;break;case 6:t=90;break;case 7:t=90,n=-1;break;case 8:t=-90;break;default:}return{rotate:t,scaleX:n,scaleY:r}}var e=typeof window!="undefined",t=e?window:{},n="cropper",r="all",i="crop",s="move",o="zoom",u="e",a="w",f="s",l="n",c="ne",h="nw",p="se",d="sw",v=n+"-crop",m=n+"-disabled",g=n+"-hidden",y=n+"-hide",b=n+"-invisible",w=n+"-modal",E=n+"-move",S=n+"Action",x=n+"Preview",T="crop",N="move",C="none",k="crop",L="cropend",A="cropmove",O="cropstart",M="dblclick",_=t.PointerEvent?"pointerdown":"touchstart mousedown",D=t.PointerEvent?"pointermove":"touchmove mousemove",P=t.PointerEvent?"pointerup pointercancel":"touchend touchcancel mouseup",H="ready",B="resize",j="wheel mousewheel DOMMouseScroll",F="zoom",I=/^(?:e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,q=/^data:/,R=/^data:image\/jpeg;base64,/,U=/^(?:img|canvas)$/i,z={viewMode:0,dragMode:T,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},W='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},$=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),J=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},K=Number.isNaN||t.isNaN,Z=Object.prototype.hasOwnProperty,rt=Object.assign||function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Y(t)&&r.length>0&&r.forEach(function(e){Y(e)&&Object.keys(e).forEach(function(n){t[n]=e[n]})}),t},it=/\.\d*(?:0|9){12}\d*$/i,ot=/^(?:width|height|left|top|marginLeft|marginTop)$/,ht=/([a-z\d])([A-Z])/g,gt=/\s\s*/,yt=function(){var n=!1;if(e){var r=!1,i=function(){},s=Object.defineProperty({},"once",{get:function(){return n=!0,r},set:function(t){r=t}});t.addEventListener("test",i,s),t.removeEventListener("test",i,s)}return n}(),xt=t.location,Tt=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,Mt=Number.isFinite||t.isFinite,Ht=String.fromCharCode,jt=/^data:.*,/,Ut={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,n=this.options,r=this.container,i=this.cropper;ft(i,g),lt(t,g);var s={width:Math.max(r.offsetWidth,Number(n.minContainerWidth)||200),height:Math.max(r.offsetHeight,Number(n.minContainerHeight)||100)};this.containerData=s,ut(i,{width:s.width,height:s.height}),ft(t,g),lt(i,g)},initCanvas:function(){var t=this.containerData,n=this.imageData,r=this.options.viewMode,i=Math.abs(n.rotate)%180===90,s=i?n.naturalHeight:n.naturalWidth,o=i?n.naturalWidth:n.naturalHeight,u=s/o,a=t.width,f=t.height;t.height*u>t.width?r===3?a=t.height*u:f=t.width/u:r===3?f=t.width/u:a=t.height*u;var l={aspectRatio:u,naturalWidth:s,naturalHeight:o,width:a,height:f};l.left=(t.width-a)/2,l.top=(t.height-f)/2,l.oldLeft=l.left,l.oldTop=l.top,this.canvasData=l,this.limited=r===1||r===2,this.limitCanvas(!0,!0),this.initialImageData=rt({},n),this.initialCanvasData=rt({},l)},limitCanvas:function(t,n){var r=this.options,i=this.containerData,s=this.canvasData,o=this.cropBoxData,u=r.viewMode,a=s.aspectRatio,f=this.cropped&&o;if(t){var l=Number(r.minCanvasWidth)||0,c=Number(r.minCanvasHeight)||0;u>1?(l=Math.max(l,i.width),c=Math.max(c,i.height),u===3&&(c*a>l?l=c*a:c=l/a)):u>0&&(l?l=Math.max(l,f?o.width:0):c?c=Math.max(c,f?o.height:0):f&&(l=o.width,c=o.height,c*a>l?l=c*a:c=l/a));var h=_t({aspectRatio:a,width:l,height:c});l=h.width,c=h.height,s.minWidth=l,s.minHeight=c,s.maxWidth=Infinity,s.maxHeight=Infinity}if(n)if(u){var p=i.width-s.width,d=i.height-s.height;s.minLeft=Math.min(0,p),s.minTop=Math.min(0,d),s.maxLeft=Math.max(0,p),s.maxTop=Math.max(0,d),f&&this.limited&&(s.minLeft=Math.min(o.left,o.left+(o.width-s.width)),s.minTop=Math.min(o.top,o.top+(o.height-s.height)),s.maxLeft=o.left,s.maxTop=o.top,u===2&&(s.width>=i.width&&(s.minLeft=Math.min(0,p),s.maxLeft=Math.max(0,p)),s.height>=i.height&&(s.minTop=Math.min(0,d),s.maxTop=Math.max(0,d))))}else s.minLeft=-s.width,s.minTop=-s.height,s.maxLeft=i.width,s.maxTop=i.height},renderCanvas:function(t,n){var r=this.canvasData,i=this.imageData;if(n){var s=Dt({width:i.naturalWidth*Math.abs(i.scaleX||1),height:i.naturalHeight*Math.abs(i.scaleY||1),degree:i.rotate||0}),o=s.width,u=s.height,a=r.width*(o/r.naturalWidth),f=r.height*(u/r.naturalHeight);r.left-=(a-r.width)/2,r.top-=(f-r.height)/2,r.width=a,r.height=f,r.aspectRatio=o/u,r.naturalWidth=o,r.naturalHeight=u,this.limitCanvas(!0,!1)}if(r.width>r.maxWidth||r.width<r.minWidth)r.left=r.oldLeft;if(r.height>r.maxHeight||r.height<r.minHeight)r.top=r.oldTop;r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),this.limitCanvas(!1,!0),r.left=Math.min(Math.max(r.left,r.minLeft),r.maxLeft),r.top=Math.min(Math.max(r.top,r.minTop),r.maxTop),r.oldLeft=r.left,r.oldTop=r.top,ut(this.canvas,rt({width:r.width,height:r.height},kt({translateX:r.left,translateY:r.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var n=this.canvasData,r=this.imageData,i=r.naturalWidth*(n.width/n.naturalWidth),s=r.naturalHeight*(n.height/n.naturalHeight);rt(r,{width:i,height:s,left:(n.width-i)/2,top:(n.height-s)/2}),ut(this.image,rt({width:r.width,height:r.height},kt(rt({translateX:r.left,translateY:r.top},r)))),t&&this.output()},initCropBox:function(){var t=this.options,n=this.canvasData,r=t.aspectRatio||t.initialAspectRatio,i=Number(t.autoCropArea)||.8,s={width:n.width,height:n.height};r&&(n.height*r>n.width?s.height=s.width/r:s.width=s.height*r),this.cropBoxData=s,this.limitCropBox(!0,!0),s.width=Math.min(Math.max(s.width,s.minWidth),s.maxWidth),s.height=Math.min(Math.max(s.height,s.minHeight),s.maxHeight),s.width=Math.max(s.minWidth,s.width*i),s.height=Math.max(s.minHeight,s.height*i),s.left=n.left+(n.width-s.width)/2,s.top=n.top+(n.height-s.height)/2,s.oldLeft=s.left,s.oldTop=s.top,this.initialCropBoxData=rt({},s)},limitCropBox:function(t,n){var r=this.options,i=this.containerData,s=this.canvasData,o=this.cropBoxData,u=this.limited,a=r.aspectRatio;if(t){var f=Number(r.minCropBoxWidth)||0,l=Number(r.minCropBoxHeight)||0,c=Math.min(i.width,u?s.width:i.width),h=Math.min(i.height,u?s.height:i.height);f=Math.min(f,i.width),l=Math.min(l,i.height),a&&(f&&l?l*a>f?l=f/a:f=l*a:f?l=f/a:l&&(f=l*a),h*a>c?h=c/a:c=h*a),o.minWidth=Math.min(f,c),o.minHeight=Math.min(l,h),o.maxWidth=c,o.maxHeight=h}n&&(u?(o.minLeft=Math.max(0,s.left),o.minTop=Math.max(0,s.top),o.maxLeft=Math.min(i.width,s.left+s.width)-o.width,o.maxTop=Math.min(i.height,s.top+s.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=i.width-o.width,o.maxTop=i.height-o.height))},renderCropBox:function(){var t=this.options,n=this.containerData,i=this.cropBoxData;if(i.width>i.maxWidth||i.width<i.minWidth)i.left=i.oldLeft;if(i.height>i.maxHeight||i.height<i.minHeight)i.top=i.oldTop;i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,t.movable&&t.cropBoxMovable&&vt(this.face,S,i.width>=n.width&&i.height>=n.height?s:r),ut(this.cropBox,rt({width:i.width,height:i.height},kt({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),Et(this.element,k,this.getData())}},zt={initPreview:function(){var t=this.crossOrigin,n=this.options.preview,r=t?this.crossOriginUrl:this.url,i=document.createElement("img");t&&(i.crossOrigin=t),i.src=r,this.viewBox.appendChild(i),this.viewBoxImage=i;if(!n)return;var s=n;typeof n=="string"?s=this.element.ownerDocument.querySelectorAll(n):n.querySelector&&(s=[n]),this.previews=s,nt(s,function(e){var n=document.createElement("img");vt(e,x,{width:e.offsetWidth,height:e.offsetHeight,html:e.innerHTML}),t&&(n.crossOrigin=t),n.src=r,n.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',e.innerHTML="",e.appendChild(n)})},resetPreview:function(){nt(this.previews,function(e){var t=dt(e,x);ut(e,{width:t.width,height:t.height}),e.innerHTML=t.html,mt(e,x)})},preview:function(){var t=this.imageData,n=this.canvasData,r=this.cropBoxData,i=r.width,s=r.height,o=t.width,u=t.height,a=r.left-n.left-t.left,f=r.top-n.top-t.top;if(!this.cropped||this.disabled)return;ut(this.viewBoxImage,rt({width:o,height:u},kt(rt({translateX:-a,translateY:-f},t)))),nt(this.previews,function(e){var n=dt(e,x),r=n.width,l=n.height,c=r,h=l,p=1;i&&(p=r/i,h=s*p),s&&h>l&&(p=l/s,c=i*p,h=l),ut(e,{width:c,height:h}),ut(e.getElementsByTagName("img")[0],rt({width:o*p,height:u*p},kt(rt({translateX:-a*p,translateY:-f*p},t))))})}},Wt={bind:function(){var t=this.element,n=this.options,r=this.cropper;tt(n.cropstart)&&wt(t,O,n.cropstart),tt(n.cropmove)&&wt(t,A,n.cropmove),tt(n.cropend)&&wt(t,L,n.cropend),tt(n.crop)&&wt(t,k,n.crop),tt(n.zoom)&&wt(t,F,n.zoom),wt(r,_,this.onCropStart=this.cropStart.bind(this)),n.zoomable&&n.zoomOnWheel&&wt(r,j,this.onWheel=this.wheel.bind(this)),n.toggleDragModeOnDblclick&&wt(r,M,this.onDblclick=this.dblclick.bind(this)),wt(t.ownerDocument,D,this.onCropMove=this.cropMove.bind(this)),wt(t.ownerDocument,P,this.onCropEnd=this.cropEnd.bind(this)),n.responsive&&wt(window,B,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,n=this.options,r=this.cropper;tt(n.cropstart)&&bt(t,O,n.cropstart),tt(n.cropmove)&&bt(t,A,n.cropmove),tt(n.cropend)&&bt(t,L,n.cropend),tt(n.crop)&&bt(t,k,n.crop),tt(n.zoom)&&bt(t,F,n.zoom),bt(r,_,this.onCropStart),n.zoomable&&n.zoomOnWheel&&bt(r,j,this.onWheel),n.toggleDragModeOnDblclick&&bt(r,M,this.onDblclick),bt(t.ownerDocument,D,this.onCropMove),bt(t.ownerDocument,P,this.onCropEnd),n.responsive&&bt(window,B,this.onResize)}},Xt={resize:function(){var t=this.options,n=this.container,r=this.containerData,i=Number(t.minContainerWidth)||200,s=Number(t.minContainerHeight)||100;if(this.disabled||r.width<=i||r.height<=s)return;var o=n.offsetWidth/r.width;if(o!==1||n.offsetHeight!==r.height){var u=void 0,a=void 0;t.restore&&(u=this.getCanvasData(),a=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(nt(u,function(e,t){u[t]=e*o})),this.setCropBoxData(nt(a,function(e,t){a[t]=e*o})))}},dblclick:function(){if(this.disabled||this.options.dragMode===C)return;this.setDragMode(at(this.dragBox,v)?N:T)},wheel:function(t){var n=this,r=Number(this.options.wheelZoomRatio)||.1,i=1;if(this.disabled)return;t.preventDefault();if(this.wheeling)return;this.wheeling=!0,setTimeout(function(){n.wheeling=!1},50),t.deltaY?i=t.deltaY>0?1:-1:t.wheelDelta?i=-t.wheelDelta/120:t.detail&&(i=t.detail>0?1:-1),this.zoom(-i*r,t)},cropStart:function(t){if(this.disabled)return;var n=this.options,r=this.pointers,s=void 0;t.changedTouches?nt(t.changedTouches,function(e){r[e.identifier]=At(e)}):r[t.pointerId||0]=At(t),Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?s=o:s=dt(t.target,S);if(!I.test(s))return;if(Et(this.element,O,{originalEvent:t,action:s})===!1)return;t.preventDefault(),this.action=s,this.cropping=!1,s===i&&(this.cropping=!0,ft(this.dragBox,w))},cropMove:function(t){var n=this.action;if(this.disabled||!n)return;var r=this.pointers;t.preventDefault();if(Et(this.element,A,{originalEvent:t,action:n})===!1)return;t.changedTouches?nt(t.changedTouches,function(e){rt(r[e.identifier],At(e,!0))}):rt(r[t.pointerId||0],At(t,!0)),this.change(t)},cropEnd:function(t){if(this.disabled)return;var n=this.action,r=this.pointers;t.changedTouches?nt(t.changedTouches,function(e){delete r[e.identifier]}):delete r[t.pointerId||0];if(!n)return;t.preventDefault(),Object.keys(r).length||(this.action=""),this.cropping&&(this.cropping=!1,ct(this.dragBox,w,this.cropped&&this.options.modal)),Et(this.element,L,{originalEvent:t,action:n})}},Vt={change:function(t){var n=this.options,v=this.canvasData,m=this.containerData,y=this.cropBoxData,b=this.pointers,w=this.action,E=n.aspectRatio,S=y.left,x=y.top,T=y.width,N=y.height,C=S+T,k=x+N,L=0,A=0,O=m.width,M=m.height,_=!0,D=void 0;!E&&t.shiftKey&&(E=T&&N?T/N:1),this.limited&&(L=y.minLeft,A=y.minTop,O=L+Math.min(m.width,v.width,v.left+v.width),M=A+Math.min(m.height,v.height,v.top+v.height));var P=b[Object.keys(b)[0]],H={x:P.endX-P.startX,y:P.endY-P.startY},B=function(t){switch(t){case u:C+H.x>O&&(H.x=O-C);break;case a:S+H.x<L&&(H.x=L-S);break;case l:x+H.y<A&&(H.y=A-x);break;case f:k+H.y>M&&(H.y=M-k);break;default:}};switch(w){case r:S+=H.x,x+=H.y;break;case u:if(H.x>=0&&(C>=O||E&&(x<=A||k>=M))){_=!1;break}B(u),T+=H.x,T<0&&(w=a,T=-T,S-=T),E&&(N=T/E,x+=(y.height-N)/2);break;case l:if(H.y<=0&&(x<=A||E&&(S<=L||C>=O))){_=!1;break}B(l),N-=H.y,x+=H.y,N<0&&(w=f,N=-N,x-=N),E&&(T=N*E,S+=(y.width-T)/2);break;case a:if(H.x<=0&&(S<=L||E&&(x<=A||k>=M))){_=!1;break}B(a),T-=H.x,S+=H.x,T<0&&(w=u,T=-T,S-=T),E&&(N=T/E,x+=(y.height-N)/2);break;case f:if(H.y>=0&&(k>=M||E&&(S<=L||C>=O))){_=!1;break}B(f),N+=H.y,N<0&&(w=l,N=-N,x-=N),E&&(T=N*E,S+=(y.width-T)/2);break;case c:if(E){if(H.y<=0&&(x<=A||C>=O)){_=!1;break}B(l),N-=H.y,x+=H.y,T=N*E}else B(l),B(u),H.x>=0?C<O?T+=H.x:H.y<=0&&x<=A&&(_=!1):T+=H.x,H.y<=0?x>A&&(N-=H.y,x+=H.y):(N-=H.y,x+=H.y);T<0&&N<0?(w=d,N=-N,T=-T,x-=N,S-=T):T<0?(w=h,T=-T,S-=T):N<0&&(w=p,N=-N,x-=N);break;case h:if(E){if(H.y<=0&&(x<=A||S<=L)){_=!1;break}B(l),N-=H.y,x+=H.y,T=N*E,S+=y.width-T}else B(l),B(a),H.x<=0?S>L?(T-=H.x,S+=H.x):H.y<=0&&x<=A&&(_=!1):(T-=H.x,S+=H.x),H.y<=0?x>A&&(N-=H.y,x+=H.y):(N-=H.y,x+=H.y);T<0&&N<0?(w=p,N=-N,T=-T,x-=N,S-=T):T<0?(w=c,T=-T,S-=T):N<0&&(w=d,N=-N,x-=N);break;case d:if(E){if(H.x<=0&&(S<=L||k>=M)){_=!1;break}B(a),T-=H.x,S+=H.x,N=T/E}else B(f),B(a),H.x<=0?S>L?(T-=H.x,S+=H.x):H.y>=0&&k>=M&&(_=!1):(T-=H.x,S+=H.x),H.y>=0?k<M&&(N+=H.y):N+=H.y;T<0&&N<0?(w=c,N=-N,T=-T,x-=N,S-=T):T<0?(w=p,T=-T,S-=T):N<0&&(w=h,N=-N,x-=N);break;case p:if(E){if(H.x>=0&&(C>=O||k>=M)){_=!1;break}B(u),T+=H.x,N=T/E}else B(f),B(u),H.x>=0?C<O?T+=H.x:H.y>=0&&k>=M&&(_=!1):T+=H.x,H.y>=0?k<M&&(N+=H.y):N+=H.y;T<0&&N<0?(w=h,N=-N,T=-T,x-=N,S-=T):T<0?(w=d,T=-T,S-=T):N<0&&(w=c,N=-N,x-=N);break;case s:this.move(H.x,H.y),_=!1;break;case o:this.zoom(Lt(b),t),_=!1;break;case i:if(!H.x||!H.y){_=!1;break}D=St(this.cropper),S=P.startX-D.left,x=P.startY-D.top,T=y.minWidth,N=y.minHeight,H.x>0?w=H.y>0?p:c:H.x<0&&(S-=T,w=H.y>0?d:h),H.y<0&&(x-=N),this.cropped||(lt(this.cropBox,g),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break;default:}_&&(y.width=T,y.height=N,y.left=S,y.top=x,this.action=w,this.renderCropBox()),nt(b,function(e){e.startX=e.endX,e.startY=e.endY})}},$t={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&ft(this.dragBox,w),lt(this.cropBox,g),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=rt({},this.initialImageData),this.canvasData=rt({},this.initialCanvasData),this.cropBoxData=rt({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(rt(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),lt(this.dragBox,w),ft(this.cropBox,g)),this},replace:function(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),n?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,nt(this.previews,function(e){e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,lt(this.cropper,m)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,ft(this.cropper,m)),this},destroy:function(){var t=this.element;return dt(t,n)?(this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),mt(t,n),this):this},move:function(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t,r=this.canvasData,i=r.left,s=r.top;return this.moveTo(G(t)?t:i+Number(t),G(n)?n:s+Number(n))},moveTo:function(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t,r=this.canvasData,i=!1;return t=Number(t),n=Number(n),this.ready&&!this.disabled&&this.options.movable&&(Q(t)&&(r.left=t,i=!0),Q(n)&&(r.top=n,i=!0),i&&this.renderCanvas(!0)),this},zoom:function(t,n){var r=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(r.width*t/r.naturalWidth,null,n)},zoomTo:function(t,n,r){var i=this.options,s=this.canvasData,o=s.width,u=s.height,a=s.naturalWidth,f=s.naturalHeight;t=Number(t);if(t>=0&&this.ready&&!this.disabled&&i.zoomable){var l=a*t,c=f*t;if(Et(this.element,F,{ratio:t,oldRatio:o/a,originalEvent:r})===!1)return this;if(r){var h=this.pointers,p=St(this.cropper),d=h&&Object.keys(h).length?Ot(h):{pageX:r.pageX,pageY:r.pageY};s.left-=(l-o)*((d.pageX-p.left-s.left)/o),s.top-=(c-u)*((d.pageY-p.top-s.top)/u)}else et(n)&&Q(n.x)&&Q(n.y)?(s.left-=(l-o)*((n.x-s.left)/o),s.top-=(c-u)*((n.y-s.top)/u)):(s.left-=(l-o)/2,s.top-=(c-u)/2);s.width=l,s.height=c,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),Q(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var n=this.imageData.scaleY;return this.scale(t,Q(n)?n:1)},scaleY:function(t){var n=this.imageData.scaleX;return this.scale(Q(n)?n:1,t)},scale:function(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t,r=this.imageData,i=!1;return t=Number(t),n=Number(n),this.ready&&!this.disabled&&this.options.scalable&&(Q(t)&&(r.scaleX=t,i=!0),Q(n)&&(r.scaleY=n,i=!0),i&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,n=this.options,r=this.imageData,i=this.canvasData,s=this.cropBoxData,o=void 0;if(this.ready&&this.cropped){o={x:s.left-i.left,y:s.top-i.top,width:s.width,height:s.height};var u=r.width/r.naturalWidth;nt(o,function(e,t){o[t]=e/u});if(t){var a=Math.round(o.y+o.height),f=Math.round(o.x+o.width);o.x=Math.round(o.x),o.y=Math.round(o.y),o.width=f-o.x,o.height=a-o.y}}else o={x:0,y:0,width:0,height:0};return n.rotatable&&(o.rotate=r.rotate||0),n.scalable&&(o.scaleX=r.scaleX||1,o.scaleY=r.scaleY||1),o},setData:function(t){var n=this.options,r=this.imageData,i=this.canvasData,s={};if(this.ready&&!this.disabled&&et(t)){var o=!1;n.rotatable&&Q(t.rotate)&&t.rotate!==r.rotate&&(r.rotate=t.rotate,o=!0),n.scalable&&(Q(t.scaleX)&&t.scaleX!==r.scaleX&&(r.scaleX=t.scaleX,o=!0),Q(t.scaleY)&&t.scaleY!==r.scaleY&&(r.scaleY=t.scaleY,o=!0)),o&&this.renderCanvas(!0,!0);var u=r.width/r.naturalWidth;Q(t.x)&&(s.left=t.x*u+i.left),Q(t.y)&&(s.top=t.y*u+i.top),Q(t.width)&&(s.width=t.width*u),Q(t.height)&&(s.height=t.height*u),this.setCropBoxData(s)}return this},getContainerData:function(){return this.ready?rt({},this.containerData):{}},getImageData:function(){return this.sized?rt({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,n={};return this.ready&&nt(["left","top","width","height","naturalWidth","naturalHeight"],function(e){n[e]=t[e]}),n},setCanvasData:function(t){var n=this.canvasData,r=n.aspectRatio;return this.ready&&!this.disabled&&et(t)&&(Q(t.left)&&(n.left=t.left),Q(t.top)&&(n.top=t.top),Q(t.width)?(n.width=t.width,n.height=t.width/r):Q(t.height)&&(n.height=t.height,n.width=t.height*r),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,n=void 0;return this.ready&&this.cropped&&(n={left:t.left,top:t.top,width:t.width,height:t.height}),n||{}},setCropBoxData:function(t){var n=this.cropBoxData,r=this.options.aspectRatio,i=void 0,s=void 0;return this.ready&&this.cropped&&!this.disabled&&et(t)&&(Q(t.left)&&(n.left=t.left),Q(t.top)&&(n.top=t.top),Q(t.width)&&t.width!==n.width&&(i=!0,n.width=t.width),Q(t.height)&&t.height!==n.height&&(s=!0,n.height=t.height),r&&(i?n.height=n.width/r:s&&(n.width=n.height*r)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var n=this.canvasData,r=Pt(this.image,this.imageData,n,t);if(!this.cropped)return r;var i=this.getData(),s=i.x,o=i.y,u=i.width,a=i.height,f=r.width/Math.floor(n.naturalWidth);f!==1&&(s*=f,o*=f,u*=f,a*=f);var l=u/a,c=_t({aspectRatio:l,width:t.maxWidth||Infinity,height:t.maxHeight||Infinity}),h=_t({aspectRatio:l,width:t.minWidth||0,height:t.minHeight||0},"cover"),p=_t({aspectRatio:l,width:t.width||(f!==1?r.width:u),height:t.height||(f!==1?r.height:a)}),d=p.width,v=p.height;d=Math.min(c.width,Math.max(h.width,d)),v=Math.min(c.height,Math.max(h.height,v));var m=document.createElement("canvas"),g=m.getContext("2d");m.width=st(d),m.height=st(v),g.fillStyle=t.fillColor||"transparent",g.fillRect(0,0,d,v);var y=t.imageSmoothingEnabled,b=y===undefined?!0:y,w=t.imageSmoothingQuality;g.imageSmoothingEnabled=b,w&&(g.imageSmoothingQuality=w);var E=r.width,S=r.height,x=s,T=o,N=void 0,C=void 0,k=void 0,L=void 0,A=void 0,O=void 0;x<=-u||x>E?(x=0,N=0,k=0,A=0):x<=0?(k=-x,x=0,N=Math.min(E,u+x),A=N):x<=E&&(k=0,N=Math.min(u,E-x),A=N),N<=0||T<=-a||T>S?(T=0,C=0,L=0,O=0):T<=0?(L=-T,T=0,C=Math.min(S,a+T),O=C):T<=S&&(L=0,C=Math.min(a,S-T),O=C);var M=[x,T,N,C];if(A>0&&O>0){var _=d/u;M.push(k*_,L*_,A*_,O*_)}return g.drawImage.apply(g,[r].concat(J(M.map(function(e){return Math.floor(st(e))})))),m},setAspectRatio:function(t){var n=this.options;return!this.disabled&&!G(t)&&(n.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var n=this.options,r=this.dragBox,i=this.face;if(this.ready&&!this.disabled){var s=t===T,o=n.movable&&t===N;t=s||o?t:C,n.dragMode=t,vt(r,S,t),ct(r,v,s),ct(r,E,o),n.cropBoxMovable||(vt(i,S,t),ct(i,v,s),ct(i,E,o))}return this}},Jt=t.Cropper,Kt=function(){function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};V(this,e);if(!t||!U.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=rt({},z,et(n)&&n),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return $(e,[{key:"init",value:function(){var t=this.element,r=t.tagName.toLowerCase(),i=void 0;if(dt(t,n))return;vt(t,n,this);if(r==="img"){this.isImg=!0,i=t.getAttribute("src")||"",this.originalUrl=i;if(!i)return;i=t.src}else r==="canvas"&&window.HTMLCanvasElement&&(i=t.toDataURL());this.load(i)}},{key:"load",value:function(t){var n=this;if(!t)return;this.url=t,this.imageData={};var r=this.element,i=this.options;!i.rotatable&&!i.scalable&&(i.checkOrientation=!1);if(!i.checkOrientation||!window.ArrayBuffer){this.clone();return}if(q.test(t)){R.test(t)?this.read(Ft(t)):this.clone();return}var s=new XMLHttpRequest;this.reloading=!0,this.xhr=s;var o=function(){n.reloading=!1,n.xhr=null};s.ontimeout=o,s.onabort=o,s.onerror=function(){o(),n.clone()},s.onload=function(){o(),n.read(s.response)},i.checkCrossOrigin&&Nt(t)&&r.crossOrigin&&(t=Ct(t)),s.open("get",t),s.responseType="arraybuffer",s.withCredentials=r.crossOrigin==="use-credentials",s.send()}},{key:"read",value:function(t){var n=this.options,r=this.imageData,i=qt(t),s=0,o=1,u=1;if(i>1){this.url=It(t,"image/jpeg");var a=Rt(i);s=a.rotate,o=a.scaleX,u=a.scaleY}n.rotatable&&(r.rotate=s),n.scalable&&(r.scaleX=o,r.scaleY=u),this.clone()}},{key:"clone",value:function(){var t=this.element,n=this.url,r=void 0,i=void 0;this.options.checkCrossOrigin&&Nt(n)&&(r=t.crossOrigin,r?i=n:(r="anonymous",i=Ct(n))),this.crossOrigin=r,this.crossOriginUrl=i;var s=document.createElement("img");r&&(s.crossOrigin=r),s.src=i||n,this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),ft(s,y),t.parentNode.insertBefore(s,t.nextSibling)}},{key:"start",value:function(){var n=this,r=this.isImg?this.element:this.image;r.onload=null,r.onerror=null,this.sizing=!0;var i=t.navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(t.navigator.userAgent),s=function(t,r){rt(n.imageData,{naturalWidth:t,naturalHeight:r,aspectRatio:t/r}),n.sizing=!1,n.sized=!0,n.build()};if(r.naturalWidth&&!i){s(r.naturalWidth,r.naturalHeight);return}var o=document.createElement("img"),u=document.body||document.documentElement;this.sizingImage=o,o.onload=function(){s(o.width,o.height),i||u.removeChild(o)},o.src=r.src,i||(o.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",u.appendChild(o))}},{key:"stop",value:function(){var t=this.image;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}},{key:"build",value:function(){if(!this.sized||this.ready)return;var t=this.element,i=this.options,s=this.image,o=t.parentNode,u=document.createElement("div");u.innerHTML=W;var a=u.querySelector("."+n+"-container"),f=a.querySelector("."+n+"-canvas"),l=a.querySelector("."+n+"-drag-box"),c=a.querySelector("."+n+"-crop-box"),h=c.querySelector("."+n+"-face");this.container=o,this.cropper=a,this.canvas=f,this.dragBox=l,this.cropBox=c,this.viewBox=a.querySelector("."+n+"-view-box"),this.face=h,f.appendChild(s),ft(t,g),o.insertBefore(a,t.nextSibling),this.isImg||lt(s,y),this.initPreview(),this.bind(),i.initialAspectRatio=Math.max(0,i.initialAspectRatio)||NaN,i.aspectRatio=Math.max(0,i.aspectRatio)||NaN,i.viewMode=Math.max(0,Math.min(3,Math.round(i.viewMode)))||0,ft(c,g),i.guides||ft(c.getElementsByClassName(n+"-dashed"),g),i.center||ft(c.getElementsByClassName(n+"-center"),g),i.background&&ft(a,n+"-bg"),i.highlight||ft(h,b),i.cropBoxMovable&&(ft(h,E),vt(h,S,r)),i.cropBoxResizable||(ft(c.getElementsByClassName(n+"-line"),g),ft(c.getElementsByClassName(n+"-point"),g)),this.render(),this.ready=!0,this.setDragMode(i.dragMode),i.autoCrop&&this.crop(),this.setData(i.data),tt(i.ready)&&wt(t,H,i.ready,{once:!0}),Et(t,H)}},{key:"unbuild",value:function(){if(!this.ready)return;this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),lt(this.element,g)}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?this.xhr.abort():this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Jt,e}},{key:"setDefaults",value:function(t){rt(z,et(t)&&t)}}]),e}();return rt(Kt.prototype,Ut,zt,Wt,Xt,Vt,$t),Kt}),define("module/cropper-photo",["cropper","plugin/pops","plugin/dialog","module/uploadVCodeModal/uploadVCodeModal"],function(e,t,n,r){$(document.body).append('<canvas id="cropCanvas" style="position: fixed; left: 100%; overflow:hidden;" width="0" height="0">该浏览器不兼容</canvas>');var i=['<div class="crop-container">','<div class="photo-area">','<div class="title">','<h4>设置视频封面<i class="icon9 icon-closed btn-closed fr"></i></h4>',"</div>",'<div class="edit-content">','<div class="photo-container"></div>','<div class="photo-set-container">','<a href="javascript:;" class="cropper-reupload">重新上传</a>','<span class="zoom-container"><span class="zoom zoom-in">-</span><span class="zoom zoom-out">+</span></span>',"</div>",'<div class="photo-preview-container cl">','<div class="photo-preview"></div>','<div class="preview-desc">','<div class="preview-title">图像预览</div>','<p class="tip">图像建议尺寸：16:9 大于960x540</p>','<p class="tip">文件大小：小于5m</p>',"</div>","</div>","</div>",'<div class="confirm-container">','<span class="wrapper">','<button class="btn confirm">确定</button>','<button class="btn cancel">取消</button>',"</span>","</div>","</div>","</div>"].join(""),s=new t.Modal({containerClass:"masker hidden",dialogClass:"identy-pop mid hidden",closeBtn:"icon-closed",template:i});return{open:function(){this.init(),s.open()},close:function(){this.unBindEvents()},init:function(e){var t=this.$file=$('<input id="cover-cropper-file" style="display:none;" type="file" accept=".PNG,.GIF,.BMP,.JPEG,.JPG" />'),n=this.$uploadLabel=$('<label style="opacity: 0; width: 100%;height: 100%;left: 0;top:0; position: absolute;" for="cover-cropper-file">上传文件</label>'),r=typeof e.uploadBtn=="string"?$(e.uploadBtn):$();r.css("position","relative"),r.append(t),r.append(n),this.image=new Image;var i=$(s.getEl());this.$imgItem=typeof e.imgItem=="string"?$(e.imgItem):$(),this.img_upload_url=e.img_upload_url,this.$imgForm=typeof e.imgForm=="string"?$(e.imgForm):$(),this.$photoContainer=i.find(".photo-container"),this.preview=i.find(".photo-preview ").get(0),this.$reupload=i.find(".cropper-reupload"),this.$zoomIn=i.find(".zoom.zoom-in"),this.$zoomOut=i.find(".zoom.zoom-out"),this.$cancel=i.find(".btn.cancel"),this.$confirm=i.find(".btn.confirm"),this.canvas=$("#cropCanvas").get(0),this.ctx=this.canvas.getContext("2d"),this.bindEvents()},bindEvents:function(){var t=this;this.$file.on("change",function(){var r=new FileReader,i=new Image,o=this.files[0];if(!o)return!1;t.fileSize=o.size;if(o.size>5242880)return n.alert("图片容量不应超过5M");t.type=o.type,t.filename=o.name,t.image=i,t.$photoContainer.html(""),t.$photoContainer.append(i),r.onload=function(){i.src=this.result,t.cropper=new e(i,{dragMode:"move",aspectRatio:16/9,viewMode:1,preview:t.preview}),s.visible||s.open()},r.readAsDataURL(o)}),this.$reupload.on("click",function(){t.$uploadLabel.trigger("click")}),this.$zoomIn.on("click",function(){t.cropper.zoom(-0.1)}),this.$zoomOut.on("click",function(){t.cropper.zoom(.1)}),this.$cancel.on("click",function(){t.close()}),this.$confirm.on("click",function(){var e=t.toCrop(),i=t.toFile(e),s=new FormData;s.append("type","cover"),s.append("size",t.fileSize),s.append(t.filename,i),t.$confirm.text("上传中..."),t.submitImageData(s).done(function(e){t.$confirm.text("确定");if(e.ret==50001)return r.callModal(e.data,15e3);if(e.status){var i=e.data[0].url;t.$imgForm.val(i),t.$imgItem.attr("src",i),t.close()}else n.alert(e.msg||"文件上传失败")}).fail(function(){t.$confirm.text("确定")})})},close:function(){s.close(),this.$file.val("")},submitImageData:function(e){return $.ajax({url:this.img_upload_url,contentType:!1,processData:!1,dataType:"json",type:"post",data:e})},File:function(e,t,n){var r=e instanceof Blob?e:new Blob(e,n),i=n&&void 0!==n.lastModified?new Date(n.lastModified):new Date;return Object.defineProperties(r,{name:{value:t},lastModifiedDate:{value:i},lastModified:{value:+i},toString:{value:function(){return"[object File]"}}}),window.Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"File"}),r},toFile:function(e){var t=this.toBlob(e);return console.log(this.filename,t,t.type),this.File(t,this.filename,{type:t.type})},toBlob:function(e){var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1].replace(/\s/g,"")),i=r.length,s=new Uint8Array(i);while(i--)s[i]=r.charCodeAt(i);return new Blob([s],{type:n})},toCrop:function(){var e=this.cropper.getData(),t=e.x,n=e.y,r=e.width,i=e.height;return this.canvas.width=r,this.canvas.height=i,this.ctx.drawImage(this.image,t,n,r,i,0,0,r,i),this.canvas.toDataURL(this.type)},unBindEvents:function(){}}}),define("page/upload/edit_track",["jquery","page/page_base","plugin/dialog","page/upload/information","page/upload/form_check","module/dialogs/soundpreview","module/cropper-photo","plugin/jquery.input"],function(e,t,n,r,i,s,o){var u,a=8,f=t.extend({init:function(t){u=t.pageConfig,this.callParent("init"),this.preview(),this.handleSoundIntroRequire(u.track.is_paid,u.track.category_id),r.init({album:!1,is_sound_edit:!0,pageConfig:u,allowEditorLink:!!u.allowEditorLink}),this.soundRichIntroTop(),this.initFormCheck(),this.bindEvent(),o.init({imgItem:"#videoImageWrap .imgItem img",img_upload_url:"/dtres/cover/upload",imgForm:"#videoImageWrap input[name=video_cover_path]",uploadBtn:"#videoImageWrapBtn"});var i=e("#album_id"),s=this,a=e("<div></div>").append(e.trim(e("#category_related").html())),f=i.parent(".cell-2"),l=function(t,n,r){var i;if(t!=2)i=a.find("#default_category_related").html(),f.find("#musician-tips").remove();else{n!="原唱"&&n!="翻唱"&&n!="伴奏"&&(n="默认");if(current_user.isVerified){var s='<p class="" id="musician-tips"><a href="http://form.mikecrm.com/0u7Pb7" class="link-red" target="_blank">认证音乐人，享受更多权利>></a></p>';f.append(s)}n=n||"默认",i=a.find('#music_category_related div[data-title="'+n+'"]').html()}e(".js-category-related").empty().html(i),r&&(e(".js-category-related").find('input[name="sound_singer2"]').val(r.singer||""),e(".js-category-related").find('input[name="sound_resinger"]').val(r.resinger||""),e(".js-category-related").find('textarea[name="sound_lyric"]').val(r.lyric||""),e(".js-category-related").find('textarea[name="sound_music_lyric"]').val(r.lyric||""),e(".js-category-related").find('input[name="sound_announcer"]').val(r.announcer||""),e(".js-category-related").find('input[name="sound_author"]').val(r.author||"")),e(".js-category-related").find("#origin").selecter()},c=u.track;i.unbind("change");var h=i.find(".selected").attr("data-category-id"),p=i.find(".selected").attr("data-music-category");l(h||c.category_id,p||c.music_category,c),i.off("click").removeAttr("inited");var d=i.selecter("val"),v=i.find('.selecter-options li[data-value="'+d+'"]').attr("data-is-paid");i.selecter({onChange:function(t){var r='<i class="privacyIcon" title="私密专辑"></i>',o=e(this),u=i.selecter("val");if(o.find(".privacyIcon").length)return n.alert("公开节目只能添加至公开专辑"),!1;if(v==="true"&&o.attr("data-is-paid")==="true")return n.alert("亲，这条是付费声音，无法移出付费专辑哟~"),!1;if(o.attr("data-is-paid")==="true")return n.alert("亲，这张是付费专辑，无法收入免费节目哟~"),!1;o.find(".privacyIcon").length?i.find(".selecter-selected").append(r):i.find(".selecter-selected").find(".privacyIcon").remove();var a=o.attr("data-category-id"),f=o.attr("data-music-category");l(a,f),s.handleSoundIntroRequire(v,a)}})},initFormCheck:function(){i.titleStandard(e("#sound_title")),e("#sound_title").trigger("input")},bindEvent:function(){var t=1;e("input").beautify(),e(".js-more-options").on("click",function(){e(".js-more-options").toggleClass("unfolded"),e(".js-more-cont").toggleClass("hidden")}),e("#album-load-more").on("click",function(){$this=e(this),$this.text("加载中..."),e.get("/upload2/choose_album",{page:t+1}).done(function(n){t++;var r="",i=n.albums.list,s=n.albums.count,o=s>t*a;for(var u=0;u<i.length;u++)r+='<li class="selecter-item" data-category-id="'+i[u].category_id+'" data-music-category="'+i[u].music_category+'" data-is-paid="'+i[u].is_paid+'" data-is-public="'+i[u].is_public+'" data-value="'+i[u].album_id+'" title="'+i[u].title+'"><span class="selecter-item-text">'+i[u].title+"</span></li>";e("#album_id .selecter-options ul").append(r),o?$this.text("加载更多"):$this.remove()}).fail(function(){$this.text("加载更多")})}),e(".js-set-price").on("change",function(){var t=e(this).find("input:checked").val();t==1?e(".js-trylistening-type").removeClass("hidden"):e(".js-trylistening-type").addClass("hidden")}),e(".js-trylistening-type").on("change",function(){var t=e(this).find("input:checked").val();t==0?e(this).find(".tips").html("适用于正式节目免费听"):e(this).find(".tips").html("适用于大咖推荐/内容预告等的试听")});var n=e("#submit_save");n.click(function(){return r.check()&&r.submitForm(this,"/my_tracks"),!1})},soundRichIntroTop:function(){e('[name="sound_rich_intro"]').parent().addClass("mixed-editor").append('<a class="support-pic-text" href="http://blog.ximalaya.com/fuwenben/" target="_blank">支持图文混排了,快来了解下 &gt; </a>')},preview:function(){e("#soundPreview").length<=0&&e("#submit_save").after('<a href="javascript:;" class="btn btn-lg1 btn-secondary mgl-20 sound-preview-btn" id="soundPreview">预览</a>'),e("#soundPreview").on("click",function(){var t=e("#sound_title").val(),n=e(".is-fenmian").attr("src"),r=e("#album_id .selecter-selected .selecter-text").text(),i=e('textarea[name="sound_rich_intro"]').text(),o=u.track.is_video==1?"video":"audio";s.pop(t,n||"",r,i,o)})},handleSoundIntroRequire:function(t,n){var r=e("[name=sound_intro]"),i=r.parents(".row").find(".cell-1");t&&t.toString()==="true"&&n!=3?(r.attr("required",""),i.html('节目简介<span class="c04 ">*</span>')):(r.removeAttr("required"),i.html("节目简介"))},release:function(){this.callParent("release")}}),l=new f;return l}),define("page/upload/fileprogress",["jquery","helper","plugin/dialog","module/player/player"],function(e,t,n,r){function i(t,n,r,i){var s=this;this.fileProgressID=t.id,t.title=t.title||t.name.replace(t.type,""),this.opacity=100,this.height=0,this.isSingleFileSelected=r.singleFile;var o=e("#multiFile"),u=e("#singleFile"),a=e("#isalbum"),f=e("#appendToAlbum"),l=e("#appendToActivity"),c=e("#sound_title"),h=e("#voice_info_title"),p=e("#multiFile");r.singleFile||p.find(".editAlbum").show(),this.fileProgressWrapper=e("#"+this.fileProgressID);if(this.fileProgressWrapper.length==0){this.isSingleFile||(this.fileProgressContainer=o.find("."+n),u.hide(),o.show(),this.isSingleFileSelected?a.val("false"):a.val("true"),f.hide(),l.hide(),h.html("专辑信息"),e(".dv-phone").removeClass("dv-phone").addClass("album-phone-tip").empty(),c.val(t.title));var d='<div class="progressBar"><div class="progress"><div class="warp"><span class="uploading"></span><span class="info">上传进度：0M/0M</span></div><div class="warp"><span class="converting" style="width:0;"></span><span class="info">等待转码</span></div></div> <div class="progMask"></div><input class="fileid" type="hidden" name="fileids[]"/></div>';if(!this.isSingleFile){var v=this.fileProgressContainer.children().length+1;d='<li><div class="albumList_r1"><div class="number new">'+v+"</div>"+'<div class="albumList_sound">'+'<div class="soundInfo">'+'<div class="unedit"><span class="tit" title="'+t.title+'">'+this.shortTitle(t.title)+'</span><a class="editBtn forbid-drag"></a></div>'+'<div class="edit  forbid-drag"><input type="text" value="'+this.cutStr(t.title,80)+'" name="files[]" ><a class="editConfirm">确认</a><a class="cancel btn-close">取消</a></div>'+"</div>"+'<span class="c01"></span>'+"</div>"+'<div class="fr">'+'<div class="albumList_status"><span class="waitUpload">等待上传</span></div>'+'<a class=" del forbid-drag"></a>'+"</div>"+"</div>"+'<div class="uploadStatus">'+d+'<span class="albumList_arrow"><i></i></span>'+"</div>"+"</li>"}this.fileProgressWrapper=e(d),this.fileProgressWrapper.attr("id",this.fileProgressID),e("#set-top").is(":checked")?(this.fileProgressContainer.prepend(this.fileProgressWrapper),this.resetOrderNumber()):this.fileProgressContainer.append(this.fileProgressWrapper)}this._file=t;if(!this.isSingleFile){this.setDrag(),this.fileProgressContainer=o.find("."+n);var m=this.fileProgressContainer.children().size();e("#multiFile").find("#upload_file_sum").html(m),this.setDrag(),this.bindEvents();if(this.isSingleFileSelected){var g=s.fileProgressContainer.find(".soundInfo"),y=g.find(".tit"),b=g.find(".edit input");c.on("change",function(){t.title=c.val(),y.html(s.shortTitle(t.title)).attr("title",t.title),b.val(t.title)}),b.on("change",function(){c.val(b.val())})}}this.fileUploadingProgress=this.fileProgressWrapper.find(".uploading"),this.fileUploadingStatus=this.fileUploadingProgress.next(".info"),this.fileTranscodingProgress=this.fileProgressWrapper.find(".converting"),this.fileTranscodingStatus=this.fileTranscodingProgress.next(".info"),i||this.reset()}i.prototype.setTimer=function(e){},i.prototype.getTimer=function(e){},i.prototype.bindEvents=function(){var r=this.fileProgressWrapper,i=this,s=r.find(".soundInfo");if(r.attr("binded-events"))return;r.attr("binded-events",!0),r.on("click",".editBtn",function(){var t=e(this);s=t.closest(".soundInfo");var n=s.find(".tit"),r=s.find(".edit input"),i=n.width();s.find(".unedit").hide(),s.find(".edit").show()}),r.on("click",".editConfirm, .cancel",function(){var t=e(this);s=t.closest(".soundInfo");var n=s.find(".tit"),r=s.find(".edit input");if(t.hasClass("editConfirm")){var o=e.trim(r.val());if(!o||!i.checkTitle(o)){i.titleError();return}var u=i.shortTitle(o);n.text(u).attr("title",o),i._file.title=o,i.titleRight()}else i.titleRight(),r.val(n.text());s.find(".unedit").show(),s.find(".edit").hide()}),r.on("click",".js-errorLog",function(){var r=e(this),i=r.attr("errorLog"),s=t.ErrorLog.getLogText(i),o={content:'<div style="word-break: break-all;word-wrap: break-word;padding:10px">'+s+"</div>",width:480,title:"错误详情"},u=new n.Dialog(o);return u.open(),!1})},i.prototype.checkTitle=function(e){return t.gblen(e)>80?!1:!0},i.prototype.titleRight=function(){var e=this.fileProgressWrapper,t=e.find(".albumList_r1");t.removeClass("is-error"),e.removeClass("is-error")},i.prototype.titleError=function(e){e=e||"标题长度不符合要求,系统要求1-80字节";var t=this.fileProgressWrapper,n=t.find(".albumList_r1"),r=n.find(".c01");n.addClass("is-error"),t.addClass("is-error"),r.text(e)},i.prototype.shortTitle=function(e,t){t=t||45;var n=this.cutStr(e,t);return n!=e&&(n+="..."),n},i.prototype.cutStr=function(e,n){return t.gblen(e)<=n?e:(e=e.substring(0,e.length-1),arguments.callee(e,n))},i.prototype.reset=function(){this.fileUploadingProgress.width("0"),this.appear()},i.prototype.setUuid=function(e){this.fileProgressWrapper.find(".fileid").val(e),this.appear()},i.prototype.setTrackData=function(e){this.fileProgressWrapper.find(".track_data").val(e)},i.prototype.setComplete=function(){},i.prototype.setError=function(){var e=this.fileProgressWrapper.find(".albumList_status"),t=this.fileProgressWrapper.find(".uploadStatus");e.find("span").removeClass().addClass("failIcon").html("上传失败,请删除"),t.slideDown(1e3)},i.prototype.setCancelled=function(){var e=this;this.setTimer(setTimeout(function(){e.disappear()},2e3))},i.prototype.setStatus=function(e){this.fileUploadingStatus.html(e)},i.prototype.beforeCancel=function(e,t,n){},i.prototype.toggleCancel=function(t,n,r){if(this.isSingleFile)return;var i=this,s=this.fileProgressWrapper.find("a.del"),o=e("#upload_file_sum"),u=this.fileProgressWrapper.closest(".progressBarContainer"),a=location.href.indexOf("edit_album")!==-1;t?s.show():s.hide(),n.numFilesSelected==1&&(e("#multiFile > p.-ul-title").addClass("hidden"),e("#multiFile li .del").css("visibility","hidden"));var f=this.fileProgressID,i=this,l=function(){i.fileProgressWrapper.addClass("fileprogress_removed");var t=u.find("[drag_able]").not(".fileprogress_removed"),l=t.size();l==1&&!a,o.text(l),s.unbind("click"),n&&(n.cancelUpload(f),n.cancelTranscoding&&n.cancelTranscoding(f)),e.isFunction(r)&&r(f),i.disappear()};s.unbind("click"),s.bind("click",function(){var e=i.fileProgressWrapper.parent(),t=function(){l()},n=e.triggerHandler("beforeCancel",[t,i.fileProgressWrapper]);n||l()})},i.prototype.appear=function(){},i.prototype.disappear=function(){var e=this,t=this.fileProgressWrapper;t.animate({height:0},1e3,function(){t.remove(),t=null,e.resetOrderNumber()})},i.prototype.destroy=function(){var e=this.fileProgressWrapper;e.remove(),this.resetOrderNumber()},i.prototype.hide=function(){var e=this.fileProgressWrapper;e.hide()},i.prototype.uploadStart=function(){var e=this.fileProgressWrapper.find(".uploadStatus");e.slideDown(1e3)},i.prototype.setProgress=function(t){var n=t+"%";this.fileUploadingProgress.width(n);if(this.isSingleFile)e("#singleFile").find(".p_tip em").text(parseInt(t/2)+"%");else{var r=this.fileProgressWrapper.find(".albumList_status"),i=this.fileProgressWrapper.find(".uploadStatus");r.find("span").removeClass().addClass("areUploading").html("正在上传("+parseInt(t/2)+"%)")}this.appear()},i.prototype.setAttr=function(e,t){this.fileProgressWrapper.attr(e,t)},i.prototype.setTranscodingStatus=function(e){this.fileTranscodingStatus.html(e)},i.prototype.resetTranscodingProgress=function(){this.fileTranscodingProgress.width("0")},i.prototype.setTranscodingSuccess=function(e){if(this._transcodingSuccess)return;this._transcodingSuccess=!0;var t;if(e&&e.data&&e.data[0]){t=e.data[0].uploadTrack.id;var n=this;this.getSoundUrl(t,function(e){var r={sound_extension:!0,sound_url:e,sound_id:"upload_"+t};n.createPlayer(r)})}else{var r=this.fileProgressWrapper.attr("preplay_id");r?(this.fileProgressWrapper.attr("sound_id",r),this.createPlayer({sound_id:r})):e&&e.sound_id?this.createPlayer({sound_id:e.sound_id}):this.createPlayer()}},i.prototype.getSoundUrl=function(t,n){var r="/dtres/transcode/url";e.ajax({url:r,type:"get",data:{uploadTrackId:t},dataType:"json",success:function(e){n(e.url)}})},i.prototype.createPlayer=function(t){var n="uploadPlayer2",i="uploadPlayer",s='<div class="{playerCls}  forbid-drag"><a title="试听" class="playBtn"></a></div>',o;this.isSingleFile?(s=s.replace("{playerCls}",i),o=e("#singleFile"),t||(s=""),o.find(".p_tip").html("上传成功&nbsp;<em>试听</em>"+s)):(s=s.replace("{playerCls}",n),t||(s=""),this.transcodingSuccess(s),o=this.fileProgressWrapper),t&&o.attr(t),r.render({$container:o})},i.prototype.transcodingSuccess=function(e){var t=this.fileProgressWrapper.find(".uploadStatus"),n=this.fileProgressWrapper.find(".albumList_status");t.stop().slideUp(1e3),this.fileProgressWrapper.is("[is-exist=true]")?n.find("span").removeClass().addClass("successIcon").html("").css("background","none"):n.find("span").removeClass().addClass("successIcon").html("上传成功");var r=n.parent();if(r.find(".uploadPlayer2").size()>0)return;r.append(e)},i.prototype.setTranscodingProgress=function(t){this.fileTranscodingProgress.width(t+"%");if(this.isSingleFile)e("#singleFile").find(".p_tip em").text(parseInt(t/2+50)+"%");else{var n=this.fileProgressWrapper.find(".albumList_status");n.find("span").removeClass().addClass("areUploading").html("正在上传("+parseInt(t/2+50)+"%)")}this.appear()},i.prototype.setTranscodingError=function(){var e=this.fileProgressWrapper.find(".albumList_status");e.find("span").removeClass().addClass("failIcon").html("上传失败,请删除")},i.prototype.setOnErrorTimer=function(e){this.timer=e},i.prototype.getOnErrorTimer=function(){return this.timer},i.prototype.resetOrderNumber=function(){var t=this.fileProgressContainer,n=t.children(),r=n.size();for(var i=0;i<r;i++)n.eq(i).find(".number").text(i+1);e("#multiFile").find("#h_info").html("批量上传("+r+")")},i.prototype.setDrag=function(){function c(t){var n=t.data,r=n.element,i=n.offsetY,s=n.e.clientY,o=e(r),u=o.parent().offset().top,a=s+l.scrollTop()-u+i;window.console&&console.log(a),o.css("top",a),h(n.e,r)}function h(t,n){var r=e(n);r.css({left:0,zIndex:10});var s=r.outerHeight(),o=r.position().top,u=o+s/2,a=i.next();a.attr("id")==r.attr("id")&&(a=a.next());if(a.size()!=0){var f=a.position().top+a.outerHeight()/2;if(u>f){i.insertAfter(a),h(t,n);return}}var l=i.prev();l.attr("id")==r.attr("id")&&(l=l.prev());if(l.size()!=0){var c=l.position().top+l.outerHeight()/2;if(u<c){i.insertBefore(l),h(t,n);return}}}var t=this.fileProgressWrapper,n=this;if(t.attr("drag_able"))return;t.attr("drag_able",!0);var r=t.parent(),i=e('<li class="albumItem-holder"></li>'),s=e(".dragIcon");s.length==0&&(s=e('<div class="dragIcon">拖动改变顺序</div>'),e("body").append(s));var o=function(e){s.css({left:e.pageX+20,top:e.pageY-10})},u=t.find(".albumList_r1"),a=e(document);t.bind({mouseover:function(t){var n=e(t.target);!n.hasClass("forbid-drag")&&n.closest(".forbid-drag").size()==0&&(s.show(),a.on("mousemove",o),o(t))},mouseleave:function(){s.hide(),a.off("mousemove",o)},mouseout:function(){s.hide(),a.off("mousemove",o)}});var f=e(window),l=e(document);t.easydrag(!0),t.beforeDrag(function(n,r){var s=e(n.target);if(s.hasClass("forbid-drag")||s.closest(".forbid-drag").size()>0)return!0;var o=e(this);t.after(i);var u=t.height();i.height(u);var a=t.offset().top-n.pageY}),t.ondrag(function(e,t){h(e,t)}),t.ondrop(function(t,r){f.off("scroll",c);var s=e(r);s.insertAfter(i),i.remove(),s.css({position:"relative",left:"",top:"",zIndex:""}),n.resetOrderNumber()})},window.FileProgress=i}),define("page/upload/handlers",function(){}),define("plugin/jrecorder",["jquery"],function(e){(function(e){function r(t){return e("object[name="+t+"]")[0]}var t={play:function(e){},pause:function(){}},n={};e.jRecorder=function(r,i){if(typeof r=="string")return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):!1;i==undefined&&(i=e("body"));var s={rec_width:"215",rec_height:"138",rec_top:"0px",rec_left:"0px",recorderlayout_id:"flashrecarea",recorder_id:"audiorecorder",recorder_name:"audiorecorder",wmode:"transparent",bgcolor:"#ff0000",swf_path:"jRecorder.swf",host:"",progress_url:"/dtres/progress",filename:"record_file.wav",progressTarget:"",callback_started_recording:function(){},callback_finished_recording:function(e,t){},callback_before_sending:function(e){},callback_stopped_recording:function(e){},callback_error_recording:function(){},callback_error_loaded:function(){},callback_activityTime:function(e){},callback_activityLevel:function(e){},callback_file_progress:function(e,t){},callback_file_progress_error:function(e){},callback_started_preview:function(e,t){},callback_playing_time:function(e,t){},callback_playing_finish:function(e){},callback_playing_stop:function(e){},callback_pause_sound:function(e,t){},callback_file_upload_error:function(e,t,n){},cancelUpload:function(){},callback_flash_show:function(){},callback_flash_hide:function(){},callback_flash_loaded:function(){},debug:function(){},settings:{}};r&&e.extend(s,r),s.customSettings=s.custom_settings;var o=["host=",encodeURIComponent(s.host),"&progress_url=",encodeURIComponent(s.progress_url),"&filename=",encodeURIComponent(s.filename)].join("");n=s;var u;if(e.browser.msie&&Number(e.browser.version)<=8){var a='<object  name="'+s.recorder_name+'" id="'+s.recorder_id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+s.rec_width+'" height="'+s.rec_height+'"></object>',f=['<param name="movie" value="'+s.swf_path+"?host="+s.host+'" />','<param name="allowScriptAccess" value="always" />','<param name="bgcolor" value="'+s.bgcolor+'" />','<param name="wmode" value="'+s.wmode+'" />','<param name="flashvars" value="'+o+'" />'];u=document.createElement(a);for(var l=0;l<f.length;l++)u.appendChild(document.createElement(f[l]))}else{var c=function(e,t,n){var r=document.createElement("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)};u=document.createElement("object"),u.setAttribute("id",s.recorder_id),u.setAttribute("name",s.recorder_name),u.setAttribute("data",s.swf_path+"?host="+s.host),u.setAttribute("type","application/x-shockwave-flash"),u.setAttribute("width",s.rec_width),u.setAttribute("height",s.rec_height),c(u,"allowscriptaccess","always"),c(u,"bgcolor",s.bgcolor),c(u,"wmode",s.wmode),c(u,"flashvars",o)}i.width(s.rec_width),i.height(s.rec_height),i.css({position:"absolute",top:s.rec_top,left:s.rec_left,margin:"auto"}),i.append(u),n.element=i,e.jRecorder.hide()},e.jRecorder.show=function(){n.callback_flash_show()},e.jRecorder.hide=function(){n.callback_flash_hide()},e.jRecorder.record=function(t){window.console&&console.log("$.jRecorder.loaded",e.jRecorder.loaded);if(!e.jRecorder.loaded)return;t=t||60,e.jRecorder.show(),r(n.recorder_name).jStartRecording(t)},e.jRecorder.stop=function(){r(n.recorder_name).jStopRecording()},e.jRecorder.playsound=function(){r(n.recorder_name).jPlaySound()},e.jRecorder.stopsound=function(){r(n.recorder_name).jStopSound()},e.jRecorder.pausesound=function(){r(n.recorder_name).jPauseSound()},e.jRecorder.sendData=function(t,i){e.jRecorder.uploaded=!1,r(n.recorder_name).jSendFileToServer(t,i)},e.jRecorder.callback_started_recording=function(){n.callback_started_recording()},e.jRecorder.callback_finished_recording=function(){n.callback_finished_recording()},e.jRecorder.callback_error_recording=function(t){e.jRecorder.hide(),n.callback_error_recording(t)},e.jRecorder.callback_stopped_recording=function(e){n.callback_stopped_recording(e)},e.jRecorder.callback_finished_sending=function(){e.jRecorder.uploaded=!0,n.callback_finished_sending(arguments[0],arguments[1])},e.jRecorder.callback_activityLevel=function(e){n.callback_activityLevel(e)},e.jRecorder.callback_activityTime=function(t){e.jRecorder.hide(),n.callback_activityTime(t)},e.jRecorder.callback_file_progress=function(t,r,i){typeof r=="string"&&(r=e.parseJSON(r));if(e.jRecorder.uploaded)return;if(r.state!="uploading")return;n.callback_file_progress(t,r.received,r.size)},e.jRecorder.callback_file_progress_error=function(e){n.callback_file_progress_error(e)},e.jRecorder.callback_before_sending=function(e){n.callback_before_sending(e)},e.jRecorder.callback_file_upload_error=function(e,t){t=t||{},n.callback_file_upload_error(e,t.errorID,t.text)},e.jRecorder.callback_flash_loaded=function(t){window.console&&console.log("loaded","loaded");if(t=="error"){n.callback_error_loaded();return}e.jRecorder.loaded=!0,n.callback_flash_loaded()},e.jRecorder.callback_playing_time=function(e,t){n.callback_playing_time(e,t)},e.jRecorder.callback_playing_finish=function(e){n.callback_playing_finish(e)},e.jRecorder.callback_playing_stop=function(e){n.callback_playing_stop(e)},e.jRecorder.callback_started_preview=function(e,t){n.callback_started_preview(e,t)},e.jRecorder.callback_pause_sound=function(e,t){n.callback_pause_sound(e,t)},e.jRecorder.callback_get_progress=function(t,r,i){var s=(new Date).valueOf();e.ajax({url:n.progress_url+"?__t="+s,type:"get",success:function(n){e.jRecorder.callback_file_progress(t,n,i)},error:function(t){e.jRecorder.callback_file_progress_error(t)},beforeSend:function(e){e.setRequestHeader("X-Progress-ID",r)},dataType:"json"})}})(jQuery)}),define("page/upload/handlers_new",[],function(){function e(){window.console&&console.info(arguments)}function t(e){e.title=e.name.replace(e.type,""),this.filesSelected.singleFile||i.call(this,e)}function n(e,t,n){var r="";if(t===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){var s=p.mTotalNum-n;require(["plugin/dialog"],function(e){var t=""+(n===0?"你已经达到了上传限制。":"亲，您已经上传了"+s+"个文件，本次还可上传 "+n+"个文件");e.alert(t)});return}switch(t){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:r="文件太大.";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:r="不能上传空文件.";break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:r="未定义的文件类型.";break;default:e!==null&&(r="Unhandled Error:"+n)}i.call(this,e),p.fileProgress.process({id:e.id,type:"uploading",uploading:{status:"-1",msg:r}})}function r(e,n,r){this.filesSelected=r;var i=$("#isalbum"),s=$("#multiFile"),o=$("#singleFile"),u=$("#voice_info_title");if(e<=0)return;this.filesSelected.singleFile&&p.firstSelect?(i.val("false"),$(".editAlbum").hide()):i.val("true");if(!this.file_queued_list)return;var a=this.file_queued_list.length,f=_.map(this.file_queued_list,function(e){var t=e.name;return t=e.name.replace(/\d+/g,function(e){var t="";for(var n=e.length;n<10;n++)t+="0";return t+e}),{name:t,file:e}});f=_.sortBy(f,function(e){return e.name}),this.file_queued_list=_.map(f,function(e){return e.file});for(var l=0;l<this.file_queued_list.length;l++)t.call(this,this.file_queued_list[l]);o.hide(),s.show(),u.html("专辑信息"),$(".dv-phone").removeClass("dv-phone").addClass("album-phone-tip").empty(),this.file_queued_list=[]}function i(e,t){var n=this,r=function(e,t,r){require(["plugin/dialog"],function(e){e.confirm("是否要删除这个声音？",function(){return n&&(n.cancelUpload(r),n.cancelTranscoding&&n.cancelTranscoding(r)),t&&t(),!0})})},i=function(e){n.filesSelected.singleFile&&$("#sound_title").val(e)},s={file:e,delHandler:r,editNameFun:i};p.firstSelect&&t&&(s.noDrop=1),p.firstSelect=!1,p.fileProgress.add(s),p.fileProgress.process({id:e.id,type:"uploading",uploading:{status:0}})}function s(e){if(this.filesSelected.singleFile){e.title=e.name.replace(e.type,"");var t=$("#sound_title");t.val(e.title),p.fileProgress.isSingle=!0,i.call(this,e,!0)}return p.fileProgress.process({id:e.id,type:"uploading",uploading:{status:1}}),!0}function o(e,t,n){var r=Math.ceil(t/n*100),i=Math.floor(t*10/1048576)/10+"M",s=Math.floor(n*10/1048576)/10+"M";p.fileProgress.process({id:e.id,type:"uploading",uploading:{percentage:r,status:2,msg:"上传进度:"+i+"/"+s}})}function u(t,n){window.console&&console.log(n),n=$.parseJSON(n),p.fileProgress.process({id:t.id,type:"uploading",uploading:{percentage:100,status:3,msg:"上传完成",data:n}});if(n.ret==50){p.fileProgress.process({id:t.id,type:"uploading",uploading:{status:"－1",msg:"上传失败,请重新登录"}});return}if(n.ret!=0){p.fileProgress.process({id:t.id,type:"uploading",uploading:{status:"－1",msg:"上传失败,请重新登录"}});return}if(!n.status){this.upload_error_handler?this.upload_error_handler(t,null,n.msg):l.call(this,t,null,n.msg);return}var r=this;if(!n||!n.data||!n.data[0])return;var i=n.data[0];t.uploadSuccess=!0,t.transcoding=!1,t.transcoded=!1,t.transcodingError=!1,i.uploadTrack&&(t.uuid=i.uploadTrack.id),t.uuid||(t.uuid=i.id);var s=t.uuid,o={id:s};p.fileProgress.process({id:t.id,type:"uploading",uploading:{percentage:100,status:3,msg:"上传完成",data:o}});if(!this.settings.transcoding_url)return;p.fileProgress.process({id:t.id,type:"converting",converting:{status:0,msg:"等待转码"}});var r=this,u=!1,f=this.settings.transcoding_url,c=setInterval(function(){url=f.replace("{id}",t.uuid).replace("{timestamp}",(new Date).getTime());if(u)return;u=!0,$.ajax({type:"GET",url:url,dataType:"json",success:function(e,i,s){u=!1;if(!t.transcodeTimer){window.console&&console.log("!transcodeTimer");return}e.duration&&(t.duration=e.duration);switch(e.state){case"success":window.console&&console.log("clearInterval handler 185"),clearInterval(c),r.transcodings||(r.transcodings=0),t.transcoding=!1,t.transcoded=!0,t.transcodingError=!1,p.fileProgress.process({id:t.id,type:"converting",converting:{percentage:100,status:3,msg:"转码完成",data:n}}),r.settings.transcoding_success(t);break;case"error":window.console&&console.log("clearInterval handler 198"),clearInterval(c),p.fileProgress.process({id:t.id,type:"converting",converting:{status:-1,msg:"转码失败:"+e.value}}),t.transcoding=!1,t.transcoded=!1,t.transcodingError=!0;break;case"processing":t.transcoding=!0,window.console&&console.log(" processing 208");if(parseInt(e.value)>=100){window.console&&console.log(" processing >=100 210");return}p.fileProgress.process({id:t.id,type:"converting",converting:{percentage:e.value,status:2,msg:"转码进度:"+e.value+"%"}});break;case"queueing":window.console&&console.log(" queueing 217"),t.transcoding=!0,p.fileProgress.process({id:t.id,type:"converting",converting:{status:0,msg:"等待转码"}});break;default:window.console&&console.log("default break 222")}},error:function(n,r,i){if(n.status===400||n.status===408||n.status===504||n.status===503||n.status===502||n.status===0||r==="parsererror"){a(t,function(){u=!1});return}u=!1,clearInterval(c);var s=new helper.ErrorLog(n.responseText);p.fileProgress.process({id:t.id,type:"converting",converting:{status:-1,msg:"转码失败:"+r+"<em class='js-errorLog' style='color:blue;margin:4px;cursor: pointer;' errorLog='"+s.id+"'>点击查看错误详情</em>"}}),t.transcoding=!1,t.transcoded=!1,t.transcodingError=!0;var o={errorMsg:r+";"+i,description:n.responseText,audioId:t.uuid};$.ajax({type:"POST",url:"/dtres/transcoding/feedback",data:o}),e("error Transcoding",t)}})},1500);t.transcodeTimer=c}function a(e,t){var n=10,r=this,i=setInterval(function(){n--,p.fileProgress.process({id:e.id,type:"converting",converting:{status:-1,msg:"查询进度失败，将在 "+n+"秒后重试"}}),n<=0&&(clearInterval(i),t())},1e3)}function l(e,t,n){var r="";if(this.settings.requeue_on_error&&t!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){var i=this.settings.requeue_on_error_time,s=f[e.id];s&&(window.console&&console.log("clearInterval handler 251"),clearInterval(s),delete f[e.id]);var o=this,u=setInterval(function(){i--,p.fileProgress.process({id:e.id,type:"uploading",uploading:{status:-1,msg:"上传失败，将在 "+i+"秒后重试"}}),i<=0&&(window.console&&console.log("clearInterval handler 259"),clearInterval(u))},1e3);f[e.id]=u}switch(t){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:r="上传出错: "+n,this.debug("Error Code: HTTP Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:r="上传失败.",this.debug("Error Code: Upload Failed, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:r="Server (IO) Error",this.debug("Error Code: IO Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:r="Security Error",this.debug("Error Code: Security Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:r="Upload limit exceeded.",this.debug("Error Code: Upload Limit Exceeded, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:r="Failed Validation.  Upload skipped.",this.debug("Error Code: File Validation Failed, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:this.getStats().files_queued===0,r="Cancelled";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:r="Stopped";break;default:r="Unhandled Error: "+t,this.debug("Error Code: "+t+", File name: "+e.name+", File size: "+e.size+", Message: "+n)}p.fileProgress.process({id:e.id,type:"uploading",uploading:{status:-1,msg:r}})}function c(e){this.getStats().files_queued===0}function h(e){}var f={},p={fileProgress:{},fileQueued:t,fileQueueError:n,fileDialogComplete:r,uploadStart:s,uploadProgress:o,uploadSuccess:u,transcodeError:a,uploadError:l,uploadComplete:c,queueComplete:h,mTotalNum:50,firstSelect:!0};return p}),function(e,t){e.require&&e.define?define("plugin/fileprogress/jquery.xmupload-progress",["jquery"],t):(e.xm.uploader=e.xm.uploader||{},e.xm.uploader.audio=e.xm.uploader.audio||{},e.xm.uploader.jsonp=e.xm.uploader.jsonp||{},e.xm.uploader.jsonp.uploader=e.xm.uploader.jsonp.uploader||{},e.xm.jsonp=e.xm.jsonp||{},e.xm.jsonp.uploader=e.xm.jsonp.uploader||{},e.xm.uploader.fileProgress=t($))}(window,function(e){function r(e){var t={status:1,container:"",isDrag:!0,isPlaySound:!0,isDel:!0,isSaveName:!1,order:"desc",isSingleSort:null};for(var n in e)t[n]=e[n];return t}function i(e){this.options=r(e),this.init()}var t,n;return i.prototype={container:".progressBarContainer",amendNameUrl:"/tracks/update_record_title",fileEls:{},options:{},isSingle:!1,nameMaxLen:80,selector:{order:'[m-name="num"]',titleContainer:".unedit",title:'[m-name="tit"]',nameContainer:".input-container",modiBtn:".edit-btn",modiContainer:".edit",modiInput:".audioName",inputError:".tips",modiSure:".submit-btn",modiCancel:".cancel-btn",fileDel:".del-btn",progressContainer:".upload-status",uploading:".uploading",uploadInfo:".upload-info",converting:".converting",convertingInfo:".upload-info",zStatus:".cur-status",playBtn:".play-btn",fileCount:".upload_file_sum",fileId:".fileid"},init:function(i){var s,o=this;!i||(this.options=r(i)),this.options.container&&(this.container=this.options.container),$pt=e("#progressTemplate"),$pt.length>0?this.templateHTML=$pt.html():this.templateHTML=t,n&&e(this.container).after(n),e(this.container).on("click",".upload-appeal-btn",function(){if(!o.appealDialog)return;var t=[];e(o.container).find(".appeal-item").each(function(){var n=e(this).attr("errormsg");t.push({uploadId:e(this).attr("data-uploadId"),id:e(this).attr("id"),errorinfo:n,name:e(this).find('input[name="files[]"]').val()})}),dialog=o.appealDialog(),dialog.open(t)})},add:function(t){var n=t.file.id,r=t.file.name.replace(t.file.type,""),i=this.selector.order,s=this.selector.title,o=this.selector.modiInput,u=t.isOld,a=e(this.templateHTML),f=t.noDrop;this.uploader=t.uploader,o&&a.find(o).attr("value",this.cutStr(r,this.nameMaxLen)).attr("data-value",this.cutStr(r,this.nameMaxLen)),u&&i&&a.find(i).html(this.count()+1),s&&a.find(s).html(this.shortTitle(r)),this.options.status==1?a.find(".js-warp-converting").remove():this.options.status==2&&a.find(".js-warp-uploading").remove();var l=e("#"+n).attr("data-transcode-state"),c=e("#"+n).attr("data-upload-id"),h=e("#"+n).find(".more-btn").length&&e("#"+n).find(".more-btn")[0],p=e("#"+n).find(".tag-audition").length&&e("#"+n).find(".tag-audition")[0],d=e("#"+n).attr("is-exist"),v=e("#"+n).attr("preplay_id"),m=e("#"+n).find(".del-btn").attr("destroy_id")||"",g=e("#"+n).find(".inputSort").attr("data-record-id")||"",y=e("#"+n).find(".inputSort").attr("data-position")||"",b=e("#"+n).find(".inputSort").attr("data-url")||"",w=e("#"+n).find('[m-name="num"]').text();l==1&&e("#"+n).length>0&&(e("#"+n).empty(),e("#"+n).append(a.html()),e("#"+n).find('[m-name="num"]').text(w)),e("#"+n).length>0?a=e("#"+n):(this.options.order=="desc"?e(this.container).prepend(a):this.options.order=="asc"&&e(this.container).append(a),this.resetOrderNumber(),a.attr("id",n)),d&&a.attr("is-exist",d),a.attr("data-transcode-state",l),a.attr("data-upload-id",c),a.attr("preplay_id",v),a.find(".del-btn").attr("destroy_id",m),a.find(".inputSort").attr("data-record-id",g),a.find(".inputSort").attr("data-position",y),a.find(".inputSort").attr("data-url",b),g&&a.find('input[name="fileids[]"]').val(g),h&&a.find(".del-btn").before(h),p&&a.find('[m-name="num"]').after(p),u?a.find(i).removeClass("new"):a.find(i).addClass("new"),this.fileEls[n]=a,this.fileEls[n].isOld=u,this.fileEls[n].editNameFun=t.editNameFun||null,this.fileEls[n].file=t.file;try{this.options.isDrag&&f!==1&&this.setDrap(n)}catch(E){window.console&&console.log("初始化拖动失败，请检查是否加载拖动模块",E)}this.initBindEvent(n,t.delHandler||this.delCallBack||null);var S=e("#"+n).siblings().length;!this.options.isDel&&e("#"+n).find(".del-btn").remove()},destroy:function(e){this.del(e)},del:function(t,n){function o(){r.options.delCallBack&&r.options.delCallBack(),e("#"+t).animate({height:0},1e3,function(){e("#"+t).remove(),delete r.fileEls[t],r.resetOrderNumber(),s==1&&!i})}var r=this,i=this.fileEls[t].isOld,s=e("#"+t).siblings().length;if(n){n(e("#"+t),o,t,this.fileEls[t].file);return}o()},hideDelBtn:function(){var t=this;e(t.container).find(t.selector.fileDel).css("visibility","hidden")},showDelBtn:function(){var t=this;e(t.container).find(t.selector.fileDel).css("visibility","none")},process:function(t){var n=t.id;type=t.type,doing=t[type],percentage=doing.percentage,status=doing.status,$zStatus=e("#"+n).find(this.selector.zStatus),zStatusText="";if(!this.fileEls[n])return;type=="uploading"?zStatusText=this.uploadProcess(n,doing):type=="converting"&&(zStatusText=this.convertProcess(n,doing));var r=e("#"+n).attr("data-transcode-state");if(this.options.status==2&&r==1){e("#"+n).find(".js-transcode-state").remove(),e("#"+n).find('[m-name="num"]').after(zStatusText);return}this.fileEls[n].isOld?$zStatus.html(""):!!zStatusText&&$zStatus.html(zStatusText)},uploadProcess:function(t,n){var r=e("#"+t).find(this.selector.uploading),i=r.parent().find(this.selector.uploadInfo),s=n.percentage,o="",u="",a=e("#"+t).find(this.selector.progressContainer);return percentageRes=parseInt(s/2),n.status==0&&(u='<span class="sta-waiting">等待上传</span>',o=n.msg||"等待上传",a.slideDown(1e3),s="0"),this.options.status==1&&(percentageRes=s),n.status==1&&(u='<span class="sta-uploading">开始上传</span>',o=n.msg||"开始上传"),n.status==2&&(u='<span class="sta-uploading">正在上传('+percentageRes+"%)</span>",o=n.msg||"上传中.."),n.status==3&&(u='<span class="sta-uploading">正在上传('+percentageRes+"%)</span>",o=n.msg||"上传完成",e("#"+t).find("input.fileid").val(n.data.id),e("#"+t).removeClass("is-error"),this.options.status==1&&(u='<span class="sta-ok">音质达标</span>',e("#"+t).attr("data-status","success"),a.stop().slideUp(1e3))),n.status==-1&&(u="上传失败，请删除",o=n.msg||"上传错误",e("#"+t).addClass("is-error"),n.errorType===800&&(o="上传失败，音质未达标 | 请上传64kbps以上音频",u='<span class="sta-low is-lowquality">音质未达标 | 请上传64kbps以上音频</span>',a.stop().slideUp(1e3),this.errorInfo(e("#"+t),800,o,n.trackId))),!s||r.width(s+"%"),i.html(o),u},convertProcess:function(t,n){var r=n.percentage,i="",s="",o=e("#"+t).find(this.selector.converting),u=o.parent().find(this.selector.convertingInfo),a=e("#"+t).find(this.selector.progressContainer),f=r+"%",l='<span class="sta-ok">音质达标</span>',c="上传失败，请删除",h='<span class="sta-low is-lowquality">音质未达标 | 请上传64kbps以上音频</span>';r&&(s='<span class="sta-uploading">正在上传('+parseInt(r/2+50)+"%)</span>"),this.options.status==2&&(r&&(s='<div class="fr rel js-transcode-state"><span class="tag-status"><i class="ic-transcoding"></i>正在转码</span></div>'),l='<div class="fr rel js-transcode-state"><span class="tag-status"><i class="ic-ok"></i>转码成功</span></div>',c='<div class="fr rel js-transcode-state"><span class="tag-status"><i class="ic-warn"></i>转码失败</span></div>',h='<div class="fr rel js-transcode-state"><span class="tag-status"><i class="ic-warn"></i>音质未达标 | 请上传64kbps以上音频</span></div>'),i=n.msg||(n.status==3?"转码完成":n.status==2?"转码中...":n.status==1?"开始转码":n.status==0?"等待转码":"转码错误"),s=n.status==3?l:n.status==2?s:n.status==1?s:n.status==0?s:c;if(n.status==3){e("#"+t).removeClass("is-error"),a.stop().slideUp(1e3);try{this.options.isPlaySound&&this.createPlay(t,n.data)}catch(p){window.console&&console.log("播放试音加载失败，请检查是否已加载试音模块",p)}}return n.status==-1&&n.errorType=="lowbitrate"&&(a.stop().slideUp(1e3),s=h,this.errorInfo(e("#"+t))),n.status==-1&&e("#"+t).addClass("is-error"),r!=undefined&&o.width(r+"%"),u.html(i),s},lowQuality:function(t){var n=e(this.container),r=n.next(".upload-low-quality").html();t.append(e('<div class="upload-low-quality">'+r+"</div>"))},errorInfo:function(t,n,r,i){var s=e(this.container);t.append(e('<div m-name="tips2"></div>'));var o=s.next(".upload-low-quality").html(),u=o;n==="uploaderror"&&(u='<a href="http://blog.ximalaya.com/%E4%B8%8A%E4%BC%A0%E6%97%B6%E6%98%BE%E7%A4%BA%E4%B8%8A%E4%BC%A0%E5%87%BA%E9%94%99%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" target="_blank" class="upload-hight-quality-techs fr forbid-drag">查看提示</a>'+r+"，请删除这条声音或按照提示操作后重新上传这条声音。");if(n==="pirate"){var a="";t.addClass("appeal-item").attr("errormsg","疑似盗版声音");var f=/test\./.test(window.location.host)?"http://test.ximalaya.com":"http://www.ximalaya.com";i?a='和平台上已有的<a class="forbid-drag" href="'+f+"/#/sound/"+i+'" target="_blank">独家正版声音</a>相似度极高':a="包含盗版内容",u='<a class="upload-appeal-btn fr forbid-drag">我要申诉</a> 您上传的声音'+a+"，暂不能上传。"}n==="irregular"&&(t.addClass("appeal-item").attr("errormsg","疑似违规声音"),u='<a class="upload-appeal-btn fr forbid-drag">我要申诉</a>您上传的声音包含违规内容，暂不能上传。'),t.find('[m-name="tips2"]').hide().html(u)},count:function(){var t=e(this.container),n=t.children(),r=n.size();return r},initBindEvent:function(t,n){var r=this,i=this.selector.modiBtn,s=this.selector.titleContainer,o=this.selector.modiContainer,u=this.selector.title;modiInput=this.selector.modiInput,modiSure=this.selector.modiSure,modiCancel=this.selector.modiCancel,fileDel=this.selector.fileDel,fileContainer="#"+t,inputError=this.selector.inputError,amendNameUrl=this.amendNameUrl,fileidClass=this.selector.fileId,nameContainer=this.selector.nameContainer,sortFun=this.options.isSingleSort;var a=this.fileEls[t].editNameFun;e(fileContainer).find(nameContainer).on("click",i,function(){var n=e("#"+t);n.find(nameContainer).find(s).css("display","none"),n.find(nameContainer).find(o).css("display","block")}),e(fileContainer).find(nameContainer).on("click",modiSure,function(){var n=e("#"+t),i=n.find(modiInput).val(),f=r.checkTitleSync(i);if(f){n.find(inputError).text(f).css("display","block"),n.addClass("is-error");return}n.removeClass("is-error"),n.find(inputError).css("display","none").text(""),a&&a(i);if(!r.options.isSaveName){n.find(nameContainer).find(s).css("display","block"),n.find(nameContainer).find(o).css("display","none"),n.find(nameContainer).find(modiInput).attr("data-value",i),n.find(s).find(u).text(r.shortTitle(i));return}var l=n.find(fileidClass).val();e.ajax({url:amendNameUrl,data:{title:i,record_id:l},type:"POST",success:function(e){if(!e.res){var t=e.msg||"系统提交错误哦";n.find(inputError).text(t).css("display","block"),n.addClass("is-error");return}n.find(s).find(u).text(r.shortTitle(i)),n.removeClass("is-error"),n.find(nameContainer).find(s).css("display","block"),n.find(nameContainer).find(o).css("display","none"),n.find(nameContainer).find(modiInput).attr("data-value",i)},error:function(){var e="系统错误了哦";n.find(inputError).text(e).css("display","block");return}})}),e(fileContainer).find(nameContainer).on("click",modiCancel,function(){var n=e("#"+t),r=n.find(nameContainer).find(modiInput).attr("data-value");n.find(nameContainer).find(modiInput).val(r);var i=n.find(nameContainer).find(inputError);return i.length===0&&(i=n.find(nameContainer).siblings(inputError)),i.css("display","none").text(""),n.find(nameContainer).find(s).css("display","block"),n.find(nameContainer).find(o).css("display","none"),!1}),e(fileContainer).on("click",fileDel,function(){r.del(t,n)});if(typeof sortFun=="function"&&!this.isSingle){var f=e(fileContainer).find(".single-sort").removeClass("hidden");f.find(".edit-sort-btn").on("click",function(){return f.addClass("is-edit"),f.find(".inputSort").focus(),!1}),f.find(".cancel-btn").on("click",function(){return f.removeClass("is-edit"),!1}),f.find(".inputSort").on("keyup",function(t){var n=e(this).val(),r=n.substring(0,n.length-1);n.length>4&&e(this).val(r);var i=/[^\d]/g;n=n.replace(i,"");var s=/^0+/;n=n.replace(s,""),e(this).val(n),n?f.find(".submit-btn").removeClass("disabled"):f.find(".submit-btn").addClass("disabled")}),f.find(".submit-btn").on("click",function(){var e=f.find(".inputSort").attr("data-record-id"),t=f.find(".inputSort").val(),n=f.find(".inputSort").attr("data-url"),r=f.find(".inputSort").attr("data-position");return sortFun({url:n,record_id:e,position:t,old_position:r},function(){}),!1})}},shortTitle:function(e,t){t=t||40;var n=this.cutStr(e,t);return n!=e&&(n+="..."),n},resetOrderNumber:function(t,n){t=this.initNum=t||this.initNum||0,n=this.isDesc=n||this.isDesc||!1;var r=e(this.container),i=r.children(),s=i.size(),o=t+s,u=function(e){var r=n?o-e:e+1+t;return r=r<=0?1:r,r};for(var a=0;a<s;a++)i.eq(a).find(this.selector.order).text(u(a));e("#upload_file_sum").html(s),e(this.selector.fileCount).html("上传声音("+s+")")},checkTitle:function(t){if(e.trim(t)=="")return!1;var n=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return n>80?!1:!0},checkTitleSync:function(t){var n="";if(e.trim(t)=="")return n="";var r=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return r>80?n="标题长度不符合要求,系统要求1-80字节":(e.ajax({type:"post",url:"/center/help/text-check",data:{text:t,strType:1,scene:"create"},async:!1,success:function(e){e.res?n="":n=e.msg}}),n)},cutStr:function(t,n){var r=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return r<=n?t:(t=t.substring(0,t.length-1),arguments.callee(t,n))},titleError:function(t,n){n=n||"标题长度不符合要求,系统要求1-80字节";var r=e(this.container),i=e("#"+t);$info=i.find(this.selector.inputError),i.addClass("is-error"),r.addClass("is-error"),$info.text(n)}},i.setDefaultTemplate=function(e){t=e},i.setLowQuality=function(e){n=e},i.addMethod=function(e,t){typeof e=="string"&&typeof t=="function"&&(i.prototype[e]=t)},i}),function(e,t){if(e.require&&e.define)define("plugin/fileprogress/xmupload-progress-drag",["jquery","plugin/fileprogress/jquery.xmupload-progress"],t);else{var n=e.xm.uploader.fileProgress;t($,n)}}(window,function(e,t){return t.addMethod("setDrap",function(t){function p(t){var n=t.data,r=n.element,i=n.offsetY,s=n.e.clientY,o=e(r),u=o.parent().offset().top,a=s+h.scrollTop()-u+i;window.console&&console.log(a),o.css("top",a),d(n.e,r)}function d(t,n){var r=e(n);r.css({left:0,zIndex:10});var i=r.outerHeight(),o=r.position().top,u=o+i/2,a=s.next();a.attr("id")==r.attr("id")&&(a=a.next());if(a.size()!=0){var f=a.position().top+a.outerHeight()/2;if(u>f){s.insertAfter(a),d(t,n);return}}var l=s.prev();l.attr("id")==r.attr("id")&&(l=l.prev());if(l.size()!=0){var c=l.position().top+l.outerHeight()/2;if(u<c){s.insertBefore(l),d(t,n);return}}}var n=e("#"+t),r=this;if(n.attr("drag_able"))return;n.attr("drag_able",!0);var i=n.parent(),s=e('<li class="albumItem-holder"></li>'),o=e(".drag-icon");o.length==0&&(o=e('<div class="drag-icon" style="display:none;">拖动改变顺序</div>'),e("body").append(o));var u=function(e){o.css({left:e.pageX+20,top:e.pageY-10})},a=n.find(".albumList_r1"),f=e(document);n.bind({mouseover:function(t){var n=e(t.target);!n.hasClass("forbid-drag")&&n.closest(".forbid-drag").size()==0&&(o.show(),f.on("mousemove",u),u(t))},mouseleave:function(){o.hide(),f.off("mousemove",u)},mouseout:function(){o.hide(),f.off("mousemove",u)}});var l=setInterval(function(){n.length===0&&(o.hide(),f.off("mousemove",u),clearInterval(l))},1e3),c=e(window),h=e(document);n.easydrag(!0),n.beforeDrag(function(t,r){var i=e(t.target);if(i.hasClass("forbid-drag")||i.closest(".forbid-drag").size()>0)return!0;var o=e(this);n.after(s);var u=n.height();s.height(u);var a=n.offset().top-t.pageY}),n.ondrag(function(e,t){d(e,t)}),n.ondrop(function(t,n){c.off("scroll",p);var i=e(n);i.insertAfter(s),s.remove(),i.css({position:"relative",left:"",top:"",zIndex:""}),r.resetOrderNumber()})}),!0}),function(e,t){if(e.require&&e.define)define("plugin/fileprogress/xmupload-progress-play",["jquery","module/player/player","plugin/fileprogress/jquery.xmupload-progress"],t);else{var n=e.xm.player||n,r=e.xm.uploader.fileProgress;t($,n,r,!0)}}(window,function(e,t,n,r){function i(t,n,r){var i=this;this.progress=r,this.$container=e("#"+t);if(n&&n.data&&n.data[0]){var s=n.data[0].uploadTrack.id;i.getSoundUrl(s)}else{var o=i.$container.attr("preplay_id");o?(i.$container.attr("sound_id",o),i.cPlayer({sound_id:o},r)):n&&n.sound_id?i.cPlayer({sound_id:n.sound_id},r):i.cPlayer({},r)}}return n.addMethod("createPlay",function(t,n){var r,s=e("#"+t),o=this;new i(t,n,o)}),i.prototype={progress:null,$container:"",cPlayer:function(n){var i=this,s=this.progress,o=this.$container,u="uploadPlayer2",a='<a title="试听" class="play-btn"></a>',f=o.find(".play-wrapper");n||(a="");if(f.find(".play-btn").length>0)return;f.append(a).addClass(u),n&&o.attr(n),r?(f.addClass("btn-player"),t.setup(),e("[sound_id]").xmPlayer()):(f.find(".play-btn").addClass("playBtn").removeClass("play-btn"),t.render({$container:o}))},callback:function(e,t){var n=this,r={sound_extension:!0,sound_url:t,sound_id:"upload_"+e};n.cPlayer(r)},getSoundUrl:function(t){var n=this,r="/dtres/transcode/url";e.ajax({url:r,type:"get",data:{uploadTrackId:t},dataType:"json",success:function(e){n.callback(t,e.url)}})}},!0}),function(e,t){if(e.require&&e.define)define("plugin/fileprogress/xmupload-progress-template",["jquery","plugin/fileprogress/jquery.xmupload-progress"],t);else{var n=e.xm.uploader.fileProgress;t($,n)}}(window,function(e,t){var n;n='<li m-name="item"><div>    <div m-name="num" class="new">${order}</div>    <div m-name="info">        <!--s: 试听按钮  -->        <div class="  play-wrapper forbid-drag "></div>        <!--e: 试听按钮  -->                    <!--s: 删除按钮  -->            <a class="del-btn forbid-drag"></a>          <!--e: 删除按钮  -->                    <div class="single-sort hidden">            <div class="unedit">                <a class="edit-sort-btn forbid-drag" title="更改排序"></a>                  </div>            <div class="edit forbid-drag">                排列至 <input type="text" class="inputSort" maxlength="4"  >位<a class="submit-btn disabled forbid-drag ">确认</a>               <a class="cancel-btn ">取消</a>            </div>        </div>       <div class="cur-status"></div>                <div class="input-container">            <div class=" unedit">                <span m-name="tit" title=""></span><a class="edit-btn forbid-drag"></a>                                                                       </div>            <div class="edit forbid-drag">                <input type="text" value="" name="files[]" class="audioName"><a class="submit-btn ">确认</a><a class="cancel-btn ">取消</a>            </div>        </div>           <span class="tips"></span>        <!--e: 声音名称、编辑  -->    </div></div><div style="display: block;" class="upload-status uploadStatus progressBar">    <div class="progressBar">        <div class="progress">            <div class="warp js-warp-uploading"><span style="width: 0%;" class="uploading"></span><span class="upload-info">上传进度：0M/0M</span></div>            <div class="warp js-warp-converting"><span class="converting" style="width: 0%;"></span><span class="upload-info">等待转码</span></div>        </div>        <div class="progMask"></div>        <input class="fileid" type="hidden" name="fileids[]"/>    </div>    <span class="upload-arrow"><i></i></span></div></li>';var r=[];r.push('<div class="upload-low-quality hidden" >'),r.push('<span class="">主人，请上传≥64kbps码率的音频。<a href="http://blog.ximalaya.com/tigaoyinzhi/" target="_blank" class="upload-hight-quality-techs forbid-drag">如何提高音质</a></span>'),r.push("</div>"),t.setDefaultTemplate(n),t.setLowQuality(r.join(""))}),define("page/upload/record",["jquery","plugin/jrecorder","page/page_base","plugin/dialog","page/upload/handlers_new","plugin/fileprogress/jquery.xmupload-progress","plugin/fileprogress/xmupload-progress-drag","plugin/fileprogress/xmupload-progress-play","plugin/fileprogress/xmupload-progress-template"],function(e,t,n,r,i,s){var o=config.STATIC_PATH+"/cdnswf/jrecord.swf",u=n.extend({init:function(t){this.options=e.extend({upload_url:"",progress_url:"",transcoding_url:"",checkLogin:function(e){e.call(this)},beforeUpload:function(){},uploadSuccess:function(){},transcodingSuccess:function(){}},t),this.initDom(),this.initRecorder(),this.page.start.show(),this.bindEvents(),this.page.start.find(".playPanel").addClass("loadingMore");var n=new s({container:".progress-bar-cont",isDrag:!0,order:"asc"});i.fileProgress=n},initDom:function(){this.$jRecorderWarp=e("#jRecorderWarp"),this.$wave_warp=e("#wave_warp"),this.page={start:e("#record_start"),process:e("#record_process"),end:e("#record_end")},this.btns={recordStart:e("#readyBtn"),recordStop:e("#stopBtn"),playStart:e("#start_play_btn"),playStop:e("#stop_play_btn"),uploadRecord:e("#uploadRe"),cancelRecord:e("#cancelRec")};var t=this;e("#jRecorder").css({left:t.btns.recordStart.offset().left,top:t.btns.recordStart.offset().top,position:"absolute",width:300,height:300})},bindEvents:function(){var t=this;this.btns.recordStart.click(function(){e.jRecorder.record(3600)}),this.btns.recordStop.click(function(){e.jRecorder.stop()}),this.btns.playStart.click(function(){e.jRecorder.playsound()}),this.btns.playStop.click(function(){e.jRecorder.stopsound()}),this.btns.uploadRecord.click(function(){t.options.checkLogin(function(){e.jRecorder.sendData("录音",{token:readCookie(config.TOKEN_LABEL),rememberMe:readCookie(config.REMEMBERME_LABEL)}),e.jRecorder.stopsound()})}),this.btns.cancelRecord.click(function(){var e=r.confirm("是否要放弃这段录音？",function(){window.location.reload()})})},getTime:function(e){e=parseInt(e);var t=parseInt(e/3600),n=parseInt(e%3600/60),r=parseInt(e%3600%60),i=function(e){return e<10&&(e="0"+e),""+e};return i(t)+":"+i(n)+":"+i(r)},initRecorder:function(){var t=this,n=0,s=this.$wave_warp,u=s.width(),a=e("#playBar").find(".progBar");e.jRecorder({host:t.options.upload_url,rec_left:"",progress_url:t.options.progress_url,filesSelected:{singleFile:!0},callback_started_recording:function(){n=0,t.page.process.show(),t.page.start.hide(),s.html("")},callback_stopped_recording:function(e){t.page.end.find("#recordFinishTime").html(t.getTime(e)),t.page.process.hide(),t.page.end.show()},callback_activityLevel:function(e){e<=5&&(e=5);if(n%2==0){s.append("<div class='t"+(20-Math.floor(e/5))+"'></div>");var t=s.children();t.length>u&&t.eq(0).remove()}n+=1},callback_flash_loaded:function(){t.page.start.find(".playPanel").removeClass("loadingMore")},callback_activityTime:function(e){e=parseInt(e),e>=600&&(t.btns.recordStop.trigger("click"),r.alert("您录音时间超过了10分钟！")),t.page.process.find("#recordTime").html(t.getTime(e))},callback_error_loaded:function(){r.alert("录音设备不可用"),t.page.start.find(".playPanel").removeClass("loadingMore")},callback_error_recording:function(e){r.alert("recording error ; code:"+e)},callback_finished_sending:function(e,n){this.getStats().successful_uploads=1,this.getStats().files_queued=0,e=t.options.uploadSuccess(e,n),i.uploadSuccess.call(this,e,n)},callback_before_sending:function(e){this.getStats().files_queued=1,i.uploadStart.call(this,e),t.options.beforeUpload(e),t.page.end.hide()},callback_file_progress:i.uploadProgress,upload_error_handler:function(t,n,r){i.uploadError.call(this,t,n,r),setTimeout(function(){e.jRecorder.sendData()},this.settings.requeue_on_error_time*1e3)},callback_file_upload_error:function(e,t,n){this.upload_error_handler(e,t,n)},callback_started_preview:function(e,n){t.btns.playStart.hide(),t.btns.playStop.show(),this.stoped=!1,e==0&&a.stop().css("width","0%"),this.callback_playing_time(e,n)},callback_playing_time:function(e,t){t<=0&&(t=1);if(e==t){if(!this.stop)return;a.stop().width("100%")}else e++;var n=this;a.stop().animate({width:e/t*100+"%"},1e3,"linear",function(){n.stoped&&a.stop().css("width",0)})},callback_playing_finish:function(e){e<=0&&(e=1),this.callback_playing_time(e,e),t.btns.playStart.show(),t.btns.playStart.hide()},callback_playing_stop:function(e){this.stoped=!0,a.stop().css("width",0),t.btns.playStart.show(),t.btns.playStop.hide()},callback_pause_sound:function(e,t){},callback_flash_show:function(){e("#jRecorder").css({left:t.btns.recordStart.offset().left,top:t.btns.recordStart.offset().top,zIndex:10})},callback_flash_hide:function(){e("#jRecorder").css({left:-300,top:-300})},swf_path:o,custom_settings:{progressTarget:"progressBarContainer",cancelButtonId:"btnCancel1"},getStats:function(){return this.stats},stats:{files_queued:0,in_progress:0,queue_errors:0,successful_uploads:0,upload_cancelled:0,upload_errors:0},settings:{requeue_on_error:!0,requeue_on_error_time:20,transcoding_url:t.options.transcoding_url,transcoding_success:function(){t.options.transcodingSuccess()}}},t.$jRecorderWarp)},release:function(){this.callParent("release")}});return new u}),define("page/upload/add_sign",["jquery","plugin/dialog"],function(e,t){var n=function(){var e=this,t='<h2 class="txt-lg tc row c05">	认证主播服务升级啦！</h2>	<div class="cont txt-mid1 row">亲爱哒主播，喜马拉雅主播V认证服务升级啦，同意协议将有机会获得一定的增值服务和收益，特权多多等你来哦</div><div class="tc row txt-mid2">    <label class="xm-checkbox addsign-agree" >        <input type="checkbox" name="addsign-agree">我已阅读并同意    </label>    《<a href="/verify/agreement" target="_blank">喜马拉雅认证主播服务协议</a>》</div><div class="tc row">    <a href="#" class="btn btn-primary btn-mid4 disabled addsign-btn" dialog-role="yes" >好的，非常期待</a>								</div>';t=t.replace(/\$\{([^}]*)\}/g,function(t,n){for(var r in e.curData)if(n==r)return e.curData[r]||""}),this.op={dialogClass:"pop-addv-upgrade",template:{dialog_close:"",dialog_header:'<div class=" " dialog-role="header"></div>',dialog_body:'<div class="bd1" dialog-role="body"></div>'},header:'<a href="#" class="btn1 btn-close" dialog-role="close"><i class="icon-8 icon8-cha1"></i></a>',content:t,fixed:!1,overlayer:{clickClose:!1},onClose:function(){!this.isAgress&&e.sureHandler("disagree")},onYes:function(){return this.isAgress=!0,e.sureHandler("agree"),!1}}};return n.prototype={open:function(){var e=this,n=this.op,r=new t.Dialog(n);r.open(),this.pop=r,this.$el=r.getEl(),this.$el.find(".addsign-agree").on("change",function(){e.$el.find(".addsign-btn").toggleClass("disabled")})},sureHandler:function(n){var r=this;e.ajax({url:"/upload/update_anchor_protocal_status",data:{status:n},type:"POST",success:function(e){e.res?r.pop.close():t.alert("系统错误了！")}}).fail(function(){t.alert("系统错误了！")})},cancelHandler:function(){}},new n}),function(e,t){e.require&&e.define?define("plugin/uploader/transcode",["jquery"],t):e.xm.Transcode=t($)}(window,function(e){var t=function(e,t,n,r,i){this.upload=e,this.data=n,this.elId=n.fileId,this.trackId=n.trackId,this.transcoding_url=t,this.soundProgress=n.soundProgress,this.before(r),this.successAfter=i};return t.prototype.before=function(e){return e&&e(),this.soundProgress.process({id:this.elId,type:"converting",converting:{status:0,msg:"等待转码"}}),this},t.prototype.coding=function(){var t=this,n=this.transcoding_url;t.isAjaxing=!1;var r=setInterval(function(){url=n.replace("{id}",t.trackId).replace("{timestamp}",(new Date).getTime());if(t.isAjaxing)return;t.isAjaxing=!0,e.ajax({type:"GET",url:url,dataType:"json",success:function(e,n,i){t.isAjaxing=!1;if(!t.timer)return;e.duration&&(t.duration=e.duration),e.lowbitrate&&(e.state="lowbitrate");switch(e.state){case"success":t.trigger("transSuccess");break;case"lowbitrate":t.trigger("transError",e);break;case"error":t.trigger("transError",e);break;case"processing":t.transcoding=!0;if(parseInt(e.value)>=100)return;t.soundProgress.process({id:t.elId,type:"converting",converting:{percentage:e.value,status:2,msg:"转码进度:"+e.value+"%"}});break;case"queueing":t.transcoding=!0,t.soundProgress.process({id:t.elId,type:"converting",converting:{status:0,msg:"等待转码"}});break;case"unkown":clearInterval(r);break;default:window.console&&console.log("default break ")}},error:function(e,n,r){t.trigger("transError",null,e,n,r)}})},1500);this.timer=r},t.prototype.transSuccess=function(){return clearInterval(this.timer),this.transcoding=!1,this.transcoded=!0,this.transcodingError=!1,this.soundProgress.process({id:this.elId,type:"converting",converting:{percentage:100,status:3,msg:"转码完成",data:this.serverData}}),this.upload&&this.upload.trigger("transSuccess",{id:this.elId}),this.successAfter&&this.successAfter({id:this.elId}),this},t.prototype.transError=function(e,t,n,r){window.console&&console.log("transError:",n,r);var i=this;i.transcoding=!1,i.transcoded=!1,i.transcodingError=!0;if(!!e&&!t){clearInterval(this.timer),this.soundProgress.process({id:i.elId,type:"converting",converting:{status:-1,errorType:e.state==="lowbitrate"?e.state:"",msg:"转码失败:"+e.value}});return}if(t.status===400||t.status===408||t.status===504||t.status===503||t.status===502||t.status===0||n==="parsererror"){var s=10;window.console&&console.log("jqXHR.status:"+t.status);var i=this,o=setInterval(function(){s--,i.soundProgress.process({id:i.elId,type:"converting",converting:{status:-1,msg:"查询进度失败，将在 "+s+"秒后重试"}}),s<=0&&(clearInterval(o),i.isAjaxing=!1)},1e3);i.isAjaxing=!1,clearInterval(i.timer),this.soundProgress.process({id:i.elId,type:"converting",converting:{status:-1,msg:"转码失败:"+n+"<em class='js-errorLog' style='color:blue;margin:4px;cursor: pointer;' errorLog='0'>点击查看错误详情</em>"}});return}},t.prototype.cancel=function(){this.timer&&clearInterval(this.timer),window.console&&console.log("transCancel")},t.prototype.trigger=function(){var e=arguments[0],t=[];for(var n=1;n<arguments.length;n++)t.push(arguments[n]);e&&typeof e=="string"&&this[e].apply(this,t)},t}),define("plugin/browserDetect",[],function(){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!=-1)return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t==-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),e}),function(e,t){if(e.require&&e.define)define("plugin/fileprogress/xmupload-appeal",["jquery","plugin/dialog","plugin/fileprogress/jquery.xmupload-progress","plugin/uploader/xmupload"],t);else{var n=config.STATIC_PATH+"/lib/xmuploader/0.1.0/uploader.swf",r=e.xm.uploader.fileProgress,i=e.xm.uploader.base,s=e.xm.dialog||s;t($,s,r,i,n)}}(window,function(e,t,n,r,i){function s(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}return n.addMethod("appealDialog",function(){var n=this;return{open:function(e){this.listData=e,this.createPop()},initUpload:function(t){var n={accept:{title:"Images",extensions:"PNG,GIF,BMP,JEPG,JPG",mimeTypes:".PNG,.GIF,.BMP,.JEPG,.JPG"},duplicate:!1,btnEl:".xmupload-image",swfUrl:typeof i=="string"&&i||config.STATIC_PATH+"/cdnswf/uploader.swf",fileLimit:1,singleSizeLimit:52428800,allSizeLimit:null,server:config.UPLOAD_ROOT+"/picture/upload"};n.pick={id:t},n.handlers={uploadBeforeSend:function(e,t){var n=e.file.retryUrl||config.UPLOAD_ROOT+"/picture/upload",r="";n.indexOf("?")!=-1?r=n.substr(0,n.indexOf("?"))+"?&fileSize="+t.size:r=n+"?fileSize="+t.size,this.options.server=r,this.options.server+="&token="+(s(config.TOKEN_LABEL)||""),s(config.REMEMBERME_LABEL)&&(this.options.server+="&rememberMe="+s(config.REMEMBERME_LABEL))},uploadStart:function(t){e(this.options.pick.id+"-list").find(".up-img").removeClass("c01"),e(this.options.pick.id+"-list").find(".up-img").text("正在上传...")},uploadError:function(t,n){e(this.options.pick.id+"-list").find(".up-img").text("上传失败，请重试").addClass("c01"),this.reset()},uploadSuccess:function(t,n){!n.status||n.ret!=0?e(this.options.pick.id+"-list").find(".up-img").text("上传失败，请重试").addClass("c01"):(e(this.options.pick.id+"-list").find(".up-img").text(t.name),e("#"+e(this.options.pick.id).attr("input-name")).val(n.data[0].dfsId),e(".piracy-submit").removeClass("disabled")),this.reset()},error:function(e,t){}};var o=r(n)},createPop:function(){var n=this,r=this.listData,i="",s=!1;for(var o=0;o<r.length;o++){var u=r[o].name,a=r[o].id,f=r[o].uploadId,l=r[o].errorinfo;i+='<li m-name="item" data-fileId="'+a+'" data-uploadId="'+f+'" error-info="'+l+'"><div m-name="info">'+'        <a class="del-btn" ></a><div class="cur-status"><span class="sta-low">'+l+"</span></div>"+'        <div class="input-contianer"><span m-name="tit">'+u+"</span></div>"+"</div></li>",/盗版/.test(l)&&(s=!0)}var c='<div class="sound-list">        <ul class="progress-bar-cont">'+i+"</ul>"+"</div>  "+'<div class="piracy hidden"><div class="mgtb-20">'+"    疑似盗版申诉必须上传该声音所属专辑的知识产权证明文件，至少上传一个"+"</div>"+'<div class="up-info">'+' <input type="hidden" name="copyrightRegisteration" id="copyrightRegisteration" >'+' <input type="hidden" name="debutDeclaration" id="debutDeclaration" >'+' <input type="hidden" name="authorizePaper" id="authorizePaper" >'+'    <p class="mgtb-20 uploadimg1-list">'+'        <span class="fl">'+"             著作权登记证："+"        </span>"+'        <span class="up-img"></span>'+'        <a href="javascript:;" class="btn btn-secondary btn-upload uploadimg1" input-name="copyrightRegisteration">上传</a>'+"    </p>"+'    <p class="mgtb-20 uploadimg2-list">'+'        <span class="fl">'+"             首次发表证明："+"        </span>"+'        <span class="up-img"></span>'+'        <a href="javascript:;" class="btn btn-secondary btn-upload uploadimg2" input-name="debutDeclaration">上传</a>'+"    </p>"+'    <p class="mgtb-20 uploadimg3-list">'+'        <span class="fl">'+"             授权文件："+"        </span>"+'        <span class="up-img"></span>'+'        <a href="javascript:;" class="btn btn-secondary btn-upload uploadimg3" input-name="authorizePaper">上传</a>'+"    </p>                        "+"</div></div>"+'<p class="bottom mgtb-10">'+'    <a href="javascript:;" class="btn btn-primary piracy-submit '+(s?"disabled":"")+'" dialog-role="yes">提交申诉</a>'+'    <a href="javascript:;" class="btn btn-secondary" dialog-role="cancel">取消</a>'+"</p>",h={template:{dialog_close:"",dialog_header:'<div m-name="hd" dialog-role="header"></div>',dialog_body:'<div class="bd" m-name="bd" dialog-role="body"></div>'},dialogClass:"pop-sound-appeal",header:'<button m-name="btn-close" dialog-role="close">×</button>申诉',fixed:!1,content:c,noheadDrop:!0,overlayer:{clickClose:!1},onYes:function(){if(e(".piracy-submit").hasClass("disabled"))return;var r=[],i=[],s="",o="",u="";n.$el.find('li[m-name="item"]').each(function(){r.push(e(this).attr("data-fileId")),i.push(e(this).attr("data-uploadId"))});var a={fileIds:i.join(",")};return n.$el.find(".piracy").hasClass("hidden")||(a.copyrightRegisteration=e("#copyrightRegisteration").val()||"",a.debutDeclaration=e("#debutDeclaration").val()||"",a.authorizePaper=e("#authorizePaper").val()||""),e(".piracy-submit").text("提交中..."),e(".piracy-submit").addClass("disabled"),e.ajax({url:"/dtres/appeal/submit",type:"get",data:a,dataType:"json",success:function(i){if(i.ret!==0)t.alert("系统出错了！");else{for(var s=0;s<r.length;s++)e("#"+r[s]).addClass("is-quiesce-del").find(".del-btn").click();n.pop.close()}},error:function(){t.alert("系统出错了！")}}).done(function(t){e(".piracy-submit").removeClass("disabled"),e(".piracy-submit").text("提交申诉")}),!1}},p=new t.Dialog(h);p.open(),this.$cform=e(".js-createalbum-form"),$el=p.getEl(),this.$el=$el,this.pop=p,s&&$el.find(".piracy").removeClass("hidden"),this.initUpload(".uploadimg1"),this.initUpload(".uploadimg2"),this.initUpload(".uploadimg3"),this.bindEvents($el)},bindEvents:function(t){var n=this;t.find(".del-btn").on("click",function(){if(t.find(".progress-bar-cont li").length==1)n.pop.close();else{e(this).parents("li").remove();var r=!1;t.find(".progress-bar-cont li").each(function(){var t=e(this).attr("error-info");/盗版/.test(t)&&(r=!0)}),r||(t.find(".piracy").addClass("hidden"),e(".piracy-submit").removeClass("disabled"))}})}}}),!0}),function(e){typeof define=="function"&&define.amd?define("plugin/jquery.xdomainrequest.min",["jquery"],e):typeof exports=="object"?module.exports=e(require("jquery")):e(jQuery)}(function(e){if(e.support.cors||!e.ajaxTransport||!window.XDomainRequest)return;var t=/^https?:\/\//i,n=/^get|post$/i,r=new RegExp("^"+location.protocol,"i");e.ajaxTransport("* text html xml json",function(i,s,u){if(!i.crossDomain||!i.async||!n.test(i.type)||!t.test(i.url)||!r.test(i.url))return;var a=null;return{send:function(t,n){var r="",o=(s.dataType||"").toLowerCase();a=new XDomainRequest,/^\d+$/.test(s.timeout)&&(a.timeout=s.timeout),a.ontimeout=function(){n(500,"timeout")},a.onload=function(){var t="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,r={code:200,message:"success"},i={text:a.responseText};try{if(o==="html"||/text\/html/i.test(a.contentType))i.html=a.responseText;else if(o==="json"||o!=="text"&&/\/json/i.test(a.contentType))try{i.json=e.parseJSON(a.responseText)}catch(s){r.code=500,r.message="parseerror"}else if(o==="xml"||o!=="text"&&/\/xml/i.test(a.contentType)){var u=new ActiveXObject("Microsoft.XMLDOM");u.async=!1;try{u.loadXML(a.responseText)}catch(s){u=undefined}if(!u||!u.documentElement||u.getElementsByTagName("parsererror").length)throw r.code=500,r.message="parseerror","Invalid XML: "+a.responseText;i.xml=u}}catch(f){throw f}finally{n(r.code,r.message,i,t)}},a.onprogress=function(){},a.onerror=function(){n(500,"error",{text:a.responseText})},s.data&&(r=e.type(s.data)==="string"?s.data:e.param(s.data)),a.open(i.type,i.url),a.send(r)},abort:function(){a&&a.abort()}}})}),function(e,t){if(e.require&&e.define)define("plugin/uploader/xmupload-audio",["jquery","plugin/dialog","plugin/uploader/xmupload","plugin/fileprogress/jquery.xmupload-progress","plugin/uploader/transcode","plugin/browserDetect","plugin/fileprogress/xmupload-progress-drag","plugin/fileprogress/xmupload-progress-play","plugin/fileprogress/xmupload-appeal","plugin/fileprogress/xmupload-progress-template","plugin/jquery.xdomainrequest.min"],t);else{var n=e.xm.uploader.fileProgress,r=e.xm.uploader.base,i=e.xm.Transcode,s=e.xm.BrowserDetect,o=config.STATIC_PATH+"/lib/xmuploader/0.1.0/uploader.swf",u=e.xm.dialog||u,a=!1;$("link").each(function(){var e=$(this).attr("href");/.*\/upload\.css$/.test(e)&&(a=!0)}),a||$('<link href="'+config.STATIC_PATH+'/lib/xmuploader/0.1.0/css/upload.css" rel="stylesheet" type="text/css">').insertAfter("link:last"),$.dtres="dtres",e.xm.uploader.audio=t($,u,r,n,i,s,o)}}(window,function(e,t,n,r,i,s,o){function c(){return window.ActiveXObject?!0:!1}function p(e){this.id=++p.logIndex,this.text=e,p.logs[this.id]=this}function d(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return encodeURIComponent(i.substring(t.length,i.length));if(i.indexOf(t)!=-1)return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}return null}function g(){return e(".sound-list .input-container .submit-btn ").each(function(){e(this).click()}),e(".sound-list li[class*='is-error']").length>0?!1:!0}var u=window.location.protocol,a=function(){return/test\.ximalaya/.test(window.location.href)?u+"//upload.test.ximalaya.com":u+"//upload.ximalaya.com"}(),f=window.WebUploader.Uploader,l=window.WebUploader.Base,h=0;p.logs={},p.logIndex=0,p.getLogText=function(e){return p.logs[e].text};var v={pick:{id:".xmupload-audio"},auto:!0,chunked:!0,chunkSize:1048576,sendAsBinary:!0,chunkRetry:3,swf:typeof o=="string"&&o||config.STATIC_PATH+"/cdnswf/uploader.swf?v="+(new Date).getTime(),accept:{title:"Voice",extensions:"AIFF,AIF,MP4,3GP,AVI,WMV,MPG,VOB,FLV,MOV,RMVB,RM,MPEG,MP3,WMA,WAV,FLAC,OGG,MP2,AAC,AMR,M4A",mimeTypes:".AIFF,.AIF,.MP4,.3GP,.AVI,.WMV,.MPG,.VOB,.FLV,.MOV,.RMVB,.RM,.MPEG,.MP3,.WMA,.WAV,.FLAC,.OGG,.MP2,.AAC,.AMR,.M4A"},server:a+"/clamper-server/mkblk",transcoding_url:"/dtres/zhuanma/{id}/jindu/{timestamp}",threads:1,backUploadPath:"",disableGlobalDnd:!0,duplicate:!1,fileNumLimit:50,fileSingleSizeLimit:209715200,callerSource:""},m=function(n){var r=this,i=r.options.uploadType==="video"?"视频":"声音",s=function(n,s,o,u){var a=function(){r.customDel&&r.customDel(n,o,u);try{r&&(r.removeFile(u.id,!0),u.trans.trigger("cancel"))}catch(t){window.console&&console.log(t)}return s&&s(),e("#"+u.id).is(".is-playing")&&e("#"+u.id).find(".btn-player").click(),e(".editAlbum").addClass("go-upload"),e(".editAlbum").length&&r.singleFile&&(r.trigger("flushFileNumLimit",1),e(".editAlbum").removeAttr("style").removeClass("xmuploader-element-invisible")),r.singleFile&&e("#sound_title").val(""),!0};if(!t&&confirm("是否要删除这个"+i+"？")){a();return}e("#"+u.id).hasClass("is-quiesce-del")?a():t.confirm("是否要删除这个"+i+"？",a)},o=function(t){r.singleFile&&e("#sound_title").val(t)};n.title=n.name.replace("."+n.ext,function(e){return n.type=e,""});var u={file:n,delHandler:s,editNameFun:o,uploader:r};r.singleFile&&(u.noDrop=1,o(n.title)),this.soundProgress.add(u)};v.handlers={fileQueued:function(e){m.call(this,e),this.soundProgress.process({id:e.id,type:"uploading",uploading:{status:0}})},fileDialogComplete:function(t){this.firstSelect=++h===1?!0:!1;var n=e("#isalbum"),r=e("#multiFile"),i=e("#singleFile"),s=e("#voice_info_title");this.firstSelect&&t.length==1?(this.singleFile=!0,n.val("false"),e(".editAlbum").addClass("xmuploader-element-invisible")):n.val("true"),this.options.fileNumLimit==1&&t.length==1&&e(".editAlbum").addClass("xmuploader-element-invisible"),i.hide(),r.show(),s.html("专辑信息"),e(".dv-phone").removeClass("dv-phone").addClass("album-phone-tip").empty()},uploadStart:function(e){this.soundProgress.process({id:e.id,type:"uploading",uploading:{status:1}})},uploadProgress:function(e,t){var n=Math.ceil(t*100),r=e.size,i=r*t;e.loadedsize=Math.floor(i*10/1024)/10;var s=Math.floor(i*10/1048576)/10+"M",r=Math.floor(r*10/1048576)/10+"M";this.soundProgress.process({id:e.id,type:"uploading",uploading:{percentage:n,status:2,msg:"上传进度:"+s+"/"+r}})},retryWaitCount:function(e,t){this.soundProgress.process({id:e.id,type:"uploading",uploading:{status:-1,msg:"上传失败，将在 "+t+"秒后重试"}})},uploadError:function(e,t,n){console.log("test reason"),console.log(t);var r=this,i="上传失败"+(typeof t=="object"?"":","+t),s=t.status;if(s===400||s===598||s===599)i=t.msg;e.endtime=(new Date).getTime();var o=Math.floor(e.loadedsize*100/((e.endtime-e.starttime)/1e3))/100;if(o<=10)i="上传失败,网络太慢 ,上传平均网速为:"+o+"KB/s";else if(t==="abort"||t=="timeout"||t=="server")i="上传失败,网络异常 ";this.soundProgress.process({id:e.id,type:"uploading",uploading:{status:-1,errorType:"uploaderror",msg:i}}),this.trigger("sendLog",[{errorMsg:e.name+"上传失败, 失败msg为'"+i+"'",httpstatus:t.status}])},sendLog:function(t){var n=""+s.browser+" "+s.version,r={events:[]};for(var i=0;i<t.length;i++){var o=e.extend({projectName:config.projectName||"喜马拉雅web主站",errorType:"upload_error",moduleName:"xmuploader",moduleVersion:"0.1.0",browserVersion:n,userId:current_user.uid||"未登录",currUlr:window.location.href,osType:s.OS},t[i]);r.events[i]={viewId:"xmuploader",props:o,ts:(new Date).getTime()}}var u=/test\.ximalaya\.com/.test(window.location.href)?"//xdcs-collector.test.ximalaya.com":"//xdcs-collector.ximalaya.com";e.ajax({url:u+"/api/v1/lowVersionFrontEnd",type:"POST",data:JSON.stringify(r),contentType:"text/plain",success:function(e){window.console&&console.log("send log success")}})},uploadSuccess:function(e,t){var n="",r="";t.ret==50&&(n="-1",r="上传失败,请重新登录");var i="uploadError";t.msg.indexOf("音质不达标")!==-1&&(i=800);if(t.ret===-1){this.soundProgress.process({id:e.id,type:"uploading",uploading:{status:"-1",errorType:i,msg:t.msg||"上传失败",trackId:t.trackId||0,uploadId:t.fileId||0}});return}e.uploadSuccess=!0,e.transcoding=!1,e.transcoded=!1,e.transcodingError=!1,e.uuid=t.callbackData&&t.callbackData.fileId;if(e.retryRecord&&e.retryRecord.count>=1){e.endtime=(new Date).getTime();var s=Math.floor(e.loadedsize*100/((e.endtime-e.starttime)/1e3))/100;this.trigger("sendLog",[{errorMsg:", 文件名为："+e.name+",经"+e.retryRecord.count+"次上传重试后，上传成功,上传的平均网速为:"+s+"KB/s",httpstatus:200}])}this.soundProgress.process({id:e.id,type:"uploading",uploading:{percentage:100,status:3,msg:"上传完成",data:{id:e.uuid}}}),this.trigger("success",e,t)},transStart:function(e,t){var n=this;if(!this.options.transcoding_url)return;e.trans=new i(this,this.options.transcoding_url,{trackId:e.uuid,fileId:e.id,serverData:t,soundProgress:this.soundProgress}),e.trans.coding()},error:function(e,n){var r="";if(e==="Q_EXCEED_NUM_LIMIT"){var i=arguments[1],s=this.options.fileNumLimit-i,o=""+(s===0?"你已经达到了上传限制。":"亲，您已经上传了"+i+"个文件，本次还可上传 "+s+"个文件");t.alert(o);return}switch(e){case"Q_EXCEED_SIZE_LIMIT":n=arguments[2],r="文件太大.";break;case"Q_TYPE_DENIED":r="未定义的文件类型.";break;case"F_EXCEED_SIZE":n=arguments[2],r="文件太大.";break;case"ZERO_BYTE_FILE":r="不能上传空文件.";break;default:}if(r==="")return;m.call(this,n),this.soundProgress.process({id:n.id,type:"uploading",uploading:{status:"-1",msg:r}})}};var y={audio:{title:"Voice",extensions:"AIFF,AIF,MP4,3GP,AVI,WMV,MPG,VOB,FLV,MOV,RMVB,RM,MPEG,MP3,WMA,WAV,FLAC,OGG,MP2,AAC,AMR,M4A",mimeTypes:".AIFF,.AIF,.MP4,.3GP,.AVI,.WMV,.MPG,.VOB,.FLV,.MOV,.RMVB,.RM,.MPEG,.MP3,.WMA,.WAV,.FLAC,.OGG,.MP2,.AAC,.AMR,.M4A"},video:{title:"video",extensions:"MP4,3GP,AVI,WMV,MPG,VOB,FLV,MOV,RMVB,RM,MPEG,WMA,WAV",mimeTypes:".MP4,.3GP,.AVI,.WMV,.MPG,.VOB,.FLV,.MOV,.RMVB,.RM,.MPEG,.WMA,.WAV"}};return upload_audio=function(t){h=0,c()&&(t.runtimeOrder="flash"),v.accept=y[t.uploadType],t.uploadType==="video"&&(v.fileSingleSizeLimit=2147483648),t=e.extend(v||{},t);var i=t.progressOptions||null;t.progressOptions&&delete t.progressOptions,t.uid=current_user.uid,i.status=1;var s=new r(i),o=n(t);return o.soundProgress=s,o.checkTitle=g,o.customDel=t.customDel,o.mTotalNum=t.fileNumLimit?t.fileNumLimit:50,o}}),define("module/dialogs/originalStatement",["jquery","plugin/dialog","plugin/jquery.input"],function(e,t){var n={pop:function(e,n){var r=this,i=this._template(),s={template:{dialog_close:"",dialog_header:"",dialog_body:'<div class="original-wrapper " dialog-role="body"></div>'},dialogClass:"pop-original ",header:"",fixed:!1,content:i,noheadDrop:!0,onClose:function(){r.isCancal&&n&&n()}},o=new t.Dialog(s);this._pop=o,o.open();var u=o.getEl();return this.isCancal=!0,this._bindEvent(u,e),this.$saveBtn=u.find(".js-originalSt-savebtn"),this},_bindEvent:function(e,t){var n=this;e.find("#agreeSt").beautify().on("change",function(){e.find(".js-originalSt-savebtn").toggleClass("disabled")}),e.find(".js-originalSt-savebtn").on("click",function(){n.isCancal=!1,t&&t(),n._pop.close()})},_template:function(){var e='<div class="closeBtn original-closeBtn" dialog-role="close"></div><div class="pop-original-body">	<h3 class="title">原创声明</h3>	<p class="original-content">您承诺并保证，您在喜马拉雅网（www.ximalaya.com）及“喜马拉雅FM”移动客户端以各种形式发布的信息，均符合《中华人民共和国著作权法》、《中华人民共和国商标法》、《中华人民共和国反不正当竞争法》、《中华人民共和国侵权责任法》、《中华人民共和国广告法》、《中华人民共和国计算机信息系统安全保护条例》、《计算机软件保护条例》及《信息网络传播权保护条例》等有关法律、法规、规章的规定。</p>	<p class="original-content">您承诺并保证，您在喜马拉雅网（www.ximalaya.com）及“喜马拉雅FM”移动客户端以各种形式发布的信息，均符合社会公序良俗。</p>	<p class="original-content">您承诺并保证，您在喜马拉雅网（www.ximalaya.com）及“喜马拉雅FM”移动客户端上传的文字、图片、视频、音频、多媒体资料或其他内容均拥有相应合法的权利。这些文字、图片、视频、音频、多媒体资料或其他内容，不侵犯任何第三方的肖像权、名誉权、著作权、商标权等任何权利，不违反您与任何第三方所签订的任何法律文件的规定。</p>	<p class="original-content important-tit">如上传盗版内容，将会导致下架、封号、索赔，甚至被追究刑事责任。</p>	<div class="agreen">		<label class="xm-checkbox">            <input type="checkbox" name="agreeSt" id="agreeSt" value="1">            <span class="agreen-tit">我已阅读并同意</span>        </label>    </div>    <div class="btn-wrap">        <a class="btn btn-primary disabled js-originalSt-savebtn" xmlog-spg="上传声音页" xmlog-mod="确认发布" xmlog-fun="trackRelease" style="">确认发布</a>        <a class="btn btn-secondary btn-back" dialog-role="close">返回</a>    </div></div>';return e}};return n}),define("module/tips",["jquery"],function(e){var t={callTips:function(t,n,r){function i(){var i=e("<div class='tips-module'>"+n+"</div>");i.css("width",r+"px"),i.css("left",t.width()/2-r/2+"px"),t.append(i)}function s(){t.find(".tips-module").remove()}t.css("position","relative"),t.bind("mouseenter",function(){i()}),t.bind("mouseleave",function(){s()})}};return t}),define("page/upload/upload_index",["require","jquery","page/page_base","helper","page/upload/form_check","plugin/jrecorder","plugin/dialog","page/upload/record","module/dialogs/login_box","module/dialogs/create_album","module/albumslist","page/upload/add_sign","plugin/uploader/xmupload-audio","module/dialogs/soundpreview","module/dialogs/originalStatement","plugin/EventEmiter","module/cropper-photo","module/tips"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function X(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i.uuid==t)return i}return!1}function V(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i.id==t)return i}return!1}function $(){w=!0}function J(e){return y.check()?(y.holdSubmit(K,e),!0):!1}function K(){var e=t("#infoErr");e.html("").css({color:"red"});var n=t(".progress-bar-cont").children();if(n.size()>L)return e.html("一次只能上传"+L+"个节目，请删掉多余的后重试"),!1;D=B[I].getFiles();var r=[],i=D.length;t(".progress-bar-cont li ").each(function(){t(this).find(".editConfirm").trigger("click")});var s=t(".progress-bar-cont .is-error");if(s.length>0)return s.find("audioName").focus(),s.hasClass(".is-lowquality")?t("#infoErr").text("音质未达标 | 请上传64kbps以上音频"):s.hasClass("appeal-item")?t("#infoErr").text("喵~，疑似违规节目或疑似盗版节目不能提交哦"):t("#infoErr").text("请先删除上传失败的文件。"),y.unHoldSubmit(),!1;for(var o=0;o<i;o++){var u=D[o],a=t("#"+u.id),f=a.attr("data-status");if(f!="success")return y.setHoldTip(),!1}return!0}function Q(e,t){return r.gblen(e)<=t}var y,b,w,E=config.UPLOAD_ROOT+"/audio/upload",S=config.DIRECT_DTRES_ROOT+"/cover/upload",x="/dtres/progress",T="/dtres/zhuanma/{id}/jindu/{timestamp}",N="/passport/check_me",C,k=50,L=50,A=40,O="200 MB",M=209715200,D=[],P={singleFile:!0},H=t.extend({},v);j&&!j.anchor_protocol_status&&current_user&&current_user.isVerified?c.open():j&&!j.verify_mobile&&current_user&&current_user.isVerified;var B={},j,F,I,q=function(e){xmLog&&xmLog("pv.send","event",{serviceId:e.attr("xmlog-svId"),srcPage:e.attr("xmlog-spg"),srcModule:e.attr("xmlog-mod"),item:e.attr("xmlog-item"),itemId:e.attr("xmlog-itemId")})},R=n.extend({init:function(e){xmLog&&xmLog("pv.create",{item:"声音上传入口页"}),xmLog("pv.send","event",{serviceId:"viewItem",item:"声音上传入口页",srcModule:"上传音频"}),j=e.pageConfig,F=!!j.allowEditorLink,j&&!j.anchor_protocol_status&&current_user&&current_user.isVerified&&c.open();var n=this;this.callParent("init"),this.initForm(),this.initData(),this.initDom(),this.initFormCheck();if(t("#record_box").hasClass("full")){t(".uploadLoading").remove(),t("#recordBtn, #uploadBtn").click(function(){o.alert("容量不够")});return}m.init({imgItem:"#videoImageWrap .imgItem img",img_upload_url:"/dtres/cover/upload",imgForm:"#videoImageWrap input[name=video_cover_path]",uploadBtn:"#videoImageWrapBtn"}),H.$on("audiomark",function(e){var n=Infinity;$ul=t(".progress-bar-cont");var r="",i="",s=[];if(!$ul.find("li").data("bitrate"))return;t(".progress-bar-cont li").each(function(n,r){var i=t(r),o=i.data("bitrate"),u="",a=null,f="";if(i.data("todel")||!o)return;e?o<64?a=1:o<128?a=2:a=3:o<64?a=4:a=5,s.push(a);switch(a){case 1:case 4:f="audio-low",o="<64";break;case 2:f="audio-std";break;case 3:case 5:f="audio-high";break;default:}i.find(".cur-status").html('<span class="'+f+'">'+o+"kbps</span>")}),s.forEach(function(e){n=n>e?n=e:n});switch(n){case 1:case 4:r="upload-quality-low c09",i="音质未达标，请上传64kbps以上音频";break;case 2:r="upload-quality-std c02",i="音质较低，建议上传128kbps以上音频";break;case 3:case 5:r="upload-quality-high c02",i="音质很棒！非常期待你的作品哦";break;default:}var o=t("#upload-quality-tip");o.length?o.html('<p class="ta-r mgtb-10 mgr-10 '+r+'">'+i+"</p>"):$ul.after('<div id="upload-quality-tip" class="bd-t"><p class="ta-r mgtb-10 mgr-10 '+r+'">'+i+"</p></div>"),t(".datepicker").is(":hidden")||t("input[name=date]").DatePickerHide()});var r=t(".editAlbum").html();t(".editAlbum .btn-upload").addClass("j-goon-upload"),t(".editAlbum").append(r),t(".j-goon-upload").next().addClass("j-goon-uploadVideo");var i=function(e,r,i){e=e||{};var s=e.selector||"#uploadBtn,.editAlbum .j-goon-upload",o=e.uploadType||"audio";try{var u=B[o]=h({pick:s,fileNumLimit:L,uploadType:o,customDel:function(e,n,r){t(".progress-bar-cont li").length==1?(t("#infoErr").html(""),y.unHoldSubmit(),t("#upload-quality-tip").remove()):(e.data("todel",!0),H.$emit("audiomark",C))},progressOptions:{container:".progress-bar-cont",order:"asc",isDrag:!0,isDel:!0}});u.onUploadSuccess=function(e,n){var r;if(n.ret===0){var i=n.callbackData;r=i.bitTrate}else r=10;r&&(t("#"+e.id).data("bitrate",r),H.$emit("audiomark",C))},u.onFileDialogComplete=function(r){var i=r.length,s=this;o==="video"&&t("#videoImageRow").removeClass("hidden"),n.checkLogin(function(){if(s.firstSelect){var r=t(".j-upload-sort-tip");1==i?(P.singleFile=!0,n.initInfo({album:!1,timingPublish:!0,is_sound_edit:!0,captcha:j.captcha}),n.preview(),r.text("节目前的序号是该节目在专辑内的位置，上传完成后您可在 主播工作台>节目>我的专辑>节目管理 中调整排序")):(P.singleFile=!1,n.initInfo({album:!0,timingPublish:!0,captcha:j.captcha}),r.text("节目前的序号是该节目在专辑内的位置，您可以拖动节目调整排序")),i>=L||P.singleFile?t(".editAlbum").css({height:"0",overflow:"hidden",padding:"0"}):t(".editAlbum").show();var u=o==="video"?".j-goon-upload":".j-goon-uploadVideo";t(".editAlbum").find(u).remove();if(e.uploadType==="video"){var a=t('input[name="isVideo"]');a.length===0?t(".js-upload-sound-show form").append('<input type="hidden" name="isVideo" value="true">'):a.val("true")}b=i,k-=i,k=k<=0?1:k,I=o}else s.singleFile&&(t(".editAlbum").css({height:"0",overflow:"hidden",padding:"0"}),n.preview())},function(){})}}catch(a){window.console&&console.error(a)}};i(),i({selector:"#uploadVideoBtn,.editAlbum .j-goon-uploadVideo",uploadType:"video"}),t(".uploadLoading").remove(),this.setFlashWrap(),this.showSwfupload(),this.hideJRecorder(),this.bindEvents()},initBg:function(){this.$el.parent().attr("class","bodyBgColor2")},initForm:function(){t(".js-upload-sound-show").html(t("#jsUploadSoundTemplate").html()).find(".swfupload2").attr("id","swfupload2"),t(".editAlbum .swfuploadWrap2").attr("style","position: absolute;left:0;top:0;"),t(".editAlbum").addClass("bg-fa"),t(".js-upload-sound-show").find("#imageWrap").attr("id","sound_imageWrap_for_edit").append('<div class="soundImgBox"></div>').next("p").find("a").attr("id","uploadPicBtn_for_edit")},initFormCheck:function(){i.titleStandard(t("#sound_title"))},initData:function(){this.initTags(),this.initActivity()},initTags:function(){var e='<a class="tagBtn2" href="javascript:;"><span>${tagName}</span></a>',n=t(".js-hottags"),r="",i=j.recommend_tags;for(var s=0,o=i.length;s<o;s++)r+=e.replace(/\$\{(tagName)\}/,i[s]);n.append(r)},initActivity:function(){var e=j.activity_list,n='<li class="selecter-item" data-value="${id}" title="${title}" >${title}</li>',r='<li class="selecter-item" title="无" data-value="">无</li>';for(var i=0,s=e.length;i<s;i++){var o=e[i];r+=n.replace(/\$\{([^\}]*)\}/g,function(e,t){var n="";for(var r in o)r==t&&(n=o[r]);return n})}t(".js-activity_list").empty().append(r)},setOrderByAlbumId:function(e){var n=t(".j-album-sort-tip"),r=t(".j-album-laster-sound");t.ajax({url:"/upload/album_sort_info?album_id="+e,success:function(e){if(e.res){var t=e.album,i=t.desc?"| 倒序 (最新在前)":"| 正序 (最新在后)",s="本专辑已发布"+t.order+"期",o="本专辑第"+t.order+"期",u="："+(t&&(t.latest_track_title||""));n.html(s+i),r.html(t.order==0?"":o+u),B[I].soundProgress.initNum=parseInt(t.order)||0,B[I].soundProgress.isDesc=t.desc,B[I].soundProgress.resetOrderNumber()}}})},muiltSoundHtml:function(){var e=""},preview:function(){t("#soundPreview").length<=0&&t("#submit_save").after('<a href="javascript:;" class="btn btn-lg1 btn-secondary mgl-20 sound-preview-btn" xmlog-spg="上传声音页" xmlog-mod="预览" xmlog-fun="trackPreview" id="soundPreview">预览</a>'),t("#soundPreview").on("click",function(){xmLog&&xmLog("pv.send","event",{serviceId:"click",srcPage:t(this).attr("xmlog-spg"),srcModule:t(this).attr("xmlog-mod"),"function":t(this).attr("xmlog-fun")});var e=t("#sound_title").val(),n=t(".is-fenmian").attr("src"),r=t(".js-albumlist .selecter-selected .info").text(),i=t('textarea[name="sound_rich_intro"]').text(),s=t('input[name="isVideo"]').val()=="true"?"video":"audio";p.pop(e,n||"",r,i,s)})},soundRichIntroTop:function(){t('[name="sound_rich_intro"]').parent().addClass("mixed-editor").append('<a class="support-pic-text" href="http://blog.ximalaya.com/fuwenben/" target="_blank">支持图文混排了,快来了解下 &gt; </a>')},initDom:function(){this.$jRecorder=t("#jRecorder"),this.$recordBtn=t("#recordBtn"),this.$uploadBtn=t("#uploadBtn"),this.page={recordBox:t("#record_box"),info:t("#record_info"),uploadIndex:t("#upload_index")},g.callTips(t(".record_content .audio .tips_item:nth-child(3)"),"支持AIFF , AIF , MP4 , 3GP , AVI , WMV , MPG , VOB , FLV , MOV , RMVB , RM , MPEG , MP3 , WMA , WAV , FLAC , OGG , MP2 , AAC , AMR , M4A等文件格式",500),g.callTips(t(".record_content .video .tips_item:nth-child(3)"),"支持 MP4 , 3GP , AVI , WMV , MPG , VOB , FLV , MOV , RMVB , RM , MPEG 等文件格式",300),t("#record_box .record_tab > .audio").click(function(){t("#record_box .record_tab > .audio").addClass("active").siblings().removeClass("active"),t("#record_box .record_content_box > .audio").removeClass("hidden").siblings().addClass("hidden"),t(".forbidden_content").attr("xmlog-mod","上传音频"),xmLog("pv.send","event",{serviceId:"viewItem",item:"声音上传入口页",srcModule:"上传音频"})}),t("#record_box .record_tab > .video").click(function(){t("#record_box .record_tab > .video").addClass("active").siblings().removeClass("active"),t("#record_box .record_content_box > .video").removeClass("hidden").siblings().addClass("hidden"),t(".forbidden_content").attr("xmlog-mod","上传视频"),xmLog("pv.send","event",{serviceId:"viewItem",item:"声音上传入口页",srcModule:"上传视频"})}),t("#record_box .record_tab > .ppt").click(function(){t("#record_box .record_tab > .ppt").addClass("active").siblings().removeClass("active"),t("#record_box .record_content_box > .ppt").removeClass("hidden").siblings().addClass("hidden"),t(".forbidden_content").attr("xmlog-mod","制作有声PPT"),xmLog("pv.send","event",{serviceId:"viewItem",item:"声音上传入口页",srcModule:"制作有声ppt"})})},windowResize:function(e){e.data.setFlashWrap()},setFlashWrap:function(){var e=this;this.$jRecorder.css({left:e.$recordBtn.offset().left,top:e.$recordBtn.offset().top,position:"absolute"})},initInfo:function(n){var r=this;this.showUploadInfo(),n.album?t("#singleUpload").remove():t("#muiltUplaod").remove(),e(["page/upload/information"],function(e){y=e,n.pageConfig=j,n.allowEditorLink=F,y.init(n),r.soundRichIntroTop(),r.initSelectAblumList()})},showSwfupload:function(){},hideSwfupload:function(){},hideJRecorder:function(){this.$jRecorder.css({left:-200,top:-200})},release:function(){this.callParent("release"),this.unbindEvents()},bindEvents:function(){var e=this;t(".uploadBtn3.upload_file_btn").on({click:function(){q(t(this))}}),t(".uploadBtn3.verify_btn").on({click:function(){q(t(this))}}),t("div.tips_item").on({mouseenter:function(){q(t(this))}}),t(".apply_upload_video").on({click:function(){q(t(this))}}),t(".forbidden_content").on({click:function(){q(t(this))}}),t(".download_tool").on({click:function(){q(t(this))}}),t(".make_ppt_guide").on({click:function(){q(t(this))}});var n=t(".uploadContinue");t(".uploadContinueWrap").on({mouseenter:function(){n.addClass("hover")},mouseleave:function(){n.removeClass("hover")}}),this.$recordBtn.click(function(){e.initJRecord()}),t(window).on("resize",this,this.windowResize),t(".js-more-options").on("click",function(){t(".js-more-options").toggleClass("unfolded"),t(".js-more-cont").toggleClass("hidden")}),t(".js-album-add").on("click",function(){var n=window.open(config.STUDIO_ROOT+"createAlbum");window.$openParams=JSON.stringify({}),t.extend(window,v),window.$once("albumResult",function(t){var n={list:[{album_id:t.album.id,cover_url:t.album.cover_url,is_public:t.album.is_public,title:t.album.title,category_id:t.album.category_id,music_category:t.album.music_category,is_paid:t.album.is_paid,upload_source:t.album.upload_source,price_type_id:t.album.price_type_id,discounted_price:t.album.discounted_price,is_default:!1}]};e.albumsList.addList(n,!1,!0)})}),e.setSoundImgDefault(j&&j.albums&&j.albums.list&&j.albums.list.length>0&&j.albums.list[0].cover_url),t("input").beautify();var r=t("#submit_save");t(".js-upload-sound-show").on("click","#submit_save",function(){var e=t('input[name="choose_album"]').val(),n=t(".progress-bar-cont li");if(!n.length){o.alert("你还没有上传节目文件哦~");return}if(!e){t("#infoErr").text("请先选择专辑");return}var r=t(".progress-bar-cont li");r.each(function(){var e=t(this).find(".edit").css("display");if(e==="none")return;t(this).find(".edit .editConfirm").trigger("click")});var i=this;return J(function(){t("input[name='is_album']").val(b===1?"false":"true");var e=t(i).parents("form"),n=e.serialize();console.log(n,"form"),t.ajax({url:"/upload2/check_before_create",type:"POST",data:n,dataType:"json",success:function(e){console.log(e,"resDs");if(e.res)d.pop(function(){var t=d.$saveBtn;xmLog&&xmLog("pv.send","event",{serviceId:"click",srcPage:t.attr("xmlog-spg"),srcModule:t.attr("xmlog-mod"),"function":t.attr("xmlog-fun")});var n=b===1?"/my_tracks":"/my_albums";y.submitForm(i,n)},function(){y.unHoldSubmit(!0)});else{var n=e.errors;y.parseSubmitError(n,t("#infoErr")),y.unHoldSubmit(!0)}},error:function(){o.alert("网络异常！"),y.unHoldSubmit(!0)}})}),!1}),t(".j-copyright").off("click").click(function(){o.copyright()})},initSelectAblumList:function(){var e=this,n,r=t("<div></div>").append(t.trim(t("#category_related").html()));this.albumsList=new l(j.albums,null,function(i){function w(){var e=f?'<br><span class="c09">您所选专辑中的节目目前均可免费试听前N秒哦，仍确定将此节目设为整条免费试听？</span>':"";return"此节目设置为免费试听后，无法再改回收费哦~"+e}function E(){var e={type:"radio",className:"js-trylistening-type",title:"试听类型",defTips:"适用于正式节目免费听",data:[{name:"isTrailer",value:"0",title:"常规节目",isSelected:!0,selectTips:"适用于正式节目免费听",addClass:"mgr-20"},{name:"isTrailer",value:"1",title:"节目预告",selectTips:"适用于大咖推荐/内容预告等的试听"}],render:function(e){t(".js-set-price").after(e)}};g(e)}var s=i.category_id,o=i.music_category,u=i.price_type_id,a=i.discounted_price,f=i.is_sample,l=i.is_default,c;C=s==2,H.$emit("audiomark",C),s!=2?c=r.find("#default_category_related").html():(o!="原唱"&&o!="翻唱"&&o!="伴奏"&&(o="默认"),o=o||"默认",c=r.find('#music_category_related div[data-title="'+o+'"]').html()),t(".js-category-related").empty().html(c),t(".js-category-related").find("#origin").selecter(),i.is_public=="公开"?(t('div[id="user_share"]').removeClass("hidden"),t('div[id="timing_publish"]').removeClass("hidden")):(t('div[id="user_share"]').addClass("hidden"),t('div[id="timing_publish"]').addClass("hidden")),i.is_paid==="true"?t(".js-album-paid-tip").length<=0&&t(".js-album-add.btn-add").after('<span class="c04 txt-sm js-album-paid-tip">亲，您选择的是付费专辑，发布成功后无法移动和删除的哦~</span>'):t(".js-album-paid-tip").remove();var h=t("[name=sound_intro]"),p=h.parents(".row").find(".cell-1");i.is_paid==="true"&&i.category_id!=3?(h.attr("required",""),p.html('节目简介<span class="c04 ">*</span>')):(h.removeAttr("required"),p.html("节目简介"));var d=t(".js-albumlist").parent(".cell-2"),v='<a href="http://form.mikecrm.com/0u7Pb7" class="link-red" target="_blank">认证音乐人，享受更多权利>></a>';current_user.isVerified&&(t("#musician-tips").remove(),i.is_paid==="true"&&s==2?(v='<p class="" id="musician-tips">'+v+"<p>",d.append(v)):i.is_paid!="true"&&s==2&&(v='<span class="" id="musician-tips">'+v+"<span>",t("#musician-tips").length<=0&&t(".js-album-add.btn-add").after(v)));var m;t(".js-set-price").length&&(t(".js-set-price").find("input").off("change").end().remove(),t(".js-trylistening-type").find("input").off("change").end().remove());var g=function(e){if(!e.data||!e.data.length||!e.type||!e.title||typeof e.render!="function")return;var n=e.block?"span":"p",r='<label class="xm-<%=type%> <%= isSelected ? "xm-is-checked" : ""%> <%=addClass%>">   <input type="<%=type%>" name="<%= name %>" value="<%= value %>" <%= isSelected ? "checked" : "" %> data-noselect-tips="<%=noSelectTips %>" data-select-tips="<%=selectTips%>" ><%= title%></label>',i=[],s={addClass:"",isSelected:!1,noSelectTips:"",selectTips:"",value:""},o={};for(var u=0;u<e.data.length;u++){var a=_.extend({type:e.type,addClass:"",isSelected:!1,noSelectTips:"",selectTips:"",value:""},e.data[u]);a.noSelectTips&&(a.noSelectTips=encodeURIComponent(a.noSelectTips)),a.selectTips&&(a.selectTips=encodeURIComponent(a.selectTips)),i.push(_.template(r)(a)),o[a.name+"_"+a.value]=a.selectHandler}var f='<div class="row <%= className %>" def-tips="<%=defTips%>">    <div class="cell-1"> <%= title %>  <span class="c04 <%= required ? "" : "hidden" %>">*</span></div>    <div class="cell-2">'+i.join("")+"       <"+n+' class="tips"><%=defTips %></'+n+">"+"    </div>"+"</div>";e=_.extend({defTips:"",required:!0},e),e.render(_.template(f)(e));var l=t("."+e.className);l.find("input").beautify(),l.find("input").on("change",function(){var e=t(this)[0].checked;if(e){var n=decodeURIComponent(t(this).attr("data-select-tips"));(n||n!="undefined")&&l.find(".tips").html(n);var r=o[t(this).attr("name")+"_"+t(this).val()];r&&r()}else{var n=decodeURIComponent(t(this).attr("data-select-tips"));n=n||n!="undefined"?"":n,l.find(".tips").html(n),t(".js-trylistening-type").remove()}})},b={type:"radio",title:"免费试听",className:"js-set-price",render:function(e){t("#sound_title").parents(".row").after(e)}};if(u==1||u==4||u==2||u==3||u==5)b.data=[{name:"free_type",value:"1",title:"是",addClass:"mgr-20",selectHandler:E},{name:"free_type",value:"2",title:"否",selectHandler:function(){t(".js-trylistening-type").remove()}}];g(b),y&&y.setKindEditor(),e.setOrderByAlbumId(i.album_id);if(!n){var S=setInterval(function(){y&&(n=new y.Tags_selecter(t(".sound_tags_selecter")),n.recommend_tags(s),clearInterval(S))},1e3);return!1}n&&n.recommend_tags(s),e.setSoundImgDefault(i.img_src)})},setSoundImgDefault:function(e){var n="";if(e==""||/album_100\.jpg/.test(e))e=j["default"].track_cover_url,n="def";if(t("#sound_imageWrap_for_edit").length<=0)return;if(t(".image_inherit").length<=0&&t("#sound_imageWrap_for_edit .soundImgBox > div").length<=0){var r='<div class="imgBox is-fenmian image_inherit '+n+'" id="soundSWFUpload_0_0_0" src="'+e+'">'+'<a class="del"></a><div class="imgItem"><img src="'+e+'"><input type="hidden" name="sound_image[]" value="image_inherit">'+'<div class="imgLoading"></div></div><div class="setfenmian">设为封面</div><div class="isfenmian"></div></div>';t("#sound_imageWrap_for_edit .soundImgBox").html(r),t("#sound_imageWrap_for_edit .imgBox2").css("display","none"),y&&n==""&&y.getSoundImage()&&y.getSoundImage().uploadImg.decreaseUploadLimit()}else{if(t(".image_inherit").length==0)return;t(".image_inherit").attr("src",e).find("img").attr("src",e),t(".image_inherit").hasClass("def")?n=="def"?"":y.getSoundImage().uploadImg.decreaseUploadLimit():(t(".image_inherit").removeClass("def"),n==""?"":y.getSoundImage().uploadImg.increaseUploadLimit()),n=="def"?t(".image_inherit").addClass("def"):t(".image_inherit").removeClass("def")}this.isFirstSet=!0},showUploadInfo:function(){this.page.recordBox.css({height:"0px",overflow:"hidden","margin-top":"0"}),this.page.info.show().removeClass("hidden")},initJRecord:function(){var e=this;u.init({upload_url:E,progress_url:x,transcoding_url:T,checkLogin:e.checkLogin,beforeUpload:function(n){D.push(n),P.singleFile=!0,this.filesSelected=P,w=!1,t(".editAlbum").css({height:"0",overflow:"hidden",padding:"0"}),b=1,e.initInfo({album:!1,timingPublish:!0,is_sound_edit:!0,captcha:j.captcha})},uploadSuccess:function(e,t){return k--,e=V(D,e.id),e},transcodingSuccess:function(){$()}}),this.hideSwfupload(),this.page.uploadIndex.hide()},checkLogin:function(e,n){e=e||t.noop,n=n||t.noop;var r=function(){a.open(function(e){a.close()}),n()},i=readCookie(config.TOKEN_LABEL);if(!i){r();return}t.ajax({type:"get",url:N,data:{token:decodeURIComponent(i),rememberMe:"y"},dataType:"json",success:function(t){t&&t.ret==50?r():e()},error:function(){r()}})},unbindEvents:function(){this.callParent("unbindEvents"),t(window).off("resize",this,this.windowResize)}}),U=[],z=[],W={singleFile:!1};return new R}),define("page/upload/edit_album_info",["jquery","page/page_base","plugin/dialog","page/upload/information","module/album/tags","module/common/form_editor","module/common/form_uploadimg","module/dialogs/create_album_html","module/player/player","module/dialogs/albumPreview","plugin/jquery.input"],function(e,t,n,r,i,s,o,u,a,f){function v(t){function d(t){var n=t.value,r=/^\d{1,10}(\.\d{1,2})?$/,i=parseFloat(n);if(!r.test(n)||i<=0)return e(t).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("请输入十位以内的数字,可保留两位小数,最小值0.01"),!1;n&&e(t).val(parseFloat(n));var s="";return parseFloat(n)<.1&&parseFloat(n)>=.01&&(s=e(t).parent().removeClass("is-error").find(".tips-error").attr("data-def")||""),e(t).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html(s),!0}function w(n){var r=n,i={1:"1",2:"2",4:"1",5:"2"};e(".js-paytype-rows").html(u.price_type_id[i[r]]||""),r==="1"||r==="4"?(t.formEditor.richEditor.intro&&t.formEditor.richEditor.intro.remove(),e(".js-intro-row").html(u.one_intro),t.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0}),t.albumPreview.btnHide(o)):r==="2"||r==="5"?(t.albumPreview.btnShow(o),e(".js-paytype-rows").find(".js-refund-time").addClass("hidden"),e(".js-paytype-rows").find('[name="is_refund"]:eq(1)').attr("checked","checked").parent("label").addClass("xm-is-checked").parents(".cell-2").addClass("disabled"),e('input[name="price2"]').attr("name","price"),e('input[name="discounted_price2"]').attr("name","discounted_price"),t.formEditor.richEditor.intro&&t.formEditor.richEditor.intro.remove(),e(".js-intro-row").empty(),t.formUploadImg.uploadImgInit({picBtn:e("#introPicBtn"),imgWrap:e("#introImageWrap"),limitWidth:1250,limitHeight:1e3,tips:'请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M'}),e("#other_title").off("keyup"),e("#other_title").on("keyup",function(){var t=this.value,n=e(this).parents(".js-album-moreintro").find(".tips");if(!checkMaxLength(t,20))return e(this).parents(".js-album-moreintro").addClass("is-error").find(".tips").html("标题可自定义，不超过10个汉字"),!1;e(this).parents(".js-album-moreintro").removeClass("is-error").find(".tips").html(n.attr("data-def"))}),e(".js-album-moreintro").each(function(){var n=e(this).find("input[data-params]").attr("data-name");if(!n)return;var r=e(this).find("textarea").attr("name"),i=e(this);t.formEditor.initRichEditor({name:n,richName:r,isHidden:!0,isShowText:!1,syncSize:!0,onblur:function(){this.sync();var e=this.text(),t=i.find("input[data-params]").attr("name");console.log(t!=n),t!=n&&i.find("input[data-params]").val(e);var r=i.attr("data-showedit");setTimeout(function(){!e&&r!="true"?(i.find(".ke-container").hide(),i.find(".textarea-shou").show()):(i.find(".ke-container").show(),i.find(".textarea-shou").hide())},100)}})})):(t.albumPreview.btnHide(o),e(".js-intro-row").html(u.one_intro),t.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0})),e(this).parents(".is-error").removeClass("is-error").find(".tips").html("")}var n=t.$el,s={singleFile:!1},o=n.find("#albumPreview");p=p||{},p.noAlbumEditor=!!e(".js-album-moreintro").length,r.init({album:!0,timingPublish:!0,isCheck:!0,is_info:!0,pageConfig:p}),e("input").beautify();var f=e("#genre"),l=e("#genre_sub");l.unbind("change"),f.bind("change",function(){var t=e(this).selecter("val");this.albumTags=new i(".searchTagsPanel",{requestUrl:c+t})}),$title=e("#title"),$title.on("keydown",function(e){if(event.keyCode==13)return!1}),e(".tips-error").addClass("tips"),t.$el.find("#discountprice").parent().removeClass("is-error"),t.$el.find("#albumprice").parent().removeClass("is-error"),t.$el.find("#updatedescr").parent().removeClass("is-error"),t.$el.find("#countsound").parent().removeClass("is-error");var h=function(t){var n=e.trim(this.value);if(n==="")n=0;else if(!d(this))return!1;parseFloat(n)>=parseFloat(t)?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("折扣价不能大于或等于原价哦"):e(this).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html("")};t.$el.find('[name="price"],input[name="discounted_price"]').each(function(){e(this).data("data-val",e(this).val())}),t.$el.on("blur focus",'[name="price"]',function(){d(this),h.call(t.$el.find('input[name="discounted_price"]')[0],e(this).val())}).on("blur focus",'input[name="discounted_price"]',function(){h.call(this,t.$el.find('[name="price"]').val())}),t.$el.on("keyup","#updatedescr",function(){var t=this.value,n=e(this).parent().removeClass("is-error").find(".tips").attr("data-def")||"";r.checkMaxLength(t,60)?e(this).parent().removeClass("is-error").find(".tips").addClass("c02").removeClass("c01").html(n):e(this).parent().addClass("is-error").find(".tips").removeClass("c02").addClass("c01").html("字数不能超过30字")}),t.$el.find("#countsound").attr("data-origin",t.$el.find("#countsound").val()),t.$el.on("keyup","#countsound",function(){var n=this.value,r=e(this).attr("data-origin"),i=parseFloat(n),s=/^\d{1,10}?$/,i=parseInt(n);r=parseInt(r);var o=e(this).parent().removeClass("is-error").find(".tips").attr("data-def")||"";i<r?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("所填数字须大于或等于当前预估总集数哦~"):!s.test(n)||i<=0?e(this).parent().addClass("is-error").find(".tips-error").removeClass("c02").addClass("c01").html("请输入十位以内的正整数"):(n&&e(t).val(parseFloat(n)),e(this).parent().removeClass("is-error").find(".tips-error").addClass("c02").removeClass("c01").html(o))}),e(".js-album-moreintro").length?t.formUploadImg.uploadImgInit({picBtn:e("#introPicBtn"),imgWrap:e("#introImageWrap"),limitWidth:1250,limitHeight:1e3,tips:'请上传 <span class="c05">1250x1000</span> 像素的图片，大小不超过3M'}):(e('input[name="intro"]').attr("data-name","intro"),t.formEditor.initRichEditor({name:"intro",richName:"rich_intro",isShowText:!0,syncSize:!0})),e(".js-album-moreintro").each(function(){var n=e(this).find("input[data-params]").attr("data-name");if(!n)return;var r=e(this).find("textarea[name]").attr("name"),i=e(this),s=e(this).find("textarea[name]").val();s=s.replace(/(\s|\r|\n)*(<(br|\/?span)\s*\/?>)(\s|\r|\n)/g,function(e,t,n,r){return n}),e(this).find("textarea[name]").text(s),t.formEditor.initRichEditor({name:n,richName:r,isHidden:!0,isShowText:!1,syncSize:!0,items:["b","customimage","customlink"],onblur:function(){this.sync();var e=this.text(),t=i.find("input[data-params]").attr("name");t!=n&&i.find("input[data-params]").val(e),setTimeout(function(){e||(i.find(".ke-container").hide(),i.find(".textarea-shou").show())},100)}})}),n.on("click",".js-album-moreintro .textarea-shou",function(){var n=e(this).hide().parents(".js-album-moreintro");n.find(".ke-container").show(),t.formEditor.richEditor[n.find("input[data-params]").attr("data-name")].focus()}),n.on("click",".js-otherDesc .icon-edit",function(){e(".js-otherDesc .unedit").hide(),e(".js-otherDesc .edit").show()}),n.on("click",".js-otherDesc .js-sure-edit",function(){var t=e("#other_title").val(),n=e(this).parents(".js-album-moreintro").find(".tips"),i=!1;e.trim(t)||(e(this).parents(".js-album-moreintro").addClass("is-error").find(".tips").html("标题可自定义，不能为空"),i=!0),r.checkMaxLength(t,20)||(e(this).parents(".js-album-moreintro").addClass("is-error").find(".tips").html("标题可自定义，不能超过10个汉字"),i=!0);if(!!i)return!1;e(this).parents(".js-album-moreintro").removeClass("is-error").find(".tips").html(n.attr("data-def")),e(".js-otherDesc .unedit").show(),e(".js-otherDesc .edit").hide(),e(".js-otherDesc").attr("data-name",e("#other_title").val()),e(".js-otherDescTitle").text(e("#other_title").val())}),n.on("click",".js-otherDesc .js-cancel-edit",function(){e(".js-otherDesc .unedit").show(),e(".js-otherDesc .edit").hide();var t=e(".js-otherDesc").attr("data-name");e("#other_title").val(t)});var v=20;n.on("keyup blur","#sub_title",function(){var t='    请尽量简要说明专辑主题，15个字时展示效果最佳~     <span class="view-position">查看展示位置       <span class="hover-detail"><img src="'+config.STATIC_PATH+'/css/img/pic.png"></span>'+"     </span>",n=e(this).parent(),i=!1,s=e(this).val();return!s&&e(this).attr("data-require")!=="false"?(r.setError(n,"请为专辑加上副标题",!0),!1):(r.setRight(n,t),n.removeClass("is-error"),r.checkMaxLength(s,v*2)?!0:(tip="标题太长，必须小于"+v+"个汉字或者"+v*2+"个字母",r.setError(n,tip,!0),!1))});var m=n.find("#price_type_id"),g=m.selecter("val");if(m.length){var y=n.find(".pay-album-intro");y.find("input").on("change",function(){y.find("p.tips").html("").end().removeClass("is-error")}),setTimeout(function(){a.render({$container:y.find(".smallPlayer")})},1e3),n.find('input[name="is_sample"]').on("change",function(){n.find('input[name="is_sample"]:checked').length?n.find(".js-soundpaster").removeClass("hidden"):n.find(".js-soundpaster").addClass("hidden")})}m.on("change",function(){var e=m.selecter("val");if(e==4&&g==1||e==1&&g==4||e==5&&g==2||e==2&&g==5){g=e;return}g=e,w(e)}),n.on("change","#isSample,#eavesdropping",function(){var t=e(this).find("input:checked").val(),r=e(this).attr("data-wran-tips");t?n.find("."+r).addClass("hidden"):n.find("."+r).removeClass("hidden")});var b=e('textarea[name="rich_intro"]').text();o.on("click",function(){t.albumPreview.preview(n)});var E=e("#submit_save");E.click(function(){var i=this;e(".xm-radio").each(function(){e(this).is(".xm-is-checked")?e(this).find("input").attr("checked"):e(this).find("input").removeAttr("checked")});var s=e(".p-eidt-sound").find("#agreeDeal");if(!s[0].checked)return e("#infoErr").html("请先同意协议"),!1;var o=f.parent(),u=f.selecter("val")||f.val(),a=f.selecter("text"),c=l.selecter("val")||l.val();if(!u||a=="音乐"&&(!c||c=="未设置"))return r.setError(o,"请为声音加上类型"),!1;r.setRight(o," ");var h=e('input[name="price"]');e.trim(h.val())===""&&h.parent().addClass("is-error");if(h.parent(".is-error").length>0)return h.focus(),!1;var p=t.$el.find("#updatedescr");p.length&&e.trim(p.val())===""&&p.parent().addClass("is-error");if(p.parent(".is-error").length>0)return p.focus(),!1;var d=t.$el.find("#countsound");d.length&&e.trim(d.val())===""&&d.parent().addClass("is-error");if(d.parent(".is-error").length>0)return d.focus(),!1;var v=e('input[name="intro"]');if(e.trim(v.val())!==""&&v.parent().hasClass("is-error"))return v.focus(),!1;v.parent().removeClass("is-error");var m=t.$el.find('input[name="template_track"]:checked'),g=!!t.$el.find('input[name="is_sample"]:checked').length;if(g&&t.$el.find('input[name="template_track"]').length&&!m.length){var y=t.$el.find('input[name="template_track"]').parents(".cell-2");return y.find("p.tips").html("请选择试听引导语").end().addClass("is-error"),y.find("input").focus(),!1}var y=t.$el.find('input[name="template_track"]').parents(".cell-2");y.removeClass("is-error");var b=n.find("#sub_title");if(b.length&&e.trim(b.val())===""&&b.attr("data-require")!=="false")return b.parent().addClass("is-error"),b.focus(),!1;var w=t.albumTags.pass();if(w)return e("#infoErr").html(w),!1;e.trim(t.$el.find("#discountprice").val())===""&&t.$el.find("#discountprice").parent().removeClass("is-error");var E=!1,S;return e(".js-album-moreintro").each(function(){if(e(this).find("input[required]").length){var t=e(this).find("input[required]").val(),n=e(this).find("lable").text(),r="请填写"+n.replace("*","");n.indexOf("简介配图")!==-1&&(r="请上传简介配图");if(!e.trim(t))return S=S||e(this).find("input[required]").attr("data-name"),e(this).addClass("is-error").find(".tips").html(r),!1}}),S&&e('input[data-name="'+S+'"]').parents(".js-album-moreintro").find(".textarea-shou").hide().end().find(".ke-container").show(),t.$el.find(".is-error").length>0?(t.$el.find(".is-error").parent().find("input").focus(),!1):(r.checkInfo.album_title(!0)&&r.submitForm(i,"/my_albums"),!1)})}var l="/operation_tagging/get_tags_by_album_id?album_id=",c="/operation_tagging/get_tags_by_category_id?category_id=",h=e(".editAlbum_none");h.show();var p,d=t.extend({init:function(t){p=t.pageConfig,this.allowEditorLink=!!t.allowEditorLink,this.callParent("init"),this.formEditor=new s(e("#mainbox form"),{allowEditorLink:this.allowEditorLink}),this.formUploadImg=new o(e("#mainbox form")),v(this);var n=window.location.pathname.replace(/(\/edit_album\/)/,"");this.albumTags=new i(".searchTagsPanel",{requestUrl:l+n})},release:function(){this.callParent("release"),e("input").off("change"),_this.$el.find('input[name="price"]').off("blur"),_this.$el.find('input[name="price"]').off("focus"),_this.$el.find("#discountprice").off("blur"),_this.$el.find("#discountprice").off("focus"),_this.$el.find("#albumprice").off("focus"),_this.$el.find("#albumprice").off("blur"),_this.$el.find("#updatedescr").off("keyup"),_this.$el.find("#countsound").off("keyup")},initBg:function(){this.$el.parent().attr("class","bodyBgColor2")},albumPreview:{btnShow:function(e){e.removeClass("hidden")},btnHide:function(e){e.addClass("hidden")},preview:function(e){var t={title:e.find("#title").val(),soundFace:e.find("#introImageWrap img").attr("src"),albumPrice:e.find("#albumprice").val()||0,discountPrice:e.find('[name="discounted_price"]').val()||0,countSound:e.find('[name="price_track_count"]').val()||0,otherTitle:e.find(".js-otherDescTitle").text()};f.pop(t)}}}),m=new d;return m}),define("page/upload/add_voice_new",["jquery","plugin/swfupload/swfupload.queue","plugin/dialog","page/upload/handlers_new","plugin/uploader/xmupload-audio"],function(e,t,n,r,i){function l(t){var n=e(".j-album-sort-tip"),r=e(".j-album-laster-sound");e.ajax({url:"/upload/album_sort_info?album_id="+t,success:function(e){if(e.res){var t=e.album,i=t.desc?"| 倒序 (最新在前)":"| 正序 (最新在后)",s="本专辑已发布"+t.order+"期",o="本专辑第"+t.order+"期",u="："+(t&&(t.latest_track_title||""));n.html(s+i),r.html(t.order==0?"":s+u),f.soundProgress.initNum=parseInt(t.order)||0,f.soundProgress.isDesc=t.desc,f.soundProgress.resetOrderNumber()}}})}function c(t){var r=e(t.btn),s=e(".select_voice_btn").attr("data-upload-source");if(s==6){e(".select_voice_btn").on("click",function(){var t=e(this).attr("data-url");n.confirm("您选择的是有声化平台专辑，编辑有声化平台专辑请到有声化平台。",function(){window.open(t)},{yesText:"去编辑"})});return}if(s==-1)return;if(r.attr("forbid"))r.click(function(){n.alert("哎呀,你的容量已经用完了")});else{var u=window.location.href.match(/manage_album\/(\d*)/),a=u[1];try{e(".select_voice_btn").off().on("click",function(){if(t.albumStatus==="finished"&&!t.isPaid)return t.albumCallback(),!1;xmLog&&xmLog("pv.create",{item:"声音管理",itemId:a||""}),xmLog&&xmLog("pv.send","event",{serviceId:"click",srcPage:e(this).attr("xmlog-spg"),srcModule:e(this).attr("xmlog-mod"),"function":e(this).attr("xmlog-fun")})}),f=i({pick:".select_voice_btn",uploadType:"audio",customDel:function(){var t=this;e(".js-progressBarAdd li").length==2?t.soundProgress.hideDelBtn():t.soundProgress.showDelBtn()},fileNumLimit:o,progressOptions:{container:".js-progressBarAdd",order:"asc",isDrag:!0,isDel:!0}}),f.onFilesQueued=function(){var t=this;e(".js-progressBarAdd li").length==1&&t.soundProgress.hideDelBtn(),e(".edit_view").css({height:"0px",overflow:"hidden"}),e(".add_view").removeClass("hidden")},f.onFileDialogComplete=function(t){e(".add_view").hasClass("hidden")&&(e(".edit_view").css({height:"0px",overflow:"hidden"}),e(".add_view").removeClass("hidden"))},l(a)}catch(c){window.console&&console.error(c)}}}function h(){var t=e(".js-progressBarAdd li").length,n=e('.js-progressBarAdd li[data-status="success"]').length;return t==n?!0:!1}function p(){var e=f.getFiles();for(var t=0,n=e.length;t<n;t++){var r=e[t];f.trigger("transCancel",r),f.removeFile(r.id,!0)}f.reset()}var s=50,o=50,u=5e3,a=40,f,d={};return d.initUpload=c,d.isOk=h,d.flushUploadLimit=p,d.handlers=r,d}),define("module/dialogs/replace_sound",["jquery","plugin/dialog"],function(e,t){var n={init:function(e){e=e||"audio";var t=e==="video"?"视频":"声音",n={video:"注：更新视频后，将覆盖为新上传的视频和音频，工作人员会审核，若违反法律法规或缺少版权，声音将被下架哦～",audio:"注：提交后工作人员会审核，若违反法律法规或缺少版权，声音将被下架哦~"},r='<div class="hd3">           <span class="btn1 fr"  dialog-role="close"><span class="icon1 icon1-cha" >×</span></span>替换'+t+"       </div>"+'<div class="bd1 tb-1">'+"   <!--s: 上传控件 -->"+'   <div class="mgtb-20"><div class="upload-widget">'+'   <div class="albumList sound-list" id="multiFile">'+'    <ul class="progressBarContainer"></ul> '+'   <div class="editAlbum xmuploader-element-invisible" style="display: inherit;">'+'       <a class="uploadSoundBtn xmUploadBtn goOnXMUploadBtn  webuploader-container" style="position: relative;margin: 0 auto;display: block;overflow:inherit;">'+"       继续上传新的"+t+"</a>"+"   </div>"+"   </div>"+'   </div>   <p class="tips mgt-5">'+n[e]+"</p>  </div>"+"   <!--e: 上传控件 -->"+'   <div class="operate wrapper">'+'       <a class="btn btn-primary btn-mid2 disabled"  id="submitForm">确认提交</a>'+"   </div>"+"</div>";this.content=r},open:function(n,r,i){var s={content:this.content,overlayer:{addClass:"masker",clickClose:!1},template:{dialog_mask:'<div class="masker"></div>',dialog_container:'<div class="popup pop-c pop-replace-sound" dialog-role="container"></div>',dialog_body:'<div class="" dialog-role="body"></div>',dialog_close:""},onYes:function(){var t=e("input[name='audioId']").val(),r=e("input[name='audioName']").val();return n&&n(t,r,i==="video"?!0:!1)},onClose:function(){try{r&&r()}catch(e){window.console&&console.log(e)}}},o=new t.Dialog(s);o.open(),this.popup=o},close:function(){this.popup&&this.popup.close()}};return n}),define("page/upload/vioce_manager",["jquery","page/page_base","plugin/dialog","page/upload/add_voice_new","page/upload/information","page/upload/add_sign","plugin/fileprogress/jquery.xmupload-progress","router","module/dialogs/replace_sound","plugin/uploader/xmupload-audio","plugin/uploader/transcode","module/dialogs/originalStatement","module/album-end","plugin/fileprogress/xmupload-progress-drag","plugin/fileprogress/xmupload-progress-play","plugin/fileprogress/xmupload-progress-template","plugin/jquery.selecter","plugin/jquery.input"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function g(){var e=window.location.href.match(/manage_album\/(\d*)/)[1];return m.indexOf(+e)!==-1}function E(t,n,r){a&&a.init(r),a&&a.open(function(r,i,s){return x(t,{track_id:n,fileid:r,isVideo:s})},function(){var n=e(".pop-replace-sound li").attr("id"),r=w.getFiles();r.length>0&&(e("#"+r[0].id).find(".pauseBtn").click(),w.removeFile(r[0].id,!0)),e("#record_info").find(".more-panel").hasClass("is-open")&&e("#record_info").find(".more-panel").removeClass("is-open")},r)}function T(t){function x(t,r){var i=e(".j-finished-album").data("status");if(i==="finished"){h.cancelApply();return}r=r||e.noop;var s=t.find(".files"),o=t.find(".fileid"),a=t.find(":text"),f=o.val(),l;l=t.find(".del-btn").attr("destroy_id");var c=t.find(".del-btn").attr("data-upload-type"),p=c==="video"?"是否同时删除视频和音频文件？":"是否要删除这个声音？";if(!l)return;return n.confirm(p,function(){var t=this;e.post("/my_tracks/"+l+"/destroy",function(e){if(e.res)u.toPage(window.location.href);else if(e.error_symbol==="soundable_platform"){var t="哎呀，本条属于有声化平台的版权声音，无法直接删除呢~<br>如果觉得这条声音不完美，可以前往有声化平台替换掉它哟~";n.confirm(t,function(){window.open(e.edit_url)},{yesText:"去替换",width:"400px"})}else n.alert(e.msg)})}),!0}function T(t,r){e.ajax({url:t.url,data:{record_id:t.record_id,position:t.position,old_position:t.old_position},type:"POST",success:function(e){if(!e.res){n.alert(e.msg);return}var t=window.location.href;t.indexOf("?")&&(t=t.replace(/\?.*/,"")),t=t+"?page="+e.page,u.toPage(t),r&&r()},error:function(){n.alert("系统出错了！")}})}function _(){return{pick:".replaceAudio",fileNumLimit:1,progressOptions:{container:"body .progressBarContainer",order:"asc",isDrag:!1,isDel:!0,delCallBack:function(){e(".editAlbum").removeClass("xmuploader-element-invisible"),e("#submitForm").addClass("disabled"),e("#submitForm").attr("dialog-role","")}}}}if(t.doingTrans)for(var s=0;s<t.doingTrans.length;s++)clearInterval(t.doingTrans[s].timer);var m="",g;e(".selecter").each(function(){e(this).find("#is_records_desc").length<=0&&e(this).selecter()});var b=e("#is_records_desc").closest(".selecter");b.selecter({onChange:function(t){var r=e("#is_records_desc").attr("data-url"),i=e("#is_records_desc").attr("data-value");if(t===i)return;var s=n.confirm("确定要修改排序吗？",function(){return e.ajax({url:r,data:{isRecordsDesc:t},type:"POST",dataType:"json",success:function(e){e.res&&u.toPage(e.redirect_to)},error:function(){}}),!0});return!!s}}),$desc=e("#is_records_desc"),e(".js-progressBarEdit li ").each(function(){var t=e(this).find('.edit input[name="files[]"]');t.addClass("audioName")});var N=new o({container:".js-progressBarEdit",isDrag:!1,isSaveName:!0,isSingleSort:T,status:2}),C=p.children().attr("is-exist",!0),k=[],L={singleFile:!1},A=window.location.search,O=1;A=A.substring(1),A.replace(/page=([^&]*)/,function(e,t){O=t}),C.length==1&&O==1&&(N.isSingle=!0),t.doingTrans=[],C.each(function(){var n=e(this),r=n.find(".fileid").val(),i=-1;r&&(i=r.replace(/\D/g,""));var s={id:n.attr("id"),name:n.find(".edit input[type=text]").val()||n.find("input[name='files[]']").val()||"",track_data:i,uploadSuccess:!0,transcoded:!0,transcoding:!1,transcodingError:!1,isChosen:!0,uuid:i},o=e(this).attr("data-transcode-state");k.push(s),N.add({file:s,isOld:!0,delHandler:x});if(o==1){var u=e(this).attr("data-upload-id");u=u.replace("u_","");var a=new l(null,v,{trackId:u,fileId:s.id,soundProgress:N});a.coding(),t.doingTrans.push(a)}else{var f=o==2?3:-1;N.process({id:s.id,type:"converting",converting:{percentage:100,status:f,msg:"",data:{}}})}var f=e(this).attr("data-status");o==2&&!current_user.isVerified&&f==0&&(e("#"+s.id).find(".js-transcode-state").remove(),e("#"+s.id).find('[m-name="num"]').after('<div class="fr rel js-transcode-state"><span class="tag-status"><i class="ic-check"></i>审核中</span></div>')),e(this).hasClass("pay_sound")&&e(this).find(".del-btn").attr("destroy_id","").append('<span class="d-reason">付费声音无法删除，只可替换哦（在声音管理页点击声音条上的更多“…”，可进行替换）</span>')}),C=p.children().attr("is-exist",!0),C.on("click",".more-icon",function(){C.find(".more-panel").removeClass("is-open"),e(this).parent().find(".more-panel").toggleClass("is-open")}).end().find(".more-panel").on("click",function(){e(this).toggleClass("is-open")}),e(document).on("click",function(t){!e(t.target).hasClass("more-icon")&&!e(t.target).hasClass("more-panel")&&C.find(".more-panel").removeClass("is-open")});var M="非常抱歉，当前功能正在维护中。";C.find(".js-set-free").on("click",function(){var n=e(this).attr("track_id"),r='<div style="text-align: left;color: #666;font-size: 12px;margin-top: 5px;">1. 常规节目可选择设置为普通试听。<br>2. 设置成功后，这条声音可以被听众免费收听。（在声音编辑页中，可再次修改为付费）<br>'+(d.is_sample?"此专辑声音目前可试听前N秒哦，仍将此声音设为整条免费试听？":"确定设置为普通试听么？")+"</div>";r=y?M:r,t.setTryListen("设置为普通试听",r,"/tracks/set_free",n)}),C.find(".js-set-notic").on("click",function(){var n=e(this).attr("track_id"),r='<div style="text-align: left;color: #666;font-size: 12px;margin-top: 5px;">1. 大咖推荐/内容预告等可设置为预告试听。<br>2. 设置成功后，这条声音可以被听众免费收听。（在声音编辑页中，可再次修改为付费）<br>'+(d.is_sample?"此专辑声音目前可试听前N秒哦，仍将此声音设置为预告试听么？":" 确定设置为预告试听么？")+"</div>";r=y?M:r,t.setTryListen("设置为预告试听",r,"/tracks/set_trailer",n)}),C.find(".js-set-paid").on("click",function(){var n=e(this).attr("track_id"),r=e(this).data("type"),i=r=="free"?"试听":"预告",s='<div style="text-align: left;color: #666;font-size: 12px;margin-top: 5px;">当前声音为'+i+"声音，设为付费后听众将不能免费收听，确定设为付费吗？"+"</div>";s=y?M:s,t.setTryListen("设回付费",s,"/tracks/set_paid",n)}),e(".js-replace-sound").each(function(){var t=_(),n=e(this).parents("li").attr("id"),r=e(this).attr("data-url"),i=e(this).attr("data-upload-type");if(r)e(this).on("click",function(){var t=e(this).attr("data-url");window.open(t)});else{e(this).attr("id",i+"_replaceSound_"+n),t.pick="#"+e(this).attr("id"),t.uploadType=i||"audio";var s=e(this).attr("track_id"),o=f(t),u=function(){e(".pop-replace-sound li .edit-btn").remove()};o.onFileDialogComplete=function(e){w=this;var n="/tracks/change_file";E(n,s,i),t.pick=".uploadSoundBtn",g=f(t),g.onUploadStart=u,g.onSuccess=S},o.onUploadStart=u,o.onSuccess=S}}),a&&a.init(),e(".cancel_upload_btn").on("click",function(){n.confirm("是否要取消上传声音？",function(){e(".edit_view").removeAttr("style"),e(".add_view").addClass("hidden"),r.flushUploadLimit(),e(".js-progressBarAdd").empty(),e(".js-newUploadCount").html("0"),e("#submit_save").removeClass("load").text("保存"),e("#infoErr").html(""),r.handlers.firstSelect=!0})}),e(".sure_upload_btn").on("click",function(){function o(){var t=r.isOk(),n=e(".js-progressBarAdd li:eq(0)").find('input[name="fileids[]"]').val();config.fId=n;var s=e(".js-progressBarAdd .is-error:eq(0)");return s.length>0?(s.find(".audioName").focus(),s.find(".is-lowquality").length>0?(e("#infoErr").text("音质未达标 | 请上传64kbps以上音频"),i.unHoldSubmit(),!1):(e("#infoErr").text("上传失败，请重新上传"),i.unHoldSubmit(),!1)):t}var t=e(".add_view form").attr("action"),s=this;e(".js-progressBarAdd li ").each(function(){e(this).find(".editConfirm").trigger("click")}),i.holdSubmit(o,function(){var t=e(s).parents("form"),r=t.serialize();e.ajax({url:"/upload2/check_before_create",type:"POST",data:r,dataType:"json",success:function(t){if(t.res)c.pop(function(){i.submitForm(s,window.location.href)},function(){i.unHoldSubmit(!0)});else{var n=t.errors;i.parseSubmitError(n,e("#infoErr")),i.unHoldSubmit(!0)}},error:function(){n.alert("网络异常！"),i.unHoldSubmit(!0)}})})})}var p,d,v="/dtres/zhuanma/{id}/jindu/{timestamp}",m=[4345263,11501536,6693171,8225829,12610571,10653646,8697460,5398185,6419495,11487977,5318395,4606389,7371372,7368509,6222578,11438153,4633831,4854448,9996644,3888524,6222157,5157453,12826705,14405528,8256297,6011533,6893131,13394295,13533115,11103503,9417880,6294413,4615999,14783240,7857292,14317015,8259730,5800472,5787042,6924901,5133474,15873492,8695127,6921828,6809101,16243355,4445398,7968002,11469913,6401070,8013416,14778959,5571199,8980905,9352091,5734107,5624736,6372165,11053603,4719014,4541211,16252742,5499471,5317101,6910139,7699476,14665363,14520718,7029082,4417201,5509952,5938428,11232008,5930936,10105195,14383515,11594109,8420873,6762820,15685983,6224092,5593618,14256679,5552207,12374479,8262842,5928917,5765609,418783,10600563,5722818,4475900,10476657,6242373,8260453,9306765,7883976,10419197,3644286,11087584,6992291,9066999,5251904,6886830,3596989,10691273,4688265,6400409,6159621,15371853,7133489,7951020,5562203,12598888,11440108,7866962,7131715,8847963,9998010,16709010,8494521,10817293,13507836,11435917,6228040,11239785,5130435,13480694,15444721,4807262,8223703,4925440,7762217,3984584,10646371,10365569,5508290,7840163,6676239,11392054,15340623,5080817,10990353,4310135,10382586,14517412,14604271,12841088,10707309,11488945,8273989,5202051,10234630,14809289,6737591,5001614,5195388,14849828,4913038,5466652,7366479,8067453,3051952,14559843,3969624,13552269,6223892,11500313,7528646,13743881,12608806,11486108,8234370,5200130,8246361,9266839,11454852,9368214,5445798,18078708,5932959,4821592,5988843,8274410,18546258,11454158,9959805,6474136,8274153,7370071,11247444,6223856,5391713,12514888,5008409,14642788,8871908,6107197,7368255,11031767,4626667,9035091,8172415,6415391,15271471,15687150,8822709,16707296,12624754,12730373,11021265,6495389,5088407,9000786,10076104,14786209,14619707,5328610,14778002,10711972,11357733,10139255,4167409,5103190,12166444,4770455,11470661,5481064,7869508,10438785,8258774,5892652,6162232,10989065,12474013,7041665,8258342,5011331,9983766,12848009,8225951,6715874,6178350,15259353,18476772,5880339,12106144,11941174,7697341,7023641,12213422,6222993,14967392,5243524,3881605,11501137,5364514,6525618,8274174,12696600,7352579,5391331,5656796,18562799,7968130,14722752,5308353,14517687,14080643,13411961,8272440,6008379,11169070,5112712,3588772,12708478,5938536,11436346,13411934,4888067,8125895,15161974,12169061,8272893,5860693,12914958,8677450,6222733,16241343,6925010,5129757,7369861,15797683,7356234,15745662,6665925,10223986,5653752,4928096,11438490],y=g(),b=t.extend({init:function(t){function a(){h.cancelApply()}var n=window.location.href.match(/manage_album\/(\d*)/),o=n[1];xmLog&&xmLog("pv.create",{item:"声音管理",itemId:o||""}),p=e(".js-progressBarEdit"),d=t.pageConfig,this.callParent("init"),h.init(e(".j-finished-album"));var u=e(".editAlbum_none");p.children().size()==0?u.show():u.hide(),d&&!d.anchor_protocol_status&&current_user&&current_user.isVerified&&s.open(),T(this),e("input").beautify(),r.initUpload({btn:".select_voice_btn",albumStatus:e(".j-finished-album").data("status"),isPaid:e(".j-finished-album").data("ispaid"),albumCallback:a}),vaildCodeTemp='<div class="tb-1" id="tr_validcode"><div class="row"> 验证码<span class="c04 mgr-20">*</span><input type="text" name="validcode"><input type="hidden" name="codeid" value="${codeid}"><img id="img_validcode" class="mglr-10" src="${img_src}" style="width:97px;height:35px; "><a id="btn_validcode" href="javascript:;">看不清，换一张</a></div></div>',i.init({no_imgupload:!0,timingPublish:!0,validTemp:vaildCodeTemp,pageConfig:d})},setTryListen:function(t,r,i,s){var o=y?"disabled":"",a='<div class="operate wrapper">    <a class="btn btn-primary btn-lg1 js-btn-save-change + '+o+'" dialog-role="yes" href="javascript:;">确定</a>'+'    <a class="btn btn-secondary btn-lg1" dialog-role="cancel" href="javascript:;">取消</a>                 '+"</div>",f={dialogClass:"pop-c",template:{dialog_close:"",dialog_header:'<div class="hd3 " dialog-role="header"></div>',dialog_body:'<div class="bd1 tb-1" dialog-role="body"></div>'},header:'<span class="btn1 fr"><span class="icon1 icon1-cha" dialog-role="close">×</span>   </span>'+t,content:"<div>"+r+a+"</div>",fixed:!1,onYes:function(){e.ajax({url:i,data:{track_id:s},type:"POST",success:function(e){e.res&&u.toPage(window.location.href)},error:function(){n.alert("系统出错了！")}})}},l=new n.Dialog(f);l.open()},initBg:function(){this.$el.parent().attr("class","bodyBgColor2")},release:function(){this.callParent("release")}});e("#multiFile").find(".editAlbum").show(),e(".j-grade-tip").on("click",function(){e(this).parent().addClass("hidden1"),e.cookie("vm_grade_hover","false",{expires:31536e3,domain:".ximalaya.com",path:"/"})});var w,S=function(t){e("#submitForm").removeClass("disabled"),e("#submitForm").attr("dialog-role","yes"),e("#"+t.id).find(".fileid").attr("name","audioId"),e("#"+t.id).find(".audioName").attr("name","audioName")},x=function(t,r){e.ajax({url:t,type:"POST",data:r,success:function(e){u.toPage(window.location.href)},error:function(){n.alert("提交失败！请检查声音标题是否规范")}})},N=new b;return N}),define("page/podcast/apply_new",["jquery","underscore","backbone","page/page_base","plugin/dialog","plugin/jquery.selecter","plugin/jquery.input","plugin/jquery.validate","page/center/common","module/uploadimg","router"],function(e,t,n,r,i,s,o,u,a,f,l){var c=r.extend({$el:e("#mainbox"),init:function(e){this.callParent("init"),a.init(),this.bindEvents(),this.selecter_action(e,"category1","category1sub"),this.selecter_action(e,"category2","category2sub"),this.selecter_action(e,"category3","category3sub")},bindEvents:function(){var t=this,n=e("#album_list_div");e("input").beautify(),e(".selecter").selecter(),t.album_list_init("album_list_div"),t.album_list_next_page(n),t.album_list_prev_page(n),t.default_msgInit(n),t.initUploadImg(),t.formSubmit()},formSubmit:function(){jQuery.validator.addMethod("stringCheck",function(e,t){return this.optional(t)||/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)},"字母、数字和汉字"),jQuery.validator.addMethod("stringCheck2",function(e,t){return this.optional(t)||/^([A-Za-z]|[\u4E00-\u9FA5])+$/.test(e)},"字母和汉字"),jQuery.validator.addMethod("stringCheck3",function(e,t){return this.optional(t)||/([\u4E00-\u9FA5]|[\uFE30-\uFFA0])+|^[a-zA-Z0-9\u4e00-\u9fa5]+$|[\d\w\(\)]*/.test(e)},"字母、汉字、数字和标点");var t=e("#main_form").validate({errorClass:"is-error",rules:{album_id:{required:function(){return e("#album_infoErr").text(""),!0}},podcast_title:{required:function(){return e("#podcast_title_infoErr").text(""),!0},stringCheck3:function(){return e("#podcast_title_infoErr").text(""),!0},maxlength:function(){return e("#podcast_title_infoErr").text(""),40}},author:{required:function(){return e("#author_infoErr").text(""),!0},stringCheck3:function(){return e("#author_infoErr").text(""),!0},maxlength:function(){return e("#author_infoErr").text(""),10}},intro:{required:function(){return e("#intro_infoErr").text(""),!0},stringCheck3:function(){return e("#intro_infoErr").text(""),!0},maxlength:function(){return e("#intro_infoErr").text(""),2e3}},copyright:{stringCheck3:!0,maxlength:function(){e("#copyright_infoErr").text("");var t=e("input[name='copyright']").val(),n=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return n>20?1:524288}},email:{email:function(){return e("#email_infoErr").text(""),!0}},pod_cover_path:{required:function(){return e("#img_infoErr").text(""),!0}},pod_category_check:{required:function(){return e("#pod_category_infoErr").text(""),!0}}},messages:{album_id:{required:function(){e("#album_infoErr").removeClass("hidden").text("请选择一张专辑"),e("#album_gotop").click()}},podcast_title:{required:function(){e("#podcast_title_infoErr").removeClass("hidden").text("请填写")},stringCheck3:function(){e("#podcast_title_infoErr").removeClass("hidden").text("可包含字母、汉字或数字")},maxlength:function(){e("#podcast_title_infoErr").removeClass("hidden").text("最多40字")}},author:{required:function(){e("#author_infoErr").removeClass("hidden").text("请填写")},stringCheck3:function(){e("#author_infoErr").removeClass("hidden").text("可包含字母、汉字或数字")},maxlength:function(){e("#author_infoErr").removeClass("hidden").text("最多10字")}},intro:{required:function(){e("#intro_infoErr").removeClass("hidden").text("请填写")},stringCheck3:function(){e("#intro_infoErr").removeClass("hidden").text("可包含字母、汉字或数字")},maxlength:function(){e("#intro_infoErr").removeClass("hidden").text("最多2000字")}},copyright:{stringCheck3:function(){return'<span class="c01 mgl-10">可包含汉字或字母</span>'},maxlength:function(){var t=e("input[name='copyright']").val(),n=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return n>20&&e("#copyright_infoErr").removeClass("hidden").text("最多10个汉字或20个字母"),""}},email:{email:function(){e("#email_infoErr").removeClass("hidden").text("请填写邮箱的正确格式")}},pod_cover_path:{required:function(){e("#img_infoErr").removeClass("hidden").text("请上传")}},pod_category_check:{required:function(){e("#pod_category_infoErr").removeClass("hidden").text("请选择")}}},submitHandler:function(t){e("#submit_save").addClass("disabled"),e.ajax({url:"/center/podcast/create",type:"post",data:e("#main_form").serialize(),success:function(t){var n=t.res;n?(i.alert("恭喜~您的申请提交成功啦~<br/>我们将认真审核，审核结果会在7个工作日内出现在您的“Podcast服务”页面，请及时查询，并进行后续操作。"),l.toPage(t.redirect_url)):(i.alert(t.msg),e("#submit_save").removeClass("disabled"))}})}});e("#submit_save").on("click",function(){!e("#pod_category1").val()&&!e("#pod_category2").val()&&!e("#pod_category3").val()?e("#pod_category_check").val(""):e("#pod_category_check").val(1),e("#main_form").submit()})},initUploadImg:function(){var t=this,n=new f({url:config.UPLOAD_ROOT+"/picture/upload",$el:e("#btn-podcast-upload"),file_queued_handler:function(t){e(".img-face").addClass("is-loading").find(".imgLoading").removeClass("hidden")},success:function(n,r,s){var o=e(".img-face img"),u=n.data[0].uploadTrack;if(u.url.substr(u.url.length-4,4)!==".png"&&u.url.substr(u.url.length-4,4)!==".jpg"){i.alert("请上传一张PNG或JPEG格式图片"),e(".img-face").removeClass("is-loading").find(".imgLoading").addClass("hidden");return}t.getImgOriginalSize(config.FDFS_PATH+"/"+u.url,function(t,n){if(t!=n||t<1400){i.alert("请上传一张大小1400*1400以上,正方形图片"),e(".img-face").removeClass("is-loading").find(".imgLoading").addClass("hidden");return}e(".img-face").removeClass("is-loading").find(".imgLoading").addClass("hidden"),e(".img-face").parent().find("[name=pod_cover_path]").focus().val(u.url).blur(),o.attr("src",config.FDFS_PATH+"/"+u.url)})}})},getImgOriginalSize:function(e,t){var n=new Image;n.src=e,n.complete?t(n.width,n.height):n.onload=function(){t(n.width,n.height),n=null}},selecter_action:function(t,n,r){e("#"+n+" ul").on("click","li",function(){var i=e(this).attr("data-value");if(i==""||e.isEmptyObject(t[i].sub_category))e("#"+r).addClass("hidden");else{e("#"+r+" ul").empty(),e("#"+r+" .selecter-text").text("请选择子分类");for(item in t[i].sub_category)e("<li></li>").addClass("selecter-item").attr("data-value",item).text(t[i].sub_category[item]).appendTo(e("#"+r+" ul"));e("#"+r).removeClass("hidden")}e("#pod_"+n).val(e(this).attr("data-value")),e("#pod_"+n).val()&&e("#pod_category_check").focus().val(1).blur()})},album_list_init:function(t){var n=e("#"+t),r=n.attr("data-page"),i=Math.ceil(parseInt(n.attr("data-count"))/parseInt(n.attr("data-per-page")));r==1?n.find(".arrow-l").hide():n.find(".arrow-l").show(),r==i?n.find(".arrow-r").hide():n.find(".arrow-r").show()},album_list_next_page:function(t){var n=this;t.off("click",".arrow-r"),t.on("click",".arrow-r",function(){var r=parseInt(e(this).parent().attr("data-page")),s=e(this);s.addClass("disabled"),e.ajax({url:"/center/get_podcast_albums",type:"GET",data:{page:r+1},success:function(e){if(e.res===!1){i.alert(e.msg);return}t.attr({"data-page":e.page,"data-per-page":e.per_page,"data-count":e.count}).find("ul").empty().html(e.html),n.album_list_init("album_list_div")},error:function(){i.alert("请求失败")},complete:function(){s.removeClass("disabled")}})})},album_list_prev_page:function(t){var n=this;t.off("click",".arrow-l"),t.on("click",".arrow-l",function(){var r=parseInt(e(this).parent().attr("data-page")),s=e(this);s.addClass("disabled"),e.ajax({url:"/center/get_podcast_albums",type:"GET",data:{page:r-1},success:function(e){if(e.res===!1){i.alert(e.msg);return}t.attr({"data-page":e.page,"data-per-page":e.per_page,"data-count":e.count}).find("ul").empty().html(e.html),n.album_list_init("album_list_div")},error:function(){i.alert("请求失败")},complete:function(){s.removeClass("disabled")}})})},podcastTip:function(e){var t=[];t.push('<div class="c02" style="line-height:1.5em;">'),t.push("<div>Podcast转入说明</div>"),t.push('<div class="ta-l mgl-10">1：当你勾选本项后，即接受从旧的服务方转入Podcast服务。</div>'),t.push('<div class="ta-l mgl-10">2：为保证转入的顺利进行，本服务勾选后不可取消。</div>'),t.push('<div class="ta-l mgl-10">3：本服务只在后台对FEED代码进行转入服务的许可设置。</div>'),t.push('<div class="ta-l mgl-10">4：本服务只表示接受转入许可，相关流程及结果取决于旧的服务方及苹果平台方。</div>'),t.push('<div class="ta-l mgl-10">5：转入服务还需要您在旧的服务方进行如下操作：</div>'),t.push('<div class="ta-l mgl-20">在旧的feed中添加HTTP 301重定向到新的feed地址</div>'),t.push('<div class="ta-l mgl-10">更多详情查阅<a target="xm-podcast-itc" href="https://help.apple.com/itc/podcasts_connect/?lang=en#/itca489031e0">苹果文档</a></div>'),t.push("</div>"),i.confirm(t.join(""),function(t){e.find("input").val("true"),e.addClass("xm-is-checked")},{width:500})},default_msgInit:function(t){var n=this;t.on("click","ul li:not(.ing,.already)",function(){e(this).addClass("selected").siblings().removeClass("selected"),e('input[name="album_id"]').val(e(this).attr("data-album-id")),e("#album_infoErr").text("");var t=e(this).attr("data-album-title"),n=e(this).attr("data-album-intro");e("#default_albumName_span").empty().text(t),e("#default_albumDes_span").empty().text(n)}),e(".xm-radio").on("click",function(){e(this).hasClass("default")?(e(this).parents(".define_div").addClass("is-default").removeClass("is-define"),e(this).parents(".define_div").find(".infoErr").empty()):(e(this).parents(".define_div").removeClass("is-default").addClass("is-define"),e(this).parent().find(".define-cont").val(""))}),e(".xm-checkbox input").off("change"),e("[name=is_transfer_into]").val("false"),e(".xm-checkbox").on("change",function(){var t=e("[name=is_transfer_into]").val();t=="true"?(e("[name=is_transfer_into]").val("false"),e(this).removeClass("xm-is-checked")):n.podcastTip(e(this))}),e(".xm-checkbox a").on("click",function(t){n.podcastTip(e(this).parent(".xm-checkbox")),t.preventDefault()})},release:function(){this.callParent("release"),e(".xm-checkbox a").off(),e(".xm-checkbox").off()}});return new c}),define("page/podcast/apply_edit",["jquery","underscore","backbone","page/page_base","plugin/dialog","plugin/jquery.selecter","plugin/jquery.input","plugin/jquery.validate","page/center/common","module/uploadimg","router"],function(e,t,n,r,i,s,o,u,a,f,l){var c=r.extend({$el:e("#mainbox"),init:function(e){this.callParent("init"),a.init(),this.bindEvents(),this.selecter_action(e,"category1","category1sub"),this.selecter_action(e,"category2","category2sub"),this.selecter_action(e,"category3","category3sub"),this.subselecter_init(e,"category1","category1sub"),this.subselecter_init(e,"category2","category2sub"),this.subselecter_init(e,"category3","category3sub"),this.selecter_init("category1"),this.selecter_init("category2"),this.selecter_init("category3"),this.selecter_init("category1sub"),this.selecter_init("category2sub"),this.selecter_init("category3sub")},bindEvents:function(){var t=this,n=e("#album_list_div");def_album_id=e('input[name="album_id"]').val(),e("input").beautify(),e(".selecter").selecter(),t.default_msgInit(n),t.initUploadImg(),t.formSubmit(),e("#album_change_a").on("click",function(){e(this).attr("opt")=="edit"?(e(this).attr("opt","cansel").html('<i class="icon6 icon6-edit mgr-5"></i>取消更改'),t.album_list_init("album_list_div"),t.album_list_next_page(n),t.album_list_prev_page(n),e('input[name="album_id"]').val(""),e(".use-default-album").hide(),e(".change-album").show()):e(this).attr("opt")=="cansel"&&(e(this).attr("opt","edit").html('<i class="icon6 icon6-edit mgr-5"></i>更改专辑'),e('input[name="album_id"]').val(def_album_id),e(".use-default-album").show(),e(".change-album").hide())})},album_list_init:function(t){var n=e("#"+t);e.ajax({url:"/center/get_podcast_albums",type:"GET",data:{page:1},success:function(e){if(e.res===!1){i.alert(e.msg);return}n.attr({"data-page":e.page,"data-per-page":e.per_page,"data-count":e.count}).find("ul").empty().html(e.html)},error:function(){i.alert("请求失败")},complete:function(){var e=n.attr("data-page"),t=Math.ceil(parseInt(n.attr("data-count"))/parseInt(n.attr("data-per-page")));e==1?n.find(".arrow-l").hide():n.find(".arrow-l").show(),e==t?n.find(".arrow-r").hide():n.find(".arrow-r").show()}})},subselecter_init:function(t,n,r){var i=e("#"+n).find("input").val();if(t[i])if(i==""||e.isEmptyObject(t[i].sub_category))e("#"+r).addClass("hidden");else{e("#"+r+" ul").empty(),e("#"+r+" .selecter-text").text("请选择子分类"),e("<li></li>").addClass("selecter-item").attr("data-value","").text("请选择子分类").appendTo(e("#"+r+" ul"));for(var s in t[i].sub_category)e("<li></li>").addClass("selecter-item").attr("data-value",s).text(t[i].sub_category[s]).appendTo(e("#"+r+" ul"));e("#"+r).removeClass("hidden")}else e("#"+r).addClass("hidden")},selecter_init:function(t){var n=e("#"+t),r=n.find("input").val();if(r){var i=n.find('ul li[data-value="'+r+'"]').text();i?n.find(".selecter-text").text(i):n.find(".selecter-text").text("请选择")}},selecter_action:function(t,n,r){e("#"+n+" ul").on("click","li",function(){var i=e(this).attr("data-value");if(i==""||e.isEmptyObject(t[i].sub_category))e("#"+r).addClass("hidden");else{e("#"+r+" ul").empty(),e("#"+r+" .selecter-text").text("请选择子分类"),e("<li></li>").addClass("selecter-item").attr("data-value","").text("请选择子分类").appendTo(e("#"+r+" ul"));for(var s in t[i].sub_category)e("<li></li>").addClass("selecter-item").attr("data-value",s).text(t[i].sub_category[s]).appendTo(e("#"+r+" ul"));e("#"+r+' ul li[data-value=""]').click(),e("#"+r).removeClass("hidden")}e("#pod_"+n).val(e(this).attr("data-value")),e("#pod_"+n).val()&&e("#pod_category_check").focus().val(1).blur()})},formSubmit:function(){jQuery.validator.addMethod("stringCheck",function(e,t){return this.optional(t)||/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)},"字母、数字和汉字"),jQuery.validator.addMethod("stringCheck2",function(e,t){return this.optional(t)||/^([A-Za-z]|[\u4E00-\u9FA5])+$/.test(e)},"字母和汉字"),jQuery.validator.addMethod("stringCheck3",function(e,t){return this.optional(t)||/([\u4E00-\u9FA5]|[\uFE30-\uFFA0])+|^[a-zA-Z0-9\u4e00-\u9fa5]+$|[\d\w\(\)]*/.test(e)},"字母、汉字、数字和标点");var t=e("#main_form").validate({errorClass:"is-error",rules:{album_id:{required:function(){return e("#album_infoErr").text(""),!0}},podcast_title:{required:function(){return e("#podcast_title_infoErr").text(""),!0},stringCheck3:function(){return e("#podcast_title_infoErr").text(""),!0},maxlength:function(){return e("#podcast_title_infoErr").text(""),40}},author:{required:function(){return e("#author_infoErr").text(""),!0},stringCheck3:function(){return e("#author_infoErr").text(""),!0},maxlength:function(){return e("#author_infoErr").text(""),10}},intro:{required:function(){return e("#intro_infoErr").text(""),!0},stringCheck3:function(){return e("#intro_infoErr").text(""),!0},maxlength:function(){return e("#intro_infoErr").text(""),2e3}},copyright:{stringCheck3:!0,maxlength:function(){e("#copyright_infoErr").text("");var t=e("input[name='copyright']").val(),n=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return n>20?1:524288}},email:{email:function(){return e("#email_infoErr").text(""),!0}},pod_cover_path:{required:function(){return e("#img_infoErr").text(""),!0}},pod_category_check:{required:function(){return e("#pod_category_infoErr").text(""),!0}}},messages:{album_id:{required:function(){e("#album_infoErr").removeClass("hidden").text("请选择一张专辑"),e("#album_gotop").click()}},podcast_title:{required:function(){e("#podcast_title_infoErr").removeClass("hidden").text("请填写")},stringCheck3:function(){e("#podcast_title_infoErr").removeClass("hidden").text("可包含字母、汉字或数字")},maxlength:function(){e("#podcast_title_infoErr").removeClass("hidden").text("最多40字")}},author:{required:function(){e("#author_infoErr").removeClass("hidden").text("请填写")},stringCheck3:function(){e("#author_infoErr").removeClass("hidden").text("可包含字母、汉字或数字")},maxlength:function(){e("#author_infoErr").removeClass("hidden").text("最多10字")}},intro:{required:function(){e("#intro_infoErr").removeClass("hidden").text("请填写")},stringCheck3:function(){e("#intro_infoErr").removeClass("hidden").text("可包含字母、汉字或数字")},maxlength:function(){e("#intro_infoErr").removeClass("hidden").text("最多2000字")}},copyright:{stringCheck3:function(){return'<span class="c01 mgl-10">可包含汉字或字母</span>'},maxlength:function(){var t=e("input[name='copyright']").val(),n=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return n>20&&e("#copyright_infoErr").removeClass("hidden").text("最多10个汉字或20个字母"),""}},email:{email:function(){e("#email_infoErr").removeClass("hidden").text("请填写邮箱的正确格式")}},pod_cover_path:{required:function(){e("#img_infoErr").removeClass("hidden").text("请上传")}},pod_category_check:{required:function(){e("#pod_category_infoErr").removeClass("hidden").text("请选择")}}},submitHandler:function(t){var n=e("#submit_save");n.addClass("disabled");var r=n.attr("data-type"),s=e("#main_form").attr("data-action");e.ajax({url:s,type:"post",data:e("#main_form").serialize(),success:function(t){var n=t.res;n?(r==="recover"?i.alert("恭喜~您的申请提交成功啦~<br/>我们将认真审核，审核结果会在7个工作日内出现在您的“Podcast服务”页面，请及时查询，并进行后续操作。"):i.alert("保存成功！"),l.toPage(t.redirect_url)):(i.alert(t.msg),e("#submit_save").removeClass("disabled"))}})}});e("#submit_save").on("click",function(){!e("#pod_category1").val()&&!e("#pod_category2").val()&&!e("#pod_category3").val()?e("#pod_category_check").val(""):e("#pod_category_check").val(1),e("#main_form").submit()})},initUploadImg:function(){var t=this,n=new f({url:config.UPLOAD_ROOT+"/picture/upload",$el:e("#btn-podcast-upload"),file_queued_handler:function(t){e(".img-face").addClass("is-loading").find(".imgLoading").removeClass("hidden")},success:function(n,r,s){var o=e(".img-face img"),u=n.data[0].uploadTrack;if(u.url.substr(u.url.length-4,4)!==".png"&&u.url.substr(u.url.length-4,4)!==".jpg"){i.alert("请上传一张PNG或JPEG格式图片"),e(".img-face").removeClass("is-loading").find(".imgLoading").addClass("hidden");return}t.getImgOriginalSize(config.FDFS_PATH+"/"+u.url,function(t,n){if(t!=n||t<1400){i.alert("请上传一张大小1400*1400以上,正方形图片"),e(".img-face").removeClass("is-loading").find(".imgLoading").addClass("hidden");return}e(".img-face").removeClass("is-loading").find(".imgLoading").addClass("hidden"),e(".img-face").parent().find("[name=pod_cover_path]").focus().val(u.url).blur(),o.attr("src",config.FDFS_PATH+"/"+u.url)})}})},getImgOriginalSize:function(e,t){var n=new Image;n.src=e,n.complete?t(n.width,n.height):n.onload=function(){t(n.width,n.height),n=null}},album_list_next_page:function(t){var n=this;t.off("click",".arrow-r"),t.on("click",".arrow-r",function(){var n=parseInt(e(this).parent().attr("data-page")),r=e(this);r.addClass("disabled"),e.ajax({url:"/center/get_podcast_albums",type:"GET",data:{page:n+1},success:function(e){if(e.res===!1){i.alert(e.msg);return}t.attr({"data-page":e.page,"data-per-page":e.per_page,"data-count":e.count}).find("ul").empty().html(e.html)},error:function(){i.alert("请求失败")},complete:function(){r.removeClass("disabled");var e=t.attr("data-page"),n=Math.ceil(parseInt(t.attr("data-count"))/parseInt(t.attr("data-per-page")));e==1?t.find(".arrow-l").hide():t.find(".arrow-l").show(),e==n?t.find(".arrow-r").hide():t.find(".arrow-r").show()}})})},album_list_prev_page:function(t){var n=this;t.off("click",".arrow-l"),t.on("click",".arrow-l",function(){var n=parseInt(e(this).parent().attr("data-page")),r=e(this);r.addClass("disabled"),e.ajax({url:"/center/get_podcast_albums",type:"GET",data:{page:n-1},success:function(e){if(e.res===!1){i.alert(e.msg);return}t.attr({"data-page":e.page,"data-per-page":e.per_page,"data-count":e.count}).find("ul").empty().html(e.html)},error:function(){i.alert("请求失败")},complete:function(){r.removeClass("disabled");var e=t.attr("data-page"),n=Math.ceil(parseInt(t.attr("data-count"))/parseInt(t.attr("data-per-page")));e==1?t.find(".arrow-l").hide():t.find(".arrow-l").show(),e==n?t.find(".arrow-r").hide():t.find(".arrow-r").show()}})})},default_msgInit:function(t){t.on("click","ul li:not(.ing,.already)",function(){e(this).addClass("selected").siblings().removeClass("selected"),e('input[name="album_id"]').val(e(this).attr("data-album-id")),e("#album_infoErr").text("");var t=e(this).attr("data-album-title"),n=e(this).attr("data-album-intro");e("#default_albumName_span").empty().text(t),e("#default_albumDes_span").empty().text(n)}),e(".xm-radio").on("click",function(){e(this).hasClass("default")?(e(this).parents(".define_div").addClass("is-default").removeClass("is-define"),e(this).parents(".define_div").find(".infoErr").empty()):(e(this).parents(".define_div").removeClass("is-default").addClass("is-define"),e(this).parent().find(".define-cont").val(""))}),e(".xm-checkbox").on("change",function(){e(this).find("input")[0].checked?e(this).find("input").val("false"):e(this).find("input").val("true")})},release:function(){this.callParent("release")}});return new c}),define("page/podcast/apply_check",["jquery","underscore","backbone","page/page_base","plugin/dialog","page/center/common"],function(e,t,n,r,i,s){var o=r.extend({$el:e("#mainbox"),init:function(t){s.init();if(t.album_not_found==1){var n=t.podcast_edit_url,r=t.status,o;r===0?o='<div class="bd1 tc"><p class="row">Oh no...您的专辑不存在，请更改专辑或重新申请。</p><div class="row operate"><a href="/center/podcast" class="btn btn-primary btn-lg pop_btn" hashlink>返回</a></div></div>':o='<div class="bd1 tc"><p class="row">Oh no...您的专辑不存在，请更改专辑或重新申请。</p><div class="row operate"><a href="/center/podcast" class="btn btn-secondary btn-lg1 pop_btn" hashlink>返回</a><a href="'+n+'" class="btn btn-primary btn-lg pop_btn" hashlink>更改专辑</a>'+"</div>"+"</div>";var u={content:o},a=new i.Dialog(u);a.open(),e(document).off("click",".pop_btn"),e(document).on("click",".pop_btn",function(){a.close()})}},release:function(){this.callParent("release")}});return new o}),define("page/podcast/apply_list",["jquery","underscore","backbone","page/page_base","plugin/jquery.selecter","page/center/common","router"],function(e,t,n,r,i,s,o){var u=r.extend({$el:e("#sub-main-box"),init:function(){s.init(),this.bindEvents()},bindEvents:function(){e(".selecter").selecter(),e("#list_select_ul").off().on("click","li",function(){o.toPage("/center/podcast?status="+e(this).attr("status"),!0,"#sub-main-box")})},release:function(){this.callParent("release")}});return new u}),define("model/verify",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{report_id:undefined,content:{},album_id:undefined,uid:undefined,nickname:undefined,content_title:undefined,is_processed:undefined,content_type:undefined,fujian_path:undefined,track_id:undefined},doReport:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/report/create",type:"post",data:r.toJSON(),success:function(e,r,i){r&&r.result=="success"?t(e,r,i):n(e,r,i)}})},getTrackList:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/my_tracks.json",type:"get",success:function(e,r,i){r?t(e,r,i):n(e,r,i)}})}});return r}),define("module/verify/sound",["jquery","underscore","backbone"],function(e,t,n){var r=['<span><%-title%></span><a class="selItemBtn"></a><a class="selItemBtn2"></a>'].join(""),i=n.View.extend({template:t.template(r),tagName:"li",events:{click:"doSelect"},doSelect:function(t){this.view.set("track_id",this.model.get("track_id")),this.view.set("track_title",this.model.get("title")),e(".addTo li.on").removeClass("on"),this.$el.addClass("on")},render:function(){var e=this;return e.$el.html(e.template(e.model.toJSON())),this.undelegateEvents(),this.delegateEvents(this.events),this.model.get("checked")&&e.$el.addClass("on"),e.$el}});return i}),define("module/verify/soundselect",["jquery","underscore","backbone","module/verify/sound","plugin/dialog"],function(e,t,n,r,i){var s=["<strong>声音列表</strong>",'<ul class="addTo">',"</ul>",'<div class="operate"><a class="confirmBtn" dialog-role="yes">确认</a><a class="cancelBtn" dialog-role="close">取消</a></div>'].join(""),o=n.View.extend({template:t.template(s),initialize:function(){this.render()},render:function(){var e=this;e.$el.html(e.template())},doAddGroupView:function(e){var t=new r({model:new n.Model(e.get("track_record"))});e.set("checked",this.model.get("track_id")==e.get("track_id")),t.view=this.model,this.$el.find("ul.addTo").append(t.render())},show:function(t,r){var s=this,o=e.extend({id:"dialog_addSound",dialogClass:"addSound",header:"选择声音",width:450,content:s.$el,onYes:function(){e("#track_id").val(s.model.get("track_id")).blur(),e("#track_title").text(s.model.get("track_title"))}},{}),u=new i.Dialog(o);u.open(),u.getEl().height("auto"),this.$el.find("ul.addTo").empty();var a=new n.Collection(r);a.each(this.doAddGroupView,this)}});return new o({model:new n.Model})}),define("module/verify/addv",["jquery","underscore","backbone","model/verify","plugin/dialog","module/uploadimg","module/verify/soundselect","plugin/jquery.validate"],function(e,t,n,r,i,s,o){function a(t,n){var r=!1,i=e.trim(t).replace(/[^\x00-\xff]/ig,"xx").length;return n=n||{minLength:0,maxLength:1e11},r=n.minLength<i,r&&n.maxLength&&(r=n.maxLength>i),r}var u=config.DIRECT_DTRES_ROOT+"/cover/upload";e.validator.addMethod("Blen",function(e,t,n){return this.optional(t)||a(e,n)},"");var f=n.View.extend({init:function(){var t=this,n=e("form").validate({errorClass:"is-error",rules:{real_name:{required:!0},identity_card:{required:!0},phone:{required:!0},email:{required:!0,email:!0},businesscard_path:{required:!0},permit_path:{required:!0},lincense_path:{required:!0},intro:{required:!0,Blen:{minLength:0,maxLength:3e3}}},messages:{real_name:{required:"姓名不能为空"},identity_card:{required:"身份证号码不能为空"},phone:{required:"联系电话不能为空"},email:{required:"Email不能为空",email:"Email格式不正确"},businesscard_path:{required:"请上传真人照片"},permit_path:{required:"请上传执照"},lincense_path:{required:"请上传节目授权证明"},intro:{required:"请填写电台描述",Blen:"电台描述必须在3000字节以内"}},errorPlacement:function(e,t){e.addClass("error1"),t.after(e)},showLabel:function(){},success:function(e,t){e.addClass("valid")},submitHandler:function(t){return e("a.confirmBtn").off("click"),t.submit(),!0}});t.$el=e("#mainbox"),e(".selectFileBtn").each(function(){var t=e(this);(function(t){new s({url:u,$el:t,maxSize:3,success:function(n,r){var i=n.data[0],s=t.attr("data-path"),o=t.attr("data-img");e("#"+s).val(i.dfsId),e("#"+o).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+i.dfsId)}})})(t)});var r=e(".organization.hidden");e("[name='type']").on("click",function(){var t=e(this),n=t.val();n==1?r.removeClass("hidden"):r.addClass("hidden")}),t.$el.find(".selecter.selecter-s5").selecter().on("change",function(){var t=e(this);e("#human_category_id").val(t.selecter("val"))}),e("a.confirmBtn").on("click",function(){e("form").submit()}),e("a.cancelBtn").on("click",function(){i.confirm("是否要取消加V操作？",function(){location.href="/"})})},release:function(){}});return new f({model:new r})}),define("page/verify/addv",["jquery","underscore","backbone","module/verify/addv","page/page_base"],function(e,t,n,r,i){var s=i.extend({init:function(){this.callParent("init"),r.init()},release:function(){this.callParent("release"),r.release()}}),o=new s;return o}),define("module/verify/addv_intro",["jquery","underscore","backbone","model/verify","plugin/dialog","module/dialogs/login_box"],function(e,t,n,r,i,s){var o=config.DIRECT_DTRES_ROOT+"/cover/upload",u=n.View.extend({init:function(){var t=e(".authentication"),n=t.attr("data-login"),r=Number(t.attr("data-follower")),s=Number(t.attr("data-tracks")),o=[],u=!0;if(n=="false")return!1;s<5&&(o.push("至少上传了5个声音!"),u=!1),e(".agreement input").on("click",function(){e(this).is(":checked")?t.removeClass("disabled"):t.addClass("disabled")}),e(".agreement a").on("click",function(){return i.alert("xieyi",{height:"500px"}),!1}),t.on("click",function(){if(t.is(".disabled"))return!1;if(o.length)var e=i.alert(o.join(""),{width:"300px"});return u})},release:function(){}});return new u({model:new r})}),define("page/verify/addv_intro",["jquery","underscore","backbone","module/verify/addv_intro","page/page_base"],function(e,t,n,r,i){var s=i.extend({init:function(){this.callParent("init"),r.init()},release:function(){this.callParent("release"),r.release()}}),o=new s;return o}),define("module/verify/addv-center",["jquery","underscore","backbone","model/verify","plugin/dialog","module/dialogs/login_box","module/common/ifollow","module/common/iletter","module/header_search"],function(e,t,n,r,i,s,o,u){var a=config.DIRECT_DTRES_ROOT+"/cover/upload",f=n.View.extend({init:function(){xmLog&&xmLog("pv.create",{item:"主播选择认证页"}),xmLog("pv.send","event",{item:"主播选择认证页",serviceId:"viewitem"}),o.init(),u.bind(e(".j-send-letter")),this.bindEvents()},bindEvents:function(){e(".typeItems").on("click","a",function(){xmLog("pv.send","event",{srcPage:"主播认证引导页",item:e(this).attr("xmlog-item"),serviceId:"pageview"})})},release:function(){}});return new f({model:new r})}),define("page/verify/addv-center",["jquery","underscore","backbone","module/verify/addv-center","page/page_base"],function(e,t,n,r,i){var s=i.extend({init:function(){this.callParent("init"),r.init()},release:function(){this.callParent("release"),r.release()}}),o=new s;return o}),define("module/verify/addv-company",["jquery","underscore","backbone","model/verify","plugin/dialog","module/uploadimg","module/dialogs/city","module/verify/soundselect","router","plugin/jquery.validate","module/header_search"],function(e,t,n,r,i,s,o,u,a){function c(t,n){var r=!1,i=e.trim(t).replace(/[^\x00-\xff]/ig,"x").length;return n=n||{minLength:0,maxLength:1e11},r=n.minLength<i,r&&n.maxLength&&(r=n.maxLength>i),r}var f=config.DIRECT_DTRES_ROOT+"/cover/upload",l=!1;e.validator.addMethod("Blen",function(e,t,n){return this.optional(t)||c(e,n)},""),e.validator.addMethod("remoteRequest",function(t,n,r){if(l)return l=!1,!this.invalid[n.name];var i=this,s=this.previousValue(n),o={url:r.url,type:r.type||"get",dataType:"json",success:function(o){var u=r.success&&r.success.call(i,o,t)||o;i.settings.messages[n.name].remoteRequest=u.message||s.originalMessage;var a=u.ret===!0||u.ret==="true";if(a){var f=i.formSubmitted;i.prepareElement(n),i.formSubmitted=f,i.successList.push(n),delete i.invalid[n.name],i.showErrors()}else{var l={},c=u.ret||i.defaultMessage(n,"remoteRequest");l[n.name]=s.message=e.isFunction(c)?c(value):c,i.invalid[n.name]=!0,i.showErrors(l)}s.valid=a,i.stopRequest(n,a)},error:function(){i.stopRequest(n,valid)}};for(var u in r.data)o.data={},o.data[u]=t;return t?(e.ajax(o),"pending"):(r.success&&r.success.call(i,{code:1},t),!0)});var h=n.View.extend({init:function(){var t=this,n=e("#addvForm"),r=n.attr("data-url")||"/verifications/create",u=n.validate({errorClass:"is-fail",validClass:"is-success",rules:{company_name:{required:!0,maxlength:100},weibo:{url:!0},address:{required:!0},real_name:{required:!0,maxlength:100},phone:{required:!0,cellphone:!0},email:{required:!0,email:!0},qq:{positivenumber:!0,maxlength:15},businesscard_path:{required:!0},identity_card:{required:!0,idcard:!0,maxlength:18},identity_card_front_view:{required:!0},human_category_id:{required:!0},intro:{required:!0,Blen:{minLength:0,maxLength:255}},description:{Blen:{minLength:0,maxLength:255}},expect_name:{maxlength:100,remoteRequest:{url:"/passport/profile/checkNickname",data:{nickname:!0},type:"post",success:function(t,n){var r,i=!1;t.success||n==current_user.nickname?(i=!1,t.success=!0,e(".jsQualificationpath").addClass("hidden")):(r=t.msg,t.code==3?(r="此昵称含敏感词，请上传相关资质材料证明您有权使用",i=!0,e(".jsQualificationpath").removeClass("hidden"),e('[name="qualification_path"]').val()&&(t.success=!0)):(i=!1,e(".jsQualificationpath").addClass("hidden"))),this.settings.rules.qualification_path.required=i;var s={ret:t.success||!1,message:r||"校验失败"};return s}}},qualification_path:{required:!1}},messages:{company_name:{required:"机构名不能为空",maxLength:"不超过100个字符"},weibo:{url:"url格式不对"},real_name:{required:"姓名不能为空",maxLength:"不超过100个字符"},expect_name:{maxLength:"不超过100个字符"},qualification_path:{required:"请上传资质证明"},phone:{required:"联系电话不能为空",cellphone:"联系电话格式不对"},qq:{positivenumber:"格式不对",maxLength:"格式不对,不超过15位"},email:{required:"Email不能为空",email:"Email格式不正确"},address:{required:"地址不能为空"},businesscard_path:{required:"请上传营业执照"},identity_card_front_view:{required:"请上传证件照"},identity_card:{required:"身份证号码不能为空",idcard:"身份证号码格式不对",maxlength:"身份证号码不能超过18位"},gender:{required:"请选择性别"},human_category_id:{required:"请选择电台类型"},intro:{required:"请填写电台描述",Blen:"电台描述必须在255字节以内"},description:{Blen:"其他说明必须在255字节以内"}},errorPlacement:function(t,n){e(n).after(t)},highlight:function(t,n,r){var i=e(t).addClass(n).removeClass(r);i.siblings(".icon6-ok").remove();if(i.is(":radio"))return;var s=i.siblings(".tips");s.length>0&&s.remove()},unhighlight:function(t,n,r){var i=e(t).removeClass(n).addClass(r);if(i.is(":radio"))return;i.siblings(".icon6-ok").length==0&&i.after('<i class="icon6 icon6-ok mgl-5"></i>');var s=i.siblings(".tips");s.length>0&&s.remove()},submitHandler:function(){return n.valid()&&i.confirm("亲，确认认证信息没问题并提交？",function(){t.saveData(r,t.getFormData(n),e(":submit"))},{header:"温馨提示"}),!1}});t.$el=e("#mainbox");var a=function(t){var n=t.btn;new s({url:t.url,$el:n,repeat:!0,success:function(r,i){var s=r.data[0],o=n.attr("data-path"),u=n.attr("data-img"),a=n.attr("data-pic");e("#"+a).removeClass("hidden"),e("#"+o).val(s.dfsId).blur(),e("#"+u).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+s.dfsId),t.success&&t.success()}})};e(".j-upload").each(function(t,n){var r=e(n);a({btn:r,url:f})});var c=e('[data-path="avator1"]');c.attr("id","js-uploadBtn2"),a({btn:c,url:f,success:function(){var t=e('[name="expect_name"]')[0];u.check(t),u.element(t)}}),e("#address").on("click",function(){var t=e(this);o.open(function(e,n){t.val(e+"  "+n).blur()})}),t.$el.find(".selecter.selecter-s5").selecter().on("change",function(){var t=e(this);e("#human_category_id").val(t.selecter("val")).blur()}),e("#agree").on("click",function(){var t=e(this);t.closest(".xm-checkbox").toggleClass("xm-is-checked"),e("#toNext").toggleClass("disabled").prop("disabled",!t.is(":checked"))}),e("#toNext").on("click",function(){l=!0})},getFormData:function(e){var t=e.serializeArray(),n=t.length,r={};for(var i=0;i<n;i++)r[t[i].name]=t[i].value;return r},saveData:function(t,n,r){e.ajax({url:t,type:"post",dataType:"json",data:n,success:function(e){if(e.res){if(e.hashlink){a.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else i.alert("申请失败")},beforeSend:function(){r&&r.prop("disabled",!0)},complete:function(){r&&r.prop("disabled",!1)}})},release:function(){}});return new h({model:new r})}),define("page/verify/addv-company",["jquery","underscore","backbone","module/verify/addv-company","page/page_base"],function(e,t,n,r,i){var s=i.extend({init:function(){this.callParent("init"),r.init()},release:function(){this.callParent("release"),r.release()}}),o=new s;return o}),define("module/verify/addv-person",["jquery","underscore","backbone","model/verify","plugin/dialog","module/uploadimg","module/dialogs/city","module/verify/soundselect","router","plugin/jquery.validate","module/header_search"],function(e,t,n,r,i,s,o,u,a){function c(t,n){var r=!1,i=e.trim(t).replace(/[^\x00-\xff]/ig,"x").length;return n=n||{minLength:0,maxLength:1e11},r=n.minLength<i,r&&n.maxLength&&(r=n.maxLength>i),r}var f=config.DIRECT_DTRES_ROOT+"/cover/upload",l=!1;e.validator.addMethod("Blen",function(e,t,n){return this.optional(t)||c(e,n)},""),e.validator.addMethod("remoteRequest",function(t,n,r){if(l)return l=!1,!this.invalid[n.name];var i=this,s=this.previousValue(n),o={url:r.url,type:r.type||"get",dataType:"json",success:function(o){var u=r.success&&r.success.call(i,o,t)||o;i.settings.messages[n.name].remoteRequest=u.message||s.originalMessage;var a=u.ret===!0||u.ret==="true";if(a){var f=i.formSubmitted;i.prepareElement(n),i.formSubmitted=f,i.successList.push(n),delete i.invalid[n.name],i.showErrors()}else{var l={},c=u.ret||i.defaultMessage(n,"remoteRequest");l[n.name]=s.message=e.isFunction(c)?c(value):c,i.invalid[n.name]=!0,i.showErrors(l)}s.valid=a,i.stopRequest(n,a)},error:function(){i.stopRequest(n,valid)}};for(var u in r.data)o.data={},o.data[u]=t;return t?(e.ajax(o),"pending"):(r.success&&r.success.call(i,{code:1},t),!0)});var h=n.View.extend({init:function(){var t=this,n=e("#addvForm"),r=n.attr("data-url")||"/verifications/create",u=n.validate({errorClass:"is-fail",validClass:"is-success",rules:{real_name:{required:!0,maxlength:100},identity_card:{required:!0,idcard:!0,maxlength:18},phone:{required:!0,cellphone:!0},email:{required:!0,email:!0},qq:{positivenumber:!0,maxlength:15},businesscard_path:{required:!0},address:{required:!0},gender:{required:!0},human_category_id:{required:!0},intro:{required:!0,Blen:{minLength:0,maxLength:255}},description:{Blen:{minLength:0,maxLength:255}},expect_name:{maxlength:100,remoteRequest:{url:"/passport/profile/checkNickname",data:{nickname:!0},type:"post",success:function(t,n){var r,i=!1;t.success||n==current_user.nickname?(i=!1,t.success=!0,e(".jsQualificationpath").addClass("hidden")):(r=t.msg,t.code==3?(r="此昵称含敏感词，请上传相关资质材料证明您有权使用",i=!0,e(".jsQualificationpath").removeClass("hidden"),e('[name="qualification_path"]').val()&&(t.success=!0)):(i=!1,e(".jsQualificationpath").addClass("hidden"))),this.settings.rules.qualification_path.required=i;var s={ret:t.success||!1,message:r||"校验失败"};return s}}},qualification_path:{required:!1}},messages:{real_name:{required:"姓名不能为空",maxLength:"不超过100个字符"},identity_card:{required:"身份证号码不能为空",idcard:"身份证号码格式不对",maxlength:"身份证号码不能超过18位"},expect_name:{maxLength:"不超过100个字符"},qualification_path:{required:"请上传资质证明"},phone:{required:"联系电话不能为空",cellphone:"联系电话格式不对"},qq:{positivenumber:"格式不对",maxLength:"格式不对,不超过15位"},email:{required:"Email不能为空",email:"Email格式不正确"},address:{required:"地址不能为空"},businesscard_path:{required:"请上传证件照"},gender:{required:"请选择性别"},human_category_id:{required:"请选择电台类型"},intro:{required:"请填写电台描述",Blen:"电台描述必须在255字节以内"},description:{Blen:"其他说明必须在255字节以内"}},errorPlacement:function(t,n){e(n).after(t)},highlight:function(t,n,r){var i=e(t).addClass(n).removeClass(r);i.siblings(".icon6-ok").remove();if(i.is(":radio"))return;var s=i.siblings(".tips");s.length>0&&s.remove()},unhighlight:function(t,n,r){var i=e(t).removeClass(n).addClass(r);if(i.is(":radio"))return;i.siblings(".icon6-ok").length==0&&i.after('<i class="icon6 icon6-ok mgl-5"></i>');var s=i.siblings(".tips");s.length>0&&s.remove()},submitHandler:function(){return n.valid()&&i.confirm("亲，确认认证信息没问题并提交？",function(){t.saveData(r,t.getFormData(n),e(":submit"))},{header:"温馨提示"}),!1}});t.$el=e("#mainbox");var c=e("#uploadBtn"),h=e('[data-path="avator1"]');h.attr("id","js-uploadBtn2");var p=function(t){var n=t.btn;new s({url:t.url,$el:n,repeat:!0,success:function(r,i){var s=r.data[0],o=n.attr("data-path"),u=n.attr("data-img");e("#"+o).val(s.dfsId).blur(),e("#"+u).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+s.dfsId),t.success&&t.success()}})};p({url:f,btn:c}),p({url:f,btn:h,success:function(){var t=e('[name="expect_name"]')[0];u.check(t),u.element(t)}}),e("#genderGroup").on("click","input",function(){var t=e(this),n=t.closest(".xm-radio");e("#genderGroup").find("input").prop("checked",!1),t.prop("checked",!0),n.addClass("xm-is-checked").siblings().removeClass("xm-is-checked")}),e("#address").on("click",function(){var t=e(this);o.open(function(e,n){t.val(e+"  "+n).blur()})}),t.$el.find(".selecter.selecter-s5").selecter().on("change",function(){var t=e(this);e("#human_category_id").val(t.selecter("val")).blur()}),e("#agree").on("click",function(){var t=e(this);t.closest(".xm-checkbox").toggleClass("xm-is-checked"),e("#toNext").toggleClass("disabled").prop("disabled",!t.is(":checked"))}),e("a.cancelBtn").on("click",function(){i.confirm("是否要取消加V操作？",function(){a.toPage("/")})}),e("#toNext").on("click",function(){l=!0})},getFormData:function(e){var t=e.serializeArray(),n=t.length,r={};for(var i=0;i<n;i++)r[t[i].name]=t[i].value;return r},saveData:function(t,n,r){e.ajax({url:t,type:"post",dataType:"json",data:n,success:function(e){if(e.res){if(e.hashlink){a.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else i.alert("申请失败")},beforeSend:function(){r&&r.prop("disabled",!0)},complete:function(){r&&r.prop("disabled",!1)}})},release:function(){}});return new h({model:new r})}),define("page/verify/addv-person",["jquery","underscore","backbone","module/verify/addv-person","page/page_base"],function(e,t,n,r,i){var s=i.extend({init:function(){this.callParent("init"),r.init()},release:function(){this.callParent("release"),r.release()}}),o=new s;return o}),define("module/centify/validatorUtils",["jquery"],function(e){var t={mobile:/^1(([3578][0-9])|(4[57]))[0-9]{8}$/,notempty:/^(\S+)(\s*)(\S+)$/,email:/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,idcard:/^[1-9]([0-9]{13}|[0-9]{16})([0-9]|X)$/,passport:/(^[a-zA-Z]{5,17}$)|(^[a-zA-Z0-9]{5,17}$)/,HKMacao:/^[HMhm]{1}([0-9]{10}|[0-9]{8})$/,taiwan:/(^[0-9]{8}$)|(^[0-9]{10}$)/,name:/^(([a-z\sA-Z]){4,20}|([\u4e00-\u9fa5]){2,10})$/,nickName:/^[\w\u4e00-\u9fa5]{4,20}$/,portLen:/^[\`\~\!\@\#\$\%\^\&\*\(\)\_\-\=\+\{\}\[\]\|\\\;\:\'\"\<\>\?\.\,\/a-zA-Z\d]{1,20}$/,validator:function(e,t){var n=!1;return this[t]&&this[t].test(e)&&(n=!0),n},validatorLength:function(e,t,n){t=+t,n=+n;var r=!1,i=e.replace(/[\u0391-\uFFE5]/g,"XX"),s=i.length;n=n||t;if(t>n){var o=t;t=n,n=o}return s>=t&&s<=n&&(r=!0),r},showError:function(e,t){t?e.text(t):"",e.removeClass("hidden")},hiddenError:function(e,t){t?e.text(t):"",e.addClass("hidden")},autoTips:function(e,t,n){e.val(e.val().trim());var r=e.parent().find(".j-tips");typeof n=="object"&&(r=n),typeof n=="string"&&r.text(n);var i;if(t.indexOf("-")!=-1){var s=/^(\d+)-(\d+)$/g;return i=this.validatorLength(e.val(),t.replace(s,"$1"),t.replace(s,"$2")),i?this.hiddenError(r):this.showError(r),i}return i=this.validator(e.val(),t),i?this.hiddenError(r):this.showError(r),i},checkValidIdCard:function(t,n,r){var i=this,s=n.val(),o=n.parent().find(".j-tips");e.ajax({url:"/verify/checkValidCardId",type:"post",dataType:"json",data:{card_id:s,card_type:r},success:function(e){t(e),e.res?i.hiddenError(o):i.showError(o,"该证件已实名，请重新输入")}})},checkNickname:function(t,n,r){var i=this,s=n.val(),o=n.parent().find(".j-tips");e.ajax({url:"/passport/profile/checkNickname",type:"post",dataType:"json",data:{nickname:s},success:function(e){if(e.success||r==s)e.success=!0;t(e),e.success?i.hiddenError(o):i.showError(o,e.msg||"校验失败！")}})},authGetWeiboInfo:function(t){t=t||e.noop;var n="getWeiboInfo";window.open("/passport/v1/thirdparty/1/authorize?customerFunction="+n,"","height=560, width=760, left=400"),window[n]=function(r){e.get("/verify/getWeiboUserInfo",function(e){e.res&&t(e.data)}),window[n]=null}}};return t}),define("page/centify/personal",["jquery","page/page_base","module/uploadimg","module/centify/validatorUtils","module/dialogs/bindmobile","plugin/animation","plugin/dialog","plugin/jquery.selecter","plugin/jquery-qrcode"],function(e,t,n,r,i,s,o){var u=config.DIRECT_DTRES_ROOT+"/cover/upload",a={"二代身份证":"idcard","护照":"portLen","台湾居民来往大陆通行证":"portLen","港澳居民来往大陆通行证":"portLen"},f=function(t){var r=t.btn,i=r.siblings(".imgFace");new n({url:t.url,$el:r,repeat:!0,beforeUpload:function(){i.addClass("is-loading")},success:function(n,s){var o=n.data[0],u=r.attr("data-path"),a=r.attr("data-img");e("#"+u).val(o.dfsId).blur(),e("#"+a).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+o.dfsId),t.success&&t.success(),i.removeClass("is-loading")}})};f({url:u,btn:e(".j-upload")}),f({url:u,btn:e(".j-qualification"),success:function(){var t=e('[name="expect_name"]');t.siblings(".j-tips").addClass("hidden"),l.qualification_path=!0,l.expect_name=!0}});var l={real_name:!1,identity_card:!1,businesscard_path:!1,qualification_path:!0,description:!0},c=!1,h=e(".j-submit"),p=e('[name="real_name"]'),d=e('[name="identity_card"]'),v=e('[name="businesscard_path"]'),m=e('[name="qualification_path"]'),g=e('textarea[name="description"]'),y=t.extend({init:function(){this.generQrcode(),this.bindValidatorEvents(),this.ailAuthSuccessJump(),this.bindEvents()},generQrcode:function(){var t=window.location.host.indexOf("test")!==-1?".test":"";e(".qrcode-img").qrcode({width:150,height:150,text:"http://hybrid"+t+".ximalaya.com/hybrid/api/layout/addv/person"})},bindValidatorEvents:function(){var t=this;p.off().on("blur",function(){l.real_name=r.autoTips(e(this),"name","请填写正确的姓名，4～20个字符（仅支持汉字、英文）")}),d.off().on("blur",function(){var t=e(this).attr("data-type"),n=a[t]||"idcard",i=e(this);l.identity_card=r.autoTips(i,n,"请输入正确的证件号"),l.identity_card&&r.checkValidIdCard(function(e){l.identity_card_async=e.res},i,t)}),v.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");l.businesscard_path=r.autoTips(e(this),"notempty",t)}),m.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");l.qualification_path=r.autoTips(e(this),"notempty",t)}),g.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips"),n=e(this);n.val(n.val().trim()),l.description=r.autoTips(e(this),"0-255","补充个人资料长度在255字符以内")}),h.on("click",function(n){n.preventDefault();var r;e.each(l,function(t,n){c=!0;if(!n)return t.indexOf("_async")>=0&&(t=t.replace("_async","")),r=e('[name="'+t+'"]'),r.trigger("blur"),c=!1,!1});var i={card_type:e(".j-peperSlt").find(".selecter-text").text(),real_name:p.val(),identity_card:d.val(),businesscard_path:v.val(),qualification_path:m.val(),category_id:e(".anchor-type").find(".type-item.active").attr("data-value"),description:g.val()};c?(xmLog("pv.send","event",{srcPage:"个人认证",srcModule:"确认并提交",serviceId:"pageClick",item:"button",itemId:"提交资料"}),t.submitData(i)):s(e(document).scrollTop(),r.parent().offset().top-30,300,"quad.easeOut",function(t){e(document).scrollTop(t)})})},bindEvents:function(){function n(n){var i=e(".j-peperSlt").attr("data-aliauth")=="true";n==="0"&&i?(e("#ali-type").removeClass("hidden"),e("#not-ali-type").addClass("hidden"),t.ailAuthSuccessJump()):(e("#ali-type").addClass("hidden"),e("#not-ali-type").removeClass("hidden"),t.timer&&clearInterval(t.timer)),r(n)}function r(e){var t=v.parents(".formItem"),n=t.find(".inl-b.need"),r=t.find(".imgFace");e==="0"?(n.text("手持身份证正面照:"),r.removeClass("other")):(n.text("手持证件个人页:"),r.addClass("other"))}var t=this;xmLog&&xmLog("pv.create",{item:"个人认证",serviceId:"viewItem"}),e(".j-peperSlt").on("click",function(t){t.stopPropagation();var n=e(this);n.toggleClass("open")}),e(".j-peperSlt").find(".selecter-options").on("click",function(t){var r=e(t.target),i=r.attr("data-type");e(".j-peperSlt").find(".selecter-text").text(r.text()).attr("data-type",i),d.attr("data-type",r.text()),d.val().length>0&&d.trigger("blur"),n(i)}),e(".anchor-type").on("click",".type-item",function(t){var n=e(t.currentTarget),r=e(t.delegateTarget);r.find(".type-item").removeClass("active"),n.addClass("active")}),e(document).on("click",function(){e(".j-peperSlt").removeClass("open")});var i=e(".word-count");g.on("input",function(t){var n=e(this),r=n.val().trim().replace(/[\u0391-\uFFE5]/g,"XX").length;i.html(r+"/255"),r>255?i.addClass("c09"):i.removeClass("c09")})},submitData:function(t){if(h.hasClass("already"))return;e.ajax({url:"/verify/personal/new",type:"post",dataType:"json",data:t,success:function(e){if(e.res){if(e.hashlink){router.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else o.alert("申请失败")},beforeSend:function(){h.addClass("already")},complete:function(){h.removeClass("already")}})},ailAuthSuccessJump:function(){function i(){return n.attr("data-type")=="0"}function s(n){e.ajax({url:"/verify/veirfyStatus",type:"get",success:function(e){e.res&&e.status==1&&(t.timer&&clearInterval(t.timer),window.location.href="/verify/success")}})}var t=this,n=e(".j-peperSlt").find(".selecter-text"),r=e(".j-peperSlt").attr("data-aliauth")=="true";r&&i()&&(this.timer=setInterval(s,2e3))}}),b=new y;return b}),define("page/centify/company",["jquery","page/page_base","module/uploadimg","module/dialogs/city","module/centify/validatorUtils","module/dialogs/bindmobile","plugin/animation","plugin/dialog"],function(e,t,n,r,i,s,o,u){var a=config.DIRECT_DTRES_ROOT+"/cover/upload",f={"二代身份证":"idcard","护照":"portLen","台湾居民来往大陆通行证":"portLen","港澳居民来往大陆通行证":"portLen"},l=!1,c=function(t){var r=t.btn,i=r.siblings(".imgFace");new n({url:t.url,$el:r,repeat:!0,beforeUpload:function(){i.addClass("is-loading")},success:function(n,s){var o=n.data[0],u=r.attr("data-path"),a=r.attr("data-img"),f=r.attr("data-pic");e("#"+f).removeClass("hidden"),e("#"+u).val(o.dfsId).blur(),e("#"+a).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+o.dfsId),t.success&&t.success(),i.removeClass("is-loading")}})};e(".j-upload").each(function(t,n){var r=e(n);c({btn:r,url:a})}),c({url:a,btn:e(".j-qualification"),success:function(){var t=e('[name="expect_name"]');t.siblings(".j-tips").addClass("hidden"),h.qualification_path=!0,h.expect_name=!0}});var h={company_name:!1,address:!1,businesscard_path:!1,real_name:!1,identity_card:!1,identity_card_front_view:!1,qualification_path:!0,description:!0},p=!1,d=e(".j-submit"),v=e('[name="company_name"]'),m=e('[name="address"]'),g=e('[name="real_name"]'),y=e('[name="identity_card"]'),b=e('[name="businesscard_path"]'),w=e('[name="identity_card_front_view"]'),E=e('[name="qualification_path"]'),S=e('textarea[name="description"]'),x=t.extend({init:function(){this.bindValidatorEvents(),this.bindEvents()},bindValidatorEvents:function(){var t=this;v.off().on("blur",function(){h.company_name=i.autoTips(e(this),"notempty")}),m.off().on("blur",function(){h.address=i.autoTips(e(this),"notempty")}),g.off().on("blur",function(){h.real_name=i.autoTips(e(this),"name","请填写正确的姓名，4～20个字符（仅支持汉字、英文）")}),y.off().on("blur input",function(){var t=e(this).attr("data-type"),n=f[t]||"idcard",r=e(this);h.identity_card=i.autoTips(r,n,"请输入正确的证件号"),h.identity_card&&i.checkValidIdCard(function(e){h.identity_card_async=e.res},r,t)}),b.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");h.businesscard_path=i.autoTips(e(this),"notempty",t)}),w.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");h.identity_card_front_view=i.autoTips(e(this),"notempty",t)}),E.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");h.qualification_path=i.autoTips(e(this),"notempty",t)}),S.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips"),n=e(this);n.val(n.val().trim()),h.description=i.autoTips(e(this),"0-255","补充个人资料长度在255字符以内")}),d.on("click",function(n){n.preventDefault();var r;e.each(h,function(t,n){p=!0;if(!n)return t.indexOf("_async")>=0&&(t=t.replace("_async","")),r=e('[name="'+t+'"]'),r.trigger("blur"),p=!1,!1});var i={company_name:v.val(),address:m.val(),is_bind_weibo:l,businesscard_path:b.val(),card_type:e(".j-peperSlt").find(".selecter-text").text(),real_name:g.val(),identity_card:y.val(),identity_card_front_view:w.val(),qualification_path:E.val(),category_id:e(".anchor-type").find(".type-item.active").attr("data-value"),description:S.val()};p?(xmLog("pv.send","event",{srcPage:"机构认证",srcModule:"确认并提交",serviceId:"pageClick",item:"button",itemId:"提交资料"}),t.submitData(i)):o(e(document).scrollTop(),r.parent().offset().top-30,300,"quad.easeOut",function(t){e(document).scrollTop(t)})})},bindEvents:function(){function t(e){var t=w.parents(".formItem"),n=t.find(".inl-b.need"),r=t.find(".imgFace");e==="0"?(n.text("手持身份证正面照:"),r.removeClass("other")):(n.text("手持证件个人页:"),r.addClass("other"))}xmLog&&xmLog("pv.create",{item:"机构认证",serviceId:"viewItem"}),e(".j-address").on("click",function(){var t=e(this),n=t.find(".j-tips");r.open(function(e,r){var i=e+"  "+r;m.val(i).blur(),t.find(".selecter-text").text(i),n.addClass("hidden")})}),e(".j-change").on("click",function(t){t.preventDefault(),s.open(!0,function(t){var n;t.areaCode=="+86"?n=t.areaCode+"-"+t.phone:n="+"+t.phone,e(".j-phone").text(n)},{oldMobile:e(".j-phone").text().split("-")[1]})}),e(".regCheckLab").on("click",function(){e(".j-submit").toggleClass("btn-disable")}),e(".j-peperSlt").on("click",function(t){t.stopPropagation();var n=e(this);n.toggleClass("open")}),e(".j-peperSlt").find(".selecter-options").on("click",function(n){var r=e(n.target),i=r.attr("data-type");e(".j-peperSlt").find(".selecter-text").text(r.text()),y.attr("data-type",r.text()),y.val().length>0&&y.trigger("blur"),t(i)}),e(".anchor-type").on("click",".type-item",function(t){var n=e(t.currentTarget),r=e(t.delegateTarget);r.find(".type-item").removeClass("active"),n.addClass("active")}),e(document).on("click",function(){e(".j-peperSlt").removeClass("open")}),e(".j-weiboBtn").on("click",function(t){var n=e(this);t.preventDefault(),i.authGetWeiboInfo(function(e){n.text("已授权"),l=!0})});var n=e(".word-count");S.on("input",function(t){var r=e(this),i=r.val().trim().replace(/[\u0391-\uFFE5]/g,"XX").length;n.html(i+"/255"),i>255?n.addClass("c09"):n.removeClass("c09")})},submitData:function(t){if(d.hasClass("already"))return;e.ajax({url:"/verify/company/new",type:"post",dataType:"json",data:t,success:function(e){if(e.res){if(e.hashlink){router.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else u.alert("申请失败")},beforeSend:function(){d.addClass("already")},complete:function(){d.removeClass("already")}})}}),T=new x;return T}),define("page/centify/star",["jquery","page/page_base","module/uploadimg","module/centify/validatorUtils","module/dialogs/bindmobile","plugin/animation","plugin/dialog","plugin/jquery.input"],function(e,t,n,r,i,s,o){function y(){var t=e(".j-auth"),n=e(".j-weibo_name"),r=e(".j-fans"),i=e(".j-verify_intro"),s=e(".j-is_v"),o=e(".j-recent_publish_content");t.text("已授权 >"),n.text(a.weiboName),r.text(a.fans),i.text(a.verifyIntro===""?"无":a.verifyIntro),s.text(a.isV?"是":"否"),o.text("评论："+a.recentPublishComments+"  转发："+a.recentPublishRepost),b()?(l[".j-auth"]=!0,e(".formWarnBar").addClass("hidden"),e(this).siblings(".j-tips").addClass("hidden")):e(".formWarnBar").removeClass("hidden")}function b(){var t,n={isV:!1,isRecentNumSatisfied:!1,isFansSatisfied:!1};n.isV=a.isV,n.isRecentNumSatisfied=a.recentPublishComments>50&&a.recentPublishRepost>50,n.isFansSatisfied=a.fans>=5e5;var r=0;return e.each(n,function(e,n){if(e==="isFansSatisfied")return;n?r++:"",t=r>=1}),n.isFansSatisfied&&t}var u=config.DIRECT_DTRES_ROOT+"/cover/upload",a={weiboName:"",fans:0,isV:!1,verifyIntro:"",recentPublishContent:"",recentPublishComments:0,recentPublishRepost:0,recentPublishPraise:0},f=function(t){var r=t.btn,i=r.siblings(".imgFace");new n({url:t.url,$el:r,repeat:!0,beforeUpload:function(){i.addClass("is-loading")},success:function(n,s){var o=n.data[0],u=r.attr("data-path"),a=r.attr("data-img"),f=r.attr("data-pic");e("#"+f).removeClass("hidden"),e("#"+u).val(o.dfsId).blur(),e("#"+a).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+o.dfsId),t.success&&t.success(),i.removeClass("is-loading")}})};e(".j-upload").each(function(t,n){var r=e(n);f({btn:r,url:u})});var l={".j-auth":!1,intro:!1},c=!1,h=e(".j-submit"),p=e('[name="intro"]'),d=e('[name="indentiyType"]'),v=e('[name="card"]'),m=e('[name="businesscard_path"]'),g=e('[name="identity_card_front_view"]'),w=t.extend({init:function(){this.beautify_radio(d),this.bindValidatorEvents(),this.handlerNoPhone(),this.bindEvents()},handlerNoPhone:function(){var t=e(".j-phone").html();if(t==""||t=="null")return o.alert("请前往账号设置绑定手机"),!0},bindValidatorEvents:function(){var t=this;p.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips"),n=e(this);n.val(n.val().trim());if(n.val()==""){l.intro=r.autoTips(e(this),"notempty","请填写您的简介");return}l.intro=r.autoTips(e(this),"1-255","简介长度在255字符以内")}),e(".j-auth").on("click",function(e){e.preventDefault();var t=this;r.authGetWeiboInfo(function(e){a=e,y.call(t)})}),h.on("click",function(n){n.preventDefault();if(t.handlerNoPhone())return;var r;e.each(l,function(t,n){c=!0;if(!n)return t.indexOf("_async")>=0&&(t=t.replace("_async","")),r=e('[name="'+t+'"]').length>0?e('[name="'+t+'"]'):e(t),r.trigger("blur"),c=!1,!1});var i={weibo_name:a.weiboName,fans:a.fans,verify_intro:a.verifyIntro,is_v:a.isV,recent_publish_content:a.recentPublishContent,recent_publish_comments:a.recentPublishComments,recent_publish_repost:a.recentPublishRepost,recent_publish_praise:a.recentPublishPraise,phone:e(".j-phone").text(),intro:p.val(),indentiyType:e('[name="indentiyType"][checked]').val(),card:v.val(),businesscard_path:m.val(),identity_card_front_view:g.val()};c?(xmLog("pv.send","event",{srcPage:"名人名企通道",item:"button",itemId:"提交资料",serviceId:"pageClick"}),t.submitData(i)):s(e(document).scrollTop(),r.parent().offset().top-500,300,"quad.easeOut",function(t){e(document).scrollTop(t)})})},bindEvents:function(){xmLog&&xmLog("pv.create",{item:"名人名企",serviceId:"viewItem"}),e(".j-change").on("click",function(t){t.preventDefault(),i.open(!0,function(t){var n;t.areaCode=="+86"?n=t.areaCode+"-"+t.phone:n="+"+t.phone,e(".j-phone").text(n)},{oldMobile:e(".j-phone").text().split("-")[1]})}),e(".regCheckLab").on("click",function(){e(".j-submit").toggleClass("btn-disable")}),e(".formWarnBar").on("click","a",function(){xmLog("pv.send","event",{srcPage:"名人名企通道",item:"button",itemId:"选择其他认证方式",serviceId:"pageClick"})})},submitData:function(t){if(h.hasClass("already"))return;e.ajax({url:"/verify/star/new",type:"post",dataType:"json",data:t,success:function(e){if(e.res){if(e.hashlink){router.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else o.alert("申请失败")},beforeSend:function(){h.addClass("already")},complete:function(){h.removeClass("already")}})},beautify_radio:function(t){function n(t){e(),t=="1"?(e(".personal-type").removeClass("hidden"),e(".company-type").addClass("hidden")):(e(".personal-type").addClass("hidden"),e(".company-type").removeClass("hidden"))}t.each(function(){var t=e(this),r=t.closest("label"),i=r.closest(".reform"),s=i.find('input:radio[name="'+t.attr("name")+'"]'),o=e(s);t.on("change",function(){o.attr("checked",!1).closest(".xm-radio").removeClass("xm-is-checked"),r.addClass("xm-is-checked"),e(this).attr("checked",!0),n(e(this).val())}),t.is(":checked")&&t.trigger("change")})}}),E=new w;return E}),define("page/centify/guide",["jquery","page/page_base"],function(e,t){var n=t.extend({init:function(){xmLog&&xmLog("pv.create",{item:"主播宣传页"}),xmLog("pv.send","event",{serviceId:"viewitem",item:"主播宣传页"}),this.bindEvents()},bindEvents:function(){e(document).ready(function(){function f(e){var t=e.detail||-e.wheelDelta;o=Date.now(),u-o<-1200?(t>0&&(a++,a>=3&&(a=3),l(a)),t<0&&(a--,a<=0&&(a=0),l(a)),u=Date.now()):e.preventDefault()}function l(e){n.removeClass("on"),n.eq(e).addClass("on"),t.css({transform:"translateY("+ -e+"00%)"})}var t=e(".extendWrap"),n=e(".extdDot"),r=e(".extdLink"),i=e(".extdNext"),s=e(".extdSubmit");i.on("click",function(e){e.preventDefault()});var o=0,u=0,a=0;navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?document.addEventListener("DOMMouseScroll",f,!1):document.addEventListener?document.addEventListener("mousewheel",f,!1):document.attachEvent?document.attachEvent("onmousewheel",f):document.onmousewheel=f,n.each(function(e){n[e].onclick=function(){a=e,l(e)}}),r.each(function(e){r[e].onclick=function(t){t.preventDefault(),a=e+1,l(e+1)}})}),e(".extdSubmit").on("click",function(){e(this).text()=="立即认证"&&xmLog("pv.send","event",{srcPage:"主播宣传页	",serviceId:"pageClick",item:"button",itemId:"立即认证"})})}}),r=new n;return r}),define("page/centify/companyModify",["jquery","page/page_base","module/uploadimg","module/dialogs/city","module/centify/validatorUtils","plugin/animation","plugin/dialog"],function(e,t,n,r,i,s,o){var u=location.search.replace(/\?action\=/g,""),a=config.DIRECT_DTRES_ROOT+"/cover/upload",f={"二代身份证":"idcard","护照":"portLen","台湾居民来往大陆通行证":"portLen","港澳居民来往大陆通行证":"portLen"},l=e('[name="identity_card"]').val(),c=function(t){var r=t.btn,i=r.siblings(".imgFace");new n({url:t.url,$el:r,repeat:!0,beforeUpload:function(){i.addClass("is-loading")},success:function(n,s){var o=n.data[0],u=r.attr("data-path"),a=r.attr("data-img"),f=r.attr("data-pic");e("#"+f).removeClass("hidden"),e("#"+u).val(o.dfsId).blur(),e("#"+a).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+o.dfsId),t.success&&t.success(),i.removeClass("is-loading")}})};e(".j-upload").each(function(t,n){var r=e(n);c({btn:r,url:a})});var h={company_name:!1,address:!1,businesscard_path:!1,real_name:!0,identity_card:!0,identity_card_front_view:!1,qualification_path:!0,description:!0},p=!1,d=e(".j-submit"),v=e('[name="company_name"]'),m=e('[name="address"]'),g=e('[name="real_name"]'),y=e('[name="identity_card"]'),b=e('[name="businesscard_path"]'),w=e('[name="identity_card_front_view"]'),E=t.extend({init:function(){this.bindValidatorEvents(),this.bindEvents()},bindEvents:function(){function t(e){var t=w.parents(".formItem"),n=t.find(".inl-b.need"),r=t.find(".imgFace");e==="0"?(n.text("手持身份证正面照:"),r.removeClass("other")):(n.text("手持证件个人页:"),r.addClass("other"))}e(".j-address").on("click",function(){var t=e(this),n=t.find(".j-tips");r.open(function(e,r){var i=e+"  "+r;m.val(i).blur(),t.find(".selecter-text").text(i),n.addClass("hidden")})}),e(".regCheckLab").on("click",function(){e(".j-submit").toggleClass("btn-disable")}),e(".j-peperSlt").on("click",function(t){t.stopPropagation();var n=e(this);n.toggleClass("open")}),e(".j-peperSlt").find(".selecter-options").on("click",function(n){var r=e(n.target),i=r.attr("data-type");e(".j-peperSlt").find(".selecter-text").text(r.text()),y.attr("data-type",r.text()),y.val().length>0&&y.trigger("blur"),t(i)})},bindValidatorEvents:function(){var t=this;v.off().on("blur",function(){h.company_name=i.autoTips(e(this),"notempty")}),m.off().on("blur",function(){h.address=i.autoTips(e(this),"notempty")}),b.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");h.businesscard_path=i.autoTips(e(this),"notempty",t)}),g.off().on("blur",function(){h.real_name=i.autoTips(e(this),"name","请填写正确的姓名，4～20个字符（仅支持汉字、英文）")}),y.off().on("blur input",function(t){var n=e(this).attr("data-type"),r=f[n]||"idcard",s=e(this);h.identity_card=i.autoTips(s,r,"请输入正确的证件号");if(l!=""&&l==s.val())return h.identity_card=!0,!1;h.identity_card&&i.checkValidIdCard(function(e){h.identity_card_async=e.res},s,n)}),w.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");h.identity_card_front_view=i.autoTips(e(this),"notempty",t)}),d.on("click",function(n){n.preventDefault();var r;e.each(h,function(t,n){p=!0;if(!n)return t.indexOf("_async")>=0&&(t=t.replace("_async","")),r=e('[name="'+t+'"]'),r.trigger("blur"),p=!1,!1});var i={company_name:v.val(),address:m.val(),businesscard_path:b.val(),card_type:e(".j-peperSlt").find(".selecter-text").text(),real_name:g.val(),identity_card:y.val(),identity_card_front_view:w.val(),action:u};p?t.submitData(i):s(e(document).scrollTop(),r.parent().offset().top-30,300,"quad.easeOut",function(t){e(document).scrollTop(t)})})},submitData:function(t){if(d.hasClass("already"))return;e.ajax({url:"/verify/modify/company",type:"post",dataType:"json",data:t,success:function(e){if(e.res){if(e.hashlink){router.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else o.alert("申请失败")},beforeSend:function(){d.addClass("already")}})}}),S=new E;return S}),define("page/centify/personalModify",["jquery","page/page_base","module/uploadimg","module/dialogs/city","module/centify/validatorUtils","plugin/animation","plugin/dialog"],function(e,t,n,r,i,s,o){var u=location.search.replace(/\?action\=/g,""),a=config.DIRECT_DTRES_ROOT+"/cover/upload",f={"二代身份证":"idcard","护照":"portLen","台湾居民来往大陆通行证":"portLen","港澳居民来往大陆通行证":"portLen"},l=e('[name="identity_card"]').val(),c=function(t){var r=t.btn,i=r.siblings(".imgFace");new n({url:t.url,$el:r,repeat:!0,beforeUpload:function(){i.addClass("is-loading")},success:function(n,s){var o=n.data[0],u=r.attr("data-path"),a=r.attr("data-img");e("#"+u).val(o.dfsId).blur(),e("#"+a).removeClass("hidden").attr("src",config.FDFS_PATH+"//"+o.dfsId),t.success&&t.success(),i.removeClass("is-loading")}})};c({url:a,btn:e(".j-upload")});var h={real_name:!1,identity_card:!1,businesscard_path:!1,qualification_path:!0},p=!1,d=e(".j-submit"),v=e('[name="real_name"]'),m=e('[name="identity_card"]'),g=e('[name="businesscard_path"]'),y=e('[name="qualification_path"]'),b=t.extend({init:function(){this.bindValidatorEvents(),this.bindEvents()},bindEvents:function(){function n(e){var t=g.parents(".formItem"),n=t.find(".inl-b.need"),r=t.find(".imgFace");e==="0"?(n.text("手持身份证正面照:"),r.removeClass("other")):(n.text("手持证件个人页:"),r.addClass("other"))}var t=this;e(".j-peperSlt").on("click",function(t){t.stopPropagation();var n=e(this);n.toggleClass("open")}),e(".j-peperSlt").find(".selecter-options").on("click",function(t){var r=e(t.target),i=r.attr("data-type");e(".j-peperSlt").find(".selecter-text").text(r.text()).attr("data-type",i),m.attr("data-type",r.text()),m.val().length>0&&m.trigger("blur"),n(i)}),e(document).on("click",function(){e(".j-peperSlt").removeClass("open")}),e(".regCheckLab").on("click",function(){e(".j-submit").toggleClass("btn-disable")})},bindValidatorEvents:function(){var t=this;v.off().on("blur",function(){h.real_name=i.autoTips(e(this),"name","请填写正确的姓名，4～20个字符（仅支持汉字、英文）")}),m.off().on("blur",function(){var t=e(this).attr("data-type"),n=f[t]||"idcard",r=e(this);h.identity_card=i.autoTips(r,n,"请输入正确的证件号");if(l!=""&&l==r.val())return h.identity_card=!0,!1;h.identity_card&&i.checkValidIdCard(function(e){h.identity_card_async=e.res},r,t)}),g.off().on("blur",function(){var t=e(this).closest(".formArea").find(".j-tips");h.businesscard_path=i.autoTips(e(this),"notempty",t)}),d.on("click",function(n){n.preventDefault();var r;e.each(h,function(t,n){p=!0;if(!n)return t.indexOf("_async")>=0&&(t=t.replace("_async","")),r=e('[name="'+t+'"]'),r.trigger("blur"),p=!1,!1});var i={card_type:e(".j-peperSlt").find(".selecter-text").text(),real_name:v.val(),identity_card:m.val(),businesscard_path:g.val(),action:u};p?t.submitData(i):s(e(document).scrollTop(),r.parent().offset().top-30,300,"quad.easeOut",function(t){e(document).scrollTop(t)})})},submitData:function(t){if(d.hasClass("already"))return;e.ajax({url:"/verify/modify/personal",type:"post",dataType:"json",data:t,success:function(e){if(e.res){if(e.hashlink){router.toPage(e.redirect_url);return}window.location.href=e.redirect_url}else o.alert("申请失败")},beforeSend:function(){d.addClass("already")}})}}),w=new b;return w}),define("page/vip/vip_create",["jquery","underscore","backbone","page/page_base","plugin/dialog","page/center/common","plugin/jquery.validate","module/uploadimg","plugin/jquery.input","module/common/form_editor","router","module/dialogs/create_album"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=r.extend({$el:e("#mainbox"),init:function(){s.init(),this.bindEvents(),e("input").beautify(),e.ajaxSetup({cache:!1}),e(".qr-code").qrcode({render:"table",correctLevel:1,width:120,height:120,text:e(".qr-code").attr("data-url")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)}},bindEvents:function(){var t=this;t.actInit(),t.initUploadImg(),t.fmtNum("[name=or-price]"),t.fmtNum("[name=dis-price]"),t.checkCount(e("[name=maintitle]"),12),t.checkCount(e("[name=subtitle]"),20),t.checkCount(e("[name=name]"),12),t.checkCount(e("[name=exp]"),200),e(".j-viewBtn").on("click",function(e){e.preventDefault(),t.popView()});var n=t.newAlbum();e(".j-createBtn").on("click",function(e){e.preventDefault(),n.open()});var r=e(".j-form").eq(1).find("ul li"),i=[];e.each(r,function(){i.push(parseInt(e(this).attr("data-album-id")))}),i.length===0?t.para.mid=0:t.para.mid=Math.max.apply(null,i)},para:{aidArr:[],mid:""},fmtNum:function(t){e(t).on("blur",function(){var t=e(this).val();/^[0-9]+(.[0-9]{2})?$/.test(t)&&e(this).val(parseFloat(t))})},newAlbum:function(){var t=e.cookie(config.TOKEN_LABEL).split("&")[0],n=this,r=new c({sureText:"创建专辑",isVip:!0},function(r){var i=r.album.id;n.para.aidArr.push(i+""),n.setAlbumIds(n.para.aidArr),e.get("/center/membership/getPaidAlbums",{uid:t,oldBlackMaxId:n.para.mid,page:1}).done(function(t){var n=e(".j-album-label"),r=e("<div></div").html(t.Html);n.next().remove(),r.insertAfter(n),e("#j-albumDiv").attr("check","1")}).done(function(){var t=e(".j-form").eq(1).find("ul"),r=e("[name=album-selected]");r.attr("validate","true"),n.checkSelectAlbum(t,r)})});return r},popView:function(){var e='<div class="phone-container rel"><div class="abs phone-img"><img class="preview-content" src="'+config.STATIC_ROOT+'/css/pay-member/preview.png">'+"</div>"+"</div>",t={dialogClass:"pop-vip",close:!1,header:"",fixed:!1,width:"auto",content:e,template:{dialog_body:'<div class="" dialog-role="body"></div>',dialog_container:'<div class="popup" dialog-role="container" style="border:0"></div>'}},n=new i.Dialog(t);n.open()},qaPop:function(){var e='<div class="identy-pop">    <h3>开启确认</h3>    <p>        开启后，会员可以免费旁听您回答过的所有付费问题哦~<br/>        确定开启吗？    </p>    <div class="button">        <a class="inl-b mgr-20 qa-submit">确认</a>        <a class="inl-b pre qa-cancel" dialog-role="close">取消</a>    </div></div>',t={dialogClass:"",header:"",close:!0,width:400,content:e},n=new i.Dialog(t);return n},checkEditorLen:function(t,n){var r={},i=e('[name="'+n+'"]'),s=i.siblings(".j-tip"),o=i.siblings(".j-count"),u=i.val().split("<img").length-1;return n==="other-right"?$nextBtn=e("#form2Next"):$nextBtn=e("#form1Btn"),t===0&&u===0?n==="intro-info"?(r.tip="请填写会员服务介绍",$nextBtn.css("pointer-events","none")):n==="buy-info"&&(r.tip="请填写购买须知",$nextBtn.css("pointer-events","none")):t>500?(r.tip="最多500个字",$nextBtn.css("pointer-events","none")):u>10?(r.tip="最多10张图片",$nextBtn.css("pointer-events","none")):(r.tip="",$nextBtn.css("pointer-events","auto")),r.count=t+"/500",s.text(r.tip),o.text(r.count),t>500?o.addClass("text-red"):o.removeClass("text-red"),r},actInit:function(){var t=this,n=e(".j-form"),r=e(".j-steptab").find(".cell");e(".j-qaBtn a").on("click",function(){var n=t.qaPop(),r=e(this);r.hasClass("disabled-white")?"":n.open(),e(document).off("click",".qa-submit"),e(document).on("click",".qa-submit",function(){e("[name=hotlineRight]").val(2),e(".j-qaBtn a").addClass("disabled-white").text("已开启"),n.close()})});var s=new f(e(n[0])),o=s.initRichEditor({name:"intro-info-input",richName:"intro-info",onfocus:function(){e("[name=intro-info]").siblings(".area-mask").hide(),t.checkEditorLen(s.getCount(o),"intro-info")},onblur:function(){var n=e("[name=intro-info]"),r=n.val().length;r===0&&n.siblings(".area-mask").show(),t.checkEditorLen(s.getCount(o),"intro-info")},onchange:function(){t.checkEditorLen(s.getCount(o),"intro-info")}}),u=s.initRichEditor({name:"fit-person-input",richName:"fit-person",onfocus:function(){e("[name=fit-person]").siblings(".area-mask").hide(),t.checkEditorLen(s.getCount(u),"fit-person")},onblur:function(){var n=e("[name=fit-person]"),r=n.val().length;r===0&&n.siblings(".area-mask").show(),t.checkEditorLen(r,"fit-person")},onchange:function(){t.checkEditorLen(s.getCount(u),"fit-person")}}),a=s.initRichEditor({name:"buy-info-input",richName:"buy-info",onfocus:function(){e("[name=buy-info]").siblings(".area-mask").hide(),t.checkEditorLen(s.getCount(a),"buy-info")},onblur:function(){var n=e("[name=buy-info]"),r=n.val().length;r===0&&n.siblings(".area-mask").show(),t.checkEditorLen(r,"buy-info")},onchange:function(){t.checkEditorLen(s.getCount(a),"buy-info")}}),l=s.initRichEditor({name:"other-right-input",richName:"other-right",onfocus:function(){t.checkEditorLen(s.getCount(l),"other-right")},onblur:function(){t.checkEditorLen(s.getCount(l),"other-right")},onchange:function(){t.checkEditorLen(s.getCount(l),"other-right")}});e(".area-mask").on("click",function(){var t=e(this).attr("type");e(this).hide();switch(t){case"intro-info":o.focus();break;case"fit-person":u.focus();break;case"buy-info":a.focus()}}),t.formCheck(n,r),e(document).on("click",".j-copyright input",function(){var t=e(".j-submitBtn");e(this).prop("checked")?t.removeClass("disabled-white"):t.addClass("disabled-white")});for(var c=n.length;c--;)(function(u,f){var l=f.find(".button");l.on("click",".j-nextBtn",function(e){e.preventDefault(),u===0?s.getCount(o)===0?o.focus():s.getCount(a)===0?a.focus():f.submit():f.submit()}).on("click",".j-prevBtn",function(e){e.preventDefault(),t.shiftTab(r,n,u-1)}).on("click",".j-submitBtn",function(s){var o=e(this).attr("data-url"),a={title:e("[name=maintitle]").val(),subtitle:e("[name=subtitle]").val(),zhuboName:e("[name=name]").val(),personalDescription:e("[name=title]").val(),experience:e("[name=exp]").val(),bannerUrl:e("[name=intro-img]").val(),achieve:e("[name=intro-info]").val(),suitable:e("[name=fit-person]").val(),buyNotes:e("[name=buy-info]").val(),freeAlbumIds:e("[name=album-selected]").val(),personalizedRight:e("[name=other-right]").val(),price:e("[name=or-price]").val(),discountedPrice:e("[name=dis-price]").val(),cardCoverUrl:e("[name=card]").val(),hotlineRight:e("[name=hotlineRight]").val()};e.ajax({url:o,type:"POST",dataType:"json",data:JSON.stringify(a),contentType:"application/json"}).done(function(e){e.res===!0?t.shiftTab(r,n,u+1):i.alert(e.msg)}).fail(function(e){i.alert(e.msg)})})})(c,e(n[c]));var h=e("[name=album-selected]"),p=e(n[1]).find(".album-selects");e(n[1]).on("click","ul li:not(.setted):not(.selected)",function(){e(this).addClass("selected");var n=e(this).attr("data-album-name"),r=e(this).attr("data-album-id"),i=e('<div class="ab-sel rel inl-b j-label" data-album-id="'+r+'">'+'<span class="t-ovf-h pdl-20 ">'+n+"</span>"+'<a class="abs linkText j-delBtn">×</a>'+"</div>");p.append(i),t.para.aidArr.push(r),t.setAlbumIds(t.para.aidArr)}).on("click",".j-delBtn",function(){var r=e(n[1]).find("ul"),i=e(this).closest(".j-label"),s=i.attr("data-album-id");t.para.aidArr.remove(s),t.setAlbumIds(t.para.aidArr),i.remove(),t.checkSelectAlbum(r,h)}).on("click",".btn-arrow",function(){var r=e.cookie(config.TOKEN_LABEL).split("&")[0],i=e(this),s=i.attr("data-url"),o=parseInt(i.attr("data-page")),u=i.hasClass("arrow-r")?o+1:o-1;e.get(s,{uid:r,oldBlackMaxId:t.para.mid,page:u}).done(function(t){var n=e(".j-album-label"),r=e("<div></div").html(t.Html);n.next().remove(),r.insertAfter(n)}).done(function(){var r=e(n[1]).find("ul");t.checkSelectAlbum(r,h)})}),e(".j-card").on("click",".btn",function(t){t.preventDefault();var n=e(this).attr("data-url");e(".j-card .btn").attr("class","btn btn-primary2 btn-mid1").text("选我"),e(this).attr("class","btn btn-primary btn-mid1").text("就选你~"),e("[name=card]").val(n)})},setAlbumIds:function(t){var n=e("[name=album-selected]"),r=t.join(",");n.val(r)},checkSelectAlbum:function(t,n){var r=t.find("li").removeClass("selected"),i=n.val().split(",");for(var s=i.length;s--;){var o=i[s];e.each(r,function(){var t=e(this);o===t.attr("data-album-id")&&t.addClass("selected")})}},checkCount:function(t,n){var r=t.siblings(".warn-text"),i=0;t.on("keydown keyup focus change input blur",function(){var t=e(this).val().length;i&&clearTimeout(i),i=setTimeout(function(){r.text(t+"/"+n),t>n?r.addClass("text-red"):r.removeClass("text-red")},100)})},shiftTab:function(t,n,r){t.removeClass("active");for(var i=r+1;i--;)t.eq(i).addClass("active");e("body,html").animate({scrollTop:0},0),n.eq(r).removeClass("hidden").siblings().addClass("hidden")},initUploadImg:function(){var t=this,n=e(".j-introImgCont"),r=new u({url:config.UPLOAD_ROOT+"/picture/upload",$el:e(".j-introImgBtn"),file_queued_handler:function(e){n.addClass("is-loading").find(".imgLoading").show()},success:function(e,r,s){var o=n.find("img"),u=e.data[0].uploadTrack;t.getImgOriginalSize(config.FDFS_PATH+"/"+u.url,function(e,t){if(t!==1e3||e!==1250){i.alert("请上传一张大小1250*1000的图片"),n.removeClass("is-loading").find(".imgLoading").hide();return}n.removeClass("is-loading").find(".imgLoading").hide(),n.parent().find("[name=intro-img]").focus().val(u.url).blur(),o.attr("src",config.FDFS_PATH+"/"+u.url)})}})},getImgOriginalSize:function(e,t){var n=new Image;n.src=e,n.complete?t(n.width,n.height):n.onload=function(){t(n.width,n.height),n=null}},formCheck:function(t,n){var r=this;e.validator.addMethod("checkAlbum",function(t,n){var r=!1;return e(n).attr("validate")==="true"&&(r=!0),e(n).val().length!==0&&(r=!0),r},"校验选择专辑"),e.validator.addMethod("checkTitle",function(t,n){var r=t.split("，"),i=!0;return r.length>5&&(i=!1),e.each(r,function(){this.length>7&&(i=!1)}),i},"头衔最多5个，每个不超过7个汉字，用中文逗号间隔"),e.validator.addMethod("checkPrice",function(e,t){var n=(e+"").split("."),r=n[0],i=n[1],s=!0;return parseFloat(e)<=0&&(s=!1),r.length>10&&(s=!1),i!==undefined&&i.length>2&&(s=!1),s},"请输入十位以内的数字，可保留两位小数，最小值0.01"),e.validator.addMethod("checkDisPrice",function(t,n){var r=parseFloat(e("[name=or-price]").val()),i=!0;return r<=parseFloat(t)&&(i=!1),i},"折扣价必须小于原价"),e(t[0]).validate({errorClass:"text-red txt-sm",ignore:"",rules:{maintitle:{required:function(e){return!0},maxlength:function(e){return 12}},subtitle:{required:function(e){return!0},maxlength:function(e){return 20}},name:{required:function(e){return!0},maxlength:function(e){return 12}},title:{required:function(e){return!0},checkTitle:function(e){return!0}},exp:{maxlength:function(e){return 200}},"intro-img":{required:function(){return e(".j-introImgBtn").next().find(".text-red").text(""),!0}}},messages:{maintitle:{required:function(e,t){return"请填写主标题"},maxlength:function(e,t){return"最多12个字"}},subtitle:{required:function(e,t){return"请填写副标题"},maxlength:function(e,t){return"最多20个字"}},name:{required:function(e,t){return"请填写姓名"},maxlength:function(e,t){return"最多12个字"}},title:{required:function(e,t){return"请填写头衔"},checkTitle:function(e,t){return"头衔最多5个，每个不超过7个汉字，用中文逗号间隔"}},exp:{maxlength:function(e,t){return"最多200个字"}},"intro-img":{required:function(t,n){e(".j-introImgBtn").next().find(".text-red").text("请上传图片")}}},submitHandler:function(e){r.shiftTab(n,t,1)}}),e(t[1]).validate({errorClass:"text-red",ignore:"",rules:{"album-selected":{checkAlbum:function(){return e(".j-album-label").removeClass("text-red"),!0}}},messages:{"album-selected":{checkAlbum:function(){e(".j-album-label").addClass("text-red")}}},submitHandler:function(e){r.shiftTab(n,t,2)}});var i=e("[name=or-price]").siblings(".text-red"),s=e("[name=dis-price]").siblings(".text-red");e(t[2]).validate({errorClass:"text-red",ignore:"",rules:{"or-price":{required:function(e){return i.text(""),!0},checkPrice:function(e){return i.text(""),!0},number:function(e){return i.text(""),!0}},"dis-price":{checkPrice:function(e){return s.text(""),!0},checkDisPrice:function(e){return s.text(""),!0},number:function(e){return s.text(""),!0}}},messages:{"or-price":{required:function(e,t){i.text("请填写会员价格")},checkPrice:function(e,t){i.text("请输入十位以内的数字，可保留两位小数，最小值0.01")},number:function(e,t){i.text("请输入十位以内的数字，可保留两位小数，最小值0.01")}},"dis-price":{checkPrice:function(e,t){s.text("请输入十位以内的数字，可保留两位小数，最小值0.01")},number:function(e,t){s.text("请输入十位以内的数字，可保留两位小数，最小值0.01")},checkDisPrice:function(e,t){s.text("折扣价必须小于原价")}}},submitHandler:function(i){var s=e("[name=maintitle]").val(),o=e("[name=subtitle]").val(),u=e(".j-card");e.each(u,function(){var t=e(this);t.find(".j-maintitle").text(s),t.find(".j-subtitle").text(o)}),r.shiftTab(n,t,3)}})}});return new h}),define("page/vip/vip_edit",["jquery","underscore","backbone","page/page_base","plugin/dialog","page/center/common","plugin/jquery.validate","module/uploadimg","plugin/jquery.input","module/common/form_editor","plugin/EventEmiter"],function(e,t,n,r,i,s,o,u,a,f,l){var c=r.extend({$el:e("#mainbox"),init:function(){s.init(),this.bindEvents(),e("input").beautify(),e.ajaxSetup({cache:!1}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)}},bindEvents:function(){var t=this;t.actInit(),t.initUploadImg(),t.placeHolderInit("intro-info","fit-person","buy-info"),t.fmtNum("[name=or-price]"),t.fmtNum("[name=dis-price]"),t.checkCount(e("[name=maintitle]"),12),t.checkCount(e("[name=subtitle]"),20),t.checkCount(e("[name=name]"),12),t.checkCount(e("[name=exp]"),200),e(".j-viewBtn").on("click",function(e){e.preventDefault(),t.popView()});var n=e(".j-form").eq(1).find("ul li"),r=[];e.each(n,function(){r.push(parseInt(e(this).attr("data-album-id")))}),r.length===0?t.para.mid=0:t.para.mid=Math.max.apply(null,r)},para:{aidArr:[],mid:""},fmtNum:function(t){e(t).on("blur",function(){var t=e(this).val();/^[0-9]+(.[0-9]{2})?$/.test(t)&&e(this).val(parseFloat(t))})},qaPop:function(){var e='<div class="identy-pop">    <h3>开启确认</h3>    <p>        开启后，会员可以免费旁听您回答过的所有付费问题哦~<br/>        确定开启吗？    </p>    <div class="button">        <a class="inl-b mgr-20 qa-submit">确认</a>        <a class="inl-b pre qa-cancel" dialog-role="close">取消</a>    </div></div>',t={dialogClass:"",header:"",close:!0,width:400,content:e},n=new i.Dialog(t);return n},popView:function(){var e='<div class="phone-container rel">    <div class="abs phone-img">        <img class="preview-content" src="'+config.STATIC_ROOT+'/css/pay-member/preview.png">'+"    </div>"+"</div>",t={dialogClass:"pop-vip",close:!1,header:"",fixed:!1,width:"auto",content:e,template:{dialog_body:'<div class="" dialog-role="body"></div>',dialog_container:'<div class="popup" dialog-role="container" style="border:0"></div>'}},n=new i.Dialog(t);n.open()},actInit:function(){var t=this,n=e(".j-form"),r=e(".j-tab").find(".cell-edit");e(".j-qaBtn a").on("click",function(){var n=t.qaPop(),r=e(this);r.hasClass("disabled-white")?"":n.open(),e(document).off("click",".qa-submit"),e(document).on("click",".qa-submit",function(){e("[name=hotlineRight]").val(2),e(".j-qaBtn a").addClass("disabled-white").text("已开启"),n.close()})});var s=new f(e(n[0])),o=s.initRichEditor({name:"intro-info-input",richName:"intro-info",onfocus:function(){e("[name=intro-info]").siblings(".area-mask").hide(),t.checkEditorLen(s.getCount(o),"intro-info")},onblur:function(){var n=e("[name=intro-info]"),r=n.val().length;r===0&&n.siblings(".area-mask").show(),t.checkEditorLen(s.getCount(o),"intro-info")},onchange:function(){t.checkEditorLen(s.getCount(o),"intro-info")}}),u=s.initRichEditor({name:"fit-person-input",richName:"fit-person",onfocus:function(){e("[name=fit-person]").siblings(".area-mask").hide(),t.checkEditorLen(s.getCount(u),"fit-person")},onblur:function(){var n=e("[name=fit-person]"),r=n.val().length;r===0&&n.siblings(".area-mask").show(),t.checkEditorLen(r,"fit-person")},onchange:function(){t.checkEditorLen(s.getCount(u),"fit-person")}}),a=s.initRichEditor({name:"buy-info-input",richName:"buy-info",onfocus:function(){e("[name=buy-info]").siblings(".area-mask").hide(),t.checkEditorLen(s.getCount(a),"buy-info")},onblur:function(){var n=e("[name=buy-info]"),r=n.val().length;r===0&&n.siblings(".area-mask").show(),t.checkEditorLen(r,"buy-info")},onchange:function(){t.checkEditorLen(s.getCount(a),"buy-info")}}),c=s.initRichEditor({name:"other-right-input",richName:"other-right",onfocus:function(){t.checkEditorLen(s.getCount(c),"other-right")},onblur:function(){t.checkEditorLen(s.getCount(c),"other-right")},onchange:function(){t.checkEditorLen(s.getCount(c),"other-right")}});e(".area-mask").on("click",function(){var t=e(this).attr("type");e(this).hide();switch(t){case"intro-info":o.focus();break;case"fit-person":u.focus();break;case"buy-info":a.focus()}}),e(document).on("click",".j-copyright input",function(){var t=e(this).closest(".j-form").find(".j-saveBtn");e(this).prop("checked")?t.removeClass("disabled-white"):t.addClass("disabled-white")}),t.formCheck(n,r);for(var h=n.length;h--;)(function(n,r){var u=r.find(".button");u.on("click",".j-saveBtn",function(u){u.preventDefault();if(n===0)s.getCount(o)===0?o.focus():s.getCount(a)===0?a.focus():r.submit();else if(n===3){var f=r.attr("data-url"),l={cardCoverUrl:e("[name=card]").val()};e.ajax({url:f,type:"POST",dataType:"json",data:JSON.stringify(l),contentType:"application/json"}).done(function(e){e.res===!0&&t.popUp()}).fail(function(e){i.alert(e.msg)})}else r.submit()})})(h,e(n[h]));var p=e("[name=album-selected]"),d=e(n[1]).find(".album-selects"),v=e(n[1]).find("ul");e(n[1]).on("click","ul li:not(.setted):not(.selected)",function(){e(this).toggleClass("selected");var n=e(this).attr("data-album-name"),r=e(this).attr("data-album-id"),i=e('<div class="ab-sel rel inl-b j-label" data-album-id="'+r+'">'+'<span class="t-ovf-h pdl-20 ">'+n+"</span>"+'<a class="abs linkText j-delBtn">×</a>'+"</div>");d.append(i),t.para.aidArr.push(r),t.setAlbumIds(t.para.aidArr)}).on("click",".j-delBtn",function(){var r=e(n[1]).find("ul"),i=e(this).closest(".j-label"),s=i.attr("data-album-id");t.para.aidArr.remove(s),t.setAlbumIds(t.para.aidArr),i.remove(),t.checkSelectAlbum(r,p)}).on("click",".btn-arrow",function(){var r=e.cookie(config.TOKEN_LABEL).split("&")[0],i=e(this),s=i.attr("data-url"),o=parseInt(i.attr("data-page")),u=i.hasClass("arrow-r")?o+1:o-1;e.get(s,{uid:r,oldBlackMaxId:t.para.mid,page:u}).done(function(t){var n=e(".j-album-label"),r=e("<div></div").html(t.Html);n.next().remove(),r.insertAfter(n)}).done(function(){var r=e(n[1]).find("ul");t.checkSelectAlbum(r,p)})}),e(".j-card").on("click",".btn",function(t){t.preventDefault();var n=e(this).attr("data-url");e(".j-card .btn").attr("class","btn btn-primary2 btn-mid1").text("选我"),e(this).attr("class","btn btn-primary btn-mid1").text("就选你~"),e("[name=card]").val(n)}),e(".j-createBtn").on("click",function(n){n.preventDefault();var r=e.cookie(config.TOKEN_LABEL).split("&")[0],i=window.open("/center/myAlbum/create");window.$openParams=JSON.stringify({isVip:!0}),e.extend(window,l),window.$once("albumResult",function(n){var i=n.album.id;t.para.aidArr.push(i+""),t.setAlbumIds(t.para.aidArr),e.get("/center/membership/getPaidAlbums",{uid:r,oldBlackMaxId:t.para.mid,page:1}).done(function(t){var n=e(".j-album-label"),r=e("<div></div").html(t.Html);n.next().remove(),r.insertAfter(n)}).done(function(){var n=e(".j-form").eq(1).find("ul"),r=e("[name=album-selected]");t.checkSelectAlbum(n,r)})})})},placeHolderInit:function(){for(var t=arguments.length;t--;){var n=e('[name="'+arguments[t]+'"]'),r=n.val().length,i=n.siblings(".area-mask");r===0?i.show():i.hide()}},popUp:function(){var t='<div class="finish-main"><img src="'+config.STATIC_ROOT+'/css/pay-member/finish.jpg" alt="">'+"<p>恭喜！您的付费会员服务已经保存成功啦~</p>"+"<p>您可以用手机扫描以下二维码，查看效果哦！</p>"+'<div class="two-code inl-b mgt-20"></div>'+"</div>",n={dialogClass:"",header:"",width:450,content:t};if(e(".popup").length===0){var r=new i.Dialog(n);r.options.onClose=function(){router.toPage("/center/membership/show")},r.open(),e(".two-code").qrcode({render:"table",correctLevel:1,width:120,height:120,text:e(".qr-code").attr("data-url")})}},checkEditorLen:function(t,n){var r={},i=e('[name="'+n+'"]'),s=i.siblings(".j-tip"),o=i.siblings(".j-count"),u=i.val().split("<img").length-1,a=e(".j-saveBtn");return t===0&&u===0?n==="intro-info"?(r.tip="请填写会员服务介绍",a.css("pointer-events","none")):n==="buy-info"&&(r.tip="请填写购买须知",a.css("pointer-events","none")):t>500?(r.tip="最多500个字",a.css("pointer-events","none")):u>10?(r.tip="最多10张图片",a.css("pointer-events","none")):(r.tip="",a.css("pointer-events","auto")),r.count=t+"/500",s.text(r.tip),o.text(r.count),t>500?o.addClass("text-red"):o.removeClass("text-red"),r},setAlbumIds:function(t){var n=e("[name=album-selected]"),r=t.join(",");n.val(r)},checkSelectAlbum:function(t,n){var r=t.find("li").removeClass("selected"),i=n.val().split(",");for(var s=i.length;s--;){var o=i[s];e.each(r,function(){var t=e(this);o===t.attr("data-album-id")&&t.addClass("selected")})}},getAlbumIds:function(t){var n=t.find(".j-label"),r=[];return e.each(n,function(){var t=e(this).attr("data-album-id");r.push(t)}),r.join(",")},checkCount:function(e,t){var n=e.siblings(".warn-text"),r=0,i=function(){var i=e.val().length;r&&clearTimeout(r),r=setTimeout(function(){n.text(i+"/"+t),i>t?n.addClass("text-red"):n.removeClass("text-red")},100)};e.on("keydown keyup focus change input blur",function(){i()}),i()},initUploadImg:function(){var t=this,n=e(".j-introImgCont"),r=new u({url:config.UPLOAD_ROOT+"/picture/upload",$el:e(".j-introImgBtn"),file_queued_handler:function(e){n.addClass("is-loading").find(".imgLoading").show()},success:function(e,r,s){var o=n.find("img"),u=e.data[0].uploadTrack;t.getImgOriginalSize(config.FDFS_PATH+"/"+u.url,function(e,t){if(t!==1e3||e!==1250){i.alert("请上传一张大小1250*1000的图片"),n.removeClass("is-loading").find(".imgLoading").hide();return}n.removeClass("is-loading").find(".imgLoading").hide(),n.parent().find("[name=intro-img]").focus().val(u.url).blur(),o.attr("src",config.FDFS_PATH+"/"+u.url)})}})},getImgOriginalSize:function(e,t){var n=new Image;n.src=e,n.complete?t(n.width,n.height):n.onload=function(){t(n.width,n.height),n=null}},formCheck:function(t,n){var r=this;e.validator.addMethod("checkTitle",function(t,n){var r=t.split("，"),i=!0;return r.length>5&&(i=!1),e.each(r,function(){this.length>7&&(i=!1)}),i},"头衔最多5个，每个不超过7个汉字，用中文逗号间隔"),e.validator.addMethod("checkPrice",function(e,t){var n=(e+"").split("."),r=n[0],i=n[1],s=!0;return parseFloat(e)<=0&&(s=!1),r.length>10&&(s=!1),i!==undefined&&i.length>2&&(s=!1),s},"请输入十位以内的数字，可保留两位小数，最小值0.01"),e.validator.addMethod("checkDisPrice",function(t,n){var r=parseFloat(e("[name=or-price]").val()),i=!0;return r<=parseFloat(t)&&(i=!1),i},"折扣价必须小于原价"),e(t[0]).validate({errorClass:"text-red txt-sm",ignore:"",rules:{maintitle:{required:function(e){return!0},maxlength:function(e){return 12}},subtitle:{required:function(e){return!0},maxlength:function(e){return 20}},name:{required:function(e){return!0},maxlength:function(e){return 12}},title:{required:function(e){return!0},checkTitle:function(e){return!0}},exp:{maxlength:function(e){return 200}},"intro-img":{required:function(){return e(".j-introImgBtn").next().find(".text-red").text(""),!0}}},messages:{maintitle:{required:function(e,t){return"请填写主标题"},maxlength:function(e,t){return"最多12个字"}},subtitle:{required:function(e,t){return"请填写副标题"},maxlength:function(e,t){return"最多20个字"}},name:{required:function(e,t){return"请填写姓名"},maxlength:function(e,t){return"最多12个字"}},title:{required:function(e,t){return"请填写头衔"},checkTitle:function(e,t){return"头衔最多5个，每个不超过7个汉字，用中文逗号间隔"}},exp:{maxlength:function(e,t){return"最多200个字"}},"intro-img":{required:function(t,n){e(".j-introImgBtn").next().find(".text-red").text("请上传图片")}}},submitHandler:function(t){var n=e(t).attr("data-url"),s={title:e("[name=maintitle]").val(),subtitle:e("[name=subtitle]").val(),zhuboName:e("[name=name]").val(),personalDescription:e("[name=title]").val(),experience:e("[name=exp]").val(),bannerUrl:e("[name=intro-img]").val(),achieve:e("[name=intro-info]").val(),suitable:e("[name=fit-person]").val(),buyNotes:e("[name=buy-info]").val()};e.ajax({url:n,type:"POST",dataType:"json",data:JSON.stringify(s),contentType:"application/json"}).done(function(e){e.res===!0&&r.popUp()}).fail(function(e){i.alert(e.msg)})}}),e(t[1]).validate({submitHandler:function(t){var n=e(t).attr("data-url"),s={freeAlbumIds:e("[name=album-selected]").val(),personalizedRight:e("[name=other-right]").val(),hotlineRight:e("[name=hotlineRight]").val()};e.ajax({url:n,type:"POST",dataType:"json",data:JSON.stringify(s),contentType:"application/json"}).done(function(e){e.res===!0&&r.popUp()}).fail(function(e){i.alert(e.msg)})}});var s=e("[name=or-price]").siblings(".text-red"),o=e("[name=dis-price]").siblings(".text-red");e(t[2]).validate({errorClass:"text-red",ignore:"",rules:{"or-price":{required:function(e){return s.text(""),!0},checkPrice:function(e){return s.text(""),!0},number:function(e){return s.text(""),!0}},"dis-price":{checkPrice:function(e){return o.text(""),!0},checkDisPrice:function(e){return o.text(""),!0},number:function(e){return o.text(""),!0}}},messages:{"or-price":{required:function(e,t){s.text("请填写会员价格")},checkPrice:function(e,t){s.text("请输入十位以内的数字，可保留两位小数，最小值0.01")},number:function(e,t){s.text("请输入十位以内的数字，可保留两位小数，最小值0.01")}},"dis-price":{checkPrice:function(e,t){o.text("请输入十位以内的数字，可保留两位小数，最小值0.01")},number:function(e,t){o.text("请输入十位以内的数字，可保留两位小数，最小值0.01")},checkDisPrice:function(e,t){o.text("折扣价必须小于原价")}}},submitHandler:function(t){var n=e(t).attr("data-url"),s={price:e("[name=or-price]").val(),discountedPrice:e("[name=dis-price]").val()};e.ajax({url:n,type:"POST",dataType:"json",data:JSON.stringify(s),contentType:"application/json"}).done(function(e){e.res===!0&&r.popUp()}).fail(function(e){i.alert(e.msg)})}})}});return new c}),define("page/vip/vip_manage",["jquery","underscore","backbone","page/page_base","plugin/dialog","page/center/common","plugin/jquery.input","plugin/face"],function(e,t,n,r,i,s,o,u){var a=r.extend({$el:e("#sub-main-box"),init:function(){var t=this;s.init(),e("input").beautify(),e(".j-sendBtn").on("click",function(){var n=t.popView();n.open(),u.init(e(".faceBtn"),e(".j-letterDiv textarea")),t.checkCount(".j-letterDiv",300),e(document).off("click",".j-letterDiv .submitBtn"),e(document).on("click",".j-letterDiv .submitBtn",function(){var r=e(".j-letterDiv"),s=e(this);len=parseInt(r.find(".charCount").text().split("/")[0]);if(len===0)i.alert("发送消息不能为空");else if(len>300)i.alert("发送消息最多300字");else{var o={uid:e.cookie(config.TOKEN_LABEL).split("&")[0],receiverUids:t.getUids(),content:r.find("textarea").val()};r.find("textarea").attr("disabled","disabled"),s.addClass("disabled").html("<span>发送中...</span>"),e.ajax({url:"/msgcenter/api/send",type:"POST",dataType:"json",data:JSON.stringify(o),contentType:"application/json"}).done(function(e){e.res===!0?(n.close(),i.success("发送成功")):i.alert(e.msg)}).fail(function(e){i.alert(e.msg)})}})});var n=e(".j-checkAll").find("input"),r=e(".j-check").find("input");n.on("click",function(){e(this).prop("checked")===!0?(r.prop("checked",!0),r.parent().addClass("xm-is-checked")):(r.prop("checked",!1),r.parent().removeClass("xm-is-checked")),t.updateNum(r)}),r.on("click",function(){e(this).prop("checked")===!1&&(n.prop("checked",!1),n.parent().removeClass("xm-is-checked")),t.updateNum(r)})},getUids:function(){var t=e(".j-check"),n=[],r;return e.each(t,function(){var t=e(this);if(t.find("input").prop("checked")===!0){var r=t.closest("li").attr("data-mid");n.push(r)}}),r=n.join(","),r},checkCount:function(t,n){var r=0,i=e(t+" .charCount");e(document).off("keydown keyup focus change input blur",t+" textarea"),e(document).on("keydown keyup focus change input blur",t+" textarea",function(){var t=Math.ceil(e(this).val().trim().replace(/[^\u0000-\u00ff]/g,"aa").length/2);r&&clearTimeout(r),r=setTimeout(function(){i.text(t+"/"+n),t>n?i.addClass("text-red"):i.removeClass("text-red")},100)})},popView:function(){var e=[' <dl class="popup_dl">',"   <dd><textarea></textarea></dd>"," </dl>",' <div class="popup_btm">','   <div class="fr">','     <span class="charCount">0/300</span>','     <a class="faceBtn" href="javascript:;"></a>','     <a class="hidden" dialog-role="close" href="javascript:;"></a>','     <a class="submitBtn" href="javascript:;"><span>发送</span></a>',"   </div>"," </div>"].join(""),t={dialogClass:"j-letterDiv",header:"发私信",fixed:!0,width:"auto",content:e,overlayer:{clickClose:!1}},n=new i.Dialog(t);return n},updateNum:function(t){var n=0,r=e(".j-sendBtn");e.each(t,function(){e(this).prop("checked")===!0?n++:""}),r.find("span").text("发私信("+n+")"),n===0?r.addClass("disabled-white"):r.removeClass("disabled-white")},release:function(){this.callParent("release")}});return new a}),define("page/register/register",["jquery","page/passport/passport","page/page_base","model/coutry"],function(e,t,n,r){e(".regSelBox").click(function(){e(this).toggleClass("open")}),e(".regListBox").on("mouseleave",function(){e(".regSelBox").removeClass("open")}),e("input[name=password]").attr("placeholder"," 需由6-20位数字、字母或符号组成，至少两种"),e("#reg_code_list").perfectScrollbar(),e("#userInfoErr").css("marginTop","-20px"),t.register();var i=n.extend({init:function(){this.initRegSelNum(),this.renderRegSel(),this.putLog()},initRegSelNum:function(){var t=e("#area_name"),n=e("#area_num");t.val(t.text()),n.val(n.text()),e("#reg_code_list").on("click","li",function(){var r=e(this).children(".area-name").text(),i=e(this).children(".regSelNum").text(),s=n.get(0).childNodes;for(var o=0;o<s.length;o++)s[o].nodeType===3&&s[o].nodeValue!==""&&(s[o].nodeValue=i);t.text(r).val(r),n.val(i),e("#userAccountPhone").val()&&e("#userAccountPhone").blur()})},renderRegSel:function(){var t=e("#reg_code_list"),n="<ul>",i=r.length;t.html("");for(var s=0;s<i;s++)n+="<li>",n+='<span class="fr regSelNum">'+r[s].code+"</span>",n+='<span class="  area-name">'+r[s].name+"</span>",n+="</li>";n+="</ul>",t.append(n)},putLog:function(){xmLog&&xmLog("pv.create",{currPage:"register"}),xmLog&&xmLog("pv.send","event",{currPage:"register",currPageId:null,currPageUrl:"/passport/register",durationTime:"0s",prevItem:null,prevItemId:null,prevModule:null,prevPage:null,prevPageId:null,prevPageUrl:null,serviceId:"pageView"}),e("#login_btn_phone").click(function(){xmLog&&xmLog("pv.send","event",{currPage:"register",currPageId:null,currPageUrl:"/passport/register",item:"applyLogin",itemId:null,module:null,serviceId:"click"})}),e("#resend_code_btn").click(function(){xmLog&&xmLog("pv.send","event",{currPage:"register",currPageId:null,currPageUrl:"/passport/register",item:"getCode",itemId:null,module:null,serviceId:"click"})}),e(".regTipLog a").click(function(){xmLog&&xmLog("pv.send","event",{currPage:"register",currPageId:null,currPageUrl:"/passport/register",item:"login",itemId:null,module:"bottomTool",serviceId:"click"})})}}),s=new i;return s}),function(e,t){var n=[];typeof define=="function"&&define.amd?define("plugin/search-box",["./EventEmiter"],t):typeof exports=="object"?(n=[require("./EventEmiter")],module.exports=t.apply(e,n)):(n=[e.EventEmiter],e.searchBox=t.apply(e,n))}(this,function(e){function n(e){return e>47&&e<58||e==32||e==13||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function r(e){if(e===undefined||e===null)throw new TypeError("cannot covert undefined or null to object");var t=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==undefined&&r!==null)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}function i(){var e=this.xhr=new XMLHttpRequest,t=this}function s(e){return e.trim().replace(/[^\x00-\xff]/gi,"xx").length}function o(e,t,n){var r=0,i="";for(var o=0;o<e.length;o++)e.charCodeAt(o)>127||e.charCodeAt(o)==94?r+=2:r++;if(r<=t)return e;r=0,n=n||"",t=t>s(n)?t-s(n):t;for(var o=0;o<e.length;o++){e.charCodeAt(o)>127||e.charCodeAt(o)==94?r+=2:r++;if(r>t){i+=n;break}i+=e.charAt(o)}return i}function u(e){this.storage=e}function a(e){function p(e){var t=s.value.trim();switch(e.type){case"keyup":case"paste":case"cut":h.$emit("change",t,e);break;case"keydown":g(e);break;case"focus":v(e);break;default:}e.stopPropagation()}function d(e){e=o(e,i.charLength),h.query(e,function(e,t){if(e){console.error(e);return}try{var n=t.list}catch(r){t={list:[]}}var s=h.render(t,i.template,"all",h.templateParse);s?s='<ul class="srhLists">'+s+"</ul>":"",h.suggestPanel.innerHTML=s,h.show(h.suggestPanel)})}function v(e){var t=s.value.trim();return t!==""?(c=!1,h.$emit("change",t)):h.showHistory(),e.stopPropagation(),!1}function m(){h.hide(h.suggestPanel);var e=h.inputEl.value.trim();return e===""?!1:(l&&(clearTimeout(l),l=undefined),h.setHistory(e),i.callback(e,h.opts.scope),h.$emit("goSearch",e,h.opts.scope),!0)}function g(e){var r=s.value.trim();n(e.keyCode)||e.keyCode===t.BACKSPACE||e.keyCode===229||e.keyCode===0?c=!1:c=!0;if(!h.suggestPanel.isOpen)return!1;var i=h.suggestPanel.querySelectorAll("ul li"),o=i.length,u=h.suggestPanel.sIndex;if(o===0)return!1;var a=function(e){for(var t=i.length-1;t>=0;t--)i[t].style={};e!==-1&&(i[e].style.backgroundColor="#f7f7f7",s.value=i[e].getAttribute("data-title"))};switch(e.keyCode){case t.PAGE_UP:case t.UP:u--,u<=-1&&(u=-1),h.suggestPanel.sIndex=u,a(u);break;case t.PAGE_DOWN:case t.DOWN:u++,u>=o&&(u=-1),h.suggestPanel.sIndex=u,a(u);break;case t.ESCAPE:h.hide(h.suggestPanel);break;default:}return!1}var i={delayTime:300,url:"/search/suggest",scope:"all",charLength:60,callback:function(){},selectCallback:function(){},open:!1,paramName:"kw",delHisBtn:"srhDel",clearHisBtn:"history-clear",itemBtn:"srhTxt",historyLength:10,template:{all:'<li class="srhLi" data-title="{{title}}"><a class="srhTxt" data-scope="{{scope}}" data-id="{{id}}" title="{{title}}">{{text}}</a></li>',history:'<li class="srhLi history-link" data-title="{{title}}"><span class="srhDel fr" title="{{title}}">删除</span><a class="srhTxt" title="{{title}}">{{title}}</a></li>',clearHis:'<p class="clOld"><span class="clTxt history-clear">清空搜索记录</span></p>'}};r(i,e),this.suggestUrl=i.url,this.opts=i,this.history=new u(localStorage);var s=this.inputEl=i.inputEl,a=this.suggestPanel=i.suggestPanel,f=this.searchBtn=i.searchBtn,l,c=!1;this.suggestPanel.sIndex=-1,this.hide(this.suggestPanel);var h=this;this.bindSuggestEvent(),this.$on("change",function(e,n){n=n||{type:""};if(n.keyCode===t.ENTER)return m(),!1;l&&(clearTimeout(l),l=undefined);if(c)return!1;if(e==="")return h.request&&h.request.abort(),h.hide(h.suggestPanel),!1;h.hide(h.suggestPanel),l=setTimeout(function(){d(o(e))},i.delayTime)}),this.inputEl.addEventListener("focus",p),this.inputEl.addEventListener("keyup",p),this.inputEl.addEventListener("paste",p),this.inputEl.addEventListener("keydown",p),this.inputEl.addEventListener("cut",p),this.opts.container.addEventListener("click",function(e){return e.stopPropagation(),!1}),document.addEventListener("click",function(){h.hide(h.suggestPanel)},!1),this.opts.searchBtn.addEventListener("click",function(e){var t=s.value.trim();return t===""?!1:(h.opts.callback(t,h.opts.scope),h.$emit("goSearch",t,h.opts.scope),e.stopPropagation(),e.preventDefault(),!1)})}var t={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),i.prototype={constructor:i,get:function(e,t){var n=this.xhr;n.onreadystatechange=function(){n.readyState===4&&(n.status===200?t(null,JSON.parse(n.responseText)):t(n.statusText))},n.open("GET",e,!0),n.send(null)},abort:function(){this.xhr.abort()}},u.prototype={constructor:u,get:function(e,t){var n=this.storage.getItem(e);return n=n===undefined?"":n,t?decodeURIComponent(n):n},getJson:function(e,t){var n=this.get(e,t);if(n)try{return JSON.parse(n)}catch(r){console.error("json parse failed")}return n},set:function(e,t,n){try{this.remove(e),t=n?encodeURIComponent(t):t,this.storage.setItem(e,t)}catch(r){console&&console.error(r)}},setJson:function(e,t){try{this.remove(e);var n=JSON.stringify(t);this.storage.setItem(e,n)}catch(r){console&&console.error(r)}},remove:function(e){this.storage.removeItem(e)}};var f=a.prototype={constructor:a,query:function(e,t){var n=new i;n.get(this.suggestUrl+"?scope="+this.opts.scope+"&"+this.opts.paramName+"="+e,t),this.request=n},show:function(e){this.opts.open&&this.addClass(this.opts.container,"open"),e.style.display="block",e.isOpen=!0},hide:function(e){this.opts.open&&this.removeClass(this.opts.container,"open"),e.style.display="none",e.isOpen=!1,e===this.suggestPanel&&(e.sIndex=-1)},setScope:function(e){this.opts.scope=e},setHistory:function(e){if(!e)return!1;var t=this.history.getJson("_history")||[],n=!1;for(var r=0;r<t.length;r++)if(e===t[r].title){n=!0;break}if(n)return!1;var i;try{i=Date.now()}catch(s){i=(new Date).getTime()}t.unshift({title:e,date:i}),t.length>this.opts.historyLength&&t.pop(),this.history.setJson("_history",t)},getHistory:function(){return this.history.getJson("_history")},clearHistory:function(){this.history.remove("_history"),this.hide(this.suggestPanel),this.suggestPanel.innerHTML=""},delHistory:function(e){var t=this.getHistory(),n=-1;for(var r=0;r<t.length;r++)e===t[r].title&&(n=r);n!==-1&&t.splice(n,1),this.history.setJson("_history",t)},showHistory:function(){var e=this.getHistory()||[];if(e.length===0)return this.hide(this.suggestPanel),!1;var t=this.render({list:e},this.opts.template,"history");t='<ul class="srhLists">'+t+"</ul>"+this.opts.template.clearHis,this.suggestPanel.innerHTML=t,this.show(this.suggestPanel)},render:function(e,t,n){return this.templateParse(t[n],e.list)},templateParse:function(e,t){var n="",r="";t=t||[];var i=t.length;t.reverse();while(i){i--,r=e;var s=t[i];for(key in s)if(s.hasOwnProperty(key)){var u=new RegExp("{{"+key+"}}","g");r=r.replace(u,o(""+s[key],this.opts.charLength,"..."))}n+=r}return n.replace(/\{\{[_a-zA-Z]*\}\}/g,"")},bindSuggestEvent:function(){var e=this;this.suggestPanel.addEventListener("click",function(t){var n=t.target.className;if((new RegExp(e.opts.itemBtn)).test(n)){var r=t.target.getAttribute("title");e.setHistory(r),e.opts.callback(r,e.opts.scope),e.opts.selectCallback(t.target),e.$emit("goSearch",r,e.opts.scope),e.$emit("selectSearch",t.target)}else if((new RegExp(e.opts.clearHisBtn)).test(n))e.clearHistory();else if((new RegExp(e.opts.delHisBtn)).test(n)){var i=e.closet("li",t.target);i.parentNode.removeChild(i),e.delHistory(t.target.getAttribute("title"))}return t.stopPropagation(),t.preventDefault(),!1})},closet:function(e,t){if((new RegExp(e,"ig")).test(t.parentNode.tagName))return t.parentNode;this.closet(e,t.parentNode)},chooseResult:function(){var e=this.inputEl.value.trim();this.opts.callback(e,this.opts.scope),this.$emit("goSearch",e,this.opts.scope)},addClass:function(e,t){var n=e.getAttribute("class"),r=n?n.split(" "):[];if(r.indexOf(t)!==-1)return!1;r.push(t),e.setAttribute("class",r.join(" "))},removeClass:function(e,t){var n=e.getAttribute("class");if(!n)return;var r=n.split(" "),i=r.indexOf(t);if(i<0)return;r.splice(i,1),e.setAttribute("class",r.join(" "))}};return r(f,e),a}),define("model/_search/user",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{id:"",is_followed:!1},doFollow:function(t,n){var r=this,i=r.get("id"),s="";t=t||e.noop,n=n||e.noop,s=r.get("is_followed")?"destroy":"create",r.save({},{url:"/followings/"+s,type:"post",dataType:"json",parse:!1,data:{following_uid:i},success:function(e,r,i){r.res?t(e,r,i):n(e,r,i)},error:function(e,t,r){n(e,null,r)}})},queryUser:function(e,t){var n=this,r=n.get("id");n.save({},{url:"/"+r+"/card",type:"get",dataType:"json",success:function(t,n,r){e(t,n,r)},error:function(e,n,r){t(e,null,r)}})}});return r}),define("module/_search/ifollow",["jquery","underscore","backbone","helper","model/_search/user","plugin/dialog","module/dialogs/login_box"],function(e,t,n,r,i,s,o){var u={follow:"关注",follow_loading:"关注中",already_follow:"已关注",cancel_follow_loading:"取消中",follow_eachother:"相互关注"},a=n.View.extend({init:function(){},doBindOne:function(t){t.on("mouseenter",function(){var t=e(this),n=JSON.parse(t.attr("data-options")),r=t.find("span.tip"),i=t.find("span.default");if(r.hasClass("checked"))return;r.length===0&&(r=e('<span class="tip">取消</span>').appendTo(t),r.hide()),n.is_follow&&(r.addClass("checked"),i.hide(),r.show())}),t.on("mouseleave",function(){var t=e(this),n=JSON.parse(t.attr("data-options"));if(n.is_follow){var r=t.find("span.tip"),i=t.find("span.default");r.removeClass("checked"),r.hide(),i.show()}}),t.on("click",[this],this.doFollow)},doFollow:function(t){function p(e,t,n){h.is_follow=!h.is_follow,h.is_follow?(i.removeClass("btn-default").addClass("btn-gray"),f.removeClass("icon-ic_attention"),t.res.is_mutual_followed?(a.text(u.follow_eachother),f.addClass("icon-ic_mutual")):(f.addClass("icon-ic_already"),a.text(u.already_follow)),s.success("关注成功")):(i.removeClass("btn-gray").addClass("btn-default"),f.hasClass("icon-ic_mutual")?f.removeClass("icon-ic_mutual"):f.removeClass("icon-ic_already"),f.addClass("icon-ic_attention"),a.text(u.follow),s.success("取消成功")),h.lock=!1,i.attr("data-options",JSON.stringify(h))}function d(e,t,n){h.lock=!1,a.text(c),i.attr("data-options",JSON.stringify(h)),t&&s.warn(t.msg)}if(!r.isLogin())return o.open(function(){r.refreshCurrentUser()}),!1;var n=t.data[0],i=e(this),a=i.find("span.default"),f=i.find("i.iconfont"),l=i.find("span.tip"),c=a.text();l.hide(),a.show();var h=JSON.parse(i.attr("data-options"));if(h.lock)return;h.lock=!0,h.is_follow?a.text(u.cancel_follow_loading):a.text(u.follow_loading),i.attr("data-options",JSON.stringify(h)),n.model.set("id",h.uid),n.model.set("is_followed",h.is_follow),n.model.doFollow(p,d)}});return new a({model:new i})}),define("module/_search/iComment",["jquery","underscore","backbone","model/comment","plugin/modal","plugin/animation","plugin/dialog","plugin/face","helper","module/dialogs/login_box","module/share","module/dialogs/paysound"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=300,p='<a href="" class="popClX fr"> <i class="iconfont icon-ic_x"></i></a><h4 class="popTit">评论</h4><p class="c02 mgb-10">评论节目<a class="link5 mgl-10 elli wid-500 inl-b">晓说第8期：高晓松YY未来世界（下）败给AlphaGo之后</a></p><div class="reply-msg retnCont"><textarea class="reply-box" placeholder="写点什么吧…"></textarea><p class="edit-rest">还可以输入'+h+"个字</p>"+'<div class="cl reply-btn">'+'<a href="" class="btn-com btn-sm btn-red fr">评论</a>'+'<i class="iconfont icon-ic_laugh">表情</i>'+"</div>"+"</div>",d={onShow:function(e){console.log("show")},onClose:function(e){console.log("close")},dialogClass:"popBox",template:p,lockScroll:!0},v=new i(d);v.addAnimation(s);var m=e(v.getEl());new l({$el:m}),u.init(m.find(".icon-ic_laugh"),m.find(".reply-box"));var g=n.View.extend({init:function(){this.release()},toBind:function(e){this.$triggerEl=e,this.$triggerEl.on("click",[this],this.openComment)},openComment:function(t){function g(e,t){m.data("lock",!1),o.success("评论成功"),setTimeout(function(){v.close()},1e3)}function y(e,t){console.log("error",t),m.data("lock",!1),t?o.warn(t.msg):o.warn("服务器繁忙")}if(!a.isLogin())return f.open(function(){a.refreshCurrentUser()}),!1;var n=t.data[0],r=e(this),i=r.closest("[data-ispaid]").data("ispaid");if(i)return c.pop({uid:""}),!1;var s=r.closest("[data-title]").attr("data-title"),u=r.closest("[data-trackid]").attr("data-trackid"),l=e(v.getEl()),p=l.find("textarea"),d=l.find(".edit-rest"),m=l.find(".btn-com");return l.find(".link5").text(s),p.val(""),d.text("还可以输入"+h+"个字").css("color","#ccc"),v.open(),m.off("click"),p.off("input"),p.on("input change",function(){var t=/[\u0391-\uFFE5]/g,n=e.trim(e(this).val()).replace(t,"aa"),r=Math.ceil(n.length/2),i=h-r;i>=0?d.text("还可以输入"+i+"个字").css("color","#ccc"):d.text("已超出"+ -1*i+"个字").css("color","red")}),m.on("click",function(){if(e(this).data("lock"))return!1;e(this).data("lock",!0);try{n.model.set("trackId",u),n.model.set("content",e.trim(p.val()))}catch(t){return console.log(t),!1}var r=n.model.check();return r?(r=="评论不能为空。"&&o.warn(r),m.data("lock",!1),!1):(n.model.create(g,y),!1)}),!1},release:function(){this.$triggerEl.off("on")}});return new g({model:new r})}),define("module/_search/iLove",["jquery","underscore","backbone","plugin/dialog","module/dialogs/paysound"],function(e,t,n,r,i){var s=n.Model.extend({defaults:{track_id:"",isToLove:!0},create:function(e){this.save({},{url:"/favorites/create",type:"post",data:{track_id:this.get("track_id")},success:function(t,n,i){r.success("成功添加喜欢",{autoClose:600}),e&&e(t,n)},error:function(t,n,r){e&&e(t,n)}})},del:function(e,t){this.save({},{url:"/favorites/destroy",type:"post",data:{track_id:this.get("track_id")},success:function(t,n,i){r.success("取消成功",{autoClose:600}),e(t,n)}})},doLove:function(e){var t=this.toJSON();t.isToLove?this.create(e):this.del(e)}}),o=n.View.extend({init:function(){this.release()},toBind:function(e){this.$el=e,this.$el.on("click",[this],this.doLove)},doLove:function(t){var n=t.data[0],r=e(this),s=n.getOptions(r),o=r.closest("[data-ispaid]").data("ispaid");if(o)return i.pop({uid:""}),!1;if(n.model){n.model.set("track_id",s.trackId),n.model.set("isToLove",!s.is_favorited),s.is_favorited=!s.is_favorited,n.changeOptions(r,s),s.is_favorited?r.addClass("on"):r.removeClass("on");try{n.model.doLove(function(e,t,i){if(!t||!t.res)s.is_favorited=!s.is_favorited,n.changeOptions(r,s),s.is_favorited?r.addClass("on"):r.removeClass("on")})}catch(t){return console.log(t),!1}}return!1},changeOptions:function(e,t){e.attr("data-options")?e.attr("data-options",JSON.stringify(t)):e.closest("[data-options]").attr("data-options",JSON.stringify(t))},getOptions:function(e){return e.attr("data-options")?JSON.parse(e.attr("data-options")):JSON.parse(e.closest("[data-options]").attr("data-options"))},release:function(){this.$el.off("click")}});return new o({model:new s})}),define("module/_search/iReprint",["jquery","underscore","backbone","plugin/modal","plugin/dialog","plugin/animation","model/forward","plugin/face","helper","module/dialogs/login_box","module/share","module/dialogs/paysound"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=30,p='<a href="" class="popClX fr"> <i class="iconfont icon-ic_x"></i></a><h4 class="popTit">转采</h4><p class="c02 mgb-10">转采节目<a class="link5 mgl-10 elli wid-500 inl-b">晓说第8期：高晓松YY未来世界（下）败给AlphaGo之后</a></p><div class="mgb-10">转采至<div class="selecter selecter-s5 selecter-m1 wid-280"><div class="selecter-selected md"><span class="selecter-text"></span><span class="sel-arrDu"><span href="" class="icon-ic_down iconfont"></span></span></div><div class="selecter-options"><ul></ul></div></div></div><div class="reply-msg retnCont"><textarea class="reply-box" placeholder="写点转采理由吧…"></textarea><p class="edit-rest">还可以输入'+h+"个字</p>"+'<div class="cl reply-btn">'+'<a href="" class="btn-com btn-sm btn-red fr">转采</a>'+'<i class="iconfont icon-ic_laugh">表情</i>'+"</div>"+"</div>",d={template:p,dialogClass:"popBox",lockScroll:!0},v=new r(d);v.addAnimation(s);var m=e(v.getEl());new l({$el:m}),u.init(m.find(".icon-ic_laugh"),m.find(".reply-box"));var g=n.View.extend({init:function(){},toBind:function(e){e.on("click",[this],this.openReprint)},openReprint:function(t){if(!a.isLogin())return f.open(function(){a.refreshCurrentUser()}),!1;var n=e(this),r=t.data[0],s=n.closest("[data-ispaid]").data("ispaid");if(s)return c.pop({uid:""}),!1;try{var o=n.closest("[data-title]").attr("data-title"),u=n.closest("[data-trackid]").attr("data-trackid"),l=e(v.getEl()),p=l.find("textarea"),d=l.find(".edit-rest"),m=l.find(".btn-com"),g=l.find(".selecter-options"),y=l.find(".selecter-text"),b=l.find(".selecter-s5"),w=y.attr("data-id"),E=!0;l.find(".link5").text(o),m.off("click"),p.off("input"),b.off("click"),p.val(""),d.text("还可以输入"+h+"个字").css("color","#ccc"),e.ajax({method:"post",url:"/handle_track/album_list",success:function(e){S(e.response),console.log(e),b.toggleClass}}),b.on("click",function(){b.toggleClass("open")}),p.on("input change",function(){var t=/[\u0391-\uFFE5]/g,n=e.trim(e(this).val()).replace(t,"aa"),r=Math.ceil(n.length/2),i=h-r;i>=0?(d.text("还可以输入"+i+"个字").css("color","#ccc"),E=!0):(d.text("已超出"+ -1*i+"个字").css("color","red"),E=!1)}),m.on("click",function(){return E?e(this).data("lock")?!1:(e(this).data("lock",!0),w?(r.model.set("trackId",u),r.model.set("content",e.trim(p.val())),r.model.set("album_id",w),r.model.create(x,T),!1):(i.warn("请选择一个专辑，转采的声音将添加到该专辑中"),!1)):!1});function S(t){if(!t||t.length==0)return;g.html("");var n="<ul>";t.forEach(function(e){n+='<li class="selecter-item" data-id="'+e.id+'">'+e.title+"</li>"}),n+="</ul>",g.append(n),g.find("li").on("click",function(){var t=e(this);w=t.attr("data-id"),y.attr("data-id",w).text(t.text())})}function x(e,t){m.data("lock",!1),i.success("转采成功"),setTimeout(function(){v.close()},1e3)}function T(e,t){m.data("lock",!1);if(!t){i.warn("服务器繁忙");return}i.warn(t.msg)}v.open()}catch(t){console.log(t)}return!1}});return new g({model:new o})}),define("module/common/jtrack",["jquery","module/_search/iComment","module/_search/iLove","module/_search/iReprint"],function(e,t,n,r){function i(){this.$el=null,this.$btn_love=null,this.$btn_comment=null,this.$btn_share=null,this.$btn_reprint=null}return i.prototype={constructor:i,setLove:function(e){this.$btn_love=e,this.bindLove()},setComment:function(e){this.$btn_comment=e,this.bindComment()},setShare:function(e){this.$btn_share=e,this.bindShare()},setReprint:function(e){this.$btn_reprint=e,this.bindReprint()},toBind:function(e){this.$el=e,this.$btn_love=e.find(".btn-love"),this.$btn_comment=e.find(".btn-comment"),this.$btn_share=e.find(".btn-share"),this.$btn_reprint=e.find(".btn-reprint"),this.bindAll()},bindAll:function(){this.bindLove(),this.bindReprint(),this.bindShare(),this.bindComment()},bindLove:function(){n.toBind(this.$btn_love)},bindReprint:function(){r.toBind(this.$btn_reprint)},bindShare:function(){this.$btn_share.on("click",function(){return e(this).next().toggle(),!1}),this.$btn_share.next().on("mouseleave",function(){e(this).hide()})},bindComment:function(){t.toBind(this.$btn_comment)}},new i}),function(e,t){function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function r(){var e=t.createElement("div");this.addClass(e,"refPop reform");var n=t.createElement("div");n.style.display="none",this.addClass(n,"peopleCard popBox"),e.appendChild(n),t.body.appendChild(e),this.container=e,this.body=n,n.style.transform="none"}r.prototype={constructor:r,update:function(e){this.body.innerHTML="",this.body.innerHTML=e},open:function(e){return e&&(this.body.style.top=e.top+"px",this.body.style.left=e.left+"px"),this.body.style.display="block",this.fadeIn(this.body,0,500),this},close:function(){return this.body.style.display="none",this},fadeIn:function(e,t,n,i){r.animation(t,n,160,"linear",function(r,s){s&&i&&i(s),e.style.opacity=(r-t)/(n-t)})},fadeOut:function(){},getEl:function(){return this.body},addClass:function(e,t){var n=e.getAttribute("class"),r=n?n.split(" "):[];r.push(t),e.setAttribute("class",r.join(" "))},removeClass:function(e,t){var n=e.getAttribute("class");if(!n)return;var r=n.split(" ");if(t instanceof RegExp)n=n.replace(t,""),r=n.split(" ");else{var i=r.indexOf(t);i>=0?r.splice(i,1):""}var s=[];for(var o=0;o<r.length;o++)r[o]&&s.push(r[o]);r=s,e.setAttribute("class",r.join(" "))}},typeof e.define=="function"&&define("plugin/_card",["plugin/EventEmiter","plugin/animation"],function(e,t){return n(r.prototype,e),r.animation=t,r})}(window,document),define("module/_search/iLetter",["jquery","underscore","backbone","model/letter","helper","plugin/modal","plugin/dialog","plugin/face","module/dialogs/login_box","module/share"],function(e,t,n,r,i,s,o,u,a,f){var l=t.template('<a href="" class="popClX fr"><i class="iconfont icon-ic_x"></i></a><h4 class="popTit">发私信</h4><p class="c02 mgb-10">发给<input class="comInput wid-280 mgl-10" type="text"></p><div class="reply-msg retnCont"><textarea class="reply-box" placeholder="写点什么吧…"></textarea><p class="edit-rest">还可以输入140个字</p><div class="cl reply-btn"><a class="btn-com btn-sm btn-red fr">发送</a><i class="iconfont icon-ic_laugh">表情</i></div></div>'),c={dialogClass:"popBox",template:l()},h=new s(c),p=e(h.getEl());new f({$el:p}),u.init(p.find(".icon-ic_laugh"),p.find("textarea.reply-box"));var d=n.View.extend({toBind:function(e){if(e.data("iletter-bind"))return;e.data("iletter-bind",!0),e.on("click",[this],this.doSendLetter)},doSendLetter:function(t){if(!i.isLogin())return a.open(function(){i.refreshCurrentUser()}),!1;$this=e(this);var n=$this.data("nickname"),r=t.data[0];return r.model.set("nickname",n),r.showDialog(),!1},showDialog:function(){function u(e,t){i.data("lock",!1),o.success("发送成功"),setTimeout(function(){h.close()},800)}function a(e,t){i.data("lock",!1),t?o.warn(t.msg):o.warn("服务器繁忙")}var t=this,n=p.find(".comInput"),r=p.find("textarea.reply-box").val(""),i=p.find(".btn-com"),s=p.find(".edit-rest");n.val(this.model.get("nickname")),r.off(),i.off(),t.model.off(),r.on("input change",function(){var t=/[\u0391-\uFFE5]/g,n=e.trim(e(this).val()).replace(t,"aa"),r=Math.ceil(n.length/2),i=140-r;s.text("还可以输入"+i+"个字")}),i.on("click",function(){return e(this).data("lock")?!1:(e(this).data("lock",!0),t.model.set("nickname",n.val()),t.model.set("content",r.val()),t.model.add(u,a),!1)}),t.model.on("invalid",function(e,t){o.warn(t)}),h.open()}});return new d({model:new r})}),define("module/_search/_card",["jquery","underscore","backbone","model/_search/user","plugin/_card","module/_search/ifollow","module/_search/iLetter"],function(e,t,n,r,i,s,o){var u=new i,a=t.template('<div class="cardTopBg"></div><div class="cardCont"><a href=""><%if(avatar_url_60){%><img src="<%=avatar_url_60%>" alt="" class="cardUser fl"><%}else{%><img src="http://s1.xmcdn.com/css/img/common/default/user200.jpg?201708171852" alt="" class="cardUser fl"><%}%></a><div class="userInfo"><a class="name link4 inl-b" href="/zhubo/<%=uid%>"><%=nickname%><%if(anchorGrade >= 0){%><i class="grade inl-b grade<%= anchorGrade %> <%= verifyType == 2 ? "on-blue": "on"%>"></i><%}%></a><div><i class="iconfont icon-soundslight mgr-20"><%=tracks_count%>集</i><i class="iconfont icon-fanslight"><%= followers_count%></i></div></div><p class="ta-l mgtb-10"><%=ptitle%></p><div class="ta-r"><a class="btn-com btn-sm btn-default mgr-5 btn-msg" data-nickname="<%=nickname%>">私信</a><%if(!is_not_following){%><%if(be_followed){%><a class="btn-com btn-smIc fr btn-follow btn-gray"><i class="iconfont mgr-5 icon-ic_mutual"></i><span class="default">相互关注</span></a><%}else{%><a class="btn-com btn-smIc fr btn-follow btn-gray"><i class="iconfont mgr-5 icon-ic_already"></i><span class="default">已关注</span></a><%}%><%}else{%><a class="btn-com btn-smIc btn-follow btn-default"><i class="iconfont icon-ic_attention"></i><span class="default">关注</span></a><%}%></div></div>'),f=n.View.extend({init:function(){var t=this;this.$pop=e(u.getEl()),this.$pop.on({mouseenter:function(){t.hideTimeId&&clearTimeout(t.hideTimeId)},mouseleave:function(){t.hideTimeId=setTimeout(function(){u.close()},100)}})},toBind:function(t){var n=this;t.each(function(){var t=e(this);t.off(),!t.attr("isBinded")&&t.attr("card")&&n.bindEvent(t)})},bindEvent:function(t){var n=this;t.attr("isBinded",!0),t.on({mouseenter:function(){n.onMouseenter(e(this))},mouseleave:function(){n.onMouseleave(e(this))},click:function(){e(this).mouseleave()}})},initModelData:function(e){},onMouseenter:function(t){var n=this;this.model.set("id",t.attr("card")),n.popTimeId=setTimeout(function(){n.model.queryUser(function(r,i){n.initModelData(i),u.update(a(i));var f=t.width(),l=t.height(),c=t.offset().left,h=t.offset().top,p=n.$pop.width(),d=n.$pop.height(),v=0,m=0,g=50,y=15,b="";c+p<document.body.clientWidth?(v=c+f/2-g,b+="l"):(v=c+f/2-p+g,b+="r"),h>d+y+e(document).scrollTop()?(m=h-d-y,b+="b"):(m=h+l+y,b+="t");var w=n.$pop.find(".btn-follow").attr("data-options",JSON.stringify({uid:r.get("id"),is_follow:!i.is_not_following,nickname:i.nickname})),E=n.$pop.find(".btn-msg");s.doBindOne(w),o.toBind(E),u.removeClass(u.body,/[l|r][b|t]/g),u.addClass(u.body,b),u.open({left:v,top:m})},function(){})},200)},onMouseleave:function(){this.popTimeId&&(clearTimeout(this.popTimeId),this.hideTimeId=setTimeout(function(){u.close()},200))}});return new f({model:new r})}),define("page/_search/index",["jquery","router","page/page_base","plugin/search-box","module/_search/ifollow","module/common/jtrack","module/_search/_card","module/dialogs/share2friend"],function(e,t,n,r,i,s,o,u){var a=n.extend({init:function(){this.callParent("init"),this.domFix(),this.searchInit(),this.setScope(),this.bindEvent(),i.doBindOne(e(".search-anchor-lists .btn-follow")),s.toBind(e(".search-voice-btns")),o.init(),o.toBind(e("[card]")),this.pageHot(9)},searchInit:function(){var n=e(".search-lgBox");this.searchBox=new r({url:"/search/suggest",paramName:"kw",open:!0,container:n[0],suggestPanel:n.find(".searchResult")[0],searchBtn:n.find(".search-btn")[0],inputEl:n.find(".search-input")[0],callback:function(e,n){e=e?e:" ",e=encodeURIComponent(e),t.toPage("/search/"+n+"/kw/"+e+"/page/1/sc/true")}})},toHotPage:function(t,n){var r=(t-1)*n,i=r+n;i=i>e("#search_hot_list li").length?e("#search_hot_list li").length:i,e("#search_hot_list li").each(function(t,n){t<r||t>=i?e(n).hide():e(n).show()})},pageHot:function(t){var n=this,r=1,i=1;n.toHotPage(1,t),i=Math.ceil(e("#search_hot_list li").length/t),e(".search-hot-lists .btn-arrowL").get(0).onclick=function(){return r--,r<1?(r=1,!1):(n.toHotPage(r,t),!1)},e(".search-hot-lists .btn-arrowR").get(0).onclick=function(){r++;if(r>i){r=i;return}return n.toHotPage(r,t),!1},e(".search-hot-lists .btn-arrowR").click(function(e){return e.preventDefault(),!1}),e(".search-hot-aside li")},bindEvent:function(){this.bindScope(),e(".btn-detail").on("click",function(){var n=e(this),r=n.attr("href");return t.toPage(r),!1}),e(".share-panel2").on("click",".more_operate .item",function(){var t=e(this),n=t.attr("track_id"),r=t.attr("track_uid");u.open("album",n,r)})},bindScope:function(){var t=this;e(".search-classify .link4").on("click",function(){e(".search-classify .link4.on").removeClass("on"),e(this).addClass("on");var n=e(this).attr("data-scope");t.searchBox.setScope(n),t.searchBox.chooseResult()})},domFix:function(){e(".info").removeClass("hidden"),e(".login-wrapper").removeClass("hidden"),e(".sechAlbHov .btn-player").on("click",function(){return!1})},setScope:function(){this.searchBox.setScope(e(".link4.on").attr("data-scope"))},queryHref:function(e){var t=window.location.href.split("?")[1],n={};return t?(t.split("&").forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n[e]?n[e]:!1):!1}});return new a}),define("page/weifm/index",["jquery","underscore","backbone","module/uploadimg","plugin/dialog","page/page_base","page/center/common","plugin/jquery-qrcode"],function(e,t,n,r,i,s,o){var u=config.DIRECT_DTRES_ROOT+"/cover/upload",a=s.extend({$el:e("#sub-main-box"),canSubmit:!0,init:function(){this.callParent("init"),this.$el=e("#mainbox"),o.init(),this.bindEvents(),e(".fm-code").qrcode({render:"table",correctLevel:1,width:140,height:140,text:e(".fm-code").attr("data-url")})},bindEvents:function(){var t=this,n=t.$el.find("#pic_upload_btn"),s=t.$el.find(".uploadImg"),o=t.$el.find("#save_btn");isDefault=1,t.picPath=s.attr("src"),e("#set_btn").on("click",function(){e(this).addClass("selected").siblings().removeClass("selected"),e("div.setting").show(),e("div.def").hide(),t.isDefault=0}),e("#def_btn").on("click",function(){e(this).addClass("selected").siblings().removeClass("selected"),e("div.setting").hide(),e("div.def").show(),t.isDefault=1}),o.on("click",function(){var n=e(this).attr("data-action");return t.canSubmit?(t.canSubmit=!1,e.ajax({url:n,method:"POST",data:{background_pic:t.picPath,use_default_background:t.isDefault},success:function(e){e.res?i.success("保存成功！"):i.alert(e.msg)},error:function(){i.alert("服务器错误！")},complete:function(){t.canSubmit=!0}})):t.picPath||i.alert("请先选择图片！"),!1}),new r({url:u,$el:this.$el.find("#pic_upload_btn"),maxSize:5,repeat:!0,file_upload_limit:1,success:function(e,n){var r=e.data[0];t.picPath=config.FDFS_PATH+"//"+r.dfsId,s.attr("src",t.picPath),t.canSubmit=!!t.picPath}})},release:function(){this.callParent("release")}});return new a}),define("module/helper/helperLogin",["jquery","helper","module/dialogs/login_box","router"],function(e,t,n){function r(){this.init()}return r.prototype={constructor:r,init:function(){this.offEvents(),this.renderLoginHeader(),this._bindLogin(),this._bindLoginOut()},renderLoginHeader:function(){var n=this,r=setInterval(function(i){if(!t.isLogin())return e(".j-workplace").addClass("hidden"),e(".helper-header-right").addClass("fadeIn"),clearInterval(r);if(window.config&&window.config.CURRENT_USER.nickname){var s=window.config.CURRENT_USER.nickname,o=window.config.CURRENT_USER.uid;return n.displayNickName(s,o),e(".helper-header-right").addClass("fadeIn"),clearInterval(r)}},200)},_bindLogin:function(){var t=this,r=e(".login-false");r.on("click",function(e){n.open(function(e){t._getCurrentUser(e.uid).then(function(e){t.displayNickName(e.nickname)})})})},displayNickName:function(t,n){var r='<a href="/'+n+'/profile" target="_blank">'+t+"</a>",i=e(".user"),s=e(".login-true"),o=e(".j-workplace");s.find(".login-btn").html(r),i.addClass("isLogin"),o.removeClass("hidden")},_bindLoginOut:function(){var t=e(".j-login-out"),n=e(".j-workplace");t.on("click",function(){currentUrl=window.location.href,window.location.href="/passport/logout?turnTo="+currentUrl,n.addClass("hidden")})},_getCurrentUser:function(t){var n=e.Deferred();return e.ajax({url:"/main/get_current_user",type:"get",dataType:"json",success:function(e){e.res?n.resolve(e.current_user):n.reject()},error:function(e){n.reject(e)}}),n},offEvents:function(){e(".login-false").off(),e(".j-login-out").off()}},new r}),define("module/helper/helperSearch",["jquery","router"],function(e){function n(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\"/g,"&quot;"):""}function i(e){this.$input=e,this._inputlock_=!1,this._emitInput(),this._bindCompositon()}function s(t){var n='<p class="clOld ${hidden}"><span class="clTxt"> 清空搜索历史</span></p>',i='<li class="srhLi" ><span class="srhDel fr">删除</span><a href="javascript:;" class="srhTxt">${key}</a></li>',s="",o,u=t||r.get();u.forEach(function(e,t){s+=i.replace("${key}",e)});var a=n.replace(/(\$\{hidden\})/g,function(e,t){return u.length==0?"hidden":""});o='<ul class="srhLists">'+s+"</ul>"+a,e(".searchResult")[0].innerHTML=o}function o(){this.$searchBar=e(".searchBar"),this.$searchBtn=e(".searchBtn"),this.$searchIpt=e(".input-bar"),this.$searchResult=e(".searchResult"),this.offEvents(),this._bindEvents()}xmLog&&xmLog("pv.create",{item:"主播帮助中心搜索页"});var t={UP:38,DOWN:40,ENTER:13},r={_addr_:"_HelperHirtory_",_length_:10,set:function(e){var t=window.localStorage[this._addr_];return t?t=JSON.parse(t):t=[],t.indexOf(e)===-1||t.length===0?t.unshift(e):"",t.length>this._length_?t.pop():"",window.localStorage.setItem(this._addr_,JSON.stringify(t)),t},cover:function(t){if(!e.isArray(t))throw new TypeError("_history_ is not a Array");window.localStorage.setItem(this._addr_,JSON.stringify(t))},get:function(){var e=window.localStorage[this._addr_];return e?(e=JSON.parse(e),e):e=[]},deleteItem:function(e){var t=this.get();t.splice(e,1),window.localStorage.setItem(this._addr_,JSON.stringify(t))},remove:function(){window.localStorage.removeItem(this._addr_)}};return i.prototype={constructor:i,_emitInput:function(){var t=this;this.$input.on("input",function(n){t._inputlock_||e(this).trigger("corInput",n)})},_bindCompositon:function(){var t=this;this.$input.on("compositionstart",function(){t._inputlock_=!0}),this.$input.on("compositionend",function(){t._inputlock_=!1,e(this).trigger("input")})}},o.prototype={constructor:o,_bindEvents:function(){function u(){var e=this;new i(this.$searchIpt),this.$searchIpt.on("corInput",function(t){var n=t.target.value.trim(),i=r.get(),o=i.filter(function(e){return e.indexOf(n)!==-1});s(o),e.showList()}),this.$searchIpt.on("focus",function(t){s(),e.showList()}),this.$searchIpt.on("blur",function(){e.hideList()})}function a(){this.$searchResult.on("mousedown",".srhLi",function(e){var t=e.target.innerText;o.$searchIpt.val(t),o.doSearch()}),this.$searchResult.on("mousedown",".srhDel",function(t){t.stopPropagation();var n=e(this).parent().index();r.deleteItem(n),s()}),this.$searchResult.on("mousedown",".clTxt",function(e){r.remove()})}function f(){var n=this,r=-1,i=function(e){var t=n.$searchResult.find(".srhLi");if(e!==-1){var r=t.eq(e);r.css({backgroundColor:"#FFE8DF"}).siblings("li").removeAttr("style");var i=r.find(".srhTxt").text();n.$searchIpt.val(i)}};this.$searchIpt.on("keydown",function(s){var o=e(".srhLists li").length;switch(s.keyCode){case t.UP:r--,r<=-1&&(r=o-1),i(r);break;case t.DOWN:r++,r>=o&&(r=0),i(r);break;case t.ENTER:n.$searchBtn.trigger("click");break;default:return}})}var o=this;u.apply(this),a.apply(this),f.apply(this),this.$searchBtn.on("click",function(){var e=o.$searchIpt.val().trim();o.$searchIpt.val(e);if(e==="")return!1;r.set(n(e)),o.doSearch(),xmLog&&xmLog("pv.send","event",{serviceId:"pageClick",srcModule:"searchAll",item:"searchResult",itemId:e})})},showList:function(){var e=r.get();e.length&&this.$searchBar.addClass("inputting")},hideList:function(){this.$searchBar.removeClass("inputting")},doSearch:function(){var e=this.$searchIpt.val().trim();router.toPage("/helper/searchPage?key="+e),this.hideList()},offEvents:function(){this.$searchBar.off(),this.$searchBtn.off(),this.$searchIpt.off(),this.$searchResult.off()}},new o}),define("page/helper/main",["jquery","page/page_base","module/dialogs/login_box","module/helper/helperLogin","module/helper/helperSearch","router"],function(e,t,n,r,i){var s=t.extend({init:function(){xmLog&&xmLog("pv.create",{item:"主播帮助中心首页"}),xmLog&&xmLog("pv.send","event",{srcPage:"主播帮助中心首页",item:"主播帮助中心首页",serviceId:"viewItem"}),this.callParent("init"),this.bindEvents()},bindEvents:function(){var e=this},release:function(){}});return new s}),define("page/helper/questionPage",["jquery","helper","page/page_base","module/helper/helperLogin","router"],function(e,t,n,r){var i=n.extend({init:function(){xmLog&&xmLog("pv.create",{item:"主播帮助中心问题页"}),xmLog&&xmLog("pv.send","event",{serviceId:"viewItem",item:"主播帮助中心问题页",itemId:location.search.replace(/\?questionId\=/g,""),siteType:"onPage"}),this.callParent("init"),this.bindEvents()},bindEvents:function(){function r(r){var i=r.data,s={use:1,useless:0};if(!t.isLogin())return e(".login-false").click(),!1;n.evaluationQuestion(s[i]).then(function(t){i==="use"?(e(".j-use").addClass("active"),e(".j-useless").removeClass("active"),e(".j-use-tips").removeClass("hidden"),e(".j-useless-tips").addClass("hidden")):(e(".j-use").removeClass("active"),e(".j-useless").addClass("active"),e(".j-use-tips").addClass("hidden"),e(".j-useless-tips").removeClass("hidden"))}),e(this).parents(".result").addClass("disabled-white")}var n=this;e(".j-use").on("click",null,"use",r),e(".j-useless").on("click",null,"useless",r)},release:function(){},evaluationQuestion:function(t){var n=+location.search.replace(/\?questionId\=/g,""),r={questionId:n,evaluation:t},i=e.Deferred();return e(".result").hasClass("disabled-white")?i.reject():(e.ajax({url:"/helper/evaluationQuestion",type:"post",data:{questionId:n,evaluation:t},success:function(e){e.ret?i.resolve(e):i.reject()},error:function(e){i.reject(e)}}),i)}});return new i}),define("module/helper/pagination",["jquery"],function(e){function t(t){this.callback=t,this.$pagingBox=e(".paging-bar"),this.maxNum=e.trim(e(".page-btn").attr("max-size")),this.init()}return t.prototype={constructor:t,init:function(e){this.bindEvents()},bindEvents:function(){var t=this;this.$pagingBox.on("click",".paging-num",function(n){n.preventDefault();var r=e(this).attr("data-index");e(this).hasClass("active")||t.callback(r)}),this.$pagingBox.on("keyup",".page-num",function(n){var r=e.trim(n.target.value)*1;r>0&&r<=t.maxNum&&r%1==0?(e(".page-btn").removeClass("off disabled").addClass("on"),t.$pagingBox.on("click",".page-btn",function(e){e.preventDefault(),t.callback(r)})):e(".page-btn").removeClass("on").addClass("off disabled")})}},t}),define("page/helper/searchPage",["jquery","page/page_base","module/dialogs/login_box","module/helper/helperLogin","module/helper/helperSearch","module/helper/pagination","router"],function(e,t,n,r,i,s){var o=t.extend({init:function(){xmLog&&xmLog("pv.create",{item:"主播帮助中心搜索页"}),xmLog&&xmLog("pv.send","event",{item:"主播帮助中心搜索页",serviceId:"viewItem"}),e(".questions-items ul").off().on("click","a",function(t){var n=e(t.currentTarget);xmLog&&xmLog("pv.send","event",{serviceId:"pageClick",srcModule:"searchResult",item:"主播帮助中心问题页",itemId:n.attr("data-id")})}),this.callParent("init"),this.bindJumpPage()},bindJumpPage:function(){function t(e){var t=/(key=([^&]*))/g,n=decodeURI(window.location.search),r="?"+n.match(t)[0]+"&page="+e;router.toPage("/helper/searchPage"+r)}var e=new s(t)},release:function(){}});return new o}),define("page/helper/modulePage",["jquery","page/page_base","module/dialogs/login_box","module/helper/helperLogin","module/helper/pagination"],function(e,t,n,r,i){var s=t.extend({init:function(){this.callParent("init"),this.bindJumpPage()},bindJumpPage:function(){function t(e){var t=/(moduleId=([^&]*))/g,n="?"+window.location.search.match(t)[0]+"&page="+e;router.toPage("/helper/modulePage"+n)}var e=new i(t)},release:function(){}});return new s}),define("baidushare",[],function(){window._bd_share_config={common:{bdSnsKey:config.BAIDU_BDSNSKEY,bdStyle:"1",bdSize:"16",onBeforeClick:function(e,t,n){if(_bd_share_main.bds_last_data){var r=JSON.parse(_bd_share_main.bds_last_data);t.bdText=r.text,t.bdDesc=r.bdDes,t.bdUrl=r.url,t.bdPic=r.pic,t.bdSearchPic=r.searchPic||0}return t}},share:{}};with(document)(0)[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="//s1.xmcdn.com/lib/cors/last/assets/baidu-share-sdk/share.js?cdnversion="+~(-(new Date)/36e5)]}),define("plugin/baidushare",["jquery","baidushare"],function(e){function t(e){var t=e.parent();_bd_share_main.bds_last_data=t.data("baidu_share")||JSON.parse(t.attr("data"));var n=e.attr("data-url");n&&(_bd_share_main.bds_last_data.url=n,_bd_share_main.bds_last_data.pic=null,_bd_share_main.bds_last_data.searchPic=1),_bd_share_main.bds_last_data=JSON.stringify(_bd_share_main.bds_last_data)}function n(e){var t=e.parent(),n=e.next();_bd_share_main.bds_last_data=JSON.stringify(t.data("baidu_share"))||t.attr("data"),n[0].click()}$(document).on("mousedown","a",function(e){var r=$(this);if(r.is("[data-cmd]")){t(r);return}if(r.is(".bds_more_quiet")){n(r);return}})}),/\bLBBROWSER\b/.test(navigator.userAgent)&&(history.pushState=!1),requirejs.config({baseUrl:config.STATIC_PATH+"/js/lib",shim:{json2:{exports:"JSON"},underscore:{exports:"_"},jquery:{exports:"jQuery"},backbone:{deps:["json2","underscore","jquery"],exports:"Backbone"}},paths:{model:"../model",module:"../module",collection:"../collection",page:"../page",plugin:"../plugin",router:"../router",exporting:"../plugin/highchart/charts/modules/exporting.src",highchart:"../plugin/highchart/charts/highcharts.src",highmap:"../plugin/highchart/maps/modules/map.src",moment:"../plugin/moment.min",datepicker:"../plugin/datepicker/datepicker"},waitSeconds:15}),define("almond_main",["require","page/page_base","page/search","page/welcome","page/download","page/404","page/center/album","page/center/fans","page/center/favorites","page/center/follow","page/center/listened","page/center/sound","page/center/publish","page/center/common","page/center/live_manage","page/center/comment","page/center/like","page/center/index","page/center/voice","page/center/myAlbum","page/center/voiceAnalysis","page/center/albumAnalysis","page/center/dataPreview","page/center/fansAnalysis","page/center/incomeDetail","page/center/anchorGrade","page/center/createAlbum","page/center/createAlbumHtml","page/center/editAlbum","page/center/timePublish","page/center/albumIntegrity","page/discovery/album_sound","page/discovery/dis_album","page/discovery/dis_index","page/discovery/dis_sound","page/discovery/dis_user","page/final/final_album","page/final/final_sound","page/final/final_tag","page/final/sound_liker","page/home/feed","page/home/mytracks","page/home/timeline","page/home/index_user_new","page/message/comment","page/message/letter","page/message/letterdetail","page/message/like","page/message/notice","page/message/referme","page/message/group_send","page/my/fans","page/my/follow","page/my/income","page/passport/forget","page/passport/passport","page/passport/login","page/setting/avatar","page/setting/blacklist","page/setting/message","page/setting/personal","page/setting/privacy","page/setting/sync","page/setting/password","page/setting/feed","page/upload/edit_track","page/upload/fileprogress","page/upload/handlers","page/upload/information","page/upload/record","page/upload/upload_index","page/upload/edit_album_info","page/upload/vioce_manager","page/podcast/apply_new","page/podcast/apply_edit","page/podcast/apply_check","page/podcast/apply_list","page/verify/addv","page/verify/addv_intro","page/verify/addv-center","page/verify/addv-company","page/verify/addv-person","page/centify/personal","page/centify/company","page/centify/star","page/centify/guide","page/centify/companyModify","page/centify/personalModify","page/vip/vip_create","page/vip/vip_edit","page/vip/vip_manage","page/register/register","page/_search/index","page/weifm/index","page/helper/main","page/helper/questionPage","page/helper/searchPage","page/helper/modulePage"],function(e){e("page/page_base"),e("page/search"),e("page/welcome"),e("page/download"),e("page/404"),e("page/center/album"),e("page/center/fans"),e("page/center/favorites"),e("page/center/follow"),e("page/center/listened"),e("page/center/sound"),e("page/center/publish"),e("page/center/common"),e("page/center/live_manage"),e("page/center/comment"),e("page/center/like"),e("page/center/index"),e("page/center/voice"),e("page/center/myAlbum"),e("page/center/voiceAnalysis"),e("page/center/albumAnalysis"),e("page/center/dataPreview"),e("page/center/fansAnalysis"),e("page/center/incomeDetail"),e("page/center/anchorGrade"),e("page/center/createAlbum"),e("page/center/createAlbumHtml"),e("page/center/editAlbum"),e("page/center/timePublish"),e("page/center/albumIntegrity"),e("page/discovery/album_sound"),e("page/discovery/dis_album"),e("page/discovery/dis_index"),e("page/discovery/dis_sound"),e("page/discovery/dis_user"),e("page/final/final_album"),e("page/final/final_sound"),e("page/final/final_tag"),e("page/final/sound_liker"),e("page/home/feed"),e("page/home/mytracks"),e("page/home/timeline"),e("page/home/index_user_new"),e("page/message/comment"),e("page/message/letter"),e("page/message/letterdetail"),e("page/message/like"),e("page/message/notice"),e("page/message/referme"),e("page/message/group_send"),e("page/my/fans"),e("page/my/follow"),e("page/my/income"),e("page/passport/forget"),e("page/passport/passport"),e("page/passport/login"),e("page/setting/avatar"),e("page/setting/blacklist"),e("page/setting/message"),e("page/setting/personal"),e("page/setting/privacy"),e("page/setting/sync"),e("page/setting/password"),e("page/setting/feed"),e("page/upload/edit_track"),e("page/upload/fileprogress"),e("page/upload/handlers"),e("page/upload/information"),e("page/upload/record"),e("page/upload/upload_index"),e("page/upload/edit_album_info"),e("page/upload/vioce_manager"),e("page/podcast/apply_new"),e("page/podcast/apply_edit"),e("page/podcast/apply_check"),e("page/podcast/apply_list"),e("page/verify/addv"),e("page/verify/addv_intro"),e("page/verify/addv-center"),e("page/verify/addv-company"),e("page/verify/addv-person"),e("page/centify/personal"),e("page/centify/company"),e("page/centify/star"),e("page/centify/guide"),e("page/centify/companyModify"),e("page/centify/personalModify"),e("page/vip/vip_create"),e("page/vip/vip_edit"),e("page/vip/vip_manage"),e("page/register/register"),e("page/_search/index"),e("page/weifm/index"),e("page/helper/main"),e("page/helper/questionPage"),e("page/helper/searchPage"),e("page/helper/modulePage")}),config.STATIC_PROTO_PATH="/assets/protos",require(["jquery","backbone","router","plugin/baidushare"],function(e,t,n){var r=location.pathname&&location.pathname==="/";if(r){var i="/";location.hash&&(i=location.hash.slice(1)),i[0]!=="/"&&(i="/"+i);if(window.onpopstate===undefined){var s=e.cookie("router_path");s?n.toPage(s):n.toPage(i)}else n.toPage(i)}});